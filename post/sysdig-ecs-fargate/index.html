<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Sysdig&#43;ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ | jedipunkz ğŸš€ ã®ãƒ–ãƒ­ã‚°</title>
<meta name="keywords" content="">
<meta name="description" content="ECS Fargate ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ Sysdig ã§å®Ÿç¾ã€‚ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãŸ CWPP ã«ã‚ˆã‚‹è„…å¨æ¤œçŸ¥ã¨é€šçŸ¥ã®æ–¹æ³•ã‚’è§£èª¬">
<meta name="author" content="jedipunkz">
<link rel="canonical" href="https://jedipunkz.github.io/post/sysdig-ecs-fargate/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.eca3ac94ad376a8ec0046583cdd8089aed44c59e803a22faa31fb0e2cf0cc260.css" integrity="sha256-7KOslK03ao7ABGWDzdgImu1ExZ6AOiL6ox&#43;w4s8MwmA=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://jedipunkz.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://jedipunkz.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://jedipunkz.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://jedipunkz.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://jedipunkz.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://jedipunkz.github.io/post/sysdig-ecs-fargate/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-2H91XCYVZ8"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-2H91XCYVZ8');
        }
      </script><meta property="og:url" content="https://jedipunkz.github.io/post/sysdig-ecs-fargate/">
  <meta property="og:site_name" content="jedipunkz ğŸš€ ã®ãƒ–ãƒ­ã‚°">
  <meta property="og:title" content="Sysdig&#43;ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ">
  <meta property="og:description" content="ECS Fargate ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ Sysdig ã§å®Ÿç¾ã€‚ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãŸ CWPP ã«ã‚ˆã‚‹è„…å¨æ¤œçŸ¥ã¨é€šçŸ¥ã®æ–¹æ³•ã‚’è§£èª¬">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2022-09-24T22:00:00+09:00">
    <meta property="article:modified_time" content="2022-09-24T22:00:00+09:00">
      <meta property="og:image" content="https://jedipunkz.github.io/jedipunkz.jpg">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://jedipunkz.github.io/jedipunkz.jpg">
<meta name="twitter:title" content="Sysdig&#43;ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ">
<meta name="twitter:description" content="ECS Fargate ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ Sysdig ã§å®Ÿç¾ã€‚ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãŸ CWPP ã«ã‚ˆã‚‹è„…å¨æ¤œçŸ¥ã¨é€šçŸ¥ã®æ–¹æ³•ã‚’è§£èª¬">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://jedipunkz.github.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Sysdig+ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ",
      "item": "https://jedipunkz.github.io/post/sysdig-ecs-fargate/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Sysdig+ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ",
  "name": "Sysdig\u002bECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ",
  "description": "ECS Fargate ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ Sysdig ã§å®Ÿç¾ã€‚ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãŸ CWPP ã«ã‚ˆã‚‹è„…å¨æ¤œçŸ¥ã¨é€šçŸ¥ã®æ–¹æ³•ã‚’è§£èª¬",
  "keywords": [
    
  ],
  "articleBody": "ã“ã‚“ã«ã¡ã¯ @jedipunkz ğŸš€ ã§ã™ã€‚\nECS æ§‹æˆã‚’ã‚‚ã†å°‘ã—ã‚»ã‚­ãƒ¥ã‚¢ã«ä¿ã¦ã‚‹æ§‹æˆã¯ãªã„ã‚‚ã®ã ã‚ã†ã‹ã¨æ¨¡ç´¢ã—ã¦ã„ã‚‹ãªã‹ã§ Sysdig ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚ã¾ã å°å…¥ã§ãã‚‹ç›®å‡¦ã¯ç«‹ã£ã¦ã„ãªã„ã®ã§ã™ãŒã‚ã‚‹ç¨‹åº¦ãƒã‚¦ãƒã‚¦è“„ç©å‡ºæ¥ã¦ããŸã®ã§ã“ã“ã§æ¤œè¨¼å†…å®¹ç­‰ã‚’è¨˜äº‹ã«ã—ã‚ˆã†ã‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚\nSysdig ã¯å¹¾ã¤ã‹ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒå­˜åœ¨ã™ã‚‹ã®ã§ã™ãŒä»Šå›æ¤œè¨¼ã—ãŸã®ã¯ Sysdig Serverless Security ã¨å‘¼ã°ã‚Œã‚‹ãƒ¢ãƒã§ ECS Fargate ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å®Ÿè·µã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚\nSysdig ã¨ã¯ AWS ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚‚è„…å¨æ¤œçŸ¥ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãŒæƒã£ã¦ã„ã‚‹ã®ã¯ã”å­˜çŸ¥ã¨æ€ã„ã¾ã™\nå¯¾è±¡ ç›®çš„ æŠ€è¡“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ AWS ãƒªã‚½ãƒ¼ã‚¹ é©šç•°æ¤œçŸ¥ AWS GuardDuty ã¾ãŸäºˆé˜²ã®è¦³ç‚¹ã§è„†å¼±æ€§è¨ºæ–­ãŒå‡ºæ¥ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚‚ã‚ã‚Šã‚ã™\nå¯¾è±¡ ç›®çš„ æŠ€è¡“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ AWS ãƒªã‚½ãƒ¼ã‚¹ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨ºæ–­ AWS Trusted Advisor ECS ã‚³ãƒ³ãƒ†ãƒŠ è„†å¼±æ€§è¨ºæ–­ ECR Image Scan EC2 ä¸Šã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ è„†å¼±æ€§è¨ºæ–­ AWS Inspector ã“ã“ã§æ°—ãŒã¤ãã¨æ€ã†ã®ã§ã™ãŒã‚³ãƒ³ãƒ†ãƒŠä¸Šã®é©šç•°æ¤œçŸ¥ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹ãŒ AWS ã«ã¯ç„¡ã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ (2022/09 æ™‚ç‚¹)\nSysdig Serverless Security ã¯ ECS Fargate ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨æ¤œçŸ¥ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ECS Fargate åˆ©ç”¨æ™‚ã«ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨æ¤œçŸ¥ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹ã¯ä»–ã«ã‚‚å¹¾ã¤ã‹ã‚ã‚Šã¾ã™ãŒã€Sysdig ã¯ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãŸã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å®Ÿè·µã—ã¦è„…å¨æ¤œçŸ¥ãƒ»é€šçŸ¥ãŒè¡Œãˆã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚è‡ªåˆ†ã‚‚è©³ã—ããªã„ã®ã§ã™ãŒã“ã‚Œã‚’ CWPP (Cloud Workload Protection Platform) ã¨è¨€ã†ã‚‰ã—ã„ã§ã™ã€‚ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã¨ã„ã†ã®ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã®ä»®æƒ³ãƒã‚·ãƒ³ãƒ»ç¨¼åƒä¸­ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’æŒ‡ã—ã¦ã€CWPP ã¯ãƒãƒ«ã‚¦ã‚§ã‚¢ä¿è­·ã€è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã€ç•°å¸¸æ¤œçŸ¥ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ãã‚Œãã‚Œã®ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚’ä¿è­·ã™ã‚‹ã€ã¨ã„ã†ã“ã¨ã‚‰ã—ã„ã§ã™ã€‚\nSysdig ä»¥å¤–ã® CWPP ã¯ã©ã†ã„ã†ã‚‚ã®ãŒã‚ã‚‹ã®ã‹? Sysdig ä»¥å¤–ã§ã™ã¨ä»£è¡¨ã™ã‚‹ã‚‚ã®ãŒä¸‹è¨˜ã«ãªã‚‹ãã†ã§ã™ã€‚\nDatadog Aqua CWWP Palo Alto Prisma Sysdig ã‚’ã‚‚ã†å°‘ã—å…·ä½“çš„ã«èª¬æ˜ Sysdig ã¯ CNCF ã® Falco ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦è„…å¨æ¤œå‡ºã‚’è¡Œã†ãŸã‚ã® SaaS ã‚’å«ã‚ãŸã‚·ã‚¹ãƒ†ãƒ ã¨ãªã‚Šã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨ã¨å…±ã«ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç´ä»˜ã‘ã‚‹ã“ã¨ã§ã‚¯ãƒ©ã‚¦ãƒ‰è‡ªä½“ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚ãŸã¨ãˆã°å•é¡Œã®ã‚ã‚‹ S3 ãƒã‚±ãƒƒãƒˆå…¬é–‹è¨­å®šã‚„ã€IAM ã®æ¨©é™ã«é–¢ã™ã‚‹ã‚‚ã®ãªã©ã€‚ä»Šå›è‡ªåˆ†ã¯å‰è€…ã®ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨æ¤œçŸ¥ã«ã¤ã„ã¦èª¿ã¹ã¾ã—ãŸã®ã§ã€ã“ã®è¨˜äº‹ã§ã‚‚ãã‚Œã«ã¤ã„ã¦è¨˜ãã†ã¨æ€ã„ã¾ã™ã€‚\nãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ ãƒ™ãƒ¼ã‚¹ã¨ãªã£ã¦ã„ã‚‹ Falco ã§ã¯ Linux ã‚«ãƒ¼ãƒãƒ«ã® ptrace ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’ç”¨ã„ã¦è„…å¨æ¤œçŸ¥ (ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ãã‚„ãƒ‡ã‚£ã‚¹ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¢ºç«‹ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‡ãƒ¼ã‚¿é€å—ä¿¡ãªã©ã«ã¤ã„ã¦) ã—ã¾ã™ã€‚ã§ã™ãŒ ptrace ã¯ã‚³ãƒ³ãƒ†ãƒŠã®æœ¬æ¥ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«çµæ§‹ãªå½±éŸ¿ãŒã‚ã‚‹ãã†ã§ã™ã€‚ãã‚Œã«æ¯”è¼ƒã—ã¦ Sysdig ã¯ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å®Ÿè£…ã—ã¦ã„ãªã„ã‚³ãƒ³ãƒ†ãƒŠã¨ã»ã¼åŒç­‰ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå‡ºã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚\nå‚è€ƒè³‡æ–™: Sysdig Blog\nSysdig + ECS Fargate ã®æ§‹æˆ ã“ã“ã‹ã‚‰å…·ä½“çš„ã«æ¤œè¨¼ã—ãŸå†…å®¹ã‚’è¨˜ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\nè‡ªåˆ†ã¯ ECS Fargate ã‚’ç”¨ã„ãŸ Sysdig åˆ©ç”¨ã‚’å‰æã«ã—ã¦æ§‹æˆã‚’çµ„ã¿ã¾ã—ãŸã€‚\næ§‹æˆã®ç‰¹å¾´ã¨ã—ã¦ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚\n2ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆ Sysdig ã‚µãƒ¼ãƒãƒ¬ã‚¹ãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ Sysdig ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒ»ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ 2ã¤ã¨ã‚‚ ECS Fargate ä¸Šã«èµ·å‹• ã‚¿ã‚¹ã‚¯å®šç¾©æ¯ã«ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒèµ·å‹•ã—ãƒ—ãƒ­ã‚­ã‚·çš„ã«å‹•ä½œã™ã‚‹ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨é€šä¿¡ ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã—ã¦ Sysdig ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¸è»¢é€ã™ã‚‹å½¹å‰² ä¸‹è¨˜ãŒæ§‹æˆå›³ã«ãªã‚Šã¾ã™ã€‚\nå‚è€ƒ: https://docs.sysdig.com/en/docs/installation/serverless-agents/aws-fargate-serverless-agents/ æ§‹ç¯‰ Sysdig Region æƒ…å ± ä¸‹è¨˜ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã‚‹é€šã‚Š Sysdig ã«ã¯åˆ©ç”¨è€…ãŒæ„è­˜ã™ã¹ã Region ã¨ã„ã†æ¦‚å¿µãŒã‚ã‚Šã¾ã™ã€‚ã©ã® Region ã‚’ç”¨ã„ã‚‹ã‹æ±ºå®šã—ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæƒ…å ±ã‚’æ§‹ç¯‰ã®äº‹å‰ã«åé›†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nå‚è€ƒ: https://docs.sysdig.com/en/docs/administration/saas-regions-and-ip-ranges Sysdig ã‚µãƒ¼ãƒãƒ¬ã‚¹ãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ§‹ç¯‰ ä¸‹è¨˜ã® Sysdig å…¬å¼ã® Terraform Module ã‚’ç”¨ã„ã‚‹äº‹ã§æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚\nå‚è€ƒ: https://github.com/sysdiglabs/terraform-aws-fargate-orchestrator-agent ä¸‹è¨˜ãŒæ¤œè¨¼ç›®çš„ã§ä½œæˆã—ãŸ Terraform ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚\nmodule \"sysdig_orchestrator_agent\" { source = \"sysdiglabs/fargate-orchestrator-agent/aws\" version = \"0.2.0\" name = \"example-sysdigorchestrator\" vpc_id = var.vpc_id subnets = [ aws_subnet.example1.id, aws_subnet.example2.id, ] access_key = var.my_sysdig_access_key collector_host = \"ingest-us2.app.sysdig.com\" # å®šã‚ãŸãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚³ãƒ¬ã‚¯ã‚¿ãƒ›ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ collector_port = \"6443\" agent_image = \"quay.io/sysdig/orchestrator-agent:latest\" assign_public_ip = false # Internet Gateway ã‚’ç”¨ã„ã‚‹å ´åˆã¯ true ã‚’æŒ‡å®š } Sysdig ã‚µãƒ¼ãƒãƒ¬ã‚¹ãƒ»ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç››ã‚Šè¾¼ã‚“ã ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®æ§‹ç¯‰ æ¤œè¨¼ã§ã¯ Sysdig å…¬å¼ã® Terraform Provider ã‚’ç”¨ã„ã¦ ECS ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãŸã€‚ä¸‹è¨˜ãŒãã®éš›ã®ã‚³ãƒ¼ãƒ‰ã¨ãªã‚Šã¾ã™ã€‚\ndata \"sysdig_fargate_workload_agent\" \"sysdig\" { container_definitions = file(\"container_definitions/sysdigapp.json\") sysdig_access_key = var.my_sysdig_access_key workload_agent_image = \"quay.io/sysdig/workload-agent:latest\" orchestrator_host = module.sysdig_orchestrator_agent.orchestrator_host orchestrator_port = module.sysdig_orchestrator_agent.orchestrator_port } resource \"aws_ecs_task_definition\" \"sysdig\" { family = \"example-sysdigapp-taskdef\" cpu = \"2048\" memory = \"8192\" network_mode = \"awsvpc\" requires_compatibilities = [\"FARGATE\"] execution_role_arn = aws_iam_role.task_exec.arn task_role_arn = aws_iam_role.task.arn container_definitions = data.sysdig_fargate_workload_agent.sysdig.output_container_definitions } å°šã€Sysdig Provider ã‚’ç”¨ã„ã¦ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦ã„ã¾ã™ãŒã€æ‰‹å‹•ã§ã‚‚ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’è¨˜ã™ã“ã¨ãŒå¯èƒ½ã ãã†ã§ã™ã€‚ãã®éš›ã«ã¯ä¸‹è¨˜ã®å‡¦ç†ã‚’ã‚¿ã‚¹ã‚¯å®šç¾©ã«æ–½ã™ã“ã¨ã§è¦ä»¶ã‚’æº€ãŸã›ã‚‹ãã†ã§ã™ã€‚\nSysdig ã«é–¢ã™ã‚‹ç’°å¢ƒå¤‰æ•° Volume ãƒã‚¦ãƒ³ãƒˆæŒ‡å®š capabilities æŒ‡å®š Sysdig ã‚³ãƒ³ãƒ†ãƒŠæŒ‡å®š æ§‹ç¯‰å¾Œã® Sysdig UI ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ æ§‹ç¯‰å¾Œã€(US-West ã‚’åˆ©ç”¨ã—ãŸå ´åˆã¯) ä¸‹è¨˜ã® URL ã§ Sysdig Secure UI ã«ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã¾ã™ã€‚\nhttps://us2.app.sysdig.com/secure/#/policies\nã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥ ãƒãƒªã‚·ãƒ¼ã®ç¨®åˆ¥ ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥ã®ãŸã‚ã®ãƒãƒªã‚·ãƒ¼ãŒç”¨æ„ã•ã‚Œã¦ã„ã¦å¹¾ã¤ã‹ã‚ã‚‹ã®ã§ã™ãŒ ECS Fargate ã¨ã„ã†æ¡ä»¶ã§ã‚ã‚Œã°ä¸‹è¨˜ã®2ã¤ã®åˆ©ç”¨ãŒå¯èƒ½ã ãã†ã§ã™ã€‚\nWorkload Policy (Powered By Falco) List Maching Policy ä¸‹è¨˜ã¯ Kubernetes å‰æã ãã†ã§ã™ã€‚\nContainer Drift Policy Machine Learning Policy ä¸‹è¨˜ã¯ã‚³ãƒ³ãƒ†ãƒŠã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã¯åˆ¥æ  Policy ã§å‰è¿°ã—ãŸã‚¯ãƒ©ã‚¦ãƒ‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ Sysdig ã«ç´ä»˜ã‘ãŸéš›ã«åˆ©ç”¨ã§ãã‚‹ãƒãƒªã‚·ãƒ¼ã§ã™ã€‚\nKubernetes Audit Policy AWS CloudTrail Policy GCP Audit Log Policy Azure Platform Log Policy List Maching Policy ã«ãŠã‘ã‚‹ ç‰¹å®šãƒãƒ¼ãƒˆã®ãƒªã‚¹ãƒ³æ¤œçŸ¥ ä¸‹è¨˜ã® Rule ã‚’ä½œæˆã—ã¦ Policy ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã§ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥å‡ºæ¥ã¾ã™ã€‚ ã¾ãŸ Policy ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦ kill, stop, pause, nothing(notify only) ãŒé¸ã¹ã¾ã™ã€‚è„…å¨ã‚’æ¤œçŸ¥ã—ãŸéš›ã«ãƒ—ãƒ­ã‚»ã‚¹ã®åœæ­¢ãªã©ãŒè¡Œãˆã‚‹ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚\nè¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å å€¤ allInbounds Deny allOutbounds Deny udpListenPortsMatchItems true tcpListenPortsMatchItems true udpListenPorts 8080 tcpListenPorts 8080 ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿æ¤œçŸ¥ ä¸‹è¨˜ã® Rule ã‚’ä½œæˆã—ã¦ Policy ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã§ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥å‡ºæ¥ã¾ã™ã€‚ ã¾ãŸåŒæ§˜ã« Policy ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦ kill, stop, pause, nothing(notify only) ãŒé¸ã¹ã¾ã™ã€‚\nè¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å å€¤ readPathsMatchItems true readPaths \u003cãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹\u003e readWritePathsMatchItems false Workload Policy ç‰¹å®šãƒ—ãƒ­ã‚»ã‚¹ã®èµ·å‹• ä¸‹è¨˜ã® Rule ã‚’ä½œæˆã—ã¦ Policy ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã§ç‰¹å®šã®ãƒ—ãƒ­ã‚»ã‚¹ãŒç‰¹å®šã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”¨ã„ã¦èµ·å‹•ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’æ¤œçŸ¥å‡ºæ¥ã¾ã™ã€‚\nè¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å å€¤ condition user.name = â€œnginxâ€ and proc.name = â€œnginxâ€ output ä»»æ„ã®æƒ…å ±ã‚’å‡ºåŠ› å‹•ä½œç¢ºèªã—ãŸéš›ã® system call ã®æƒ…å ±ã¯ä¸‹è¨˜ã«ãªã‚‹ã®ã§ã“ã‚Œã‚‰ã‚’ condition ã«è¨˜ã›ã°æ¤œçŸ¥ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚\n(user.name=nginx user.loginuid=-1 proc.cmdline=nginx container.id=1e2a2f03e1934a719d98c45276ea57eb-265927825 container_name=web evt.type=accept evt.res= proc.pid=76 proc.cwd=/ proc.ppid=39 proc.pcmdline=nginx -g daemon off; proc.sid=15 proc.exepath=/usr/sbin/nginx user.uid=101 user.loginname= group.gid=101 group.name=nginx container.name=web image=nginx:latest)\nãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹çš„ãª Policy è¨­å®š ä¸Šè¨˜ã®ã‚ˆã†ã«å€‹åˆ¥ã« Policy, Rule ã‚’å®šç¾©ã—ã¦ã‚‚ã€æ¼ã‚ŒãŒç™ºç”Ÿãƒ»æƒ³å®šå¤–ãŒç™ºç”Ÿã™ã‚‹ã®ã§ã€Sysdig ãŒ Managed Rules, Policies ã‚’ç”¨æ„ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚å°‘ãªãã¨ã‚‚ä¸‹è¨˜ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã“ã¨ã§å¤§æŠµã®è„…å¨æ¤œçŸ¥ã¯å¯èƒ½ã ãã†ã§ã™ã€‚\nSysdig Runtime Threat Detection (Workload Policy)\nThis policy contains rules which Sysdig considers High Confidence of a security incident. They are tightly coupled to common attacker TTPâ€™s. They have been designed to minimize false positives but may still result in some depending on your environment.\nSysdig Runtime Threat Intelligence (Workload Policy)\nThis policy contains rules using Indicators of Compromise curated by the Sysdig Threat Intelligence Team from premium, OSINT, and custom threat intelligence feeds. Any events from the rules in this policy should be considered serious and investigated as soon as possible.\nSysdig Runtime Notable Events (Workload Policy)\nThis Notable Events policy contains rules which may indicate undesired behavior including security threats. The rules are more generalized than Threat Detection policies and may result in more noise. Tuning will likely be required for the events generated from this policy.\nã‚³ã‚¹ãƒˆ AWS Marketplae ã« Sysdig Secure DevOps Platform ãŒã‚ã‚Šã€Pricing ãŒè¨˜è¼‰ã‚ã‚Šã¾ã—ãŸã€‚\nãƒ—ãƒ©ãƒ³å 1ãƒ¶æœˆã‚³ã‚¹ãƒˆ 1å¹´é–“ã‚³ã‚¹ãƒˆ èª¬æ˜ Secure Cloud Security $500 $5,000 CloudTrail é€£æºãªã© Secure Enterprise CaaS $12/task $120/task Container Runtime Security ã¾ã¨ã‚ Terraform Sysdig Provider ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€è‡ªåˆ†ãŸã¡ã®ç’°å¢ƒã«å–ã£ä»˜ãæ˜“ã„æ§‹ç¯‰æ–¹æ³•ã‚’å–ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ Module ã‚’ä½¿ãˆã°ç°¡å˜ã«æ§‹ç¯‰å¯èƒ½ã€‚å¤–éƒ¨ã¨é€šä¿¡ã•ã›ã‚‹ã®ã§ã™ãŒ VPC å†…éƒ¨ã«ç½®ãã“ã¨ã‚‚å¯èƒ½ã€‚ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚ Terraform ã§å®¹æ˜“ã«æ§‹ç¯‰å¯èƒ½ã€‚ã‚¿ã‚¹ã‚¯å®šç¾©ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ Terraform ä»¥å¤–ã®æŠ€è¡“ã‚’ä½¿ã£ã¦è¡Œã£ã¦ã„ã‚‹å ´åˆã§ã‚‚4ã¤ã»ã©ã®è¦ä»¶ã‚’äºˆã‚æº€ãŸã—ã¦ãŠã‘ã°æ¯”è¼ƒçš„ç°¡å˜ã« Sysdig ã‚’é©ç”¨ã—ãŸã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•å¯èƒ½ã§ã™ã€‚ä»Šå›ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯æ¸¬å®šå‡ºæ¥ã¦ã„ã¾ã›ã‚“ãŒã€å…¬å¼ãƒ–ãƒ­ã‚°ã®æƒ…å ±ã‚’ä¿¡ã˜ã‚‹ã¨ ptrace ã«æ¯”ã¹ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ã¯æ°—ã«ã™ã‚‹å¿…è¦ãªããªã‚Šãã†ã§ã™ã€‚ã“ã“ã¯æœ‰å„Ÿç‰ˆã ãªã¨ã„ã†å°è±¡ã€‚\nã¾ãŸã€æ§‹ç¯‰ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ (ä¾‹ã§ Nginx) ã®ä¸­ã‚’é™¤ã„ã¦ã¿ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚»ã‚¹ãŒç¨¼åƒã—ã¦ã„ã¾ã—ãŸã€‚\n# ps auxf (ä¸€åˆ†æƒ…å ±ã‚’æŠœç²‹) /dev/init -- /opt/draios/bin/instrument /docker-entrypoint.sh nginx -g daemon off; /opt/draios/bin/instrument /docker-entrypoint.sh nginx -g daemon off; \\_ /opt/draios/bin/agentino --name=ip-10-0-65-79.ap-northeast-1.compute.internal --aws-account-id=395127550274 --aws-region=ap-north east-1 --aws-az=ap-northeast-1a --aws-fargate-cluster-arn=arn \\_ /opt/draios/bin/pdig -C -t -1 -l /opt/draios/bin/libudigembed.so /docker-entrypoint.sh nginx -g daemon off; \\_ nginx: master process nginx -g daemon off; \\_ nginx: worker process \\_ nginx: worker process ã‚³ãƒ³ãƒ†ãƒŠãƒ—ãƒ­ã‚»ã‚¹ãŒ /opt/draios/bin/instrument ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã«æ¸¡ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚æ›´ã«ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã§èµ·å‹•ã—ã¦ã„ã‚‹ Instrument ã‚³ãƒ³ãƒ†ãƒŠã®ãƒœãƒªãƒ¥ãƒ¼ãƒ é ˜åŸŸã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠãŒãƒã‚¦ãƒ³ãƒˆã—ã¦ã„ã‚‹ã®ãŒåˆ¤ã‚Šã¾ã—ãŸã€‚\nã¾ãŸã€æ³¨æ„ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚ECS Exec ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥ã®å‹•ä½œç¢ºèªã¨ã—ã¦ã®æ“ä½œã‚’è¡Œã£ã¦ã‚‚æ¤œçŸ¥ã—ã¦ãã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚Policy ã‚’ç‹¬è‡ªã«ä½œæˆã—ãŸéš›ã«ä¸ä¾¿ãªã®ã§ã™ãŒã€å‹•ä½œç¢ºèªã®ãŸã‚ã«ã¯ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§ sshd ã‚’èµ·å‹•ã™ã‚‹ã‹ã€ã‚¿ã‚¹ã‚¯å®šç¾©ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆæŒ‡å®šã‚’æ›¸ãæ›ãˆã¦è¡Œã†å¿…è¦ãŒã‚ã‚‹ãã†ã§ã™ã€‚ãŸã ã€Sysdig ç¤¾ã§ã‚‚ ECS Exec ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸéš›ã®æ“ä½œã«é–¢ã—ã¦ã‚‚æ¤œçŸ¥ç¯„å›²ã«ã™ã‚‹ãŸã‚ã®é–‹ç™ºã‚’äºˆå®šã—ã¦ã„ã‚‹ãã†ã§ã™ã€‚ECS Exec ã¯ IAM ã®æ¨©é™ãŒã‚ã‚Œã°ãƒ­ã‚°ã‚¤ãƒ³å‡ºæ¥ã¦ã—ã¾ã†ã‚‚ã®ã§ã€æ¯”è¼ƒçš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«ã¯æ°—ã‚’ä½¿ã†æ©Ÿèƒ½ã ã¨æ€ã£ã¦ã„ã‚‹ã®ã§ Sysdig ã§ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®æ“ä½œã‚’æ¤œçŸ¥å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã¯åŠ©ã‹ã‚Šã¾ã™ã—ã€æœŸå¾…ã—ãŸã„ã¨ã“ã‚ã§ã™ã€‚\n",
  "wordCount" : "721",
  "inLanguage": "en",
  "image": "https://jedipunkz.github.io/jedipunkz.jpg","datePublished": "2022-09-24T22:00:00+09:00",
  "dateModified": "2022-09-24T22:00:00+09:00",
  "author":{
    "@type": "Person",
    "name": "jedipunkz"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jedipunkz.github.io/post/sysdig-ecs-fargate/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "jedipunkz ğŸš€ ã®ãƒ–ãƒ­ã‚°",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jedipunkz.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jedipunkz.github.io/" accesskey="h" title="jedipunkz ğŸš€ ã®ãƒ–ãƒ­ã‚° (Alt + H)">jedipunkz ğŸš€ ã®ãƒ–ãƒ­ã‚°</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jedipunkz.github.io/about" title="About Me">
                    <span>About Me</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://jedipunkz.github.io/">Home</a>&nbsp;Â»&nbsp;<a href="https://jedipunkz.github.io/post/">Posts</a></div>
    <h1 class="post-title">
      Sysdig&#43;ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ
    </h1>
    <div class="post-description">
      ECS Fargate ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ Sysdig ã§å®Ÿç¾ã€‚ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãŸ CWPP ã«ã‚ˆã‚‹è„…å¨æ¤œçŸ¥ã¨é€šçŸ¥ã®æ–¹æ³•ã‚’è§£èª¬
    </div>
    
  </header> 
  <div class="post-content"><p>ã“ã‚“ã«ã¡ã¯ <a href="https://twitter.com/jedipunkz">@jedipunkz</a> ğŸš€ ã§ã™ã€‚</p>
<p>ECS æ§‹æˆã‚’ã‚‚ã†å°‘ã—ã‚»ã‚­ãƒ¥ã‚¢ã«ä¿ã¦ã‚‹æ§‹æˆã¯ãªã„ã‚‚ã®ã ã‚ã†ã‹ã¨æ¨¡ç´¢ã—ã¦ã„ã‚‹ãªã‹ã§ Sysdig ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚ã¾ã å°å…¥ã§ãã‚‹ç›®å‡¦ã¯ç«‹ã£ã¦ã„ãªã„ã®ã§ã™ãŒã‚ã‚‹ç¨‹åº¦ãƒã‚¦ãƒã‚¦è“„ç©å‡ºæ¥ã¦ããŸã®ã§ã“ã“ã§æ¤œè¨¼å†…å®¹ç­‰ã‚’è¨˜äº‹ã«ã—ã‚ˆã†ã‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚</p>
<p>Sysdig ã¯å¹¾ã¤ã‹ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒå­˜åœ¨ã™ã‚‹ã®ã§ã™ãŒä»Šå›æ¤œè¨¼ã—ãŸã®ã¯ Sysdig Serverless Security ã¨å‘¼ã°ã‚Œã‚‹ãƒ¢ãƒã§ ECS Fargate ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å®Ÿè·µã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚</p>
<h2 id="sysdig-ã¨ã¯">Sysdig ã¨ã¯<a hidden class="anchor" aria-hidden="true" href="#sysdig-ã¨ã¯">#</a></h2>
<p>AWS ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚‚è„…å¨æ¤œçŸ¥ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãŒæƒã£ã¦ã„ã‚‹ã®ã¯ã”å­˜çŸ¥ã¨æ€ã„ã¾ã™</p>
<table>
  <thead>
      <tr>
          <th>å¯¾è±¡</th>
          <th>ç›®çš„</th>
          <th>æŠ€è¡“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>AWS ãƒªã‚½ãƒ¼ã‚¹</td>
          <td>é©šç•°æ¤œçŸ¥</td>
          <td>AWS GuardDuty</td>
      </tr>
  </tbody>
</table>
<p>ã¾ãŸäºˆé˜²ã®è¦³ç‚¹ã§è„†å¼±æ€§è¨ºæ–­ãŒå‡ºæ¥ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚‚ã‚ã‚Šã‚ã™</p>
<table>
  <thead>
      <tr>
          <th>å¯¾è±¡</th>
          <th>ç›®çš„</th>
          <th>æŠ€è¡“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>AWS ãƒªã‚½ãƒ¼ã‚¹</td>
          <td>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨ºæ–­</td>
          <td>AWS Trusted Advisor</td>
      </tr>
      <tr>
          <td>ECS ã‚³ãƒ³ãƒ†ãƒŠ</td>
          <td>è„†å¼±æ€§è¨ºæ–­</td>
          <td>ECR Image Scan</td>
      </tr>
      <tr>
          <td>EC2 ä¸Šã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢</td>
          <td>è„†å¼±æ€§è¨ºæ–­</td>
          <td>AWS Inspector</td>
      </tr>
  </tbody>
</table>
<p>ã“ã“ã§æ°—ãŒã¤ãã¨æ€ã†ã®ã§ã™ãŒã‚³ãƒ³ãƒ†ãƒŠä¸Šã®é©šç•°æ¤œçŸ¥ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹ãŒ AWS ã«ã¯ç„¡ã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ (2022/09 æ™‚ç‚¹)</p>
<p>Sysdig Serverless Security ã¯ ECS Fargate ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨æ¤œçŸ¥ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ECS Fargate åˆ©ç”¨æ™‚ã«ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨æ¤œçŸ¥ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹ã¯ä»–ã«ã‚‚å¹¾ã¤ã‹ã‚ã‚Šã¾ã™ãŒã€Sysdig ã¯ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãŸã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å®Ÿè·µã—ã¦è„…å¨æ¤œçŸ¥ãƒ»é€šçŸ¥ãŒè¡Œãˆã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚è‡ªåˆ†ã‚‚è©³ã—ããªã„ã®ã§ã™ãŒã“ã‚Œã‚’ CWPP (Cloud Workload Protection Platform) ã¨è¨€ã†ã‚‰ã—ã„ã§ã™ã€‚ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã¨ã„ã†ã®ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã®ä»®æƒ³ãƒã‚·ãƒ³ãƒ»ç¨¼åƒä¸­ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’æŒ‡ã—ã¦ã€CWPP ã¯ãƒãƒ«ã‚¦ã‚§ã‚¢ä¿è­·ã€è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã€ç•°å¸¸æ¤œçŸ¥ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ãã‚Œãã‚Œã®ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚’ä¿è­·ã™ã‚‹ã€ã¨ã„ã†ã“ã¨ã‚‰ã—ã„ã§ã™ã€‚</p>
<h3 id="sysdig-ä»¥å¤–ã®-cwpp-ã¯ã©ã†ã„ã†ã‚‚ã®ãŒã‚ã‚‹ã®ã‹">Sysdig ä»¥å¤–ã® CWPP ã¯ã©ã†ã„ã†ã‚‚ã®ãŒã‚ã‚‹ã®ã‹?<a hidden class="anchor" aria-hidden="true" href="#sysdig-ä»¥å¤–ã®-cwpp-ã¯ã©ã†ã„ã†ã‚‚ã®ãŒã‚ã‚‹ã®ã‹">#</a></h3>
<p>Sysdig ä»¥å¤–ã§ã™ã¨ä»£è¡¨ã™ã‚‹ã‚‚ã®ãŒä¸‹è¨˜ã«ãªã‚‹ãã†ã§ã™ã€‚</p>
<ul>
<li><a href="https://www.datadoghq.com/ja/blog/tag/cwpp/">Datadog</a></li>
<li><a href="https://www.creationline.com/aqua/cwpp">Aqua CWWP</a></li>
<li><a href="https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin-compute/runtime_defense/fargate">Palo Alto Prisma</a></li>
</ul>
<h3 id="sysdig-ã‚’ã‚‚ã†å°‘ã—å…·ä½“çš„ã«èª¬æ˜">Sysdig ã‚’ã‚‚ã†å°‘ã—å…·ä½“çš„ã«èª¬æ˜<a hidden class="anchor" aria-hidden="true" href="#sysdig-ã‚’ã‚‚ã†å°‘ã—å…·ä½“çš„ã«èª¬æ˜">#</a></h3>
<p>Sysdig ã¯ CNCF ã® <a href="https://falco.org/ja/">Falco</a> ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦è„…å¨æ¤œå‡ºã‚’è¡Œã†ãŸã‚ã® SaaS ã‚’å«ã‚ãŸã‚·ã‚¹ãƒ†ãƒ ã¨ãªã‚Šã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨ã¨å…±ã«ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç´ä»˜ã‘ã‚‹ã“ã¨ã§ã‚¯ãƒ©ã‚¦ãƒ‰è‡ªä½“ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚ãŸã¨ãˆã°å•é¡Œã®ã‚ã‚‹ S3 ãƒã‚±ãƒƒãƒˆå…¬é–‹è¨­å®šã‚„ã€IAM ã®æ¨©é™ã«é–¢ã™ã‚‹ã‚‚ã®ãªã©ã€‚ä»Šå›è‡ªåˆ†ã¯å‰è€…ã®ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨æ¤œçŸ¥ã«ã¤ã„ã¦èª¿ã¹ã¾ã—ãŸã®ã§ã€ã“ã®è¨˜äº‹ã§ã‚‚ãã‚Œã«ã¤ã„ã¦è¨˜ãã†ã¨æ€ã„ã¾ã™ã€‚</p>
<h3 id="ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹<a hidden class="anchor" aria-hidden="true" href="#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹">#</a></h3>
<p>ãƒ™ãƒ¼ã‚¹ã¨ãªã£ã¦ã„ã‚‹ Falco ã§ã¯ Linux ã‚«ãƒ¼ãƒãƒ«ã® ptrace ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’ç”¨ã„ã¦è„…å¨æ¤œçŸ¥ (ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ãã‚„ãƒ‡ã‚£ã‚¹ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¢ºç«‹ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‡ãƒ¼ã‚¿é€å—ä¿¡ãªã©ã«ã¤ã„ã¦) ã—ã¾ã™ã€‚ã§ã™ãŒ ptrace ã¯ã‚³ãƒ³ãƒ†ãƒŠã®æœ¬æ¥ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«çµæ§‹ãªå½±éŸ¿ãŒã‚ã‚‹ãã†ã§ã™ã€‚ãã‚Œã«æ¯”è¼ƒã—ã¦ Sysdig ã¯ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å®Ÿè£…ã—ã¦ã„ãªã„ã‚³ãƒ³ãƒ†ãƒŠã¨ã»ã¼åŒç­‰ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå‡ºã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚</p>
<p>å‚è€ƒè³‡æ–™: <a href="https://sysdig.com/blog/aws-fargate-runtime-security-ptrace-ld_preload/">Sysdig Blog</a></p>
<p><img alt="Sysdig ã¨ ptrace ã¨ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ" loading="lazy" src="../../pix/sysdig-performance.png"></p>
<h2 id="sysdig--ecs-fargate-ã®æ§‹æˆ">Sysdig + ECS Fargate ã®æ§‹æˆ<a hidden class="anchor" aria-hidden="true" href="#sysdig--ecs-fargate-ã®æ§‹æˆ">#</a></h2>
<p>ã“ã“ã‹ã‚‰å…·ä½“çš„ã«æ¤œè¨¼ã—ãŸå†…å®¹ã‚’è¨˜ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚</p>
<p>è‡ªåˆ†ã¯ ECS Fargate ã‚’ç”¨ã„ãŸ Sysdig åˆ©ç”¨ã‚’å‰æã«ã—ã¦æ§‹æˆã‚’çµ„ã¿ã¾ã—ãŸã€‚</p>
<p>æ§‹æˆã®ç‰¹å¾´ã¨ã—ã¦ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚</p>
<ul>
<li>2ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆ
<ul>
<li>Sysdig ã‚µãƒ¼ãƒãƒ¬ã‚¹ãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</li>
<li>Sysdig ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒ»ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</li>
</ul>
</li>
<li>2ã¤ã¨ã‚‚ ECS Fargate ä¸Šã«èµ·å‹•</li>
<li>ã‚¿ã‚¹ã‚¯å®šç¾©æ¯ã«ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒèµ·å‹•ã—ãƒ—ãƒ­ã‚­ã‚·çš„ã«å‹•ä½œã™ã‚‹ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨é€šä¿¡</li>
<li>ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã—ã¦ Sysdig ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¸è»¢é€ã™ã‚‹å½¹å‰²</li>
</ul>
<p>ä¸‹è¨˜ãŒæ§‹æˆå›³ã«ãªã‚Šã¾ã™ã€‚</p>
<p>å‚è€ƒ: <a href="https://docs.sysdig.com/en/docs/installation/serverless-agents/aws-fargate-serverless-agents/">https://docs.sysdig.com/en/docs/installation/serverless-agents/aws-fargate-serverless-agents/</a>
<img alt="Sysdig æ§‹æˆ" loading="lazy" src="../../pix/sysdig-arch.jpeg"></p>
<h2 id="æ§‹ç¯‰">æ§‹ç¯‰<a hidden class="anchor" aria-hidden="true" href="#æ§‹ç¯‰">#</a></h2>
<h3 id="sysdig-region-æƒ…å ±">Sysdig Region æƒ…å ±<a hidden class="anchor" aria-hidden="true" href="#sysdig-region-æƒ…å ±">#</a></h3>
<p>ä¸‹è¨˜ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã‚‹é€šã‚Š Sysdig ã«ã¯åˆ©ç”¨è€…ãŒæ„è­˜ã™ã¹ã Region ã¨ã„ã†æ¦‚å¿µãŒã‚ã‚Šã¾ã™ã€‚ã©ã® Region ã‚’ç”¨ã„ã‚‹ã‹æ±ºå®šã—ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæƒ…å ±ã‚’æ§‹ç¯‰ã®äº‹å‰ã«åé›†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
<ul>
<li>å‚è€ƒ: <a href="https://docs.sysdig.com/en/docs/administration/saas-regions-and-ip-ranges">https://docs.sysdig.com/en/docs/administration/saas-regions-and-ip-ranges</a></li>
</ul>
<h3 id="sysdig-ã‚µãƒ¼ãƒãƒ¬ã‚¹ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ§‹ç¯‰">Sysdig ã‚µãƒ¼ãƒãƒ¬ã‚¹ãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ§‹ç¯‰<a hidden class="anchor" aria-hidden="true" href="#sysdig-ã‚µãƒ¼ãƒãƒ¬ã‚¹ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ§‹ç¯‰">#</a></h3>
<p>ä¸‹è¨˜ã® Sysdig å…¬å¼ã® Terraform Module ã‚’ç”¨ã„ã‚‹äº‹ã§æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚</p>
<ul>
<li>å‚è€ƒ: <a href="https://github.com/sysdiglabs/terraform-aws-fargate-orchestrator-agent">https://github.com/sysdiglabs/terraform-aws-fargate-orchestrator-agent</a></li>
</ul>
<p>ä¸‹è¨˜ãŒæ¤œè¨¼ç›®çš„ã§ä½œæˆã—ãŸ Terraform ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">module</span> <span class="s2">&#34;sysdig_orchestrator_agent&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  source</span>  <span class="o">=</span> <span class="s2">&#34;sysdiglabs/fargate-orchestrator-agent/aws&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  version</span> <span class="o">=</span> <span class="s2">&#34;0.2.0&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">  name</span> <span class="o">=</span> <span class="s2">&#34;example-sysdigorchestrator&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">  vpc_id</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vpc_id</span>
</span></span><span class="line"><span class="cl"><span class="n">  subnets</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="k">aws_subnet</span><span class="p">.</span><span class="k">example1</span><span class="p">.</span><span class="k">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">aws_subnet</span><span class="p">.</span><span class="k">example2</span><span class="p">.</span><span class="k">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">  access_key</span>       <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">my_sysdig_access_key</span>
</span></span><span class="line"><span class="cl"><span class="n">  collector_host</span>   <span class="o">=</span> <span class="s2">&#34;ingest-us2.app.sysdig.com&#34;</span><span class="c1"> # å®šã‚ãŸãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚³ãƒ¬ã‚¯ã‚¿ãƒ›ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  collector_port</span>   <span class="o">=</span> <span class="s2">&#34;6443&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  agent_image</span>      <span class="o">=</span> <span class="s2">&#34;quay.io/sysdig/orchestrator-agent:latest&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  assign_public_ip</span> <span class="o">=</span> <span class="kt">false</span><span class="c1"> # Internet Gateway ã‚’ç”¨ã„ã‚‹å ´åˆã¯ true ã‚’æŒ‡å®š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>}
</span></span></code></pre></div><h3 id="sysdig-ã‚µãƒ¼ãƒãƒ¬ã‚¹ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç››ã‚Šè¾¼ã‚“ã ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®æ§‹ç¯‰">Sysdig ã‚µãƒ¼ãƒãƒ¬ã‚¹ãƒ»ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç››ã‚Šè¾¼ã‚“ã ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®æ§‹ç¯‰<a hidden class="anchor" aria-hidden="true" href="#sysdig-ã‚µãƒ¼ãƒãƒ¬ã‚¹ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç››ã‚Šè¾¼ã‚“ã ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®æ§‹ç¯‰">#</a></h3>
<p>æ¤œè¨¼ã§ã¯ Sysdig å…¬å¼ã® Terraform Provider ã‚’ç”¨ã„ã¦ ECS ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãŸã€‚ä¸‹è¨˜ãŒãã®éš›ã®ã‚³ãƒ¼ãƒ‰ã¨ãªã‚Šã¾ã™ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">data</span> <span class="s2">&#34;sysdig_fargate_workload_agent&#34; &#34;sysdig&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  container_definitions</span> <span class="o">=</span> <span class="k">file</span><span class="p">(</span><span class="s2">&#34;container_definitions/sysdigapp.json&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">  sysdig_access_key</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">my_sysdig_access_key</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">  workload_agent_image</span> <span class="o">=</span> <span class="s2">&#34;quay.io/sysdig/workload-agent:latest&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">  orchestrator_host</span> <span class="o">=</span> <span class="k">module</span><span class="p">.</span><span class="k">sysdig_orchestrator_agent</span><span class="p">.</span><span class="k">orchestrator_host</span>
</span></span><span class="line"><span class="cl"><span class="n">  orchestrator_port</span> <span class="o">=</span> <span class="k">module</span><span class="p">.</span><span class="k">sysdig_orchestrator_agent</span><span class="p">.</span><span class="k">orchestrator_port</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;aws_ecs_task_definition&#34; &#34;sysdig&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  family</span>                   <span class="o">=</span> <span class="s2">&#34;example-sysdigapp-taskdef&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  cpu</span>                      <span class="o">=</span> <span class="s2">&#34;2048&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  memory</span>                   <span class="o">=</span> <span class="s2">&#34;8192&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  network_mode</span>             <span class="o">=</span> <span class="s2">&#34;awsvpc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  requires_compatibilities</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;FARGATE&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">  execution_role_arn</span>       <span class="o">=</span> <span class="k">aws_iam_role</span><span class="p">.</span><span class="k">task_exec</span><span class="p">.</span><span class="k">arn</span>
</span></span><span class="line"><span class="cl"><span class="n">  task_role_arn</span>            <span class="o">=</span> <span class="k">aws_iam_role</span><span class="p">.</span><span class="k">task</span><span class="p">.</span><span class="k">arn</span>
</span></span><span class="line"><span class="cl"><span class="n">  container_definitions</span>    <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">sysdig_fargate_workload_agent</span><span class="p">.</span><span class="k">sysdig</span><span class="p">.</span><span class="k">output_container_definitions</span>
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>å°šã€Sysdig Provider ã‚’ç”¨ã„ã¦ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦ã„ã¾ã™ãŒã€æ‰‹å‹•ã§ã‚‚ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’è¨˜ã™ã“ã¨ãŒå¯èƒ½ã ãã†ã§ã™ã€‚ãã®éš›ã«ã¯ä¸‹è¨˜ã®å‡¦ç†ã‚’ã‚¿ã‚¹ã‚¯å®šç¾©ã«æ–½ã™ã“ã¨ã§è¦ä»¶ã‚’æº€ãŸã›ã‚‹ãã†ã§ã™ã€‚</p>
<ul>
<li>Sysdig ã«é–¢ã™ã‚‹ç’°å¢ƒå¤‰æ•°</li>
<li>Volume ãƒã‚¦ãƒ³ãƒˆæŒ‡å®š</li>
<li>capabilities æŒ‡å®š</li>
<li>Sysdig ã‚³ãƒ³ãƒ†ãƒŠæŒ‡å®š</li>
</ul>
<h3 id="æ§‹ç¯‰å¾Œã®-sysdig-ui-ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹">æ§‹ç¯‰å¾Œã® Sysdig UI ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹<a hidden class="anchor" aria-hidden="true" href="#æ§‹ç¯‰å¾Œã®-sysdig-ui-ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹">#</a></h3>
<p>æ§‹ç¯‰å¾Œã€(US-West ã‚’åˆ©ç”¨ã—ãŸå ´åˆã¯) ä¸‹è¨˜ã® URL ã§ Sysdig Secure UI ã«ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã¾ã™ã€‚</p>
<p><a href="https://us2.app.sysdig.com/secure/#/policies">https://us2.app.sysdig.com/secure/#/policies</a></p>
<h2 id="ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥">ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥<a hidden class="anchor" aria-hidden="true" href="#ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥">#</a></h2>
<h3 id="ãƒãƒªã‚·ãƒ¼ã®ç¨®åˆ¥">ãƒãƒªã‚·ãƒ¼ã®ç¨®åˆ¥<a hidden class="anchor" aria-hidden="true" href="#ãƒãƒªã‚·ãƒ¼ã®ç¨®åˆ¥">#</a></h3>
<p>ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥ã®ãŸã‚ã®ãƒãƒªã‚·ãƒ¼ãŒç”¨æ„ã•ã‚Œã¦ã„ã¦å¹¾ã¤ã‹ã‚ã‚‹ã®ã§ã™ãŒ ECS Fargate ã¨ã„ã†æ¡ä»¶ã§ã‚ã‚Œã°ä¸‹è¨˜ã®2ã¤ã®åˆ©ç”¨ãŒå¯èƒ½ã ãã†ã§ã™ã€‚</p>
<ul>
<li>Workload Policy (Powered By Falco)</li>
<li>List Maching Policy</li>
</ul>
<p>ä¸‹è¨˜ã¯ Kubernetes å‰æã ãã†ã§ã™ã€‚</p>
<ul>
<li>Container Drift Policy</li>
<li>Machine Learning Policy</li>
</ul>
<p>ä¸‹è¨˜ã¯ã‚³ãƒ³ãƒ†ãƒŠã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã¯åˆ¥æ  Policy ã§å‰è¿°ã—ãŸã‚¯ãƒ©ã‚¦ãƒ‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ Sysdig ã«ç´ä»˜ã‘ãŸéš›ã«åˆ©ç”¨ã§ãã‚‹ãƒãƒªã‚·ãƒ¼ã§ã™ã€‚</p>
<ul>
<li>Kubernetes Audit Policy</li>
<li>AWS CloudTrail Policy</li>
<li>GCP Audit Log Policy</li>
<li>Azure Platform Log Policy</li>
</ul>
<h3 id="list-maching-policy-ã«ãŠã‘ã‚‹">List Maching Policy ã«ãŠã‘ã‚‹<a hidden class="anchor" aria-hidden="true" href="#list-maching-policy-ã«ãŠã‘ã‚‹">#</a></h3>
<h4 id="ç‰¹å®šãƒãƒ¼ãƒˆã®ãƒªã‚¹ãƒ³æ¤œçŸ¥">ç‰¹å®šãƒãƒ¼ãƒˆã®ãƒªã‚¹ãƒ³æ¤œçŸ¥<a hidden class="anchor" aria-hidden="true" href="#ç‰¹å®šãƒãƒ¼ãƒˆã®ãƒªã‚¹ãƒ³æ¤œçŸ¥">#</a></h4>
<p>ä¸‹è¨˜ã® Rule ã‚’ä½œæˆã—ã¦ Policy ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã§ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥å‡ºæ¥ã¾ã™ã€‚ ã¾ãŸ Policy ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦ kill, stop, pause, nothing(notify only) ãŒé¸ã¹ã¾ã™ã€‚è„…å¨ã‚’æ¤œçŸ¥ã—ãŸéš›ã«ãƒ—ãƒ­ã‚»ã‚¹ã®åœæ­¢ãªã©ãŒè¡Œãˆã‚‹ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚</p>
<table>
  <thead>
      <tr>
          <th>è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å</th>
          <th>å€¤</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>allInbounds</td>
          <td>Deny</td>
      </tr>
      <tr>
          <td>allOutbounds</td>
          <td>Deny</td>
      </tr>
      <tr>
          <td>udpListenPortsMatchItems</td>
          <td>true</td>
      </tr>
      <tr>
          <td>tcpListenPortsMatchItems</td>
          <td>true</td>
      </tr>
      <tr>
          <td>udpListenPorts</td>
          <td>8080</td>
      </tr>
      <tr>
          <td>tcpListenPorts</td>
          <td>8080</td>
      </tr>
  </tbody>
</table>
<h4 id="ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿æ¤œçŸ¥">ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿æ¤œçŸ¥<a hidden class="anchor" aria-hidden="true" href="#ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿æ¤œçŸ¥">#</a></h4>
<p>ä¸‹è¨˜ã® Rule ã‚’ä½œæˆã—ã¦ Policy ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã§ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥å‡ºæ¥ã¾ã™ã€‚
ã¾ãŸåŒæ§˜ã« Policy ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦ kill, stop, pause, nothing(notify only) ãŒé¸ã¹ã¾ã™ã€‚</p>
<table>
  <thead>
      <tr>
          <th>è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å</th>
          <th>å€¤</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>readPathsMatchItems</td>
          <td>true</td>
      </tr>
      <tr>
          <td>readPaths</td>
          <td>&lt;ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹&gt;</td>
      </tr>
      <tr>
          <td>readWritePathsMatchItems</td>
          <td>false</td>
      </tr>
  </tbody>
</table>
<h3 id="workload-policy">Workload Policy<a hidden class="anchor" aria-hidden="true" href="#workload-policy">#</a></h3>
<h4 id="ç‰¹å®šãƒ—ãƒ­ã‚»ã‚¹ã®èµ·å‹•">ç‰¹å®šãƒ—ãƒ­ã‚»ã‚¹ã®èµ·å‹•<a hidden class="anchor" aria-hidden="true" href="#ç‰¹å®šãƒ—ãƒ­ã‚»ã‚¹ã®èµ·å‹•">#</a></h4>
<p>ä¸‹è¨˜ã® Rule ã‚’ä½œæˆã—ã¦ Policy ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã§ç‰¹å®šã®ãƒ—ãƒ­ã‚»ã‚¹ãŒç‰¹å®šã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”¨ã„ã¦èµ·å‹•ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’æ¤œçŸ¥å‡ºæ¥ã¾ã™ã€‚</p>
<table>
  <thead>
      <tr>
          <th>è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å</th>
          <th>å€¤</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>condition</td>
          <td>user.name = &ldquo;nginx&rdquo; and proc.name = &ldquo;nginx&rdquo;</td>
      </tr>
      <tr>
          <td>output</td>
          <td>ä»»æ„ã®æƒ…å ±ã‚’å‡ºåŠ›</td>
      </tr>
  </tbody>
</table>
<p>å‹•ä½œç¢ºèªã—ãŸéš›ã® system call ã®æƒ…å ±ã¯ä¸‹è¨˜ã«ãªã‚‹ã®ã§ã“ã‚Œã‚‰ã‚’ <code>condition</code> ã«è¨˜ã›ã°æ¤œçŸ¥ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚</p>
<blockquote>
<p>(user.name=nginx user.loginuid=-1 proc.cmdline=nginx container.id=1e2a2f03e1934a719d98c45276ea57eb-265927825 container_name=web evt.type=accept evt.res=<NA> proc.pid=76 proc.cwd=/ proc.ppid=39 proc.pcmdline=nginx -g daemon off; proc.sid=15 proc.exepath=/usr/sbin/nginx user.uid=101 user.loginname=<NA> group.gid=101 group.name=nginx container.name=web image=nginx:latest)</p></blockquote>
<h3 id="ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹çš„ãª-policy-è¨­å®š">ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹çš„ãª Policy è¨­å®š<a hidden class="anchor" aria-hidden="true" href="#ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹çš„ãª-policy-è¨­å®š">#</a></h3>
<p>ä¸Šè¨˜ã®ã‚ˆã†ã«å€‹åˆ¥ã« Policy, Rule ã‚’å®šç¾©ã—ã¦ã‚‚ã€æ¼ã‚ŒãŒç™ºç”Ÿãƒ»æƒ³å®šå¤–ãŒç™ºç”Ÿã™ã‚‹ã®ã§ã€Sysdig ãŒ Managed Rules, Policies ã‚’ç”¨æ„ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚å°‘ãªãã¨ã‚‚ä¸‹è¨˜ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã“ã¨ã§å¤§æŠµã®è„…å¨æ¤œçŸ¥ã¯å¯èƒ½ã ãã†ã§ã™ã€‚</p>
<p>Sysdig Runtime Threat Detection (Workload Policy)</p>
<blockquote>
<p>This policy contains rules which Sysdig considers High Confidence of a security incident. They are tightly coupled to common attacker TTP&rsquo;s. They have been designed to minimize false positives but may still result in some depending on your environment.</p></blockquote>
<p>Sysdig Runtime Threat Intelligence (Workload Policy)</p>
<blockquote>
<p>This policy contains rules using Indicators of Compromise curated by the Sysdig Threat Intelligence Team from premium, OSINT, and custom threat intelligence feeds. Any events from the rules in this policy should be considered serious and investigated as soon as possible.</p></blockquote>
<p>Sysdig Runtime Notable Events (Workload Policy)</p>
<blockquote>
<p>This Notable Events policy contains rules which may indicate undesired behavior including security threats. The rules are more generalized than Threat Detection policies and may result in more noise. Tuning will likely be required for the events generated from this policy.</p></blockquote>
<h2 id="ã‚³ã‚¹ãƒˆ">ã‚³ã‚¹ãƒˆ<a hidden class="anchor" aria-hidden="true" href="#ã‚³ã‚¹ãƒˆ">#</a></h2>
<p><a href="https://aws.amazon.com/marketplace/pp/prodview-dq475uhgg4o6g?sr=0-4&amp;ref_=beagle&amp;applicationId=AWSMPContessa">AWS Marketplae</a> ã« <code>Sysdig Secure DevOps Platform</code> ãŒã‚ã‚Šã€Pricing ãŒè¨˜è¼‰ã‚ã‚Šã¾ã—ãŸã€‚</p>
<table>
  <thead>
      <tr>
          <th>ãƒ—ãƒ©ãƒ³å</th>
          <th>1ãƒ¶æœˆã‚³ã‚¹ãƒˆ</th>
          <th>1å¹´é–“ã‚³ã‚¹ãƒˆ</th>
          <th>èª¬æ˜</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Secure Cloud Security</td>
          <td>$500</td>
          <td>$5,000</td>
          <td>CloudTrail é€£æºãªã©</td>
      </tr>
      <tr>
          <td>Secure Enterprise CaaS</td>
          <td>$12/task</td>
          <td>$120/task</td>
          <td>Container Runtime Security</td>
      </tr>
  </tbody>
</table>
<h2 id="ã¾ã¨ã‚">ã¾ã¨ã‚<a hidden class="anchor" aria-hidden="true" href="#ã¾ã¨ã‚">#</a></h2>
<p>Terraform Sysdig Provider ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€è‡ªåˆ†ãŸã¡ã®ç’°å¢ƒã«å–ã£ä»˜ãæ˜“ã„æ§‹ç¯‰æ–¹æ³•ã‚’å–ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ Module ã‚’ä½¿ãˆã°ç°¡å˜ã«æ§‹ç¯‰å¯èƒ½ã€‚å¤–éƒ¨ã¨é€šä¿¡ã•ã›ã‚‹ã®ã§ã™ãŒ VPC å†…éƒ¨ã«ç½®ãã“ã¨ã‚‚å¯èƒ½ã€‚ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚ Terraform ã§å®¹æ˜“ã«æ§‹ç¯‰å¯èƒ½ã€‚ã‚¿ã‚¹ã‚¯å®šç¾©ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ Terraform ä»¥å¤–ã®æŠ€è¡“ã‚’ä½¿ã£ã¦è¡Œã£ã¦ã„ã‚‹å ´åˆã§ã‚‚4ã¤ã»ã©ã®è¦ä»¶ã‚’äºˆã‚æº€ãŸã—ã¦ãŠã‘ã°æ¯”è¼ƒçš„ç°¡å˜ã« Sysdig ã‚’é©ç”¨ã—ãŸã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•å¯èƒ½ã§ã™ã€‚ä»Šå›ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯æ¸¬å®šå‡ºæ¥ã¦ã„ã¾ã›ã‚“ãŒã€å…¬å¼ãƒ–ãƒ­ã‚°ã®æƒ…å ±ã‚’ä¿¡ã˜ã‚‹ã¨ ptrace ã«æ¯”ã¹ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ã¯æ°—ã«ã™ã‚‹å¿…è¦ãªããªã‚Šãã†ã§ã™ã€‚ã“ã“ã¯æœ‰å„Ÿç‰ˆã ãªã¨ã„ã†å°è±¡ã€‚</p>
<p>ã¾ãŸã€æ§‹ç¯‰ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ (ä¾‹ã§ Nginx) ã®ä¸­ã‚’é™¤ã„ã¦ã¿ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚»ã‚¹ãŒç¨¼åƒã—ã¦ã„ã¾ã—ãŸã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># ps auxf (ä¸€åˆ†æƒ…å ±ã‚’æŠœç²‹)</span>
</span></span><span class="line"><span class="cl">/dev/init -- /opt/draios/bin/instrument /docker-entrypoint.sh nginx -g daemon off<span class="p">;</span>
</span></span><span class="line"><span class="cl">/opt/draios/bin/instrument /docker-entrypoint.sh nginx -g daemon off<span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="se">\_</span> /opt/draios/bin/agentino --name<span class="o">=</span>ip-10-0-65-79.ap-northeast-1.compute.internal --aws-account-id<span class="o">=</span><span class="m">395127550274</span> --aws-region<span class="o">=</span>ap-north
</span></span><span class="line"><span class="cl">east-1 --aws-az<span class="o">=</span>ap-northeast-1a --aws-fargate-cluster-arn<span class="o">=</span>arn
</span></span><span class="line"><span class="cl"> <span class="se">\_</span> /opt/draios/bin/pdig -C -t -1 -l /opt/draios/bin/libudigembed.so /docker-entrypoint.sh nginx -g daemon off<span class="p">;</span>
</span></span><span class="line"><span class="cl">     <span class="se">\_</span> nginx: master process nginx -g daemon off<span class="p">;</span>
</span></span><span class="line"><span class="cl">         <span class="se">\_</span> nginx: worker process
</span></span><span class="line"><span class="cl">         <span class="se">\_</span> nginx: worker process
</span></span><span class="line"><span class="cl">&lt;snip&gt;
</span></span></code></pre></div><p>ã‚³ãƒ³ãƒ†ãƒŠãƒ—ãƒ­ã‚»ã‚¹ãŒ <code>/opt/draios/bin/instrument</code> ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã«æ¸¡ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚æ›´ã«ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã§èµ·å‹•ã—ã¦ã„ã‚‹ Instrument ã‚³ãƒ³ãƒ†ãƒŠã®ãƒœãƒªãƒ¥ãƒ¼ãƒ é ˜åŸŸã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠãŒãƒã‚¦ãƒ³ãƒˆã—ã¦ã„ã‚‹ã®ãŒåˆ¤ã‚Šã¾ã—ãŸã€‚</p>
<p>ã¾ãŸã€æ³¨æ„ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚ECS Exec ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥ã®å‹•ä½œç¢ºèªã¨ã—ã¦ã®æ“ä½œã‚’è¡Œã£ã¦ã‚‚æ¤œçŸ¥ã—ã¦ãã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚Policy ã‚’ç‹¬è‡ªã«ä½œæˆã—ãŸéš›ã«ä¸ä¾¿ãªã®ã§ã™ãŒã€å‹•ä½œç¢ºèªã®ãŸã‚ã«ã¯ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§ sshd ã‚’èµ·å‹•ã™ã‚‹ã‹ã€ã‚¿ã‚¹ã‚¯å®šç¾©ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆæŒ‡å®šã‚’æ›¸ãæ›ãˆã¦è¡Œã†å¿…è¦ãŒã‚ã‚‹ãã†ã§ã™ã€‚ãŸã ã€Sysdig ç¤¾ã§ã‚‚ ECS Exec ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸéš›ã®æ“ä½œã«é–¢ã—ã¦ã‚‚æ¤œçŸ¥ç¯„å›²ã«ã™ã‚‹ãŸã‚ã®é–‹ç™ºã‚’äºˆå®šã—ã¦ã„ã‚‹ãã†ã§ã™ã€‚ECS Exec ã¯ IAM ã®æ¨©é™ãŒã‚ã‚Œã°ãƒ­ã‚°ã‚¤ãƒ³å‡ºæ¥ã¦ã—ã¾ã†ã‚‚ã®ã§ã€æ¯”è¼ƒçš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«ã¯æ°—ã‚’ä½¿ã†æ©Ÿèƒ½ã ã¨æ€ã£ã¦ã„ã‚‹ã®ã§ Sysdig ã§ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®æ“ä½œã‚’æ¤œçŸ¥å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã¯åŠ©ã‹ã‚Šã¾ã™ã—ã€æœŸå¾…ã—ãŸã„ã¨ã“ã‚ã§ã™ã€‚</p>


  </div>

  <footer class="post-footer">
<nav class="paginav">
  <a class="prev" href="https://jedipunkz.github.io/post/esp/">
    <span class="title">Â« Prev</span>
    <br>
    <span>è‡ªå‰ãƒ„ãƒ¼ãƒ«ã¨ Cloudwatch é«˜è§£åƒåº¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ä½¿ã£ãŸã‚ˆã‚Šé«˜é€Ÿãª ECS ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«ã®å®Ÿç¾</span>
  </a>
  <a class="next" href="https://jedipunkz.github.io/post/ecs-pipecd/">
    <span class="title">Next Â»</span>
    <br>
    <span>ECS &#43; PipeCD &#43; Datadog ã§ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼ã‚’å®Ÿç¾</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sysdig&#43;ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ on x"
            href="https://x.com/intent/tweet/?text=Sysdig%2bECS%20Fargate%20%e3%81%a7%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e3%83%a9%e3%83%b3%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e5%ae%9f%e8%b7%b5&amp;url=https%3a%2f%2fjedipunkz.github.io%2fpost%2fsysdig-ecs-fargate%2f&amp;hashtags=">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sysdig&#43;ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fjedipunkz.github.io%2fpost%2fsysdig-ecs-fargate%2f&amp;title=Sysdig%2bECS%20Fargate%20%e3%81%a7%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e3%83%a9%e3%83%b3%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e5%ae%9f%e8%b7%b5&amp;summary=Sysdig%2bECS%20Fargate%20%e3%81%a7%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e3%83%a9%e3%83%b3%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e5%ae%9f%e8%b7%b5&amp;source=https%3a%2f%2fjedipunkz.github.io%2fpost%2fsysdig-ecs-fargate%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sysdig&#43;ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fjedipunkz.github.io%2fpost%2fsysdig-ecs-fargate%2f&title=Sysdig%2bECS%20Fargate%20%e3%81%a7%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e3%83%a9%e3%83%b3%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e5%ae%9f%e8%b7%b5">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sysdig&#43;ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fjedipunkz.github.io%2fpost%2fsysdig-ecs-fargate%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sysdig&#43;ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ on whatsapp"
            href="https://api.whatsapp.com/send?text=Sysdig%2bECS%20Fargate%20%e3%81%a7%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e3%83%a9%e3%83%b3%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e5%ae%9f%e8%b7%b5%20-%20https%3a%2f%2fjedipunkz.github.io%2fpost%2fsysdig-ecs-fargate%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sysdig&#43;ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ on telegram"
            href="https://telegram.me/share/url?text=Sysdig%2bECS%20Fargate%20%e3%81%a7%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e3%83%a9%e3%83%b3%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e5%ae%9f%e8%b7%b5&amp;url=https%3a%2f%2fjedipunkz.github.io%2fpost%2fsysdig-ecs-fargate%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sysdig&#43;ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Sysdig%2bECS%20Fargate%20%e3%81%a7%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e3%83%a9%e3%83%b3%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e5%ae%9f%e8%b7%b5&u=https%3a%2f%2fjedipunkz.github.io%2fpost%2fsysdig-ecs-fargate%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://jedipunkz.github.io/">jedipunkz ğŸš€ ã®ãƒ–ãƒ­ã‚°</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

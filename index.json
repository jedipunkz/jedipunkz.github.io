[{"content":"ã“ã‚“ã«ã¡ã¯ã€‚jedipunkzğŸš€ ã§ã™ã€‚\nTerraform ã‚’é‹ç”¨ã—ã¦ã„ã‚‹ã¨ãŸã¾ã« Plan çµæœãŒã©ã†ã—ã¦ã‚‚å‡ºã¦ã—ã¾ã†äº‹ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸ Terraform ã‚’ GitHub ã§å®Ÿè¡Œã™ã‚‹ç’°å¢ƒã‚’é‹ç”¨ã—ã¦ã„ã‚‹ã¨ Plan çµæœã‚’ã†ã¾ãæ‰±ã£ã¦è‡ªå‹•åŒ–ã—ãŸã„ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚æ¹§ã„ã¦ãã¾ã™ã€‚ã“ã®å ´åˆã« Plan ã®å·®åˆ†ã‚’ã†ã¾ãå‡¦ç†ã—ã¦ãã‚Œã‚‹ GitHub Action ãŒã‚ã‚Œã°ãªã¨æ€ã£ã¦ä½œã£ã¦ã¿ã¾ã—ãŸã€‚\nGitHub Actions ä½œæˆã—ãŸ GitHub Action ã¯ä¸‹è¨˜ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚\nhttps://github.com/jedipunkz/tf-plan-parser\nå…¥åŠ›ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š ã“ã® GitHub Action ã§ã¯2ã¤ã®å…¥åŠ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒåˆ©ç”¨å¯èƒ½ã§ã™ï¼š\nterraform-plan (å¿…é ˆ) ãƒ‘ãƒ¼ã‚¹å¯¾è±¡ã¨ãªã‚‹ Terraform Plan ã®å‡ºåŠ›çµæœã‚’æŒ‡å®šã—ã¾ã™ã€‚é€šå¸¸ã¯å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè¡Œã—ãŸ terraform plan ã‚³ãƒãƒ³ãƒ‰ã®æ¨™æº–å‡ºåŠ›ã‚’æ¸¡ã—ã¾ã™ã€‚\nignore-resources (ã‚ªãƒ—ã‚·ãƒ§ãƒ³) ç„¡è¦–ã—ãŸã„ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã‚„ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã‚’é…åˆ—å½¢å¼ã§æŒ‡å®šã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç©ºã®é…åˆ— [] ã§ã™ã€‚\næŒ‡å®šæ–¹æ³•ã®ä¾‹ï¼š\nãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—å…¨ä½“ã‚’ç„¡è¦–:\nignore-resources: \u0026#39;[\u0026#34;null_resource\u0026#34;, \u0026#34;local_file\u0026#34;]\u0026#39; ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç„¡è¦–:\nignore-resources: \u0026#39;[\u0026#34;null_resource.temporary\u0026#34;, \u0026#34;local_file.cache\u0026#34;]\u0026#39; ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æ··åœ¨:\nignore-resources: \u0026#39;[\u0026#34;null_resource\u0026#34;, \u0026#34;aws_s3_bucket.temp\u0026#34;, \u0026#34;local_file\u0026#34;]\u0026#39; å‡ºåŠ›ã•ã‚Œã‚‹æƒ…å ± ã“ã® Action ã¯ä»¥ä¸‹ã®å‡ºåŠ›ã‚’æä¾›ã—ã¾ã™ã€‚ã¾ãŸä¸‹è¨˜ã¯ ignore-resources ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æŒ‡å®šã«æ²¿ã£ã¦çµæœã‚’å‡ºåŠ›ã—ã¦ãã‚Œã¾ã™ã€‚\ndiff-bool: å¤‰æ›´ãŒã‚ã‚‹ã‹ã©ã†ã‹ã®çœŸå½å€¤ï¼ˆtrue ã¾ãŸã¯ falseï¼‰ diff-count: å¤‰æ›´ã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®æ•° diff-resources: å¤‰æ›´ã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ä¸€è¦§ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰ diff-raw: ç”Ÿã®å·®åˆ†ãƒ‡ãƒ¼ã‚¿ ã“ã‚Œã‚‰ã®å‡ºåŠ›ã‚’ä½¿ã£ã¦ã€å¾Œç¶šã®ã‚¹ãƒ†ãƒƒãƒ—ã§æ¡ä»¶åˆ†å²ã‚„é€šçŸ¥ã®åˆ¶å¾¡ãŒå¯èƒ½ã§ã™ã€‚\nä½¿ã„æ–¹ã®ä¾‹ åŸºæœ¬çš„ãªä½¿ã„æ–¹ - name: Terraform Plan id: plan run: terraform plan -no-color - name: Parse Plan id: parse uses: jedipunkz/tf-plan-parser@v1 with: terraform-plan: ${{ steps.plan.outputs.stdout }} ignore-resources: \u0026#39;[\u0026#34;null_resource\u0026#34;, \u0026#34;random_id\u0026#34;]\u0026#39; - name: Check results run: | echo \u0026#34;Changes detected: ${{ steps.parse.outputs.diff-bool }}\u0026#34; echo \u0026#34;Resource count: ${{ steps.parse.outputs.diff-count }}\u0026#34; Pull Request ã¸ã®è‡ªå‹•ã‚³ãƒ¡ãƒ³ãƒˆ - name: Terraform Plan id: plan run: terraform plan -out=tfplan -no-color - name: Parse Plan id: parse uses: jedipunkz/tf-plan-parser@v1 with: terraform-plan: ${{ steps.plan.outputs.stdout }} ignore-resources: \u0026#39;[\u0026#34;null_resource\u0026#34;, \u0026#34;local_file\u0026#34;]\u0026#39; - name: Comment on PR uses: actions/github-script@v7 with: script: | const diffBool = \u0026#39;${{ steps.parse.outputs.diff-bool }}\u0026#39;; const diffCount = \u0026#39;${{ steps.parse.outputs.diff-count }}\u0026#39;; const resources = JSON.parse(\u0026#39;${{ steps.parse.outputs.diff-resources }}\u0026#39;); const diffRaw = `${{ steps.parse.outputs.diff-raw }}`; let body = \u0026#39;## Terraform Plan Analysis\\n\\n\u0026#39;; // Summary if (diffBool === \u0026#39;true\u0026#39;) { body += `âœ… **Changes detected** affecting ${diffCount} resources:\\n\\n`; body += \u0026#39;### Changed Resources\\n```\\n\u0026#39;; for (const resource of resources) { body += `${resource}\\n`; } body += \u0026#39;```\\n\\n\u0026#39;; } else { body += \u0026#39;âœ… **No changes detected**\\n\\n\u0026#39;; } // All outputs body += \u0026#39;### Outputs\\n\u0026#39;; body += `- **diff-bool**: \\`${diffBool}\\`\\n`; body += `- **diff-count**: \\`${diffCount}\\`\\n`; body += `- **diff-resources**: \\`${JSON.stringify(resources)}\\`\\n\\n`; // Raw plan if (diffRaw \u0026amp;\u0026amp; diffRaw.trim()) { body += \u0026#39;### Raw Terraform Plan Output\\n\u0026#39;; body += \u0026#39;```\\n\u0026#39; + diffRaw + \u0026#39;\\n```\\n\\n\u0026#39;; } body += \u0026#39;---\\n*Generated by Terraform Plan Parser*\u0026#39;; github.rest.issues.createComment({ issue_number: context.issue.number, owner: context.repo.owner, repo: context.repo.repo, body: body }) æ¡ä»¶åˆ†å²ã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤åˆ¶å¾¡ - name: Terraform Plan id: plan run: terraform plan -out=tfplan -no-color - name: Parse Plan id: parse uses: jedipunkz/tf-plan-parser@v1 with: terraform-plan: ${{ steps.plan.outputs.stdout }} ignore-resources: \u0026#39;[\u0026#34;null_resource\u0026#34;, \u0026#34;random_id\u0026#34;, \u0026#34;local_file\u0026#34;]\u0026#39; - name: Skip deployment if no changes if: steps.parseoutputs.diff-bool == \u0026#39;false\u0026#39; run: echo \u0026#34;No infrastructure changes detected. Skipping deployment.\u0026#34; - name: Proceed with deployment if: steps.parseoutputs.diff-bool == \u0026#39;true\u0026#39; run: | echo \u0026#34;Infrastructure changes detected: ${{ steps.parseoutputs.diff-count }} resources\u0026#34; terraform apply -auto-approve tfplan - name: Notify on major changes if: steps.parseoutputs.diff-count \u0026gt; 10 run: | echo \u0026#34;âš ï¸ Large number of changes detected (${{ steps.parseoutputs.diff-count }} resources)\u0026#34; echo \u0026#34;Manual review recommended\u0026#34; ã¾ã¨ã‚ãƒ»ä»Šå¾Œã®æ©Ÿèƒ½è¿½åŠ ã«ã¤ã„ã¦ ä»Šå›ä½œæˆã—ãŸãƒ„ãƒ¼ãƒ«ã«ã‚ˆã‚Šã€Terraform Plan ã®å·®åˆ†è§£æãŒåŠ¹ç‡åŒ–ã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ç‰¹ã«ä¸‹è¨˜ã®ç‚¹ã§åŠ¹æœã‚’æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚\næ„å›³ã—ãªã„å·®åˆ†ã¨é‡è¦ãªå·®åˆ†ã®åŒºåˆ¥ãŒæŒ‡å®šå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã£ãŸ Plan çµæœå·®åˆ†ã«åå¿œã—ã¦é€šçŸ¥ã™ã‚‹ä»•çµ„ã¿ç­‰ã«å¿œç”¨ãŒåŠ¹ã ãƒãƒ¼ãƒ å…¨ä½“ã§å·®åˆ†ã®åˆ¤æ–­åŸºæº–ã‚’çµ±ä¸€æŒ‡å®šå‡ºæ¥ã‚‹ ä»Šå¾Œã®æ©Ÿèƒ½è¿½åŠ ã¨ã—ã¦ã€ä»¥ä¸‹ã‚’æ¤œè¨ã—ã¦ã„ã¾ã™ï¼š\nå·®åˆ†ã®å¤‰æ›´ã®ç¨®é¡ï¼ˆcreate/update/deleteï¼‰ã”ã¨ã®åˆ†é¡ å…¥åŠ›ãƒ»å‡ºåŠ›ã®æ‹¡å¼µ ãœã²çš†ã•ã‚“ã® Terraform é‹ç”¨ã§ã‚‚æ´»ç”¨ã—ã¦ã¿ã¦ãã ã•ã„ï¼\n","permalink":"https://jedipunkz.github.io/post/tf-plan-analyzer/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://x.com/jedipunkz\"\u003ejedipunkzğŸš€\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eTerraform ã‚’é‹ç”¨ã—ã¦ã„ã‚‹ã¨ãŸã¾ã« Plan çµæœãŒã©ã†ã—ã¦ã‚‚å‡ºã¦ã—ã¾ã†äº‹ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸ Terraform ã‚’ GitHub ã§å®Ÿè¡Œã™ã‚‹ç’°å¢ƒã‚’é‹ç”¨ã—ã¦ã„ã‚‹ã¨ Plan çµæœã‚’ã†ã¾ãæ‰±ã£ã¦è‡ªå‹•åŒ–ã—ãŸã„ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚æ¹§ã„ã¦ãã¾ã™ã€‚ã“ã®å ´åˆã« Plan ã®å·®åˆ†ã‚’ã†ã¾ãå‡¦ç†ã—ã¦ãã‚Œã‚‹ GitHub Action ãŒã‚ã‚Œã°ãªã¨æ€ã£ã¦ä½œã£ã¦ã¿ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ch2 id=\"github-actions\"\u003eGitHub Actions\u003c/h2\u003e\n\u003cp\u003eä½œæˆã—ãŸ GitHub Action ã¯ä¸‹è¨˜ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/jedipunkz/tf-plan-parser\"\u003ehttps://github.com/jedipunkz/tf-plan-parser\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"å…¥åŠ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š\"\u003eå…¥åŠ›ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š\u003c/h2\u003e\n\u003cp\u003eã“ã® GitHub Action ã§ã¯2ã¤ã®å…¥åŠ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒåˆ©ç”¨å¯èƒ½ã§ã™ï¼š\u003c/p\u003e\n\u003ch3 id=\"terraform-plan-å¿…é ˆ\"\u003e\u003ccode\u003eterraform-plan\u003c/code\u003e (å¿…é ˆ)\u003c/h3\u003e\n\u003cp\u003eãƒ‘ãƒ¼ã‚¹å¯¾è±¡ã¨ãªã‚‹ Terraform Plan ã®å‡ºåŠ›çµæœã‚’æŒ‡å®šã—ã¾ã™ã€‚é€šå¸¸ã¯å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè¡Œã—ãŸ \u003ccode\u003eterraform plan\u003c/code\u003e ã‚³ãƒãƒ³ãƒ‰ã®æ¨™æº–å‡ºåŠ›ã‚’æ¸¡ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch3 id=\"ignore-resources-ã‚ªãƒ—ã‚·ãƒ§ãƒ³\"\u003e\u003ccode\u003eignore-resources\u003c/code\u003e (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)\u003c/h3\u003e\n\u003cp\u003eç„¡è¦–ã—ãŸã„ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã‚„ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã‚’é…åˆ—å½¢å¼ã§æŒ‡å®šã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç©ºã®é…åˆ— \u003ccode\u003e[]\u003c/code\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæŒ‡å®šæ–¹æ³•ã®ä¾‹ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—å…¨ä½“ã‚’ç„¡è¦–:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eignore-resources\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;[\u0026#34;null_resource\u0026#34;, \u0026#34;local_file\u0026#34;]\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç„¡è¦–:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eignore-resources\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;[\u0026#34;null_resource.temporary\u0026#34;, \u0026#34;local_file.cache\u0026#34;]\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æ··åœ¨:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eignore-resources\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;[\u0026#34;null_resource\u0026#34;, \u0026#34;aws_s3_bucket.temp\u0026#34;, \u0026#34;local_file\u0026#34;]\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å‡ºåŠ›ã•ã‚Œã‚‹æƒ…å ±\"\u003eå‡ºåŠ›ã•ã‚Œã‚‹æƒ…å ±\u003c/h2\u003e\n\u003cp\u003eã“ã® Action ã¯ä»¥ä¸‹ã®å‡ºåŠ›ã‚’æä¾›ã—ã¾ã™ã€‚ã¾ãŸä¸‹è¨˜ã¯ ignore-resources ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æŒ‡å®šã«æ²¿ã£ã¦çµæœã‚’å‡ºåŠ›ã—ã¦ãã‚Œã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003ediff-bool\u003c/code\u003e\u003c/strong\u003e: å¤‰æ›´ãŒã‚ã‚‹ã‹ã©ã†ã‹ã®çœŸå½å€¤ï¼ˆ\u003ccode\u003etrue\u003c/code\u003e ã¾ãŸã¯ \u003ccode\u003efalse\u003c/code\u003eï¼‰\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003ediff-count\u003c/code\u003e\u003c/strong\u003e: å¤‰æ›´ã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®æ•°\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003ediff-resources\u003c/code\u003e\u003c/strong\u003e: å¤‰æ›´ã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ä¸€è¦§ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003ediff-raw\u003c/code\u003e\u003c/strong\u003e: ç”Ÿã®å·®åˆ†ãƒ‡ãƒ¼ã‚¿\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã“ã‚Œã‚‰ã®å‡ºåŠ›ã‚’ä½¿ã£ã¦ã€å¾Œç¶šã®ã‚¹ãƒ†ãƒƒãƒ—ã§æ¡ä»¶åˆ†å²ã‚„é€šçŸ¥ã®åˆ¶å¾¡ãŒå¯èƒ½ã§ã™ã€‚\u003c/p\u003e","title":"Terraform Plan å·®åˆ†ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ GitHub Actions ã‚’ä½œã£ãŸ"},{"content":"\nã“ã‚“ã«ã¡ã¯ @jedipunkz ğŸš€ ã§ã™ã€‚\nå…ƒã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒ»ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§æœ€è¿‘ã¯ AWS, GCP ã‚’æ‰±ã† SRE ã¨ã—ã¦åƒã„ã¦ã„ã¾ã™ã€‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã‚¤ãƒ³ãƒ•ãƒ©ã®èª²é¡Œã‚’è§£æ±ºã™ã¹ãå‹‰å¼·ã—ã¦ã„ãã¾ã™ã€‚å­¦ã‚“ã ã“ã¨ã‚’ã“ã®ãƒ–ãƒ­ã‚°ã«è¨˜ã›ãŸã‚‰ã„ã„ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚\nå°å­¦ç”Ÿã®é ƒã‹ã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’ã—ã¦ã„ãŸã‚Šä»Šã§ã‚‚è‡ªä½œ PC ã‚’çµ„ã‚“ã§ã‚²ãƒ¼ãƒ ã‚’ã—ã¦ã„ãŸã‚Šã¨ã€ä»•äº‹ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå…±ã«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«è§¦ã‚ŒãªãŒã‚‰ç”Ÿæ´»ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‹ã‚‰ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒç™ºå±•ã—ã¦ã„ãæœªæ¥ã«æœŸå¾…ã—ã¦å­¦ã‚“ã§ã‚†ãã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/about/profile/","summary":"\u003cp\u003e\u003cimg alt=\"icon\" loading=\"lazy\" src=\"../../pix/jedipunkz_banner.png\"\u003e\u003c/p\u003e\n\u003cp\u003eã“ã‚“ã«ã¡ã¯ \u003ca href=\"https://x.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ğŸš€ ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå…ƒã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒ»ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§æœ€è¿‘ã¯ AWS, GCP ã‚’æ‰±ã† SRE ã¨ã—ã¦åƒã„ã¦ã„ã¾ã™ã€‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã‚¤ãƒ³ãƒ•ãƒ©ã®èª²é¡Œã‚’è§£æ±ºã™ã¹ãå‹‰å¼·ã—ã¦ã„ãã¾ã™ã€‚å­¦ã‚“ã ã“ã¨ã‚’ã“ã®ãƒ–ãƒ­ã‚°ã«è¨˜ã›ãŸã‚‰ã„ã„ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå°å­¦ç”Ÿã®é ƒã‹ã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’ã—ã¦ã„ãŸã‚Šä»Šã§ã‚‚è‡ªä½œ PC ã‚’çµ„ã‚“ã§ã‚²ãƒ¼ãƒ ã‚’ã—ã¦ã„ãŸã‚Šã¨ã€ä»•äº‹ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå…±ã«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«è§¦ã‚ŒãªãŒã‚‰ç”Ÿæ´»ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‹ã‚‰ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒç™ºå±•ã—ã¦ã„ãæœªæ¥ã«æœŸå¾…ã—ã¦å­¦ã‚“ã§ã‚†ãã¾ã™ã€‚\u003c/p\u003e","title":"è‡ªå·±ç´¹ä»‹"},{"content":"è‡ªåˆ†ã¯ Go ã®åˆå­¦è€…ãªã®ã§ã™ãŒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å­¦ã¶ãŸã‚ã«å¹¾ã¤ã‹ã®æ›¸ç±ã‚’èª­ã‚“ã§ã¿ãŸã‚‚ã®ã®ãªã‹ãªã‹ã—ã£ãã‚Šã¨ç†è§£ãŒå‡ºæ¥ã¦ã„ãªã„çŠ¶æ…‹ã§ã—ãŸã€‚ ãã“ã§ AI ã«æ¥µåŠ›ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ã›ã¦ç†è§£ã™ã‚‹ã¨ã„ã†äº‹ã‚’ã‚„ã£ã¦ã¿ãŸã®ã§ã™ãŒã€ãªã‹ãªã‹ã„ã„æ„Ÿã˜ã«ç†è§£ãŒé€²ã‚“ã ã®ã§ã“ã“ã§è¨˜äº‹ã«ã—ãŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚\nã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯ï¼Ÿ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ã€Robert C. Martin ã«ã‚ˆã£ã¦æå”±ã•ã‚ŒãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¨­è¨ˆåŸå‰‡ã§æœ€ã‚‚é‡è¦ãªç‰¹å¾´ã¯ä¾å­˜é–¢ä¿‚ã®æ–¹å‘æ€§ã«ã‚ã‚Šã¾ã™ã€‚\nå¾“æ¥ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯ç•°ãªã‚Šã€å†…å´ã®å±¤ã¯å¤–å´ã®å±¤ã‚’çŸ¥ã‚‰ãªã„ã¨ã„ã†åŸå‰‡ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šä»¥ä¸‹ã®ãƒ¡ãƒªãƒƒãƒˆãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚\nãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å˜ä½“ã§ãƒ†ã‚¹ãƒˆå¯èƒ½ æŸ”è»Ÿæ€§: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å¤‰æ›´ãŒå®¹æ˜“ ä¿å®ˆæ€§: é–¢å¿ƒã®åˆ†é›¢ã«ã‚ˆã‚Šå¤‰æ›´ã®å½±éŸ¿ç¯„å›²ã‚’é™å®š å®Ÿè£…ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®å…¨ä½“åƒ ä»Šå› AI ã«å®Ÿè£…ã•ã›ãŸã®ã¯ RESTful API ã‚’æä¾›ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚\nã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã«ã‚ã‚Šã¾ã™ã€‚\nhttps://github.com/jedipunkz/go-clean-architecture-playground\nã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®4ã¤ã®å±¤ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š\nEntity ãƒ¬ã‚¤ãƒ¤ - ãƒ“ã‚¸ãƒã‚¹ã®æ ¸ã¨ãªã‚‹ãƒ«ãƒ¼ãƒ« Interface ãƒ¬ã‚¤ãƒ¤ - æŠ½è±¡åŒ–ã«ã‚ˆã‚‹ç–çµåˆ Use Case ãƒ¬ã‚¤ãƒ¤ - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£… Infrastructure ãƒ¬ã‚¤ãƒ¤ - å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºå®Ÿè£… Controller ãƒ¬ã‚¤ãƒ¤ - HTTP APIã®æä¾› å„å±¤ã®è©³ç´°å®Ÿè£… 1. Entity ãƒ¬ã‚¤ãƒ¤ - ãƒ“ã‚¸ãƒã‚¹ã®æ ¸ã¨ãªã‚‹ãƒ«ãƒ¼ãƒ« æœ€ã‚‚å†…å´ã®å±¤ã‹ã‚‰å®Ÿè£…ã‚’å§‹ã‚ã¾ã™ã€‚ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å±¤ã¯ä»–ã®ã©ã®å±¤ã«ã‚‚ä¾å­˜ã—ãªã„ç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã§ã™ã€‚\n// entity/user.go package entity import ( \u0026#34;errors\u0026#34; \u0026#34;time\u0026#34; ) type User struct { ID int `json:\u0026#34;id\u0026#34;` Name string `json:\u0026#34;name\u0026#34;` Email string `json:\u0026#34;email\u0026#34;` CreatedAt time.Time `json:\u0026#34;created_at\u0026#34;` UpdatedAt time.Time `json:\u0026#34;updated_at\u0026#34;` } func NewUser(name, email string) (*User, error) { if name == \u0026#34;\u0026#34; { return nil, errors.New(\u0026#34;åå‰ã¯å¿…é ˆã§ã™\u0026#34;) } if email == \u0026#34;\u0026#34; { return nil, errors.New(\u0026#34;ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¿…é ˆã§ã™\u0026#34;) } now := time.Now() return \u0026amp;User{ Name: name, Email: email, CreatedAt: now, UpdatedAt: now, }, nil } func (u *User) UpdateInfo(name, email string) error { if name == \u0026#34;\u0026#34; { return errors.New(\u0026#34;åå‰ã¯å¿…é ˆã§ã™\u0026#34;) } if email == \u0026#34;\u0026#34; { return nil, errors.New(\u0026#34;ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¿…é ˆã§ã™\u0026#34;) } u.Name = name u.Email = email u.UpdatedAt = time.Now() return nil } ã“ã® User ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æœ€ã‚‚å†…å´ã«ä½ç½®ã™ã‚‹éƒ¨åˆ†ã§ã™ã€‚ã“ã“ã§é‡è¦ãªã®ã¯ã€ã“ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒå¤–éƒ¨ã®ä½•ã«ã‚‚ä¾å­˜ã—ã¦ã„ãªã„ã“ã¨ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒMySQLãªã®ã‹PostgreSQLãªã®ã‹ã€Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒGinãªã®ã‹Echoãªã®ã‹ã€ãã†ã„ã£ãŸæŠ€è¡“çš„ãªè©³ç´°ã¯ä¸€åˆ‡çŸ¥ã‚‰ãªã„ã®ãŒç‰¹å¾´ã«ãªã£ã¦ã„ã¾ã™ã€‚\nNewUser é–¢æ•°ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã™ã‚‹éš›ã®åŸºæœ¬çš„ãªãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼ˆåå‰ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¿…é ˆï¼‰ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ«ãƒ¼ãƒ«ã¯ã€æŠ€è¡“çš„ãªå®Ÿè£…ã«é–¢ä¿‚ãªãã€ãƒ“ã‚¸ãƒã‚¹ã¨ã—ã¦çµ¶å¯¾ã«å®ˆã‚‰ãªã‘ã‚Œã°ãªã‚‰ãªã„åˆ¶ç´„ã§ã™ã€‚ã¾ãŸã€UpdateInfo ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°ã™ã‚‹éš›ã®æ•´åˆæ€§ã‚’ä¿ã£ã¦ã„ã¾ã™ã€‚ã“ã®ã‚ˆã†ã«ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å±¤ã§ã¯ç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã¿ã‚’æ‰±ã†ã“ã¨ã§ã€ã‚·ã‚¹ãƒ†ãƒ ã®æ ¸ã¨ãªã‚‹éƒ¨åˆ†ã‚’æŠ€è¡“çš„ãªå¤‰æ›´ã‹ã‚‰å®ˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\n2. Interface ãƒ¬ã‚¤ãƒ¤ - æŠ½è±¡åŒ–ã«ã‚ˆã‚‹ç–çµåˆ æ¬¡ã«ã€ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚ã“ã‚ŒãŒä¾å­˜é–¢ä¿‚é€†è»¢ã®åŸå‰‡ã®éµã¨ãªã‚Šã¾ã™ã€‚\n// interface/repository/user_repository.go package repository import \u0026#34;go-clean-architecture-playground/entity\u0026#34; type UserRepository interface { Create(user *entity.User) error GetByID(id int) (*entity.User, error) GetByEmail(email string) (*entity.User, error) Update(user *entity.User) error Delete(id int) error List() ([]*entity.User, error) } ã“ã® UserRepository ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹ã€ŒContractã€ã®å½¹å‰²ã‚’æœãŸã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¦‹ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã©ã®ã‚ˆã†ãªæ“ä½œãŒã§ãã‚‹ã®ã‹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚é‡è¦ãªã®ã¯ã€ã“ã‚ŒãŒã€Œä½•ã‚’ã™ã‚‹ã‹ã€ã ã‘ã‚’å®šç¾©ã—ã¦ã¦ã€Œã©ã†ã‚„ã£ã¦ã™ã‚‹ã‹ã€ã«ã¤ã„ã¦ã¯ä¸€åˆ‡è§¦ã‚Œã¦ã„ãªã„ã¨ã„ã†ã“ã¨ã§ã™ã€‚\nå¾“æ¥ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å®Ÿè£…ã«ç›´æ¥ä¾å­˜ã—ã¦ã„ã¾ã—ãŸã€‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ã€ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’é–“ã«æŒŸã‚€ã“ã¨ã§ä¾å­˜é–¢ä¿‚ã‚’é€†è»¢ã•ã›ã¦ã¾ã™ã€‚ã¤ã¾ã‚Šã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆUseCaseï¼‰ã¯ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¾å­˜ã—ã€å…·ä½“çš„ãªå®Ÿè£…ï¼ˆMemoryUserRepositoryï¼‰ãŒã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«åˆã‚ã›ã¦ä½œã‚‰ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’MySQLã‹ã‚‰PostgreSQLã«å¤‰æ›´ã—ãŸã‚Šã€ãƒ†ã‚¹ãƒˆæ™‚ã«ãƒ¢ãƒƒã‚¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ç½®ãæ›ãˆãŸã‚Šã™ã‚‹ã“ã¨ãŒã€ä»–ã®å±¤ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ãªãå¯èƒ½ã«ãªã‚‹ã€ã¨ã„ã†ã“ã¨ã§ã™ã€‚\n3. Use Case ãƒ¬ã‚¤ãƒ¤ - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£… Use Case å±¤ã§ã¯ã€Entity ã¨ repository ã‚’çµ„ã¿åˆã‚ã›ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã™ã€‚\n// usecase/user_usecase.go package usecase import ( \u0026#34;errors\u0026#34; \u0026#34;go-clean-architecture-playground/entity\u0026#34; \u0026#34;go-clean-architecture-playground/interface/repository\u0026#34; ) type UserUsecase struct { userRepo repository.UserRepository } func NewUserUsecase(userRepo repository.UserRepository) *UserUsecase { return \u0026amp;UserUsecase{ userRepo: userRepo, } } func (u *UserUsecase) CreateUser(name, email string) (*entity.User, error) { // ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼šé‡è¤‡ãƒã‚§ãƒƒã‚¯ existingUser, _ := u.userRepo.GetByEmail(email) if existingUser != nil { return nil, errors.New(\u0026#34;ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™\u0026#34;) } // ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä½œæˆï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰ user, err := entity.NewUser(name, email) if err != nil { return nil, err } // ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ– err = u.userRepo.Create(user) if err != nil { return nil, err } return user, nil } func (u *UserUsecase) GetUser(id int) (*entity.User, error) { if id \u0026lt;= 0 { return nil, errors.New(\u0026#34;ç„¡åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§ã™\u0026#34;) } user, err := u.userRepo.GetByID(id) if err != nil { return nil, err } if user == nil { return nil, errors.New(\u0026#34;ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\u0026#34;) } return user, nil } Use Case å±¤ã¯ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ã®ã‚ˆã†ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚ã“ã® UserUsecase ã§ã¯ã€Entity ãŒæŒã¤åŸºæœ¬çš„ãªãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã¨ã€ ãƒªãƒã‚¸ãƒˆãƒªãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹æ©Ÿèƒ½ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ã‚ˆã‚Šè¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚\nä¾‹ãˆã° CreateUser ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯åŒã˜ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹ã‹ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«å•ã„åˆã‚ã›ã¾ã™ã€‚ã“ã‚Œã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼ˆé‡è¤‡ç¦æ­¢ï¼‰ã§ã™ã€‚æ¬¡ã«ã€Entity ã® NewUser é–¢æ•°ã‚’ä½¿ã£ã¦æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã“ã§ã¯ Entity ãŒæŒã¤åŸºæœ¬çš„ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯ï¼‰ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚æœ€å¾Œã«ã€Repository ã‚’ä½¿ã£ã¦å®Ÿéš›ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã™ã€‚\nã“ã®æµã‚Œã§é‡è¦ãªã®ã¯ã€Use Case å±¤ãŒ Entity ã¨ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã®ã¿ä¾å­˜ã—ã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚å…·ä½“çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å®Ÿè£…ã‚„HTTPãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«ã¤ã„ã¦ã¯ä½•ã‚‚çŸ¥ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¤–éƒ¨ã®æŠ€è¡“çš„ãªå¤‰æ›´ã‹ã‚‰å®Œå…¨ã«åˆ†é›¢ã§ãã¦ã„ã¾ã™ã€‚\n4. Infrastructure ãƒ¬ã‚¤ãƒ¤ - å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºå®Ÿè£… å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚’æ‹…å½“ã™ã‚‹å±¤ã§ã™ã€‚ä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ãƒ¡ãƒ¢ãƒªå†…ä¿å­˜ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚\n// infrastructure/persistence/memory_user_repository.go package persistence import ( \u0026#34;errors\u0026#34; \u0026#34;go-clean-architecture-playground/entity\u0026#34; \u0026#34;go-clean-architecture-playground/interface/repository\u0026#34; \u0026#34;sync\u0026#34; ) type MemoryUserRepository struct { users map[int]*entity.User lastID int mutex sync.RWMutex } func NewMemoryUserRepository() repository.UserRepository { return \u0026amp;MemoryUserRepository{ users: make(map[int]*entity.User), lastID: 0, } } func (r *MemoryUserRepository) Create(user *entity.User) error { r.mutex.Lock() defer r.mutex.Unlock() r.lastID++ user.ID = r.lastID r.users[user.ID] = user return nil } func (r *MemoryUserRepository) GetByEmail(email string) (*entity.User, error) { r.mutex.RLock() defer r.mutex.RUnlock() for _, user := range r.users { if user.Email == email { return user, nil } } return nil, nil // è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯nil } ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã¯ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹å®Ÿè¡Œè€…ã¨ã‚‚è¨€ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚ã“ã® MemoryUserRepository ã¯ã€å…ˆã»ã©å®šç¾©ã—ãŸ UserRepository ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿéš›ã«å®Ÿè£…ã—ãŸã‚‚ã®ã§ã€ã“ã®å®Ÿè£…ãŒå…ˆã«å®šç¾©ã•ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«åˆã‚ã›ã¦ä½œã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚\nå¾“æ¥ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ã€ã¾ãšãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å®Ÿè£…ãŒã‚ã‚Šã€ãã‚Œã«åˆã‚ã›ã¦ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒæ›¸ã‹ã‚Œã¦ã„ã¾ã—ãŸã€‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ã€ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã‹ã‚‰ç”Ÿã¾ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å¯¾ã—ã¦ã€æŠ€è¡“çš„ãªå®Ÿè£…ãŒåˆã‚ã›ã‚‰ã‚Œã¾ã™ã€‚ã“ã‚ŒãŒã€Œä¾å­˜é–¢ä¿‚é€†è»¢ã®åŸå‰‡ã€ã®å®Ÿè·µã§ã™ã€‚\nã“ã®å®Ÿè£…ã§ã¯ã€ã‚·ãƒ³ãƒ—ãƒ«ã«ãƒ¡ãƒ¢ãƒªå†…ã®ãƒãƒƒãƒ—ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¦ã„ã¾ã™ãŒã€åŒã˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€PostgreSQL ã‚„ MySQL ãªã©ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å®Ÿè£…ã«ç½®ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã®éš›ã€Use Case å±¤ã‚„ Entity å±¤ã®ã‚³ãƒ¼ãƒ‰ã¯ä¸€åˆ‡å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚\n5. Controller ãƒ¬ã‚¤ãƒ¤ - HTTP APIã®æä¾› å¤–éƒ¨ã‹ã‚‰ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã—ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å‡¦ç†ã‚’å§”è­²ã—ã¾ã™ã€‚\n// interface/controller/user_controller.go package controller import ( \u0026#34;encoding/json\u0026#34; \u0026#34;go-clean-architecture-playground/usecase\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;strings\u0026#34; ) type UserController struct { userUsecase *usecase.UserUsecase } func NewUserController(userUsecase *usecase.UserUsecase) *UserController { return \u0026amp;UserController{ userUsecase: userUsecase, } } type CreateUserRequest struct { Name string `json:\u0026#34;name\u0026#34;` Email string `json:\u0026#34;email\u0026#34;` } func (c *UserController) CreateUser(w http.ResponseWriter, r *http.Request) { if r.Method != http.MethodPost { http.Error(w, \u0026#34;Method not allowed\u0026#34;, http.StatusMethodNotAllowed) return } var req CreateUserRequest if err := json.NewDecoder(r.Body).Decode(\u0026amp;req); err != nil { http.Error(w, \u0026#34;Invalid JSON\u0026#34;, http.StatusBadRequest) return } user, err := c.userUsecase.CreateUser(req.Name, req.Email) if err != nil { http.Error(w, err.Error(), http.StatusBadRequest) return } w.Header().Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) json.NewEncoder(w).Encode(user) } ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å±¤ã¯ã€å¤–éƒ¨ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¹‹ãã®ãƒ¢ãƒã®å½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚ã“ã® UserController ã¯ã€HTTP ã¨ã„ã†å¤–éƒ¨ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‹ã‚‰é€ã‚‰ã‚Œã¦ãã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…éƒ¨ã§ç†è§£ã§ãã‚‹ Go è¨€èªã®é–¢æ•°å‘¼ã³å‡ºã—ã«å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚\nCreateUser ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã¾ãš HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ JSON ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Šã€Go è¨€èªã®æ§‹é€ ä½“ CreateUserRequest ã«å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚æ¬¡ã«ã€ãã®æ§‹é€ ä½“ã‹ã‚‰åå‰ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–ã‚Šå‡ºã—ã¦ã€Use Case å±¤ã® CreateUser ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚æœ€å¾Œã«ã€Use Case ã‹ã‚‰è¿”ã•ã‚ŒãŸçµæœã‚’ JSON ã«å¤‰æ›ã—ã¦ HTTP ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã—ã¾ã™ã€‚\né‡è¦ãªã®ã¯ã€ã“ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒ HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®èª­ã¿å–ã‚Šã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®è¨­å®šã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ›¸ãè¾¼ã¿ã®ã¿ã‚’æ‹…å½“ã—ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã«ã¯ä¸€åˆ‡é–¢ä¸ã—ã¦ã„ãªã„ã“ã¨ã§ã™ã€‚å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆå‡¦ç†ã¯å…¨ã¦ Use Case å±¤ã«å§”è­²ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å°†æ¥çš„ã« HTTP ã‹ã‚‰ gRPC ã‚„ GraphQL ã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒå‡ºã¦ãã¦ã‚‚ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯ä½•ã‚‚å¤‰æ›´ã™ã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã™ã€‚\nä¾å­˜é–¢ä¿‚ã‚’çµåˆ cmd/main.go ã§ã¯ã€å„å±¤ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€ä¾å­˜é–¢ä¿‚ã‚’è¨˜ã—ã¦ã„ã¾ã™ã€‚\n// cmd/main.go func main() { // ä¾å­˜é–¢ä¿‚ã®æ§‹ç¯‰ï¼ˆå¤–å´ã‹ã‚‰å†…å´ã¸ï¼‰ userRepo := persistence.NewMemoryUserRepository() // Infrastructure userUsecase := usecase.NewUserUsecase(userRepo) // Use Case userController := controller.NewUserController(userUsecase) // Interface // HTTPãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®è¨­å®š http.HandleFunc(\u0026#34;/users\u0026#34;, func(w http.ResponseWriter, r *http.Request) { if r.Method == http.MethodPost { userController.CreateUser(w, r) } else if r.Method == http.MethodGet { userController.ListUsers(w, r) } }) fmt.Println(\u0026#34;ã‚µãƒ¼ãƒãƒ¼ã‚’ :8080 ã§èµ·å‹•ã—ã¦ã„ã¾ã™...\u0026#34;) log.Fatal(http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil)) } ã“ã“ã§æœ€ã‚‚é‡è¦ãªã®ãŒä¾å­˜æ€§ã®éƒ¨åˆ†ã§ã™ã€‚cmd/main.go ã¯ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å„è¦ç´ ã®å½¹å‰²ã®é–¢ä¿‚ã‚’è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚\nä¾å­˜é–¢ä¿‚ã®æ§‹ç¯‰é †åºã‚’è¦‹ã‚‹ã¨ã¾ãšæœ€ã‚‚å¤–å´ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ï¼ˆMemoryUserRepositoryï¼‰ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¦ã€ãã‚Œã‚’ Use Case å±¤ï¼ˆUserUsecaseï¼‰ã«æ¸¡ã—ã¦ã„ã¾ã™ã€‚æ¬¡ã« Use Case ã‚’ Controller å±¤ï¼ˆUserControllerï¼‰ã«æ¸¡ã—ã¾ã™ã€‚\nã“ã®è¨­è¨ˆã¯ã€ä¾‹ãˆã°ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒ¡ãƒ¢ãƒªã‹ã‚‰ PostgreSQL ã«å¤‰æ›´ã—ãŸã„å ´åˆã€cmd/main.go ã®ä¸€è¡Œã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã§æ¸ˆã¿ã¾ã™ã€‚ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚„ Controller ã®ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚\nå‹•ä½œç¢ºèª 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹• go run cmd/main.go 2. APIã®ãƒ†ã‚¹ãƒˆ # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ curl -X POST http://localhost:8080/users \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{\u0026#34;name\u0026#34;: \u0026#34;ç”°ä¸­å¤ªéƒ\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;tanaka@example.com\u0026#34;}\u0026#39; # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ { \u0026#34;id\u0026#34;: 1, \u0026#34;name\u0026#34;: \u0026#34;ç”°ä¸­å¤ªéƒ\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;tanaka@example.com\u0026#34;, \u0026#34;created_at\u0026#34;: \u0026#34;2025-08-01T19:52:11Z\u0026#34;, \u0026#34;updated_at\u0026#34;: \u0026#34;2025-08-01T19:52:11Z\u0026#34; } # ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾— curl http://localhost:8080/users/1 { \u0026#34;id\u0026#34;: 1, \u0026#34;name\u0026#34;: \u0026#34;ç”°ä¸­å¤ªéƒ\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;tanaka@example.com\u0026#34;, \u0026#34;created_at\u0026#34;: \u0026#34;2025-08-01T19:59:11.510652+09:00\u0026#34;, \u0026#34;updated_at\u0026#34;: \u0026#34;2025-08-01T19:59:11.510652+09:00\u0026#34; } ãã®ä»–ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ãƒ¡ãƒªãƒƒãƒˆ ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ã®å‘ä¸Š å„å±¤ãŒç‹¬ç«‹ã—ã¦ã„ã‚‹ãŸã‚ã€ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒå®¹æ˜“ã«ãªã‚‹ãã†ã§ã™ã€‚\n// usecase ã®ãƒ†ã‚¹ãƒˆä¾‹ func TestUserUsecase_CreateUser(t *testing.T) { // ãƒ¢ãƒƒã‚¯ãƒªãƒã‚¸ãƒˆãƒªã‚’æ³¨å…¥ mockRepo := \u0026amp;MockUserRepository{} usecase := NewUserUsecase(mockRepo) // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ user, err := usecase.CreateUser(\u0026#34;ãƒ†ã‚¹ãƒˆå¤ªéƒ\u0026#34;, \u0026#34;test@example.com\u0026#34;) // æ¤œè¨¼ assert.NoError(t, err) assert.Equal(t, \u0026#34;ãƒ†ã‚¹ãƒˆå¤ªéƒ\u0026#34;, user.Name) } æ‹¡å¼µæ€§ã®ç¢ºä¿ å‰è¿°ã—ã¾ã—ãŸãŒã€æ–°ã—ã„è¦ä»¶ã«å¯¾ã—ã¦å¯¾å¿œãŒç°¡å˜ã«ãªã‚Šã¾ã™ã€‚\n// PostgreSQLå®Ÿè£…ã¸ã®åˆ‡ã‚Šæ›¿ãˆ func main() { // ãƒ¡ãƒ¢ãƒªå®Ÿè£…ã‹ã‚‰... // userRepo := persistence.NewMemoryUserRepository() // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å®Ÿè£…ã¸ userRepo := persistence.NewPostgreSQLUserRepository(db) // ä»–ã®éƒ¨åˆ†ã¯å¤‰æ›´ä¸è¦ï¼ userUsecase := usecase.NewUserUsecase(userRepo) // ... } ã¾ã¨ã‚ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å®Ÿè·µã™ã‚‹ã“ã¨ã§ã€ä¾å­˜é–¢ä¿‚ãŒå¾“æ¥ã¨é€†ã«ãªã£ãŸã“ã¨ãŒç†è§£ã§ãã€ã“ã‚Œã«ã‚ˆã£ã¦ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã®ä¸æ„ã®å¤‰æ›´ã«ã‚‚æŸ”è»Ÿã«å¯¾å¿œå‡ºæ¥ãã†ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚ãŸã å°ã•ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›¸ãéš›ã«ã¯ã‚ªãƒ¼ãƒãƒ¼ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ãªã®ã§ã¯ï¼Ÿã¨æ„Ÿã˜ãŸã®ã‚‚æ­£ç›´ãªã¨ã“ã‚ã§ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¤‡é›‘åŒ–ã™ã‚‹ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã§ã¯çœŸä¾¡ã‚’ç™ºæ®ã§ããã†ã§ã™ã€‚ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã‚„ã™ã„ã¨ã„ã†ç‚¹ã‚‚å€‹äººçš„ã«ç´å¾—ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¯ Controllerã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¯ Use Case, ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¯ Repository ã¨é–¢å¿ƒäº‹ã‚’åˆ†é›¢å‡ºæ¥ã¦ã„ã‚‹ç‚¹ã‚‚å€‹äººçš„ã«ãƒ¡ãƒªãƒƒãƒˆã¨æ„Ÿã˜å–ã‚Šã¾ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/go-clean-architecture/","summary":"\u003cp\u003eè‡ªåˆ†ã¯ Go ã®åˆå­¦è€…ãªã®ã§ã™ãŒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å­¦ã¶ãŸã‚ã«å¹¾ã¤ã‹ã®æ›¸ç±ã‚’èª­ã‚“ã§ã¿ãŸã‚‚ã®ã®ãªã‹ãªã‹ã—ã£ãã‚Šã¨ç†è§£ãŒå‡ºæ¥ã¦ã„ãªã„çŠ¶æ…‹ã§ã—ãŸã€‚ ãã“ã§ AI ã«æ¥µåŠ›ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ã›ã¦ç†è§£ã™ã‚‹ã¨ã„ã†äº‹ã‚’ã‚„ã£ã¦ã¿ãŸã®ã§ã™ãŒã€ãªã‹ãªã‹ã„ã„æ„Ÿã˜ã«ç†è§£ãŒé€²ã‚“ã ã®ã§ã“ã“ã§è¨˜äº‹ã«ã—ãŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯\"\u003eã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯ï¼Ÿ\u003c/h2\u003e\n\u003cp\u003eã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ã€Robert C. Martin ã«ã‚ˆã£ã¦æå”±ã•ã‚ŒãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¨­è¨ˆåŸå‰‡ã§æœ€ã‚‚é‡è¦ãªç‰¹å¾´ã¯ä¾å­˜é–¢ä¿‚ã®æ–¹å‘æ€§ã«ã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"ä¾å­˜é–¢ä¿‚å›³\" loading=\"lazy\" src=\"../../pix/go-clean-architecture-2.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¾“æ¥ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯ç•°ãªã‚Šã€å†…å´ã®å±¤ã¯å¤–å´ã®å±¤ã‚’çŸ¥ã‚‰ãªã„ã¨ã„ã†åŸå‰‡ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šä»¥ä¸‹ã®ãƒ¡ãƒªãƒƒãƒˆãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å˜ä½“ã§ãƒ†ã‚¹ãƒˆå¯èƒ½\u003c/li\u003e\n\u003cli\u003eæŸ”è»Ÿæ€§: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å¤‰æ›´ãŒå®¹æ˜“\u003c/li\u003e\n\u003cli\u003eä¿å®ˆæ€§: é–¢å¿ƒã®åˆ†é›¢ã«ã‚ˆã‚Šå¤‰æ›´ã®å½±éŸ¿ç¯„å›²ã‚’é™å®š\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å®Ÿè£…ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®å…¨ä½“åƒ\"\u003eå®Ÿè£…ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®å…¨ä½“åƒ\u003c/h2\u003e\n\u003cp\u003eä»Šå› AI ã«å®Ÿè£…ã•ã›ãŸã®ã¯ RESTful API ã‚’æä¾›ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã«ã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/jedipunkz/go-clean-architecture-playground\"\u003ehttps://github.com/jedipunkz/go-clean-architecture-playground\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³\" loading=\"lazy\" src=\"../../pix/go-clean-architecture-1.png\"\u003e\u003c/p\u003e\n\u003cp\u003eã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®4ã¤ã®å±¤ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eEntity ãƒ¬ã‚¤ãƒ¤ - ãƒ“ã‚¸ãƒã‚¹ã®æ ¸ã¨ãªã‚‹ãƒ«ãƒ¼ãƒ«\u003c/li\u003e\n\u003cli\u003eInterface ãƒ¬ã‚¤ãƒ¤ - æŠ½è±¡åŒ–ã«ã‚ˆã‚‹ç–çµåˆ\u003c/li\u003e\n\u003cli\u003eUse Case ãƒ¬ã‚¤ãƒ¤   - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…\u003c/li\u003e\n\u003cli\u003eInfrastructure ãƒ¬ã‚¤ãƒ¤ - å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºå®Ÿè£…\u003c/li\u003e\n\u003cli\u003eController ãƒ¬ã‚¤ãƒ¤ - HTTP APIã®æä¾›\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"å„å±¤ã®è©³ç´°å®Ÿè£…\"\u003eå„å±¤ã®è©³ç´°å®Ÿè£…\u003c/h2\u003e\n\u003ch3 id=\"1-entity-ãƒ¬ã‚¤ãƒ¤---ãƒ“ã‚¸ãƒã‚¹ã®æ ¸ã¨ãªã‚‹ãƒ«ãƒ¼ãƒ«\"\u003e1. Entity ãƒ¬ã‚¤ãƒ¤ - ãƒ“ã‚¸ãƒã‚¹ã®æ ¸ã¨ãªã‚‹ãƒ«ãƒ¼ãƒ«\u003c/h3\u003e\n\u003cp\u003eæœ€ã‚‚å†…å´ã®å±¤ã‹ã‚‰å®Ÿè£…ã‚’å§‹ã‚ã¾ã™ã€‚ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å±¤ã¯ä»–ã®ã©ã®å±¤ã«ã‚‚ä¾å­˜ã—ãªã„ç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã§ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// entity/user.go\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003epackage\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eentity\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;errors\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;time\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eUser\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eID\u003c/span\u003e        \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e       \u003cspan style=\"color:#e6db74\"\u003e`json:\u0026#34;id\u0026#34;`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eName\u003c/span\u003e      \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e    \u003cspan style=\"color:#e6db74\"\u003e`json:\u0026#34;name\u0026#34;`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eEmail\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e    \u003cspan style=\"color:#e6db74\"\u003e`json:\u0026#34;email\u0026#34;`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eCreatedAt\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eTime\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e`json:\u0026#34;created_at\u0026#34;`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eUpdatedAt\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eTime\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e`json:\u0026#34;updated_at\u0026#34;`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eNewUser\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eemail\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e) (\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eUser\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003eerror\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerrors\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eNew\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;åå‰ã¯å¿…é ˆã§ã™\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eemail\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerrors\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eNew\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¿…é ˆã§ã™\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003enow\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eNow\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eUser\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003eName\u003c/span\u003e:      \u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003eEmail\u003c/span\u003e:     \u003cspan style=\"color:#a6e22e\"\u003eemail\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003eCreatedAt\u003c/span\u003e: \u003cspan style=\"color:#a6e22e\"\u003enow\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003eUpdatedAt\u003c/span\u003e: \u003cspan style=\"color:#a6e22e\"\u003enow\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}, \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eu\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eUser\u003c/span\u003e) \u003cspan style=\"color:#a6e22e\"\u003eUpdateInfo\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eemail\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eerror\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eerrors\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eNew\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;åå‰ã¯å¿…é ˆã§ã™\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eemail\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerrors\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eNew\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¿…é ˆã§ã™\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eu\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eName\u003c/span\u003e = \u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eu\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eEmail\u003c/span\u003e = \u003cspan style=\"color:#a6e22e\"\u003eemail\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eu\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eUpdatedAt\u003c/span\u003e = \u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eNow\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eã“ã® \u003ccode\u003eUser\u003c/code\u003e ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æœ€ã‚‚å†…å´ã«ä½ç½®ã™ã‚‹éƒ¨åˆ†ã§ã™ã€‚ã“ã“ã§é‡è¦ãªã®ã¯ã€ã“ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒå¤–éƒ¨ã®ä½•ã«ã‚‚ä¾å­˜ã—ã¦ã„ãªã„ã“ã¨ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒMySQLãªã®ã‹PostgreSQLãªã®ã‹ã€Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒGinãªã®ã‹Echoãªã®ã‹ã€ãã†ã„ã£ãŸæŠ€è¡“çš„ãªè©³ç´°ã¯ä¸€åˆ‡çŸ¥ã‚‰ãªã„ã®ãŒç‰¹å¾´ã«ãªã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e","title":"Go åˆå­¦è€…ãŒå­¦ã¶ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£"},{"content":"è‡ªåˆ†ã¯ Platform Enabler/SRE ã¨ã—ã¦å¾“äº‹ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸ AI é–¢é€£ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¯2025å¹´ã«å…¥ã£ã¦ã‚‚å±ã«æ›´æ–°ã•ã‚Œã¦ã„ã¾ã™ã€‚2025å¹´åˆé ­ã«ãŠã„ã¦ã¯è‡ªåˆ†ãŸã¡ã®åˆ†é‡ã§ã‚‚ AI é–¢é€£ã®åˆ©ç”¨ã«é–¢ã—ã¦æ§˜ã€…ãªæ¨¡ç´¢ãŒã‚ã‚‹çŠ¶æ³ã ã¨æ€ã‚ã‚Œã¾ã™ãŒã€Ahthoropic ç¤¾ãŒæå”±ã—ãŸ MCP (Model Context Protocol) ãŒã‚‚ãŸã‚‰ã™ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«é™å®šã•ã‚Œãšã‚¤ãƒ³ãƒ•ãƒ©é ˜åŸŸã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ã‚‚å¤§ããªãƒ¡ãƒªãƒƒãƒˆã‚’ã‚‚ãŸã‚‰ã™ã¨æ€ã£ã¦è¦³æ¸¬ã—ã¦ã„ã¾ã™ã€‚\nã“ã®è¨˜äº‹ã§ã¯ã€MCP ã®æ¦‚è¦ã¨ã©ã†å®Ÿè£…ã™ã‚‹ã®ã‹ã®å­¦ç¿’ã€ã¾ãŸã©ã†æˆ‘ã€…ã®ã‚ˆã†ãª Platform Enabler/SRE ã«ã¨ã£ã¦ã®æ´»ç”¨ä¾‹ãŒã‚ã‚‹ã‹ã‚’è€ƒå¯Ÿã—ã¦ã„ããŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚\nMCP ã®æ¦‚è¦ MCP (Model Context Protocol) ã¯ã€AI ãƒ¢ãƒ‡ãƒ«ã¨å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é–“ã®ã‚„ã‚Šå–ã‚Šã‚’åŠ¹ç‡åŒ–ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ JSON-RPC ã§ã‚„ã‚Šã¨ã‚Šã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªç„¶è¨€èªå…¥åŠ›ã‚’åŸºã«ã€AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆãŒ MCP ã‚µãƒ¼ãƒãƒ¼ã‚’é€šã˜ã¦ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã‚„ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\næœ€è¿‘ OpenAI ç¤¾ã‚‚ã“ã® Anthropic ç¤¾ã® MCP ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã¨ã„ã†ãƒ‹ãƒ¥ãƒ¼ã‚¹ãŒæµã‚Œã€é€”ç«¯ã«æ³¨ç›®ã‚’é›†ã‚ã‚‹çŠ¶æ³ã«ãªã£ã¦ãã¾ã—ãŸã€‚\nå‡¦ç†ã®æµã‚Œ ã“ã“ã¯ã‚ãã¾ã§ã®ä¸€ä¾‹ã§ã™ã€‚Assistant ã®å®Ÿè£…ã§ã„ã‹ã‚ˆã†ã«ã‚‚å‡ºæ¥ã‚‹ã¨æ€ã„ã¾ã™ã€‚\n+-------------+ +-----------+ +------------+ +--------+ | User Prompt | \u0026lt;-----\u0026gt; | Assistant | ---\u0026gt; | MCP Server | | AI API | +-------------+ (1),(5) +-----------+ (3) +------------+ +--------+ | ^ | (2),(4) | +----------------------------------+ (1) ãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ã®å…¥åŠ›ã‚’ Assistant ãŒå—ã‘å–ã‚‹ (2) Assistant ã¯ãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ã®è‡ªç„¶è¨€èªã‚’ LLM ã«å•ã„åˆã‚ã›ã€‚ãã®éš›ã« LLM ã«å¤–éƒ¨æ©Ÿèƒ½ã‚’å®šç¾© (JSON-RPC(MCP ã‚µãƒ¼ãƒãŒå—ã‘å–ã‚‹)) (3) Aasistant ã¯ MCP Server ã« JSON-RPC ã§ã‚¯ã‚¨ãƒªé€ä¿¡ã—ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¾—ã‚‹ (4) Assistant ã¯ MCP Server ã‹ã‚‰å¾—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å†ã³ LLM ã«é€ä¿¡ã—è‡ªç„¶è¨€èªã¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ã«è¿”ã™å†…å®¹ã‚’ç”Ÿæˆã—ã¦ã‚‚ã‚‰ã† (5) Assistant ã¯ãƒ¦ãƒ¼ã‚¶ã«è‡ªç„¶è¨€èªã§çµæœã‚’å¿œç­”ã™ã‚‹ å‰æ MCP å­¦ç¿’ã‚’ç›®çš„ã«ã—ã¦ã„ã‚‹ã®ã§ã€ã“ã“ã§ã¯è©±ã‚’ç°¡æ½”ã«ã™ã‚‹ãŸã‚ Linux Filesystem ã‚’æ“ä½œã™ã‚‹ MCP Server ã‚’æ›¸ãã€ç†è§£ã—ã¦ã„ãã¾ã™ã€‚\nMCP Server ã®å®Ÿè£… è¨€èªã¯å•ã„ã¾ã›ã‚“ãŒè‡ªåˆ†ã¯ Go ã§æ›¸ãã¾ã—ãŸã€‚å‰è¿°ã©ãŠã‚Šã€ã¾ãšå­¦ç¿’ç›®çš„ã§ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’æ“ä½œã™ã‚‹ MCP Server ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚\npackage main import ( \u0026#34;encoding/json\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; \u0026#34;path/filepath\u0026#34; \u0026#34;sort\u0026#34; ) // MCPRequest ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ§‹é€ ä½“ type MCPRequest struct { Action string `json:\u0026#34;action\u0026#34;` Path string `json:\u0026#34;path\u0026#34;` Content string `json:\u0026#34;content,omitempty\u0026#34;` Recursive bool `json:\u0026#34;recursive,omitempty\u0026#34;` Data json.RawMessage `json:\u0026#34;data,omitempty\u0026#34;` } // MCPResponse ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ§‹é€ ä½“ type MCPResponse struct { Status string `json:\u0026#34;status\u0026#34;` Message string `json:\u0026#34;message,omitempty\u0026#34;` Data interface{} `json:\u0026#34;data,omitempty\u0026#34;` } // FileInfo ã¯ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã®æ§‹é€ ä½“ type FileInfo struct { Name string `json:\u0026#34;name\u0026#34;` Size int64 `json:\u0026#34;size\u0026#34;` Mode string `json:\u0026#34;mode\u0026#34;` ModTime string `json:\u0026#34;modTime\u0026#34;` IsDir bool `json:\u0026#34;isDir\u0026#34;` Path string `json:\u0026#34;path\u0026#34;` } func main() { http.HandleFunc(\u0026#34;/mcp\u0026#34;, handleMCP) port := \u0026#34;8080\u0026#34; fmt.Printf(\u0026#34;Starting MCP server on port %s...\\n\u0026#34;, port) log.Fatal(http.ListenAndServe(\u0026#34;:\u0026#34;+port, nil)) } func handleMCP(w http.ResponseWriter, r *http.Request) { w.Header().Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) w.Header().Set(\u0026#34;Access-Control-Allow-Origin\u0026#34;, \u0026#34;*\u0026#34;) w.Header().Set(\u0026#34;Access-Control-Allow-Methods\u0026#34;, \u0026#34;POST, OPTIONS\u0026#34;) w.Header().Set(\u0026#34;Access-Control-Allow-Headers\u0026#34;, \u0026#34;Content-Type\u0026#34;) if r.Method == \u0026#34;OPTIONS\u0026#34; { w.WriteHeader(http.StatusOK) return } if r.Method != \u0026#34;POST\u0026#34; { sendError(w, \u0026#34;Method not allowed\u0026#34;, http.StatusMethodNotAllowed) return } body, err := io.ReadAll(r.Body) if err != nil { sendError(w, \u0026#34;Failed to read request body\u0026#34;, http.StatusBadRequest) return } defer r.Body.Close() var req MCPRequest if err := json.Unmarshal(body, \u0026amp;req); err != nil { sendError(w, \u0026#34;Invalid JSON\u0026#34;, http.StatusBadRequest) return } switch req.Action { case \u0026#34;list\u0026#34;: handleList(w, req) case \u0026#34;read\u0026#34;: handleRead(w, req) case \u0026#34;write\u0026#34;: handleWrite(w, req) case \u0026#34;delete\u0026#34;: handleDelete(w, req) case \u0026#34;mkdir\u0026#34;: handleMkdir(w, req) default: sendError(w, \u0026#34;Unknown action\u0026#34;, http.StatusBadRequest) } } func handleList(w http.ResponseWriter, req MCPRequest) { path := sanitizePath(req.Path) entries, err := os.ReadDir(path) if err != nil { sendError(w, fmt.Sprintf(\u0026#34;Failed to read directory: %v\u0026#34;, err), http.StatusInternalServerError) return } var fileInfos []FileInfo for _, entry := range entries { info, err := entry.Info() if err != nil { continue } fileInfos = append(fileInfos, FileInfo{ Name: entry.Name(), Size: info.Size(), Mode: info.Mode().String(), ModTime: info.ModTime().Format(\u0026#34;2006-01-02 15:04:05\u0026#34;), IsDir: entry.IsDir(), Path: filepath.Join(path, entry.Name()), }) } sort.Slice(fileInfos, func(i, j int) bool { if fileInfos[i].IsDir \u0026amp;\u0026amp; !fileInfos[j].IsDir { return true } if !fileInfos[i].IsDir \u0026amp;\u0026amp; fileInfos[j].IsDir { return false } return fileInfos[i].Name \u0026lt; fileInfos[j].Name }) sendSuccess(w, \u0026#34;Directory listed successfully\u0026#34;, fileInfos) } func handleRead(w http.ResponseWriter, req MCPRequest) { path := sanitizePath(req.Path) content, err := os.ReadFile(path) if err != nil { sendError(w, fmt.Sprintf(\u0026#34;Failed to read file: %v\u0026#34;, err), http.StatusInternalServerError) return } sendSuccess(w, \u0026#34;File read successfully\u0026#34;, string(content)) } func handleWrite(w http.ResponseWriter, req MCPRequest) { path := sanitizePath(req.Path) dir := filepath.Dir(path) if err := os.MkdirAll(dir, 0755); err != nil { sendError(w, fmt.Sprintf(\u0026#34;Failed to create directory: %v\u0026#34;, err), http.StatusInternalServerError) return } err := os.WriteFile(path, []byte(req.Content), 0644) if err != nil { sendError(w, fmt.Sprintf(\u0026#34;Failed to write file: %v\u0026#34;, err), http.StatusInternalServerError) return } sendSuccess(w, \u0026#34;File written successfully\u0026#34;, nil) } func handleDelete(w http.ResponseWriter, req MCPRequest) { path := sanitizePath(req.Path) var err error if req.Recursive { err = os.RemoveAll(path) } else { err = os.Remove(path) } if err != nil { sendError(w, fmt.Sprintf(\u0026#34;Failed to delete: %v\u0026#34;, err), http.StatusInternalServerError) return } sendSuccess(w, \u0026#34;Deleted successfully\u0026#34;, nil) } func handleMkdir(w http.ResponseWriter, req MCPRequest) { path := sanitizePath(req.Path) var err error if req.Recursive { err = os.MkdirAll(path, 0755) } else { err = os.Mkdir(path, 0755) } if err != nil { sendError(w, fmt.Sprintf(\u0026#34;Failed to create directory: %v\u0026#34;, err), http.StatusInternalServerError) return } sendSuccess(w, \u0026#34;Directory created successfully\u0026#34;, nil) } func sanitizePath(path string) string { // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®å®Ÿè£…ã¯ã“ã¡ã‚‰ã«æ›¸ããã†ã§ã™ // - ç‰¹å®šã®ãƒ‘ã‚¹ã¯å¿œç­”ã•ã›ãªã„ // ãªã© return path } func sendError(w http.ResponseWriter, message string, statusCode int) { w.WriteHeader(statusCode) resp := MCPResponse{ Status: \u0026#34;error\u0026#34;, Message: message, } json.NewEncoder(w).Encode(resp) } func sendSuccess(w http.ResponseWriter, message string, data interface{}) { resp := MCPResponse{ Status: \u0026#34;success\u0026#34;, Message: message, Data: data, } json.NewEncoder(w).Encode(resp) } ã‚³ãƒ¼ãƒ‰ã®è§£èª¬ æ§‹é€ ä½“å®šç¾©: MCPRequest: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ã™æ§‹é€ ä½“ã€‚ MCPResponse: ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ã™æ§‹é€ ä½“ã€‚ FileInfo: ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æƒ…å ±ã‚’è¡¨ã™æ§‹é€ ä½“ã€‚ ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ: /mcp ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹ handleMCP ã‚’ç™»éŒ²ã€‚ ãƒãƒ¼ãƒˆ 8080 ã§HTTPã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã€‚ ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†: CORSå¯¾å¿œã¨HTTPãƒ¡ã‚½ãƒƒãƒ‰ã®æ¤œè¨¼ï¼ˆOPTIONSã¨POSTã®ã¿è¨±å¯ï¼‰ã€‚ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’èª­ã¿å–ã‚Šã€MCPRequest ã«ãƒ‘ãƒ¼ã‚¹ã€‚ action ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«åŸºã¥ã„ã¦é©åˆ‡ãªå‡¦ç†é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã€‚ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã®å‡¦ç†: handleList: æŒ‡å®šã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å†…å®¹ã‚’ãƒªã‚¹ãƒˆåŒ–ã€‚ handleRead: æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’èª­ã¿å–ã‚‹ã€‚ handleWrite: æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãè¾¼ã‚€ã€‚ handleDelete: ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤ï¼ˆå†å¸°çš„å‰Šé™¤å¯¾å¿œï¼‰ã€‚ handleMkdir: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆï¼ˆå†å¸°çš„ä½œæˆå¯¾å¿œï¼‰ã€‚ è£œåŠ©é–¢æ•°: sanitizePath: ãƒ‘ã‚¹ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ï¼‰ã€‚ sendError: ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã€‚ sendSuccess: æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã€‚ MCP Server ã®å‹•ä½œç¢ºèª å‹•ä½œç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚JSON-RPC ã§ä¸‹è¨˜ã®è¦ç´ ã‚’å«ã‚ã¦ POST ã—ã¾ã™ã€‚\naction: ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ path: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æŒ‡å®š content: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å ´åˆã®ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ ã¾ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã¯ä¸‹è¨˜ã®è¦ç´ ãŒè¿”ã•ã‚Œã¾ã™ã€‚\nstatus: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ message: ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã®çµæœ MCP Server ã®èµ·å‹• å…ˆã»ã©æ›¸ã„ãŸ main.go ã‚’èµ·å‹•ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Š localhost ã® 8080 ç•ªãƒãƒ¼ãƒˆã§ãƒªã‚¹ãƒ³ã—ã¾ã™ã€‚\ngo run ./main.go ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãè¾¼ã¿ /tmp/file.txt ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®šã—ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ \u0026lsquo;Hello World\u0026rsquo; ã¨ã—ã¦ä¿å­˜ã—ã¦ã¿ã¾ã™ã€‚\ncurl -X POST http://localhost:8080/mcp -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{\u0026#34;action\u0026#34;:\u0026#34;write\u0026#34;,\u0026#34;path\u0026#34;:\u0026#34;/tmp/file.txt\u0026#34;,\u0026#34;content\u0026#34;:\u0026#34;Hello World\u0026#34;}\u0026#39; {\u0026#34;status\u0026#34;:\u0026#34;success\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;File written successfully\u0026#34;} status: success ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚\nãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€è¦§è¡¨ç¤º /tmp/foo ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚\ncurl -X POST http://localhost:8080/mcp -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{\u0026#34;action\u0026#34;:\u0026#34;list\u0026#34;,\u0026#34;path\u0026#34;:\u0026#34;/tmp/foo\u0026#34;}\u0026#39; {\u0026#34;status\u0026#34;:\u0026#34;success\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;Directory listed successfully\u0026#34;,\u0026#34;data\u0026#34;:[{\u0026#34;name\u0026#34;:\u0026#34;bar\u0026#34;,\u0026#34;size\u0026#34;:0,\u0026#34;mode\u0026#34;:\u0026#34;-rw-r--r--\u0026#34;,\u0026#34;modTime\u0026#34;:\u0026#34;2025-04-06 11:13:42\u0026#34;,\u0026#34;isDir\u0026#34;:false,\u0026#34;path\u0026#34;:\u0026#34;/tmp/foo/bar\u0026#34;}]} /tmp/foo ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã« bar ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚\nãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ /tmp/foo/bar ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’èª­ã¿è¾¼ã‚“ã§å‡ºåŠ›ã—ã¦ã„ã¾ã™ã€‚\ncurl -X POST http://localhost:8080/mcp -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{\u0026#34;action\u0026#34;:\u0026#34;read\u0026#34;,\u0026#34;path\u0026#34;:\u0026#34;/tmp/foo/bar\u0026#34;}\u0026#39; {\u0026#34;status\u0026#34;:\u0026#34;success\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;File read successfully\u0026#34;,\u0026#34;data\u0026#34;:\u0026#34;bar\\n\u0026#34;} ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ bar ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚\nAssistant ã®å®Ÿè£… ã“ã“ã‚‚è¨€èªã¯å•ã„ã¾ã›ã‚“ãŒè‡ªåˆ†ã¯ Python ã§è¨˜ã—ã¾ã—ãŸã€‚ä¸Šè¨˜æ§‹æˆå›³ã®å‡¦ç† (1)-(5) å…¨ã¦ã‚’ã“ã®ã‚³ãƒ¼ãƒ‰ã§è¡Œã„ã¾ã™ã€‚\nimport requests import json import os import argparse import sys from openai import OpenAI MCP_SERVER_URL = \u0026#34;http://localhost:8080/mcp\u0026#34; class MCPAssistant: def __init__(self, model: str = \u0026#34;gpt-4\u0026#34;, api_key: str = None): \u0026#34;\u0026#34;\u0026#34; Initialize AI assistant Args: model: Model name to use api_key: API key (uses environment variable if not specified) \u0026#34;\u0026#34;\u0026#34; self.model = model self.api_key = api_key or os.environ.get(\u0026#34;OPENAI_API_KEY\u0026#34;) if not self.api_key: raise ValueError(\u0026#34;OPENAI_API_KEY environment variable must be set\u0026#34;) self.client = OpenAI(api_key=self.api_key) self.conversation_history = [] self.tools = [ { \u0026#34;type\u0026#34;: \u0026#34;function\u0026#34;, \u0026#34;function\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;file_system_operation\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Operate on Linux filesystem\u0026#34;, \u0026#34;parameters\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;action\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34;, \u0026#34;enum\u0026#34;: [\u0026#34;list\u0026#34;, \u0026#34;read\u0026#34;, \u0026#34;write\u0026#34;, \u0026#34;delete\u0026#34;, \u0026#34;mkdir\u0026#34;], \u0026#34;description\u0026#34;: \u0026#34;Type of operation to perform\u0026#34; }, \u0026#34;path\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Path to file or directory\u0026#34; }, \u0026#34;content\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Content to write (for write action)\u0026#34; }, \u0026#34;recursive\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;boolean\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Whether to perform operation recursively (for delete/mkdir)\u0026#34; } }, \u0026#34;required\u0026#34;: [\u0026#34;action\u0026#34;, \u0026#34;path\u0026#34;] } } } ] def call_llm(self, user_input: str): \u0026#34;\u0026#34;\u0026#34;Call LLM and get response\u0026#34;\u0026#34;\u0026#34; system_message = \u0026#34;\u0026#34;\u0026#34;You are an AI assistant that can operate on a Linux filesystem. Understand the user\u0026#39;s natural language requests and translate them to appropriate filesystem operations. You can use the file_system_operation function to access the filesystem. Available operations: list, read, write, delete, mkdir \u0026#34;\u0026#34;\u0026#34; self.conversation_history.append({\u0026#34;role\u0026#34;: \u0026#34;user\u0026#34;, \u0026#34;content\u0026#34;: user_input}) messages = [{\u0026#34;role\u0026#34;: \u0026#34;system\u0026#34;, \u0026#34;content\u0026#34;: system_message}] + self.conversation_history return self.client.chat.completions.create( model=self.model, messages=messages, tools=self.tools, tool_choice=\u0026#34;auto\u0026#34; ) def call_mcp_server(self, params): \u0026#34;\u0026#34;\u0026#34;Call MCP server\u0026#34;\u0026#34;\u0026#34; try: response = requests.post( MCP_SERVER_URL, json=params, headers={\u0026#34;Content-Type\u0026#34;: \u0026#34;application/json\u0026#34;} ) if response.status_code == 200: return response.json() else: return { \u0026#34;status\u0026#34;: \u0026#34;error\u0026#34;, \u0026#34;message\u0026#34;: f\u0026#34;MCP server error: status code {response.status_code}\u0026#34;, \u0026#34;data\u0026#34;: None } except Exception as e: return { \u0026#34;status\u0026#34;: \u0026#34;error\u0026#34;, \u0026#34;message\u0026#34;: f\u0026#34;MCP server connection error: {str(e)}\u0026#34;, \u0026#34;data\u0026#34;: None } def process_response(self, llm_response): \u0026#34;\u0026#34;\u0026#34;Process LLM response and execute tool calls if any\u0026#34;\u0026#34;\u0026#34; assistant_message = llm_response.choices[0].message if hasattr(assistant_message, \u0026#39;tool_calls\u0026#39;) and assistant_message.tool_calls: self.conversation_history.append({ \u0026#34;role\u0026#34;: \u0026#34;assistant\u0026#34;, \u0026#34;content\u0026#34;: assistant_message.content or \u0026#34;\u0026#34;, \u0026#34;tool_calls\u0026#34;: [ { \u0026#34;id\u0026#34;: tool_call.id, \u0026#34;type\u0026#34;: tool_call.type, \u0026#34;function\u0026#34;: { \u0026#34;name\u0026#34;: tool_call.function.name, \u0026#34;arguments\u0026#34;: tool_call.function.arguments } } for tool_call in assistant_message.tool_calls ] }) for tool_call in assistant_message.tool_calls: if tool_call.function.name == \u0026#34;file_system_operation\u0026#34;: # Parse parameters params = json.loads(tool_call.function.arguments) print(f\u0026#34;Executing command: {params[\u0026#39;action\u0026#39;]} {params.get(\u0026#39;path\u0026#39;, \u0026#39;\u0026#39;)}\u0026#34;) mcp_response = self.call_mcp_server(params) self.conversation_history.append({ \u0026#34;role\u0026#34;: \u0026#34;tool\u0026#34;, \u0026#34;tool_call_id\u0026#34;: tool_call.id, \u0026#34;name\u0026#34;: tool_call.function.name, \u0026#34;content\u0026#34;: json.dumps(mcp_response) }) final_response = self.client.chat.completions.create( model=self.model, messages=[{\u0026#34;role\u0026#34;: \u0026#34;system\u0026#34;, \u0026#34;content\u0026#34;: \u0026#34;Explain the MCP server results in a human-readable way.\u0026#34;}] + self.conversation_history ) final_message = final_response.choices[0].message.content self.conversation_history.append({ \u0026#34;role\u0026#34;: \u0026#34;assistant\u0026#34;, \u0026#34;content\u0026#34;: final_message }) return final_message else: content = assistant_message.content or \u0026#34;\u0026#34; self.conversation_history.append({ \u0026#34;role\u0026#34;: \u0026#34;assistant\u0026#34;, \u0026#34;content\u0026#34;: content }) return content def main(): parser = argparse.ArgumentParser(description=\u0026#34;MCP AI Assistant\u0026#34;) parser.add_argument(\u0026#34;--model\u0026#34;, default=\u0026#34;gpt-4\u0026#34;, help=\u0026#34;Model to use\u0026#34;) parser.add_argument(\u0026#34;--api-key\u0026#34;, help=\u0026#34;API key (uses environment variable if not specified)\u0026#34;) args = parser.parse_args() try: assistant = MCPAssistant( model=args.model, api_key=args.api_key ) print(\u0026#34;MCP AI Assistant\u0026#34;) print(\u0026#34;===============================\u0026#34;) print(\u0026#34;Operate Linux filesystem using natural language\u0026#34;) print(\u0026#34;Type \u0026#39;exit\u0026#39; or \u0026#39;quit\u0026#39; to end\u0026#34;) print(\u0026#34;Example: \u0026#39;Show files in my home directory\u0026#39;\u0026#34;) print(\u0026#34;===============================\u0026#34;) while True: try: user_input = input(\u0026#34;\\n\u0026gt; \u0026#34;) if user_input.lower() in [\u0026#34;exit\u0026#34;, \u0026#34;quit\u0026#34;]: print(\u0026#34;Exiting.\u0026#34;) break if not user_input.strip(): continue llm_response = assistant.call_llm(user_input) final_response = assistant.process_response(llm_response) print(\u0026#34;\\nâ–¶ Assistant:\u0026#34;) print(final_response) except KeyboardInterrupt: print(\u0026#34;\\nExiting.\u0026#34;) break except Exception as e: print(f\u0026#34;\\nError occurred: {str(e)}\u0026#34;) except Exception as e: print(f\u0026#34;Initialization error: {str(e)}\u0026#34;) sys.exit(1) if __name__ == \u0026#34;__main__\u0026#34;: main() ã‚³ãƒ¼ãƒ‰ã®è§£èª¬ ã‚³ãƒ¼ãƒ‰ã‚’è§£èª¬ã—ã¾ã™ã€‚\nãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ã®å…¥åŠ›ã‚’å—ã‘ã€LLM ã« \u0026ldquo;MCP ã‚µãƒ¼ãƒã¨é€šä¿¡ã™ã‚‹ãŸã‚ã® JSON\u0026rdquo; ã‚’ç”Ÿæˆã—ã¦ã‚‚ã‚‰ã„ã€ãã‚Œã‚’ MCP Server ã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€‚çµæœã‚’å¾—ãŸã‚‰å†ã³ LLM ã«è§£é‡ˆã—ã¦ã‚‚ã‚‰ã„è‡ªç„¶è¨€èªã®å¿œç­”ã‚’å¾—ã¾ã™ã€‚ãã®çµæœã‚’ãƒ¦ãƒ¼ã‚¶ã«å‡ºåŠ›ã—ã¦å‡¦ç†ã¯å®Œäº†ã§ã™ã€‚\nå®šæ•°å®šç¾©: MCP_SERVER_URL: MCPã‚µãƒ¼ãƒãƒ¼ã®URLã‚’å®šç¾©ã€‚ MCPAssistantã‚¯ãƒ©ã‚¹: init: ãƒ¢ãƒ‡ãƒ«åã¨APIã‚­ãƒ¼ã‚’åˆæœŸåŒ–ã€‚ ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ“ä½œç”¨ã®ãƒ„ãƒ¼ãƒ«ï¼ˆfile_system_operationï¼‰ã‚’å®šç¾©ã€‚ call_llm: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’LLMï¼ˆGPT-4ï¼‰ã«é€ä¿¡ã—ã€å¿œç­”ã‚’å–å¾—ã€‚ ãƒ„ãƒ¼ãƒ«ï¼ˆfile_system_operationï¼‰ã‚’åˆ©ç”¨å¯èƒ½ã«è¨­å®šã€‚ call_mcp_server: MCPã‚µãƒ¼ãƒãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å–å¾—ã€‚ process_response: LLMã®å¿œç­”ã‚’å‡¦ç†ã€‚ å¿…è¦ã«å¿œã˜ã¦ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’å®Ÿè¡Œã—ã€MCPã‚µãƒ¼ãƒãƒ¼ã¨é€£æºã€‚ æœ€çµ‚çš„ãªå¿œç­”ã‚’ç”Ÿæˆã€‚ å‹•ä½œç¢ºèª ã§ã¯ Assistant ã®å‹•ä½œç¢ºèªã‚’è¡Œã£ã¦ã„ãã¾ã™ã€‚ä¸‹è¨˜ã®é€šã‚Šã€ãƒ¦ãƒ¼ã‚¶ã®å…¥åŠ›ã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¶Šã—ã«è‡ªç„¶è¨€èªã§è¡Œã„ã¾ã™ã€‚ã¾ãŸæœ€çµ‚çš„ãª LLM ã‹ã‚‰ã®å¿œç­”ã‚‚è‡ªç„¶è¨€èªã§ã™ã€‚\nä¸‹è¨˜ã¯è‡ªç„¶è¨€èªã§ /tmp/foo ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å¾—ã¦ã„ã¾ã™ã€‚\n$ python assistant.py =============================== Operate Linux filesystem using natural language Type \u0026#39;exit\u0026#39; or \u0026#39;quit\u0026#39; to end Example: \u0026#39;Show files in my home directory\u0026#39; =============================== \u0026gt; /tmp/foo ã®ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å‡ºåŠ›ã—ã¦ Executing command: list /tmp/foo â–¶ Assistant: The MCP server has successfully obtained the list of files under `/tmp/foo`. There is one file, named `bar`, with a size of 4 bytes. Its permissions are set to `-rw-r--r--`, which means that the owner can read and write the file, while others can only read it. The last modification date and time is April 6th, 2025 at 11:14:42. This is not a directory. ä¸‹è¨˜ã¯ /tmp/foo/buzz ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†…å®¹ \u0026lsquo;buzz\u0026rsquo; ã¨ã—ã¦ä¿å­˜ã™ã‚‹ã‚ˆã†ã«æŒ‡ç¤ºã—ã¦ã„ã¾ã™ã€‚\n\u0026gt; å†…å®¹\u0026#39;buzz\u0026#39;ã¨ã—ã¦/tmp/foo/buzzã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦ Executing command: write /tmp/foo/buzz â–¶ Assistant: The MCP server was instructed to create a file named \u0026#34;buzz\u0026#34; located in the \u0026#34;/tmp/foo\u0026#34; directory with the content \u0026#34;buzz\u0026#34;. The operation was successful and the file was written without any issues. ä¸‹è¨˜ã¯ä¸Šè¨˜ã§ä¿å­˜ãƒ»ç”Ÿæˆã—ãŸ /tmp/foo/buzz ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§å†…å®¹ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚\n\u0026gt; /tmp/foo/buzzã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ Executing command: read /tmp/foo/buzz â–¶ Assistant: The MCP server was asked to read the file named \u0026#34;buzz\u0026#34; located in the \u0026#34;/tmp/foo\u0026#34; directory. The operation was successful and the content of the file is \u0026#34;buzz\u0026#34;. è€ƒå¯Ÿ Platform ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ãŠã‘ã‚‹å¿œç”¨ ä»Šå›ã¯å­¦ç¿’ç›®çš„ã ã£ãŸã®ã§ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãä»•çµ„ã¿ã‚’ç†è§£ã—ã¦ãã¾ã—ãŸã€‚\nã“ã‚Œã¯è‡ªåˆ†ã®ã‚ˆã†ãª Platform ç³»ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã‚‚ååˆ†å¿œç”¨ã§ãã‚‹æŠ€è¡“ã ã¨æ€ã£ã¦ã„ã¦ã€æ™®æ®µä½¿ã£ã¦ã„ã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚„ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ‰±ã† MCP ã‚µãƒ¼ãƒã‚’å®Ÿè£…ã™ã‚Œã°ã€LLM ã‚’ä»‹ã™äº‹ã§è‡ªç„¶è¨€èªã§ãã‚Œã‚‰ã®æ©Ÿèƒ½ã‚’æ“ä½œã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹æ§˜ã«ãªã‚Šã¾ã™ã€‚\nä¾‹ãˆã°ä¾‹ã‚’æŒ™ã’ã‚‹ã¨ã€\nAWS Athena ã® MCP Server å®Ÿè£… S3 ä¸Šã®ãƒ­ã‚°ã‚’è‡ªç„¶è¨€èªã§åˆ†æå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚‹ Datadog Metrics, Logs ã® MCP Server å®Ÿè£… Datadog Metrics ã‚„ Logs ã®å‚¾å‘ã‚’è‡ªç„¶è¨€èªã§åˆ†æå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚‹ ã“ã‚Œã‚‰ã‚’é€šã˜ã¦\nå¯ç”¨æ€§ã‚„ä¿¡é ¼æ€§ã«é–¢ã‚ã‚‹æƒ…å ±ã®åˆ†æ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç•°å¸¸ãªã©ã®åˆ†æãƒ»æ¤œçŸ¥ ãªã©ã®å¿œç”¨ãŒåŠ¹ãã¨ã‚‚æ€ã£ã¦ã„ã¾ã™ã€‚\nãŸã¨ãˆã°ã€\nSlack Bot ã«ä»Šå›ã®æ§‹æˆã® Assitant ã®å®Ÿè£…ã‚’ã™ã‚‹ Lambda ã§ MCP Server ã‚’èµ·å‹•ã™ã‚‹ ã¨ã„ã†æ§‹æˆã‚’å–ã‚Œã°ã€è‡ªç„¶è¨€èªã§ Slack Bot ã«ã€Œæ˜¨æ—¥ä¸€æ—¥é–“ã® ALB/WAF ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚¢ã‚¯ã‚»ã‚¹å‚¾å‘ã‚’ãƒ¬ãƒãƒ¼ãƒˆã—ã¦ã€ã¨ã„ã£ãŸæŒ‡ç¤ºã‚‚å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ Platform ç³»ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã¨ã£ã¦ã‚‚ã¨ã¦ã‚‚ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã®ã‚ã‚‹æ©Ÿèƒ½ã ã¨æ€ã£ã¦ã„ã¾ã™ã€‚\nä»Šå¾Œã® MCP ã‚µãƒ¼ãƒã®é–‹ç™º å½“åˆã¯è‡ªå‰ã§ MCP ã‚µãƒ¼ãƒã‚’å®Ÿè£…ã™ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒå¢—ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚ãŸã ã“ã‚Œã¯ MCP ã‚µãƒ¼ãƒã®æ“ä½œå…ˆãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒ»ã‚µãƒ¼ãƒ“ã‚¹æ¯ã«æ±ç”¨çš„ã«ã‚‚é–‹ç™ºå‡ºæ¥ã‚‹ã¨æ€ã†ã®ã§ã€å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãŒå…¬å¼ã« MCP Server ã®å®Ÿè£…ã‚’ã—ã¦å…¬é–‹ã™ã‚‹ã¨ã„ã†æµã‚Œã‚‚æƒ³å®šã•ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚å®Ÿéš› 2025/04 ã«ã¯ AWS ãŒå…¬å¼ã§ MCP Server ã‚’å…¬é–‹ã—ãŸã¨ã„ã†æƒ…å ±ã‚’å¾—ã¾ã—ãŸã€‚ https://awslabs.github.io/mcp/\n","permalink":"https://jedipunkz.github.io/post/2025/04/06/local-filesystem-mcp-server/","summary":"\u003cp\u003eè‡ªåˆ†ã¯ Platform Enabler/SRE ã¨ã—ã¦å¾“äº‹ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸ AI é–¢é€£ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¯2025å¹´ã«å…¥ã£ã¦ã‚‚å±ã«æ›´æ–°ã•ã‚Œã¦ã„ã¾ã™ã€‚2025å¹´åˆé ­ã«ãŠã„ã¦ã¯è‡ªåˆ†ãŸã¡ã®åˆ†é‡ã§ã‚‚ AI é–¢é€£ã®åˆ©ç”¨ã«é–¢ã—ã¦æ§˜ã€…ãªæ¨¡ç´¢ãŒã‚ã‚‹çŠ¶æ³ã ã¨æ€ã‚ã‚Œã¾ã™ãŒã€Ahthoropic ç¤¾ãŒæå”±ã—ãŸ MCP (Model Context Protocol) ãŒã‚‚ãŸã‚‰ã™ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«é™å®šã•ã‚Œãšã‚¤ãƒ³ãƒ•ãƒ©é ˜åŸŸã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ã‚‚å¤§ããªãƒ¡ãƒªãƒƒãƒˆã‚’ã‚‚ãŸã‚‰ã™ã¨æ€ã£ã¦è¦³æ¸¬ã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã“ã®è¨˜äº‹ã§ã¯ã€MCP ã®æ¦‚è¦ã¨ã©ã†å®Ÿè£…ã™ã‚‹ã®ã‹ã®å­¦ç¿’ã€ã¾ãŸã©ã†æˆ‘ã€…ã®ã‚ˆã†ãª Platform Enabler/SRE ã«ã¨ã£ã¦ã®æ´»ç”¨ä¾‹ãŒã‚ã‚‹ã‹ã‚’è€ƒå¯Ÿã—ã¦ã„ããŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"mcp-ã®æ¦‚è¦\"\u003eMCP ã®æ¦‚è¦\u003c/h2\u003e\n\u003cp\u003eMCP (Model Context Protocol) ã¯ã€AI ãƒ¢ãƒ‡ãƒ«ã¨å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é–“ã®ã‚„ã‚Šå–ã‚Šã‚’åŠ¹ç‡åŒ–ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ JSON-RPC ã§ã‚„ã‚Šã¨ã‚Šã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªç„¶è¨€èªå…¥åŠ›ã‚’åŸºã«ã€AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆãŒ MCP ã‚µãƒ¼ãƒãƒ¼ã‚’é€šã˜ã¦ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã‚„ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€è¿‘ OpenAI ç¤¾ã‚‚ã“ã® Anthropic ç¤¾ã® MCP ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã¨ã„ã†ãƒ‹ãƒ¥ãƒ¼ã‚¹ãŒæµã‚Œã€é€”ç«¯ã«æ³¨ç›®ã‚’é›†ã‚ã‚‹çŠ¶æ³ã«ãªã£ã¦ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ch3 id=\"å‡¦ç†ã®æµã‚Œ\"\u003eå‡¦ç†ã®æµã‚Œ\u003c/h3\u003e\n\u003cp\u003eã“ã“ã¯ã‚ãã¾ã§ã®ä¸€ä¾‹ã§ã™ã€‚Assistant ã®å®Ÿè£…ã§ã„ã‹ã‚ˆã†ã«ã‚‚å‡ºæ¥ã‚‹ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+-------------+          +-----------+      +------------+   +--------+\n| User Prompt | \u0026lt;-----\u0026gt;  | Assistant | ---\u0026gt; | MCP Server |   | AI API |\n+-------------+ (1),(5)  +-----------+  (3) +------------+   +--------+\n                               |                                  ^\n                               |             (2),(4)              |\n                               +----------------------------------+\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e(1) ãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ã®å…¥åŠ›ã‚’ Assistant ãŒå—ã‘å–ã‚‹\u003c/li\u003e\n\u003cli\u003e(2) Assistant ã¯ãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ã®è‡ªç„¶è¨€èªã‚’ LLM ã«å•ã„åˆã‚ã›ã€‚ãã®éš›ã« LLM ã«å¤–éƒ¨æ©Ÿèƒ½ã‚’å®šç¾© (JSON-RPC(MCP ã‚µãƒ¼ãƒãŒå—ã‘å–ã‚‹))\u003c/li\u003e\n\u003cli\u003e(3) Aasistant ã¯ MCP Server ã« JSON-RPC ã§ã‚¯ã‚¨ãƒªé€ä¿¡ã—ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¾—ã‚‹\u003c/li\u003e\n\u003cli\u003e(4) Assistant ã¯ MCP Server ã‹ã‚‰å¾—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å†ã³ LLM ã«é€ä¿¡ã—è‡ªç„¶è¨€èªã¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ã«è¿”ã™å†…å®¹ã‚’ç”Ÿæˆã—ã¦ã‚‚ã‚‰ã†\u003c/li\u003e\n\u003cli\u003e(5) Assistant ã¯ãƒ¦ãƒ¼ã‚¶ã«è‡ªç„¶è¨€èªã§çµæœã‚’å¿œç­”ã™ã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å‰æ\"\u003eå‰æ\u003c/h2\u003e\n\u003cp\u003eMCP å­¦ç¿’ã‚’ç›®çš„ã«ã—ã¦ã„ã‚‹ã®ã§ã€ã“ã“ã§ã¯è©±ã‚’ç°¡æ½”ã«ã™ã‚‹ãŸã‚ Linux Filesystem ã‚’æ“ä½œã™ã‚‹ MCP Server ã‚’æ›¸ãã€ç†è§£ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e","title":"MCP ã®ç†è§£: Platform Enabler/SRE ã§ã®æ´»ç”¨"},{"content":"jedipunkz ã§ã™ã€‚VPC Lattice ãŒ ECS ã«å¯¾å¿œã—ãŸã¨ã„ã†æƒ…å ±ãŒ https://aws.amazon.com/jp/about-aws/whats-new/2024/11/amazon-vpc-lattice-elastic-container-service/ ã«ã‚ãŒã‚Šã¾ã—ãŸã€‚ã“ã®å¯¾å¿œã‚’ Terraform ã‚’ä½¿ã£ã¦æ§‹æˆã—ã¦æ¤œè¨¼ã—ã¦ã¿ã‚‹ã®ãŒä»Šå›ã®ç›®çš„ã«ãªã‚Šã¾ã™ã€‚\nä»Šå›æ¤œè¨¼ã§ç”¨ã„ãŸã‚³ãƒ¼ãƒ‰ æ¤œè¨¼ã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã«ç½®ã„ã¦ãŠãã¾ã—ãŸã€‚ https://github.com/jedipunkz/vpclattice-ecs-playground\næ¦‚è¦ æ§‹æˆã®æ¦‚è¦ã¨ã—ã¦ã¯ä¸‹è¨˜ã§ã™ã€‚(Mermaid è¨˜è¡¨ã§ã†ã¾ãæã‘ã¦ã„ã¾ã›ã‚“ãŒ)\nVPC1, VPC2 ã«è·¨ã‚‹å½¢ã§ VPC Lattice Service Network ãŒé…ç½® VPC2 ä¸Šã®ä½•è€…ã‹ (ä¾‹ã§ EC2) ãŒ VPC1 ä¸Šã® ECS ã«æ¥ç¶šå¯èƒ½ ãã®éš›ã¯ VPC Service Network ã‚’ä»‹ã—ã¦ VPC Lattice Service ãŒã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦å—ã‘ã‚‹ (ã†ã¾ãæã‘ã¦ãªã„) ã¨ã„ã†äº‹ã¯ä»Šã¾ã§è¤‡æ•°ã® VPC é–“ã§ ECS ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å…±æœ‰ã—ã‚ˆã†ã¨ã™ã‚‹ã¨\nVPC1, VPC2 ã¨ã§ VPC Peering ã‚’å¼µã‚‹ VPC1 ä¸Šã® Private Subnets ä¸Šã§ ALB ã‚’æ§‹ç¯‰ã—ã¦ ECS Service ã«æ¥ç¶šã™ã‚‹ ã¨ã„ã†æ§‹æˆãŒå¿…è¦ã§ã—ãŸãŒã€VPC Lattice ã‚’ä½¿ãˆã°ãã‚Œã‚‰ãŒä¸è¦ã«ãªã‚‹ã€ã¨ã„ã†äº‹ã§ã™ã€‚\nä»Šå›æ¤œè¨¼ã—ãŸæ§‹æˆ ä»Šå›ä½¿ã£ãŸ Terraform ã‚³ãƒ¼ãƒ‰ã§æ§‹ç¯‰ã—ãŸæ§‹æˆã¯ä¸‹è¨˜ã§ã™ã€‚å„ AWS ãƒªã‚½ãƒ¼ã‚¹ã®é–¢ä¿‚å›³ã«ãªã£ã¦ã„ã¾ã™ã€‚ ç‰¹å¾´ã¨ã—ã¦ã¯\nECS æ§‹æˆã¯ Cluster, Service ,Task ã®é€šå¸¸ã®æ§‹æˆ ECS Service ã« ALB ã§ã¯ãªã VPC Lattice Target Group ãŒç´ã¥ã„ã¦ã„ã‚‹ VPC Lattice Listner ãŒ VPC Lattice Service ã¨ VPC Lattice Target Group ã‚’ç´ã¥ã‘ã¦ã„ã‚‹ VPC Lattice Listner ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ VPC Lattice Target Group ã«è»¢é€ ãªãŠã‹ã¤ VPC Lattice Listener ã«ã¯ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ãŒã‚ã‚‹ Terraform ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦æŠŠæ¡ã™ã‚‹ æ§‹æˆã‚’ç†è§£ã™ã‚‹ãŸã‚ã«å„ãƒªã‚½ãƒ¼ã‚¹ã®ç´ã¥ã‘ã®æŒ‡å®šã‚’è¦³ç‚¹ã«ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚\nECS ã¨ VPC Lattice Target Group ã®ç´ã¥ã‘ ECS Service ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ã€‚é€šå¸¸ã¯ ALB ã‚’æ¥ç¶šã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›¸ãã¨æ€ã†ã®ã§ã™ãŒã€VPC Lattice ã®å ´åˆã¯ vpc_lattice_configrations ã¨ãªã‚Šã¾ã™ã€‚\nvpc_lattice_configurations { role_arn = aws_iam_role.ecs_infrastructure.arn target_group_arn = aws_vpclattice_target_group.main.arn port_name = \u0026#34;web-80-tcp\u0026#34; } VPC Lattice Listener ã® VPC Lattice Service, VPC Lattice Target Group ã®ç´ã¥ã‘ VPC Lattice Listener ãŒ VPC Lattice Service ã¨ VPC Lattice Target Group ã‚’ç´ã¥ã‘ã¦ã„ã‚‹è¨˜è¿°ãŒä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚ ã¤ã¾ã‚Šã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã‚ã‚‹ VPC Lattice Service ãŒ Listener, VPC Lattice Target Group ã‚’ä»‹ã—ã¦ ECS Service ã«æ¥ç¶šã—ã¦ã„ã‚‹ã€ã¨ã„ã†äº‹ã§ã™ã€‚\nresource \u0026#34;aws_vpclattice_listener\u0026#34; \u0026#34;main\u0026#34; { name = \u0026#34;http-80\u0026#34; port = 80 protocol = \u0026#34;HTTP\u0026#34; service_arn = aws_vpclattice_service.main.arn service_identifier = aws_vpclattice_service.main.id default_action { forward { target_groups { target_group_identifier = aws_vpclattice_target_group.main.id weight = 1 } } } } VPC Lattice Service Network ã¨ VPC Lattice Service ã®ç´ã¥ã‘ ä¸‹è¨˜ã®ã‚ˆã†ãªè¨˜è¿°ã§ VPC Lattice Service Network ã¨ VPC Latice Serivce ãŒç´ã¥ã„ã¦ã„ã¾ã™ã€‚\nresource \u0026#34;aws_vpclattice_service_network_service_association\u0026#34; \u0026#34;service_association\u0026#34; { service_network_identifier = aws_vpclattice_service_network.main.id service_identifier = aws_vpclattice_service.main.id } VPC ã¨ VPC Lattice Service Network ã®ç´ã¥ã‘ VPC ã¨ VPC Lattice Service Network ãŒç´ã¥ã„ã¦ã„ã¾ã™ã€‚ã¾ãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ãŒè¨­å®šã•ã‚Œã¦ã„ã¦ã€VPC Lattice Service Network ã¸ã®é€šä¿¡ãŒåˆ¶å¾¡ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚\nresource \u0026#34;aws_vpclattice_service_network_vpc_association\u0026#34; \u0026#34;vpc_association\u0026#34; { security_group_ids = [aws_security_group.lattice_service_network.id] service_network_identifier = aws_vpclattice_service_network.main.id vpc_identifier = module.vpc.vpc_id } è€ƒå¯Ÿ å°å…¥ãƒ¡ãƒªãƒƒãƒˆã®è¦³ç‚¹ è¤‡æ•°ã® VPC é–“ã§ ECS Serivce ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æ¥ç¶šå‡ºæ¥ã‚‹ã®ã¯ãƒ¡ãƒªãƒƒãƒˆã ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãŒä¸è¦ã«ãªã£ãŸã“ã¨ã‚‚å¤§ãã„ã§ã™ã€‚ãŸã ã”å­˜çŸ¥ã®ã‚ˆã†ã« ALB ã¯å†…éƒ¨ãƒãƒ¼ãƒ‰ãŒæ‹¡å¼µã™ã‚‹ã“ã¨ã§ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã™ã‚‹ã®ã§ã™ãŒ VPC Lattice Service ã‚‚æ‹¡å¼µæ€§ã‚’å‚™ãˆã¦ã„ã‚‹ã®ã‹ã¯æ°—ã«ãªã‚Šã¾ã™ã€‚\nãƒ‘ãƒ–ãƒªãƒƒã‚¯ã«ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å‡ºã›ã‚‹ã®ã‹ã®è¦³ç‚¹ ã¾ãŸä»Šå›ã¯ Private Subnet ä¸Šã§æ§‹æˆã—ã¾ã—ãŸã€‚ç¢ºã‹ã« VPC ä¸Šã« EC2 ç­‰ã‚’èµ·å‹•ã—ã¦ VPC Lattice Service ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã« curl ã‚’ä½¿ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã¾ã—ãŸãŒã€ã“ã®æ§‹æˆãŒ Public Subnet ä¸Šã«å±•é–‹å‡ºæ¥ã‚‹ã®ã‹ã¯ã¾ã è‡ªåˆ†ã¯åˆ†ã‹ã£ã¦ã„ã¾ã›ã‚“ã€‚è»½ã Public Subnet ã‚’æŒ‡å®šã—ã¦æ§‹ç¯‰ã—ã¦ã¿ã¾ã—ãŸãŒå¤–éƒ¨ã‹ã‚‰ curl ã§ VPC Lattice Service ã«æ¥ç¶šå‡ºæ¥ã¾ã›ã‚“ã§ã—ãŸã€‚DNS çš„ãªå•é¡ŒãŒç¾ã‚Œã¾ã—ãŸã€‚ã¾ãŸ ECS Service ã¯ Subnet ã®æŒ‡å®šã‚’ã—ã¦ã„ã¾ã™ãŒ Lattice é–¢é€£ã®ãƒªã‚½ãƒ¼ã‚¹ã¯ã‚µãƒ–ãƒãƒƒãƒˆã®æŒ‡å®šç®‡æ‰€ãŒç„¡ã„ã“ã¨ã«æ°—ãŒä»˜ãã¾ã™ã€‚(ã‚‚ã—ã‹ã™ã‚‹ã¨ Terraform Document ç­‰å‘¼ã‚“ã§ã„ãã¨æŒ‡å®šç®‡æ‰€ãŒã‚ã‚‹ã®ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ãŒ)ã€‚ã§ã™ãŒ VPC ã«è·¨ã‚‹å½¢ã§é…ç½®ã•ã‚Œã‚‹ Lattice ã®ç‰¹å¾´ã‚’è€ƒãˆã‚‹ã¨å‡ºæ¥ãªã„æ°—ã‚‚ã—ã¾ã™ã€‚ã“ã®ã‚ãŸã‚Šã¯å¼•ãç¶šãèª¿æŸ»ã—ã¾ã™ã€‚\nå‚™è€ƒ aws ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®å•é¡Œ ã¡ã‚‡ã†ã©å…ˆé€±ç™ºè¡¨ã•ã‚ŒãŸæ©Ÿèƒ½ãªã®ã§ä»•æ–¹ãªã„ã®ã§ã™ãŒç¾æ™‚ç‚¹ã§ã¯ aws ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®æ©Ÿèƒ½ã«ä¸ååˆ†ãªç‚¹ãŒè¦‹å—ã‘ã‚‰ã‚Œã¾ã—ãŸ (2024/11æ™‚ç‚¹)\nECS Service ã® VPC Lattice ã®è¨­å®šç”»é¢ã§ VPC ã‚’é¸æŠã™ã‚‹äº‹ãŒã§ãã‚‹ãŒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸æŠã§ããªã„ã®ã§ default ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã«ãªã£ã¦ã—ã¾ã† ECS Service ã® VPC Lattice ã®è¨­å®šç”»é¢ã§ä¸€åº¦è¨­å®šã—ãŸ Lattice Target Group ã‚’å‰Šé™¤ã—ã¦ä¿å­˜ã€‚ãã®å¾Œã€åŒã˜ç”»é¢ã§æ—¢å­˜ã® Lattice Target Group ã‚’é¸æŠå‡ºæ¥ãªã„ã®ã§æ–°ãŸã«ä½œã‚‰ãªãã¦ã¯ã„ã‘ãªã„ Terraform æ¤œè¨¼ã«ã‚ãŸã‚Šæ³¨æ„ç‚¹ æ‰‹é †ã‚’é–“é•ã†ã¨ eni ãŒå‰Šé™¤å‡ºæ¥ãªã„å•é¡Œã«é­é‡ã™ã‚‹ã¨æ€ã„ã¾ã™ã€‚terraform destroy ã™ã‚‹ã¨ä¸‹è¨˜ã®ãƒªã‚½ãƒ¼ã‚¹ãŒä¸»ã«æ®‹ã‚Šã¾ã™ã€‚ãŠãã‚‰ã Terraform AWS Provider ã®ä¸å…·åˆãªæ°—ã¯ã—ã¦ã„ã¾ã™ãŒç¢ºèªã—ãŸã¨ã“ã‚ Issue ã«ã¯å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚æ–°ã—ã„ä¸å…·åˆãªå¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®æ™‚ç‚¹ã§ aws ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§é †ã«ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã‚ˆã†ã¨è€ƒãˆã‚‹ã¨æ€ã†ã®ã§ã™ãŒ ECS Cluster ã‚’å‰Šé™¤ã—ã¦ã‚‚ ECS Service ã® Attacment? ãƒªã‚½ãƒ¼ã‚¹ãŒæ®‹ã‚Šã€çµæœ eni ãŒæ¶ˆã›ã¾ã›ã‚“ã€‚eni ãŒæ¶ˆã›ãªã„ã®ã§ IGW, Subnet, VPC ã‚‚æ¶ˆã›ãªã„ã€ã¨ã„ã†çŠ¶æ³ã«ãªã‚Šã¾ã™ã€‚\nVPC Subnet IGW ECS Cluster ECS Service ","permalink":"https://jedipunkz.github.io/post/vpclattice-ecs/","summary":"\u003cp\u003ejedipunkz ã§ã™ã€‚VPC Lattice ãŒ ECS ã«å¯¾å¿œã—ãŸã¨ã„ã†æƒ…å ±ãŒ \u003ca href=\"https://aws.amazon.com/jp/about-aws/whats-new/2024/11/amazon-vpc-lattice-elastic-container-service/\"\u003ehttps://aws.amazon.com/jp/about-aws/whats-new/2024/11/amazon-vpc-lattice-elastic-container-service/\u003c/a\u003e ã«ã‚ãŒã‚Šã¾ã—ãŸã€‚ã“ã®å¯¾å¿œã‚’ Terraform ã‚’ä½¿ã£ã¦æ§‹æˆã—ã¦æ¤œè¨¼ã—ã¦ã¿ã‚‹ã®ãŒä»Šå›ã®ç›®çš„ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä»Šå›æ¤œè¨¼ã§ç”¨ã„ãŸã‚³ãƒ¼ãƒ‰\"\u003eä»Šå›æ¤œè¨¼ã§ç”¨ã„ãŸã‚³ãƒ¼ãƒ‰\u003c/h2\u003e\n\u003cp\u003eæ¤œè¨¼ã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã«ç½®ã„ã¦ãŠãã¾ã—ãŸã€‚\n\u003ca href=\"https://github.com/jedipunkz/vpclattice-ecs-playground\"\u003ehttps://github.com/jedipunkz/vpclattice-ecs-playground\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"æ¦‚è¦\"\u003eæ¦‚è¦\u003c/h2\u003e\n\u003cp\u003eæ§‹æˆã®æ¦‚è¦ã¨ã—ã¦ã¯ä¸‹è¨˜ã§ã™ã€‚(Mermaid è¨˜è¡¨ã§ã†ã¾ãæã‘ã¦ã„ã¾ã›ã‚“ãŒ)\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eVPC1, VPC2 ã«è·¨ã‚‹å½¢ã§ VPC Lattice Service Network ãŒé…ç½®\u003c/li\u003e\n\u003cli\u003eVPC2 ä¸Šã®ä½•è€…ã‹ (ä¾‹ã§ EC2) ãŒ VPC1 ä¸Šã® ECS ã«æ¥ç¶šå¯èƒ½\u003c/li\u003e\n\u003cli\u003eãã®éš›ã¯ VPC Service Network ã‚’ä»‹ã—ã¦ VPC Lattice Service ãŒã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦å—ã‘ã‚‹ (ã†ã¾ãæã‘ã¦ãªã„)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã¨ã„ã†äº‹ã¯ä»Šã¾ã§è¤‡æ•°ã® VPC é–“ã§ ECS ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å…±æœ‰ã—ã‚ˆã†ã¨ã™ã‚‹ã¨\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eVPC1, VPC2 ã¨ã§ VPC Peering ã‚’å¼µã‚‹\u003c/li\u003e\n\u003cli\u003eVPC1 ä¸Šã® Private Subnets ä¸Šã§ ALB ã‚’æ§‹ç¯‰ã—ã¦ ECS Service ã«æ¥ç¶šã™ã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã¨ã„ã†æ§‹æˆãŒå¿…è¦ã§ã—ãŸãŒã€VPC Lattice ã‚’ä½¿ãˆã°ãã‚Œã‚‰ãŒä¸è¦ã«ãªã‚‹ã€ã¨ã„ã†äº‹ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"VPC Lattice Overview\" loading=\"lazy\" src=\"../../pix/vpclattice-overview.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"ä»Šå›æ¤œè¨¼ã—ãŸæ§‹æˆ\"\u003eä»Šå›æ¤œè¨¼ã—ãŸæ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eä»Šå›ä½¿ã£ãŸ Terraform ã‚³ãƒ¼ãƒ‰ã§æ§‹ç¯‰ã—ãŸæ§‹æˆã¯ä¸‹è¨˜ã§ã™ã€‚å„ AWS ãƒªã‚½ãƒ¼ã‚¹ã®é–¢ä¿‚å›³ã«ãªã£ã¦ã„ã¾ã™ã€‚\nç‰¹å¾´ã¨ã—ã¦ã¯\u003c/p\u003e","title":"VPC Lattice + ECS æ§‹æˆã‚’ Terraform ã‚’é€šã—ã¦ç†è§£"},{"content":"OpenTelemetry ã‚’ä½¿ã£ã¦ AWS (X-Ray, Cloudwatch Logs) ã«ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ãƒ­ã‚°ã‚’è¨ˆè£…ã™ã‚‹äº‹ã«èˆˆå‘³ãŒã‚ã£ãŸã®ã§èª¿ã¹ãŸå†…å®¹ã‚’è¨˜ãã†ã¨æ€ã„ã¾ã™ã€‚\næ§‹æˆ ä»Šå›æ¤œè¨¼ã—ã¦ã¿ãŸæ§‹æˆã¯ä¸‹è¨˜ã®æ§˜ãªæ§‹æˆã§ã™ã€‚AWS ã‚’ç”¨ã„ãŸå ´åˆ ECS ã‚„ EKS, Lambda ã§ Go ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹äº‹ãŒé€šå¸¸ã§ã™ãŒã€ä»Šå›ã¯ docker-compose ã§æ¤œè¨¼ã—ã¾ã—ãŸã€‚ãŸã  ECS, EKS ã«ç½®ãæ›ãˆã‚‹ã®ã¯æ¯”è¼ƒçš„ç°¡å˜ã ã¨æ€ã„ã¾ã™ã€‚\ntrace post PutTelemetryRecords +--------+ +----------------+ +-----------------+ | Go App | -+-\u0026gt; | Otel Collector | ---\u0026gt; | AWS X-Ray | +--------+ | +----------------+ +-----------------+ | +----------------+ +-----------------+ +-\u0026gt; | Fluent-Bit | ---\u0026gt; | Cloudwatch Logs | +----------------+ +-----------------+ PutLogEvents ãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚¹ã®ç´ã¥ã‘ ãƒ­ã‚°ã¯ Cloudwatch Logs ã¸ã€ãƒˆãƒ¬ãƒ¼ã‚¹æƒ…å ±ã¯ AWS X-Ray ã¸è»¢é€ã—ã¾ã™ãŒã€ã“ã®ãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ç´ä»˜ã‘ã‚‹ã¨ã€é‹ç”¨ã™ã‚‹ä¸Šã§è¿½è·¡ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚ã“ã®ç´ã¥ã‘ã¯ AWS ã®å ´åˆã¯ç°¡å˜ã§ä¸‹è¨˜ã®è¦ä»¶ã‚’æº€ãŸã›ã°ç´ã¥ã‘ãŒã•ã‚Œã¾ã™ã€‚\nãƒˆãƒ¬ãƒ¼ã‚¹ ID ã¯ Otel å½¢å¼ã‹ã‚‰ X-Ray å½¢å¼ã«å¤‰æ›ã—ã¦ (ä¸‹è¨˜ IdOtel2Xray() é–¢æ•°) ãƒˆãƒ¬ãƒ¼ã‚¹é€ä¿¡ (å‚è€ƒ: https://zenn.dev/k6s4i53rx/articles/69ef65b84dd799) ãƒˆãƒ¬ãƒ¼ã‚¹ ID ã‚’ãƒ­ã‚°ã«åŸ‹ã‚è¾¼ã‚€ (ä¸‹è¨˜ log.Printf() ) OpenTelemetry Exporter ãŒåˆæœŸåŒ–ã®éš›ã«æ¯å›ç”¨ã„ã‚‰ã‚Œã‚‹ OpenTelemetry ãƒªã‚½ãƒ¼ã‚¹ä½œæˆã®éš›ã«ãƒªã‚½ãƒ¼ã‚¹å±æ€§ã¨ã—ã¦ Cloudwatch Log Group ã‚’æŒ‡å®š Go ã‚¢ãƒ—ãƒª æ—©é€Ÿã§ã™ãŒãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚¹æƒ…å ±ã‚’ç´ã¥ã‘ã—ã¤ã¤ AWS ã«é€ä¿¡ã™ã‚‹ Go ã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰ã®ä¾‹ã‚’è¨˜ã—ã¾ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒªã¯ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã§èµ·å‹•ã—ã¦ã„ã‚‹ otel-collector ã® 4317 ãƒãƒ¼ãƒˆã«é€ä¿¡ã—ã€ãã® otel-collector ã¯ AWS X-Ray ã«ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’é€ä¿¡ã€‚æ›´ã«ãƒ­ã‚°ã¯è¿½åŠ ã§ã‚µã‚¤ãƒ‰ã‚«ãƒ¼èµ·å‹•ã—ã¦ã„ã‚‹ fluent-bit ã‚’ä½¿ã£ã¦ AWS Cloudwatch ã«é€ä¿¡ã™ã‚‹æƒ³å®šã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ã¾ã™ã€‚\npackage main import ( \u0026#34;context\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; \u0026#34;go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp\u0026#34; \u0026#34;go.opentelemetry.io/otel\u0026#34; \u0026#34;go.opentelemetry.io/otel/exporters/otlp/otlptrace\u0026#34; \u0026#34;go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc\u0026#34; \u0026#34;go.opentelemetry.io/otel/propagation\u0026#34; \u0026#34;go.opentelemetry.io/otel/sdk/resource\u0026#34; \u0026#34;go.opentelemetry.io/otel/sdk/trace\u0026#34; semconv \u0026#34;go.opentelemetry.io/otel/semconv/v1.10.0\u0026#34; ) func initTracer() { ctx := context.Background() collectorAddress := os.Getenv(\u0026#34;OTEL_COLLECTOR_ADDRESS\u0026#34;) if collectorAddress == \u0026#34;\u0026#34; { collectorAddress = \u0026#34;otel-collector:4317\u0026#34; } // gRPCã‚’ä½¿ç”¨ã—ã¦OpenTelemetry Collectorã¨é€šä¿¡ã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ traceClient := otlptracegrpc.NewClient( otlptracegrpc.WithEndpoint(collectorAddress), otlptracegrpc.WithInsecure(), ) // ä½œæˆã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ // ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ã‚’ä½œæˆã—ã¾ã™ traceExporter, err := otlptrace.New(ctx, traceClient) if err != nil { log.Fatalf(\u0026#34;Failed to create trace exporter: %v\u0026#34;, err) } // æ–°ã—ã„TracerProviderã‚’ä½œæˆã—ã¾ã™ // ã“ã‚Œã¯ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã™ã‚‹Tracerã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ tp := trace.NewTracerProvider( trace.WithBatcher(traceExporter), trace.WithResource(newResource()), ) // ä½œæˆã—ãŸTracerProviderã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªTracerProviderã¨ã—ã¦è¨­å®šã—ã¾ã™ otel.SetTracerProvider(tp) // TraceContextã‚’ä½¿ç”¨ã—ãŸPropagatorã‚’è¨­å®šã—ã¾ã™ã€‚ // ã“ã‚Œã¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¼æ’­ã•ã›ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚ otel.SetTextMapPropagator(propagation.TraceContext{}) } func main() { initTracer() // http ãƒãƒ³ãƒ‰ãƒ© http.Handle(\u0026#34;/\u0026#34;, otelhttp.NewHandler(http.HandlerFunc(home), \u0026#34;Home\u0026#34;)) log.Println(\u0026#34;Server is running on port 8080...\u0026#34;) log.Fatal(http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil)) } func home(w http.ResponseWriter, r *http.Request) { // Span ã®è¨­å®š ctx := r.Context() tr := otel.GetTracerProvider().Tracer(\u0026#34;example\u0026#34;) _, span := tr.Start(ctx, \u0026#34;about\u0026#34;) defer span.End() // Otel å½¢å¼ã® ID ã‚’ X-Ray å½¢å¼ã«å¤‰æ› traceID := IdOtel2Xray(span.SpanContext().TraceID().String()) log.Printf(\u0026#34;TraceID: %s, About us page\u0026#34;, traceID) w.Write([]byte(\u0026#34;Welcome to the Home Page!\u0026#34;)) } // OpenTelemetry Exporter ãŒåˆæœŸåŒ–ã®éš›ã«æ¯å›ç”¨ã„ã‚‰ã‚Œã‚‹ OpenTelemetry ãƒªã‚½ãƒ¼ã‚¹ä½œæˆ // ã®éš›ã«ãƒªã‚½ãƒ¼ã‚¹å±æ€§ã¨ã—ã¦ Cloudwatch Log Group ã‚’æŒ‡å®š func newResource() *resource.Resource { LogGroupNames := []string{\u0026#34;otel-test\u0026#34;} return resource.NewWithAttributes( semconv.SchemaURL, semconv.AWSLogGroupNamesKey.StringSlice(LogGroupNames), ) } func IdOtel2Xray(OtelId string) string { xrayId := \u0026#34;1-\u0026#34; + OtelId[0:8] + \u0026#34;-\u0026#34; + OtelId[8:] return xrayId } Docker é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ« ä¸‹è¨˜ãŒ docker-compose.yaml ã§ã™ã€‚å‰è¿°ã—ãŸé€šã‚Š otel-collector ã¨ fluent-bit ã‚’ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã¨ã—ã¦èµ·å‹•ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸ AWS ã«æƒ…å ±ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ãã®ä¸¡è€…ã§ã¯ AWS èªè¨¼ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚\nversion: \u0026#39;3.8\u0026#39; services: go-app: build: . ports: - \u0026#34;8080:8080\u0026#34; environment: - OTEL_COLLECTOR_ADDRESS=otel-collector:4317 depends_on: - otel-collector otel-collector: image: public.ecr.aws/aws-observability/aws-otel-collector:latest command: [\u0026#34;--config=/etc/otel-agent-config.yaml\u0026#34;] volumes: - ./otel-agent-config.yaml:/etc/otel-agent-config.yaml environment: - AWS_ACCESS_KEY_ID=**** - AWS_SECRET_ACCESS_KEY=***** - AWS_REGION=ap-northeast-1 ports: - \u0026#34;4317:4317\u0026#34; fluent-bit: image: fluent/fluent-bit:latest volumes: - /var/lib/docker/containers:/var/lib/docker/containers - /var/run/docker.sock:/var/run/docker.sock - ./fluent-bit.conf:/fluent-bit/etc/fluent-bit.conf environment: - AWS_ACCESS_KEY_ID=**** - AWS_SECRET_ACCESS_KEY=**** - AWS_REGION=ap-northeast-1 ä¸‹è¨˜ã¯ Dockerfile ã§ã™ã€‚\nFROM golang:1.21 AS builder WORKDIR /app COPY go.mod go.sum ./ RUN go mod download COPY . . RUN CGO_ENABLED=0 go build -o myapp . FROM alpine:latest WORKDIR /root/ COPY --from=builder /app/myapp . CMD [\u0026#34;./myapp\u0026#34;] fluent-bit ãƒ•ã‚¡ã‚¤ãƒ« ä¸‹è¨˜ã¯ fluent-bit.conf ã§ã™ã€‚ã“ã“ã§ otel-test ã¨ã„ã† Cloudwatch Log Group ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯äºˆã‚ AWS Console ã§ä½œæˆã—ã¦ãŠãã¾ã™ã€‚\n[SERVICE] Flush 1 Daemon Off Log_Level info Parsers_File parsers.conf [INPUT] Name tail Tag docker.* Path /var/lib/docker/containers/*/*.log Parser docker DB /var/log/flb_docker.db Mem_Buf_Limit 5MB Skip_Long_Lines On Refresh_Interval 10 [OUTPUT] Name cloudwatch_logs Match * region ap-northeast-1 log_group_name otel-test log_stream_prefix go-app- auto_create_group On OpenTelemetry ãƒ•ã‚¡ã‚¤ãƒ« ä¸‹è¨˜ã¯ OpenTelemetry ãŒå‚ç…§ã™ã‚‹ otel-agent-config.yaml ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚\nReciever ã¨ã—ã¦ otlp ã‚’æŒ‡å®šã€Exporter ã¨ã—ã¦ X-Ray ã‚’æŒ‡å®šã€‚ã¤ã¾ã‚Š Go ã‚¢ãƒ—ãƒªã‹ã‚‰ã®ãƒˆãƒ¬ãƒ¼ã‚¹æƒ…å ±ã‚’ otel-collector ãŒå—ã‘å–ã‚Š AWS X-Ray ã¸è»¢é€ã™ã‚‹å½¹å‰²ã‚’æ‹…ã£ã¦ã„ã¾ã™ã€‚\nreceivers: otlp: protocols: grpc: http: processors: batch: exporters: awsxray: region: \u0026#39;ap-northeast-1\u0026#39; service: telemetry: logs: level: \u0026#34;DEBUG\u0026#34; pipelines: traces: receivers: - otlp exporters: - awsxray å‹•ä½œç¢ºèª ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:8080/ ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚çµæœã¨ã—ã¦ AWS Console ã® X-Ray ã®ç”»é¢ã‚’ç¢ºèªã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãƒˆãƒ¬ãƒ¼ã‚¹æƒ…å ±ãŒå‡ºåŠ›ã•ã‚Œãã“ã‹ã‚‰ãƒ­ã‚°ãŒè¿½è·¡å‡ºæ¥ã‚‹äº‹ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\nã¾ã¨ã‚ ä»Šå›ã® Span è¨­å®šã¯ http.HandlerFun(home) ã® home() é–¢æ•°ã®ä¸­ã§è¡Œã„ã¾ã—ãŸã€‚ã‚ˆã£ã¦ãƒˆãƒ¬ãƒ¼ã‚¹æƒ…å ±ã¯å˜ç´”ãªç›´ç·šæƒ…å ±ã¨ãªã£ã¦ã„ã¾ã™ã€‚\nfunc home(w http.ResponseWriter, r *http.Request) { ctx := r.Context() tr := otel.GetTracerProvider().Tracer(\u0026#34;example\u0026#34;) _, span := tr.Start(ctx, \u0026#34;about\u0026#34;) defer span.End() traceID := IdOtel2Xray(span.SpanContext().TraceID().String()) log.Printf(\u0026#34;TraceID: %s, About us page\u0026#34;, traceID) w.Write([]byte(\u0026#34;Welcome to the Home Page!\u0026#34;)) } é€šå¸¸ã¯ http ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†ã€DB æ›¸ãè¾¼ã¿ã€ãƒ¡ãƒ¢ãƒªã‚µãƒ¼ãƒèª­ã¿è¾¼ã¿ç­‰ã®å‡¦ç†ã”ã¨ã«è¨­å®šã™ã¹ãã§ã™ã€‚ã“ã‚Œã‚‰ã®å‡¦ç†ã”ã¨ã« Span ã‚’è¨˜ã™ã“ã¨ã§ã€å„å‡¦ç†ã”ã¨ã«è¦ã—ã¦ã„ã‚‹æ™‚é–“ã‚„ãƒ­ã‚°ã‚’è¿½è·¡ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/opentelemetry-aws/","summary":"\u003cp\u003eOpenTelemetry ã‚’ä½¿ã£ã¦ AWS (X-Ray, Cloudwatch Logs) ã«ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ãƒ­ã‚°ã‚’è¨ˆè£…ã™ã‚‹äº‹ã«èˆˆå‘³ãŒã‚ã£ãŸã®ã§èª¿ã¹ãŸå†…å®¹ã‚’è¨˜ãã†ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eä»Šå›æ¤œè¨¼ã—ã¦ã¿ãŸæ§‹æˆã¯ä¸‹è¨˜ã®æ§˜ãªæ§‹æˆã§ã™ã€‚AWS ã‚’ç”¨ã„ãŸå ´åˆ ECS ã‚„ EKS, Lambda ã§ Go ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹äº‹ãŒé€šå¸¸ã§ã™ãŒã€ä»Šå›ã¯ docker-compose ã§æ¤œè¨¼ã—ã¾ã—ãŸã€‚ãŸã  ECS, EKS ã«ç½®ãæ›ãˆã‚‹ã®ã¯æ¯”è¼ƒçš„ç°¡å˜ã ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e        trace post          PutTelemetryRecords\n+--------+      +----------------+      +-----------------+\n| Go App | -+-\u0026gt; | Otel Collector | ---\u0026gt; |    AWS X-Ray    |\n+--------+  |   +----------------+      +-----------------+\n            |   +----------------+      +-----------------+\n            +-\u0026gt; |   Fluent-Bit   | ---\u0026gt; | Cloudwatch Logs |\n                +----------------+      +-----------------+\n                                PutLogEvents\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"ãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚¹ã®ç´ã¥ã‘\"\u003eãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚¹ã®ç´ã¥ã‘\u003c/h2\u003e\n\u003cp\u003eãƒ­ã‚°ã¯ Cloudwatch Logs ã¸ã€ãƒˆãƒ¬ãƒ¼ã‚¹æƒ…å ±ã¯ AWS X-Ray ã¸è»¢é€ã—ã¾ã™ãŒã€ã“ã®ãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ç´ä»˜ã‘ã‚‹ã¨ã€é‹ç”¨ã™ã‚‹ä¸Šã§è¿½è·¡ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚ã“ã®ç´ã¥ã‘ã¯ AWS ã®å ´åˆã¯ç°¡å˜ã§ä¸‹è¨˜ã®è¦ä»¶ã‚’æº€ãŸã›ã°ç´ã¥ã‘ãŒã•ã‚Œã¾ã™ã€‚\u003c/p\u003e","title":"Go, OpenTelemetry ã§ AWS ã«ãƒ­ã‚°ãƒ»ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’è¨ˆè£…ã—ã¦ã¿ã‚‹"},{"content":"è‡ªå®…ã®ãƒ«ãƒ¼ã‚¿ã«ã¤ã„ã¦ã‚‚å¯è¦³æ¸¬æ€§ã‚’å‘ä¸Šã—ã¦æ™®æ®µã®é‹ç”¨ã«å½¹ç«‹ã¦ã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°é•·æœŸã‚¹ãƒ‘ãƒ³ã§ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡æ–™ã®æ¨ç§»ã‚„ CPU, Mem ä½¿ç”¨ç‡ã€ã‚ã¨ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æ¸©åº¦ã®æ¨ç§»ãªã©ã‚’è¦³æ¸¬ã—ã¦ã„ã¾ã™ã€‚\nä»Šã¾ã§ã¯ Prometheus ã® Node Exporter ã‚’ä½¿ã£ã¦ãƒ›ã‚¹ãƒˆã®æƒ…å ±ã‚’ Prometheus Server ã«æä¾›ã—ã¦ã„ãŸã®ã§ã™ãŒã€è‡ªåˆ†ã§ Go ã§ Prometheus Exporter ã‚’æ›¸ã„ã¦é‹ç”¨ã™ã‚‹ã«ã‚ˆã†ã«ãªã£ãŸã®ã§ã€ãã‚Œã«ã¤ã„ã¦ã¾ã¨ã‚ã¾ã™ã€‚\nGrafana ã®å¯è¦–åŒ–æƒ…å ± ä¸‹è¨˜ãŒå¯è¦–åŒ–ã•ã‚ŒãŸæƒ…å ±ã§ã™ã€‚CPU, Mem ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€ä¿¡é‡ã€ã¾ãŸãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æ¸©åº¦ã‚’å¯è¦–åŒ–ã—ã¦é‹ç”¨ã—ã¦ã„ã¾ã™ã€‚\nã‚½ãƒ¼ã‚¹ç½®ãå ´ çµè«–ã«ãªã‚Šã¾ã™ãŒä¸‹è¨˜ã«ã‚½ãƒ¼ã‚¹ã‚’ç½®ã„ã¦ã„ã¾ã™ã€‚\nhttps://github.com/jedipunkz/linux-tiny-exporter\nãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€ä¿¡ãƒ»å—ä¿¡ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’èª¬æ˜ å®Ÿéš›ã«ã¯ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ CPU ä½¿ç”¨ç‡, Memory ä½¿ç”¨ç‡, Disk IO, Network ãƒˆãƒ©ãƒ’ãƒƒã‚¯, ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æ¸©åº¦ã‚’å–å¾—ãƒ»æä¾›ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã«é–¢ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ Prometheus Server ã«æä¾›ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’èª¬æ˜ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\nãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ Prometheus ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰2ã¤ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚\n\u0026ldquo;github.com/prometheus/client_golang/prometheus\u0026rdquo;: ã“ã‚Œã¯ Prometheus ã®åŸºæœ¬çš„ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å®šç¾©ã€åé›†ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚\n\u0026ldquo;github.com/prometheus/client_golang/prometheus/promhttp\u0026rdquo;: ã“ã‚Œã¯ Prometheus ã® HTTP ã‚µãƒ¼ãƒãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€HTTP çµŒç”±ã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å…¬é–‹ã™ã‚‹ãŸã‚ã®ãƒãƒ³ãƒ‰ãƒ©ã‚’æä¾›ã—ã¾ã™ã€‚\n\u0026#34;github.com/prometheus/client_golang/prometheus\u0026#34; \u0026#34;github.com/prometheus/client_golang/prometheus/promhttp\u0026#34; ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã«é–¢ã™ã‚‹æ§‹é€ ä½“å®šç¾© ã“ã“ã‹ã‚‰ã¯ Internal Packege ã®ã‚³ãƒ¼ãƒ‰è§£èª¬ã§ã™ã€‚\nNetCollector ã¨ã„ã†æ§‹é€ ä½“ãŒå®šç¾©ã—ã¦ã„ã¾ã™ã€‚ã“ã®æ§‹é€ ä½“ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã”ã¨ã®å—ä¿¡ãƒã‚¤ãƒˆæ•°ã€é€ä¿¡ãƒã‚¤ãƒˆæ•°ã€å—ä¿¡ãƒ‘ã‚±ãƒƒãƒˆæ•°ã€é€ä¿¡ãƒ‘ã‚±ãƒƒãƒˆæ•°ã®å·®åˆ†ã‚’ä¿æŒã—ã¾ã™ã€‚~Diff ã¯ãã‚Œãã‚Œã®å€¤ã®å·®åˆ†ã‚’ä¿æŒã—ã¾ã™ã€‚å‰å›ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—ï¼ˆãƒ‡ãƒ¼ã‚¿åé›†ï¼‰ã‹ã‚‰ã®å¤‰åŒ–ã‚’è¡¨ã—ã¾ã™ã€‚\ntype NetCollector struct { receivedBytesDiff *prometheus.Desc transmitBytesDiff *prometheus.Desc receivedPacketsDiff *prometheus.Desc transmitPacketsDiff *prometheus.Desc lastReceivedBytes map[string]float64 lastTransmitBytes map[string]float64 lastReceivedPackets map[string]float64 lastTransmitPackets map[string]float64 } ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ NewNetCollector é–¢æ•°ã¯ã€æ–°ã—ã„ NetCollector ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®é–¢æ•°ã§ã¯ã€å„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å·®åˆ†ã‚’è¡¨ã™ prometheus.Desc ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ãã‚Œã‚‰ã‚’ NetCollector æ§‹é€ ä½“ã®å¯¾å¿œã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨­å®šã—ã¾ã™ã€‚ã¾ãŸã€å‰å›ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—æ™‚ã®å„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å€¤ã‚’ä¿æŒã™ã‚‹ãƒãƒƒãƒ—ã‚‚ä½œæˆã—ã¾ã™ã€‚\nfunc NewNetCollector() *NetCollector { return \u0026amp;NetCollector{ receivedBytesDiff: prometheus.NewDesc(\u0026#34;net_received_bytes_diff\u0026#34;, \u0026#34;Received bytes by network interface since the last scrape.\u0026#34;, []string{\u0026#34;interface\u0026#34;}, nil, ), transmitBytesDiff: prometheus.NewDesc(\u0026#34;net_transmit_bytes_diff\u0026#34;, \u0026#34;Transmitted bytes by network interface since the last scrape.\u0026#34;, []string{\u0026#34;interface\u0026#34;}, nil, ), receivedPacketsDiff: prometheus.NewDesc(\u0026#34;net_received_packets_diff\u0026#34;, \u0026#34;Received packets by network interface since the last scrape.\u0026#34;, []string{\u0026#34;interface\u0026#34;}, nil, ), transmitPacketsDiff: prometheus.NewDesc(\u0026#34;net_transmit_packets_diff\u0026#34;, \u0026#34;Transmitted packets by network interface since the last scrape.\u0026#34;, []string{\u0026#34;interface\u0026#34;}, nil, ), lastReceivedBytes: make(map[string]float64), lastTransmitBytes: make(map[string]float64), lastReceivedPackets: make(map[string]float64), lastTransmitPackets: make(map[string]float64), } } ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ Prometheus ã«é€šçŸ¥ã™ã‚‹é–¢æ•° Describe ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ãŒæä¾›ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ Prometheus ã«é€šçŸ¥ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã® Desc ã‚’å—ã‘å–ã‚‹ãƒãƒ£ãƒãƒ«ã‚’å¼•æ•°ã«å–ã‚Šã¾ã™ã€‚ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ã¯ã€ã“ã®ãƒãƒ£ãƒãƒ«ã«å¯¾ã—ã¦è‡ªèº«ãŒæä¾›ã™ã‚‹ã™ã¹ã¦ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã® Desc ã‚’é€ä¿¡ã—ã¾ã™ã€‚\nfunc (collector *NetCollector) Describe(ch chan\u0026lt;- *prometheus.Desc) { ch \u0026lt;- collector.receivedBytesDiff ch \u0026lt;- collector.transmitBytesDiff ch \u0026lt;- collector.receivedPacketsDiff ch \u0026lt;- collector.transmitPacketsDiff } ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†é–¢æ•° Collect ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€Prometheus ãŒãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã™ã‚‹éš›ã«å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å€¤ã‚’å—ã‘å–ã‚‹ãƒãƒ£ãƒãƒ«ã‚’å¼•æ•°ã«å–ã‚Šã¾ã™ã€‚ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ã¯ã€ã“ã®ãƒãƒ£ãƒãƒ«ã«å¯¾ã—ã¦è‡ªèº«ãŒæä¾›ã™ã‚‹ã™ã¹ã¦ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å€¤ã‚’é€ä¿¡ã—ã¾ã™ã€‚\nã“ã® Collect ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€æ¬¡ã®å‡¦ç†ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ï¼š\ngetNetDevice é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‡ãƒã‚¤ã‚¹ã®æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚ å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’è¡Œã”ã¨ã«åˆ†å‰²ã—å„è¡Œã‚’ãƒ«ãƒ¼ãƒ— å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®åå‰ã¨ã€å—ä¿¡ãƒã‚¤ãƒˆæ•°ã€é€ä¿¡ãƒã‚¤ãƒˆæ•°ã€å—ä¿¡ãƒ‘ã‚±ãƒƒãƒˆæ•°ã€é€ä¿¡ãƒ‘ã‚±ãƒƒãƒˆæ•°ã‚’å–å¾—ã—ã¾ã™ã€‚ å‰å›ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—æ™‚ã®å„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å€¤ã¨æ¯”è¼ƒã—ã¦å·®åˆ†ã‚’è¨ˆç®—ã—ã€ãã‚Œã‚’ Prometheus ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ã—ã¦ãƒãƒ£ãƒãƒ«ã«é€ä¿¡ã—ã¾ã™ã€‚ æœ€å¾Œã«ã€ä»Šå›ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—æ™‚ã®å„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å€¤ã‚’ä¿å­˜ã—ã¾ã™ã€‚ã“ã‚Œã¯æ¬¡å›ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—æ™‚ã«å‰å›ã®å€¤ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ func (collector *NetCollector) Collect(ch chan\u0026lt;- prometheus.Metric) { data, err := getNetDevice() if err != nil { return } lines := strings.Split(data, \u0026#34;\\n\u0026#34;) for i, line := range lines { if i \u0026lt; 2 { continue } fields := strings.Fields(line) if len(fields) \u0026lt; 10 { continue } interfaceName := strings.Trim(fields[0], \u0026#34;:\u0026#34;) receivedBytes, _ := strconv.ParseFloat(fields[1], 64) transmitBytes, _ := strconv.ParseFloat(fields[9], 64) receivedPackets, _ := strconv.ParseFloat(fields[2], 64) transmitPackets, _ := strconv.ParseFloat(fields[10], 64) if lastReceivedBytes, ok := collector.lastReceivedBytes[interfaceName]; ok { receivedBytesDiff := receivedBytes - lastReceivedBytes ch \u0026lt;- prometheus.MustNewConstMetric(collector.receivedBytesDiff, prometheus. GaugeValue, receivedBytesDiff, interfaceName) } if lastTransmitBytes, ok := collector.lastTransmitBytes[interfaceName]; ok { transmitBytesDiff := transmitBytes - lastTransmitBytes ch \u0026lt;- prometheus.MustNewConstMetric(collector.transmitBytesDiff, prometheus. GaugeValue, transmitBytesDiff, interfaceName) } if lastReceivedPackets, ok := collector.lastReceivedPackets[interfaceName]; ok { receivedPacketsDiff := receivedPackets - lastReceivedPackets ch \u0026lt;- prometheus.MustNewConstMetric(collector.receivedPacketsDiff, prometheu s.GaugeValue, receivedPacketsDiff, interfaceName) } if lastTransmitPackets, ok := collector.lastTransmitPackets[interfaceName]; ok { transmitPacketsDiff := transmitPackets - lastTransmitPackets ch \u0026lt;- prometheus.MustNewConstMetric(collector.transmitPacketsDiff, prometheu s.GaugeValue, transmitPacketsDiff, interfaceName) } collector.lastReceivedBytes[interfaceName] = receivedBytes collector.lastTransmitBytes[interfaceName] = transmitBytes collector.lastReceivedPackets[interfaceName] = receivedPackets collector.lastTransmitPackets[interfaceName] = transmitPackets } } ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±å–å¾—é–¢æ•° æœ€å¾Œã¯ getNetDevice é–¢æ•°ã¯ Collect é–¢æ•°ã§åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ Linuxã‚·ã‚¹ãƒ†ãƒ ã®/proc/net/devãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ãã®å†…å®¹ã‚’æ–‡å­—åˆ—ã¨ã—ã¦è¿”ã™ã‚‚ã®ã§ã™ã€‚\n/proc/net/dev ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«é–¢ã™ã‚‹æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚å„è¡Œã¯ã€ä¸€ã¤ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å¯¾å¿œã—ã€ãã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å—ä¿¡ãƒã‚¤ãƒˆæ•°ã€é€ä¿¡ãƒã‚¤ãƒˆæ•°ã€å—ä¿¡ãƒ‘ã‚±ãƒƒãƒˆæ•°ã€é€ä¿¡ãƒ‘ã‚±ãƒƒãƒˆæ•°ãªã©ã®æƒ…å ±ã‚’å«ã¿ã¾ã™ã€‚\nfunc getNetDevice() (string, error) { file, err := os.Open(\u0026#34;/proc/net/dev\u0026#34;) if err != nil { return \u0026#34;\u0026#34;, err } defer file.Close() var sb strings.Builder _, err = io.Copy(\u0026amp;sb, file) if err != nil { return \u0026#34;\u0026#34;, err } return sb.String(), nil } ã¾ã¨ã‚ é«˜æ©Ÿèƒ½ãª Node Exporter ã‚’ä½¿ãˆã°ãã®ä»–ã®æƒ…å ±ã‚‚ç´°ã‚„ã‹ã«å–å¾—ãƒ»æä¾›å‡ºæ¥ã‚‹ã®ã§ã™ãŒã€è‡ªå‰ã§é–‹ç™ºã—ãŸ Exporter ã‚’ä½¿ã£ã¦é‹ç”¨ã™ã‚‹ã¨ã“ã‚ã«è¶£ãŒã‚ã‚‹ã‚ˆã†ã«æ€ã£ã¦ã„ã¾ã™ã€‚Go ã§ã‚ã‚Œã° Prometheus Exporter ã®é–‹ç™ºã¯æ¯”è¼ƒçš„ç°¡å˜ãªäº‹ãŒåˆ†ã‹ã£ãŸã¨æ€ã„ã¾ã™ã€‚ã¾ãŸã€ä»Šå›ã¯ Node Exporter ã§ã‚‚æä¾›ã•ã‚Œã‚‹æ§˜ãªæƒ…å ±ã‚’ã‚¨ã‚­ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸãŒã€Linux ã‹ã‚‰å–å¾—ã§ãã‚‹æƒ…å ±ä»¥å¤–ã® Prometheus Exporter ã‚‚é–‹ç™ºå‡ºæ¥ã‚‹äº‹ã‚‚æƒ³åƒå‡ºæ¥ã‚‹ã¨æ€ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/linux-tiny-exporter/","summary":"\u003cp\u003eè‡ªå®…ã®ãƒ«ãƒ¼ã‚¿ã«ã¤ã„ã¦ã‚‚å¯è¦³æ¸¬æ€§ã‚’å‘ä¸Šã—ã¦æ™®æ®µã®é‹ç”¨ã«å½¹ç«‹ã¦ã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°é•·æœŸã‚¹ãƒ‘ãƒ³ã§ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡æ–™ã®æ¨ç§»ã‚„ CPU, Mem ä½¿ç”¨ç‡ã€ã‚ã¨ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æ¸©åº¦ã®æ¨ç§»ãªã©ã‚’è¦³æ¸¬ã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šã¾ã§ã¯ Prometheus ã® Node Exporter ã‚’ä½¿ã£ã¦ãƒ›ã‚¹ãƒˆã®æƒ…å ±ã‚’ Prometheus Server ã«æä¾›ã—ã¦ã„ãŸã®ã§ã™ãŒã€è‡ªåˆ†ã§ Go ã§ Prometheus Exporter ã‚’æ›¸ã„ã¦é‹ç”¨ã™ã‚‹ã«ã‚ˆã†ã«ãªã£ãŸã®ã§ã€ãã‚Œã«ã¤ã„ã¦ã¾ã¨ã‚ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"grafana-ã®å¯è¦–åŒ–æƒ…å ±\"\u003eGrafana ã®å¯è¦–åŒ–æƒ…å ±\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ãŒå¯è¦–åŒ–ã•ã‚ŒãŸæƒ…å ±ã§ã™ã€‚CPU, Mem ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€ä¿¡é‡ã€ã¾ãŸãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æ¸©åº¦ã‚’å¯è¦–åŒ–ã—ã¦é‹ç”¨ã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"grafana1\" loading=\"lazy\" src=\"../../pix/linux-tiny-exporter-1.png\"\u003e\n\u003cimg alt=\"grafana2\" loading=\"lazy\" src=\"../../pix/linux-tiny-exporter-2.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"ã‚½ãƒ¼ã‚¹ç½®ãå ´\"\u003eã‚½ãƒ¼ã‚¹ç½®ãå ´\u003c/h2\u003e\n\u003cp\u003eçµè«–ã«ãªã‚Šã¾ã™ãŒä¸‹è¨˜ã«ã‚½ãƒ¼ã‚¹ã‚’ç½®ã„ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/jedipunkz/linux-tiny-exporter\"\u003ehttps://github.com/jedipunkz/linux-tiny-exporter\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€ä¿¡å—ä¿¡ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’èª¬æ˜\"\u003eãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€ä¿¡ãƒ»å—ä¿¡ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’èª¬æ˜\u003c/h2\u003e\n\u003cp\u003eå®Ÿéš›ã«ã¯ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ CPU ä½¿ç”¨ç‡, Memory ä½¿ç”¨ç‡, Disk IO, Network ãƒˆãƒ©ãƒ’ãƒƒã‚¯, ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æ¸©åº¦ã‚’å–å¾—ãƒ»æä¾›ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã«é–¢ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ Prometheus Server ã«æä¾›ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’èª¬æ˜ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch3 id=\"ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ\"\u003eãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ\u003c/h3\u003e\n\u003cp\u003ePrometheus ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰2ã¤ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u0026ldquo;github.com/prometheus/client_golang/prometheus\u0026rdquo;: ã“ã‚Œã¯ Prometheus ã®åŸºæœ¬çš„ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å®šç¾©ã€åé›†ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u0026ldquo;github.com/prometheus/client_golang/prometheus/promhttp\u0026rdquo;: ã“ã‚Œã¯ Prometheus ã® HTTP ã‚µãƒ¼ãƒãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€HTTP çµŒç”±ã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å…¬é–‹ã™ã‚‹ãŸã‚ã®ãƒãƒ³ãƒ‰ãƒ©ã‚’æä¾›ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;github.com/prometheus/client_golang/prometheus\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;github.com/prometheus/client_golang/prometheus/promhttp\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã«é–¢ã™ã‚‹æ§‹é€ ä½“å®šç¾©\"\u003eãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã«é–¢ã™ã‚‹æ§‹é€ ä½“å®šç¾©\u003c/h3\u003e\n\u003cp\u003eã“ã“ã‹ã‚‰ã¯ Internal Packege ã®ã‚³ãƒ¼ãƒ‰è§£èª¬ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eNetCollector ã¨ã„ã†æ§‹é€ ä½“ãŒå®šç¾©ã—ã¦ã„ã¾ã™ã€‚ã“ã®æ§‹é€ ä½“ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã”ã¨ã®å—ä¿¡ãƒã‚¤ãƒˆæ•°ã€é€ä¿¡ãƒã‚¤ãƒˆæ•°ã€å—ä¿¡ãƒ‘ã‚±ãƒƒãƒˆæ•°ã€é€ä¿¡ãƒ‘ã‚±ãƒƒãƒˆæ•°ã®å·®åˆ†ã‚’ä¿æŒã—ã¾ã™ã€‚~Diff ã¯ãã‚Œãã‚Œã®å€¤ã®å·®åˆ†ã‚’ä¿æŒã—ã¾ã™ã€‚å‰å›ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—ï¼ˆãƒ‡ãƒ¼ã‚¿åé›†ï¼‰ã‹ã‚‰ã®å¤‰åŒ–ã‚’è¡¨ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eNetCollector\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003ereceivedBytesDiff\u003c/span\u003e   \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eprometheus\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eDesc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003etransmitBytesDiff\u003c/span\u003e   \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eprometheus\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eDesc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003ereceivedPacketsDiff\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eprometheus\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eDesc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003etransmitPacketsDiff\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eprometheus\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eDesc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003elastReceivedBytes\u003c/span\u003e   \u003cspan style=\"color:#66d9ef\"\u003emap\u003c/span\u003e[\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e]\u003cspan style=\"color:#66d9ef\"\u003efloat64\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003elastTransmitBytes\u003c/span\u003e   \u003cspan style=\"color:#66d9ef\"\u003emap\u003c/span\u003e[\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e]\u003cspan style=\"color:#66d9ef\"\u003efloat64\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003elastReceivedPackets\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003emap\u003c/span\u003e[\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e]\u003cspan style=\"color:#66d9ef\"\u003efloat64\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003elastTransmitPackets\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003emap\u003c/span\u003e[\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e]\u003cspan style=\"color:#66d9ef\"\u003efloat64\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿\"\u003eã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿\u003c/h3\u003e\n\u003cp\u003eNewNetCollector é–¢æ•°ã¯ã€æ–°ã—ã„ NetCollector ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®é–¢æ•°ã§ã¯ã€å„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å·®åˆ†ã‚’è¡¨ã™ prometheus.Desc ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ãã‚Œã‚‰ã‚’ NetCollector æ§‹é€ ä½“ã®å¯¾å¿œã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨­å®šã—ã¾ã™ã€‚ã¾ãŸã€å‰å›ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—æ™‚ã®å„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å€¤ã‚’ä¿æŒã™ã‚‹ãƒãƒƒãƒ—ã‚‚ä½œæˆã—ã¾ã™ã€‚\u003c/p\u003e","title":"è‡ªå‰é–‹ç™ºã—ãŸ Prometheus Exporter ã§è‡ªå®…ãƒ«ãƒ¼ã‚¿ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç›£è¦–é‹ç”¨ã—ã¦ã„ã‚‹è©±"},{"content":"@jedipunkz ã§ã™ã€‚ä»Šã¾ã§è‡ªå®…ã§ã¯ PPPoE æ¥ç¶šã‚’ã—ã¦ Global IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã—ã¦è‡ªå®…ã«ãƒã‚¤ã‚¯ãƒ©ã‚µãƒ¼ãƒãƒ¼ã‚’å¤–éƒ¨å…¬é–‹ã—ãã®æ¥ç¶šã‚’ä½¿ã£ã¦å„ç«¯æœ«ã§ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’ã—ã¦ã„ã¾ã—ãŸã€‚ãŸã ã€IPoE æ¥ç¶šã™ã‚‹ã¨æ··é›‘æ™‚é–“ã‚’å›é¿å‡ºæ¥ã‚‹ã¨èã„ã¦ã„ãŸã®ã§ (ã“ã‚Œã«ã¤ã„ã¦ã¯å¾Œè¡“ã—ã¾ã™)ã€æ™®æ®µã®ã‚²ãƒ¼ãƒ ã‚„å„ç«¯æœ«ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã¯ IPoE æ¥ç¶šã‚’åˆ©ç”¨ã—ãƒã‚¤ã‚¯ãƒ©ã‚µãƒ¼ãƒãƒ¼ã¯ PPPoE ã§å…¬é–‹ã€ã¨å‡ºæ¥ãªã„ã‹ã¨è€ƒãˆã¾ã—ãŸã€‚IPoE ã¯ IPv4 over IPv6 ã®ãƒˆãƒ³ãƒãƒªãƒ³ã‚°æ¥ç¶šã™ã‚‹ãŸãŸã‚ IPoE ã ã‘ã§ã¯ IPv4 Global IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒãƒ¼å…¬é–‹ã¯ä¸å¯èƒ½ã ã‹ã‚‰ã§ã™ã€‚\nã“ã“ã§ã¯ VyOS ã‚’ä½¿ã£ã¦ãã®ä¸¡è€…ã‚’æº€ãŸã™æ¥ç¶šã®è¨­å®šæ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚\nè¦ä»¶ PPPoE ã—ã¦ Global IPv4 ã‚’å–å¾—ã—ã‚µãƒ¼ãƒãƒ¼ã‚’å¤–éƒ¨ã«æä¾› (ãã®éš›ã« Dynamic DNS ã‚’åˆ©ç”¨ (è‡ªå®…ã¯ Cloudflare)) ã‚µãƒ¼ãƒãƒ¼ä»¥å¤–ã®ç«¯æœ«ã®ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã¯ IPoE æ¥ç¶šã—ãŸçµŒè·¯ã«æµã™ å›ç·šã¯NTT ãƒ•ãƒ¬ãƒƒãƒ„æƒ³å®š (è‡ªåˆ†ã®å ´åˆã¯ Asahi-net, IPv6 æ¥ç¶šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚ã‚Š, ãã®ä»–ã§ã‚‚å¯) ISO ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ VyOS ã¯ Stable ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯æœ‰å„Ÿãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ãªã„ã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡ºæ¥ã¾ã›ã‚“ãŒãƒ“ãƒ«ãƒ‰ã™ã‚Œã° ISO ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒä½œã‚Œã¾ã™ã€‚ãã®æ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚\n2023/12 æ™‚ç‚¹ã§æœ€æ–°ã® Stable ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.3.4 ã‚’æŒ‡å®š é©å½“ãª Linux ç«¯æœ«ã§ãƒ“ãƒ«ãƒ‰ã—ã¾ã—ãŸãŒ Docker ã‚’åˆ©ç”¨ã§ãã‚Œã°ã©ã“ã§ã‚‚è‰¯ã•ãã† git clone -b equuleus https://github.com/vyos/vyos-build cd vyos-build/ docker run --rm -it --privileged -v $(pwd):/vyos -w /vyos vyos/vyos-build:equuleus bash ./configure --architecture amd64 --build-type release --version 1.3.4 sudo make iso ãƒ“ãƒ«ãƒ‰ãŒå®Œäº†ã™ã‚‹ã¨ build/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã« iso ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå‡ºæ¥ä¸ŠãŒã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚\næ§‹æˆ ä¸‹è¨˜ã®ã‚ˆã†ã« VyOS ãƒã‚·ãƒ³ã«ã¯ NIC ãŒ2ã¤ä»¥ä¸Šã‚ã‚Œã°è¦ä»¶æº€ãŸã›ã¾ã™ã€‚ 10.0.1.254/32 10.0.1.100/32 +--------------+ IPoE +-----------------------+------+ +---------------+ | the internet | -+---- | eth0(IPv6) \u0026lt;- Tunnel -| | --- | IPv4 server | +--------------+ | +-----------------------| eth1 + +---------------+ +---- | eth0(IPv4) \u0026lt;- NAT - | | -+ PPPoE +-----------------------+------+ | +---------------+ | VyOS Router | +- | Other Clients | +------------------------------+ +---------------+ 10.0.1.0/24 æ‰‹é † eth1 ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹è¨­å®š set interface ethernet eth1 address 10.0.1.254 IPoE æ¥ç¶š eth0 å´ã§ IPv6 ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚\nset interface ethernet eth0 address dhcpv6 set interface ethernet eth0 dhcpv6-options parameters-only set interface ethernet eth0 ipv6 address autoconf set interface ethernet eth0 ipv6 disable-forwarding commit ã“ã®æ™‚ç‚¹ã§æ•°åˆ†å¾…ã¤ã¨ IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå–å¾—ã§ãã¾ã™ã€‚\nrun show int Codes: S - State, L - Link, u - Up, D - Down, A - Admin Down Interface IP Address S/L Description --------- ---------- --- ----------- eth0 2405:xx:xx:xx:xx:xx:xx:xxx/64 è‡ªå®…ã®å ´åˆã¯ Asahi-net ã¨ã„ã†ãƒ—ãƒ­ãƒã‚¤ãƒ€ã§ã™ã€‚v6 connect ã¨ã„ã† IPv6 æ¥ç¶šã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã®ã§ã™ãŒã€çµ‚ç«¯ã®æƒ…å ±ã¯å…¬é–‹ã—ã¦ã„ãªã„ã¨ã‚µãƒãƒ¼ãƒˆã‹ã‚‰èãã¾ã—ãŸã€‚ã‚ˆã£ã¦ã“ã“ã«ã‚‚ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨˜ã™ã®ã¯å•é¡Œã ã¨æ€ã†ã®ã§è¨˜ã—ã¾ã›ã‚“ã€‚ãŸã å‚è€ƒè³‡æ–™ã ã‘æ²è¼‰ã—ã¦ãŠãã¾ã™ã€‚\nhttps://scrapbox.io/for2ando/Asahi%E3%83%8D%E3%83%83%E3%83%88DS-Lite%E3%81%AEAFTR%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8bash https://gist.github.com/stkchp/4daea9158439c32d7a70a255d51e568b ã¾ãŸ DS-Lite ã§ transix ã®å ´åˆã¯ dig @2404:1a8:7f01:b::3 gw.transix.jp aaaa +short ã§å¼•ã‘ã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒãã‚Œã«ãªã‚‹ãã†ã§ã™ã€‚\nset interfaces tunnel tun0 encapsulation ipip6 set interfaces tunnel tun0 multicast disable set interfaces tunnel tun0 remote 2001:xxx:x:xxx:xx #æ¥ç¶šå…ˆçµ‚ç«¯ set interfaces tunnel tun0 source-address 2405:xx:xx:xx:xx:xx:xx:xxx/64 #ä¸Šè¨˜æ‰‹é †ã§å–å¾— set protocols static interface-route 0.0.0.0/0 next-hop-interface tun0 commit ã“ã®æ™‚ç‚¹ã§ IPv6 ã§ã‚‚ IPv4 (IPv4 over IPv6) ã§ã‚‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã§ãã‚‹ã¯ãšã§ã™ã€‚\nIPoE æ¥ç¶šã‚’åˆ©ç”¨ã—ãŸå®…å†…ç«¯æœ«ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶š eth1 å´ã«æ¥ç¶šã—ãŸå„ç«¯æœ«ãŒ IPv4 ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã§ãã‚‹ã‚ˆã† NAT ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚\nset nat source rule 100 description \u0026#39;LAN Source NAT\u0026#39; set nat source rule 100 outbound-interface tun0 set nat source rule 100 source address 10.0.1.0/24 set nat source rule 100 translation address masquerade commit å®…å†…ã®å„ç«¯æœ«ã« IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ DHCP ã§é…å¸ƒ show service dhcp-server shared-network-name HOME-DHCP name-server 8.8.8.8 show service dhcp-server shared-network-name HOME-DHCP name-server 8.8.4.4 show service dhcp-server shared-network-name HOME-DHCP subnet 10.0.1.0/24 default-router 10.0.1.254 show service dhcp-server shared-network-name HOME-DHCP subnet 10.0.1.0/24 range dhcp1-subnet start 10.0.1.100 show service dhcp-server shared-network-name HOME-DHCP subnet 10.0.1.0/24 range dhcp1-subnet end 10.0.1.190 ã“ã®æ™‚ç‚¹ã§å®…å†…ã®å„ç«¯æœ«ãŒ IPv4 ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šå‡ºæ¥ã¾ã™ã€‚\nãƒ«ãƒ¼ã‚¿å†èµ·å‹•æ™‚ã®å¯¾å¿œ DHCPv6 ã§å–å¾—ã—ãŸ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å›ºå®šã§ã¯ãªã„ã®ã§ã€ãƒ«ãƒ¼ã‚¿ã®å†èµ·å‹•æ™‚ã«ä¸æ•´åˆãŒç½®ãã¾ã™ã€‚ãã®éš›ã®å¯¾å‡¦æ–¹æ³•ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã®ã§è¨˜ã—ã¦ãŠãã¾ã™ã€‚(æƒ…å ±æä¾›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™)\nå‚è€ƒ: https://zenn.dev/chattytak/articles/54f99d218300b8\nPPPoE æ¥ç¶šã—ã¦ IPv4 Server å…¬é–‹ PPPoE æ¥ç¶šã‚’è¡Œã„ã¾ã™ã€‚ãã—ã¦ IPv4 Server ã‚’å¤–éƒ¨ã«å…¬é–‹ã™ã‚‹æ‰‹é †ã§ã™ã€‚\nã¾ãš PPPoE æ¥ç¶šã—ã¾ã™ã€‚ãƒ—ãƒ­ãƒã‚¤ãƒ€ã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ã‚‹ PPPoE ç”¨ã®ãƒ¦ãƒ¼ã‚¶åãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”¨ã„ã¾ã™ã€‚MTU èª¿æ•´ã‚‚ã—ã¦ãŠãã¾ã™ã€‚\nset interface pppoe pppoe0 authentication user xxxxx set interface pppoe pppoe0 authentication password xxxxxxx set inetrface pppoe pppoe0 source-interface eth0 set inetrface pppoe pppoe0 mtu 1454 å¤–éƒ¨å…¬é–‹ã™ã‚‹ IPv4 Server ã¯ PPPoE æ¥ç¶šçµŒè·¯ã‹ã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã§ãã‚‹ã‚ˆã† Source NAT ã‚’è¨­å®šã—ã¾ã™ã€‚\nset nat source rule 110 description \u0026#39;Server Source NAT\u0026#39; set nat source rule 110 outbound-interface pppoe0 set nat source rule 110 source address 10.0.1.100/32 set nat source rule 110 translation address masquerade Destination NAT ã§ IPv4 Server ã‚’å¤–éƒ¨å…¬é–‹ã—ã¾ã™ã€‚\nset nat destination rule 19132 description \u0026#39;Minecraft\u0026#39; set nat destination rule 19132 destination port 19132 #å…¬é–‹ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹æ¬¡ç¬¬ set nat destination rule 19132 inbound-interface pppoe0 set nat destination rule 19132 protocol udp #å…¬é–‹ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹æ¬¡ç¬¬ set nat destination rule 19132 translation address 10.0.1.100 set nat destination rule 19132 translation port 19132 #å…¬é–‹ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹æ¬¡ç¬¬ åŒæ§˜ã®ç›®çš„ã§ Policy Based Routing ã‚’æ›¸ãã¾ã™ã€‚ã¤ã„ã§ã«ãƒ•ãƒ¬ãƒƒãƒ„æ¥ç¶šç”¨ã®ãƒãƒªã‚·ã‚‚è¿½åŠ ã—ã¾ã™ã€‚\nset policy route PBR rule 10 description \u0026#39;ipv4 server traffic via pppoe\u0026#39; set policy route PBR rule 10 set table 100 set policy route PBR rule 10 source address 10.0.1.100/32 set policy route PBR rule 20 description \u0026#39;FLETS\u0026#39; set policy route PBR rule 20 destination address 0.0.0.0/0 set policy route PBR rule 20 protocol tcp set policy route PBR rule 20 set tcp-mss 1414 set policy route PBR rule 20 tcp flags SYN,!ACK,!FIN,!RST ä½œæˆã—ãŸ Policy Based Route ã‚’ interface ã«ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ã€‚\nset interface ethernet eth1 policy PBR Dynamic DNS ã—ã¦ IPv4 Server ã® DNS åä»˜ä¸ ã“ã“ã¯ãŠã¾ã‘ã§ã™ãŒã€è‡ªåˆ†ã®å ´åˆ Cloudflare ã§ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å–å¾—ã—ãŸã®ã§ãã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’åˆ©ç”¨ã—ã¦ IPv4 Server ã« FQDN ã‚’ä»˜ä¸ã—ã¦ã„ã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“å›ºå®š IPv4 ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å¥‘ç´„ã—ã¦ã„ã‚Œã°ã“ã®æ‰‹é †ã¯ä¸è¦ã§ã€å˜ã«ãƒ›ã‚¹ãƒˆåã‚’ DNS è§£æ±ºã™ã‚Œã° OK ã§ã™ã€‚\nã“ã“ã§ã¯ä¸‹è¨˜ã‚’å‰æã¨ã—ã¦æ‰‹é †ã‚’è¨˜ã—ã¾ã™ã€‚\nå–å¾—ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³åã¯ foo.com IPv4 Server ã®ãƒ›ã‚¹ãƒˆåã¯ bar set service dns dyamic interface pppoe0 service cloudflare host-name bar.foo.com set service dns dyamic interface pppoe0 service cloudflare login \u0026lt;email address\u0026gt; set service dns dyamic interface pppoe0 service cloudflare password \u0026lt;global api key\u0026gt; set service dns dyamic interface pppoe0 service cloudflare protocol cloudflare set service dns dyamic interface pppoe0 service cloudflare zone foo.com commit ã“ã®çŠ¶æ…‹ã§ä¸‹è¨˜ã®æ“ä½œã§çŠ¶æ…‹ã‚’ç¢ºèªã—ã¾ã™ã€‚\nrun show dns dynamic status ip address : 14.x.x.x host-name : bar.foo.com last update : 2023-12-DD 07:16:59 update-status: good åå‰è§£æ±ºã‚’ç¢ºèªã—ã¾ã™ã€‚\ndig bar.foo.com. a +short x.x.x.x Firewall è¨­å®š set firewall name LAN_OUT description \u0026#39;LAN to the Internet\u0026#39; set firewall name LAN_OUT default-action accept set firewall name WAN_IN description \u0026#39;WAN to Internal\u0026#39; set firewall name WAN_IN default-action drop set firewall name WAN_IN rule 10 action accept set firewall name WAN_IN rule 10 state established enable set firewall name WAN_IN rule 10 state related enable set firewall name WAN_IN rule 20 action drop set firewall name WAN_IN rule 20 state invalid enable set firewall name WAN_IN rule 19132 description \u0026#39;Minecraft\u0026#39; set firewall name WAN_IN rule 19132 action accept set firewall name WAN_IN rule 19132 destination address 10.0.1.100 set firewall name WAN_LOCAL default-action drop set firewall name WAN_LOCAL rule 10 action accept set firewall name WAN_LOCAL rule 10 state established enable set firewall name WAN_LOCAL rule 10 state related enable set firewall name WAN_LOCAL rule 20 action drop set firewall name WAN_LOCAL rule 20 state invalid enable ä½œæˆã—ãŸ firewall ã‚’ interface ã«ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ã€‚\nset interface pppoe pppoe0 firewall in name WAN_IN set interface pppoe pppoe0 firewall local name WAN_LOCAL set interface pppoe pppoe0 firewall out name LAN_OUT commit save ã¾ã¨ã‚ å‰è¿°ã—ãŸè¦ä»¶ã™ã¹ã¦ãŒæº€ãŸã›ã¾ã—ãŸã€‚ãŸã ä¸‹è¨˜ã®èª²é¡Œã‚‚ã‚ã‚Šã¾ã™ã€‚\nIPv6 ã® Firewall è¨­å®šãŒã¾ã  (å¾Œã«è¿½è¨˜ã—ã‚ˆã†ã¨æ€ã„ã¾ã™) IPoE ãŒçµæ§‹é…ã„ å‰è€…ã¯ãŸã è¨­å®šã™ã‚Œã°ã„ã„ã ã‘ãªã®ã§è§£æ±ºå‡ºæ¥ã‚‹ã®ã§ã™ãŒã€å¾Œè€…ã®èª²é¡Œã¯æƒ³å®šã¨ã¯ç•°ãªã£ã¦ã„ã¾ã—ãŸã€‚æ™‚é–“å¸¯ã«ã‚ˆã‚Šã¾ã™ãŒå¸¯åŸŸãŒ PPPoE ã®æ•°åˆ†ã®1ç¨‹åº¦ã«ä¸‹ãŒã‚‹ã“ã¨ã‚‚ã‚ã‚Šãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã‚‚è‹¥å¹²åŠ£ã‚Šã¾ã™ã€‚ãã‚‚ãã‚‚è‡ªåˆ†ã®å ´åˆã¯ Asani-net ã® v6connect ã‚’ä½¿ã£ã¦ã„ã¦ã€æœ¬æ¥çµ‚ç«¯ã®æƒ…å ±ç­‰ã‚’è‡ªå‹•è¨­å®šã§ãã‚‹å¯¾å¿œãƒ«ãƒ¼ã‚¿ã®ã¿ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãã†ãªã®ã§ã™ãŒã€ã‚µãƒãƒ¼ãƒˆå¤–ã®æ–¹æ³•ã§æ¥ç¶šã—ã¦ã„ã‚‹æ™‚ç‚¹ã§ä¸å®‰ã¯ã‚ã‚Šã¾ã™\u0026hellip;ã€‚\nã‚ˆã£ã¦ PPPoE æ¥ç¶šã‚ªãƒ³ãƒªãƒ¼ã®ãƒ›ãƒƒãƒˆã‚¹ã‚¿ãƒ³ãƒã‚¤æ©Ÿã‚’ä»Šå›è¨­å®šã—ãŸãƒ«ãƒ¼ã‚¿ã®æ¨ªã«éš£æ¥ã—ã¦ä¸¦ã¹ã¦ã„ã¾ã™ã€‚ã“ã®ç‚¹ã¯ã‚²ãƒ¼ãƒŸãƒ³ã‚°ãƒã‚·ãƒ³ç­‰æ¥ç¶šã‚’å®‰å®šã•ã›ãŸã„ãƒã‚·ãƒ³ã«å¯¾ã—ã¦ã® Policy Based Routing ã‚’æ›¸ã‘ã‚‹æº–å‚™ã‚’ã™ã‚Œã°ã„ã„ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\nã¾ãŸã€NIC ã‚’3æšä»¥ä¸Šç©ã‚“ã ãƒ«ãƒ¼ã‚¿ãƒ¼ã§ã‚ã‚Œã° Source NAT, Policy Based Routing ã®è¨˜è¿°ã‚’å¤‰ãˆã¦ã€ä¸‡ãŒä¸€æ¥ç¶šæ€§ãŒå®‰å®šã—ãªã„å ´åˆã«ç›´ã¡ã«ç«¯æœ«ã®æ¥ç¶šã™ã‚‹ã‚µãƒ–ãƒãƒƒãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãªã‚“ã¦é‹ç”¨ã‚‚å‡ºæ¥ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\nã¨ã‚¿ã‚¤ãƒˆãƒ«ã¨çµæœãŒä¹–é›¢ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ãŒã€ã¨ã¯è¨€ãˆ VyOS ã§ IPoE æ¥ç¶šã— NAT ã—å„ç«¯æœ«ã‹ã‚‰ IPv4 æ¥ç¶šã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã—ã€å¤–éƒ¨ã¸ã‚µãƒ¼ãƒãƒ¼ã‚‚å…¬é–‹ã™ã‚‹ã¨ã„ã†è¦ä»¶ã®æƒ…å ±æºãŒã»ã¼ç„¡ã‹ã£ãŸã®ã§è¨˜äº‹ã«ã—ã¾ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/vyos-ipoe-pppoe/","summary":"\u003cp\u003e\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚ä»Šã¾ã§è‡ªå®…ã§ã¯ PPPoE æ¥ç¶šã‚’ã—ã¦ Global IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã—ã¦è‡ªå®…ã«ãƒã‚¤ã‚¯ãƒ©ã‚µãƒ¼ãƒãƒ¼ã‚’å¤–éƒ¨å…¬é–‹ã—ãã®æ¥ç¶šã‚’ä½¿ã£ã¦å„ç«¯æœ«ã§ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’ã—ã¦ã„ã¾ã—ãŸã€‚ãŸã ã€IPoE æ¥ç¶šã™ã‚‹ã¨æ··é›‘æ™‚é–“ã‚’å›é¿å‡ºæ¥ã‚‹ã¨èã„ã¦ã„ãŸã®ã§ (ã“ã‚Œã«ã¤ã„ã¦ã¯å¾Œè¡“ã—ã¾ã™)ã€æ™®æ®µã®ã‚²ãƒ¼ãƒ ã‚„å„ç«¯æœ«ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã¯ IPoE æ¥ç¶šã‚’åˆ©ç”¨ã—ãƒã‚¤ã‚¯ãƒ©ã‚µãƒ¼ãƒãƒ¼ã¯ PPPoE ã§å…¬é–‹ã€ã¨å‡ºæ¥ãªã„ã‹ã¨è€ƒãˆã¾ã—ãŸã€‚IPoE ã¯ IPv4 over IPv6 ã®ãƒˆãƒ³ãƒãƒªãƒ³ã‚°æ¥ç¶šã™ã‚‹ãŸãŸã‚ IPoE ã ã‘ã§ã¯ IPv4 Global IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒãƒ¼å…¬é–‹ã¯ä¸å¯èƒ½ã ã‹ã‚‰ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã“ã“ã§ã¯ VyOS ã‚’ä½¿ã£ã¦ãã®ä¸¡è€…ã‚’æº€ãŸã™æ¥ç¶šã®è¨­å®šæ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"è¦ä»¶\"\u003eè¦ä»¶\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePPPoE ã—ã¦ Global IPv4 ã‚’å–å¾—ã—ã‚µãƒ¼ãƒãƒ¼ã‚’å¤–éƒ¨ã«æä¾›\u003c/li\u003e\n\u003cli\u003e(ãã®éš›ã« Dynamic DNS ã‚’åˆ©ç”¨ (è‡ªå®…ã¯ Cloudflare))\u003c/li\u003e\n\u003cli\u003eã‚µãƒ¼ãƒãƒ¼ä»¥å¤–ã®ç«¯æœ«ã®ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã¯ IPoE æ¥ç¶šã—ãŸçµŒè·¯ã«æµã™\u003c/li\u003e\n\u003cli\u003eå›ç·šã¯NTT ãƒ•ãƒ¬ãƒƒãƒ„æƒ³å®š (è‡ªåˆ†ã®å ´åˆã¯ Asahi-net, IPv6 æ¥ç¶šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚ã‚Š, ãã®ä»–ã§ã‚‚å¯)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"iso-ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰\"\u003eISO ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰\u003c/h2\u003e\n\u003cp\u003eVyOS ã¯ Stable ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯æœ‰å„Ÿãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ãªã„ã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡ºæ¥ã¾ã›ã‚“ãŒãƒ“ãƒ«ãƒ‰ã™ã‚Œã° ISO ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒä½œã‚Œã¾ã™ã€‚ãã®æ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e2023/12 æ™‚ç‚¹ã§æœ€æ–°ã® Stable ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.3.4 ã‚’æŒ‡å®š\u003c/li\u003e\n\u003cli\u003eé©å½“ãª Linux ç«¯æœ«ã§ãƒ“ãƒ«ãƒ‰ã—ã¾ã—ãŸãŒ Docker ã‚’åˆ©ç”¨ã§ãã‚Œã°ã©ã“ã§ã‚‚è‰¯ã•ãã†\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit clone -b equuleus https://github.com/vyos/vyos-build\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecd vyos-build/\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edocker run --rm -it --privileged -v \u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003epwd\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e:/vyos -w /vyos vyos/vyos-build:equuleus bash\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e./configure --architecture amd64 --build-type release --version 1.3.4\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo make iso\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eãƒ“ãƒ«ãƒ‰ãŒå®Œäº†ã™ã‚‹ã¨ \u003ccode\u003ebuild/\u003c/code\u003e ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã« iso ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå‡ºæ¥ä¸ŠãŒã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚\u003c/p\u003e","title":"VyOS ã§ IPoE/PPPoE ã‚’ä½µç”¨ã—ã¦å®‰å®šã—ãŸæ¥ç¶š\u0026ã‚µãƒ¼ãƒãƒ¼å…¬é–‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚jedipunkz ã§ã™ã€‚\nä»Šå›ã¯ã€kubectl ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’é–‹ç™ºã—ãŸã“ã¨ãŒãªã‹ã£ãŸã®ã§ã€Go ã®å­¦ç¿’ã¨åˆã‚ã›ã¦ãŸã‚ã—ã«1ã¤ä½œã£ã¦ã¿ãŸã®ã§ãã®å†…å®¹ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\né–‹ç™ºã—ãŸ kubectl plugin: kubectl-fuzzy-login ä¸‹è¨˜ãŒä»Šå›é–‹ç™ºã—ãŸ kubectl ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚\nhttps://github.com/jedipunkz/kubectl-fuzzy-login\nä½•ãŒå‡ºæ¥ã‚‹ã‹ ä¸‹è¨˜ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚’ã”è¦§é ‚ãã¨ä¸€ç›®ç­ç„¶ã ã¨æ€ã„ã¾ã™ã€‚\nKubernetes ã®ãƒãƒƒãƒ‰ã¨ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒã—ã¤ã¤é¸æŠã—ã€æœ€çµ‚çš„ã«ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³å‡ºæ¥ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ãªã£ã¦ã„ã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠãŒã‚µã‚¤ãƒ‰ã‚«ãƒ¼æ§‹æˆã«ãªã£ã¦ã„ãŸå ´åˆã¯ã€ãã®ã†ã¡ã®ã©ã®ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã‹ã‚‚ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒå‡ºæ¥ã¾ã™ã€‚ãªãŠã€ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ Go ã§é–‹ç™ºã—ã¾ã—ãŸã€‚\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³• Krew ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ä¸‹è¨˜ã®æ“ä½œã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚Krew ãŒäº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\ngit clone https://github.com/jedipunkz/kubectl-fuzzy-login.git kubectl krew install --manifest=./kubectl-fuzzy-login/krew/fuzzy-login.yaml ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æ“ä½œã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å ´åˆã¯ä¸‹è¨˜ã§ã™ã€‚\ngit clone https://github.com/jedipunkz/kubectl-fuzzy-login.git cd kubectl-fuzzy-login go build cp kubectl-fuzzy-login /your/bin/path ä½¿ç”¨æ–¹æ³• ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã—ã§ã€å…¨ Namespaces ã‚’å¯¾è±¡ã«æ¤œç´¢ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ãªã„å ´åˆã¯ä¸‹è¨˜ã®ã‚ˆã†ã«å®Ÿè¡Œã—ã¾ã™ã€‚\nkubectl fuzzy login ã¾ãš Pod ã‚’é¸æŠã—ã¾ã™ã€‚Pod åã®ä¸€éƒ¨ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã§ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ãƒ»ãƒ•ã‚¡ã‚¸ãƒ¼æ¤œç´¢å‡ºæ¥ã¾ã™ã€‚ãã® Pod ã«è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠ (ã‚µã‚¤ãƒ‰ã‚«ãƒ¼) ãŒã‚ã‚‹å ´åˆã€æ›´ã«ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒå‡ºæ¥ã¾ã™ã€‚æœ€çµ‚çš„ã«ã‚³ãƒ³ãƒ†ãƒŠã‚’é¸æŠã— Enter ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã“ã¨ã§ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³å‡ºæ¥ã¾ã™ã€‚ãŸã ã—ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚·ã‚§ãƒ«ãŒå…¥ã£ã¦ã„ãªã„å ´åˆã¯å…¥ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã›ã‚“ã€‚\nã‚·ã‚§ãƒ«æŒ‡å®š ã¾ãŸä¸‹è¨˜ã®ã‚ˆã†ã« -s ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚·ã‚§ãƒ«ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚\nkubectl fuzzy login -s /bin/bash Namespace æŒ‡å®š Namespace ã‚’ -n ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚\nkubectl fuzzy login -n default Kubectl Plugin é–‹ç™ºã®åŸºæœ¬ Kubectl Plugin ã®é–‹ç™ºæ–¹æ³•ã®åŸºæœ¬ã«ã¤ã„ã¦è»½ãè¨˜ã—ã¾ã™ã€‚\nKubectl Plugin ã¯ã€Kubernetes ã® CLI ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ kubectl ã®æ‹¡å¼µæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‹¬è‡ªã®ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ã‚’ä½œæˆã—ã¦ kubectl ã«è¿½åŠ ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚é–‹ç™ºæ–¹æ³•ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚\nè¨€èªã®é¸æŠ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ä»»æ„ã®è¨€èªã§æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚Bash ã§ã‚‚æ›¸ã‘ã‚‹ãã†ã§ã™ã€‚kubectlã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å˜ã«æ–°ã—ã„ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚ãã®ãŸã‚ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯kubectlã¨åŒã˜ãƒã‚·ãƒ³ä¸Šã§å®Ÿè¡Œã§ãã‚‹ä»»æ„ã®è¨€èªã§æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚\nPlugin å kubectl- ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§å§‹ã¾ã‚‹åå‰ã‚’æŒã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã° kubectl-foo-bar ã¨ã„ã† Plugin åã®å ´åˆã€ä¸‹è¨˜ã®ã‚ˆã†ã« Plugin ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\nkubectl foo bar Kubernetes ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä½¿ç”¨ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒ Kubernetes API ã¨å¯¾è©±ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã€é©åˆ‡ãª Kubernetes ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚Goã®å ´åˆã¯ã€kubernetes/client-go ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒåºƒãä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãã†ã§ã™ã€‚\nkubectl-fuzzy-login ã®ã‚³ãƒ¼ãƒ‰æ§‹æˆã®èª¬æ˜ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ cmd/root.go ã“ã“ã«ã¯ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã¨ãªã‚‹ã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã¯ root.go ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æ©Ÿèƒ½ã—ã¦ã„ã¾ã™ã€‚\nä¸»ã«ä»¥ä¸‹ã®å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚\nKubernetesã‚¯ãƒ©ã‚¹ã‚¿ã¨ã®æ¥ç¶šã‚’ç¢ºç«‹ã—ã¾ã™ã€‚ PodGetter ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¯ãƒ©ã‚¹ã‚¿å†…ã®å…¨Podã‚’å–å¾—ã—ã¾ã™ã€‚ å–å¾—ã—ãŸPodã®ä¸­ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠã—ãŸPodã‚’ç‰¹å®šã—ã¾ã™ã€‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠã—ãŸPodå†…ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ç‰¹å®šã—ã¾ã™ã€‚ PodExecutor ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã€ç‰¹å®šã®ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚ internal/kubernetes ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å†…éƒ¨æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã¯ã€internal/kubernetes ã¨ã„ã†ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã‚ã‚Šã€Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ã¨ã®ã‚„ã‚Šå–ã‚Šã‚’æ‹…å½“ã—ã¦ã„ã¾ã™ã€‚\nPodGetter: ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ã€Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ã‹ã‚‰ Pod ã‚’å–å¾—ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ PodExecutor: ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ã€Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ä¸Šã®ç‰¹å®šã® Pod ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ Krew å¯¾å¿œã«ã¤ã„ã¦ Krew ã¯ kubectl ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æ¤œç´¢ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»æ›´æ–°ãŒè¡Œãªãˆã¾ã™ã€‚Krew ã®å…¬å¼ãƒ¬ãƒã‚¸ãƒˆãƒªã« PR ã‚’é€ã£ã¦ã€èª°ã‚‚ãŒè‡ªåˆ†ã®é–‹ç™ºã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚‹ã®ã§ã™ãŒã€PR ãŒãƒãƒ¼ã‚¸ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€ä»Šå›ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ãƒã‚¸ãƒˆãƒªä¸Šã« Manifest ã‚’ä½œæˆã—ã¦ãã‚Œã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã‚’å–ã‚Šã¾ã—ãŸã€‚(ã“ã®ã‚ãŸã‚Šã¯ HomeBrew ã«ä¼¼ã¦ã„ã¾ã™ã­)\nä½œæˆã—ãŸ Manifest ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚\nhttps://github.com/jedipunkz/kubectl-fuzzy-login/blob/main/krew/fuzzy-login.yaml\nä¸Šè¨˜ã¨é‡è¤‡ã—ã¾ã™ãŒã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ãƒã‚¸ãƒˆãƒªä¸Šã® Manifest ã‚’åˆ©ç”¨ã—ã¦ä¸‹è¨˜ã®é€šã‚Šã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡ºæ¥ã¾ã™ã€‚\ngit clone https://github.com/jedipunkz/kubectl-fuzzy-login.git kubectl krew install --manifest=./kubectl-fuzzy-login/krew/fuzzy-login.yaml ã¾ã¨ã‚ Kubectl ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®é–‹ç™ºè‡ªä½“ã¯\nãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å‘½åã«ã‚ˆã£ã¦æ“ä½œæ–¹æ³•ãŒè¨­å®šã§ãã‚‹ ä»»æ„ã®è¨€èªã§é–‹ç™ºã§ãã‚‹ Go ã‚’ä½¿ã†å ´åˆã¯ client-go ã‚’ä½¿ãˆã°è‰¯ã„ ã¨ã„ã†ã“ã¨ã§ã€æ¯”è¼ƒçš„ç°¡å˜ã«é–‹ç™ºã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚ä»Šå›ã¯ Go ã® Viper ã‚’ä½¿ã£ã¦ -n ã‚„ -s ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¾ã—ãŸãŒã€ã“ã®ã‚ãŸã‚Šã‚‚ä½•ã§ã‚‚è‰¯ã„æ°—ã‚‚ã—ã¾ã™ã€‚è‡ªç”±åº¦ãŒé«˜ã„åˆ†ã€é€†ã«ã©ã†ã™ã‚‹ã¹ããªã®ã‹è¿·ã†ç‚¹ã¯ã‚ã‚Šã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/kubectl-plugin/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003ejedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ã€kubectl ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’é–‹ç™ºã—ãŸã“ã¨ãŒãªã‹ã£ãŸã®ã§ã€Go ã®å­¦ç¿’ã¨åˆã‚ã›ã¦ãŸã‚ã—ã«1ã¤ä½œã£ã¦ã¿ãŸã®ã§ãã®å†…å®¹ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"é–‹ç™ºã—ãŸ-kubectl-plugin-kubectl-fuzzy-login\"\u003eé–‹ç™ºã—ãŸ kubectl plugin: kubectl-fuzzy-login\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ãŒä»Šå›é–‹ç™ºã—ãŸ kubectl ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/jedipunkz/kubectl-fuzzy-login\"\u003ehttps://github.com/jedipunkz/kubectl-fuzzy-login\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"ä½•ãŒå‡ºæ¥ã‚‹ã‹\"\u003eä½•ãŒå‡ºæ¥ã‚‹ã‹\u003c/h3\u003e\n\u003cp\u003eä¸‹è¨˜ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚’ã”è¦§é ‚ãã¨ä¸€ç›®ç­ç„¶ã ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eKubernetes ã®ãƒãƒƒãƒ‰ã¨ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒã—ã¤ã¤é¸æŠã—ã€æœ€çµ‚çš„ã«ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³å‡ºæ¥ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ãªã£ã¦ã„ã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠãŒã‚µã‚¤ãƒ‰ã‚«ãƒ¼æ§‹æˆã«ãªã£ã¦ã„ãŸå ´åˆã¯ã€ãã®ã†ã¡ã®ã©ã®ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã‹ã‚‚ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒå‡ºæ¥ã¾ã™ã€‚ãªãŠã€ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ Go ã§é–‹ç™ºã—ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"kubectl-fuzzy-login\" loading=\"lazy\" src=\"../../pix/kubectl-fuzzy-login.gif\"\u003e\u003c/p\u003e\n\u003ch3 id=\"ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•\"\u003eã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://krew.sigs.k8s.io/\"\u003eKrew\u003c/a\u003e ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ä¸‹è¨˜ã®æ“ä½œã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚Krew ãŒäº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit clone https://github.com/jedipunkz/kubectl-fuzzy-login.git\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ekubectl krew install --manifest\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e./kubectl-fuzzy-login/krew/fuzzy-login.yaml\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eãƒãƒ‹ãƒ¥ã‚¢ãƒ«æ“ä½œã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å ´åˆã¯ä¸‹è¨˜ã§ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit clone https://github.com/jedipunkz/kubectl-fuzzy-login.git\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecd kubectl-fuzzy-login\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ego build\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecp kubectl-fuzzy-login /your/bin/path\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"ä½¿ç”¨æ–¹æ³•\"\u003eä½¿ç”¨æ–¹æ³•\u003c/h3\u003e\n\u003ch4 id=\"ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã—ã§å…¨-namespaces-ã‚’å¯¾è±¡ã«æ¤œç´¢ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹\"\u003eã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã—ã§ã€å…¨ Namespaces ã‚’å¯¾è±¡ã«æ¤œç´¢ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹\u003c/h4\u003e\n\u003cp\u003eã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ãªã„å ´åˆã¯ä¸‹è¨˜ã®ã‚ˆã†ã«å®Ÿè¡Œã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ekubectl fuzzy login \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eã¾ãš Pod ã‚’é¸æŠã—ã¾ã™ã€‚Pod åã®ä¸€éƒ¨ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã§ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ãƒ»ãƒ•ã‚¡ã‚¸ãƒ¼æ¤œç´¢å‡ºæ¥ã¾ã™ã€‚ãã® Pod ã«è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠ (ã‚µã‚¤ãƒ‰ã‚«ãƒ¼) ãŒã‚ã‚‹å ´åˆã€æ›´ã«ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒå‡ºæ¥ã¾ã™ã€‚æœ€çµ‚çš„ã«ã‚³ãƒ³ãƒ†ãƒŠã‚’é¸æŠã— Enter ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã“ã¨ã§ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³å‡ºæ¥ã¾ã™ã€‚ãŸã ã—ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚·ã‚§ãƒ«ãŒå…¥ã£ã¦ã„ãªã„å ´åˆã¯å…¥ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã›ã‚“ã€‚\u003c/p\u003e\n\u003ch4 id=\"ã‚·ã‚§ãƒ«æŒ‡å®š\"\u003eã‚·ã‚§ãƒ«æŒ‡å®š\u003c/h4\u003e\n\u003cp\u003eã¾ãŸä¸‹è¨˜ã®ã‚ˆã†ã« \u003ccode\u003e-s\u003c/code\u003e ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚·ã‚§ãƒ«ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ekubectl fuzzy login -s /bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"namespace-æŒ‡å®š\"\u003eNamespace æŒ‡å®š\u003c/h4\u003e\n\u003cp\u003eNamespace ã‚’ \u003ccode\u003e-n\u003c/code\u003e ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚\u003c/p\u003e","title":"k8s ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒ\u0026ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ kubectl ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®é–‹ç™º"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚jedipunkzğŸš€ ã§ã™ã€‚\nä»¥å‰ã“ã¡ã‚‰ã® PipeCD æ¤œè¨¼ã®è¨˜äº‹ ã§ Progressive Deliver ã«ã¤ã„ã¦èª¿æŸ»ã—ãŸã®ã§ã™ãŒã€Kubernetes ã§ã“ã® Progressive Delivery ã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•ã‚’èª¿ã¹ã¦ãŠããŸã„ãªã¨æ€ã£ã¦æ‰‹å…ƒã® Macbook ä¸Šã§æ¤œè¨¼ã—ã¦ã¿ãŸã®ã§ãã®éš›ã®æ‰‹é †ã‚’è¨˜ãã†ã‹ã¨æ€ã„ã¾ã™ã€‚\nProgressive Delivery ã®æ¦‚è¦ ã“ã“ã§æ¦‚è¦ã ã‘è¨˜ã—ã¦ãŠãã¾ã™ã€‚Canary ãƒªãƒªãƒ¼ã‚¹ã¯æ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’ã‚ã‚‹ç¨‹åº¦ã®å‰²åˆã ã‘ãƒªãƒªãƒ¼ã‚¹ã—ã€å¾ã€…ã«ãƒªãƒªãƒ¼ã‚¹ã‚’é€²è¡Œã•ã›ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹å¼ã¨ã„ã†ã“ã¨ã¯ã”å­˜çŸ¥ã ã¨æ€ã„ã¾ã™ãŒã€Progressive Delivery ã¯ãã®éç¨‹ã§\næ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã®çµ±è¨ˆæƒ…å ±ã‚’å¾—ã‚‹ äºˆã‚å®šç¾©ã—ãŸãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸå®šç¾©ã«å¯¾ã—ã¦æ¡ä»¶æº€ãŸã—ã¦ã„ã‚‹ã‹ã‚’éç¨‹æ¯ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹ ãƒã‚§ãƒƒã‚¯ OK ã§ã‚ã‚Œã°æ¬¡ã®éç¨‹ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é€²ã‚ã‚‹ äºˆã‚å®šç¾©ã—ãŸå¹¾ã¤ã‹ã®ãƒ‡ãƒ—ãƒ­ã‚¤éç¨‹ã‚’å…¨ã¦çµ‚ãˆã‚‹ã¨ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã¨ãªã‚‹ ã¨ã„ã†ã‚¹ãƒ†ãƒƒãƒ—ã‚’çµŒã¾ã™ã€‚\nç”¨ã„ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ Kubernetes ã§ Progressive Delivery ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ä¸‹è¨˜ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ç”¨ã„ã‚‹äº‹ãŒå¯èƒ½ã§ã™ã€‚ ã¾ãŸä»Šå›ã®æ‰‹é †ã¯ MacOS ã‚’å‰æã«è¨˜ã—ã¾ã™ã€‚\nArgo Rollouts Prometheus Istio Kubernetes (ä»Šå›ã¯ Minikube ã‚’ä½¿ã„ã¾ã—ãŸ) äº‹å‰ã®æº–å‚™ Istio Istio ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\ncurl -L https://istio.io/downloadIstio | ISTIO_VERSION=17.2 sh - Istio ã‚’ Minikube ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\ncd istio-17.2 istioctl install --set profile=demo -y Kubernetes Namespace default ã§èµ·å‹•ã—ãŸ Pod ãŒè‡ªå‹•çš„ã« Envoy ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚\nkubectl label namespace default istio-injection=enabled Prometheus ä¸‹è¨˜ã® Istio ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹ Manifest ã‚’ç”¨ã„ã‚‹äº‹ã§ã€Istio ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒè‡ªå‹•çš„ã« Prometheus ã«åé›†ã•ã‚Œã¾ã™ã€‚\nkubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.17/samples/addons/prometheus.yaml ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿæ–½ã—ã¦ Prometheus UI ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã¨å…±ã«è‡ªå‹•çš„ã«ãƒ–ãƒ©ã‚¦ã‚¶ã§ UI ãƒšãƒ¼ã‚¸ã¸é·ç§»ã—ã¾ã™ã€‚\nminikube service -n istio-system prometheus Nginx ã‚³ãƒ³ãƒ†ãƒŠã§å‹•ä½œç¢ºèª Nginx ã®ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç”¨ã„ã¦å‹•ä½œç¢ºèªã‚’å®Ÿæ–½ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\nDeployment, Service ã®ãƒ‡ãƒ—ãƒ­ã‚¤ ä¸‹è¨˜ã®å†…å®¹ã‚’ nginx.yaml ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã§ä¿å­˜ã—ã¾ã™ã€‚\napiVersion: apps/v1 kind: Deployment metadata: name: nginx spec: replicas: 1 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:1.23.4 # tag ã¯ã‚ãˆã¦å¤ãã—ã¦ã„ã¾ã™ ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: nginx spec: selector: app: nginx ports: - protocol: TCP port: 80 targetPort: 80 ä¸‹è¨˜ã®é€šã‚Šãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\nkubectl apply -f nginx.yaml Istio Gateway ã®ãƒ‡ãƒ—ãƒ­ã‚¤ ä¸‹è¨˜ã®å†…å®¹ã‚’ nginx-istio.yaml ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã§ä¿å­˜ã—ã¾ã™ã€‚\napiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: nginx-gateway spec: selector: istio: ingressgateway servers: - port: number: 80 name: http protocol: HTTP hosts: - \u0026#34;*\u0026#34; --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: nginx spec: hosts: - \u0026#34;*\u0026#34; gateways: - nginx-gateway http: - match: - uri: exact: / route: - destination: host: nginx.default.svc.cluster.local port: number: 80 Istio Gateway ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\nkubectl apply -f nginx-istio.yaml ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€Istio Gateway çµŒç”±ã§ Nginx ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã¾ã™ã€‚\nminikube service istio-ingressgateway -n istio-system |--------------|----------------------|-------------------|---------------------------| | NAMESPACE | NAME | TARGET PORT | URL | |--------------|----------------------|-------------------|---------------------------| | istio-system | istio-ingressgateway | status-port/15021 | http://192.168.49.2:31483 | | | | http2/80 | http://192.168.49.2:30891 | | | | https/443 | http://192.168.49.2:31959 | | | | tcp/31400 | http://192.168.49.2:31196 | | | | tls/15443 | http://192.168.49.2:32100 | |--------------|----------------------|-------------------|---------------------------| ğŸƒ Starting tunnel for service istio-ingressgateway. |--------------|----------------------|-------------|------------------------| | NAMESPACE | NAME | TARGET PORT | URL | |--------------|----------------------|-------------|------------------------| | istio-system | istio-ingressgateway | | http://127.0.0.1:52115 | | | | | http://127.0.0.1:52116 | | | | | http://127.0.0.1:52117 | | | | | http://127.0.0.1:52118 | | | | | http://127.0.0.1:52119 | |--------------|----------------------|-------------|------------------------| å®Ÿéš›ã«ã¯ http2/80 ã®ãƒãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ä¸Šè¨˜ã®å ´åˆã¯ http://127.0.0.1:52116 ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ nginx ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã¾ã™ã€‚ä¸Šè¨˜ã® minikube ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸçŠ¶æ…‹ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ loop ã—ã¤ã¤ curl ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãŠãã¾ã™ã€‚ã“ã‚Œã¯ Progressive Delivery ã® Analysis ã®å®šç¾©ã§ Istio ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‹ã‚‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹çµ±è¨ˆçµæœã‚’è¨˜ã—åˆ©ç”¨ã™ã‚‹ãŸã‚ã§ã™ã€‚\nwhile true; do curl http://127.0.0.1:52116; sleep 1; done Argo Rollouts, Analysis ã®å®šç¾© Argo Rollouts ã® Rollout, Analysis ã‚’å®šç¾©ã—ã¾ã™ã€‚\nAnalysis ã‚’å®šç¾©ã™ã‚‹ãŸã‚ä¸‹è¨˜ã®å†…å®¹ã‚’ nginx-analysis.yaml ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã§ä¿å­˜ã—ã¾ã™ã€‚\napiVersion: argoproj.io/v1alpha1 kind: AnalysisTemplate metadata: name: http-req-check spec: args: - name: service-name value: nginx metrics: - name: request-success-rate interval: 1m successCondition: result[0] \u0026gt;= 0.95 failureLimit: 1 provider: prometheus: address: http://prometheus.istio-system:9090 query: | sum(irate( istio_requests_total{reporter=\u0026#34;source\u0026#34;,destination_service=~\u0026#34;nginx.default.svc.cluster.local\u0026#34;,response_code!~\u0026#34;5.*\u0026#34;}[5m] )) / sum(irate( istio_requests_total{reporter=\u0026#34;source\u0026#34;,destination_service=~\u0026#34;nginx.default.svc.cluster.local\u0026#34;}[5m] )) ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸­ã§ Analysis ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€Prometheus ã¸ã®ã‚¯ã‚¨ãƒªã®å®šç¾©ã‚‚è¡Œã£ã¦ã„ã¾ã™ã€‚å…ˆç¨‹é–‹ã„ãŸ Prometheus UI ã‹ã‚‰ä¸Šè¨˜ã®ã‚¯ã‚¨ãƒªãŒå®Ÿéš›ã«å®Ÿè¡Œã§ãã‚‹ã‹ç¢ºèªã—ã¦ãŠãã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚ä¸Šè¨˜ã®ã‚¯ã‚¨ãƒªã‚’ ğŸ” ãƒãƒ¼ã‚¯ã«å…¥åŠ›ã—ã¦ Execute ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã ã‘ã§ã™ã€‚\nAnalysis ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\nkubectl apply -f nginx-analysis.yaml æ¬¡ã« Rollout ã‚’å®šç¾©ã™ã‚‹ãŸã‚ä¸‹è¨˜ã®å†…å®¹ã‚’ nginx-rollout.yaml ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã§ä¿å­˜ã—ã¾ã™ã€‚\napiVersion: argoproj.io/v1alpha1 kind: Rollout metadata: name: nginx spec: replicas: 2 selector: matchLabels: app: nginx strategy: canary: analysis: templates: - templateName: http-req-check maxUnavailable: 0 maxSurge: 1 steps: - setWeight: 30 - pause: duration: \u0026#34;30s\u0026#34; - setWeight: 60 - pause: duration: \u0026#34;30s\u0026#34; - setWeight: 100 - pause: duration: \u0026#34;10s\u0026#34; template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:1.23.4 # ä½¿ç”¨ã™ã‚‹nginxã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: nginx labels: app: nginx spec: ports: - port: 80 targetPort: 80 selector: app: nginx Rollout ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\nkubectl apply -f nginx-rollout.yaml Progressive Delivery ã®é€²è¡ŒçŠ¶æ³ã‚’ç¢ºèªã™ã‚‹ ã§ã¯å®Ÿéš›ã« Progressive Delivery ã®ãƒ‡ãƒ—ãƒ­ã‚¤é€²è¡ŒçŠ¶æ³ã‚’ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚\nä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ Argo Rollouts ã®ãƒ‡ãƒ—ãƒ­ã‚¤é€²è¡ŒçŠ¶æ³ã‚’ã‚¦ã‚©ãƒƒãƒã—ç¶šã‘ã‚‹äº‹ãŒå¯èƒ½ã§ã™ã€‚æ–°ã—ã„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’èµ·å‹•ã—ã¦å®Ÿè¡Œã—ã¦ãŠãã¾ã™ã€‚\nkubectl argo rollouts get rollout nginx --watch ã¾ãš nginx:1.23.4 ã¨ã„ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹æ§˜å­ãŒä¸‹è¨˜ã®ã‚ˆã†ã«ç¢ºèªå‡ºæ¥ã‚‹ã¯ãšã§ã™ã€‚Status: Healty ã¨ãªã£ã¦ã„ã¾ã™ã€‚\nName: nginx Namespace: default Status: âœ” Healthy Strategy: Canary Step: 6/6 SetWeight: 100 ActualWeight: 100 Images: nginx:1.23.4 (stable) Replicas: Desired: 2 Current: 2 Updated: 2 Ready: 2 Available: 2 NAME KIND STATUS AGE INFO âŸ³ nginx Rollout âœ” Healthy 24s â””â”€â”€# revision:1 â””â”€â”€â§‰ nginx-8595d69c7f ReplicaSet âœ” Healthy 24s stable â”œâ”€â”€â–¡ nginx-8595d69c7f-p5cxl Pod âœ” Running 24s ready:2/2 â””â”€â”€â–¡ nginx-8595d69c7f-tvqx9 Pod âœ” Running 24s ready:2/2 æ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’è¡Œã†ãŸã‚ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°ã‚’æ›´æ–°ã—ã¦ã¿ã¾ã™ã€‚ä¸‹è¨˜ã®æ“ä½œã§è¡Œãˆã¾ã™ã€‚\nkubectl argo rollouts set image nginx nginx=nginx:1.24.0 Progressive Delivery ã®å„éç¨‹ãŒå…¨ã¦é€šéã—ãŸçŠ¶æ³ã‚’ä¸‹è¨˜ã«è¨˜ã—ã¾ã™ã€‚Revision: 2 ã®çŠ¶æ…‹ã§ Status: Healty ã¨ãªã£ã¦ã„ã‚‹äº‹ãŒç¢ºèªå‡ºæ¥ã¾ã™ã€‚\nName: nginx Namespace: default Status: âœ” Healthy Strategy: Canary Step: 6/6 SetWeight: 100 ActualWeight: 100 Images: nginx:1.24.0 (stable) Replicas: Desired: 2 Current: 2 Updated: 2 Ready: 2 Available: 2 NAME KIND STATUS AGE INFO âŸ³ nginx Rollout âœ” Healthy 2m35s â”œâ”€â”€# revision:2 â”‚ â”œâ”€â”€â§‰ nginx-67d8cf46 ReplicaSet âœ” Healthy 81s stable â”‚ â”‚ â”œâ”€â”€â–¡ nginx-67d8cf46-jbjch Pod âœ” Running 81s ready:2/2 â”‚ â”‚ â””â”€â”€â–¡ nginx-67d8cf46-8rksc Pod âœ” Running 48s ready:2/2 â”‚ â””â”€â”€Î± nginx-67d8cf46-2 AnalysisRun âœ” Successful 81s âœ” 2 â””â”€â”€# revision:1 â””â”€â”€â§‰ nginx-8595d69c7f ReplicaSet â€¢ ScaledDown 2m35s ã“ã“ã¾ã§åˆ°é”ã™ã‚‹ãŸã‚ã« nginx-rollout.yaml ã§ä¸‹è¨˜ã®é€šã‚Šå®šç¾©ã—ãŸå†…å®¹ã®å„ã‚¹ãƒ†ãƒƒãƒ—ã‚’çµŒã¦ã„ã‚‹äº‹ã«ãªã‚Šã¾ã™ã€‚å®Ÿéš›ã«éç¨‹ã¯ 30%, 60%, 100% ã®å‰²åˆã§æ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€pause ã§æŒ‡å®šã—ãŸæœŸé–“ã€Analysis ã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ Prometheus ã«ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ç•°å¸¸ãŒãªã„ã‹è¨ˆæ¸¬ã—ã€å•é¡Œãªã‘ã‚Œã°ãã®éç¨‹ã‚’çµ‚ãˆã€æœ€çµ‚çš„ã«æ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã®å‰²åˆãŒ 100% ã¨ãªã‚Šã¾ã™ã€‚\nsteps: - setWeight: 30 - pause: duration: \u0026#34;30s\u0026#34; - setWeight: 60 - pause: duration: \u0026#34;30s\u0026#34; - setWeight: 100 - pause: duration: \u0026#34;10s\u0026#34; ã¾ã¨ã‚ æ¯”è¼ƒçš„ç°¡å˜ã« Progressive Delivery ãŒå®Ÿè·µå‡ºæ¥ã¾ã—ãŸã€‚å®Ÿéš›ã«é‹ç”¨ã™ã‚‹éš›ã«ã¯ã‚‚ã¡ã‚ã‚“ Istio, Prometheus ã®è¨­å®šã¯ç²¾æŸ»ã—ãŸã»ã†ãŒã„ã„ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸ Analysis ã®å®šç¾©ã‚„ Prometheus ã¸ã®ã‚¯ã‚¨ãƒªã‚‚ã€ç’°å¢ƒã‚„ã‚µãƒ¼ãƒ“ã‚¹ã®æ€§è³ªã«åˆã‚ã›ã¦èª¿æ•´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›ç´¹ä»‹ã—ãŸæ§‹æˆãŒåŸºæœ¬ã¨ãªã‚‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/argo-rollout-progressive-delivery/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003ejedipunkzğŸš€\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥å‰\u003ca href=\"https://jedipunkz.github.io/post/ecs-pipecd/\"\u003eã“ã¡ã‚‰ã® PipeCD æ¤œè¨¼ã®è¨˜äº‹\u003c/a\u003e ã§ Progressive Deliver ã«ã¤ã„ã¦èª¿æŸ»ã—ãŸã®ã§ã™ãŒã€Kubernetes ã§ã“ã® Progressive Delivery ã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•ã‚’èª¿ã¹ã¦ãŠããŸã„ãªã¨æ€ã£ã¦æ‰‹å…ƒã® Macbook ä¸Šã§æ¤œè¨¼ã—ã¦ã¿ãŸã®ã§ãã®éš›ã®æ‰‹é †ã‚’è¨˜ãã†ã‹ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"progressive-delivery-ã®æ¦‚è¦\"\u003eProgressive Delivery ã®æ¦‚è¦\u003c/h2\u003e\n\u003cp\u003eã“ã“ã§æ¦‚è¦ã ã‘è¨˜ã—ã¦ãŠãã¾ã™ã€‚Canary ãƒªãƒªãƒ¼ã‚¹ã¯æ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’ã‚ã‚‹ç¨‹åº¦ã®å‰²åˆã ã‘ãƒªãƒªãƒ¼ã‚¹ã—ã€å¾ã€…ã«ãƒªãƒªãƒ¼ã‚¹ã‚’é€²è¡Œã•ã›ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹å¼ã¨ã„ã†ã“ã¨ã¯ã”å­˜çŸ¥ã ã¨æ€ã„ã¾ã™ãŒã€Progressive Delivery ã¯ãã®éç¨‹ã§\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã®çµ±è¨ˆæƒ…å ±ã‚’å¾—ã‚‹\u003c/li\u003e\n\u003cli\u003eäºˆã‚å®šç¾©ã—ãŸãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸå®šç¾©ã«å¯¾ã—ã¦æ¡ä»¶æº€ãŸã—ã¦ã„ã‚‹ã‹ã‚’éç¨‹æ¯ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹\u003c/li\u003e\n\u003cli\u003eãƒã‚§ãƒƒã‚¯ OK ã§ã‚ã‚Œã°æ¬¡ã®éç¨‹ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é€²ã‚ã‚‹\u003c/li\u003e\n\u003cli\u003eäºˆã‚å®šç¾©ã—ãŸå¹¾ã¤ã‹ã®ãƒ‡ãƒ—ãƒ­ã‚¤éç¨‹ã‚’å…¨ã¦çµ‚ãˆã‚‹ã¨ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã¨ãªã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã¨ã„ã†ã‚¹ãƒ†ãƒƒãƒ—ã‚’çµŒã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ç”¨ã„ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢\"\u003eç”¨ã„ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢\u003c/h2\u003e\n\u003cp\u003eKubernetes ã§ Progressive Delivery ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ä¸‹è¨˜ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ç”¨ã„ã‚‹äº‹ãŒå¯èƒ½ã§ã™ã€‚\nã¾ãŸä»Šå›ã®æ‰‹é †ã¯ MacOS ã‚’å‰æã«è¨˜ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://argo-rollouts.readthedocs.io/en/stable/b\"\u003eArgo Rollouts\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://prometheus.io/\"\u003ePrometheus\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://istio.io/\"\u003eIstio\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eKubernetes (ä»Šå›ã¯ Minikube ã‚’ä½¿ã„ã¾ã—ãŸ)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"äº‹å‰ã®æº–å‚™\"\u003eäº‹å‰ã®æº–å‚™\u003c/h2\u003e\n\u003ch3 id=\"istio\"\u003eIstio\u003c/h3\u003e\n\u003cp\u003eIstio ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl -L https://istio.io/downloadIstio | ISTIO_VERSION\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e17.2 sh -\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIstio ã‚’ Minikube ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecd istio-17.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eistioctl install --set profile\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edemo -y\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eKubernetes Namespace \u003ccode\u003edefault\u003c/code\u003e ã§èµ·å‹•ã—ãŸ Pod ãŒè‡ªå‹•çš„ã« Envoy ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚\u003c/p\u003e","title":"æ‰‹è»½ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§ Argo Rollouts, Istio, Prometheus ã§ Progressive Delivery ã‚’è©¦ã™"},{"content":"ã“ã‚“ã«ã¡ã¯ @jedipunkz ğŸš€ ã§ã™ã€‚\næ™®æ®µä»•äº‹ã§ AWS ECS ã‚’ä½¿ã£ã¦ã„ã¦ Autoscallng Group ã«ã‚ˆã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ®ãˆã‚±ãƒ¼ãƒ«ã•ã›ã¦é‹ç”¨ã—ã¦ã„ã¾ã™ãŒã€é‹ç”¨ã—ã¦ã„ã‚‹ä¸­ã§ã‚ˆã‚Šé«˜é€Ÿã«ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«å‡ºæ¥ãªã„ã‚‚ã®ã ã‚ã†ã‹ï¼Ÿã¨æ€ã†ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½•å›ã‹ç™ºç”Ÿã—ã€å¯¾å¿œæ–¹æ³•ã«ã¤ã„ã¦æ¨¡ç´¢ã—ã¦ã„ã¾ã—ãŸã€‚\nå®Ÿéš›ã«ç™ºç”Ÿã—ãŸã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ ä¸‹è¨˜ã¯ã‚³ãƒ³ãƒ†ãƒŠæ¯ã® CPU ä½¿ç”¨ç‡ã§ã™ã€‚1åˆ†æœªæº€ã®é–“ã«æ€¥æ¿€ã«ã‚¢ã‚¯ã‚»ã‚¹ãŒå¢—ãˆã‚³ãƒ³ãƒ†ãƒŠã® CPU ä½¿ç”¨ç‡ãŒ 100% ã«é”ã— (å®Ÿéš›ã«ã¯ vCPU ã«åŸºã¥ã„ã¦ 200% ã¨ãªã£ã¦ã„ã‚‹)ã€ECS Service ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã« Fail ã—ã¦ã€ã‚³ãƒ³ãƒ†ãƒŠãŒè½ã¡ã€æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã¯èµ·å‹•ã™ã‚‹ã‚‚ã®ã®ã€ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ã«è€ãˆã‚‰ã‚Œãšã€ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢ã¨èµ·å‹•ã‚’ç¹°ã‚Šè¿”ã™ã¨ã„ã£ãŸçŠ¶æ³ã§ã—ãŸã€‚\nAutoscaling Policy, Cloudwatch Metrics Alarm ã®èª¿æ•´ ã¾ãšæœ€åˆã«è€ƒãˆãŸã®ãŒä¸‹è¨˜ã®å€¤ã®èª¿æ•´ã§ã™ã€‚\naws_app_autoscaling_policy ã® cooldown å€¤ aws_cloudwatch_metric_alarm ã® period å€¤ å…·ä½“çš„ã«ã¯ 60sec ã¨ãªã£ã¦ã„ãŸå€¤ã‚’ 10sec ãªã©ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã£ã¦ 60sec ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã§ã—ãã„å€¤è¨ˆç®—ã—ã¦ã‚¹ã‚±ãƒ¼ãƒ«ã•ã›ã¦ã„ãŸã¨ã“ã‚ã‚’ 10sec ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ç¸®ã‚ã¤ã¤ã‚¹ã‚±ãƒ¼ãƒ«ã•ã›ã‚‹ã€‚ã¤ã¾ã‚Šã‚ˆã‚Šè¿…é€Ÿã«ã‚¹ã‚±ãƒ¼ãƒ«ã•ã›ã‚‹ã“ã¨ã§ä¸Šè¨˜ã®ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã«è€ãˆã‚‰ã‚Œã‚‹ã®ã§ã¯ã¨è€ƒãˆã¾ã—ãŸã€‚\nã§ã™ãŒã€çµæœã¯ NG ã§ã—ãŸã€‚\nä¸‹è¨˜ã¯ Cloudwatch Metrics ã®æ§˜å­ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ãƒ—ãƒ­ãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ã€ãƒ‡ãƒ¼ã‚¿ä¸è¶³ ã¨ã„ã†çŠ¶æ…‹ã«é™¥ã£ã¦ã„ã‚‹äº‹ãŒã‚ã‹ã‚Šã¾ã™ã€‚\nå®Ÿéš›ã« ECS ã¯ã“ã®è¨­å®šã‚’ã—ãŸ Metrics Alarm ã§ã¯ã‚¹ã‚±ãƒ¼ãƒ«ã—ã¦ãã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\né«˜è§£åƒåº¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®åˆ©ç”¨ã«ã¤ã„ã¦ ã§ã‚ã‚Œã°é«˜è§£åƒåº¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ ã‚’åˆ©ç”¨ã™ã‚Œã°è‰¯ã„ã®ã§ã¯ã¨è€ƒãˆã¾ã—ãŸã€‚\næ­´å²çš„ã«\n2009å¹´å½“åˆã€5åˆ†é–“éš”ã ã£ãŸ Cloudwatch Metrics 2010å¹´ã«1åˆ†é–“éš”ã«å¤‰æ›´ ã¨ã„ã†èƒŒæ™¯ãŒã‚ã‚‹ã‚ˆã†ãªã®ã§ã™ãŒã€ãã‚Œã«å¯¾ã—ã¦é«˜è§£åƒåº¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¯1ç§’ã®é–“éš”ã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç™ºè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚‹ã¨ã®ã“ã¨ã€‚\nãŸã  ECS ãŒ Cloudwatch Alarm ã«ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç™ºè¡Œã™ã‚‹ã®ã§ã™ãŒã€AWS ã‚µãƒãƒ¼ãƒˆã«èã„ãŸã¨ã“ã‚ã€ECS ã¯é«˜è§£åƒåº¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«å¯¾å¿œã—ã¦ã„ãªã„ã€ã¨å›ç­”ã„ãŸã ãã¾ã—ãŸã€‚\nã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã§å‹•ã‹ã™è‡ªå‰ãƒ„ãƒ¼ãƒ« ESP ã®åˆ©ç”¨ã§è§£æ±º ã¨ã„ã†ã“ã¨ã§ã€è‡ªå‰ã®ãƒ„ãƒ¼ãƒ«ã‚’ Go ã§é–‹ç™ºã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã£ã¦å•é¡ŒãŒè§£æ±ºã™ã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚(ãŸã ã€ç¾æ™‚ç‚¹ã§ã¯ã¾ã é‹ç”¨ã«ä¹—ã›ã¦ã„ã¾ã›ã‚“)\nhttps://github.com/jedipunkz/esp\nå‰æã¨ã—ã¦ã¯ä¸‹è¨˜ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™\nè‡ªå‰ãƒ„ãƒ¼ãƒ« ESP ã¯å¯¾è±¡ã¨ãªã‚‹ã‚¢ãƒ—ãƒªã‚³ãƒ³ãƒ†ãƒŠã®ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã¨ã—ã¦èµ·å‹• ãƒ„ãƒ¼ãƒ«å†…ã§è¡Œã£ã¦ã„ã‚‹ã“ã¨ã¯ä¸‹è¨˜ã§ã™ã€‚\n(1) ESP ã¯ ECS ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚¢ãƒ—ãƒªã‚³ãƒ³ãƒ†ãƒŠã® CPU ä½¿ç”¨ç‡ã‚’è¨ˆç®—ã™ã‚‹ä¸Šã§å¿…è¦ãªå€¤ã‚’å–å¾— (2) ESP ã¯ã‚¢ãƒ—ãƒªã‚³ãƒ³ãƒ†ãƒŠã® CPU ä½¿ç”¨ç‡ã‚’è¨ˆç®— (3) ESP ã¯ CPU ä½¿ç”¨ç‡ã‚’ Cloudwatch Metrics ã¸é«˜è§£åƒåº¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ã—ã¦ Put çµæœã€Terraform ç­‰ã§ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®šã™ã‚Œã°ç§’å˜ä½ã§ã‚¹ã‚±ãƒ¼ãƒ«ã™ã‚‹ ECS ãŒæ§‹ç¯‰ã§ãã¾ã™ã€‚\nresource \u0026#34;aws_cloudwatch_metric_alarm\u0026#34; \u0026#34;example_high\u0026#34; { alarm_name = \u0026#34;example-CPU-Utilization-High-30\u0026#34; comparison_operator = \u0026#34;GreaterThanOrEqualToThreshold\u0026#34; evaluation_periods = \u0026#34;1\u0026#34; metric_name = \u0026#34;CPUUtilization\u0026#34; namespace = \u0026#34;\u0026lt;ESP èµ·å‹•æ™‚ã«è¨­å®šã™ã‚‹ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹å\u0026gt;\u0026#34; period = \u0026#34;10\u0026#34; # ã“ã“ã¯ç§’å˜ä½ã§è¨­å®šå‡ºæ¥ã‚‹ statistic = \u0026#34;Average\u0026#34; threshold = \u0026#34;15\u0026#34; dimensions = { ClusterName = aws_ecs_cluster.example.name ServiceName = aws_ecs_service.example.name } alarm_actions = [aws_appautoscaling_policy.scale_out.arn] } CPU ä½¿ç”¨ç‡ã®è¨ˆç®—ã«ã¤ã„ã¦ ECS ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ä¸‹è¨˜ã®æ§˜ãªãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¾ã™ã€‚\n\u0026#34;cpu_stats\u0026#34;: { \u0026#34;cpu_usage\u0026#34;: { \u0026#34;total_usage\u0026#34;: 1137691504, \u0026#34;percpu_usage\u0026#34;: [ 696479228, 441212276, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ], \u0026#34;usage_in_kernelmode\u0026#34;: 80000000, \u0026#34;usage_in_usermode\u0026#34;: 810000000 }, \u0026#34;system_cpu_usage\u0026#34;: 9393210000000, \u0026#34;online_cpus\u0026#34;: 2, \u0026#34;throttling_data\u0026#34;: { \u0026#34;periods\u0026#34;: 0, \u0026#34;throttled_periods\u0026#34;: 0, \u0026#34;throttled_time\u0026#34;: 0 } }, Classi ã•ã‚“ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ (https://tech.classi.jp/entry/2022/05/24/120000) ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚ã“ã®è¨˜äº‹ã§ã¯ Datadog ã® AWS Integration ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã•ã‚ŒãŸãã†ã§ã™ã€‚Datadog ã§ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã¾ã™ã€‚\nhttps://github.com/DataDog/integrations-core/blob/4cf0f7dc759683b454cf46b9ff5e2de561a58339/ecs_fargate/datadog_checks/ecs_fargate/ecs_fargate.py#L220\nçµæœçš„ã« ESP ã§ã¯ã€ä¸‹è¨˜ã®ã‚ˆã†ã«è¨ˆç®—ã—ã¾ã—ãŸã€‚\nhttps://github.com/jedipunkz/esp/blob/main/esp.go#L40-L42\ncpuUsage := ((float64(s.CPUStats.CPUUsage.TotalUsage) - float64(s.PreCPUStats.CPUUsage.TotalUsage)) / (float64(s.CPUStats.SystemCPUUsage) - float64(s.PreCPUStats.SystemCPUUsage))) * float64(s.CPUStats.OnlineCPUs) * 100 ã¾ã¨ã‚ ESP ã‚’ä½¿ã£ã¦ ECS ãŒç§’å˜ä½ã§ã‚‚ã‚¹ã‚±ãƒ¼ãƒ«ã•ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚ãŸã é‹ç”¨ã«ä¹—ã›ã‚‹ã¾ã§ã¯è‡³ã£ã¦ã„ãªã„ã®ã§ã€ãã‚Œã¾ã§ã«è² è·è©¦é¨“ç­‰ã‚’å®Ÿæ–½ã—ã¦åŠ¹æœã‚’æ¸¬ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚\nã¾ãŸã€é«˜é€Ÿã«ã™ã‚‹ã¨è¨˜ã—ã¾ã—ãŸãŒã€ã‚ˆã‚Šå…·ä½“çš„ã«è¡¨ç¾ã™ã‚‹ã¨ã‚¹ã‚±ãƒ¼ãƒ«ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’é€Ÿãå›ã™ã€ã¨ãªã‚Šã¾ã™ã€‚ã‚ˆã£ã¦ Fargate ã®å¼±ç‚¹ã§ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã¾ã§ã®æ™‚é–“ãŒæ¯”è¼ƒçš„æ›ã‹ã‚‹å•é¡Œã‚„ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®å¤§ãã•ã‹ã‚‰ç™ºç”Ÿã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚é–“ã®é•·æ™‚é–“åŒ–ã«å¯¾ã—ã¦ã¯ã€ã¾ãŸåˆ¥ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã‚ã‚‹ã¨æ€ã†ã®ã§ã€ãã‚Œã‚‰ã‚‚åˆã‚ã›ã¦å¯¾å¿œå–ã‚‹ã¨è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\n","permalink":"https://jedipunkz.github.io/post/esp/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ \u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ğŸš€ ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæ™®æ®µä»•äº‹ã§ AWS ECS ã‚’ä½¿ã£ã¦ã„ã¦ Autoscallng Group ã«ã‚ˆã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ®ãˆã‚±ãƒ¼ãƒ«ã•ã›ã¦é‹ç”¨ã—ã¦ã„ã¾ã™ãŒã€é‹ç”¨ã—ã¦ã„ã‚‹ä¸­ã§ã‚ˆã‚Šé«˜é€Ÿã«ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«å‡ºæ¥ãªã„ã‚‚ã®ã ã‚ã†ã‹ï¼Ÿã¨æ€ã†ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½•å›ã‹ç™ºç”Ÿã—ã€å¯¾å¿œæ–¹æ³•ã«ã¤ã„ã¦æ¨¡ç´¢ã—ã¦ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ch2 id=\"å®Ÿéš›ã«ç™ºç”Ÿã—ãŸã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³\"\u003eå®Ÿéš›ã«ç™ºç”Ÿã—ãŸã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã¯ã‚³ãƒ³ãƒ†ãƒŠæ¯ã® CPU ä½¿ç”¨ç‡ã§ã™ã€‚1åˆ†æœªæº€ã®é–“ã«æ€¥æ¿€ã«ã‚¢ã‚¯ã‚»ã‚¹ãŒå¢—ãˆã‚³ãƒ³ãƒ†ãƒŠã® CPU ä½¿ç”¨ç‡ãŒ 100% ã«é”ã— (å®Ÿéš›ã«ã¯ vCPU ã«åŸºã¥ã„ã¦ 200% ã¨ãªã£ã¦ã„ã‚‹)ã€ECS Service ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã« Fail ã—ã¦ã€ã‚³ãƒ³ãƒ†ãƒŠãŒè½ã¡ã€æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã¯èµ·å‹•ã™ã‚‹ã‚‚ã®ã®ã€ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ã«è€ãˆã‚‰ã‚Œãšã€ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢ã¨èµ·å‹•ã‚’ç¹°ã‚Šè¿”ã™ã¨ã„ã£ãŸçŠ¶æ³ã§ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"CPU Usage\" loading=\"lazy\" src=\"../../pix/esp_cpu_usage.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"autoscaling-policy-cloudwatch-metrics-alarm-ã®èª¿æ•´\"\u003eAutoscaling Policy, Cloudwatch Metrics Alarm ã®èª¿æ•´\u003c/h2\u003e\n\u003cp\u003eã¾ãšæœ€åˆã«è€ƒãˆãŸã®ãŒä¸‹è¨˜ã®å€¤ã®èª¿æ•´ã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eaws_app_autoscaling_policy ã® cooldown å€¤\u003c/li\u003e\n\u003cli\u003eaws_cloudwatch_metric_alarm ã® period å€¤\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå…·ä½“çš„ã«ã¯ \u003ccode\u003e60sec\u003c/code\u003e ã¨ãªã£ã¦ã„ãŸå€¤ã‚’ \u003ccode\u003e10sec\u003c/code\u003e ãªã©ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã£ã¦ 60sec ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã§ã—ãã„å€¤è¨ˆç®—ã—ã¦ã‚¹ã‚±ãƒ¼ãƒ«ã•ã›ã¦ã„ãŸã¨ã“ã‚ã‚’ 10sec ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ç¸®ã‚ã¤ã¤ã‚¹ã‚±ãƒ¼ãƒ«ã•ã›ã‚‹ã€‚ã¤ã¾ã‚Šã‚ˆã‚Šè¿…é€Ÿã«ã‚¹ã‚±ãƒ¼ãƒ«ã•ã›ã‚‹ã“ã¨ã§ä¸Šè¨˜ã®ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã«è€ãˆã‚‰ã‚Œã‚‹ã®ã§ã¯ã¨è€ƒãˆã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eã§ã™ãŒã€çµæœã¯ NG ã§ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹è¨˜ã¯ Cloudwatch Metrics ã®æ§˜å­ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ãƒ—ãƒ­ãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ã€\u003ccode\u003eãƒ‡ãƒ¼ã‚¿ä¸è¶³\u003c/code\u003e ã¨ã„ã†çŠ¶æ…‹ã«é™¥ã£ã¦ã„ã‚‹äº‹ãŒã‚ã‹ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Cloudwatch Metrics\" loading=\"lazy\" src=\"../../pix/esp_cloudwatch_metrics.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå®Ÿéš›ã« ECS ã¯ã“ã®è¨­å®šã‚’ã—ãŸ Metrics Alarm ã§ã¯ã‚¹ã‚±ãƒ¼ãƒ«ã—ã¦ãã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\u003c/p\u003e\n\u003ch2 id=\"é«˜è§£åƒåº¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®åˆ©ç”¨ã«ã¤ã„ã¦\"\u003eé«˜è§£åƒåº¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®åˆ©ç”¨ã«ã¤ã„ã¦\u003c/h2\u003e\n\u003cp\u003eã§ã‚ã‚Œã°\u003ca href=\"https://aws.amazon.com/jp/blogs/news/new-high-resolution-custom-metrics-and-alarms-for-amazon-cloudwatch/\"\u003eé«˜è§£åƒåº¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹\u003c/a\u003e ã‚’åˆ©ç”¨ã™ã‚Œã°è‰¯ã„ã®ã§ã¯ã¨è€ƒãˆã¾ã—ãŸã€‚\u003c/p\u003e","title":"è‡ªå‰ãƒ„ãƒ¼ãƒ«ã¨ Cloudwatch é«˜è§£åƒåº¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ä½¿ã£ãŸã‚ˆã‚Šé«˜é€Ÿãª ECS ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«ã®å®Ÿç¾"},{"content":"ã“ã‚“ã«ã¡ã¯ @jedipunkz ğŸš€ ã§ã™ã€‚\nECS æ§‹æˆã‚’ã‚‚ã†å°‘ã—ã‚»ã‚­ãƒ¥ã‚¢ã«ä¿ã¦ã‚‹æ§‹æˆã¯ãªã„ã‚‚ã®ã ã‚ã†ã‹ã¨æ¨¡ç´¢ã—ã¦ã„ã‚‹ãªã‹ã§ Sysdig ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚ã¾ã å°å…¥ã§ãã‚‹ç›®å‡¦ã¯ç«‹ã£ã¦ã„ãªã„ã®ã§ã™ãŒã‚ã‚‹ç¨‹åº¦ãƒã‚¦ãƒã‚¦è“„ç©å‡ºæ¥ã¦ããŸã®ã§ã“ã“ã§æ¤œè¨¼å†…å®¹ç­‰ã‚’è¨˜äº‹ã«ã—ã‚ˆã†ã‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚\nSysdig ã¯å¹¾ã¤ã‹ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒå­˜åœ¨ã™ã‚‹ã®ã§ã™ãŒä»Šå›æ¤œè¨¼ã—ãŸã®ã¯ Sysdig Serverless Security ã¨å‘¼ã°ã‚Œã‚‹ãƒ¢ãƒã§ ECS Fargate ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å®Ÿè·µã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚\nSysdig ã¨ã¯ AWS ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚‚è„…å¨æ¤œçŸ¥ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãŒæƒã£ã¦ã„ã‚‹ã®ã¯ã”å­˜çŸ¥ã¨æ€ã„ã¾ã™\nå¯¾è±¡ ç›®çš„ æŠ€è¡“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ AWS ãƒªã‚½ãƒ¼ã‚¹ é©šç•°æ¤œçŸ¥ AWS GuardDuty ã¾ãŸäºˆé˜²ã®è¦³ç‚¹ã§è„†å¼±æ€§è¨ºæ–­ãŒå‡ºæ¥ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚‚ã‚ã‚Šã‚ã™\nå¯¾è±¡ ç›®çš„ æŠ€è¡“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ AWS ãƒªã‚½ãƒ¼ã‚¹ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨ºæ–­ AWS Trusted Advisor ECS ã‚³ãƒ³ãƒ†ãƒŠ è„†å¼±æ€§è¨ºæ–­ ECR Image Scan EC2 ä¸Šã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ è„†å¼±æ€§è¨ºæ–­ AWS Inspector ã“ã“ã§æ°—ãŒã¤ãã¨æ€ã†ã®ã§ã™ãŒã‚³ãƒ³ãƒ†ãƒŠä¸Šã®é©šç•°æ¤œçŸ¥ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹ãŒ AWS ã«ã¯ç„¡ã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ (2022/09 æ™‚ç‚¹)\nSysdig Serverless Security ã¯ ECS Fargate ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨æ¤œçŸ¥ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ECS Fargate åˆ©ç”¨æ™‚ã«ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨æ¤œçŸ¥ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹ã¯ä»–ã«ã‚‚å¹¾ã¤ã‹ã‚ã‚Šã¾ã™ãŒã€Sysdig ã¯ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãŸã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å®Ÿè·µã—ã¦è„…å¨æ¤œçŸ¥ãƒ»é€šçŸ¥ãŒè¡Œãˆã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚è‡ªåˆ†ã‚‚è©³ã—ããªã„ã®ã§ã™ãŒã“ã‚Œã‚’ CWPP (Cloud Workload Protection Platform) ã¨è¨€ã†ã‚‰ã—ã„ã§ã™ã€‚ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã¨ã„ã†ã®ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã®ä»®æƒ³ãƒã‚·ãƒ³ãƒ»ç¨¼åƒä¸­ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’æŒ‡ã—ã¦ã€CWPP ã¯ãƒãƒ«ã‚¦ã‚§ã‚¢ä¿è­·ã€è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã€ç•°å¸¸æ¤œçŸ¥ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ãã‚Œãã‚Œã®ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚’ä¿è­·ã™ã‚‹ã€ã¨ã„ã†ã“ã¨ã‚‰ã—ã„ã§ã™ã€‚\nSysdig ä»¥å¤–ã® CWPP ã¯ã©ã†ã„ã†ã‚‚ã®ãŒã‚ã‚‹ã®ã‹? Sysdig ä»¥å¤–ã§ã™ã¨ä»£è¡¨ã™ã‚‹ã‚‚ã®ãŒä¸‹è¨˜ã«ãªã‚‹ãã†ã§ã™ã€‚\nDatadog Aqua CWWP Palo Alto Prisma Sysdig ã‚’ã‚‚ã†å°‘ã—å…·ä½“çš„ã«èª¬æ˜ Sysdig ã¯ CNCF ã® Falco ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦è„…å¨æ¤œå‡ºã‚’è¡Œã†ãŸã‚ã® SaaS ã‚’å«ã‚ãŸã‚·ã‚¹ãƒ†ãƒ ã¨ãªã‚Šã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨ã¨å…±ã«ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç´ä»˜ã‘ã‚‹ã“ã¨ã§ã‚¯ãƒ©ã‚¦ãƒ‰è‡ªä½“ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚ãŸã¨ãˆã°å•é¡Œã®ã‚ã‚‹ S3 ãƒã‚±ãƒƒãƒˆå…¬é–‹è¨­å®šã‚„ã€IAM ã®æ¨©é™ã«é–¢ã™ã‚‹ã‚‚ã®ãªã©ã€‚ä»Šå›è‡ªåˆ†ã¯å‰è€…ã®ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨æ¤œçŸ¥ã«ã¤ã„ã¦èª¿ã¹ã¾ã—ãŸã®ã§ã€ã“ã®è¨˜äº‹ã§ã‚‚ãã‚Œã«ã¤ã„ã¦è¨˜ãã†ã¨æ€ã„ã¾ã™ã€‚\nãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ ãƒ™ãƒ¼ã‚¹ã¨ãªã£ã¦ã„ã‚‹ Falco ã§ã¯ Linux ã‚«ãƒ¼ãƒãƒ«ã® ptrace ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’ç”¨ã„ã¦è„…å¨æ¤œçŸ¥ (ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ãã‚„ãƒ‡ã‚£ã‚¹ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¢ºç«‹ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‡ãƒ¼ã‚¿é€å—ä¿¡ãªã©ã«ã¤ã„ã¦) ã—ã¾ã™ã€‚ã§ã™ãŒ ptrace ã¯ã‚³ãƒ³ãƒ†ãƒŠã®æœ¬æ¥ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«çµæ§‹ãªå½±éŸ¿ãŒã‚ã‚‹ãã†ã§ã™ã€‚ãã‚Œã«æ¯”è¼ƒã—ã¦ Sysdig ã¯ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å®Ÿè£…ã—ã¦ã„ãªã„ã‚³ãƒ³ãƒ†ãƒŠã¨ã»ã¼åŒç­‰ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå‡ºã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚\nå‚è€ƒè³‡æ–™: Sysdig Blog\nSysdig + ECS Fargate ã®æ§‹æˆ ã“ã“ã‹ã‚‰å…·ä½“çš„ã«æ¤œè¨¼ã—ãŸå†…å®¹ã‚’è¨˜ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\nè‡ªåˆ†ã¯ ECS Fargate ã‚’ç”¨ã„ãŸ Sysdig åˆ©ç”¨ã‚’å‰æã«ã—ã¦æ§‹æˆã‚’çµ„ã¿ã¾ã—ãŸã€‚\næ§‹æˆã®ç‰¹å¾´ã¨ã—ã¦ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚\n2ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆ Sysdig ã‚µãƒ¼ãƒãƒ¬ã‚¹ãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ Sysdig ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒ»ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ 2ã¤ã¨ã‚‚ ECS Fargate ä¸Šã«èµ·å‹• ã‚¿ã‚¹ã‚¯å®šç¾©æ¯ã«ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒèµ·å‹•ã—ãƒ—ãƒ­ã‚­ã‚·çš„ã«å‹•ä½œã™ã‚‹ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨é€šä¿¡ ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã—ã¦ Sysdig ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¸è»¢é€ã™ã‚‹å½¹å‰² ä¸‹è¨˜ãŒæ§‹æˆå›³ã«ãªã‚Šã¾ã™ã€‚\nå‚è€ƒ: https://docs.sysdig.com/en/docs/installation/serverless-agents/aws-fargate-serverless-agents/ æ§‹ç¯‰ Sysdig Region æƒ…å ± ä¸‹è¨˜ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã‚‹é€šã‚Š Sysdig ã«ã¯åˆ©ç”¨è€…ãŒæ„è­˜ã™ã¹ã Region ã¨ã„ã†æ¦‚å¿µãŒã‚ã‚Šã¾ã™ã€‚ã©ã® Region ã‚’ç”¨ã„ã‚‹ã‹æ±ºå®šã—ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæƒ…å ±ã‚’æ§‹ç¯‰ã®äº‹å‰ã«åé›†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nå‚è€ƒ: https://docs.sysdig.com/en/docs/administration/saas-regions-and-ip-ranges Sysdig ã‚µãƒ¼ãƒãƒ¬ã‚¹ãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ§‹ç¯‰ ä¸‹è¨˜ã® Sysdig å…¬å¼ã® Terraform Module ã‚’ç”¨ã„ã‚‹äº‹ã§æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚\nå‚è€ƒ: https://github.com/sysdiglabs/terraform-aws-fargate-orchestrator-agent ä¸‹è¨˜ãŒæ¤œè¨¼ç›®çš„ã§ä½œæˆã—ãŸ Terraform ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚\nmodule \u0026#34;sysdig_orchestrator_agent\u0026#34; { source = \u0026#34;sysdiglabs/fargate-orchestrator-agent/aws\u0026#34; version = \u0026#34;0.2.0\u0026#34; name = \u0026#34;example-sysdigorchestrator\u0026#34; vpc_id = var.vpc_id subnets = [ aws_subnet.example1.id, aws_subnet.example2.id, ] access_key = var.my_sysdig_access_key collector_host = \u0026#34;ingest-us2.app.sysdig.com\u0026#34; # å®šã‚ãŸãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚³ãƒ¬ã‚¯ã‚¿ãƒ›ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ collector_port = \u0026#34;6443\u0026#34; agent_image = \u0026#34;quay.io/sysdig/orchestrator-agent:latest\u0026#34; assign_public_ip = false # Internet Gateway ã‚’ç”¨ã„ã‚‹å ´åˆã¯ true ã‚’æŒ‡å®š } Sysdig ã‚µãƒ¼ãƒãƒ¬ã‚¹ãƒ»ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç››ã‚Šè¾¼ã‚“ã ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®æ§‹ç¯‰ æ¤œè¨¼ã§ã¯ Sysdig å…¬å¼ã® Terraform Provider ã‚’ç”¨ã„ã¦ ECS ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãŸã€‚ä¸‹è¨˜ãŒãã®éš›ã®ã‚³ãƒ¼ãƒ‰ã¨ãªã‚Šã¾ã™ã€‚\ndata \u0026#34;sysdig_fargate_workload_agent\u0026#34; \u0026#34;sysdig\u0026#34; { container_definitions = file(\u0026#34;container_definitions/sysdigapp.json\u0026#34;) sysdig_access_key = var.my_sysdig_access_key workload_agent_image = \u0026#34;quay.io/sysdig/workload-agent:latest\u0026#34; orchestrator_host = module.sysdig_orchestrator_agent.orchestrator_host orchestrator_port = module.sysdig_orchestrator_agent.orchestrator_port } resource \u0026#34;aws_ecs_task_definition\u0026#34; \u0026#34;sysdig\u0026#34; { family = \u0026#34;example-sysdigapp-taskdef\u0026#34; cpu = \u0026#34;2048\u0026#34; memory = \u0026#34;8192\u0026#34; network_mode = \u0026#34;awsvpc\u0026#34; requires_compatibilities = [\u0026#34;FARGATE\u0026#34;] execution_role_arn = aws_iam_role.task_exec.arn task_role_arn = aws_iam_role.task.arn container_definitions = data.sysdig_fargate_workload_agent.sysdig.output_container_definitions } å°šã€Sysdig Provider ã‚’ç”¨ã„ã¦ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦ã„ã¾ã™ãŒã€æ‰‹å‹•ã§ã‚‚ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’è¨˜ã™ã“ã¨ãŒå¯èƒ½ã ãã†ã§ã™ã€‚ãã®éš›ã«ã¯ä¸‹è¨˜ã®å‡¦ç†ã‚’ã‚¿ã‚¹ã‚¯å®šç¾©ã«æ–½ã™ã“ã¨ã§è¦ä»¶ã‚’æº€ãŸã›ã‚‹ãã†ã§ã™ã€‚\nSysdig ã«é–¢ã™ã‚‹ç’°å¢ƒå¤‰æ•° Volume ãƒã‚¦ãƒ³ãƒˆæŒ‡å®š capabilities æŒ‡å®š Sysdig ã‚³ãƒ³ãƒ†ãƒŠæŒ‡å®š æ§‹ç¯‰å¾Œã® Sysdig UI ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ æ§‹ç¯‰å¾Œã€(US-West ã‚’åˆ©ç”¨ã—ãŸå ´åˆã¯) ä¸‹è¨˜ã® URL ã§ Sysdig Secure UI ã«ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã¾ã™ã€‚\nhttps://us2.app.sysdig.com/secure/#/policies\nã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥ ãƒãƒªã‚·ãƒ¼ã®ç¨®åˆ¥ ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥ã®ãŸã‚ã®ãƒãƒªã‚·ãƒ¼ãŒç”¨æ„ã•ã‚Œã¦ã„ã¦å¹¾ã¤ã‹ã‚ã‚‹ã®ã§ã™ãŒ ECS Fargate ã¨ã„ã†æ¡ä»¶ã§ã‚ã‚Œã°ä¸‹è¨˜ã®2ã¤ã®åˆ©ç”¨ãŒå¯èƒ½ã ãã†ã§ã™ã€‚\nWorkload Policy (Powered By Falco) List Maching Policy ä¸‹è¨˜ã¯ Kubernetes å‰æã ãã†ã§ã™ã€‚\nContainer Drift Policy Machine Learning Policy ä¸‹è¨˜ã¯ã‚³ãƒ³ãƒ†ãƒŠã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã¯åˆ¥æ  Policy ã§å‰è¿°ã—ãŸã‚¯ãƒ©ã‚¦ãƒ‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ Sysdig ã«ç´ä»˜ã‘ãŸéš›ã«åˆ©ç”¨ã§ãã‚‹ãƒãƒªã‚·ãƒ¼ã§ã™ã€‚\nKubernetes Audit Policy AWS CloudTrail Policy GCP Audit Log Policy Azure Platform Log Policy List Maching Policy ã«ãŠã‘ã‚‹ ç‰¹å®šãƒãƒ¼ãƒˆã®ãƒªã‚¹ãƒ³æ¤œçŸ¥ ä¸‹è¨˜ã® Rule ã‚’ä½œæˆã—ã¦ Policy ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã§ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥å‡ºæ¥ã¾ã™ã€‚ ã¾ãŸ Policy ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦ kill, stop, pause, nothing(notify only) ãŒé¸ã¹ã¾ã™ã€‚è„…å¨ã‚’æ¤œçŸ¥ã—ãŸéš›ã«ãƒ—ãƒ­ã‚»ã‚¹ã®åœæ­¢ãªã©ãŒè¡Œãˆã‚‹ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚\nè¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å å€¤ allInbounds Deny allOutbounds Deny udpListenPortsMatchItems true tcpListenPortsMatchItems true udpListenPorts 8080 tcpListenPorts 8080 ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿æ¤œçŸ¥ ä¸‹è¨˜ã® Rule ã‚’ä½œæˆã—ã¦ Policy ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã§ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥å‡ºæ¥ã¾ã™ã€‚ ã¾ãŸåŒæ§˜ã« Policy ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦ kill, stop, pause, nothing(notify only) ãŒé¸ã¹ã¾ã™ã€‚\nè¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å å€¤ readPathsMatchItems true readPaths \u0026lt;ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹\u0026gt; readWritePathsMatchItems false Workload Policy ç‰¹å®šãƒ—ãƒ­ã‚»ã‚¹ã®èµ·å‹• ä¸‹è¨˜ã® Rule ã‚’ä½œæˆã—ã¦ Policy ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã§ç‰¹å®šã®ãƒ—ãƒ­ã‚»ã‚¹ãŒç‰¹å®šã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”¨ã„ã¦èµ·å‹•ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’æ¤œçŸ¥å‡ºæ¥ã¾ã™ã€‚\nè¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å å€¤ condition user.name = \u0026ldquo;nginx\u0026rdquo; and proc.name = \u0026ldquo;nginx\u0026rdquo; output ä»»æ„ã®æƒ…å ±ã‚’å‡ºåŠ› å‹•ä½œç¢ºèªã—ãŸéš›ã® system call ã®æƒ…å ±ã¯ä¸‹è¨˜ã«ãªã‚‹ã®ã§ã“ã‚Œã‚‰ã‚’ condition ã«è¨˜ã›ã°æ¤œçŸ¥ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚\n(user.name=nginx user.loginuid=-1 proc.cmdline=nginx container.id=1e2a2f03e1934a719d98c45276ea57eb-265927825 container_name=web evt.type=accept evt.res= proc.pid=76 proc.cwd=/ proc.ppid=39 proc.pcmdline=nginx -g daemon off; proc.sid=15 proc.exepath=/usr/sbin/nginx user.uid=101 user.loginname= group.gid=101 group.name=nginx container.name=web image=nginx:latest)\nãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹çš„ãª Policy è¨­å®š ä¸Šè¨˜ã®ã‚ˆã†ã«å€‹åˆ¥ã« Policy, Rule ã‚’å®šç¾©ã—ã¦ã‚‚ã€æ¼ã‚ŒãŒç™ºç”Ÿãƒ»æƒ³å®šå¤–ãŒç™ºç”Ÿã™ã‚‹ã®ã§ã€Sysdig ãŒ Managed Rules, Policies ã‚’ç”¨æ„ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚å°‘ãªãã¨ã‚‚ä¸‹è¨˜ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã“ã¨ã§å¤§æŠµã®è„…å¨æ¤œçŸ¥ã¯å¯èƒ½ã ãã†ã§ã™ã€‚\nSysdig Runtime Threat Detection (Workload Policy)\nThis policy contains rules which Sysdig considers High Confidence of a security incident. They are tightly coupled to common attacker TTP\u0026rsquo;s. They have been designed to minimize false positives but may still result in some depending on your environment.\nSysdig Runtime Threat Intelligence (Workload Policy)\nThis policy contains rules using Indicators of Compromise curated by the Sysdig Threat Intelligence Team from premium, OSINT, and custom threat intelligence feeds. Any events from the rules in this policy should be considered serious and investigated as soon as possible.\nSysdig Runtime Notable Events (Workload Policy)\nThis Notable Events policy contains rules which may indicate undesired behavior including security threats. The rules are more generalized than Threat Detection policies and may result in more noise. Tuning will likely be required for the events generated from this policy.\nã‚³ã‚¹ãƒˆ AWS Marketplae ã« Sysdig Secure DevOps Platform ãŒã‚ã‚Šã€Pricing ãŒè¨˜è¼‰ã‚ã‚Šã¾ã—ãŸã€‚\nãƒ—ãƒ©ãƒ³å 1ãƒ¶æœˆã‚³ã‚¹ãƒˆ 1å¹´é–“ã‚³ã‚¹ãƒˆ èª¬æ˜ Secure Cloud Security $500 $5,000 CloudTrail é€£æºãªã© Secure Enterprise CaaS $12/task $120/task Container Runtime Security ã¾ã¨ã‚ Terraform Sysdig Provider ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€è‡ªåˆ†ãŸã¡ã®ç’°å¢ƒã«å–ã£ä»˜ãæ˜“ã„æ§‹ç¯‰æ–¹æ³•ã‚’å–ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ Module ã‚’ä½¿ãˆã°ç°¡å˜ã«æ§‹ç¯‰å¯èƒ½ã€‚å¤–éƒ¨ã¨é€šä¿¡ã•ã›ã‚‹ã®ã§ã™ãŒ VPC å†…éƒ¨ã«ç½®ãã“ã¨ã‚‚å¯èƒ½ã€‚ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚ Terraform ã§å®¹æ˜“ã«æ§‹ç¯‰å¯èƒ½ã€‚ã‚¿ã‚¹ã‚¯å®šç¾©ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ Terraform ä»¥å¤–ã®æŠ€è¡“ã‚’ä½¿ã£ã¦è¡Œã£ã¦ã„ã‚‹å ´åˆã§ã‚‚4ã¤ã»ã©ã®è¦ä»¶ã‚’äºˆã‚æº€ãŸã—ã¦ãŠã‘ã°æ¯”è¼ƒçš„ç°¡å˜ã« Sysdig ã‚’é©ç”¨ã—ãŸã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•å¯èƒ½ã§ã™ã€‚ä»Šå›ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯æ¸¬å®šå‡ºæ¥ã¦ã„ã¾ã›ã‚“ãŒã€å…¬å¼ãƒ–ãƒ­ã‚°ã®æƒ…å ±ã‚’ä¿¡ã˜ã‚‹ã¨ ptrace ã«æ¯”ã¹ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ã¯æ°—ã«ã™ã‚‹å¿…è¦ãªããªã‚Šãã†ã§ã™ã€‚ã“ã“ã¯æœ‰å„Ÿç‰ˆã ãªã¨ã„ã†å°è±¡ã€‚\nã¾ãŸã€æ§‹ç¯‰ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ (ä¾‹ã§ Nginx) ã®ä¸­ã‚’é™¤ã„ã¦ã¿ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚»ã‚¹ãŒç¨¼åƒã—ã¦ã„ã¾ã—ãŸã€‚\n# ps auxf (ä¸€åˆ†æƒ…å ±ã‚’æŠœç²‹) /dev/init -- /opt/draios/bin/instrument /docker-entrypoint.sh nginx -g daemon off; /opt/draios/bin/instrument /docker-entrypoint.sh nginx -g daemon off; \\_ /opt/draios/bin/agentino --name=ip-10-0-65-79.ap-northeast-1.compute.internal --aws-account-id=395127550274 --aws-region=ap-north east-1 --aws-az=ap-northeast-1a --aws-fargate-cluster-arn=arn \\_ /opt/draios/bin/pdig -C -t -1 -l /opt/draios/bin/libudigembed.so /docker-entrypoint.sh nginx -g daemon off; \\_ nginx: master process nginx -g daemon off; \\_ nginx: worker process \\_ nginx: worker process \u0026lt;snip\u0026gt; ã‚³ãƒ³ãƒ†ãƒŠãƒ—ãƒ­ã‚»ã‚¹ãŒ /opt/draios/bin/instrument ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã«æ¸¡ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚æ›´ã«ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã§èµ·å‹•ã—ã¦ã„ã‚‹ Instrument ã‚³ãƒ³ãƒ†ãƒŠã®ãƒœãƒªãƒ¥ãƒ¼ãƒ é ˜åŸŸã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠãŒãƒã‚¦ãƒ³ãƒˆã—ã¦ã„ã‚‹ã®ãŒåˆ¤ã‚Šã¾ã—ãŸã€‚\nã¾ãŸã€æ³¨æ„ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚ECS Exec ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥ã®å‹•ä½œç¢ºèªã¨ã—ã¦ã®æ“ä½œã‚’è¡Œã£ã¦ã‚‚æ¤œçŸ¥ã—ã¦ãã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚Policy ã‚’ç‹¬è‡ªã«ä½œæˆã—ãŸéš›ã«ä¸ä¾¿ãªã®ã§ã™ãŒã€å‹•ä½œç¢ºèªã®ãŸã‚ã«ã¯ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§ sshd ã‚’èµ·å‹•ã™ã‚‹ã‹ã€ã‚¿ã‚¹ã‚¯å®šç¾©ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆæŒ‡å®šã‚’æ›¸ãæ›ãˆã¦è¡Œã†å¿…è¦ãŒã‚ã‚‹ãã†ã§ã™ã€‚ãŸã ã€Sysdig ç¤¾ã§ã‚‚ ECS Exec ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸéš›ã®æ“ä½œã«é–¢ã—ã¦ã‚‚æ¤œçŸ¥ç¯„å›²ã«ã™ã‚‹ãŸã‚ã®é–‹ç™ºã‚’äºˆå®šã—ã¦ã„ã‚‹ãã†ã§ã™ã€‚ECS Exec ã¯ IAM ã®æ¨©é™ãŒã‚ã‚Œã°ãƒ­ã‚°ã‚¤ãƒ³å‡ºæ¥ã¦ã—ã¾ã†ã‚‚ã®ã§ã€æ¯”è¼ƒçš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«ã¯æ°—ã‚’ä½¿ã†æ©Ÿèƒ½ã ã¨æ€ã£ã¦ã„ã‚‹ã®ã§ Sysdig ã§ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®æ“ä½œã‚’æ¤œçŸ¥å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã¯åŠ©ã‹ã‚Šã¾ã™ã—ã€æœŸå¾…ã—ãŸã„ã¨ã“ã‚ã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/sysdig-ecs-fargate/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ \u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ğŸš€ ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eECS æ§‹æˆã‚’ã‚‚ã†å°‘ã—ã‚»ã‚­ãƒ¥ã‚¢ã«ä¿ã¦ã‚‹æ§‹æˆã¯ãªã„ã‚‚ã®ã ã‚ã†ã‹ã¨æ¨¡ç´¢ã—ã¦ã„ã‚‹ãªã‹ã§ Sysdig ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚ã¾ã å°å…¥ã§ãã‚‹ç›®å‡¦ã¯ç«‹ã£ã¦ã„ãªã„ã®ã§ã™ãŒã‚ã‚‹ç¨‹åº¦ãƒã‚¦ãƒã‚¦è“„ç©å‡ºæ¥ã¦ããŸã®ã§ã“ã“ã§æ¤œè¨¼å†…å®¹ç­‰ã‚’è¨˜äº‹ã«ã—ã‚ˆã†ã‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eSysdig ã¯å¹¾ã¤ã‹ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒå­˜åœ¨ã™ã‚‹ã®ã§ã™ãŒä»Šå›æ¤œè¨¼ã—ãŸã®ã¯ Sysdig Serverless Security ã¨å‘¼ã°ã‚Œã‚‹ãƒ¢ãƒã§ ECS Fargate ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å®Ÿè·µã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"sysdig-ã¨ã¯\"\u003eSysdig ã¨ã¯\u003c/h2\u003e\n\u003cp\u003eAWS ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚‚è„…å¨æ¤œçŸ¥ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãŒæƒã£ã¦ã„ã‚‹ã®ã¯ã”å­˜çŸ¥ã¨æ€ã„ã¾ã™\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eå¯¾è±¡\u003c/th\u003e\n          \u003cth\u003eç›®çš„\u003c/th\u003e\n          \u003cth\u003eæŠ€è¡“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAWS ãƒªã‚½ãƒ¼ã‚¹\u003c/td\u003e\n          \u003ctd\u003eé©šç•°æ¤œçŸ¥\u003c/td\u003e\n          \u003ctd\u003eAWS GuardDuty\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eã¾ãŸäºˆé˜²ã®è¦³ç‚¹ã§è„†å¼±æ€§è¨ºæ–­ãŒå‡ºæ¥ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚‚ã‚ã‚Šã‚ã™\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eå¯¾è±¡\u003c/th\u003e\n          \u003cth\u003eç›®çš„\u003c/th\u003e\n          \u003cth\u003eæŠ€è¡“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAWS ãƒªã‚½ãƒ¼ã‚¹\u003c/td\u003e\n          \u003ctd\u003eã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨ºæ–­\u003c/td\u003e\n          \u003ctd\u003eAWS Trusted Advisor\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eECS ã‚³ãƒ³ãƒ†ãƒŠ\u003c/td\u003e\n          \u003ctd\u003eè„†å¼±æ€§è¨ºæ–­\u003c/td\u003e\n          \u003ctd\u003eECR Image Scan\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eEC2 ä¸Šã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢\u003c/td\u003e\n          \u003ctd\u003eè„†å¼±æ€§è¨ºæ–­\u003c/td\u003e\n          \u003ctd\u003eAWS Inspector\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eã“ã“ã§æ°—ãŒã¤ãã¨æ€ã†ã®ã§ã™ãŒã‚³ãƒ³ãƒ†ãƒŠä¸Šã®é©šç•°æ¤œçŸ¥ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹ãŒ AWS ã«ã¯ç„¡ã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ (2022/09 æ™‚ç‚¹)\u003c/p\u003e\n\u003cp\u003eSysdig Serverless Security ã¯ ECS Fargate ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨æ¤œçŸ¥ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ECS Fargate åˆ©ç”¨æ™‚ã«ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®è„…å¨æ¤œçŸ¥ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹ã¯ä»–ã«ã‚‚å¹¾ã¤ã‹ã‚ã‚Šã¾ã™ãŒã€Sysdig ã¯ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãŸã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å®Ÿè·µã—ã¦è„…å¨æ¤œçŸ¥ãƒ»é€šçŸ¥ãŒè¡Œãˆã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚è‡ªåˆ†ã‚‚è©³ã—ããªã„ã®ã§ã™ãŒã“ã‚Œã‚’ CWPP (Cloud Workload Protection Platform) ã¨è¨€ã†ã‚‰ã—ã„ã§ã™ã€‚ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã¨ã„ã†ã®ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã®ä»®æƒ³ãƒã‚·ãƒ³ãƒ»ç¨¼åƒä¸­ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’æŒ‡ã—ã¦ã€CWPP ã¯ãƒãƒ«ã‚¦ã‚§ã‚¢ä¿è­·ã€è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã€ç•°å¸¸æ¤œçŸ¥ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ãã‚Œãã‚Œã®ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚’ä¿è­·ã™ã‚‹ã€ã¨ã„ã†ã“ã¨ã‚‰ã—ã„ã§ã™ã€‚\u003c/p\u003e","title":"Sysdig+ECS Fargate ã§ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè·µ"},{"content":"ã“ã‚“ã«ã¡ã¯ @jedipunkz ğŸš€ ã§ã™ã€‚\nä»Šå›ã¯ CNCF ã«ã‚¸ãƒ§ã‚¤ãƒ³ã—ãŸ PipeCD ã¨ Datadog ã‚’ç”¨ã„ã¦ ECS ç’°å¢ƒã«ã¦ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¿æŸ»ã—ãŸã®ã§ã€ãã®å†…å®¹ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nãã‚‚ãã‚‚ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼ã¨ã¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒªãƒãƒªãƒ¼æ–¹æ³•ã¯ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ã‚„ãƒ–ãƒ«ãƒ¼ã‚°ãƒªãƒ¼ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç­‰ãŒã‚ˆãçŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼ã¯ãã®ä¸€æ­©å…ˆã‚’è¡Œããƒ‡ãƒªãƒãƒªãƒ¼æ–¹å¼ã§ã€Prometheus ã‚„ Datadog ç­‰ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç”¨ã„ã¦ SLO (SRE ã® SLO ã¨è¨€ã†ã‚ˆã‚Šã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãŸã‚ã®æŒ‡æ¨™ã¨ã„ã†æ„å‘³ã§ã®) ã‚’å…ƒã«ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæœŸå¾…ã—ãŸå‹•ä½œã‚’ã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã— (ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼çš„ã«ã¯ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã‚’ ANALYSIS ã¨ã„ã†æ§˜ã§ã™)ã€ãã®ä¸Šã§ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ã‚’å®Œäº†ã™ã‚‹ã¨ã„ã†ãƒ•ãƒ­ãƒ¼ã«ãªã‚Šã¾ã™ã€‚\næ§‹æˆ Pipecd, Piped å…±ã« Kubernetes (EKS) ã‚¯ãƒ©ã‚¹ã‚¿ä¸Šã«èµ·å‹•ã™ã‚‹æ§‹æˆ ã“ã®æ¤œè¨¼ã§ã¯ã“ã¡ã‚‰ã®æ§‹æˆã‚’é¸æŠã—ã¾ã—ãŸã€‚ã“ã®æ§‹æˆã®ç‰¹å¾´ã¯\npiped ã¯ pipecd ã® API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æŒ‡ã—ç¤ºã™ pipecd ã¯ UI ã‚’æä¾› pipecd ã¯ Filestore (S3, GCS, Minio ãªã©), Datastore (MySQL, Firestore ãªã©) ã‚’åˆ©ç”¨å¯ (ä»Šå›ã¯ Minio, MySQL ã‚’é¸æŠ) piped ã¯ Target Group, ECS ã‚¿ã‚¹ã‚¯å®šç¾©ç­‰ã®æ“ä½œã‚’è¡Œã†ãŸã‚ ECS API ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒå¿…è¦ piped ã® pipeline ä¸Šã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§ ANALYSIS ã¨ã„ã† Datadog ç­‰ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’è§£æã™ã‚‹æ©Ÿèƒ½ã‚’æœ‰ã—ã¦ã„ã‚‹ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒã‚¸ãƒˆãƒªã«ã¯ app.pipecd.yaml ã‚’é…ç½®ã—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ãƒ»ã‚¿ã‚¹ã‚¯å®šç¾©ãƒ»ECS ã‚µãƒ¼ãƒ“ã‚¹ã‚’æŒ‡ã—ç¤ºã™ piped ã¯ GitHub ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’å‚ç…§ ã¨ãªã£ã¦ã„ã¾ã™ã€‚\nã¾ãŸã“ã¡ã‚‰ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ ã«ã¯ piped ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ ECS/Fargate ã«èµ·å‹•ã™ã‚‹æ§‹æˆã‚‚ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€ãã®éš›ã«\npiped -\u0026gt; pipecd ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒåŒä¸€ namespace å†…ã§å®Œçµã—ãªã„ã®ã§ Ingress ãŒå¿…è¦ ã¨ã„ã†åˆ¶ç´„ãŒå‡ºã¦ãã¾ã™ã€‚ã¾ãŸ piped ã¯ã‚·ãƒ³ã‚°ãƒ«ãƒã‚¤ãƒŠãƒªã§ã©ã“ã§ç¨¼åƒã—ã¦ã„ã¦ã‚‚åŒã˜ãªã®ã§ã€ä»Šå›ã¯ä¸‹è¨˜ã®æ§‹æˆã‚’é¸æŠã—ã¾ã—ãŸã€‚\næ¤œè¨¼ç’°å¢ƒã®æ§‹ç¯‰æ‰‹é † å‰æã®ç’°å¢ƒ å‰æã¨ã—ã¦ä¸‹è¨˜ã‚’äº‹å‰ã«æ§‹ç¯‰ãƒ»æº–å‚™ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»Šå›ã¯æƒ…å ±é‡ãŒå¤šããªã£ã¦ã—ã¾ã†ã®ã§ã“ã“ã®æ‰‹é †ã¯å‰²æ„›ã—ã¾ã™ã€‚\nãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã« helm ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« EKS ã‚¯ãƒ©ã‚¹ã‚¿ã‚’æ§‹ç¯‰ pipecd ã¨ã„ã†åå‰ã® namespace ã‚’ã‚¢ã‚µã‚¤ãƒ³ã—ã¦ã„ã‚‹ Fargate Profile ã‚’ç”¨æ„ blue, green ã¨ã„ã† ALB ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ãƒ»ãƒªã‚¹ãƒŠãƒ¼ã‚’ç”¨æ„ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒã‚¸ãƒˆãƒªã®ç”¨æ„ ä¸‹è¨˜ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã§ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚å®Ÿéš›ã«ã¯ IAM, Subnet, Security Group ç­‰ã€æ§‹ç¯‰ã—ãŸç’°å¢ƒã«åˆã‚ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n. â”œâ”€â”€ app.pipecd.yaml â”œâ”€â”€ servicedef.yaml â””â”€â”€ taskdef.yaml ã‚¿ã‚¹ã‚¯å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ« taskdef.yaml ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚\nfamily: pipecd-nginx-sample executionRoleArn: arn:aws:iam::********:role/ecs-taskexecution-iamrole containerDefinitions: - command: null cpu: 100 image: public.ecr.aws/nginx/nginx:1.23-alpine memory: 100 mountPoints: [] name: web portMappings: - containerPort: 80 compatibilities: - FARGATE requiresCompatibilities: - FARGATE networkMode: awsvpc memory: 512 cpu: 256 pidMode: \u0026#34;\u0026#34; volumes: [] ECS ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ« servicedef.yaml ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚\ncluster: arn:aws:ecs:ap-northeast-1:********:cluster/ecs-cluster serviceName: pipecd-nginx-sample desiredCount: 2 deploymentConfiguration: maximumPercent: 200 minimumHealthyPercent: 0 schedulingStrategy: REPLICA deploymentController: type: EXTERNAL enableECSManagedTags: true propagateTags: SERVICE launchType: FARGATE networkConfiguration: awsvpcConfiguration: assignPublicIp: ENABLED securityGroups: - sg-******** subnets: - subnet-******** - subnet-******** Piped ãŒå‚ç…§ã™ã‚‹ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ« ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦èª¬æ˜ã™ã‚‹ã¨\nkind: ECSApp ã¨ã—ã¦ pipecd.dev/vbeta1 API ã«ã‚¢ã‚¯ã‚»ã‚¹ ECS ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ã‚¿ã‚¹ã‚¯å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®æŒ‡å®šã‚’è¡Œã† primary, cannary ã¨ã—ã¦å…ˆç¨‹ä½œæˆã—ãŸ blue, green ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã‚’æŒ‡å®šã™ã‚‹ pipeline è¨­å®šã§å„ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’æŒ‡å®šã™ã‚‹ ECS_CANARY_ROLLOUT ã§ green ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã® ECS ã‚¿ã‚¹ã‚¯ã‚’ãƒ­ãƒ¼ãƒªãƒ³ã‚°ãƒ‡ãƒ—ãƒ­ã‚¤ ECS_TRAFFIC_ROUTING ã§ green ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾ã—ã¦ 20% ã®ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã‚’å¯„ã›ã‚‹ ANALYSIS ã§ Datadog Metrics ã«ã‚¯ã‚¨ãƒªã‚’æŠ•ã’ã€é–¾å€¤è¶…éã®éš›ã¯ FAIL ã™ã‚‹ã‚ˆã†ã«è¨­å®š ä¸‹è¨˜ã®ä¾‹ã§ã¯å…¨ä½“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã«å¯¾ã—ã¦ã® 5xx ç³»ã‚¨ãƒ©ãƒ¼ã®ç‡ãŒ 10% ã‚’è¶…ãˆãªã„äº‹ã‚’æœŸå¾…ã—ã¦ã„ã¾ã™ ECS_PRIMARY_ROLLOUT ã§ blue ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã® ECS ã‚¿ã‚¹ã‚¯ã®ãƒ­ãƒ¼ãƒªãƒ³ã‚°ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿæ–½ ECS_TRAFFIC_ROUTING ã§ blue ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾ã—ã¦ 100% ã®ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã‚’å¯„ã›ã‚‹ ECS_CANARY_CLEAN ã§ green ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã® ECS ã‚¿ã‚¹ã‚¯ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— â€» ã“ã“ã§ã¯ THRESHOLD (é–¾å€¤è¶…é) ã® strategy ã‚’é¸æŠã—ã¦ã„ã¾ã™ãŒã€ãã®ä»–ã®ã‚‚ã®ã«ã¤ã„ã¦ã¯è€ƒå¯Ÿã§è¿°ã¹ã¾ã™ã€‚\napp.pipecd.yaml ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚\napiVersion: pipecd.dev/v1beta1 kind: ECSApp spec: name: canary labels: env: example team: xyz input: serviceDefinitionFile: servicedef.yaml taskDefinitionFile: taskdef.yaml targetGroups: primary: targetGroupArn: arn:aws:elasticloadbalancing:ap-northeast-1:********:targetgroup/blue/******** containerName: web containerPort: 80 canary: targetGroupArn: arn:aws:elasticloadbalancing:ap-northeast-1:********:targetgroup/green/******** containerName: web containerPort: 80 pipeline: stages: - name: ECS_CANARY_ROLLOUT with: scale: 30 - name: ECS_TRAFFIC_ROUTING with: canary: 20 - name: ANALYSIS with: duration: 10m metrics: - strategy: THRESHOLD provider: datadog-provider interval: 1m expected: max: 10 query: | sum:aws.applicationelb.httpcode_elb_5xx{env:prd,hostname:sample-lb-********.ap-northeast-1.elb.amazonaws.com}.as_count() / sum:aws.applicationelb.request_count{env:prd,hostname:sample-lb-********.ap-northeast-1.elb.amazonaws.com}.as_count() - name: ECS_PRIMARY_ROLLOUT - name: ECS_TRAFFIC_ROUTING with: primary: 100 - name: ECS_CANARY_CLEAN Pipecd æ§‹ç¯‰ Pipecd ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ Pipecd (Control Plane) ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ control-plane-values.yaml ã‚’ä¸‹è¨˜ã®é€šã‚Šç”¨æ„ã—ã¾ã™ã€‚ é‹ç”¨ã‚’æƒ³å®šã™ã‚‹ã¨ quickstart.enabled: false ã¨ã—ã¦ S3 ã‚„ RDS ç­‰ã‚’ç”¨ã„ã‚‹æ§‹æˆãŒæœ›ã¾ã—ã„ã¨æ€ã„ã¾ã™ãŒã€ä»Šå›ã®ç›®çš„ã§ã¯ãªã„ã®ã§ã“ã“ã§ã¯ quickstart.enabled: true ã¨ã—ã¦ Pipecd ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚\nquickstart: enabled: true config: data: | apiVersion: \u0026#34;pipecd.dev/v1beta1\u0026#34; kind: ControlPlane spec: datastore: type: MYSQL config: url: root:test@tcp(pipecd-mysql:3306) database: quickstart filestore: type: MINIO config: endpoint: http://pipecd-minio:9000 bucket: quickstart accessKeyFile: /etc/pipecd-secret/minio-access-key secretKeyFile: /etc/pipecd-secret/minio-secret-key autoCreateBucket: true projects: - id: quickstart staticAdmin: username: hello-pipecd passwordHash: \u0026#34;$2a$10$ye96mUqUqTnjUqgwQJbJzel/LJibRhUnmzyypACkvrTSnQpVFZ7qK\u0026#34; # bcrypt value of \u0026#34;hello-pipecd\u0026#34; secret: encryptionKey: data: encryption-key-just-used-for-quickstart minioAccessKey: data: quickstart-access-key minioSecretKey: data: quickstart-secret-key mysql: rootPassword: \u0026#34;test\u0026#34; database: \u0026#34;quickstart\u0026#34; Pipecd ã®ãƒ‡ãƒ—ãƒ­ã‚¤ ä¸‹è¨˜ã®ã‚ˆã†ã« helm ã‚’ä½¿ã£ã¦ EKS ä¸Šã« Pipecd ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\nhelm install pipecd oci://ghcr.io/pipe-cd/chart/pipecd --version v0.34.0 \\ --namespace pipecd --create-namespace \\ --values ./control-plane-values.yaml Piped æ§‹ç¯‰ Pipecd UI ã«ãƒ­ã‚°ã‚¤ãƒ³ã— piped ã® id, key ã‚’å–å¾— kubernetes service ã«ä½œæ¥­ç«¯æœ«ã‹ã‚‰ port forwarding ã—ã¾ã™ã€‚\nkubectl -n pipecd port-forward svc/pipecd 8080 ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:8080 ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚\nproject name: quickstart username: hello-pipecd password: hello-pipecd ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ -\u0026gt; ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ -\u0026gt; Settings ã«é·ç§»ã—ã¦ Piped ã‚¿ãƒ–ã‚’é¸æŠã— +ADD ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã€‚é©å½“ãªåå‰ãƒ»èª¬æ˜ã‚’å…¥åŠ›ã— Piped ID, Key ã‚’ç”Ÿæˆã—ãŸã‚‰ãƒ¡ãƒ¢ã™ã‚‹\nPiped ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ piped-key-file ã«ä¸Šè¨˜ã§å¾—ãŸ Piped Key ã‚’è¨˜ã—ã¾ã™ã€‚\necho \u0026#39;\u0026lt;PIPED_KEY\u0026gt;\u0026#39; \u0026gt; piped-key-file ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªæƒ…å ±ã‚’è¨˜ã—ã¾ã™ã€‚\nä¸Šè¨˜ã§å¾—ãŸæƒ…å ±ç­‰ã‚’è¨˜ã—ã¾ã™ã€‚\nPipeCD UI ã§å¾—ãŸ Piped ID PipeCD UI ã§å¾—ãŸ Piped Key ãƒ•ã‚¡ã‚¤ãƒ«ã®æŒ‡å®š ä¸Šè¨˜ã®æ‰‹é †ã§ä½œæˆã—ãŸ Git ãƒ¬ãƒã‚¸ãƒˆãƒªæŒ‡å®š ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ Git ãƒ¬ãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã® SSH éµ AWS ãƒªãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ± AWS æ©Ÿå¯†æƒ…å ±ã®ãƒ•ã‚¡ã‚¤ãƒ«æŒ‡å®š (å¾Œã«ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æŒ‡å®š) AWS æ©Ÿå¯†æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å Datadog API, APP Key æŒ‡å®š apiVersion: pipecd.dev/v1beta1 kind: Piped spec: projectID: quickstart pipedID: \u0026lt;ä¸Šè¨˜ã§å¾—ãŸ PipedID ã‚’è¨˜ã™\u0026gt; pipedKeyFile: /etc/piped-secret/piped-key apiAddress: pipecd:8080 git: sshKeyFile: /etc/piped-secret/ssh-key repositories: - repoId: \u0026lt;Git ãƒ¬ãƒã‚¸ãƒˆãƒªå\u0026gt; remote: git@github.com:jedipunkz/\u0026lt;ãƒ¬ãƒã‚¸ãƒˆãƒªå\u0026gt;.git branch: main syncInterval: 1m cloudProviders: - name: sample-ecs type: ECS config: region: ap-northeast-1 credentialsFile: /etc/piped-secret/credentials-key profile: \u0026lt;AWS Profile å\u0026gt; analysisProviders: - name: rf-sandbox-datadog type: DATADOG config: apiKeyFile: /etc/piped-secret/datadog-api-key applicationKeyFile: /etc/piped-secret/datadog-application-key Piped ã®èµ·å‹• äº‹å‰ã« Datadog API, APP Key ã®å†…å®¹ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚\necho \u0026#39;\u0026lt;Datadog API Key\u0026gt;\u0026#39; \u0026gt; datadog-api-key echo \u0026#39;\u0026lt;Datadog APP Key\u0026gt;\u0026#39; \u0026gt; datadog-application-key ä¸‹è¨˜ã®æƒ…å ±ã‚’åŠ ãˆã¦ Piped ã‚’èµ·å‹•ã™ã‚‹ã€‚\nä¸Šè¨˜ã§ä½œæˆã—ãŸã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«å piped-config-k8s-canary.yaml ä¸Šã§ä½œæˆã—ãŸ Piped Key ã®å†…å®¹ã‚’ã—ã‚‹ã—ãŸ piped-key-file ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ Git ãƒ¬ãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã® SSH ç§˜å¯†éµ AWS æ©Ÿå¯†æƒ…å ±ã‚’è¨˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ« ~/.aws/credentials Datadog API, APP Key ã®å†…å®¹ã‚’è¨˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«æŒ‡å®š helm upgrade -i piped oci://ghcr.io/pipe-cd/chart/piped --version=v0.34.0 --namespace=pipecd \\ --set-file config.data=./piped-config-k8s-canary.yaml \\ --set-file secret.data.piped-key=./piped-key-file \\ --set-file secret.data.ssh-key=/Users/foo/.ssh/pipecd \\ --set-file secret.data.credentials-key=/Users/foo/.aws/credentials \\ --set args.insecure=true \\ --set-file secret.data.datadog-api-key=./pipecd/datadog-api-key \\ --set-file secret.data.datadog-application-key=./datadog-application-key äº‹å‰ã®ã‚¿ã‚¹ã‚¯å®šç¾©ã®ãƒ¬ã‚¸ã‚¹ãƒˆ äº‹å‰ã«åˆ©ç”¨ã™ã‚‹ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’ãƒ¬ã‚¸ã‚¹ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ ä¸‹è¨˜ã®å†…å®¹ã§ taskdef-nginx.json ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚\n{ \u0026#34;family\u0026#34;: \u0026#34;pipecd-nginx-sample\u0026#34;, \u0026#34;executionRoleArn\u0026#34;: \u0026#34;arn:aws:iam::********:role/ecs-taskexecution-iamrole\u0026#34;, \u0026#34;containerDefinitions\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;web\u0026#34;, \u0026#34;essential\u0026#34;: true, \u0026#34;image\u0026#34;: \u0026#34;public.ecr.aws/nginx/nginx:1.23-alpine\u0026#34;, \u0026#34;mountPoints\u0026#34;: [], \u0026#34;portMappings\u0026#34;: [ { \u0026#34;containerPort\u0026#34;: 80, \u0026#34;hostPort\u0026#34;: 80, \u0026#34;protocol\u0026#34;: \u0026#34;tcp\u0026#34; } ] } ], \u0026#34;requiresCompatibilities\u0026#34;: [ \u0026#34;FARGATE\u0026#34; ], \u0026#34;networkMode\u0026#34;: \u0026#34;awsvpc\u0026#34;, \u0026#34;memory\u0026#34;: \u0026#34;512\u0026#34;, \u0026#34;cpu\u0026#34;: \u0026#34;256\u0026#34; } ä¸‹è¨˜ã®ã‚ˆã†ã« awscli ã‚’ç”¨ã„ã¦ãƒ¬ã‚¸ã‚¹ãƒˆã—ã¾ã™ã€‚\naws ecs register-task-definition --cli-input-json file://taskdef-nginx.json aws ecs list-task-definitions | grep nginx #\u0026lt;-- ç¢ºèª å‹•ä½œç¢ºèª PipeCD UI ã® Application ã®ç”»é¢ã«ãŠã„ã¦ä¸‹è¨˜ã®å†…å®¹ã§ PipeCD UI ä¸Šã® Application ã‚’ +ADD ã—ã¾ã™ã€‚\nName ã«ä»»æ„ã®åå‰ã‚’å…¥åŠ› kind ã§ ECS ã‚’é¸æŠ Piped ã§ä¸Šè¨˜ã®æ‰‹é †ã§ç™»éŒ²ã—ãŸ Piped ã‚’é¸æŠ Cloud Provider ã§ sample-ecs ã‚’é¸æŠ Repository ã§ Git ãƒ¬ãƒã‚¸ãƒˆãƒªåã‚’é¸æŠ Config Filename ã§ app.pipecd.yaml ã‚’é¸æŠ Sync ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹ã€‚çµæœ Deployment ç”»é¢ã‚’ç¢ºèªã™ã‚‹ã¨ä¸‹è¨˜ã®çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹ã€‚\nãƒ‡ãƒ—ãƒ­ã‚¤ãŒé€²ã¿ã€Primary (ä¸Šè¨˜ã® green) ã¸ã® ROLLOUT (ãƒ‡ãƒ—ãƒ­ã‚¤) ãŒå®Œäº†ã™ã‚‹\nTarget Group green ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã‚¿ã‚¹ã‚¯ãŒä¸€ã¤èµ·å‹•ã—å§‹ã‚ã‚‹\nã¾ãŸåŒã˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ ALB ãƒªã‚¹ãƒŠãƒ¼ã‚’ç¢ºèªã™ã‚‹ã¨ 20% ã®ãƒˆãƒ©ãƒ’ãƒƒã‚¯ãŒ green ã«å¯„ã›ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹\nãã®å¾Œ Deployment ãŒ SUCCESS ã§å®Œäº†ã™ã‚‹\nãã®çµæœ green ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒ draining ã«ãªã‚‹\nALB Listener ã‚‚ blue: 100% ã¨ Canary ãƒªãƒªãƒ¼ã‚¹ã® Primary ã® Target Group ã¸ãƒˆãƒ©ãƒ’ãƒƒã‚¯ãŒ 100% å¯„ã›ã‚‰ã‚Œã¦ã„ã‚‹äº‹ã‚’ç¢ºèªå‡ºæ¥ã‚‹ã€‚ã“ã‚Œã§ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã¨ãªã‚Šã¾ã™ã€‚\nFail ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‹•ä½œ å¸¸æ™‚ 0.3 ä»¥ä¸Šã®ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã‚’ç¤ºã—ã¦ã„ã‚‹ã‚¯ã‚¨ãƒª(å½“æ–¹ã®ç’°å¢ƒ)ã«å¯¾ã—ã¦ä¸‹è¨˜ã®ã‚ˆã†ã« expected.max: 0.01 ã¨æŒ‡å®šã—ã¦ã¿ã‚‹ã€‚\n- name: ANALYSIS with: duration: 30m metrics: - strategy: THRESHOLD provider: sample-datadog interval: 10m expected: max: 0.01 query: | query: | sum:aws.applicationelb.httpcode_elb_5xx{env:prd,hostname:sample-lb-********.ap-northeast-1.elb.amazonaws.com}.as_count() / sum:aws.applicationelb.request_count{env:prd,hostname:sample-lb-********.ap-northeast-1.elb.amazonaws.com}.as_count() çµæœã¨ã—ã¦ã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã® ANALYSIS ã‚¹ãƒ†ãƒ¼ã‚¸ã§æƒ³å®šã—ãŸé€šã‚Š Fail ã—ã€çµæœ ROLLBACK ã•ã‚ŒãŸã€‚\nè€ƒå¯Ÿ æ¤œè¨¼ç’°å¢ƒã§ã¯ Canary ãƒªãƒªãƒ¼ã‚¹ãƒ»Datadog Analysisãƒ»THRESHOLDS æˆ¦ç•¥ã‚’ç”¨ã„ã¦å‹•ä½œç¢ºèªã—ã€\n(1) ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹ (2) Canary ç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤ (3) éƒ¨åˆ†çš„ã«ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã‚’ Canary ã«å¯„ã›ã‚‹ (3) Datadog Metrics ã‚’è§£æã—ã¤ã¤å•é¡Œãªã‘ã‚Œã° Primary ç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤ (4) Primary ã«100%ã®ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã‚’å¯„ã›ã‚‹ (5) Canary ç’°å¢ƒã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— ã¨ã„ã†æµã‚Œã§ã€ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ã¨ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼ãŒå®Ÿè·µå‡ºæ¥ã¾ã—ãŸã€‚\nDatadog Analysis Provider åˆ©ç”¨æ™‚ã®æ³¨æ„ç‚¹ é€šå¸¸ã§ã‚ã‚Œã°ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€ALB ã®ã‚¨ãƒ©ãƒ¼ç‡ç­‰ã‚’è¨ˆæ¸¬ã—ãã‚Œã‚’ Analysis Provider ã§æŒ‡å®šã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ãã®å ´åˆ AWS Intergration ã®æ©Ÿèƒ½ã§ Cloudwatch Metrics -\u0026gt; Datadog Metrics ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹æƒ…å ±ã‚’é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€\né…å»¶ãŒæ•°åˆ†ã‚ã‚‹ ALB ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ãƒ—ãƒ­ãƒƒãƒˆã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ãŒ1åˆ†ã§ã‚ã‚‹ ã¨ã„ã†å•é¡ŒãŒæµ®ä¸Šã—ã¾ã™ã€‚\nã“ã®ã“ã¨ã¯ç§’å˜ä½ã§ exporter ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’ Scrape ã™ã‚‹ Prometheus ã§ã¯å•é¡Œã«ãªã‚Šã¾ã›ã‚“ã€‚å®Ÿéš› PipeCD ã¯ Prometheus ã‚’ä¸€ç•ªã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã—ã¦é–‹ç™ºã•ã‚Œã¦ã„ã¾ã™ã€‚(ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã® scrape_interval (default: 1s) ã«ç›¸å½“ã™ã‚‹) ã‚ˆã£ã¦ã€Datadog ã‚’ Analysis Provider ã«åˆ©ç”¨ã™ã‚‹éš›ã«ã¯ä¸‹è¨˜ã®å¹¾ã¤ã‹ã®æ–¹æ³•ã‚’æ¤œè¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nãã®ä»–ã® Analysis ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æˆ¦ç•¥ æ¤œè¨¼ã§ã¯ THRESHOLDS ã¨ã„ã†é–¾å€¤è¨­å®šå‹ã®æˆ¦ç•¥ã‚’å–ã‚Šã¾ã—ãŸãŒã€ä»–ã«ã‚‚å¹¾ã¤ã‹ã®æˆ¦ç•¥ãŒ PipeCD ã«ã¯å­˜åœ¨ã—ã¾ã™ã€‚ä¸‹è¨˜ãŒãã‚Œã‚‰ã§ã™ã€‚\n(1) PREVIOUS : ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’æœ€å¾Œã«æˆåŠŸã—ãŸãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¨æ¯”è¼ƒã™ã‚‹æ–¹æ³• ä¸‹è¨˜ã¯ä¾‹ã§å‰å› (æœ€å¾Œ) ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚¯ã‚¨ãƒªè¨ˆæ¸¬çµæœã¨æ¯”è¼ƒã—ã¦ã€å‰å›ã‚ˆã‚Šã‚‚åå·®ãŒé«˜ã„å ´åˆã€Fail ã™ã‚‹ã€ã¨ã„ã†ã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚\napiVersion: pipecd.dev/v1beta1 kind: KubernetesApp spec: pipeline: stages: - name: ANALYSIS with: duration: 30m metrics: - strategy: PREVIOUS provider: my-prometheus deviation: HIGH interval: 5m query: | sum (rate(http_requests_total{status=~\u0026#34;5.*\u0026#34;}[5m])) / sum (rate(http_requests_total[5m])) (2) CANARY_BASELINE : Canary ãƒãƒªã‚¢ãƒ³ãƒˆã¨ Baseline ãƒãƒªã‚¢ãƒ³ãƒˆã®é–“ã§ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’æ¯”è¼ƒã™ã‚‹æ–¹æ³• ä¸‹è¨˜ã¯ä¾‹ã§ Canary, Baseline ã¨ã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’æ¯”è¼ƒã—ã¤ã¤ã€æœ€çµ‚çš„ã« deviantion: HIGH ã¨ã„ã†æ¡ä»¶ã§ Fail ã—ã¾ã™ã€‚\napiVersion: pipecd.dev/v1beta1 kind: KubernetesApp spec: pipeline: stages: - name: ANALYSIS with: duration: 30m metrics: - strategy: CANARY_BASELINE provider: my-prometheus deviation: HIGH interval: 5m query: | sum (rate(http_requests_total{job=\u0026#34;foo-{{ .Variant.Name }}\u0026#34;, status=~\u0026#34;5.*\u0026#34;}[5m])) / sum (rate(http_requests_total{job=\u0026#34;foo-{{ .Variant.Name }}\u0026#34;}[5m])) (3) CANARY_PRIMARY (éæ¨å¥¨) : Canary ãƒãƒªã‚¢ãƒ³ãƒˆã¨Primary ãƒãƒªã‚¢ãƒ³ãƒˆã®é–“ã§ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’æ¯”è¼ƒã™ã‚‹æ–¹æ³• éæ¨å¥¨ã®æˆ¦ç•¥ã€‚ä½•ã‚‰ã‹ã®ç†ç”±ã§ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ãƒãƒªã‚¢ãƒ³ãƒˆã‚’æä¾›ã§ããªã„å ´åˆã¯ã€Canary ã¨ Primary ã‚’æ¯”è¼ƒã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚\næ‰€æ„Ÿ ä¸€å¿œ PipeCD ã¨ ECS, Datadog ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼ã‚’å®Ÿè·µå‡ºæ¥ã¾ã—ãŸã€‚é‹ç”¨ã‚’æƒ³å®šã™ã‚‹ã¨ RDS, S3 ç­‰ã‚’ç”¨ã„ã‚‹æ§‹æˆã‚’çµ„ã‚“ã ã»ã†ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã¦ã„ã‚‹ ECS ã¨ã¯åˆ‡ã‚Šé›¢ã—ã¦ EKS ä¸Šã® PipeCD, Piped ã‚’é‹ç”¨å‡ºæ¥ã‚‹ã®ã§ã€ä¸‡ãŒä¸€ä½•ã‹ã‚ã£ãŸéš›ã€ã¾ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ç­‰ã®ç§»è¡Œã‚’æƒ³å®šã—ãŸã¨ã—ã¦ã‚‚æ¯”è¼ƒçš„é‹ç”¨ã—ã‚„ã™ã„ã‚ˆã†ã«æ€ã„ã¾ã™ã€‚ã‚ã¨ã¯è€ƒå¯Ÿã®ã¨ã“ã‚ã«è¨˜ã—ãŸ Datadog ã‚’ç”¨ã„ã‚‹éš›ã«å‡ºã¦ãã‚‹é›£ã—ã•ã‚’ã©ã†ã‚¯ãƒªã‚¢ã™ã‚‹ã‹ã¯ã„ãã¤ã‹ã®æ¤œè¨ã‚’é‡ã­ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚ãã®ã‚ãŸã‚Šã®è©³ç´°ã«ã¤ã„ã¦ã¯è‡ªåˆ†ãŒåŠªã‚ã¦ã„ã‚‹ä¼æ¥­ã®ãƒ†ãƒƒã‚¯ãƒ–ãƒ­ã‚°ã®æ–¹ã«è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ï¼\n","permalink":"https://jedipunkz.github.io/post/ecs-pipecd/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ \u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ğŸš€ ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ CNCF ã«ã‚¸ãƒ§ã‚¤ãƒ³ã—ãŸ \u003ca href=\"https://pipecd.dev/\"\u003ePipeCD\u003c/a\u003e ã¨ Datadog ã‚’ç”¨ã„ã¦ ECS ç’°å¢ƒã«ã¦ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¿æŸ»ã—ãŸã®ã§ã€ãã®å†…å®¹ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ãã‚‚ãã‚‚ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼ã¨ã¯\"\u003eãã‚‚ãã‚‚ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼ã¨ã¯\u003c/h2\u003e\n\u003cp\u003eã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒªãƒãƒªãƒ¼æ–¹æ³•ã¯ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ã‚„ãƒ–ãƒ«ãƒ¼ã‚°ãƒªãƒ¼ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç­‰ãŒã‚ˆãçŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼ã¯ãã®ä¸€æ­©å…ˆã‚’è¡Œããƒ‡ãƒªãƒãƒªãƒ¼æ–¹å¼ã§ã€Prometheus ã‚„ Datadog ç­‰ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç”¨ã„ã¦ SLO (SRE ã® SLO ã¨è¨€ã†ã‚ˆã‚Šã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãŸã‚ã®æŒ‡æ¨™ã¨ã„ã†æ„å‘³ã§ã®) ã‚’å…ƒã«ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæœŸå¾…ã—ãŸå‹•ä½œã‚’ã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã— (ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼çš„ã«ã¯ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã‚’ ANALYSIS ã¨ã„ã†æ§˜ã§ã™)ã€ãã®ä¸Šã§ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ã‚’å®Œäº†ã™ã‚‹ã¨ã„ã†ãƒ•ãƒ­ãƒ¼ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆ-pipecd-piped-å…±ã«-kubernetes-eks-ã‚¯ãƒ©ã‚¹ã‚¿ä¸Šã«èµ·å‹•ã™ã‚‹æ§‹æˆ\"\u003eæ§‹æˆ Pipecd, Piped å…±ã« Kubernetes (EKS) ã‚¯ãƒ©ã‚¹ã‚¿ä¸Šã«èµ·å‹•ã™ã‚‹æ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eã“ã®æ¤œè¨¼ã§ã¯ã“ã¡ã‚‰ã®æ§‹æˆã‚’é¸æŠã—ã¾ã—ãŸã€‚ã“ã®æ§‹æˆã®ç‰¹å¾´ã¯\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003epiped ã¯ pipecd ã® API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æŒ‡ã—ç¤ºã™\u003c/li\u003e\n\u003cli\u003epipecd ã¯ UI ã‚’æä¾›\u003c/li\u003e\n\u003cli\u003epipecd ã¯ Filestore (S3, GCS, Minio ãªã©), Datastore (MySQL, Firestore ãªã©) ã‚’åˆ©ç”¨å¯ (ä»Šå›ã¯ Minio, MySQL ã‚’é¸æŠ)\u003c/li\u003e\n\u003cli\u003epiped ã¯ Target Group, ECS ã‚¿ã‚¹ã‚¯å®šç¾©ç­‰ã®æ“ä½œã‚’è¡Œã†ãŸã‚ ECS API ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒå¿…è¦\u003c/li\u003e\n\u003cli\u003epiped ã® pipeline ä¸Šã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§ ANALYSIS ã¨ã„ã† Datadog ç­‰ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’è§£æã™ã‚‹æ©Ÿèƒ½ã‚’æœ‰ã—ã¦ã„ã‚‹\u003c/li\u003e\n\u003cli\u003eã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒã‚¸ãƒˆãƒªã«ã¯ app.pipecd.yaml ã‚’é…ç½®ã—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ãƒ»ã‚¿ã‚¹ã‚¯å®šç¾©ãƒ»ECS ã‚µãƒ¼ãƒ“ã‚¹ã‚’æŒ‡ã—ç¤ºã™\u003c/li\u003e\n\u003cli\u003epiped ã¯ GitHub ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’å‚ç…§\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã¨ãªã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e","title":"ECS + PipeCD + Datadog ã§ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼ã‚’å®Ÿç¾"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚jedipunkzğŸš€ ã§ã™ã€‚\nå¼•ãç¶šã Go ã‚’å­¦ç¿’ã—ã¦ã„ã¾ã™ã€‚å‰å›ã®è¨˜äº‹ ECS ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ CLI ã‚’ Go è¨€èªã§ä½œã£ãŸè©± ã®ã¾ã¨ã‚ã«ã‚‚è¨˜ã—ãŸã®ã§ã™ãŒ Go ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã‚¢ã‚¤ãƒ‡ã‚¢ã¨ã—ã¦ä¸‹è¨˜ã‚’ã¼ã‚“ã‚„ã‚Šè€ƒãˆã¦ã„ã¾ã—ãŸã€‚\nECR è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’é–‹ç™º ãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã—ã¦ Datadog ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ã—ã¦é€ä¿¡ åŒæ§˜ã«ãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã—ã¦ ECR ã‚¹ã‚­ãƒ£ãƒ³ã® CLI ã‚’ä½œæˆ ãã®ç´¹ä»‹ã‚’è»½ãã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\né–‹ç™ºã—ãŸ ECR è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã® Go ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ é–‹ç™ºã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ https://github.com/jedipunkz/ecrscan ã«ãªã‚Šã¾ã™ã€‚\nä¸‹è¨˜ã®ã‚ˆã†ã« Ecr æ§‹é€ ä½“ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚\ne := myecr.Ecr{} e.Repositories = [][]string{ {\u0026#34;image-to-scan\u0026#34;, \u0026#34;latest\u0026#34;}, } e.Resion = \u0026#34;ap-northeast-1\u0026#34; finding, vulFindings, _ := e.ListFindings() ãã®å¾Œ ListFindings() ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚çµæœã€finding.FindingSeverityCounts ã«ã¯ä¸‹è¨˜ã®æ·±åˆ»åº¦æ¯ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å«ã¾ã‚Œã¦ã„ã‚‹è„†å¼±æ€§ã®æ•°ãŒå…¥ã‚Šã¾ã™ã€‚\nINFORMATIONAL LOW MEDIUM HIGH CRITICAL UNDEFINED ã¾ãŸã€vulFindings ã«ã¯å«ã¾ã‚Œã¦ã„ã‚‹è„†å¼±æ€§ã®\nCVE å æ·±åˆ»åº¦ãƒ¬ãƒ™ãƒ« (INFORMATIONAL, LOW, MEDIUM, HIGH, CRITICAL, UNDEFINED) CVE URI èª¬æ˜ ãŒå…¥ã‚Šã¾ã™ã€‚\nCLI ã®é–‹ç™º ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã—ã¦é–‹ç™ºã—ãŸã®ãŒ https://github.com/jedipunkz/evs ã¨ã„ã† CLI ã§ã™ã€‚åˆ©ç”¨æ–¹æ³•ã¯ä¸‹è¨˜ã®ã‚ˆã†ã« --image ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã‚¿ã‚°ã‚’æŒ‡å®šã€--region ã§ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã™ã€‚\nçµæœã€ä¸‹è¨˜ã®ã‚ˆã†ã«å«ã¾ã‚Œã¦ã„ã‚‹è„†å¼±æ€§ã®æ·±åˆ»åº¦ãƒ¬ãƒ™ãƒ«æ¯ã®ã‚«ã‚¦ãƒ³ãƒˆæ•°ãŒä¸€è¦§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\n$ evs scan --image image-to-scan:latest --region ap-northeast-1 +----------------+--------+ | SEVERITY LEVEL | COUNTS | +----------------+--------+ | MEDIUM | 2 | | LOW | 12 | | INFORMATIONAL | 4 | +----------------+--------+ ã¾ãŸ list ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€ä¸‹è¨˜ã®ã‚ˆã†ã« CVE åã‚„æ·±åˆ»åº¦ã€URIã€èª¬æ˜ã®ä¸€è¦§ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚\n$ evs list --image testimage:latest --region ap-northeast-1 +------------------+---------------+----------------------------------------------------------------+---------------------------------+ | CVE NAME | SEVERITY | URI | DESCRIPTION | +------------------+---------------+----------------------------------------------------------------+---------------------------------+ | CVE-2021-20305 | MEDIUM | http://people.ubuntu.com/~ubuntu-security/cve/CVE-2021-20305 | A flaw was found in Nettle | | | | | in versions before 3.7.2, | | | | | where several Nettle signature | | | | | verification functions | | | | | (GOST DSA, EDDSA \u0026amp; ECDSA) | \u0026lt;snip\u0026gt; | CVE-2020-14155 | INFORMATIONAL | http://people.ubuntu.com/~ubuntu-security/cve/CVE-2020-14155 | libpcre in PCRE before 8.44 | | | | | allows an integer overflow | | | | | via a large number after a (?C | | | | | substring. | | CVE-2017-11164 | INFORMATIONAL | http://people.ubuntu.com/~ubuntu-security/cve/CVE-2017-11164 | In PCRE 8.41, the OP_KETRMAX | | | | | feature in the match function | | | | | in pcre_exec.c allows stack | | | | | exhaustion (uncontrolled | | | | | recursion) when processing a | | | | | crafted regular expression. | +------------------+---------------+----------------------------------------------------------------+---------------------------------+ å˜ç´”ãª CLI ãªã®ã§ã‚‚ã†ã²ã¨å·¥å¤«æ¬²ã—ã„ã¨ã“ã‚ã§ã™ãŒã€ä»Šã®ã¨ã“ã‚ã‚¢ã‚¤ãƒ‡ã‚¢ãŒç„¡ã„ã§ã™\u0026hellip;ã€‚\nECR ã‚¹ã‚­ãƒ£ãƒ³çµæœã‚’ Datadog ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«ã‚µãƒ–ãƒŸãƒƒãƒˆ åŒæ§˜ã«ç´¹ä»‹ã—ãŸ Go ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã—ã¦è¤‡æ•°ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³çµæœã‚’ Datadog ã«é€ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ã„ã¾ã—ãŸã€‚æ—¥ã€…ã€é–‹ç™ºè€…ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ CI/CD ã®ä¸­ã§ãƒ“ãƒ«ãƒ‰ã—ã¦ã„ã‚‹ã®ã§ã™ãŒãã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ„è­˜ã‚’æŒã¤ã¨ã„ã†ç‚¹ã«ãŠã„ã¦èª²é¡ŒãŒã‚ã‚‹ã¨æ„Ÿã˜ã¦ã„ãŸã‹ã‚‰ã§ã™ã€‚å…ƒã€…ã€Slack ã«é€±æ¬¡ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å«ã¾ã‚Œã¦ã„ã‚‹è„†å¼±æ€§ã®ä¸€è¦§ã‚’å‡ºåŠ›ã—ã¦ã„ãŸã®ã§ã™ãŒã€ãŸã æµã‚Œã¦ã„ã‚‹ã ã‘ã§é–‹ç™ºè€…ãŒãã‚Œã‚‰ã«ã¤ã„ã¦æ·±å €ã‚Šã—ã¦è¿½ã†ä½œæ¥­ã‚’ã™ã‚‹å‚¾å‘ã¯ã»ã¨ã‚“ã©ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã“ã®èª²é¡Œã«å¯¾ã—ã¦ã€è„†å¼±æ€§ã®ã‚«ã‚¦ãƒ³ãƒˆæ•°ã®æ¨ç§»ãŒ Datadog ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨ã—ã¦å¯è¦–åŒ–ã•ã‚Œã‚Œã°ä½•ã‹ã—ã‚‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’èµ·ã“ã—ã¦ä¸‹ã•ã‚‹ã®ã§ã¯ï¼Ÿã¨ã„ã†ä»®èª¬ã®å…ƒã«é–‹ç™ºã—ã¦ã¿ãŸæ¬¡ç¬¬ã§ã™ã€‚(çµæœã¯ã“ã‚Œã‹ã‚‰åˆ†ã‹ã‚‹ã¨æ€ã„ã¾ã™ \u0026hellip;)\nã“ã¡ã‚‰ã¯æ¥­å‹™ã§é–‹ç™ºã—ãŸã‚‚ã®ãªã®ã§ã‚³ãƒ¼ãƒ‰ã‚’ãŠè¦‹ã›ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã›ã‚“ãŒã€AWS Lambda é–¢æ•°ã‚’ç”¨ã„ã¦1æ™‚é–“ã«ä¸€åº¦ã€è¤‡æ•°ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã‚’å…ˆç¨‹ã® Go ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§è¡Œã„ã€Datadog ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«ã‚µãƒ–ãƒŸãƒƒãƒˆã™ã‚‹äº‹ã§ã€Datadog ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ãƒ—ãƒ­ãƒƒãƒˆã—ã¦ã„ã¾ã™ã€‚\nâ€» ã‚¤ãƒ¡ãƒ¼ã‚¸åã¯ãƒã‚¹ã‚¯ã—ã¦ã„ã¾ã™ã€‚\nè¦‹ã¦ã®é€šã‚Šã€é•·ã„ã‚¹ãƒ‘ãƒ³ã§è¦‹ãªã„ã¨å¤‰åŒ–ãŒè¦‹ã‚‰ã‚Œã¾ã›ã‚“ğŸ˜·ã€‚ ã“ã® Lambda ã§ç”¨ã„ãŸ Datadog API ã¯ä¸‹è¨˜ã«å…¬å¼ã®æƒ…å ±ãŒã‚ã‚Šã¾ã™ã€‚ https://docs.datadoghq.com/ja/api/latest/metrics/\nã¾ã¨ã‚ CLI ã®æ–¹ã¯å‰è¿°ã—ãŸã¨ãŠã‚Šã€è¿½åŠ ã§ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’é–‹ç™ºã—ãŸã„ã¨ã“ã‚ã§ã™ãŒã€ä½•ã‹ã„ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚ã‚‹ã‹ãªã\u0026hellip;ã€‚æ€ã„æµ®ã‹ã°ãªã„ã€‚ã¾ãŸã€Datadog ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®æ–¹ã¯èª°ã‹è¦‹ã¦ãã‚Œã¦ã„ã‚‹ã‹ãª\u0026hellip;ã€‚ä¸å®‰ã€‚\nä»•äº‹ã§ã¯ä»Šã€GitHub ã® Dependabot Alerts, Security Updates, ersion Updates ç­‰å°å…¥ã—ãŸã‚Šã€GitHub CodeQL æ¤œè¨¼ã—ãŸã‚Šã€ãã®ä»–ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’æ¤œè¨¼ã—ãŸã‚Šã¨ã€è‰²ã€…é ‘å¼µã£ã¦ã„ã¾ã™ã€‚ã¾ãŸé‹ç”¨ã‚‚å›ã£ã¦ãã¦ã€è‰¯ãã€‚\nã¾ãŸ Go ã®æ–¹ã‚‚å¼•ãç¶šãã‚¢ã‚¤ãƒ‡ã‚¢ãŒä¹ã—ã„ãªãŒã‚‰ã‚‚ä½•ã‹ã—ã‚‰ç©æ¥µçš„ã«é–‹ç™ºã—ã¦ã„ããŸã„ã¨ã“ã‚ã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/ecr-scan-datadog-go/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003ejedipunkzğŸš€\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå¼•ãç¶šã Go ã‚’å­¦ç¿’ã—ã¦ã„ã¾ã™ã€‚å‰å›ã®è¨˜äº‹ \u003ca href=\"http://localhost:1313/post/ecs-login-cli/\"\u003eECS ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ CLI ã‚’ Go è¨€èªã§ä½œã£ãŸè©±\u003c/a\u003e ã®ã¾ã¨ã‚ã«ã‚‚è¨˜ã—ãŸã®ã§ã™ãŒ Go ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã‚¢ã‚¤ãƒ‡ã‚¢ã¨ã—ã¦ä¸‹è¨˜ã‚’ã¼ã‚“ã‚„ã‚Šè€ƒãˆã¦ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eECR è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’é–‹ç™º\n\u003cul\u003e\n\u003cli\u003eãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã—ã¦ Datadog ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ã—ã¦é€ä¿¡\u003c/li\u003e\n\u003cli\u003eåŒæ§˜ã«ãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã—ã¦ ECR ã‚¹ã‚­ãƒ£ãƒ³ã® CLI ã‚’ä½œæˆ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eãã®ç´¹ä»‹ã‚’è»½ãã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch3 id=\"é–‹ç™ºã—ãŸ-ecr-è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã®-go-ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸\"\u003eé–‹ç™ºã—ãŸ ECR è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã® Go ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸\u003c/h3\u003e\n\u003cp\u003eé–‹ç™ºã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ \u003ca href=\"https://github.com/jedipunkz/ecrscan\"\u003ehttps://github.com/jedipunkz/ecrscan\u003c/a\u003e ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹è¨˜ã®ã‚ˆã†ã« Ecr æ§‹é€ ä½“ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emyecr\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eEcr\u003c/span\u003e{}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eRepositories\u003c/span\u003e = [][]\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t{\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;image-to-scan\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;latest\u0026#34;\u003c/span\u003e},\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eResion\u003c/span\u003e = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ap-northeast-1\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003efinding\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003evulFindings\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003e_\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eListFindings\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eãã®å¾Œ \u003ccode\u003eListFindings()\u003c/code\u003e ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚çµæœã€\u003ccode\u003efinding.FindingSeverityCounts\u003c/code\u003e ã«ã¯ä¸‹è¨˜ã®æ·±åˆ»åº¦æ¯ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å«ã¾ã‚Œã¦ã„ã‚‹è„†å¼±æ€§ã®æ•°ãŒå…¥ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eINFORMATIONAL\u003c/li\u003e\n\u003cli\u003eLOW\u003c/li\u003e\n\u003cli\u003eMEDIUM\u003c/li\u003e\n\u003cli\u003eHIGH\u003c/li\u003e\n\u003cli\u003eCRITICAL\u003c/li\u003e\n\u003cli\u003eUNDEFINED\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã¾ãŸã€\u003ccode\u003evulFindings\u003c/code\u003e ã«ã¯å«ã¾ã‚Œã¦ã„ã‚‹è„†å¼±æ€§ã®\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCVE å\u003c/li\u003e\n\u003cli\u003eæ·±åˆ»åº¦ãƒ¬ãƒ™ãƒ« (INFORMATIONAL, LOW, MEDIUM, HIGH, CRITICAL, UNDEFINED)\u003c/li\u003e\n\u003cli\u003eCVE URI\u003c/li\u003e\n\u003cli\u003eèª¬æ˜\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eãŒå…¥ã‚Šã¾ã™ã€‚\u003c/p\u003e","title":"ECR è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³çµæœè¡¨ç¤º CLI ã®é–‹ç™ºã¨ Datadog ãƒ—ãƒ­ãƒƒãƒˆ"},{"content":"ã“ã‚“ã«ã¡ã¯ @jedipunkz ğŸš€ ã§ã™ã€‚\nä»Šå›ã¯ Go è¨€èªã§ ECS ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ CLI ã‚’ä½œã£ãŸè©±ã‚’æ›¸ãã¾ã™ã€‚\né–‹ç™ºã®çµŒç·¯ è‡ªåˆ†ã¯ã¾ã  Go è¨€èªã®åˆå­¦è€…ã§å­¦ç¿’ã®ãŸã‚ã«é–‹ç™ºã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æ¢ã—ã¦ã„ãŸçŠ¶æ…‹ã§ã—ãŸã€‚ãã“ã§è‡ªåˆ†ã®å‹¤ã‚ã¦ã„ã‚‹ä¼šç¤¾ã§ ECS Execute æ©Ÿèƒ½ã‚’ä½¿ã£ãŸã‚³ãƒ³ãƒ†ãƒŠãƒ­ã‚°ã‚¤ãƒ³ã®æ©Ÿèƒ½ã‚’é–‹ç™ºè€…ã«æä¾›ã—ã¦ã„ãŸäº‹ã‚’æ€ã„å‡ºã—è‰²ã€…èª¿ã¹ã¦ã„ã¦ã€Œã‚‚ã†å°‘ã—æ‰‹é–“ãŒçœã‘ãªã„ã‹ï¼Ÿã€ã¨æ€ã„ç«‹ã£ãŸã€ã¨ã„ã†çµŒç·¯ã§é–‹ç™ºã‚’ã¯ã˜ã‚ã¾ã—ãŸã€‚\nawscli ã‚’ä½¿ã£ãŸ ECS Execute æ©Ÿèƒ½ã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ­ã‚°ã‚¤ãƒ³ æ‰‹é–“ãŒå¤šã„ã¨æ›¸ãã¾ã—ãŸãŒå®Ÿéš›ã« awscli ã‚’ä½¿ã†å ´åˆã©ã®ç¨‹åº¦ã®æ‰‹é–“ãŒã‚ã‚‹ã®ã‹ç°¡å˜ã«è¨˜ã—ã¾ã™ã€‚ã¾ãšä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦\n$ aws ecs list-tasks --cluster \u0026lt;ã‚¯ãƒ©ã‚¹ã‚¿å\u0026gt; --service \u0026lt;ã‚µãƒ¼ãƒ“ã‚¹å\u0026gt; taskArn ãŒå¾—ã‚‰ã‚Œã‚‹ã®ã§ Arn ã‹ã‚‰ task ID ã‚’æ‹¾ã£ã¦ã€ãã® task ID ã‚’ä½¿ã£ã¦\n$ aws ecs execute --cluster \u0026lt;ã‚¯ãƒ©ã‚¹ã‚¿å\u0026gt; \\ --task \u0026lt;task ID\u0026gt; \\ -- container \u0026lt;ã‚³ãƒ³ãƒ†ãƒŠå\u0026gt; \\ --interfactive \\ --command \u0026#34;sh\u0026#34; ã¨ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³å‡ºæ¥ã¾ã™ã€‚ãŒæ‰‹é–“ãŒå°‘ã—å¤šã„ã®ã¨ task ID ã‚’æ‹¾ã„å‡ºã™ä½œæ¥­ã‚‚è¾›ã„ã®ã§æ”¹å–„ã—ãŸã„\u0026hellip;ã€‚\næ“ä½œç”»é¢ ã¨ã„ã†ã“ã¨ã§ miniecs ã¨ã„ã† CLI ã‚’ä½œã£ãŸã®ã§ã™ãŒã€ ã¾ãšã¯æ“ä½œã—ã¦ã„ã‚‹æ§˜å­ã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚ğŸ˜· Fuzzy Finder ãªã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒãŒå‡ºæ¥ã‚‹ CLI ã«ãªã£ã¦ã„ã¦ã€ECS ã‚¯ãƒ©ã‚¹ã‚¿åãƒ»ECS ã‚µãƒ¼ãƒ“ã‚¹åãƒ»ã‚³ãƒ³ãƒ†ãƒŠåã‚’ä¸€éƒ¨å…¥åŠ›ã™ã‚‹ã¨ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã„ç’°å¢ƒãŒé¸æŠå‡ºæ¥ã‚‹ãƒ„ãƒ¼ãƒ«ã«ãªã£ã¦ã„ã¾ã™ã€‚\nä½¿ã£ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒª ä¸‹è¨˜ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦é–‹ç™ºã—ã¾ã—ãŸã€‚CLI ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ spf13/conbraã€‚ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ãƒ¼ãƒ€ã® spf13/viperã€‚ãƒ­ã‚°å‡ºåŠ›ã¯ sirupsen/logrusã€‚Fuzzy Finder ã¯ ktr0731/go-fuzzyfinder ã‚’ä½¿ã£ãŸæ„Ÿã˜ã§ã™ã€‚\ngithub.com/aws/aws-sdk-go github.com/ktr0731/go-fuzzyfinder github.com/sirupsen/logrus github.com/spf13/cobra github.com/spf13/viper ã‚³ãƒ¼ãƒ‰ ä¸‹è¨˜ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã§ Apache 2.0 ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚miniecs ã¨ã„ã†åå‰ã§ã™ã€‚\nhttps://github.com/jedipunkz/miniecs.git\naws-sdk-go ã®åˆ©ç”¨ã¨ AWS ã‚µãƒãƒ¼ãƒˆã«æ•™ãˆã¦ã‚‚ã‚‰ã£ãŸå†…å®¹ aws-sdk-go v1 ã‚’ä»Šå›åˆ©ç”¨ã—ã¾ã—ãŸã€‚ä¸‹è¨˜ã®é–¢æ•° ExecuteCommand ã‚’ç”¨ã„ã¾ã™ã€‚\nhttps://docs.aws.amazon.com/sdk-for-go/api/service/ecs/#ECS.ExecuteCommand\nã‚¤ãƒ³ãƒ—ãƒƒãƒˆã¨ã—ã¦ã¯ ExecuteCommandInput ã§ä¸‹è¨˜ã®ã‚ˆã†ãªæƒ…å ±ã‚’å…¥ã‚Œã‚‹å½¢ã§ã™ã€‚\ntype ExecuteCommandInput struct { Cluster *string `locationName:\u0026#34;cluster\u0026#34; type:\u0026#34;string\u0026#34;` Command *string `locationName:\u0026#34;command\u0026#34; type:\u0026#34;string\u0026#34; required:\u0026#34;true\u0026#34;` Container *string `locationName:\u0026#34;container\u0026#34; type:\u0026#34;string\u0026#34;` Interactive *bool `locationName:\u0026#34;interactive\u0026#34; type:\u0026#34;boolean\u0026#34; required:\u0026#34;true\u0026#34;` Task *string `locationName:\u0026#34;task\u0026#34; type:\u0026#34;string\u0026#34; required:\u0026#34;true\u0026#34;` } ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã¯ ExecuteCommandOutput ã§ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\ntype ExecuteCommandOutput struct { ClusterArn *string `locationName:\u0026#34;clusterArn\u0026#34; type:\u0026#34;string\u0026#34;` ContainerArn *string `locationName:\u0026#34;containerArn\u0026#34; type:\u0026#34;string\u0026#34;` ContainerName *string `locationName:\u0026#34;containerName\u0026#34; type:\u0026#34;string\u0026#34;` Interactive *bool `locationName:\u0026#34;interactive\u0026#34; type:\u0026#34;boolean\u0026#34;` Session *Session `locationName:\u0026#34;session\u0026#34; type:\u0026#34;structure\u0026#34;` TaskArn *string `locationName:\u0026#34;taskArn\u0026#34; type:\u0026#34;string\u0026#34;` } ã“ã“ã§ç–‘å•ç‚¹ãŒæµ®ä¸Šã€‚é–¢æ•° ExecuteCommand ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä½•ã‚‚è€ƒãˆãšã«ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ãŒå¯èƒ½ã«ãªã‚‹ã®ã‹ã¨æ€ã„ãã‚„å‡ºæ¥ãªã„æ¨¡æ§˜ã€‚ ãã“ã§ AWS ã‚µãƒãƒ¼ãƒˆã«å•ã„åˆã‚ã›ä¸‹è¨˜ã®ã‚ˆã†ãªå›ç­”ã‚’é ‚ãã¾ã—ãŸã€‚\naws-sdk-go ã® ExecuteCommand ã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã«ã¯æˆ»ã‚Šå€¤ ExecuteCommandOutput ã®æƒ…å ±ã‚’åˆ©ç”¨ã—ã¦ session-manager-plugin ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nãµã‚€ã€‚ãŸã  session-manager-plugin ã¯ OS ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãƒã‚¤ãƒŠãƒªå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ç‰¹ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¸¡ã—ã¦å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ãª CLI å½¢å¼ã®ã‚³ãƒãƒ³ãƒ‰ã§ã¯ãªã„æ¨¡æ§˜ã§ã—ãŸã€‚æ›´ã« AWS ã®å›ç­”ã‚’èª­ã‚€ã¨\nãœã² AWS ã§é–‹ç™ºã—ã¦ Apache 2.0 ã§å…¬é–‹ã—ã¦ã„ã‚‹ copilot-cli ã‚’å‚è€ƒã«ã—ã¦ä¸‹ã•ã„ã€‚\nã¨ã‚ã£ã¦ã€å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã¿ã¾ã—ãŸã€‚ä¸‹è¨˜ãŒå®Ÿéš›ã«ã‚³ãƒ³ãƒ†ãƒŠã¸ã®ãƒ­ã‚°ã‚¤ãƒ³ã‚’ã—ã¦ã„ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¼µã£ã¦ã„ã‚‹é–¢æ•°ã®ã‚ˆã†ã§ã™ã€‚ https://github.com/aws/copilot-cli/blob/mainline/internal/pkg/exec/ssm_plugin.go\n// StartSession starts a session using the ssm plugin. func (s SSMPluginCommand) StartSession(ssmSess *ecs.Session) error { response, err := json.Marshal(ssmSess) if err != nil { return fmt.Errorf(\u0026#34;marshal session response: %w\u0026#34;, err) } if err := s.runner.InteractiveRun(ssmPluginBinaryName, []string{string(response), aws.StringValue(s.sess.Config.Region), startSessionAction}); err != nil { return fmt.Errorf(\u0026#34;start session: %w\u0026#34;, err) } return nil } Apache 2.0 ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¨ã„ã†ã“ã¨ã§ä»Šå›é–‹ç™ºã—ãŸ miniecs ã§ã‚‚ã“ã®ã‚ãŸã‚Šã®ã‚³ãƒ¼ãƒ‰ã¯åˆ©ç”¨ãƒ»å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚\nã¾ã¨ã‚ ã¾ã ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã„ãªã„ã®ã¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ã®é€²ã‚“ã§ã„ãªã„ã§ã™ã—ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã®æ•°ã‚‚ list (ç’°å¢ƒä¸€è¦§è¡¨ç¤º), exec (ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ), login (ã‚³ãƒ³ãƒ†ãƒŠãƒ­ã‚°ã‚¤ãƒ³) ã ã‘ã¨ã„ã†çŠ¶æ³ãªã®ã§ã€ã‚‚ã†å°‘ã—æ©Ÿèƒ½ã‚’å¢—ã‚„ã—ãŸã„ãªã¨æ€ã„ã¤ã¤ã‚ã¾ã‚Šã‚¢ã‚¤ãƒ‡ã‚¢ãŒãªã„ã§ã™ã€‚Go åˆå­¦è€…ã«ã¨ã£ã¦ã¯è‰¯ã„é–‹ç™ºãƒ†ãƒ¼ãƒã ã£ãŸã¨ã¯æ€ã£ã¦ã„ã¾ã™ã€‚\næ¬¡ã«ä½•ã‚’é–‹ç™ºã™ã‚‹ã‹ \u0026hellip; aws-sdk-go ã‚’ä½¿ã£ãŸé–‹ç™ºã¯å¹¾ã¤ã‹ã—ã¦ãã¦ã€ãã‚ãã‚æ–¹å‘æ€§ã‚’å¤‰ãˆãŸã„ãªã¨ã‚‚æ€ã„ã¤ã¤ä½•ã‚’ä½œã‚‹ã¹ãã‹\u0026hellip; ğŸ¤” ã€‚Prometheus ã® Exporter ã‚„ã€Datadog ã® Go SDK ã‚’ä½¿ã£ãŸé–‹ç™ºãªã©ã‚‚è‰¯ã•ãã†ã‹ãªãã€‚ğŸ˜· ã¡ã‚‡ã†ã©æ˜¨æ—¥æ€ã„ã¤ã„ãŸã‚¢ã‚¤ãƒ‡ã‚¢ã¨ã—ã¦ã¯ ECR ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ (ã¾ãŸ aws-sdk-go ä½¿ã†ã‘ã©) ã‚’å®Ÿè¡Œã™ã‚‹ Lambda ã‚’é–‹ç™ºã—ã¦ Datadog ã‹ Prometheus ã«ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¦ã€å¯è¦–åŒ–ãƒ»åˆ†æã™ã‚‹ãªã©ã©ã†ã‹ãªãã¨æ€ã„ã¾ã—ãŸã€‚\nGitHub Actions ã§ã‚¢ãƒ—ãƒªã® Docker ãƒ“ãƒ«ãƒ‰ \u0026amp; ECR ãƒ—ãƒƒã‚·ãƒ¥ã¨åŒæ™‚ã« API Gateway çµŒç”±ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦çµæœã‚’ Datadog ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ã—ã¦é€ä¿¡ ä¸€å®šæœŸé–“æ¯ã« ECR ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ Prometheus Exporter ã‚’é–‹ç™º ã©ã¡ã‚‰ã‚‚é¢ç™½ãã†ğŸ¤¤\n","permalink":"https://jedipunkz.github.io/post/ecs-login-cli/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ \u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ğŸš€ ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ Go è¨€èªã§ ECS ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ CLI ã‚’ä½œã£ãŸè©±ã‚’æ›¸ãã¾ã™ã€‚\u003c/p\u003e\n\u003ch3 id=\"é–‹ç™ºã®çµŒç·¯\"\u003eé–‹ç™ºã®çµŒç·¯\u003c/h3\u003e\n\u003cp\u003eè‡ªåˆ†ã¯ã¾ã  Go è¨€èªã®åˆå­¦è€…ã§å­¦ç¿’ã®ãŸã‚ã«é–‹ç™ºã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æ¢ã—ã¦ã„ãŸçŠ¶æ…‹ã§ã—ãŸã€‚ãã“ã§è‡ªåˆ†ã®å‹¤ã‚ã¦ã„ã‚‹ä¼šç¤¾ã§ ECS Execute æ©Ÿèƒ½ã‚’ä½¿ã£ãŸã‚³ãƒ³ãƒ†ãƒŠãƒ­ã‚°ã‚¤ãƒ³ã®æ©Ÿèƒ½ã‚’é–‹ç™ºè€…ã«æä¾›ã—ã¦ã„ãŸäº‹ã‚’æ€ã„å‡ºã—è‰²ã€…èª¿ã¹ã¦ã„ã¦ã€Œã‚‚ã†å°‘ã—æ‰‹é–“ãŒçœã‘ãªã„ã‹ï¼Ÿã€ã¨æ€ã„ç«‹ã£ãŸã€ã¨ã„ã†çµŒç·¯ã§é–‹ç™ºã‚’ã¯ã˜ã‚ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ch3 id=\"awscli-ã‚’ä½¿ã£ãŸ-ecs-execute-æ©Ÿèƒ½ã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ­ã‚°ã‚¤ãƒ³\"\u003eawscli ã‚’ä½¿ã£ãŸ ECS Execute æ©Ÿèƒ½ã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ­ã‚°ã‚¤ãƒ³\u003c/h3\u003e\n\u003cp\u003eæ‰‹é–“ãŒå¤šã„ã¨æ›¸ãã¾ã—ãŸãŒå®Ÿéš›ã« awscli ã‚’ä½¿ã†å ´åˆã©ã®ç¨‹åº¦ã®æ‰‹é–“ãŒã‚ã‚‹ã®ã‹ç°¡å˜ã«è¨˜ã—ã¾ã™ã€‚ã¾ãšä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ aws ecs list-tasks --cluster \u0026lt;ã‚¯ãƒ©ã‚¹ã‚¿å\u0026gt; --service \u0026lt;ã‚µãƒ¼ãƒ“ã‚¹å\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003etaskArn ãŒå¾—ã‚‰ã‚Œã‚‹ã®ã§ Arn ã‹ã‚‰ task ID ã‚’æ‹¾ã£ã¦ã€ãã® task ID ã‚’ä½¿ã£ã¦\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ aws ecs execute --cluster \u0026lt;ã‚¯ãƒ©ã‚¹ã‚¿å\u0026gt; \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e  --task \u0026lt;task ID\u0026gt; \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e  -- container \u0026lt;ã‚³ãƒ³ãƒ†ãƒŠå\u0026gt; \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e  --interfactive \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e  --command \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sh\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eã¨ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³å‡ºæ¥ã¾ã™ã€‚ãŒæ‰‹é–“ãŒå°‘ã—å¤šã„ã®ã¨ task ID ã‚’æ‹¾ã„å‡ºã™ä½œæ¥­ã‚‚è¾›ã„ã®ã§æ”¹å–„ã—ãŸã„\u0026hellip;ã€‚\u003c/p\u003e\n\u003ch3 id=\"æ“ä½œç”»é¢\"\u003eæ“ä½œç”»é¢\u003c/h3\u003e\n\u003cp\u003eã¨ã„ã†ã“ã¨ã§ miniecs ã¨ã„ã† CLI ã‚’ä½œã£ãŸã®ã§ã™ãŒã€ ã¾ãšã¯æ“ä½œã—ã¦ã„ã‚‹æ§˜å­ã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚ğŸ˜· Fuzzy Finder ãªã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒãŒå‡ºæ¥ã‚‹ CLI ã«ãªã£ã¦ã„ã¦ã€ECS ã‚¯ãƒ©ã‚¹ã‚¿åãƒ»ECS ã‚µãƒ¼ãƒ“ã‚¹åãƒ»ã‚³ãƒ³ãƒ†ãƒŠåã‚’ä¸€éƒ¨å…¥åŠ›ã™ã‚‹ã¨ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã„ç’°å¢ƒãŒé¸æŠå‡ºæ¥ã‚‹ãƒ„ãƒ¼ãƒ«ã«ãªã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e","title":"ECS ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ CLI ã‚’ Go è¨€èªã§ä½œã£ãŸè©±"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚jedipunkzğŸš€ ã§ã™ã€‚\nä»Šå›ã‚‚ READYFOR Advent Calendar 2021 ã®è¨˜äº‹ã¨ã—ã¦åŸ·ç­†ã—ã¾ã™ã€‚\nä»Šå›ã®ãƒ†ãƒ¼ãƒ å‰å›ã®è¨˜äº‹ ã§ã¯ ECS ç§»è¡Œå¾Œã®æ§‹æˆã«ã¤ã„ã¦æ¤œè¨ã™ã‚‹å†…å®¹ã‚’è¨˜ã—ã¾ã—ãŸã€‚Progressive Delivery ã‚’å®Ÿè·µã™ã‚‹ä¸Šã§ã‚‚ãã®ä¸€æ­©æ‰‹å‰ã®æ§‹æˆã¨è¨€ã£ã¦ã„ã„ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹æ§‹æˆã«ã¤ã„ã¦ã€ä»Šå›ã¯è¨˜ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\nãƒ‡ã‚°ãƒ¬ã—ã¦ã—ã¾ã£ã¦ã„ãŸã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ READYFOR ã§ã¯ AWS ECS ç§»è¡Œã‚’è¡Œã„ ECS + CodeDeploy ã«ã‚ˆã‚‹ Blue/Green ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’å°å…¥ã—ã¾ã—ãŸã€‚é€†ã«ç§»è¡Œå‰ã¾ã§ã«å‡ºæ¥ã¦ã„ãŸã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ãŒå®Ÿæ–½ã§ããªããªã‚Šã¾ã—ãŸã€‚ã¨ã¯è¨€ã£ã¦ã‚‚ãã‚Œã¾ã§é–‹ç™ºè€…ãŒã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ã«å¯¾ã—ã¦æ±‚ã‚ã¦ã„ãŸä¸»ãªæ©Ÿèƒ½ã¯ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã ã£ãŸãŸã‚ã€ã²ã¨ã¾ãšã¯ Blue/Green ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã§äº‹è¶³ã‚Šã¦ã„ã‚‹çŠ¶æ³ãªã®ã§ã™ãŒã€ä»Šå¾Œå¤§ããªæ©Ÿèƒ½ã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹éš›ã«ã¯ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã‚’å¾ã€…ã«å¯„ã›å½±éŸ¿ã‚’æŠŠæ¡ã—ãŸä¸Šã§ãƒªãƒªãƒ¼ã‚¹é€²ã‚ã‚‹ã¨ã„ã†ä½œæ¥­ã¯å¿…è¦ã«ãªã£ã¦ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\nã‚ˆã£ã¦ã€\nProgressive Delivery ã®ä¸€æ­©æ‰‹å‰ã®æ§‹æˆã‚’å®Ÿè·µã™ã‚‹ å¤§ããªãƒªãƒªãƒ¼ã‚¹ã®ãŸã‚ã®ç’°å¢ƒæ•´å‚™ ã¨ã„ã†æ„å‘³ã§ã‚‚ã€ä¸€å›ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹æ§‹æˆã«ã¤ã„ã¦æ¤œè¨ã—ã¦ãŠã“ã†ã¨è€ƒãˆã¾ã—ãŸã€‚\nç’°å¢ƒæ§‹ç¯‰ ä»Šå›ç”¨æ„ã—ãŸ Terraform ã‚³ãƒ¼ãƒ‰ æ¤œè¨¼ã§ä½œæˆã—ãŸ AWS ç’°å¢ƒã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã® Terraform ã‚³ãƒ¼ãƒ‰ã‚’ä¸‹è¨˜ã®å ´æ‰€ã«ç½®ã„ã¦ã‚ã‚Šã¾ã™ã€‚å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚\nhttps://github.com/jedipunkz/tf-appmesh-ecs-canary-release\n(ä»Šå›æ¤œè¨¼ã§ä½œæˆã—ãŸã‚³ãƒ¼ãƒ‰ã¯æ¥­å‹™ä¸Šä½œæˆã—ãŸã‚‚ã®ã§ã™ãŒã€READYFOR ã® OSS ãƒãƒªã‚·ãƒ¼ã«å‰‡ã‚Šè‘—ä½œæ¨©è­²æ¸¡ã‚’ã†ã‘ã¦ãŠã‚Šã€è‡ªã‚‰ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚)\nApp Mesh ECS NLB Service Discovery Envoy X-Ray ã¨ã„ã£ãŸæŠ€è¡“è¦ç´ ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚\nTerraform ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿæ–½ ä¸Šè¨˜ã«è¨˜ã—ãŸ Terraform ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ãŸæ§‹æˆã®ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ã‚’è¨˜ã—ã¾ã™ã€‚\nå‰æã¨ã—ã¦ Terraform ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.0.x ç³»ä»¥ä¸Šã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n$ # AWS ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æƒ…å ±ã‚’è¨­å®š $ git clone https://github.com/jedipunkz/tf-appmesh-ecs-canary-release $ cd tf-appmesh-ecs-canary-release $ terraform plan $ terraform apply æ§‹æˆ æ¤œè¨¼ã§æ§‹ç¯‰ã—ãŸæ§‹æˆ(ä¸Šè¨˜ã® Terraform ã‚³ãƒ¼ãƒ‰ã§æ§‹ç¯‰ã§ãã‚‹) ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚\næ§‹æˆã®ç‰¹å¾´ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã®æµã‚Œ NLB ã§å—ã‘ä»˜ã‘ãŸ TCP 80 ç•ªãƒãƒ¼ãƒˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ ECS Task ä¸Šã§èµ·å‹•ã—ã¦ã„ã‚‹ Envoy (Gateway) ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ†æ•£ Envoy (Gateway) ã¯ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã‚’ AppMesh Virtual Gateway ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆã«æŒ‡å®šã—ã¦ã„ã‚‹ VirtualService ã¸åˆ†æ•£ VirtualService ã«ã¯ VirtualRouter ãŒè¨­å®šã•ã‚Œã¦ãŠã‚Šãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±ã¨ã—ã¦ VirtualNode x 2 å°ã‚’è¨­å®šã—ã¦ã„ã‚‹ çµæœ VirtualNode x 2 \u0026ldquo;example1\u0026rdquo;, \u0026ldquo;example2\u0026rdquo; ã¸è·é‡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã‚ˆã£ã¦ãƒˆãƒ©ãƒ’ãƒƒã‚¯ãŒãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã‚‹ å„ VirtualNode ã¯ ECS Task (example1, example2) ã«ç´ä»˜ã„ã¦ã„ã‚‹ â€»example1, example2 ã¯ä¸Šè¨˜ Terraform ã‚³ãƒ¼ãƒ‰å†…ã§è¨­å®šã—ã¦ã„ã‚‹ AWS ãƒªã‚½ãƒ¼ã‚¹åã§ã™ã€‚\nã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªã®æ§‹æˆ AWS ServiceDiscovery ã‚’ç”¨ã„ã¦ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªã®æ©Ÿèƒ½ã‚’ç”¨ã„ã¦ã„ã¾ã™ã€‚åå‰ã®é–¢ä¿‚ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚\nNamespace ã¨ã—ã¦ example.internal ã‚’ä½œæˆ (CloudMap ã¨ã—ã¦ç”Ÿæˆã•ã‚Œã‚‹) Namespace example.internal é…ä¸‹ã« exmaplegw.example.internal ã‚’ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ç”Ÿæˆ Namespace example.internal é…ä¸‹ã« exmaple1.example.internal ã‚’ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ç”Ÿæˆ Namespace example.internal é…ä¸‹ã« exmaple2.example.internal ã‚’ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ç”Ÿæˆ ã¾ãŸã€å„ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªã‚µãƒ¼ãƒ“ã‚¹ã¯ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®æ©Ÿèƒ½ã‚’æœ‰ã—ã¦ã„ã¦ã€å®Ÿä½“ã§ã‚ã‚‹ ECS Task ãŒç„¡ã„ã¨ Route53 ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã€‚\nå‹•ä½œç¢ºèª æ§‹ç¯‰ã—ãŸ App Mesh + ECS æ§‹æˆã®å‹•ä½œç¢ºèªã‚’ã—ã¦ã¿ã¾ã™ã€‚\nä¸‹è¨˜ã® App Mesh Route ã®è¨˜è¿° ã«ã‚ã‚‹é€šã‚Šã€å„ VirtualNode (exmaple1, example2) ã¸ã®è·é‡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ã—ã¦ 95:5 ã¨ã„ã†æ¯”ç‡ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚\nspec { http_route { match { prefix = \u0026#34;/\u0026#34; } action { weighted_target { virtual_node = aws_appmesh_virtual_node.example1.name weight = 95 } weighted_target { virtual_node = aws_appmesh_virtual_node.example2.name weight = 5 } } } } ã“ã®è¨­å®šã—ãŸæ¯”ç‡ 95:5 ãŒæ©Ÿèƒ½ã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã€ä¸‹è¨˜ã®ã‚ˆã†ãªç°¡å˜ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”¨æ„ã—ã¦å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚\n#!/bin/sh i=0 while [ $i -ne 100 ] do i=$(($i+1)) echo \u0026#34;$i\u0026#34; curl http://\u0026lt;NLB ã® DNS å/ \u0026gt;\u0026gt; /tmp/example.log sleep 1 done çµæœã¨ã—ã¦ä¸‹è¨˜ã®ã« 97:3 ã¨ã„ã†æ¯”ç‡ã§ãã‚Œãã‚Œã® VirtualNode (ECS Task) ã‹ã‚‰å¿œç­”ãŒã‚ã‚Šã€App Mesh Route ã®è¨­å®šå€¤ 95:5 ã¨ã»ã¼åŒç­‰ã§ã‚ã‚‹äº‹ãŒåˆ¤ã‚Šã¾ã—ãŸã€‚\n$ grep example1 /tmp/example.log | wc -l 97 $ grep example2 /tmp/example.log | wc -l 3 aws-sdk-go ã‚’ä½¿ã£ãŸè·é‡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ“ä½œã«ã¤ã„ã¦ READYFOR ã§ã¯ã‚¤ãƒ³ãƒ•ãƒ©ã®ã‚³ãƒ¼ãƒ‰ã‚’ Go è¨€èªã‚’ä½¿ã£ã¦é–‹ç™ºã™ã‚‹æ©Ÿä¼šãŒå¤šã„ã®ã§ã™ãŒã€ã“ã“ã§ã¯ aws-sdk-go ã‚’ä½¿ã£ãŸè·é‡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ“ä½œã«ã¤ã„ã¦èª¿ã¹ãŸã®ã§è¨˜ã—ã¦ã„ãã¾ã™ã€‚\nãªãœ aws-sdk-go ãªã®ã‹ï¼Ÿ è·é‡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯ App Mesh ã® VirtualRoute ã¨ã„ã†ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šã«è¨­å®šã‚’æ–½ã™ã®ã§ã™ãŒã€ãã‚Œè‡ªä½“ãŒ AWS ãƒªã‚½ãƒ¼ã‚¹ã§ã™ã€‚ã‚ˆã£ã¦ Terraform ã‚³ãƒ¼ãƒ‰ã§ãƒªã‚½ãƒ¼ã‚¹ä½œæˆã—ãŸã®ã§ã™ãŒã€SRE ã‚„ã‚¤ãƒ³ãƒ•ãƒ©ãƒ¡ãƒ³ãƒã¨ç•°ãªã‚Šã€é–‹ç™ºè€…è‡ªèº«ã«ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ã‚’å®Ÿè·µã—ã¦ã‚‚ã‚‰ã† äº‹ã‚’æƒ³å®šã™ã‚‹ã¨ Terraform ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ“ä½œã¯ä¸å‘ãã¨è€ƒãˆã¾ã—ãŸã€‚ã‚ˆã£ã¦ä»–ã®æ–¹æ³•ã‚’è€ƒãˆãªãã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚\nSRE ã®æŒã£ã¦ã„ã‚‹æ¨©é™ã¨æ©Ÿèƒ½ã‚’é–‹ç™ºè€…ã«æä¾›ã™ã‚‹ã¨ã„ã†æ„å‘³ã§ã¯ Slack ç­‰ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã®å…¥åŠ›ã«ã‚ˆã‚‹ãƒœãƒƒãƒˆæ“ä½œãŒéå¸¸ã«èå’Œæ€§ãŒé«˜ã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚ã‚ˆã£ã¦ã€ã“ã®ãƒœãƒƒãƒˆã‚’é–‹ç™ºã™ã‚‹ä¸Šã§ã‚‚ aws-sdk-go ã‚’ä½¿ã£ã¦è·é‡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ“ä½œãŒå‡ºæ¥ã¦ã—ã¾ãˆã°ã€ã‚ã¨ã¯é–‹ç™ºã™ã‚‹ã ã‘ã¨ãªã‚Šã¾ã™ã€‚\nå‚è€ƒè³‡æ–™ aws-sdk-go ã®è·é‡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ“ä½œã«ã¤ã„ã¦ã¯ä¸‹è¨˜ã®é–¢æ•°ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚\nhttps://docs.aws.amazon.com/sdk-for-go/api/service/appmesh/#AppMesh.UpdateRoute\nè·é‡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ“ä½œã‚³ãƒ¼ãƒ‰ ä¸‹è¨˜ã«å‹•ä½œç¢ºèªã¾ã§è¡Œã£ãŸ Go ã®ã‚³ãƒ¼ãƒ‰ã‚’è¨˜ã—ã¾ã™ã€‚ UpdateRoute ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§æ“ä½œãŒè¡Œãˆã¾ã—ãŸã€‚UpdateRouteInput ã«ç’°å¢ƒæƒ…å ±ã‚’è¨˜ã—ã¤ã¤ã€Spec ã«è·é‡è¨­å®šå€¤ã‚’å…¥åŠ›ã™ã‚‹äº‹ã§è·é‡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’æ“ä½œã§ãã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\npackage main import ( \u0026#34;encoding/json\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/aws/aws-sdk-go/aws\u0026#34; \u0026#34;github.com/aws/aws-sdk-go/aws/session\u0026#34; \u0026#34;github.com/aws/aws-sdk-go/service/appmesh\u0026#34; ) func main() { sess := session.New() svc := appmesh.New(sess) jsonBlob := []byte(` { \u0026#34;HttpRoute\u0026#34;: { \u0026#34;Action\u0026#34;: { \u0026#34;WeightedTargets\u0026#34;: [{ \u0026#34;VirtualNode\u0026#34;: \u0026#34;example1\u0026#34;, \u0026#34;Weight\u0026#34;: 90 },{ \u0026#34;VirtualNode\u0026#34;: \u0026#34;example2\u0026#34;, \u0026#34;Weight\u0026#34;: 10 }] }, \u0026#34;Match\u0026#34;: { \u0026#34;Prefix\u0026#34;: \u0026#34;/\u0026#34; } } }`) var spec *appmesh.RouteSpec err := json.Unmarshal(jsonBlob, \u0026amp;spec) if err != nil { log.Fatal(err) } input := \u0026amp;appmesh.UpdateRouteInput{ // ClientToken: aws.String(\u0026#34;foo\u0026#34;), MeshName: aws.String(\u0026#34;example\u0026#34;), MeshOwner: aws.String(\u0026#34;\u0026lt;AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ ID\u0026gt;\u0026#34;), RouteName: aws.String(\u0026#34;example\u0026#34;), Spec: spec, VirtualRouterName: aws.String(\u0026#34;example\u0026#34;), } result, err := svc.UpdateRoute(input) if err != nil { log.Println(err) } fmt.Println(result) } ã¾ã¨ã‚ã¨è€ƒå¯Ÿ çµæœã¨ã—ã¦ä¸‹è¨˜ã®ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚\nApp Mesh + ECS ã®æœ€å°æ§‹æˆãŒçµ„ã‚ã€ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹æ©Ÿèƒ½ã‚’é–‹ç™ºè€…ã¸æä¾›ã§ãã‚‹ æ“ä½œè‡ªä½“ã‚‚é–‹ç™ºè€…è‡ªèº«ã«è¡Œã£ã¦ã‚‚ã‚‰ãˆã‚‹ ã§ã™ãŒã€å¹¾ã¤ã‹ã‹è€ƒãˆãªãã¦ã¯ã„ã‘ãªã„äº‹ãŒã‚ã‚Šã¾ã™ã€‚\nå•é¡Œç‚¹ ä¸€æ–¹ã® VirualNode A (ä»®ã®åå‰ã¨ã—ã¦ç”¨ã„ã¾ã™) ã‹ã‚‰ã‚‚ã†ä¸€æ–¹ã® VirtualNode B ã¸ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ã‚’å®Ÿæ–½ã™ã‚‹ã¨é€šå¸¸æ™‚ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã‚‹ç’°å¢ƒã¯ VirtualNode B ã¨ã‚Šã¾ã™ã€‚ãã®æ¬¡ã®ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã¯é€†ã« VirtualNode B -\u0026gt; VirtualNode A ã¨åˆ‡ã‚Šæ›¿ãˆãªãã¦ã¯ã„ã‘ãªã„ã®ã‹ï¼Ÿã¾ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ãŒ A ãªã®ã‹ B ãªã®ã‹ã€ã¨ã„ã†å•é¡ŒãŒæµ®ä¸Šã—ã¦ãã¾ã™ã€‚\nã“ã‚Œã‚‰ãŒè§£æ±ºã§ããªã„ã¨ã€é‹ç”¨è² æ‹…å¢—ã‚„ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆã®é›£æ˜“åº¦é«˜ã¨ã„ã£ãŸå—ã‘å…¥ã‚ŒãŒãŸã„å…·ä½“çš„ãªå•é¡Œã«ç¹‹ãŒã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚\nå•é¡Œç‚¹ã®è§£æ¶ˆ: æ§‹æˆæ¡ˆ #1 ãã“ã§ä¸Šè¨˜ã®å•é¡Œã‚’å›é¿ã—ã¤ã¤ã©ã†æ§‹æˆã™ã‚‹ã‹ã‚’è€ƒãˆã¦ã¿ã¾ã—ãŸã€‚\nå‰æã®ç’°å¢ƒ ä¸‹è¨˜ã®å‰æã§æ§‹æˆã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚\nVirtualNode A ã‚’é€šå¸¸æ™‚ã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’å—ã‘ã‚‹ ECS Service ã¨ã—ã¦ç”¨æ„ VirtualNode B ã‚’ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹æ™‚ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’å—ã‘ã‚‹ ECS Service ã¨ã—ã¦ç”¨æ„ ãƒ–ãƒ©ãƒ³ãƒã¨ ECS Service ã®å¯¾å¿œ ãƒ¬ãƒã‚¸ãƒˆãƒªã®ãƒ–ãƒ©ãƒ³ãƒ main , canary ã«å¯¾ã—ã¦ä¸‹è¨˜ã®ã‚ˆã†ãªå¯¾å¿œä»˜ã‘ã§ ECS Service ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æˆ¦ç•¥ã§ã™ã€‚\nãƒ–ãƒ©ãƒ³ãƒå ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã® ECS Serivice main ECS Service (VIrtualNode A) canary ECS Service (VirtualNode B) ãƒªãƒªãƒ¼ã‚¹ã®æµã‚Œ ãƒªãƒªãƒ¼ã‚¹ã®æµã‚Œã¨ã—ã¦ã¯ä¸‹è¨˜ãŒè€ƒãˆã‚Œã¾ã™ã€‚\n(1) canary ãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ \u0026amp; VirtualNode B ECS ã¸ãƒ‡ãƒ—ãƒ­ã‚¤ (2) è·é‡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã‚ˆã‚Š A -\u0026gt; B ã¸å¾ã€…ã«ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã‚’æµã—æœ€çµ‚çš„ã« 100% ã« (3) main ãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã—ã¦ VirtualNode A ECS ã¸ãƒ‡ãƒ—ãƒ­ã‚¤ (4) è·é‡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° A:B = 100:0 ã¨ã—ã¦ VirtualNode A ECS ã¸ 100% æµã™ ã“ã‚Œã«ã‚ˆã‚Šã€VirtualNode A ã¯é€šå¸¸æ™‚ç”¨ ECS ç’°å¢ƒã¨ã„ã†å‰æã‚’å®ˆã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ã¾ãŸã€A -\u0026gt; B, B -\u0026gt; A ã¨ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ã®æµã‚Œã®å‘ãã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å•é¡Œã‚‚è§£æ¶ˆã•ã‚Œã¾ã™ã€‚\nãŸã ã€ã“ã‚Œã¯ä¸€æ¡ˆã§ã‚ã£ã¦ã€ä»–ã«ã‚‚è‰¯ã„æ§‹æˆãŒè€ƒãˆã‚‰ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\nä»Šå›ç´¹ä»‹ã—ãŸæ§‹æˆä»¥å¤–ã®æ§‹æˆã«ã¤ã„ã¦ ä»Šå›ã¯æ¤œè¨¼ã—ãªã‹ã£ãŸã®ã§ã™ãŒã€VirtualNode ã® backend è¨­å®šãŒå¯èƒ½ãªã‚ˆã†ã§ã™ã€‚è©³ç´°ã¯ã“ã¡ã‚‰ã® Terraform ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ ã«ã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ä¸‹è¨˜ã®ã‚ˆã†ãªæµã‚ŒãŒçµ„ã‚ã‚‹ã¨æƒ³å®šã—ã¦ã„ã¾ã™ã€‚\nNLB -\u0026gt; VirtualGateway (ECS) -\u0026gt; VirtualSerivce Î± -\u0026gt; VirtualRoute Î± -\u0026gt; VirtualNod Î± (ECS) x n -\u0026gt; VirtualService Î² -\u0026gt; VirtualRouter Î² -\u0026gt; VirtualNode Î² (ECS) x n ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãªã®ã‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãªã®ã‹ã®è€ƒå¯Ÿ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã¨ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãŒæä¾›ã§ãã‚‹æ©Ÿèƒ½ã¯\nå†—é•·æ€§ ä¿å®ˆæ€§ æ‹¡å¼µæ€§ ã¨ã„ã†æ„å‘³ã§ã¯ã»ã¼åŒç­‰ã®æ©Ÿèƒ½ã‚’æœ‰ã—ã¦ã„ã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚ãªã®ã§ã‚ˆã‚Šæ¯ã‚ŒãŸæŠ€è¡“ã§ã‚ã‚‹ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’ä½¿ã£ã¦æ§‹æˆã‚’è€ƒãˆã‚‰ã‚Œãªã„ã‹æ¤œè¨ã—ã¦ã¿ã¾ã—ãŸã€‚\nçµæœã€VirtualNode -\u0026gt; SerivceDiscovery -\u0026gt; ECS Service ã¨é€£æºã™ã‚‹éš›ã« ECS Service ã¯ ServiceDiscovery è‡ªä½“ã‚’ãƒ¬ã‚¸ã‚¹ãƒˆå‡ºæ¥ã‚‹ã®ã§ä¸Šè¨˜ã®æ§‹æˆå›³ã®æ§˜ãªæ§‹æˆãŒçµ„ã‚ã‚‹ã®ã§ã™ãŒã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã«ã™ã‚‹ã¨ã€ECS Service ã«å½“ã¦ã¯ã‚ã‚‰ã‚Œã‚‹ã®ã¯ LB ã¨ãªã‚Šã¾ã™ã€‚è·é‡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ»ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ã‚’ã™ã‚‹éš›ã« ECS Service ãŒè¤‡æ•°å¿…è¦ãªã‚ã‘ã§ã™ãŒã€ãã†ã™ã‚‹ã¨ ECS Service ã®æ•°åˆ†ã® LB ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ãã‚Œã‚’æ§‹æˆã™ã‚‹ TargetGroup, Listenr (ListenrRule) ã‚‚å¿…è¦ã«ãªã‚Šã¾ã™ã€‚\nå°šã€ãã®éš›ã«ã¯ Virtual Node ã® Service Discovery ã® dns ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã« hostname ã ã‘ã‚’è¨˜ã—ã¦ã€LB ã® DNS åã‚’çŸ¥ã‚‹ã›ã°è‰¯ã•ãã†ã«è¦‹å—ã‘ã¾ã—ãŸã€‚ãŒã€ã“ã®æ§‹æˆã«ã¤ã„ã¦ã¯ç„¡é§„ãªãƒªã‚½ãƒ¼ã‚¹ãŒç™ºç”Ÿã™ã‚‹ã¨åˆ¤æ–­ã—ãŸã“ã¨ã‚’å—ã‘ã€æ¤œè¨¼æœªå®Ÿæ–½ã§ã™ã€‚\nservice_discovery { dns { hostname = \u0026#34;nlb-****.example.internal\u0026#34; } } ã“ã‚Œã¯åŒç­‰ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ãã‚Œã‚‹ ServiceDiscovery ã‚’ä½¿ã£ãŸã»ã†ãŒç„¡é§„ãª aws ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã‚‰ãªãã¦æ¸ˆã‚€ã€ã¨ã„ã†çµæœã«ã¤ãªãŒã‚Šã¾ã™ã€‚\nã¾ã¨ã‚ã®ã¾ã¨ã‚(æ‰€æ„Ÿ) ä»¥ä¸Šã€ECS ã‚’ä½¿ã£ãŸã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹æ§‹æˆã«ã¤ã„ã¦è¨˜ã—ã¾ã—ãŸã€‚å€‹äººçš„ã«ã¯å°å…¥ã®å‰ã« Envoy ã‚„ X-ray ã«ã¤ã„ã¦ã‚‚ã†å°‘ã—æƒ…å ±åé›†ã—ã¦èª¿æŸ»ã®è§£åƒåº¦ã‚’ä¸Šã’ã¦ã„ãå¿…è¦ãŒã‚ã‚‹ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒˆãƒ©ãƒ’ãƒƒã‚¯ãŒ Envoy ã‚³ãƒ³ãƒ†ãƒŠã‚’ä»‹ã™äº‹ã«ãªã‚Šã€ãã‚Œã‚‰ã®çŸ¥è­˜ãŒååˆ†ã«ç„¡ã„ã¨ä¸‡ãŒä¸€ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆã®éš›ã«å›°ã‚‹ã ã‚ã†ãªãã¨è€ƒãˆã¦ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/app-mesh-ecs-canary/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003ejedipunkzğŸš€\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã‚‚ \u003ca href=\"https://qiita.com/advent-calendar/2021/readyfor\"\u003eREADYFOR Advent Calendar 2021\u003c/a\u003e ã®è¨˜äº‹ã¨ã—ã¦åŸ·ç­†ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä»Šå›ã®ãƒ†ãƒ¼ãƒ\"\u003eä»Šå›ã®ãƒ†ãƒ¼ãƒ\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://jedipunkz.github.io/post/progressive_delivery/\"\u003eå‰å›ã®è¨˜äº‹\u003c/a\u003e ã§ã¯ ECS ç§»è¡Œå¾Œã®æ§‹æˆã«ã¤ã„ã¦æ¤œè¨ã™ã‚‹å†…å®¹ã‚’è¨˜ã—ã¾ã—ãŸã€‚Progressive Delivery ã‚’å®Ÿè·µã™ã‚‹ä¸Šã§ã‚‚ãã®ä¸€æ­©æ‰‹å‰ã®æ§‹æˆã¨è¨€ã£ã¦ã„ã„ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹æ§‹æˆã«ã¤ã„ã¦ã€ä»Šå›ã¯è¨˜ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch3 id=\"ãƒ‡ã‚°ãƒ¬ã—ã¦ã—ã¾ã£ã¦ã„ãŸã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹\"\u003eãƒ‡ã‚°ãƒ¬ã—ã¦ã—ã¾ã£ã¦ã„ãŸã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹\u003c/h3\u003e\n\u003cp\u003eREADYFOR ã§ã¯ AWS ECS ç§»è¡Œã‚’è¡Œã„ ECS + CodeDeploy ã«ã‚ˆã‚‹ Blue/Green ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’å°å…¥ã—ã¾ã—ãŸã€‚é€†ã«ç§»è¡Œå‰ã¾ã§ã«å‡ºæ¥ã¦ã„ãŸã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ãŒå®Ÿæ–½ã§ããªããªã‚Šã¾ã—ãŸã€‚ã¨ã¯è¨€ã£ã¦ã‚‚ãã‚Œã¾ã§é–‹ç™ºè€…ãŒã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ã«å¯¾ã—ã¦æ±‚ã‚ã¦ã„ãŸä¸»ãªæ©Ÿèƒ½ã¯ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã ã£ãŸãŸã‚ã€ã²ã¨ã¾ãšã¯ Blue/Green ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã§äº‹è¶³ã‚Šã¦ã„ã‚‹çŠ¶æ³ãªã®ã§ã™ãŒã€ä»Šå¾Œå¤§ããªæ©Ÿèƒ½ã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹éš›ã«ã¯ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã‚’å¾ã€…ã«å¯„ã›å½±éŸ¿ã‚’æŠŠæ¡ã—ãŸä¸Šã§ãƒªãƒªãƒ¼ã‚¹é€²ã‚ã‚‹ã¨ã„ã†ä½œæ¥­ã¯å¿…è¦ã«ãªã£ã¦ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã‚ˆã£ã¦ã€\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eProgressive Delivery ã®ä¸€æ­©æ‰‹å‰ã®æ§‹æˆã‚’å®Ÿè·µã™ã‚‹\u003c/li\u003e\n\u003cli\u003eå¤§ããªãƒªãƒªãƒ¼ã‚¹ã®ãŸã‚ã®ç’°å¢ƒæ•´å‚™\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã¨ã„ã†æ„å‘³ã§ã‚‚ã€ä¸€å›ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹æ§‹æˆã«ã¤ã„ã¦æ¤œè¨ã—ã¦ãŠã“ã†ã¨è€ƒãˆã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ch2 id=\"ç’°å¢ƒæ§‹ç¯‰\"\u003eç’°å¢ƒæ§‹ç¯‰\u003c/h2\u003e\n\u003ch3 id=\"ä»Šå›ç”¨æ„ã—ãŸ-terraform-ã‚³ãƒ¼ãƒ‰\"\u003eä»Šå›ç”¨æ„ã—ãŸ Terraform ã‚³ãƒ¼ãƒ‰\u003c/h3\u003e\n\u003cp\u003eæ¤œè¨¼ã§ä½œæˆã—ãŸ AWS ç’°å¢ƒã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã® Terraform ã‚³ãƒ¼ãƒ‰ã‚’ä¸‹è¨˜ã®å ´æ‰€ã«ç½®ã„ã¦ã‚ã‚Šã¾ã™ã€‚å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/jedipunkz/tf-appmesh-ecs-canary-release\"\u003ehttps://github.com/jedipunkz/tf-appmesh-ecs-canary-release\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e(ä»Šå›æ¤œè¨¼ã§ä½œæˆã—ãŸã‚³ãƒ¼ãƒ‰ã¯æ¥­å‹™ä¸Šä½œæˆã—ãŸã‚‚ã®ã§ã™ãŒã€READYFOR ã® OSS ãƒãƒªã‚·ãƒ¼ã«å‰‡ã‚Šè‘—ä½œæ¨©è­²æ¸¡ã‚’ã†ã‘ã¦ãŠã‚Šã€è‡ªã‚‰ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚)\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eApp Mesh\u003c/li\u003e\n\u003cli\u003eECS\u003c/li\u003e\n\u003cli\u003eNLB\u003c/li\u003e\n\u003cli\u003eService Discovery\u003c/li\u003e\n\u003cli\u003eEnvoy\u003c/li\u003e\n\u003cli\u003eX-Ray\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã¨ã„ã£ãŸæŠ€è¡“è¦ç´ ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch3 id=\"terraform-ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿæ–½\"\u003eTerraform ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿæ–½\u003c/h3\u003e\n\u003cp\u003eä¸Šè¨˜ã«è¨˜ã—ãŸ Terraform ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ãŸæ§‹æˆã®ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ã‚’è¨˜ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå‰æã¨ã—ã¦ Terraform ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.0.x ç³»ä»¥ä¸Šã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ \u003cspan style=\"color:#75715e\"\u003e# AWS ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æƒ…å ±ã‚’è¨­å®š\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ git clone https://github.com/jedipunkz/tf-appmesh-ecs-canary-release\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ cd tf-appmesh-ecs-canary-release\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ terraform plan\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ terraform apply\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h3\u003e\n\u003cp\u003eæ¤œè¨¼ã§æ§‹ç¯‰ã—ãŸæ§‹æˆ(ä¸Šè¨˜ã® Terraform ã‚³ãƒ¼ãƒ‰ã§æ§‹ç¯‰ã§ãã‚‹) ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e","title":"App Mesh ã¨ ECS ã«ã‚ˆã‚‹ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹æ§‹æˆã‚’æ¤œè¨¼ã—ã¦ã¿ãŸ"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚jedipunkz ã§ã™ã€‚\nä»Šå›ã¯ READYFOR Advent Calendar 2021 ã®è¨˜äº‹ã¨ã—ã¦åŸ·ç­†ã—ã¾ã™ã€‚\nREADYFOR ã§ã¯ 2021 å¹´ã®å¤ã« AWS ECS ã¸ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç§»è¡Œã‚’ã—ã¾ã—ãŸã€‚ECS ã¯è‡ªåˆ†é”ã®è¦ä»¶ã‚’å…¨ã¦æº€ãŸã—ã¦ãã‚Œé‹ç”¨ã‚³ã‚¹ãƒˆã‚‚æ¥µå°åŒ–ã§ãã¦æ›´ã«å‘¨è¾ºã®æŠ€è¡“ã‚‚ AWS å…¬å¼ã®ã‚‚ã®ãŒæƒã£ã¦ã„ã‚‹ã®ã§ã€ã¨ã¦ã‚‚æº€è¶³ã—ã¦ã„ã‚‹çŠ¶æ³ã§ã™ã€‚\nç§»è¡Œã‚’çµ‚ãˆãŸã°ã‹ã‚Šãªã®ã§ã€Œã§ã¯æ¬¡ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ï¼Ÿã€ã¨ã„ã†è©±ã«ã¯ã¾ã ãªã£ã¦ã„ãªã„ã®ã§ã™ãŒã€ä»Šã¯æº–å‚™æœŸé–“ã¨ã—ã¦ä½™è£•ã‚’æŒã£ã¦ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã§ãã‚‹çŠ¶æ…‹ã«ã—ã¦é ‚ã„ã¦ã„ã‚‹ã®ã§ã€SRE ãƒãƒ¼ãƒ ã¨ã—ã¦ã¯è‰²ã€…ãªæŠ€è¡“ã‚’ãƒªã‚µãƒ¼ãƒã—ã¦ã„ã‚‹æ®µéšã«ãªã‚Šã¾ã™ã€‚\nä»Šç¾åœ¨ã¯ ECS + CodeDeploy ã‚’ä½¿ã£ã¦ Blue/Green ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’å®Ÿç¾ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã‚ˆã‚Šãƒ¢ãƒ€ãƒ³ãªãƒ‡ãƒ—ãƒ­ã‚¤æ–¹å¼ Progressive Delivery ã«ã¤ã„ã¦å»å¹´ã‚ãŸã‚Šã‹ã‚‰èˆˆå‘³ã‚’æŒã£ã¦ã„ã¾ã—ãŸã€‚ãŸã ã€ä»Šã¾ã§ã¯å®Ÿéš›ã«æŠ€è¡“ã‚’è§¦ã‚‹ã¾ã§ã«ã¯è‡³ã£ã¦ã„ãªã‹ã£ãŸã®ã§ã“ã®æ©Ÿä¼šã«è‰²ã€…ã¨è§¦ã£ã¦ã¿ãŸã¨ã„ã†æ¬¡ç¬¬ã§ã™ã€‚\nä»Šã¾ã§ã‚‚ Blue/Green ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ, Canary ãƒªãƒªãƒ¼ã‚¹ã¨ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹å¼ãŒè¤‡æ•°ã‚ã‚Šã¾ã—ãŸãŒã€ã“ã‚Œã‚‰ã‚’å«ã‚€ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªã®æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨è¨€ã‚ã‚Œã¦ã„ã‚‹ã®ãŒ Progressive Delivery ã§ã™ã€‚2020å¹´ã« Hashicorp ç¤¾ã® Mitchell Hashimoto æ° ãŒæ¥æ—¥ã—ãŸéš›ã«ã€Œä»Šä¸€ç•ªæ°—ã«ãªã£ã¦ã„ã‚‹ãƒ¯ãƒ¼ãƒ‰ã€ã¨ã—ã¦ã‚ã’ã¦ã„ã¾ã—ãŸã®ãŒå°è±¡çš„ã§ã—ãŸã€‚\nECS ã‚’ä½¿ã£ãŸ Canary ãƒªãƒªãƒ¼ã‚¹ Progressive Delivery ã®è©±ã‚’ã™ã‚‹å‰ã« ECS ã‚’ä½¿ã£ãŸ Canary ãƒªãƒªãƒ¼ã‚¹ã«ã¤ã„ã¦å°‘ã—è§¦ã‚Œã¦ãŠãã¾ã™ã€‚ (å…·ä½“çš„ãªè©±ã«ã¤ã„ã¦ã‚‚ã€ã©ã“ã‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¨˜äº‹ã«ã§ãã‚Œã°ã¨æ€ã£ã¦ã„ã¾ã™)\nAWS App Mesh ã¨ ECS, X-Ray ã‚’ä½¿ã£ã¦ä¸‹è¨˜ã®ã‚ˆã†ãªæ§‹æˆã‚’ä½œã‚Šã¾ã—ãŸã€‚ã“ã®æ§‹æˆä¸­ã® App Mesh ã® Virtual Router ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±ã‚’ä¿®æ­£ã™ã‚‹å½¢ã§ Canary ãƒªãƒªãƒ¼ã‚¹ã®ãƒˆãƒ©ãƒ’ãƒƒã‚¯æ“ä½œãŒè¡Œãˆã¾ã™ã€‚ECS ä»¥å‰ã¯ Canary ãƒªãƒªãƒ¼ã‚¹ã‚’å®Ÿç¾ã§ãã¦ã„ã¦ ECS å°å…¥ã«ã‚ˆã£ã¦ãã‚ŒãŒãƒ‡ã‚°ãƒ¬ã—ãŸçŠ¶æ…‹ã ã£ãŸã®ã§ã€ã“ã®æ§‹æˆã®æ¤œè¨¼ã¯ä¸€ã¤ã®æˆæœã ã£ãŸã¨æ€ã£ã¦ã„ã¾ã™ã—ã€ä»Šå›è©±ã‚’ã™ã‚‹ Progressive Delivery ã®ã²ã¨ã¤å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã‚‚è€ƒãˆã¦ã„ã¾ã™ã€‚\n+----------------+ +----------------+ +---------------+ App Mesh | VirtualGateway | -\u0026gt; | VirtualService | -\u0026gt; | VirtualRouter | +----------------+ +----------------+ +---------------+ | | +--------+ +-----+ +-----------+-----------+ +---------------+ +---------------------+ | client | -\u0026gt; | NLB | -\u0026gt; | Envoy Gateway | X-Ray | | VirtualNode | -\u0026gt; | App | Envoy | X-ray | +--------+ +-----+ +-----------------------+ +---------------+ +---------------------+ | ECS | | | ECS | +-----------------------+ | +---------------------+ | +---------------+ +---------------------+ | VirtualNode | -\u0026gt; | App | Envoy | X-ray | +---------------+ +---------------------+ | ECS | +---------------------+ Progressive Delivery ã®åŸºæœ¬çš„ãªè€ƒãˆæ–¹ ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªã¯ä¸‹è¨˜ã®æ§˜ãªæµã‚Œã§ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿæ–½ã—ã¦ã„ã¾ã—ãŸãŒã€\n+---------+ +-------+ +------+ +--------+ | Develop | -\u0026gt; | Build | -\u0026gt; | Test | -\u0026gt; | Deploy | +---------+ +-------+ +------+ +--------+ Progressive Delivery ã§ã¯ä¸‹è¨˜ã®æ§˜ã«ãªã‚Šã¾ã™ã€‚ (ref: https://static.sched.com/hosted_files/kccncna19/f2/Progressive%20Delivery%20%26%20Argo%20Rollouts.pdf)\n+---------+ +---------+ +--------+ | Develop | -\u0026gt; | Build | -\u0026gt; | Test | +---------+ +---------+ +--------+ | +---------+ +--------+ | Analyze | \u0026lt;- | Deploy | +---------+ +--------+ | | +---------+ +---------+ +--------+ | Rollback| \u0026lt;- | Success?| -\u0026gt; |Progress| +---------+ +---------+ +--------+ No Yes ã¤ã¾ã‚Šã€Canaly ãƒªãƒªãƒ¼ã‚¹ã‚’ãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹å ´åˆã€\nç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªã¨åŒæ§˜ã«ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿæ–½ å¾ã€…ã«ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã‚’ Canary ç’°å¢ƒã¸å¯„ã›ã‚‹ Canary ç’°å¢ƒã« SLO ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸãƒ†ã‚¹ãƒˆ/ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å…ƒã«ã—ãŸã‚¯ã‚¨ãƒªå®Ÿè¡Œã‚’å®Ÿæ–½ ãã®çµæœã€é–¾å€¤ã‚’ä¸‹å›ã‚‹å ´åˆã¯ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿæ–½ é€†ã«ä¸‹å›ã‚‰ãªã„å ´åˆã¯ãƒˆãƒ©ãƒ’ãƒƒã‚¯æ“ä½œã‚’ç¶™ç¶šã—ã¦ã€ãƒ‡ãƒ—ãƒ­ã‚¤ç¶™ç¶š ã¨ã„ã†æµã‚Œãªã‚Šã¾ã™ã€‚ã“ã® Analyze (Analysis) ã¨ã„ã†ã‚¹ãƒ†ãƒƒãƒ—ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã®ã¨ã€ãã®çµæœè‡ªå‹•çš„ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã›ã‚‹ç‚¹ãŒä»Šã¾ã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹å¼ã¨ç•°ãªã‚‹ç‚¹ã§ã™ã€‚\nå®Ÿéš›ã«èª¿æŸ»ã—ãŸæŠ€è¡“ãŸã¡ å®ŸæŸ»ã«å‹•ã‹ã—ã¦ã¿ãŸã‚Šã€ã¾ãŸã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã§èª¿æŸ»ã—ãŸæŠ€è¡“ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚\nArogCD Rollouts Flagger PipeCD ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰ãƒ»ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œ ã¾ãš ArgoCD Rollouts ã¨ Flagger ã¯ Kubernetes ãŒå‰æã«ãªã‚Šã¾ã™ã€‚ãã®ç‚¹ã§ PipeCD ã¯ AWS ECS ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚ãŒã‚‚ã¡ã‚ã‚“ Kubernetes ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚ã¡ãªã¿ã« PipeCD ã¯æ—¥æœ¬å›½å†…ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ–¹ã€…ãŒé–‹ç™ºã«æºã‚ã£ã¦ã„ã¾ã™ã€‚å›½å†…åˆ OSS ã¨ã—ã¦ä¸–ç•Œã«åºƒã¾ã‚Œã°ã„ã„ãªã¨å€‹äººçš„ã«è€ƒãˆã¦ã„ã¾ã™ã€‚\nãƒãƒ«ãƒ Analysis ãƒ—ãƒ­ãƒã‚¤ãƒ€å¯¾å¿œ Analysis ã§ãƒ†ã‚¹ãƒˆãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã¨ãã‚Œã‚’å…ƒã«ã—ãŸã‚¯ã‚¨ãƒªã‚’ç™ºè¡Œã™ã‚‹ã€ã¨ä¸Šè¨˜ã«è¨˜ã—ã¾ã—ãŸãŒã€ãã®å–å¾—æ–¹æ³•ã‚„åˆ©ç”¨ã§ãã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ or ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢ã—ã¦ã‚‚ãã‚Œãã‚Œè¤‡æ•°å¯¾å¿œã—ã¦ã„ã‚‹æ§˜ã§ã™ã€‚ä»£è¡¨çš„ãªã‚‚ã®ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚\nPrometheus Datadog AWS Cloudwatch New Relic Graphite Google Stackdriver InfluxDB etc\u0026hellip; å®ŸæŸ»ã« Analysis ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¦ã¿ã‚‹ å®Ÿéš›ã« Analysis ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¦ç†è§£ã‚’æ·±ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚ä¸‹è¨˜ã¯ ArogCD Rollouts ã® Prometheus ã® Analysis ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚\napiVersion: argoproj.io/v1alpha1 kind: AnalysisTemplate metadata: name: success-rate spec: args: - name: service-name metrics: - name: success-rate interval: 5m successCondition: result[0] \u0026gt;= 0.95 failureLimit: 3 provider: prometheus: address: http://prometheus.example.com:9090 query: | sum(irate( istio_requests_total{reporter=\u0026#34;source\u0026#34;,destination_service=~\u0026#34;{{args.service-name}}\u0026#34;,response_code!~\u0026#34;5.*\u0026#34;}[5m] )) / sum(irate( istio_requests_total{reporter=\u0026#34;source\u0026#34;,destination_service=~\u0026#34;{{args.service-name}}\u0026#34;}[5m] )) Analysis ã«é–¢ã‚ã‚‹ Kubernetes CRD ã§ã‚ã‚‹ã¨è¦‹ã¦ã‚ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚ä¸‹è¨˜ã«ã“ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æ„å‘³ã‚’è¨˜ã—ã¾ã™ã€‚\ninterval ã§ã‚¯ã‚¨ãƒªã‚’ç™ºè¡Œã™ã‚‹é–“éš”ã‚’æŒ‡å®š successCondition ã§ã‚¯ã‚¨ãƒªçµæœã®é–¾å€¤ã‚’æŒ‡å®š failtureLimit ã§æœ€å¤§å¤±æ•—è¨±å¯æ•°ã‚’æŒ‡å®š provider.prometheus ã§ Prometheus ãƒ—ãƒ­ãƒã‚¤ãƒ€åˆ©ç”¨ã‚’å®£è¨€ address ã§ Prometheus Server ã® URL ã‚’æŒ‡å®š query ã§ Prometheus Server ä¸Šã§å®Ÿè¡Œã™ã‚‹ã‚¯ã‚¨ãƒªã‚’æŒ‡å®š ã‚ˆã£ã¦ã€å‰è¿°ã—ãŸ SLO ã¨ã„ã†ã®ãŒã“ã®ã‚¯ã‚¨ãƒªã«ç›¸å½“ã™ã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚SLO ã‚’ã‚¯ã‚¨ãƒªãƒ™ãƒ¼ã‚¹ã§å®šç¾©ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€SLO ã«å³ã•ãªã„å ´åˆã¯è‡ªå‹•çš„ã«å¤ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ã€ã¨ã„ã†ä»•çµ„ã¿ã§ã™ã€‚\nãŸã ã”å­˜çŸ¥ã®ã‚ˆã†ã« SLO ã¯ã“ã®ã‚ˆã†ãªãƒ‡ãƒ—ãƒ­ã‚¤ã®çŸ­ã„æœŸé–“ã§ã®è¨ˆæ¸¬ã«æŒ‡å®šã™ã‚‹ã“ã¨ãŒé©ã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿã¨ã„ã†è©±ã¯ã‚ã‚‹ã¨æ€ã£ã¦ã„ã¦ã€ã‚ãã¾ã§ã‚‚ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å‰æã¨ã—ãŸ SLO ã¨ã„ã†æ„å‘³ã§å®šç¾©ã™ã‚‹ã¹ããªã®ã§ã¯ã€ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚\nã¾ã¨ã‚ ECS ç§»è¡Œã‚’çµ‚ãˆã¦æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’æ¤œè¨ã™ã‚‹ã«ã‚ãŸã£ã¦ Progressive Delivery ã‚’è€ƒãˆã‚‹ã®ã¯ç€çœ¼ç‚¹ã¨ã—ã¦ã¯è‰¯ã„ã¨å€‹äººçš„ã«ã¯è€ƒãˆã¦ã„ã¾ã™ã€‚ãŒ ECS ã‚’é¸æŠã—ãŸã“ã¨ã«ã‚ˆã£ã¦ã€Progressive Delivery ã‚’å®Ÿè·µã™ã‚‹ãŸã‚ã®æŠ€è¡“ã®é¸æŠè‚¢ãŒç‹­ã¾ã£ãŸã®ã¯äº‹å®Ÿã§ã€ECS ä»¥å¾Œã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¤œè¨ã™ã‚‹éš›ã«ã“ã®ç‚¹ã¯ãƒãƒƒã‚¯ã«ãªã‚Šãã†ã€ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚2021å¹´12æœˆæ™‚ç‚¹ã§ã¯ PipeCD ä»¥å¤–ã«ãã‚Œã‚’å®Ÿç¾ã™ã‚‹æŠ€è¡“ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nã¾ãŸã€Canary ãƒªãƒªãƒ¼ã‚¹ã«å¯¾ã—ã¦ Analisys ã¨ãã®çµæœã®è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã„ã†è¦ç´ ã•ãˆè¿½åŠ ã§ãã‚Œã°ã€Progressive Delivery ãŒå®Ÿç¾ã§ãã‚‹ã®ã‚‚äº‹å®Ÿã§ã™ã€‚å‰è¿°ã—ãŸã‚ˆã†ã« App Mesh ã¨ ECS ã«ã‚ˆã£ã¦ Canary ãƒªãƒªãƒ¼ã‚¹ã¯å®Ÿç¾ã§ãã¦ã„ã‚‹ã®ã§ã€Analisys ã¨ è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿç¾ã™ã‚‹ä»•çµ„ã¿ã‚’è‡ªç¤¾ã§ Lambda ãªã©ã‚’ä½¿ã£ã¦é–‹ç™ºã§ãã‚Œã°è‰¯ã„ã®ã§ã¯ã¨è€ƒãˆå§‹ã‚ã¦ã„ã¾ã™ã€‚ã§ã™ãŒã€ã‚‚ã¡ã‚ã‚“æ±ç”¨æ€§ãŒãªã„ã§ã™ã—é‹ç”¨ãƒ»ä¿å®ˆã®ã‚³ã‚¹ãƒˆã‚’ã‹ã‘ã¦ã¾ã§å®Ÿè·µã™ã‚‹ã®ã‹ã€ã¨ã„ã†å•é¡Œã¯ã‚ã‚Šãã†ã§ã™ã€‚\nã¨ã„ã†ã“ã¨ã§ Progressive Delivery ã‚’ãƒã‚¤ãƒ³ãƒˆã«ã—ãŸæ¬¡æœŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦ã€ä»Šè€ƒãˆã¦ã„ã‚‹ã“ã¨ã‚’è¨˜ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/progressive_delivery/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003ejedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ \u003ca href=\"https://qiita.com/advent-calendar/2021/readyfor\"\u003eREADYFOR Advent Calendar 2021\u003c/a\u003e ã®è¨˜äº‹ã¨ã—ã¦åŸ·ç­†ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eREADYFOR ã§ã¯ 2021 å¹´ã®å¤ã« AWS ECS ã¸ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç§»è¡Œã‚’ã—ã¾ã—ãŸã€‚ECS ã¯è‡ªåˆ†é”ã®è¦ä»¶ã‚’å…¨ã¦æº€ãŸã—ã¦ãã‚Œé‹ç”¨ã‚³ã‚¹ãƒˆã‚‚æ¥µå°åŒ–ã§ãã¦æ›´ã«å‘¨è¾ºã®æŠ€è¡“ã‚‚ AWS å…¬å¼ã®ã‚‚ã®ãŒæƒã£ã¦ã„ã‚‹ã®ã§ã€ã¨ã¦ã‚‚æº€è¶³ã—ã¦ã„ã‚‹çŠ¶æ³ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eç§»è¡Œã‚’çµ‚ãˆãŸã°ã‹ã‚Šãªã®ã§ã€Œã§ã¯æ¬¡ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ï¼Ÿã€ã¨ã„ã†è©±ã«ã¯ã¾ã ãªã£ã¦ã„ãªã„ã®ã§ã™ãŒã€ä»Šã¯æº–å‚™æœŸé–“ã¨ã—ã¦ä½™è£•ã‚’æŒã£ã¦ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã§ãã‚‹çŠ¶æ…‹ã«ã—ã¦é ‚ã„ã¦ã„ã‚‹ã®ã§ã€SRE ãƒãƒ¼ãƒ ã¨ã—ã¦ã¯è‰²ã€…ãªæŠ€è¡“ã‚’ãƒªã‚µãƒ¼ãƒã—ã¦ã„ã‚‹æ®µéšã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šç¾åœ¨ã¯ ECS + CodeDeploy ã‚’ä½¿ã£ã¦ Blue/Green ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’å®Ÿç¾ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã‚ˆã‚Šãƒ¢ãƒ€ãƒ³ãªãƒ‡ãƒ—ãƒ­ã‚¤æ–¹å¼ Progressive Delivery ã«ã¤ã„ã¦å»å¹´ã‚ãŸã‚Šã‹ã‚‰èˆˆå‘³ã‚’æŒã£ã¦ã„ã¾ã—ãŸã€‚ãŸã ã€ä»Šã¾ã§ã¯å®Ÿéš›ã«æŠ€è¡“ã‚’è§¦ã‚‹ã¾ã§ã«ã¯è‡³ã£ã¦ã„ãªã‹ã£ãŸã®ã§ã“ã®æ©Ÿä¼šã«è‰²ã€…ã¨è§¦ã£ã¦ã¿ãŸã¨ã„ã†æ¬¡ç¬¬ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šã¾ã§ã‚‚ Blue/Green ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ, Canary ãƒªãƒªãƒ¼ã‚¹ã¨ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹å¼ãŒè¤‡æ•°ã‚ã‚Šã¾ã—ãŸãŒã€ã“ã‚Œã‚‰ã‚’å«ã‚€ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªã®æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨è¨€ã‚ã‚Œã¦ã„ã‚‹ã®ãŒ Progressive Delivery ã§ã™ã€‚2020å¹´ã« Hashicorp ç¤¾ã® \u003ca href=\"https://twitter.com/mitchellh\"\u003eMitchell Hashimoto æ°\u003c/a\u003e ãŒæ¥æ—¥ã—ãŸéš›ã«ã€Œä»Šä¸€ç•ªæ°—ã«ãªã£ã¦ã„ã‚‹ãƒ¯ãƒ¼ãƒ‰ã€ã¨ã—ã¦ã‚ã’ã¦ã„ã¾ã—ãŸã®ãŒå°è±¡çš„ã§ã—ãŸã€‚\u003c/p\u003e\n\u003ch2 id=\"ecs-ã‚’ä½¿ã£ãŸ-canary-ãƒªãƒªãƒ¼ã‚¹\"\u003eECS ã‚’ä½¿ã£ãŸ Canary ãƒªãƒªãƒ¼ã‚¹\u003c/h2\u003e\n\u003cp\u003eProgressive Delivery ã®è©±ã‚’ã™ã‚‹å‰ã« ECS ã‚’ä½¿ã£ãŸ Canary ãƒªãƒªãƒ¼ã‚¹ã«ã¤ã„ã¦å°‘ã—è§¦ã‚Œã¦ãŠãã¾ã™ã€‚\n(å…·ä½“çš„ãªè©±ã«ã¤ã„ã¦ã‚‚ã€ã©ã“ã‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¨˜äº‹ã«ã§ãã‚Œã°ã¨æ€ã£ã¦ã„ã¾ã™)\u003c/p\u003e\n\u003cp\u003eAWS App Mesh ã¨ ECS, X-Ray ã‚’ä½¿ã£ã¦ä¸‹è¨˜ã®ã‚ˆã†ãªæ§‹æˆã‚’ä½œã‚Šã¾ã—ãŸã€‚ã“ã®æ§‹æˆä¸­ã® App Mesh ã® Virtual Router ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±ã‚’ä¿®æ­£ã™ã‚‹å½¢ã§ Canary ãƒªãƒªãƒ¼ã‚¹ã®ãƒˆãƒ©ãƒ’ãƒƒã‚¯æ“ä½œãŒè¡Œãˆã¾ã™ã€‚ECS ä»¥å‰ã¯ Canary ãƒªãƒªãƒ¼ã‚¹ã‚’å®Ÿç¾ã§ãã¦ã„ã¦ ECS å°å…¥ã«ã‚ˆã£ã¦ãã‚ŒãŒãƒ‡ã‚°ãƒ¬ã—ãŸçŠ¶æ…‹ã ã£ãŸã®ã§ã€ã“ã®æ§‹æˆã®æ¤œè¨¼ã¯ä¸€ã¤ã®æˆæœã ã£ãŸã¨æ€ã£ã¦ã„ã¾ã™ã—ã€ä»Šå›è©±ã‚’ã™ã‚‹ Progressive Delivery ã®ã²ã¨ã¤å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã‚‚è€ƒãˆã¦ã„ã¾ã™ã€‚\u003c/p\u003e","title":"ECS ä»¥å¾Œã®æ§‹æˆã¨ Progressive Delivery ã®èª¿æŸ»"},{"content":"ã“ã‚“ã«ã¡ã¯ @jedipunkz ğŸš€ ã§ã™ã€‚\næœ€è¿‘ã€è·å ´ã§ã¯ ECS/Fargate ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’é‹ç”¨ã—ã¦ã„ã¾ã™ã€‚ãã“ã§ ECS Task ä¸Šã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ã«è¿«ã‚‰ã‚Œã¦å¹¾ã¤ã‹èª¿ã¹ãŸã®ã§ã™ãŒã€è¤‡æ•°ã®æ–¹æ³•ãŒã‚ã‚Šæ¤œè¨¼ã‚’ã—ã¦ã¿ã¾ã—ãŸã€‚ã“ã‚Œã«ã¯ 2021/03 ã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã°ã‹ã‚Šã® ECS ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\nè‡ªåˆ†ãŸã¡ã¯è‡ªå‹•åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã®ã§ Go è¨€èª (aws-sdk-go) ã‚’ä¸­å¿ƒã«æ¤œè¨¼å®Ÿæ–½ã—ã¾ã—ãŸãŒåŒæ™‚ã« awscli ã§ã‚‚å‹•ä½œæ¤œè¨¼ã—ã¾ã—ãŸã®ã§ã€ãã®æ–¹æ³•ã‚’ã“ã®è¨˜äº‹ã«è¨˜ãã†ã‹ã¨æ€ã„ã¾ã™ã€‚\nä¸‹è¨˜ã®2ã¤ã® ECS ã®æ©Ÿèƒ½ã«ã¤ã„ã¦ãã‚Œãã‚Œ Go è¨€èª, awscli ã§å‹•ä½œæ¤œè¨¼å®Ÿæ–½ã—ã¾ã—ãŸã€‚\n(1) ECS Execute Command (2021/03 ãƒªãƒªãƒ¼ã‚¹) (2) ECS Run Task ç”¨ã„ã‚‹ãƒ„ãƒ¼ãƒ«é¡ ä¸‹è¨˜ã®ãƒ„ãƒ¼ãƒ«ã‚’å‰æã«è¨˜äº‹ã‚’è¨˜ã—ã¾ã™ã€‚\naws-sdk-go Terraform awscli å…±é€šã§å¿…è¦ãª taskRoleArn ã¾ãš Task Definition ã«å¯¾ã—ã¦ executeRoleArn ã¨ã¯åˆ¥ã« TaskRoleArn ã®ä»˜ä¸ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚\nresource \u0026#34;aws_ecs_task_definition\u0026#34; \u0026#34;sample\u0026#34; { family = \u0026#34;sample\u0026#34; cpu = \u0026#34;256\u0026#34; memory = \u0026#34;512\u0026#34; network_mode = \u0026#34;awsvpc\u0026#34; requires_compatibilities = [\u0026#34;FARGATE\u0026#34;] execution_role_arn = module.ecs_task_execution_role.iam_role_arn task_role_arn = module.ecs_task__role.iam_role_arn container_definitions = data.template_file.container_definition_sample.rendered } taksRoleArn ã®å†…å®¹ã«ã¤ã„ã¦ã¯ https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/task-iam-roles.html ã«æƒ…å ±ãŒã‚ã‚Šã€ä¸‹è¨˜ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Sid\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;Service\u0026#34;: \u0026#34;ecs-tasks.amazonaws.com\u0026#34; }, \u0026#34;Action\u0026#34;: \u0026#34;sts:AssumeRole\u0026#34; } ] } ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ (1) ECS Exuecute Command (2021/03 ãƒªãƒªãƒ¼ã‚¹) ã¾ãšæœ€è¿‘ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸ ECS ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã«ã¤ã„ã¦è©¦ã—ã¾ã™ã€‚Terraform ã‚„ãã®ä»–ã®å‘¨è¾ºã®æŠ€è¡“ (aws å…¬å¼ GitHub Actions ç­‰ã‚‚)ã€ã“ã®æ©Ÿèƒ½ã«ã¯ã¾ã å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚ awscli (v1, v2), session-manager, aws-sdk-go ç­‰ãŒæ—¢ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚ã“ã“ã§ã¯ awscli, aws-sdk-go ã‚’ä½¿ã£ã¦ã“ã®æ©Ÿèƒ½ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚\n(2021/04/21 è¿½è¨˜) ä¸‹è¨˜ã®é€šã‚Š Terraform ã‚‚ aws å…¬å¼ GitHub Actions ã‚‚æ—¢ã«å¯¾å¿œã•ã‚Œã¦ã„ã¾ã—ãŸã€‚\nTerraform Execute Command å¯¾å¿œ aws å…¬å¼ ECS Task Definition Render GitHub Actions awscli, session-manager, aws-sdk-go ã¯æ¯”è¼ƒçš„æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’äº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nã¾ãš taskExecute IAM Role ã«ä¸‹è¨˜ã®æ¨©é™ãŒè¿½åŠ ã§å¿…è¦ã§ã™ã€‚\nstatement { effect = \u0026#34;Allow\u0026#34; actions = [ \u0026#34;ssmmessages:CreateControlChannel\u0026#34;, \u0026#34;ssmmessages:CreateDataChannel\u0026#34;, \u0026#34;ssmmessages:OpenControlChannel\u0026#34;, \u0026#34;ssmmessages:OpenDataChannel\u0026#34; ] resources = [\u0026#34;*\u0026#34;] } ECS Service ã«å¯¾ã—ã¦ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã®æœ‰åŠ¹åŒ–ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚\n$ aws ecs update-service \\ --cluster \u0026lt;ClusterArn\u0026gt; \\ --service \u0026lt;ServiceName\u0026gt; \\ --task \u0026lt;TaskName\u0026gt; \\ --enable-execute-command #\u0026lt;--- æœ‰åŠ¹åŒ– æ¬¡ã« --enable-execute-command ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸ã—ã¦ Task ã‚’èµ·å‹•ã—ã¾ã™ã€‚\n$ aws ecs run-task --cluster \u0026lt;ClusterArn\u0026gt; \\ --task-definition \u0026lt;TaskDefinition:Revision\u0026gt; \\ --network-configuration \u0026#34;awsvpcConfiguration={subnets=[\u0026#34;Subnet_ID1\u0026#34;, \u0026#34;Subnet_ID2\u0026#34;],securityGroups=[\u0026#34;SecurityGroupId\u0026#34;],assignPublicIp=DISABLED}\u0026#34; \\ --launch-type FARGATE --enable-execute-command æº–å‚™ãŒæ•´ã£ãŸã®ã§ã€ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚\naws ecs execute-command --cluster \u0026lt;ClusterArn\u0026gt; \\ --task \u0026lt;TaskId\u0026gt; --container \u0026lt;ContainerName\u0026gt; \\ --interactive --command \u0026#34;ps ax\u0026#34; The Session Manager plugin was installed successfully. Use the AWS CLI to start a session. Starting session with SessionId: ecs-execute-command-0b2c79e1e775f274c PID USER TIME COMMAND 1 root 0:00 /bin/sh -c nginx -g \u0026#34;daemon off;\u0026#34; 7 root 0:00 nginx: master process nginx -g daemon off; 8 nginx 0:00 nginx: worker process 9 nginx 0:00 nginx: worker process 10 root 0:00 /managed-agents/execute-command/amazon-ssm-agent 23 root 0:00 /managed-agents/execute-command/ssm-agent-worker 72 root 0:00 /managed-agents/execute-command/ssm-session-worker ecs-ex 80 root 0:00 ps ax Exiting session with sessionId: ecs-execute-command-0b2c79e1e775f274c. ä¸Šè¨˜ã®é€šã‚Šã€ã‚³ãƒãƒ³ãƒ‰ ps ax ã®çµæœãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚\næ¬¡ã« aws-sdk-go ã‚’ä½¿ã£ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/aws/aws-sdk-go/aws\u0026#34; \u0026#34;github.com/aws/aws-sdk-go/aws/awserr\u0026#34; \u0026#34;github.com/aws/aws-sdk-go/aws/session\u0026#34; \u0026#34;github.com/aws/aws-sdk-go/service/ecs\u0026#34; ) func main() { svc := ecs.New(session.New(aws.NewConfig().WithRegion(\u0026#34;ap-northeast-1\u0026#34;))) input := \u0026amp;ecs.ExecuteCommandInput{ Cluster: aws.String(\u0026#34;\u0026lt;ClusterName\u0026gt;\u0026#34;), Command: aws.String(\u0026#34;ps aux\u0026#34;), Container: aws.String(\u0026#34;\u0026lt;ContainerName\u0026gt;\u0026#34;), Interactive: aws.Bool(true), Task: aws.String(\u0026#34;\u0026lt;TaskId\u0026gt;\u0026#34;), } result, err := svc.ExecuteCommand(input) if err != nil { if aerr, ok := err.(awserr.Error); ok { fmt.Println(aerr.Error()) } fmt.Println(err.Error()) return } fmt.Println(result) } ã“ã‚Œã‚’ãƒ“ãƒ«ãƒ‰ã—ã€å®Ÿè¡Œã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã§çµæœãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚(å‚è€ƒ: https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_ExecuteCommand.html)\n{ \u0026#34;clusterArn\u0026#34;: \u0026#34;string\u0026#34;, \u0026#34;containerArn\u0026#34;: \u0026#34;string\u0026#34;, \u0026#34;containerName\u0026#34;: \u0026#34;string\u0026#34;, \u0026#34;interactive\u0026#34;: boolean, \u0026#34;session\u0026#34;: { \u0026#34;sessionId\u0026#34;: \u0026#34;string\u0026#34;, \u0026#34;streamUrl\u0026#34;: \u0026#34;string\u0026#34;, \u0026#34;tokenValue\u0026#34;: \u0026#34;string\u0026#34; }, \u0026#34;taskArn\u0026#34;: \u0026#34;string\u0026#34;: } æ®‹å¿µãªãŒã‚‰ã‚³ãƒãƒ³ãƒ‰çµæœã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã¯å…¥ã£ã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚ãŒã€ã‚³ãƒãƒ³ãƒ‰ã¯æ­£å¸¸ã‚’æ­£å¸¸ã«å©ã„ãŸã‹ã® API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦ã¯ã‚¨ãƒ©ãƒ¼ã‚‚æ¤œçŸ¥å‡ºæ¥ã¾ã™ã€‚\nâ€»[2021/04/14] aws ã® Tori ã•ã‚“ã‹ã‚‰æŒ‡æ‘˜é ‚ãã¾ã—ãŸã€‚API ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’åˆ©ç”¨ã—ã¦ session-manager-plugin ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã§ãã‚‹ãã†ã§ã™ï¼\n(2) ECS Run Task ã«ã‚ˆã‚‹ã‚³ãƒãƒ³ãƒ‰ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ æ¬¡ã« ECS Run Task ã«ã‚ˆã‚‹ã‚³ãƒãƒ³ãƒ‰ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã«ã¤ã„ã¦è¨˜ã—ã¾ã™ã€‚ã“ã¡ã‚‰ã¯ä»¥å‰ã‹ã‚‰ã‚ã‚‹æ©Ÿèƒ½ãªã®ã§ã»ã¼ã™ã¹ã¦ã®å‘¨è¾ºãƒ„ãƒ¼ãƒ«ãŒå¯¾å¿œã—ã¦ã„ã‚‹èªè­˜ã§ã™ã€‚ã¾ãš awscli ã§å‹•ä½œç¢ºèªã—ã¦ã¿ã¾ã™ã€‚\nä¸‹è¨˜ã® json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ã‚¿ã‚¹ã‚¯å®šç¾©ã«è¨˜ã—ã¦ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠåã¨ã€ã‚³ãƒãƒ³ãƒ‰ã‚’è¨˜ã—ã¾ã™ã€‚\n{ \u0026#34;containerOverrides\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;\u0026lt;ContainerName\u0026gt;\u0026#34;, \u0026#34;command\u0026#34;: [ \u0026#34;\u0026lt;Command\u0026gt;\u0026#34; ] } ] } awscli ã‚’ç”¨ã„ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’ Overrides ã—ã¤ã¤ Run Task å®Ÿè¡Œã—ã¾ã™ã€‚\naws ecs run-task --cluster \u0026lt;ClusterArn\u0026gt; \\ --task-definition \u0026lt;TaskDefinition:Revision\u0026gt; \\ --network-configuration \u0026#34;awsvpcConfiguration={subnets=[\u0026#34;\u0026lt;SubnetId1\u0026gt;\u0026#34;, \u0026#34;\u0026lt;SubnetId2\u0026gt;\u0026#34;],securityGroups=[\u0026#34;SecurityGroupId\u0026#34;],assignPublicIp=DISABLED}\u0026#34; \\ --launch-type FARGATE \\ --overrides file://\u0026lt;ä½œæˆã—ãŸ json ãƒ•ã‚¡ã‚¤ãƒ«\u0026gt;.json çµæœã¯ API ã‹ã‚‰ã®å¿œç­”å†…å®¹ã ã‘ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚¿ã‚¹ã‚¯å®šç¾©ã§ logConfiguration ã‚’è¨˜ã—ã¦ã„ã‚‹ã¨ã€ãã“ã«ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡ŒçµæœãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚\nã§ã¯ã¤ãã« aws-sdk-go ã‚’ä½¿ã£ã¦ Run Task ã—ã¦ã¿ã¾ã™ã€‚ä¸‹è¨˜ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’è¨˜ã—ã¾ã™ã€‚ç’°å¢ƒæƒ…å ±ã¯é©å®œå·®ã—æ›¿ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/aws/aws-sdk-go/aws\u0026#34; \u0026#34;github.com/aws/aws-sdk-go/aws/awserr\u0026#34; \u0026#34;github.com/aws/aws-sdk-go/aws/session\u0026#34; \u0026#34;github.com/aws/aws-sdk-go/service/ecs\u0026#34; ) func main() { // svc := ecs.New(session.New(aws.NewConfig().WithRegion(\u0026#34;ap-northeast-1\u0026#34;))) sess := session.Must(session.NewSessionWithOptions(session.Options{ Config: aws.Config{ CredentialsChainVerboseErrors: aws.Bool(true), }, })) svc := ecs.New(sess) input := \u0026amp;ecs.RunTaskInput{ Cluster: aws.String(\u0026#34;\u0026lt;ClusterArn\u0026gt;), TaskDefinition: aws.String(\u0026#34;\u0026lt;TaskDefinition:Revision\u0026gt;), Overrides: \u0026amp;ecs.TaskOverride{ ContainerOverrides: []*ecs.ContainerOverride{ { Name: aws.String(\u0026#34;\u0026lt;ContainerName\u0026gt;\u0026#34;), Command: aws.StringSlice([]string{\u0026#34;\u0026lt;å®Ÿè¡Œã—ãŸã„ã‚³ãƒãƒ³ãƒ‰ã‚’è¨˜ã™\u0026gt;\u0026#34;}), }, }, }, NetworkConfiguration: \u0026amp;ecs.NetworkConfiguration{ AwsvpcConfiguration: \u0026amp;ecs.AwsVpcConfiguration{ Subnets: aws.StringSlice([]string{\u0026#34;\u0026lt;SubnetId1\u0026gt;\u0026#34;, \u0026#34;\u0026lt;SubnetId2\u0026gt;\u0026#34;}), // ã‚µãƒ–ãƒãƒƒãƒˆID AssignPublicIp: aws.String(\u0026#34;DISABLED\u0026#34;), // å¿…è¦ã«å¿œã˜ã¦ }, }, LaunchType: aws.String(\u0026#34;FARGATE\u0026#34;), } result, err := svc.RunTask(input) if err != nil { if aerr, ok := err.(awserr.Error); ok { switch aerr.Code() { case ecs.ErrCodeServerException: fmt.Println(ecs.ErrCodeServerException, aerr.Error()) case ecs.ErrCodeClientException: fmt.Println(ecs.ErrCodeClientException, aerr.Error()) case ecs.ErrCodeInvalidParameterException: fmt.Println(ecs.ErrCodeInvalidParameterException, aerr.Error()) case ecs.ErrCodeClusterNotFoundException: fmt.Println(ecs.ErrCodeClusterNotFoundException, aerr.Error()) case ecs.ErrCodeUnsupportedFeatureException: fmt.Println(ecs.ErrCodeUnsupportedFeatureException, aerr.Error()) case ecs.ErrCodePlatformUnknownException: fmt.Println(ecs.ErrCodePlatformUnknownException, aerr.Error()) case ecs.ErrCodePlatformTaskDefinitionIncompatibilityException: fmt.Println(ecs.ErrCodePlatformTaskDefinitionIncompatibilityException, aerr.Error()) case ecs.ErrCodeAccessDeniedException: fmt.Println(ecs.ErrCodeAccessDeniedException, aerr.Error()) case ecs.ErrCodeBlockedException: fmt.Println(ecs.ErrCodeBlockedException, aerr.Error()) default: fmt.Println(aerr.Error()) } } else { fmt.Println(err.Error()) } return } fmt.Println(result) } ãƒ“ãƒ«ãƒ‰ \u0026amp; å®Ÿè¡Œã™ã‚‹ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚ãŒã“ã¡ã‚‰ã‚‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã¯ã‚³ãƒãƒ³ãƒ‰çµæœãŒå…¥ã£ã¦ã„ãªã„ã®ã§ã€awscli ã®éš›ã¨åŒæ§˜ã«ã‚¿ã‚¹ã‚¯å®šç¾©å†…ã§ logConfiguration ã‚’æŒ‡å®šã—ã¦ãƒ­ã‚°é€ä¿¡è¨­å®šã‚’è¡Œã†ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚Cloudwatch Logs ãªã©ã‚’ä»‹ã—ã¦ã€ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚\nã¾ã¨ã‚ ãã‚Œãã‚Œã®è‰¯ã„ç‚¹ãƒ»æ‚ªã„ç‚¹ã‚’ä¸‹è¨˜ã«ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚\nCommand Exec ã®ç‰¹å¾´ Terraform, aws å…¬å¼ GitHub Actions ç­‰ãŒã¾ã å¯¾å¿œã—ã¦ã„ãªã„ awscli ã§ã¯ã‚³ãƒãƒ³ãƒ‰çµæœãŒå¾—ã‚‰ã‚Œã‚‹ãŒ aws-sdk ã‚’ç”¨ã„ã‚‹ã¨ API ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã‚³ãƒãƒ³ãƒ‰çµæœãŒå…¥ã£ã¦ãªã„ å®Ÿè¡Œã™ã‚‹éš›ã«ã¯ TaskId ã‚’æŒ‡å®šã€‚ã‚ˆã£ã¦äºˆã‚ Run Task ãªã©ã§ Task ã‚’èµ·å‹•ã•ã›ã‚‹ã®ãŒå‰æã«ãªã‚‹ ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–(å¯¾è©±çš„) ã«ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œå‡ºæ¥ã‚‹ãã† (æœªæ¤œè¨¼) Run Task ã®ç‰¹å¾´ å¤ãã‹ã‚‰ã‚ã‚‹æ©Ÿèƒ½ã§å…¬å¼ãƒ»å‘¨è¾ºã®æŠ€è¡“ãŒå¯¾å¿œæ¸ˆã¿ ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœã¯ Task å®šç¾©ã«è¨˜ã—ãŸ logConfiguration ã«è»¢é€ã™ã‚‹ã“ã¨ãŒå¯èƒ½ (Cloudwatch, Datadog ç­‰ãªã©) å®Ÿè¡Œã™ã‚‹éš›ã«ã¯ Task Defintion ã‚’æŒ‡å®šã€‚äºˆã‚ Task ãŒèµ·å‹•ã—ã¦ã„ã‚‹å¿…è¦ã¯ãªã„ã€‚ ãã‚Œãã‚Œç‰¹å¾´ãŒã‚ã‚Šã¾ã™ãŒã€Execute Command ã®æ–¹ã¯ã‚³ãƒãƒ³ãƒ‰çµæœã‚’å¾—ã‚‹æ–¹æ³•ãŒä»Šã®æ‰€ã€åˆ¥é€”ä»•çµ„ã¿ã‚’ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚ãƒ­ã‚°è»¢é€ã‚„ã€Task ã‚’åˆ¥é€”èµ·å‹•ã—ã¦ãŠãå¿…è¦ãŒç„¡ã„ç‚¹ã€ã¾ãŸã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµ‚äº†ã¨å…±ã« Task ãŒè‡ªå‹•çš„ã«çµ‚äº†ã—ã¦ãã‚Œã‚‹ç‚¹ãªã©ã€è‡ªå‹•åŒ–ã™ã‚‹ä¸Šã§ã¯ Run Task ãŒå¥½ã¾ã—ã„ãªãã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚\nä»Šå¾Œ Execute Command ãŒã©ã†å¤‰ã‚ã£ã¦ãã‚‹ã‹æœŸå¾…ã§ã™ãŒã€awscli ã‚’ä½¿ã£ã¦å˜ç´”ã«ãƒ‡ãƒãƒƒã‚°ã—ãŸã„ç­‰ã®è¦æœ›ã®æ™‚ã«ã¯é‡å®ã—ãã†ã ãªã¨æ„Ÿã˜ã¦ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/ecs-execute-command/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ \u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ğŸš€ ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€è¿‘ã€è·å ´ã§ã¯ ECS/Fargate ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’é‹ç”¨ã—ã¦ã„ã¾ã™ã€‚ãã“ã§ ECS Task ä¸Šã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ã«è¿«ã‚‰ã‚Œã¦å¹¾ã¤ã‹èª¿ã¹ãŸã®ã§ã™ãŒã€è¤‡æ•°ã®æ–¹æ³•ãŒã‚ã‚Šæ¤œè¨¼ã‚’ã—ã¦ã¿ã¾ã—ãŸã€‚ã“ã‚Œã«ã¯ 2021/03 ã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã°ã‹ã‚Šã® ECS ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eè‡ªåˆ†ãŸã¡ã¯è‡ªå‹•åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã®ã§ Go è¨€èª (aws-sdk-go) ã‚’ä¸­å¿ƒã«æ¤œè¨¼å®Ÿæ–½ã—ã¾ã—ãŸãŒåŒæ™‚ã« awscli ã§ã‚‚å‹•ä½œæ¤œè¨¼ã—ã¾ã—ãŸã®ã§ã€ãã®æ–¹æ³•ã‚’ã“ã®è¨˜äº‹ã«è¨˜ãã†ã‹ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹è¨˜ã®2ã¤ã® ECS ã®æ©Ÿèƒ½ã«ã¤ã„ã¦ãã‚Œãã‚Œ Go è¨€èª, awscli ã§å‹•ä½œæ¤œè¨¼å®Ÿæ–½ã—ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://aws.amazon.com/jp/blogs/news/new-using-amazon-ecs-exec-access-your-containers-fargate-ec2/\"\u003e(1) ECS Execute Command (2021/03 ãƒªãƒªãƒ¼ã‚¹)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.aws.amazon.com/cli/latest/reference/ecs/run-task.html\"\u003e(2) ECS Run Task\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ç”¨ã„ã‚‹ãƒ„ãƒ¼ãƒ«é¡\"\u003eç”¨ã„ã‚‹ãƒ„ãƒ¼ãƒ«é¡\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®ãƒ„ãƒ¼ãƒ«ã‚’å‰æã«è¨˜äº‹ã‚’è¨˜ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/ecs/\"\u003eaws-sdk-go\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.terraform.io/\"\u003eTerraform\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://aws.amazon.com/jp/cli/\"\u003eawscli\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å…±é€šã§å¿…è¦ãª-taskrolearn\"\u003eå…±é€šã§å¿…è¦ãª taskRoleArn\u003c/h2\u003e\n\u003cp\u003eã¾ãš Task Definition ã«å¯¾ã—ã¦ executeRoleArn ã¨ã¯åˆ¥ã« TaskRoleArn ã®ä»˜ä¸ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-hcl\" data-lang=\"hcl\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eresource\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;aws_ecs_task_definition\u0026#34; \u0026#34;sample\u0026#34;\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  family                   \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sample\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  cpu                      \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;256\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  memory                   \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;512\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  network_mode             \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;awsvpc\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  requires_compatibilities \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;FARGATE\u0026#34;\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  execution_role_arn       \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003emodule\u003c/span\u003e.\u003cspan style=\"color:#66d9ef\"\u003eecs_task_execution_role\u003c/span\u003e.\u003cspan style=\"color:#66d9ef\"\u003eiam_role_arn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  task_role_arn            \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003emodule\u003c/span\u003e.\u003cspan style=\"color:#66d9ef\"\u003eecs_task__role\u003c/span\u003e.\u003cspan style=\"color:#66d9ef\"\u003eiam_role_arn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  container_definitions    \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003edata\u003c/span\u003e.\u003cspan style=\"color:#66d9ef\"\u003etemplate_file\u003c/span\u003e.\u003cspan style=\"color:#66d9ef\"\u003econtainer_definition_sample\u003c/span\u003e.\u003cspan style=\"color:#66d9ef\"\u003erendered\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003etaksRoleArn ã®å†…å®¹ã«ã¤ã„ã¦ã¯ \u003ca href=\"https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/task-iam-roles.html\"\u003ehttps://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/task-iam-roles.html\u003c/a\u003e ã«æƒ…å ±ãŒã‚ã‚Šã€ä¸‹è¨˜ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e","title":"Go è¨€èªã¨ awscli ã‚’ä½¿ã£ã¦ ECS/Fargate ä¸Šã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã—ã¦ã¿ãŸ"},{"content":"ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ»ã‚³ãƒ³ãƒ†ãƒŠåŸºç›¤, CNCF AWS GCP OpenStack Kubernetes Prometheus Grafana ArgoCD (Rollouts) Flux PipeCD OpenTelemetry Envoy X-Ray Docker ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª Go Rust Python IaC Terraform Ansible AWS CDK CI/CD GitHub Actions ãƒ†ãƒ¼ãƒ AWS, GCP ã‚’ä½¿ã£ãŸ SRE æ´»å‹• ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼ ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ ãƒ‡ãƒ¼ã‚¿åŸºç›¤ ãƒ­ã‚°åŸºç›¤ Datadog Hashicorp ã®å„æŠ€è¡“ãƒ»ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ","permalink":"https://jedipunkz.github.io/about/interested/","summary":"\u003ch3 id=\"ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠåŸºç›¤-cncf\"\u003eã‚¯ãƒ©ã‚¦ãƒ‰ãƒ»ã‚³ãƒ³ãƒ†ãƒŠåŸºç›¤, CNCF\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eAWS\u003c/li\u003e\n\u003cli\u003eGCP\u003c/li\u003e\n\u003cli\u003eOpenStack\u003c/li\u003e\n\u003cli\u003eKubernetes\u003c/li\u003e\n\u003cli\u003ePrometheus\u003c/li\u003e\n\u003cli\u003eGrafana\u003c/li\u003e\n\u003cli\u003eArgoCD (Rollouts)\u003c/li\u003e\n\u003cli\u003eFlux\u003c/li\u003e\n\u003cli\u003ePipeCD\u003c/li\u003e\n\u003cli\u003eOpenTelemetry\u003c/li\u003e\n\u003cli\u003eEnvoy\u003c/li\u003e\n\u003cli\u003eX-Ray\u003c/li\u003e\n\u003cli\u003eDocker\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª\"\u003eãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eGo\u003c/li\u003e\n\u003cli\u003eRust\u003c/li\u003e\n\u003cli\u003ePython\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"iac\"\u003eIaC\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eTerraform\u003c/li\u003e\n\u003cli\u003eAnsible\u003c/li\u003e\n\u003cli\u003eAWS CDK\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"cicd\"\u003eCI/CD\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eGitHub Actions\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"ãƒ†ãƒ¼ãƒ\"\u003eãƒ†ãƒ¼ãƒ\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eAWS, GCP ã‚’ä½¿ã£ãŸ SRE æ´»å‹•\u003c/li\u003e\n\u003cli\u003eãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒªãƒãƒªãƒ¼\u003c/li\u003e\n\u003cli\u003eã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥\u003c/li\u003e\n\u003cli\u003eãƒ‡ãƒ¼ã‚¿åŸºç›¤\u003c/li\u003e\n\u003cli\u003eãƒ­ã‚°åŸºç›¤\u003c/li\u003e\n\u003cli\u003eDatadog\u003c/li\u003e\n\u003cli\u003eHashicorp ã®å„æŠ€è¡“ãƒ»ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢\u003c/li\u003e\n\u003cli\u003eã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\u003c/li\u003e\n\u003c/ul\u003e","title":"èˆˆå‘³ã®ã‚ã‚‹æŠ€è¡“/ãƒ†ãƒ¼ãƒãŸã¡"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚jedipunkz ã§ã™ã€‚\nä»•äº‹ã§ã¯ã“ã‚Œã‹ã‚‰ä¼šç¤¾ã®ã‚µãƒ¼ãƒ“ã‚¹ç’°å¢ƒã¨ã—ã¦ AWS ECS ã®å°å…¥ã‚’å§‹ã‚ã¦ã„ãã¨ã“ã‚ãªã®ã§ã™ãŒã€æœ€è¿‘ã® SRE/ã‚¤ãƒ³ãƒ•ãƒ©ç•Œéšˆã®ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’è‡ªåˆ†ãŸã¡ãŒè¿½ã†ãŸã‚ã«è‡ªåˆ†ãŸã¡ SRE ãŒç®¡ç†ã—ã¦ã„ã‚‹ãƒœãƒƒãƒˆç’°å¢ƒã‚’ EKS ã‚’ä½¿ã£ã¦ GitOps åŒ–ã—ã‚ˆã†ã¨ã„ã†ã“ã¨ã«ãªã‚Šè‰²ã€…ã¨æº–å‚™ã‚’é€²ã‚ã¦ã„ã¾ã™ã€‚å°å…¥ã¾ã§ã‚‚ã†ä¸€æ­©ã®ã¨ã“ã‚ã¾ã§æ¥ãŸã®ã§ã€æ§‹æˆã‚„æŠ€è¡“è¦ç´ ã«ã¤ã„ã¦ã“ã“ã«è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nã©ã‚“ãªãƒœãƒƒãƒˆãŒå‹•ã„ã¦ã„ã‚‹ã®ï¼Ÿ ã¾ãšãƒœãƒƒãƒˆé–‹ç™ºã«ç”¨ã„ã¦ã‚‹è¨€èªã¯ Go è¨€èªã§ã™ã€‚ä¸»ã« aws-sdk-go ã‚’ä½¿ã£ã¦ãƒœãƒƒãƒˆã‚’é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚ç§é”ã¯ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ Slack ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ Slack ãƒœãƒƒãƒˆåŒ–ã™ã‚‹ãŸã‚ã«ã¯ slack-go ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ ãŸã ã¾ã ãƒœãƒƒãƒˆã®æ•°ãŒå°‘ãªãä¸»ã«åˆ©ç”¨ã•ã‚Œã¦ã‚‹ã®ã¯ Ansible ã‚’å®Ÿè¡Œã™ã‚‹ãƒ¢ãƒã§ã™ã€‚é–‹ç™ºç’°å¢ƒã¸ã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã« Ansible ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ã‚‚ã†ã™ã ECS åŒ–ã™ã‚‹ã®ã§å½¹å‰²ã¯ãã‚ãã‚çµ‚ãˆã‚‹ã®ã§ã™ãŒ\u0026hellip; åˆ©ç‚¹ã¯é–‹ç™ºè€…ã ã‘ã§ãªãéã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ–¹ãŒ GitHub ã®ãƒ–ãƒ©ãƒ³ãƒä¸Šã®ã‚¢ãƒ—ãƒªã®å‹•ä½œã‚’ã—ãŸã„éš›ã« Slack ã‚’ä½¿ã£ã¦ç°¡å˜ã«ã‚¢ãƒ—ãƒªã®å‹•ä½œãŒã§ãã‚‹ã¨ã“ã‚ã§ã™ã€‚ä»Šå¾Œã¯è‡ªå‹•åŒ–ç›®çš„ã§ã‚‚ã£ã¨æ²¢å±±ã®ãƒœãƒƒãƒˆã‚’é–‹ç™ºã—ã¦ã„ããŸã„ã§ã™ã€‚\nEKS/Fargate vs EKS/EC2 EKS ã®åˆ©ç”¨ã‚’æ¤œè¨ã™ã‚‹éš›ã« Fargate ã‚¿ã‚¤ãƒ—ã¨ EC2 ã‚¿ã‚¤ãƒ—ãŒã‚ã‚Šã¾ã™ã€‚2020å¹´ã®ä»Šå¹´é ­ã«è©•ä¾¡ã—ãŸéš›ã«ã¯ ALB Ingress Controller ã¨ HPA ã®ãŸã‚ã® Metrics Server ãŒæ­£å¸¸ã«å‹•ä½œã—ãªã„çŠ¶æ…‹ã ã£ãŸã®ã§ã€ã¾ã  EC2 ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã™ã¹ããªã®ã‹ãª\u0026hellip;ã¨è€ƒãˆãŸã®ã§ã™ãŒ AWS çš„ã«ã‚‚ Fargate ã‚’æ¨ã—ã¦ã‚‹æ°—ã‚‚ã™ã‚‹ã—å†åº¦è©•ä¾¡å®Ÿæ–½ã—ã¾ã—ãŸã€‚çµæœãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚‚ã ã„ã¶æ›´æ–°ã•ã‚Œã¦ã„ã¦ ALB Ingress Controller ã‚‚ Metrics Server ã‚‚ã‚ã£ã‘ãªãå‹•ä½œã—ã€ä»Šå›ã®ãƒœãƒƒãƒˆç’°å¢ƒã‚‚ EKS/Fargte ã‚’é¸æŠã—ã¾ã—ãŸã€‚\n(ã¡ã‚‡ã£ã¨ä½™è«‡) ãã‚‚ãã‚‚ã‚µãƒ¼ãƒ“ã‚¹ç’°å¢ƒã¯ãªãœ EKS ã§ãªã ECSï¼Ÿ AWS ECS ã®å°å…¥ã‚’å§‹ã‚ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã¨å‰è¿°ã—ã¾ã—ãŸãŒã€ãªãœã‚µãƒ¼ãƒ“ã‚¹ç’°å¢ƒã«ã¯ EKS ã§ã¯ãªã ECS ã‚’é¸æŠã—ãŸã‹ã¨ã„ã†ã¨ã€ã“ã®ä¸¡è€…ã§ä¸‹è¨˜ã®è¦³ç‚¹ã§è©•ä¾¡å®Ÿæ–½ã—ã¾ã—ãŸã€‚â€» () å†…ã¯ã¾ã æœªå®Ÿæ–½ã€‚\nã‚³ãƒ¼ãƒ‰åŒ– ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ« ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µ æ©Ÿå¯†æƒ…å ±ã®æ ¼ç´å±•é–‹ CI/CD, GitOps ãƒ­ã‚®ãƒ³ã‚° ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›† ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚° ã‚«ãƒŠãƒªãƒ¼ãƒªãƒªãƒ¼ã‚¹ç­‰ã®ãƒªãƒªãƒ¼ã‚¹æ–¹å¼ (ãƒãƒƒãƒ) (ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥) çµæœçš„ã«ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ä¸»ãªæ©Ÿèƒ½ (ç‰¹ã« ALB Ingress Controller, Metric Server) ã‚’æ™‚å‰ã§ Pod ã¨ã—ã¦é‹ç”¨ã™ã‚‹ã®ã¯é‹ç”¨ã‚³ã‚¹ãƒˆãŒé«˜ã„ã€ã¨ã„ã†åˆ¤æ–­ã‚’ã—ã¾ã—ãŸã€‚Pod ã®èª¿å­ãŒæ‚ªã„ã‹ã‚‰ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãŒãƒ‡ãƒ—ãƒ­ã‚¤ã§ããªã„ï¼ã¨ã„ã†ã®ã¯è¾›ã„ã§ã™ã€‚è‡ªåˆ†ã®å‹™ã‚ã¦ã„ã‚‹ä¼šç¤¾ã¯å°‘äººæ•°ã§é‹ç”¨ã‚³ã‚¹ãƒˆã‚’æ¸›ã‚‰ã™ã¨ã„ã†è¦–ç‚¹ã§æŠ€è¡“ã‚’é¸æŠã—ã¦ã„ã‚‹ã®ã§ã€ä»Šã®æ™‚ç‚¹ã§ã¯ ECS ã‚’é¸æŠã™ã‚‹ã®ã¯å¿…ç„¶ã§ã—ãŸã€‚ECS ã§ã‚ã‚Œã° Terraform -\u0026gt; AWS API ã§ç¢ºå®Ÿã«å¿…è¦ãªã‚¤ãƒ³ãƒ•ãƒ©ãŒãƒ‡ãƒ—ãƒ­ã‚¤å‡ºæ¥ã¾ã™ã—ã€‚\nãƒœãƒƒãƒˆç’°å¢ƒã‚’ GitOps åŒ–ã™ã‚‹å…¨ä½“æ§‹æˆ æ§‹æˆã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\n(3 get manifest +----------------------------------------+ | | +----------------+ (2 +----------------+ | | GitHub Actions |---------\u0026gt; | ECR Repository | | +----------------+ +----------------+ | + + (4 pull image | | (1 merge to master | | | +----------------+ | | | Bots | | | +----------------+ | | | ArgoCD |--+ +----------------+ +----------------+ +---------------+ | Engineer | | EKS/Fargate |---\u0026gt;| EFS Volumes | +----------------+ +----------------+ +---------------+ å‡¦ç†ã®æµã‚Œã¯\u0026hellip;\n(1 Engineer ãŒã‚¢ãƒ—ãƒªç”¨ Git ãƒ¬ãƒã‚¸ãƒˆãƒªã® master ãƒ–ãƒ©ãƒ³ãƒã¸ Push (2 GitHub Actions ã«ã‚ˆã‚Š Docker ã‚³ãƒ³ãƒ†ãƒŠãƒ“ãƒ«ãƒ‰, ECR ã¸ã® Push \u0026amp; Kustomize ã«ã‚ˆã‚Šã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ãŒæ›´æ–° (3 ArgoCD ãŒ GitHub ä¸Šã® Manifest ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°ã‚’ãƒˆãƒªã‚¬ã« EKS ã¸ãƒ­ãƒ¼ãƒªãƒ³ã‚°ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹ (4 ArgoCD ã«ã‚ˆã£ã¦æ–°ãŸã«æŒ‡å®šã•ã‚ŒãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ ECR ã‹ã‚‰ Pull ã—ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº† ãªãœ EFS ã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ ? EFS ã¯ æ°¸ç¶šçš„ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚ä»Šå¾Œã¯ä¸è¦ã«ãªã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã®ã§ã™ãŒå‰è¿°ã—ãŸ Ansible ã‚’ä½¿ã£ãŸãƒœãƒƒãƒˆã¯ Playbook ã‚’åã‚ãŸ Git ãƒ¬ãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠã« Git ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’åã‚ã‚‹ã®ã¯ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºãŒè‚¥å¤§åŒ–ã—ã¾ã™ã—è‰¯ããªã„ã¨åˆ¤æ–­ã—ã¾ã—ãŸã€‚çµæœã€EKS ã‹ã‚‰ EFS ã‚’ Volume ãƒã‚¦ãƒ³ãƒˆã—ã¦ Ansible ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã¾ãŸ Ansible ä»¥å¤–ã®ãƒœãƒƒãƒˆã‚‚ç’°å¢ƒã”ã¨ã®æƒ…å ±ã‚’æ ¼ç´ã—ãŸ yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰±ã†ã®ã§ã™ãŒã€ãã® yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ EFS ä¸Šã« Kubernetes Secrets ã¨ã—ã¦å±•é–‹ã—ã¦ã„ã¾ã™ã€‚\nArgoCD ã‚’é¸æŠã—ãŸç†ç”± ArgoCD ãŒ CNCF ã«ã‚¸ãƒ§ã‚¤ãƒ³ã—ãŸã¨ã„ã†ãƒ‹ãƒ¥ãƒ¼ã‚¹ãŒä»Šå¹´ã®å¤é ƒï¼Ÿã‚ã‚Šã¾ã—ãŸã€‚ã¾ãŸåŒæ™‚ã«æ¤œè¨ã—ã¦ã„ãŸ Flux ãŒã¡ã‚‡ã†ã©ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã‚’ã—ã¦ã€ã ã„ã¶åˆ©ç”¨æ–¹æ³•ã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒåˆ·æ–°ã•ã‚Œã¾ã—ãŸã€‚ã¾ãŸä¸€ä¸–ä»£å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã«çªå…¥ã€‚æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯åˆ©ç”¨æ–¹æ³•ãŒå°‘ã—è¤‡é›‘åŒ–ã—ã¦ã„ã¾ã—ãŸã— CLI ã¯åŠ‡çš„ã«åˆ©ç”¨æ–¹æ³•ãŒå¤‰åŒ–ã—ã¦ã„ã¾ã—ãŸã€‚ã¨ã„ã†ã“ã¨ã§ GitOps ã‚’ã—ãŸã„ã¨ã„ã†è¦æœ›ã ã‘æº€ãŸã›ã‚Œã°è‰¯ã„ã®ã§ CNDF ã® ArgoCD ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚\nArgoCD ã¯ãƒœãƒƒãƒˆã¨åŒã˜ EKS ã‚¯ãƒ©ã‚¹ã‚¿ä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã—ãŸã€‚UI ã¯æ™®æ®µåˆ©ç”¨ã—ãªã„ã®ã§ Ingress ã¯è¨­å®šã›ãš EKS Fargate Profile ã®ç¨¼åƒã—ã¦ã„ã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆä¸Šã§èµ·å‹•ã•ã›ã¾ã—ãŸã€‚ArgoCD ã‚¢ãƒ—ãƒªã¯ä¸‹è¨˜ã®æ‰‹é †ã§ä½œæˆã—ã¾ã™ã€‚\n$ argocd app create hello --repo https://github.com/jedipunkz/no-exsist-bot-repo.git --path bots/hello/manifests/envs/dev --dest-server https://kubernetes.default.svc --dest-namespace infra-bot $ argocd app set hello --sync-policy automated $ arogcd app set hello --auto-prune ã“ã®æ“ä½œã§ ArgoCD ãŒ GitHub ä¸Šã® Manifests ã®å¤‰åŒ–ã«å¿œã˜ã¦ãƒœãƒƒãƒˆã®ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ ECR ã‹ã‚‰å–å¾—ã—ã¦ GitOps ã‚’å®Ÿç¾ã—ã¦ãã‚Œã¾ã™ã€‚\nKustomize ã§ç’°å¢ƒ Manifest ã®ç’°å¢ƒã‚’åˆ†é›¢ã—ã€ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°ã‚’ç·¨é›†ã™ã‚‹ãŸã‚ã« Kustomize ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æ›´æ–°ã™ã‚‹ãŸã‚ã«ã¯ Kustomize ã¯å¿…é ˆãªæŠ€è¡“è¦ç´ ãªæ°—ãŒã—ã¦ã„ã¾ã™ã€‚\nbots â””â”€â”€ ansible â”œâ”€â”€ Dockerfile â”œâ”€â”€ README.md â”œâ”€â”€ bot.go â”œâ”€â”€ go.mod â”œâ”€â”€ go.sum â”œâ”€â”€ main.go â”œâ”€â”€ manifests â”‚Â â”œâ”€â”€ base â”‚Â â”‚Â â”œâ”€â”€ bot-deployment.yaml â”‚Â â”‚Â â”œâ”€â”€ bot-svc.yaml â”‚Â â”‚Â â””â”€â”€ kustomization.yaml â”‚Â â”œâ”€â”€ envs â”‚Â â”‚Â â”œâ”€â”€ dev â”‚Â â”‚Â â”‚Â â”œâ”€â”€ deployment.yaml â”‚Â â”‚Â â”‚Â â””â”€â”€ kustomization.yaml â”‚Â â”‚Â â””â”€â”€ prd â”‚Â â”‚Â â”œâ”€â”€ deployment.yaml â”‚Â â”‚Â â””â”€â”€ kustomization.yaml â”‚Â â””â”€â”€ manual â”‚Â â””â”€â”€ secrets.yaml â””â”€â”€ requirements.txt GitHub Actions ã‚’ç”¨ã„ãŸ Docker ãƒ“ãƒ«ãƒ‰, ECR ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ—ãƒƒã‚·ãƒ¥, Kustomize Edit GitHub Actions ã‚’ä½¿ã£ã¦ãƒœãƒƒãƒˆã®è¿½åŠ ãƒ»ç·¨é›† PR ã‚’ãƒãƒ¼ã‚¸ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§\nDocker ãƒ“ãƒ«ãƒ‰ ECR ã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ Kustomize Edit ã‚’ã—ã¦ Manifest ã«è¨˜ã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°ã‚’æ›´æ–° ã‚’ã—ã¦ã„ã¾ã™ã€‚GitHub Actions ã®å‡¦ç†ã¨ã—ã¦ã¯ã“ã‚Œã ã‘ã§ã€ã‚ã¨ã¯ ArgoCD ãŒ GitHub ä¸Šã® Manifests ã®æ›´æ–°ã«åå¿œã—ã¦è‡ªå‹•ã§ GitOps ã—ã¦ãã‚Œã¾ã™ã€‚\nã¾ã¨ã‚ æ§‹æˆã™ã‚‹æŠ€è¡“è¦ç´ ã¨ã—ã¦ã¯ä»¥ä¸Šã§ã™ã€‚å…ˆã«è¿°ã¹ã¾ã—ãŸãŒ kubernetes ã‚’ SRE ã¨ã—ã¦é‹ç”¨ã™ã‚‹ã“ã¨ã¯æ˜¨ä»Šã® SRE/ã‚¤ãƒ³ãƒ•ãƒ©ç•Œéšˆã®ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’æŠ¼ã•ãˆã‚‹ã¨ã„ã†æ„å‘³ã§æ„å‘³ãŒã‚ã‚‹ã“ã¨ã§ã™ã—ã€ä»Šå›æ•°ãƒ¶æœˆã¶ã‚Šã« EKS ã‚’è©•ä¾¡ãƒ»æ¤œè¨¼ã—ã¦ã€æŠ€è¡“ã¨ã—ã¦é€Ÿã„ã‚¹ãƒ”ãƒ¼ãƒ‰ã§æˆç†Ÿã—ã¦ã„ã‚‹ã®ã‚’å®Ÿæ„Ÿã—ã¾ã—ãŸã€‚ä»Šå¾Œ EKS ã‚’æœ¬ç•ªã‚µãƒ¼ãƒ“ã‚¹ã§ã‚‚åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚ALB Ingress Controller, Metrics Server ã ã‘ã§ã¯ãªã ArgoCD ã‚‚ä»Šå¹´ã®2æœˆã«è©•ä¾¡ã—ãŸéš›ã‚ˆã‚Šã ã„ã¶å®Œæˆåº¦ãŒå¢—ã—ã¦ã„ã‚‹æ°—ãŒã—ã¾ã™ã€‚\nEKS å°å…¥å‰ã¯ Docker Compose ã§ãƒœãƒƒãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã¦åŠè‡ªå‹•åŒ–çŠ¶æ…‹ã§ã—ãŸã€‚ãƒœãƒƒãƒˆã‚’ä½œã‚‹è¶³ã‹ã›ã«ã‚‚ãªã£ã¦ã„ãŸã®ã§ã€EKS ã®å°å…¥ã§ä»Šå¾Œã®ãƒœãƒƒãƒˆé–‹ç™ºã®æ•·å±…ãŒä¸‹ãŒã‚Šã€è‡ªå‹•åŒ–ãŒã¾ã™ã¾ã™æ¨é€²ã•ã‚Œã‚Œã°ã„ã„ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/eks-fargate-bot-env/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003ejedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»•äº‹ã§ã¯ã“ã‚Œã‹ã‚‰ä¼šç¤¾ã®ã‚µãƒ¼ãƒ“ã‚¹ç’°å¢ƒã¨ã—ã¦ AWS ECS ã®å°å…¥ã‚’å§‹ã‚ã¦ã„ãã¨ã“ã‚ãªã®ã§ã™ãŒã€æœ€è¿‘ã® SRE/ã‚¤ãƒ³ãƒ•ãƒ©ç•Œéšˆã®ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’è‡ªåˆ†ãŸã¡ãŒè¿½ã†ãŸã‚ã«è‡ªåˆ†ãŸã¡ SRE ãŒç®¡ç†ã—ã¦ã„ã‚‹ãƒœãƒƒãƒˆç’°å¢ƒã‚’ EKS ã‚’ä½¿ã£ã¦ GitOps åŒ–ã—ã‚ˆã†ã¨ã„ã†ã“ã¨ã«ãªã‚Šè‰²ã€…ã¨æº–å‚™ã‚’é€²ã‚ã¦ã„ã¾ã™ã€‚å°å…¥ã¾ã§ã‚‚ã†ä¸€æ­©ã®ã¨ã“ã‚ã¾ã§æ¥ãŸã®ã§ã€æ§‹æˆã‚„æŠ€è¡“è¦ç´ ã«ã¤ã„ã¦ã“ã“ã«è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ã©ã‚“ãªãƒœãƒƒãƒˆãŒå‹•ã„ã¦ã„ã‚‹ã®\"\u003eã©ã‚“ãªãƒœãƒƒãƒˆãŒå‹•ã„ã¦ã„ã‚‹ã®ï¼Ÿ\u003c/h2\u003e\n\u003cp\u003eã¾ãšãƒœãƒƒãƒˆé–‹ç™ºã«ç”¨ã„ã¦ã‚‹è¨€èªã¯ Go è¨€èªã§ã™ã€‚ä¸»ã« aws-sdk-go ã‚’ä½¿ã£ã¦ãƒœãƒƒãƒˆã‚’é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚ç§é”ã¯ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ Slack ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ Slack ãƒœãƒƒãƒˆåŒ–ã™ã‚‹ãŸã‚ã«ã¯ \u003ca href=\"https://github.com/slack-go/slack\"\u003eslack-go\u003c/a\u003e ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ ãŸã ã¾ã ãƒœãƒƒãƒˆã®æ•°ãŒå°‘ãªãä¸»ã«åˆ©ç”¨ã•ã‚Œã¦ã‚‹ã®ã¯ Ansible ã‚’å®Ÿè¡Œã™ã‚‹ãƒ¢ãƒã§ã™ã€‚é–‹ç™ºç’°å¢ƒã¸ã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã« Ansible ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ã‚‚ã†ã™ã ECS åŒ–ã™ã‚‹ã®ã§å½¹å‰²ã¯ãã‚ãã‚çµ‚ãˆã‚‹ã®ã§ã™ãŒ\u0026hellip; åˆ©ç‚¹ã¯é–‹ç™ºè€…ã ã‘ã§ãªãéã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ–¹ãŒ GitHub ã®ãƒ–ãƒ©ãƒ³ãƒä¸Šã®ã‚¢ãƒ—ãƒªã®å‹•ä½œã‚’ã—ãŸã„éš›ã« Slack ã‚’ä½¿ã£ã¦ç°¡å˜ã«ã‚¢ãƒ—ãƒªã®å‹•ä½œãŒã§ãã‚‹ã¨ã“ã‚ã§ã™ã€‚ä»Šå¾Œã¯è‡ªå‹•åŒ–ç›®çš„ã§ã‚‚ã£ã¨æ²¢å±±ã®ãƒœãƒƒãƒˆã‚’é–‹ç™ºã—ã¦ã„ããŸã„ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"sss\" loading=\"lazy\" src=\"../../pix/ansible-bot.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"eksfargate-vs-eksec2\"\u003eEKS/Fargate vs EKS/EC2\u003c/h2\u003e\n\u003cp\u003eEKS ã®åˆ©ç”¨ã‚’æ¤œè¨ã™ã‚‹éš›ã« Fargate ã‚¿ã‚¤ãƒ—ã¨ EC2 ã‚¿ã‚¤ãƒ—ãŒã‚ã‚Šã¾ã™ã€‚2020å¹´ã®ä»Šå¹´é ­ã«è©•ä¾¡ã—ãŸéš›ã«ã¯ ALB Ingress Controller ã¨ HPA ã®ãŸã‚ã® Metrics Server ãŒæ­£å¸¸ã«å‹•ä½œã—ãªã„çŠ¶æ…‹ã ã£ãŸã®ã§ã€ã¾ã  EC2 ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã™ã¹ããªã®ã‹ãª\u0026hellip;ã¨è€ƒãˆãŸã®ã§ã™ãŒ AWS çš„ã«ã‚‚ Fargate ã‚’æ¨ã—ã¦ã‚‹æ°—ã‚‚ã™ã‚‹ã—å†åº¦è©•ä¾¡å®Ÿæ–½ã—ã¾ã—ãŸã€‚çµæœãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚‚ã ã„ã¶æ›´æ–°ã•ã‚Œã¦ã„ã¦ ALB Ingress Controller ã‚‚ Metrics Server ã‚‚ã‚ã£ã‘ãªãå‹•ä½œã—ã€ä»Šå›ã®ãƒœãƒƒãƒˆç’°å¢ƒã‚‚ EKS/Fargte ã‚’é¸æŠã—ã¾ã—ãŸã€‚\u003c/p\u003e","title":"EKS/Fargate + ArgoCD ã§ãƒœãƒƒãƒˆç’°å¢ƒ GitOps åŒ–"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šæ—¥ã¯ Pulumi (https://www.pulumi.com/) ã«ã¤ã„ã¦ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\næœ€è¿‘ã§ã¯ã™ã£ã‹ã‚Š Terraform ãŒãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰ãª IaC ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦å®šç€ã—ã¾ã—ãŸãŒã€å··ã§ã¯ AWS CDK ã‚’ä½¿ã†ç¾å ´ã‚‚å¢—ãˆã¦ãã¦ã„ã‚‹å°è±¡ã§ã™ã€‚AWS CDK ã¯ Typescript, Python ãªã©ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã®ä¸­ã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å®šç¾©ãƒ»æ“ä½œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ AWS ãŒæä¾›ã—ã¦ã„ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ãŸã  AWS CDK ã¯åå‰ã®é€šã‚Š AWS ã«ã®ã¿å¯¾å¿œã—ã¦ã„ã¦å†…éƒ¨çš„ã«ã¯ Cloudformation Template ãŒã‚¨ã‚­ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚AWS ã‚ªãƒ³ãƒªãƒ¼ã¨ã„ã†ç‚¹ã¨ Cloudformation ã¨ã„ã†ç‚¹ã€ã¾ãŸ 2019 å¹´æ™‚ç‚¹ã§é€²åŒ–ãŒæ¿€ã—ãå¾Œæ–¹äº’æ›æ€§ã‚’å…¨ãå¤±ã£ã¦ã„ã‚‹ã®ã§ AWS CDK ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«è¿½å¾“ã™ã‚‹ã®ã«è‹¦åŠ´ã™ã‚‹ç‚¹ã€è‰²ã€…ã‚ã‚Šã¾ã åˆ©ç”¨ã™ã‚‹ã«ã¯æ—©ã„ã®ã‹ãªãã¨ã„ã†å°è±¡ã‚’å€‹äººçš„ã«ã¯æŒã£ã¦ã„ã¾ã™ã€‚\nãã“ã§ä»Šå›ç´¹ä»‹ã™ã‚‹ Pulumi ãªã®ã§ã™ãŒ CDK åŒæ§˜ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã®ä¸­ã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å®šç¾©ã§ãã¦å°šä¸”ã¤ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚ã©ã¡ã‚‰ã‹ã¨ã„ã†ã¨æ—§æ¥ã® SDK ã®åˆ†é¡ã ã¨æ€ã†ã®ã§ã™ãŒã€Terraform åŒæ§˜ã«ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰ã¨ã„ã†ç‚¹ã§å€‹äººçš„ã«ã¯ä»¥å‰ã‚ˆã‚Šã‚¦ã‚©ãƒƒãƒã—ã¦ã„ã¾ã—ãŸã€‚\nä»Šå›ã¯å…¬å¼ã® Getting Started çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å¾“ã£ã¦ä½œæ¥­ã‚’é€²ã‚ Kubernetes ã®ä¸Šã« Pod ã‚’èµ·å‹•ã€ãã®å¾Œã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã¦å†ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿæ–½ã—ã¦ç†è§£ã‚’æ·±ã‚ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nä½œæ¥­ã«å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ ä¸‹è¨˜ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ»ãƒ„ãƒ¼ãƒ«ãŒäº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æã¨ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸ macOS ã‚’å‰æã«æ‰‹é †ã‚’è¨˜ã—ã¾ã™ã€‚\nPython3, Pip Minikube å‚è€ƒ https://www.pulumi.com/docs/get-started/kubernetes/ äº‹å‰æº–å‚™ ã¾ãš macOS ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆ Pulumi ã¯ä¸‹è¨˜ã®é€šã‚Š brew ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚\n$ brew install pulumi ã¾ãŸ minikube ã‚’ä½¿ã£ã¦ kubernetes ã‚’èµ·å‹•ã—ã¾ã™ã€‚\n$ minikube start --memory=4096 --cpus=2 Pulumi ã‚’ä½¿ã£ãŸ Nginx Pod ã®èµ·å‹• æ—©é€Ÿ Nginx Pod ã‚’ Kubernetes æƒ…ã«èµ·å‹•ã™ã‚‹ä½œæ¥­ã‚’è¡Œã£ã¦ã¿ã¾ã™ã€‚é©å½“ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ãã®ä¸­ã§ pulumi new ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\n$ mkdir quickstart \u0026amp;\u0026amp; cd quickstart $ pulumi new kubernetes-python ä¸‹è¨˜ã®é€šã‚Šå‡ºåŠ›ã•ã‚Œå…¥åŠ›ã‚’ä¿ƒã•ã‚Œã¾ã™ã€‚ä»Šå›ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ãã®ã¾ã¾åˆ©ç”¨ã™ã‚‹ã®ã§ã‚¨ãƒ³ã‚¿ãƒ¼ã‚’æ•°å›å…¥åŠ›ã—ã¾ã™ã€‚\nproject name: (quickstart) project description: (A minimal Kubernetes Python Pulumi program) Created project \u0026#39;quickstart\u0026#39; Please enter your desired stack name. To create a stack in an organization, use the format \u0026lt;org-name\u0026gt;/\u0026lt;stack-name\u0026gt; (e.g. `acmecorp/dev`). stack name: (dev) Created stack \u0026#39;dev\u0026#39; ã™ã‚‹ã¨ __main__.py ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚Kubernetes ä¸Šã« nginx pod ã‚’èµ·å‹•ã™ã‚‹ãŸã‚ã® Python ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚ä¸­èº«ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚nginx ã® Deployment ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã®ãŒç†è§£ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\nimport pulumi from pulumi_kubernetes.apps.v1 import Deployment app_labels = { \u0026#34;app\u0026#34;: \u0026#34;nginx\u0026#34; } deployment = Deployment( \u0026#34;nginx\u0026#34;, spec={ \u0026#34;selector\u0026#34;: { \u0026#34;match_labels\u0026#34;: app_labels }, \u0026#34;replicas\u0026#34;: 1, \u0026#34;template\u0026#34;: { \u0026#34;metadata\u0026#34;: { \u0026#34;labels\u0026#34;: app_labels }, \u0026#34;spec\u0026#34;: { \u0026#34;containers\u0026#34;: [{ \u0026#34;name\u0026#34;: \u0026#34;nginx\u0026#34;, \u0026#34;image\u0026#34;: \u0026#34;nginx\u0026#34; }] } } }) pulumi.export(\u0026#34;name\u0026#34;, deployment.metadata[\u0026#34;name\u0026#34;]) ã“ã“ã§ä»Šå›ã¯ Python ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ pip ã‚’ä½¿ã£ã¦ Pulumi Module ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸ requirements.txt ãŒã‚ã‚Šã¾ã™ã®ã§ãã‚Œã«å¾“ã£ã¦ pip install ã—ã¾ã™ã€‚\n$ pip install -r requirements.txt ãã‚Œã§ã¯ä¸‹è¨˜ã®é€šã‚Š pulumi up ã‚’å®Ÿè¡Œã— Nginx Pod ã‚’èµ·å‹•ã—ã¦ã„ã¾ã—ã‚‡ã†ã€‚\n$ pulumi up Previewing update (dev): Type Name Plan + pulumi:pulumi:Stack quickstart-dev create + â””â”€ kubernetes:apps:Deployment nginx create Resources: + 2 to create Do you want to perform this update? \u0026gt; yes no details çµæœã¨ã—ã¦ä¸‹è¨˜ã®ã‚ˆã†ã«å‡ºåŠ›ã•ã‚Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ \u0026lsquo;created\u0026rsquo; ã¨ãªã‚Šã¾ã—ãŸã€‚\nType Name Status + pulumi:pulumi:Stack quickstart-dev created + â””â”€ kubernetes:apps:Deployment nginx created Outputs: name: \u0026#34;nginx-td4rq3xr\u0026#34; Resources: + 2 created Duration: 14s Permalink: https://app.pulumi.com/jedipunkz/quickstart/dev/updates/1 kubectl ã‚³ãƒãƒ³ãƒ‰ã§ã‚‚ç¢ºèªã—ã¦ã„ã¾ã—ã‚‡ã†ã€‚ä¸‹è¨˜ã®ã‚ˆã†ã« nginx-**** pod ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\n$ kubectl get pod NAME READY STATUS RESTARTS AGE nginx-td4rq3xr-86c57db685-nfblb 1/1 Running 0 46m __main__.py ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã¦å¤–éƒ¨ã‹ã‚‰ Nginx ã«ã‚¢ã‚¯ã‚»ã‚¹ æ¬¡ã« __main__.py ã‚’ä¸‹è¨˜ã®é€šã‚Šä¿®æ­£ã—ã¦ Nginx Pod ã« curl ã‚’ä½¿ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã™ã€‚ ã‚³ãƒ¼ãƒ‰ã®ä¸­ã§ minikube ã‹å¦ã‹ã«ã¤ã„ã¦ã® Config pulumi.Config() ã«é–¢ã™ã‚‹è¨˜è¿°ã¨ Deployment ã« IP ã‚’ç¢ºä¿ã™ã‚‹è¨˜è¿°ãŒã‚ã‚Šã¾ã™ã€‚\nimport pulumi from pulumi_kubernetes.apps.v1 import Deployment from pulumi_kubernetes.core.v1 import Service # Minikube does not implement services of type `LoadBalancer`; require the user to specify if we\u0026#39;re # running on minikube, and if so, create only services of type ClusterIP. config = pulumi.Config() is_minikube = config.require_bool(\u0026#34;isMinikube\u0026#34;) app_name = \u0026#34;nginx\u0026#34; app_labels = { \u0026#34;app\u0026#34;: app_name } deployment = Deployment( app_name, spec={ \u0026#34;selector\u0026#34;: { \u0026#34;match_labels\u0026#34;: app_labels }, \u0026#34;replicas\u0026#34;: 1, \u0026#34;template\u0026#34;: { \u0026#34;metadata\u0026#34;: { \u0026#34;labels\u0026#34;: app_labels }, \u0026#34;spec\u0026#34;: { \u0026#34;containers\u0026#34;: [{ \u0026#34;name\u0026#34;: app_name, \u0026#34;image\u0026#34;: \u0026#34;nginx\u0026#34; }] } } }) # Allocate an IP to the Deployment. frontend = Service( app_name, metadata={ \u0026#34;labels\u0026#34;: deployment.spec[\u0026#34;template\u0026#34;][\u0026#34;metadata\u0026#34;][\u0026#34;labels\u0026#34;], }, spec={ \u0026#34;type\u0026#34;: \u0026#34;ClusterIP\u0026#34; if is_minikube else \u0026#34;LoadBalancer\u0026#34;, \u0026#34;ports\u0026#34;: [{ \u0026#34;port\u0026#34;: 80, \u0026#34;target_port\u0026#34;: 80, \u0026#34;protocol\u0026#34;: \u0026#34;TCP\u0026#34; }], \u0026#34;selector\u0026#34;: app_labels, }) # When \u0026#34;done\u0026#34;, this will print the public IP. if is_minikube: pulumi.export(\u0026#34;ip\u0026#34;, frontend.spec.apply(lambda v: v[\u0026#34;cluster_ip\u0026#34;] if \u0026#34;cluster_ip\u0026#34; in v else None)) else: pulumi.export(\u0026#34;ip\u0026#34;, frontend.status.apply(lambda v: v[\u0026#34;load_balancer\u0026#34;][\u0026#34;ingress\u0026#34;][0][\u0026#34;ip\u0026#34;] if \u0026#34;load_balancer\u0026#34; in v else None)) ä¿®æ­£ãŒçµ‚ã‚ã£ãŸã‚‰ä¸‹è¨˜ã®é€šã‚Šå¤‰æ•° isMinikube ã« true ã‚’è¨­å®šã—ã¦ã€å…ˆã»ã©ã¨åŒæ§˜ã« pulumi up ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\n$ pulumi config set isMinikube true $ pulumi up æ¬¡ã«ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã— Pods ã«ä»˜ä¸ã•ã‚ŒãŸ IP Addr ã‚’èª¿ã¹ã¾ã™ã€‚\n$ pulumi stack output ip æœ€å¾Œã« minikube ã®ãƒãƒ¼ãƒ‰ã«ãƒ­ã‚°ã‚¤ãƒ³ã— curl ã‚’ä½¿ã£ã¦å…ˆã»ã©èª¿ã¹ãŸ IP Addr å®›ã« curl ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚\n$ minikube ssh $ curl 10.108.14.27 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Welcome to nginx!\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { width: 35em; margin: 0 auto; font-family: Tahoma, Verdana, Arial, sans-serif; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Welcome to nginx!\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;If you see this page, the nginx web server is successfully installed and working. Further configuration is required.\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;For online documentation and support please refer to \u0026lt;a href=\u0026#34;http://nginx.org/\u0026#34;\u0026gt;nginx.org\u0026lt;/a\u0026gt;.\u0026lt;br/\u0026gt; Commercial support is available at \u0026lt;a href=\u0026#34;http://nginx.com/\u0026#34;\u0026gt;nginx.com\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Thank you for using nginx.\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; nginx ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒå¿œç­”ã‚ã£ãŸã“ã¨ã‚’ç¢ºèªå‡ºæ¥ã‚‹ã¨æ€ã„ã¾ã™ã€‚\nã¾ã¨ã‚ Python ã‚³ãƒ¼ãƒ‰ã®ä¸­ã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å®šç¾©ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚ä»Šå›ã¯ Kubernetes ã§è©¦ã—ã¾ã—ãŸãŒ AWS ã‚„ GCP ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚åŒæ§˜ã®ã“ã¨ã‚’ AWS SDK ã§ã‚‚è‡ªåˆ†ã¯ä»Šã¾ã§è¡Œã£ã¦ãã¾ã—ãŸãŒå‰è¿°ã—ãŸé€šã‚Šãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰ã¨ã„ã†ç‚¹ãŒå„ªä½æ€§ã‚ã‚‹ã®ã‹ãªãã¨ã„ã†å°è±¡ã§ã™ã€‚ãŸã ã€ã‚¯ãƒ©ã‚¦ãƒ‰å´ã‚‚å¸¸ã«é€²åŒ–ã—ã¦ã„ã¦ã€ãã‚Œã‚‰ã« Pulumi ãŒè¿½å¾“ã—ç¶šã‘ã‚‰ã‚Œã‚‹ã®ã‹ä¸å®‰ãªç‚¹ã‚‚æ„Ÿã˜ã¾ã™ã€‚ãã®ç‚¹ã§ã¯ã‚„ã¯ã‚Š AWS ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã¨ã£ã¦ã¯ AWS SDK ãŒãƒ™ã‚¹ãƒˆãªé¸æŠã¨ä»Šæ™‚ç‚¹ã§ã¯è¨€ã‚ã–ã‚‹ã‚’å¾—ã¾ã›ã‚“ã€‚ã¾ãŸ Pulumi ã¨ã„ã†ä¼æ¥­è‡ªä½“ãŒå®‰å®šã—ã¦ã„ã‚‹ã®ã‹ã€è²·åã•ã‚ŒãŸã‚Šã—ãªã„ã®ã‹ã¨ã„ã†ä¸å®‰ã‚‚ä»˜ãçºã„ã¾ã™ã€‚\nSDK ã®åˆ©ç”¨ã¯ DevOpsãƒ»SRE çš„ã«æ¥­å‹™ã‚’è¡Œã†ã®ã§ã‚ã‚Œã°è‡ªå‹•åŒ–ã‚’æ¨é€²ã™ã‚‹ã«ã‚ãŸã‚Šå¿…é ˆã¨ã‚‚è¨€ãˆã‚‹æŠ€è¡“ã§ã‚ã‚‹ã¨è¨€ãˆã¾ã™ã€‚å€‹äººçš„ã«ã¯ã“ã‚Œã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚’æ§‹ç¯‰ãƒ»ç®¡ç†ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã® Terraform ã¨ã¯ç«‹ã¡ä½ç½®ãŒè‹¥å¹²ç•°ãªã‚‹ã¨ã„ã†èªè­˜ã§ã„ã¾ã™ã€‚ãã‚Œã«å¯¾ã—ã¦ CDK ã¯ã©ã†ã„ã†ç«‹ã¡ä½ç½®ã«ãªã‚‹ã®ã‹ã€‚ä»Šå›ç´¹ä»‹ã—ãŸ Pulumi ãŒ SDK ã¨ã—ã¦ã®ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã«ã®ã—ã‚ãŒã‚‹ã®ã‹ã„ãªã‹ã€‚DevOpsãƒ»SRE ç•Œéšˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒç”¨ã„ã‚‹æŠ€è¡“ã‚‚ã“ã‚Œã‹ã‚‰æ›´ã«å¤‰åŒ–ã—ã¦ã„ããã†ãªæ°—ãŒã—ã¾ã™ã—ã€ãã®éç¨‹ã®ä¸­ã§ Pulumi ã‚’çŸ¥ã£ã¦é ‚ãã®ã¯è‰¯ã„ã“ã¨ã ã¨æ€ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/pulumi/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šæ—¥ã¯ Pulumi (\u003ca href=\"https://www.pulumi.com/\"\u003ehttps://www.pulumi.com/\u003c/a\u003e) ã«ã¤ã„ã¦ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€è¿‘ã§ã¯ã™ã£ã‹ã‚Š Terraform ãŒãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰ãª IaC ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦å®šç€ã—ã¾ã—ãŸãŒã€å··ã§ã¯ AWS CDK ã‚’ä½¿ã†ç¾å ´ã‚‚å¢—ãˆã¦ãã¦ã„ã‚‹å°è±¡ã§ã™ã€‚AWS CDK ã¯ Typescript, Python ãªã©ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã®ä¸­ã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å®šç¾©ãƒ»æ“ä½œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ AWS ãŒæä¾›ã—ã¦ã„ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ãŸã  AWS CDK ã¯åå‰ã®é€šã‚Š AWS ã«ã®ã¿å¯¾å¿œã—ã¦ã„ã¦å†…éƒ¨çš„ã«ã¯ Cloudformation Template ãŒã‚¨ã‚­ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚AWS ã‚ªãƒ³ãƒªãƒ¼ã¨ã„ã†ç‚¹ã¨ Cloudformation ã¨ã„ã†ç‚¹ã€ã¾ãŸ 2019 å¹´æ™‚ç‚¹ã§é€²åŒ–ãŒæ¿€ã—ãå¾Œæ–¹äº’æ›æ€§ã‚’å…¨ãå¤±ã£ã¦ã„ã‚‹ã®ã§ AWS CDK ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«è¿½å¾“ã™ã‚‹ã®ã«è‹¦åŠ´ã™ã‚‹ç‚¹ã€è‰²ã€…ã‚ã‚Šã¾ã åˆ©ç”¨ã™ã‚‹ã«ã¯æ—©ã„ã®ã‹ãªãã¨ã„ã†å°è±¡ã‚’å€‹äººçš„ã«ã¯æŒã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eãã“ã§ä»Šå›ç´¹ä»‹ã™ã‚‹ Pulumi ãªã®ã§ã™ãŒ CDK åŒæ§˜ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã®ä¸­ã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å®šç¾©ã§ãã¦å°šä¸”ã¤ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚ã©ã¡ã‚‰ã‹ã¨ã„ã†ã¨æ—§æ¥ã® SDK ã®åˆ†é¡ã ã¨æ€ã†ã®ã§ã™ãŒã€Terraform åŒæ§˜ã«ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰ã¨ã„ã†ç‚¹ã§å€‹äººçš„ã«ã¯ä»¥å‰ã‚ˆã‚Šã‚¦ã‚©ãƒƒãƒã—ã¦ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯å…¬å¼ã® Getting Started çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å¾“ã£ã¦ä½œæ¥­ã‚’é€²ã‚ Kubernetes ã®ä¸Šã« Pod ã‚’èµ·å‹•ã€ãã®å¾Œã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã¦å†ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿæ–½ã—ã¦ç†è§£ã‚’æ·±ã‚ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä½œæ¥­ã«å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢\"\u003eä½œæ¥­ã«å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ»ãƒ„ãƒ¼ãƒ«ãŒäº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æã¨ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸ macOS ã‚’å‰æã«æ‰‹é †ã‚’è¨˜ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePython3, Pip\u003c/li\u003e\n\u003cli\u003eMinikube\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å‚è€ƒ\"\u003eå‚è€ƒ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.pulumi.com/docs/get-started/kubernetes/\"\u003ehttps://www.pulumi.com/docs/get-started/kubernetes/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"äº‹å‰æº–å‚™\"\u003eäº‹å‰æº–å‚™\u003c/h2\u003e\n\u003cp\u003eã¾ãš macOS ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆ Pulumi ã¯ä¸‹è¨˜ã®é€šã‚Š brew ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚\u003c/p\u003e","title":"ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰å¯¾å¿œ SDK ã® Pulumi ã‚’ä½¿ã£ã¦ Kubernetes ã‚’æ“ä½œ"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šå›ã¯ AWS ECS ã«ã¤ã„ã¦ã§ã™ã€‚ç›´è¿‘ã®ä»•äº‹ã§ ECS ã® Terraform ã‚³ãƒ¼ãƒ‰é–‹ç™ºã‚’ã—ã¦ã„ãŸã®ã§ã™ãŒã‚³ãƒ¼ãƒ‰ã®æ§‹é€ åŒ–ã«ã¤ã„ã¦è€ƒãˆã¦ã„ã¾ã—ãŸã€‚ä¸€æšå²©ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã‚‚é‹ç”¨ã«è€ãˆã‚‰ã‚Œã‚‹ã¨ã¯è€ƒãˆã‚‰ã‚Œã¾ã›ã‚“ã€‚ã¾ãŸ ECS ã‚’æ§‹æˆã™ã‚‹ã«ã‚ãŸã£ã¦ ECS ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã¨ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚®ãƒ³ã‚°ã«ã¤ã„ã¦è€ƒãˆã¦ã„ã‚‹ã†ã¡ã«ã€ã©ã®æ§‹æˆãŒä¸€ç•ªé©ã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿã«ã¤ã„ã¦æ™‚é–“ã‚’æ›ã‘ã¦è€ƒãˆã¾ã—ãŸã€‚ã“ã“ã§ã¯ãã‚Œã‚‰ã«ã¤ã„ã¦ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nTerraform ã‚³ãƒ¼ãƒ‰ã®æ§‹é€ åŒ– é‹ç”¨ã®ç²¾ç¥çš„ãªè² æ‹…ã‚’è»½æ¸›ã™ã‚‹ã¨ã„ã†è¦³ç‚¹ã§ Terraform ã®ã‚³ãƒ¼ãƒ‰é–‹ç™ºã‚’ã™ã‚‹ä¸Šã§ä¸€ç•ªé‡è¦ãªã®ã¯ã‚³ãƒ¼ãƒ‰ã®æ§‹é€ åŒ–ã ã¨æ€ã„ã¾ã™ã€‚å‰å›ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã«æ›¸ã„ãŸã®ã§ã™ãŒã‚³ãƒ¼ãƒ‰ã®æ§‹é€ åŒ–ã‚’ã™ã‚‹ä¸Šã§ä¸‹è¨˜ã«ç•™æ„ã—ã¦è€ƒãˆã‚‹ã¨è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚\nå½±éŸ¿ç¯„å›² ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ã‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ã‹ å®‰å®šåº¦ ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ« çµæœã€å…·ä½“çš„ã« Terraform ã®ã‚³ãƒ¼ãƒ‰ã¯ã©ã®ã‚ˆã†ãªæ§‹é€ ã«ãªã‚‹ã§ã—ã‚‡ã†ã‹ã€‚è‡ªåˆ†ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã—ã¦ Terraform ã®å®Ÿè¡Œå˜ä½ã‚’åˆ¥ã‘ã¾ã—ãŸã€‚ã“ã“ã¯äººãã‚Œãã‚Œã ã¨æ€ã„ã¾ã™ãŒã€ECS æœ¬ä½“ã¨ ECS ã®å‘¨è¾º AWS ã‚µãƒ¼ãƒ“ã‚¹ã®ä¸€èˆ¬çš„ãªç‰©ã‚’è€ƒæ…®ã—ã¤ã¤ã€ã„ã‹ã«ã‚·ãƒ³ãƒ—ãƒ«ã«æ§‹é€ åŒ–ã™ã‚‹ã‹ã‚’è€ƒãˆã‚‹ã¨è‡ªç„¶ã¨ä¸‹è¨˜ã®åŒºåˆ†ã‘ã«ãªã‚‹æ°—ãŒã—ã¾ã™ã€‚\nã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ å…·ä½“çš„ãªãƒªã‚½ãƒ¼ã‚¹ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ vpc, route table, igw, endpoint, subnet ECS æœ¬ä½“ ecs, alb, autoscaling, cloudwatch, iam CI/CD codebuild, codepipeline, ecr, iam ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ssm, kms ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ s3, rds, elasticache \u0026hellip; vpc ã‚„ subnet ã«é–¢ã—ã¦é »ç¹ã«æ›´æ–°ã‚’æ›ã‘ã‚‹äººã¯å°‘ãªã„ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚ã‚ˆã£ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ \u0026ldquo;å½±éŸ¿ç¯„å›²\u0026rdquo; ã‚’è€ƒæ…®ã—ã¤ã¤ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ¥ã‘ã¾ã—ãŸã€‚ã¾ãŸã€åŒã˜ç†ç”±ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ»CI/CD ã‚‚ ECS æœ¬ä½“ã¨ã¯å®Ÿè¡Œå˜ä½ã‚’åˆ¥ã‘ãŸæ–¹ãŒå¥½ã¾ã—ã„ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸ \u0026ldquo;ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ã‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ã‹\u0026rdquo; ã¨ã„ã†è¦³ç‚¹ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯é »ç¹ã«æ›´æ–°ã™ã‚‹ ECS æœ¬ä½“ã¨ã¯åˆ¥ã‘ã‚‹ã¹ãã§ã—ã‚‡ã†ã€‚\nã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã™ã‚‹éš›ã« Terraform Remote States æ©Ÿèƒ½ã‚’ç”¨ã„ã‚‹ æ§‹é€ åŒ–ãŒä¸Šè¨˜ã®é€šã‚Šã§ãã¾ã—ãŸãŒã€å…·ä½“çš„ã«ã©ã®æ§˜ã« Terraform ã®æ§‹é€ åŒ–ã‚’è¡Œã†ã®ã‹ã«ã¤ã„ã¦è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nä¸€æšå²©ã®ã‚³ãƒ¼ãƒ‰ã®å ´åˆã€å„ Resources é–“ã§ Resource ä½œæˆæ™‚ã«å¾—ã‚‰ã‚ŒãŸ id, name, arn ã®æ§˜ãª Attribute ã‚’å†åˆ©ç”¨ã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã¨æ€ã„ã¾ã™ã€‚ã§ã™ãŒ Terraform ã®æ§‹é€ åŒ–ã‚’è¡Œã†ã¨ Terraform ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå˜ä½ãŒç•°ãªã‚‹ã‚ã‘ã§ã™ã‹ã‚‰ãã†ã„ã£ãŸå‡¦ç½®ãŒè¡Œãˆã¾ã›ã‚“ã€‚ã ã‹ã‚‰ã¨è¨€ã£ã¦æ§‹é€ å˜ä½ã§ Variables ã«å€¤ã‚’æ ¼ç´ã—ã¦ã„ã¦ã¯å•é¡ŒãŒã‚ã‚‹ã®ã§ã€ã“ã“ã®å¯¾å‡¦æ³•ã¨ã—ã¦ Terraform ã® Remote State æ©Ÿèƒ½ã‚’ç”¨ã„ã¾ã™ã€‚ä¸‹è¨˜ã«ä¾‹ã‚’æŒ™ã’ã¦èª¬æ˜ã—ã¾ã™ã€‚\nä¸Šè¨˜æ§‹é€ ã® \u0026ldquo;ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u0026rdquo; å†…ã® provider.tf ã§ä¸‹è¨˜ã®ã‚ˆã†ã«è¨˜ã—ã¦ states ã‚’ s3 ã¸æ ¼ç´ã—ã¾ã™ã€‚\nterraform { required_version = \u0026#34;\u0026gt;= 0.12.0\u0026#34; backend \u0026#34;s3\u0026#34; { bucket = \u0026#34;example-bucket\u0026#34; key = \u0026#34;network/terraform.tfstate\u0026#34; region = \u0026#34;ap-northeast-1\u0026#34; encrypt = true } } \u0026ldquo;ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u0026rdquo; å†… vpc.tf ã§ä¸‹è¨˜ã®ã‚ˆã†ã« vpc ã‚’ä½œæˆã—ã¾ã™ã€‚\nresource \u0026#34;aws_vpc\u0026#34; \u0026#34;example\u0026#34; { cidr_block = \u0026#34;10.0.0.0/16\u0026#34; } \u0026ldquo;ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u0026rdquo; å†… output.tf ã§ä¸‹è¨˜ã®ã‚ˆã†ã« Terraform Output ã‚’æŒ‡å®šã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šåˆ¥ã®æ§‹é€ ã§å€¤ã‚’å†åˆ©ç”¨ã§ãã¾ã™ã€‚\noutput \u0026#34;example_vpc_id\u0026#34; { value = aws_vpc.example.id } ã™ã‚‹ã¨ \u0026ldquo;ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u0026rdquo; ä»¥å¤–ã®æ§‹é€  (ä¾‹ : ECS æœ¬ä½“ç­‰) ã§ä¸‹è¨˜ã®ã‚ˆã†ã« terraform_remote_state ã‚’è¨˜ã™ã¨\ndata \u0026#34;terraform_remote_state\u0026#34; \u0026#34;network\u0026#34; { backend = \u0026#34;s3\u0026#34; config = { bucket = \u0026#34;example-bucket\u0026#34; key = \u0026#34;network/terraform.tfstate\u0026#34; region = \u0026#34;ap-northeast-1\u0026#34; encrypt = true } } ä¸‹è¨˜ã®ã‚ˆã†ã«ä»–ã®æ§‹é€ (ã“ã®å ´åˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ VPC) ã‚’ä½œæˆã—ãŸéš›ã® Terraform Attribute ãŒå‘¼ã³å‡ºã›ã¾ã™ã€‚\nvpc_id = data.terraform_remote_state.network.outputs.example_vpc_id å®Ÿéš›ã®å‹•ãã¨ã—ã¦ã¯ vpc ã‚’ä½œæˆã—ãŸéš›ã® terraform tfstate ãŒ s3 ã«æ ¼ç´ã•ã‚Œã¦ã„ã¦ãã® s3 å†…ã® tfstate ã‚’ä»–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆæ™‚ã«å‘¼ã³å‡ºã™ã€ã¨ã„ã£ãŸã“ã¨ã‚’ã—ã¦ã„ã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ã«ã‚ˆã‚Šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã‚’å®¹æ˜“ã«å®Ÿç¾ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚\nECS æ§‹æˆ æ¬¡ã« ECS è‡ªä½“ã®æ§‹æˆãŒã©ã®æ§˜ãªã‚‚ã®ãŒæœ€é©ãªã®ã‹æ¤œè¨ã—ã¦ã„ãã¾ã™ã€‚\nè‡ªåˆ†ã¯ ECS ã®æ§‹æˆã‚’è€ƒãˆã‚‹ä¸Šã§é‡è¦ãªè¦ç´ ã¨ã—ã¦ä¸‹è¨˜ãŒã‚ã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚\nnetworkMode logDriver ã“ã‚Œã‚‰äºŒã¤ã«ã¤ã„ã¦è¨˜ã—ã¦ã„ãã¾ã™ã€‚\nnetworkMode ECS ã«ã‚ã‚‹ networkMode ã®ã©ã‚Œã‚’ç”¨ã„ã‚‹ã®ãŒãƒ™ã‚¹ãƒˆãªã®ã‹æ¤œè¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å¾Œè¿°ã™ã‚‹ãƒ­ã‚®ãƒ³ã‚°ã®æƒ…å ±ã¨åˆã‚ã›ã¦è€ƒãˆã‚‹ã®ã§ã€ã“ã“ã§ã¯ä¸€èˆ¬çš„ãªæƒ…å ±ã®ã¿ã‚’è¨˜ã—ã¦ãŠãã¾ã™ã€‚\nbridge ECS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä»»æ„ã®ãƒãƒ¼ãƒˆã‚’ã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ãƒˆã«ãƒãƒƒãƒ”ãƒ³ã‚° ECS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã® ENI ã‚’è¤‡æ•°ã®ã‚¿ã‚¹ã‚¯ãŒå…±æœ‰ã§åˆ©ç”¨ host ã‚³ãƒ³ãƒ†ãƒŠã§ expose ã—ãŸãƒãƒ¼ãƒˆã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚‚åˆ©ç”¨ ã‚ˆã£ã¦åŸºæœ¬ã€åŒã˜ãƒãƒ¼ãƒˆã‚’ç”¨ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚’è¤‡æ•°èµ·å‹•ã§ããªã„ awsvpc ENI ãŒã‚¿ã‚¹ã‚¯æ¯ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã‚‹ ã‚¿ã‚¹ã‚¯é–“ã§ã®ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã®è€ƒæ…®ä¸è¦ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå„ªã‚Œã¦ã„ã‚‹ ENI æ¯ã« SecurityGroup ã‚’ç´ã¥ã‘ ALB ã¨ NLB ã« IP ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨ã—ã¦ç™»éŒ²ãŒå¯èƒ½ çµæœçš„ã«ã¯ awsvpc ãŒãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çš„ã«ã‚‚å„ªã‚Œã¦ã„ã¦æœ€é©è§£ã§ã™ã€‚ã¾ãŸ logDriver fluentd ã®é€šä¿¡ã®ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ bridge ã‚‚æ¤œè¨ã™ã‚‹ã¹ãã ã¨è§£ã‚Šã¾ã™ãŒè©³ã—ãã¯å¾Œè¡“ã—ã¾ã™ã€‚\nlogDriver ECS ã®å ´åˆã®ãƒ­ã‚®ãƒ³ã‚°ã®é¸æŠè‚¢ã¨ã—ã¦ã¯ Cloudwatch Logs ã‹ Fluentd ã‹ã€ã¨ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚ãƒ­ã‚°ã®æ ¼ç´å…ˆã¯ä½•ãŒè€ƒãˆã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã‹ã€‚s3, cloudwatch logs, elasticsearch ã‚’é€šå¸¸è€ƒãˆã‚‹ã¨æ€ã„ã¾ã™ãŒã€æ ¼ç´ã—ãŸå¾Œã®ãƒ­ã‚°ã®å†åˆ©ç”¨ã‚’è€ƒãˆã‚‹ã¨ã©ã†ãªã‚‹ã§ã—ã‚‡ã†ã€‚è‡ªåˆ†ã¯ Elasticsearch ã«ãƒ­ã‚°ã‚’æ ¼ç´ã—ã¦ Kibana ã§å¯è¦–åŒ–ã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã®ã§ã™ãŒã€ã“ã“ã§æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚Cloudwatch Logs ã‹ã‚‰ Elasticsearch Service ã¸ãƒ­ã‚°ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ã™ã‚‹éš›ã«åœ§ç¸®ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å±•é–‹ã—ã¤ã¤ã‚¹ãƒˆãƒªãƒ¼ãƒ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’ Terraform ã§ã‚³ãƒ¼ãƒ‰åŒ–ã™ã‚‹ã®ã¯çµæ§‹å„ä»‹ã§ã™ã€‚å…·ä½“çš„ã«ã¯ Lambda Function ã‚’ä½œæˆã—ã¦ Python or Nodejs ã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã Firehose ã‚’ä½¿ã£ã¦ Elasticsearch Service ã¸ç¹‹ãè¾¼ã¿ã¾ã™ã€‚ãã®ç‚¹ã§ã¯ Fluentd -\u0026gt; Elasticsearch Service ã¨ç›´æ¥ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡ºæ¥ã‚Œã°éƒ½åˆãŒã„ã„ã§ã™ã€‚ã¨ã„ã†ã“ã¨ã¯ Fluentd ä¸€æŠï¼Ÿã¨è€ƒãˆãŸã„ã¨ã“ã‚ãªã®ã§ã™ãŒ\u0026hellip; Fluentd ã‚’ ECS ã§æ‰±ã†ã“ã¨ã‚’è€ƒãˆã‚‹ã¨çµæ§‹æ§‹æˆã«æ‚©ã¿ã¾ã™ã€‚\nè€ƒæ…®ç‚¹ã‚’è¸ã¾ãˆãŸçµæœã® ECS æ§‹æˆ çµæœã€networkMode, logDriver ã®æ¤œè¨ã‚’è¡Œã†ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªæ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ãŒé¸æŠè‚¢ã¨ã—ã¦ã‚ã’ã‚‰ã‚Œã¾ã™ã€‚\nECS/Fargate æ§‹æˆã®å ´åˆ networkMode : awsvpc logDriver : awslogs -\u0026gt; cloudwatch logs ECS/EC2 æ§‹æˆã®å ´åˆ æ§‹æˆ(2)\nnetworkMode : awsvpc logDriver : awslogs -\u0026gt; cloudwatch logs æ§‹æˆ(3)\nnetworkMode : awsvpc logDriver : fluentd é€šä¿¡ : socket èµ·å‹•ã‚¿ã‚¤ãƒ— : daemon type -\u0026gt; s3, cloudwatch logs, elasticsearch service æ§‹æˆ(4)\nnetworkMode : bridge logDriver : fluentd é€šä¿¡ : tcp èµ·å‹•ã‚¿ã‚¤ãƒ— : daemon type -\u0026gt; s3, cloudwatch logs, elasticsearch service æ§‹æˆ(5)\nnetworkMode : awsvpc logDriver : fluentd é€šä¿¡ : socket èµ·å‹•ã‚¿ã‚¤ãƒ— : sidecar -\u0026gt; s3, cloudwatch logs, elasticsearch service æ§‹æˆ(6)\nnetworkMode : bridge logDriver : fluentd é€šä¿¡ : tcp èµ·å‹•ã‚¿ã‚¤ãƒ— : sidecar -\u0026gt; s3, cloudwatch logs, elasticsearch service ä¸Šè¨˜æ§‹æˆæ¡ˆã®èª¬æ˜ã¨çµæœ çµæœã¨ã—ã¦ ECS/Fargate ã‚’ç”¨ã„ã‚‹å ´åˆã¯ logDriver fluentd ãŒã¾ã ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ã®ã§ (2019/10æ™‚ç‚¹)ã€awslogs ã¨ãªã‚Š cloudwatch logs ã‚’ãƒ­ã‚°æ ¼ç´å…ˆã¨ã—ã¦é¸æŠã›ã–ã‚‹ã‚’å¾—ãªã„ã§ã™ã€‚\nã¾ãŸ ECS/EC2 æ§‹æˆã®å ´åˆã¯çµè«–ã‚’è¨€ã†ã¨æ§‹æˆ (5), (6) ã¯ sidecar æ§‹æˆã§ fluentd ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¦éš£æ¥ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°ã‚’è»¢é€ã™ã‚‹ã®ã§ã™ãŒã€ã“ã®æ§‹æˆã‚’ã¨ã‚‹å ´åˆä¸‹è¨˜ãŒåŸå‰‡ã«ãªã‚Šã¾ã™ã€‚\nã€Œ1ã‚¿ã‚¹ã‚¯ / 1ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€\nã“ã‚Œã¯ fluentd ã§ç”¨ã„ã‚‹é€šä¿¡ãŒ socket, tcp ã«é–¢ã‚ã‚‰ãšã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†…ã®ä¸€ã¤ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’è¤‡æ•°ã‚¿ã‚¹ã‚¯ã§å…±æœ‰ã™ã‚‹ã“ã¨ãŒã§ããªã„ã‹ã‚‰ã§ã™ã€‚1ã‚¿ã‚¹ã‚¯/1ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚‚ã‚µãƒ¼ãƒ“ã‚¹ã¯æä¾›ã§ãã¾ã™ã—è€ƒãˆã‚‹ã“ã¨ã¯å°‘ãªããªã‚‹ã®ã§ã™ãŒãã†ã™ã‚‹ã¨ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ã©ã®ã‚ˆã†ãªå½±éŸ¿ã‚’ä¸ãˆã‚‹ã‹ã¯è€ƒæ…®ã—ã¦ãŠã„ãŸæ–¹ãŒã„ã„ã§ã™ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ç™ºç”Ÿæ™‚ã«ã‚¯ãƒ©ã‚¹ã‚¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«ãŒç™ºç”Ÿã™ã‚‹äº‹ã¯ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã‚ˆã£ã¦ã¯è‰¯ã„ã¨ã¯è€ƒãˆãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚æ§‹æˆ(3), (4) ãªã‚‰ã€Œnã‚¿ã‚¹ã‚¯/1ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€ã®æ§‹æˆãŒå¯èƒ½ã§ autoscaling policy configuration ã‚’ã†ã¾ãè¨­è¨ˆã™ã‚Œã°ã§ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã‚‚ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«ãŒç™ºå‹•ã›ãšã«æ¸ˆã¿ã¾ã™ã€‚\nã“ã® sidecar æ§‹æˆã®ã‚¿ã‚¹ã‚¯ã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®é–¢ä¿‚ã«ã¤ã„ã¦ã‚‚ã†å°‘ã—è¨˜ã™ã¨\u0026hellip;ã€\nä¸‹è¨˜ã¯ tcp ã®å ´åˆã®ã‚³ãƒ³ãƒ†ãƒŠå®šç¾©å†… logConfiguration ã§ã™ã€‚ã“ã®å ´åˆã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®24224ãƒãƒ¼ãƒˆã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚ã¾ãŸ fluentd ã‚³ãƒ³ãƒ†ãƒŠã¯ portMappings ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ public (ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹) ã® 24224 ãƒãƒ¼ãƒˆã‚’ binding ã—ã¦ã„ã‚‹ãŸã‚ã€1ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§1 fluentd ã‚³ãƒ³ãƒ†ãƒŠã—ã‹èµ·å‹•å‡ºæ¥ãªã„ã€‚ã¤ã¾ã‚Š1ã‚¿ã‚¹ã‚¯/1ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€‚\n\u0026#34;logConfiguration\u0026#34;: { \u0026#34;logDriver\u0026#34;: \u0026#34;fluentd\u0026#34;, \u0026#34;options\u0026#34;: { \u0026#34;fluentd-address\u0026#34;: \u0026#34;localhost:24224\u0026#34;, ãã—ã¦ã“ã¡ã‚‰ã¯ socket ã®å ´åˆã‚³ãƒ³ãƒ†ãƒŠå®šç¾©å†… logConfigurationã€‚ã“ã®å ´åˆã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã® volume ã‚’ ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ãŸã‚1ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã«1 fluentd ã‚³ãƒ³ãƒ†ãƒŠã—ã‹èµ·å‹•ã—ãªã„ã€‚ã¤ã¾ã‚Š1ã‚¿ã‚¹ã‚¯/1ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹\n\u0026#34;logConfiguration\u0026#34;: { \u0026#34;logDriver\u0026#34;: \u0026#34;fluentd\u0026#34;, \u0026#34;options\u0026#34;: { \u0026#34;fluentd-address\u0026#34;: \u0026#34;unix:///var/run/fluent/fluent.sock\u0026#34;, ã¾ãŸ(3), (4) ã® daemon type ã«ã¤ã„ã¦ç°¡å˜ã«è¿°ã¹ã‚‹ã¨ã€ECS/EC2 ã®ã‚¯ãƒ©ã‚¹ã‚¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹1ã¤ã«å¯¾ã—ã¦å¿…ãš1ã¤ã® fluentd ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã•ã›ã‚‹èµ·å‹•ãƒ¢ãƒ¼ãƒ‰ã®ã“ã¨ã‚’è¨€ã„ã¾ã™ã€‚(https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/ecs_services.html)\nã‚ˆã£ã¦ã€Fargate ã‚’ç”¨ã„ã‚‹å ´åˆã¯æ§‹æˆ(1)ã§ EC2 æ§‹æˆã®å ´åˆã¯æ§‹æˆ(2), (3), (4) ã¨ãªã‚‹ã§ã—ã‚‡ã†ã‹ã€‚\nã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ å›³ã‚’æãã¨ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚å¤§ä½“æ§‹æˆãŒæ±ºã¾ã£ã¦ãã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚\næ§‹æˆ(1), (2), (3), (4)ã®å ´åˆ +---------------------+ + | instance / fargate | ... | +---------------------+ | +------+ +------+ | ap-northeast-1a | task | | task | ... | +------+ +------+ | | + +---------------------+ | alb | +---------------------+ | + +------+ +------+ | | task | | task | ... | +------+ +------+ | ap-northeast-1c +---------------------+ | | instance / fargate | ... | +---------------------+ + æ§‹æˆ (5), (6) ã®å ´åˆ +----------+ + | instance | ... | +----------+ | +----------+ | ap-northeast-1a | task | ... | +----------+ | | + +---------------------+ | alb | +---------------------+ | + +----------+ | | task | ... | +----------+ | ap-northeast-1c +----------+ | | instance | ... | +----------+ + ãƒãƒƒãƒã«ã¤ã„ã¦æ¤œè¨ ãƒãƒƒãƒå‡¦ç†ã‚‚ ECS ã‚’ä½¿ã£ã¦è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®å ´åˆã®æ§‹æˆã‚’è€ƒãˆã‚‹ã¨ä¸‹è¨˜ãŒé¸æŠè‚¢ã¨ã—ã¦æ®‹ã‚Šã¾ã—ãŸã€‚\nFargate networkMode : awsvpc logDriver : awslogs æ§‹æˆã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ä¸‹è¨˜ã®æ§˜ã«ãªã‚Šã¾ã™ã€‚\n+---------+ +------------------+ | task | \u0026lt;--- | cloudwatch event | +---------+ +------------------+ +---------+ | Fargate | +---------+ ã“ã®æ§‹æˆã«ãªã£ãŸã®ã¯ ECS/EC2 æ§‹æˆã®å ´åˆã«æ§‹æˆä¸Šã®å•é¡ŒãŒã‚ã‚‹ã“ã¨ãŒç™ºè¦šã—ãŸã‹ã‚‰ã§ã™ã€‚EC2 ã®å ´åˆ ECS Service ã‚’èµ·å‹•ã—ãªã„ã¨ãƒãƒƒãƒã®ãŸã‚ã® Task ãŒèµ·å‹•ã—ãªã„ã®ã§ daemon ã¨ã—ã¦ä½•ã‹ã—ã‚‰ã®ã‚¿ã‚¹ã‚¯ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã«å¸¸æ™‚ç¨¼åƒã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã—ã¦ aws_cloudwatch_event_target ã§ä¸‹è¨˜ã®é€šã‚Šã‚³ãƒ³ãƒ†ãƒŠå®šç¾©ã‚’ä¸Šæ›¸ãã™ã‚‹ã“ã¨ã§ãƒãƒƒãƒå‡¦ç†ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚\n{ \u0026#34;containerOverrides\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;nginx\u0026#34;, \u0026#34;command\u0026#34;: [\u0026#34;ãƒãƒƒãƒå‡¦ç†ã®ã‚³ãƒãƒ³ãƒ‰\u0026#34;] } ] } ã‚ˆã£ã¦å¸¸æ™‚ç¨¼åƒã•ã›ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚„ ECS Service ã®ãƒªã‚½ãƒ¼ã‚¹ãŒç„¡é§„ã«ä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ãã†ã„ã£ãŸç‚¹ã§ ECS/Fargate ã®å ´åˆã¯ç„¡é§„ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’èµ·å‹•ã—ãªãã¦ã„ã„ã€ã¨ã„ã†ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚\nCI/CD CI/CD ã«ã¤ã„ã¦è€ƒãˆã¾ã™ã€‚ä¸‹è¨˜ã®ã‚ˆã†ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨å‡¦ç†ã®æµã‚Œã‚’æƒ³å®šã—ã¾ã™ã€‚ã“ã“ã§ã¯ CircleCI ã§ã¯ãªã CodeBuild, CodePipeline ã‚’æƒ³å®šã—ã¾ã™ã€‚\n+--------+ +-----------+ +--------------+ +---------------------+ | Github | - webhook -\u0026gt; | Codebuild | -\u0026gt; | CodePipeline | -\u0026gt; | ECS Cluster/Service | +--------+ +-----------+ +--------------+ +---------------------+ å‡¦ç†ã®æµã‚Œ\n(1) Github ã®æŒ‡å®šãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸã®ã‚’ãƒˆãƒªã‚¬ãƒ¼ã« CodeBuild ã§ã‚³ãƒ³ãƒ†ãƒŠãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹ã€‚ãƒ“ãƒ«ãƒ‰æƒ…å ±ã¯ buildspec.yml ã«æŒ‡å®š (2) ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸçµæœ imagedefinitions.json ãŒç”Ÿæˆã•ã‚Œã‚‹ (3) imagedefinitions.json ã‚’å…ƒã« CodePipeline ã‚’çµŒç”±ã—ã¦ ECS Clusnter/Service ã«ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿæ–½ (4) rolling-update ãŒå®Ÿæ–½ã•ã‚Œã‚‹ ä¸‹è¨˜ã¯ buildspec.ymlã€‚\nversion: 0.2 phases: pre_build: commands: - $(aws ecr get-login --region $AWS_DEFAULT_REGION --no-include-email) - WEB_REPO=$(aws ecr describe-repositories --repository-names web --output text --query \u0026#34;repositories[0].repositoryUri\u0026#34;) - WEB_IMAGE=$WEB_REPO:latest - APP_REPO=$(aws ecr describe-repositories --repository-names app --output text --query \u0026#34;repositories[0].repositoryUri\u0026#34;) - APP_IMAGE=$APP_REPO:latest build: commands: - docker build -t $WEB_IMAGE ./web - docker push $WEB_IMAGE - docker build -t $APP_IMAGE ./app - docker push $APP_IMAGE post_build: commands: - printf \u0026#39;[{\u0026#34;name\u0026#34;:\u0026#34;web\u0026#34;,\u0026#34;imageUri\u0026#34;:\u0026#34;%s\u0026#34;}, {\u0026#34;name\u0026#34;:\u0026#34;app\u0026#34;,\u0026#34;imageUri\u0026#34;:\u0026#34;%s\u0026#34;}]\u0026#39; $WEB_IMAGE $APP_IMAGE \u0026gt; imagedefinitions.json artifacts: files: - imagedefinitions.json ã¾ã¨ã‚ networkMode, logDriver ã‚’è€ƒãˆã‚‹ä¸­ã§æ§‹æˆãŒæ±ºã¾ã‚Šã¾ã—ãŸã€‚ã¾ãŸ Terraform ã§ã‚³ãƒ¼ãƒ‰åŒ–ã™ã‚‹éš›ã®æ§‹é€ åŒ–ã«ã¤ã„ã¦ã®è€ƒãˆã‚’ã¾ã¨ã‚ã€ä»˜éšã™ã‚‹ CI/CD, ãƒãƒƒãƒã«ã¤ã„ã¦ã‚‚ã¾ã¨ã‚ã¾ã—ãŸã€‚å®Œæˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯å¿…ç„¶çš„ã«ã‚·ãƒ³ãƒ—ãƒ«ãªã‚‚ã®ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸ ECS/Fargate æ§‹æˆã§ã® logDriver ã® fluentd å¯¾å¿œã«ã¤ã„ã¦ã¯ä»Šé€²ã‚“ã§ã„ã‚‹æœ€ä¸­ã¨ã®ã“ã¨ã§ã€æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚ãã†ã™ã‚‹ã¨2019å¹´åˆã‚ã®ã‚³ã‚¹ãƒˆãƒ€ã‚¦ãƒ³ã¨ç›¸ã¾ã£ã¦ã‚ˆã‚Š Fargate ã‚’é¸æŠã—ã‚„ã™ã„çŠ¶æ³ã«ãªã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚\n","permalink":"https://jedipunkz.github.io/post/ecs/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ AWS ECS ã«ã¤ã„ã¦ã§ã™ã€‚ç›´è¿‘ã®ä»•äº‹ã§ ECS ã® Terraform ã‚³ãƒ¼ãƒ‰é–‹ç™ºã‚’ã—ã¦ã„ãŸã®ã§ã™ãŒã‚³ãƒ¼ãƒ‰ã®æ§‹é€ åŒ–ã«ã¤ã„ã¦è€ƒãˆã¦ã„ã¾ã—ãŸã€‚ä¸€æšå²©ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã‚‚é‹ç”¨ã«è€ãˆã‚‰ã‚Œã‚‹ã¨ã¯è€ƒãˆã‚‰ã‚Œã¾ã›ã‚“ã€‚ã¾ãŸ ECS ã‚’æ§‹æˆã™ã‚‹ã«ã‚ãŸã£ã¦ ECS ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã¨ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚®ãƒ³ã‚°ã«ã¤ã„ã¦è€ƒãˆã¦ã„ã‚‹ã†ã¡ã«ã€ã©ã®æ§‹æˆãŒä¸€ç•ªé©ã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿã«ã¤ã„ã¦æ™‚é–“ã‚’æ›ã‘ã¦è€ƒãˆã¾ã—ãŸã€‚ã“ã“ã§ã¯ãã‚Œã‚‰ã«ã¤ã„ã¦ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"terraform-ã‚³ãƒ¼ãƒ‰ã®æ§‹é€ åŒ–\"\u003eTerraform ã‚³ãƒ¼ãƒ‰ã®æ§‹é€ åŒ–\u003c/h2\u003e\n\u003cp\u003eé‹ç”¨ã®ç²¾ç¥çš„ãªè² æ‹…ã‚’è»½æ¸›ã™ã‚‹ã¨ã„ã†è¦³ç‚¹ã§ Terraform ã®ã‚³ãƒ¼ãƒ‰é–‹ç™ºã‚’ã™ã‚‹ä¸Šã§ä¸€ç•ªé‡è¦ãªã®ã¯ã‚³ãƒ¼ãƒ‰ã®æ§‹é€ åŒ–ã ã¨æ€ã„ã¾ã™ã€‚å‰å›ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã«æ›¸ã„ãŸã®ã§ã™ãŒã‚³ãƒ¼ãƒ‰ã®æ§‹é€ åŒ–ã‚’ã™ã‚‹ä¸Šã§ä¸‹è¨˜ã«ç•™æ„ã—ã¦è€ƒãˆã‚‹ã¨è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå½±éŸ¿ç¯„å›²\u003c/li\u003e\n\u003cli\u003eã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ã‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ã‹\u003c/li\u003e\n\u003cli\u003eå®‰å®šåº¦\u003c/li\u003e\n\u003cli\u003eãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eçµæœã€å…·ä½“çš„ã« Terraform ã®ã‚³ãƒ¼ãƒ‰ã¯ã©ã®ã‚ˆã†ãªæ§‹é€ ã«ãªã‚‹ã§ã—ã‚‡ã†ã‹ã€‚è‡ªåˆ†ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã—ã¦ Terraform ã®å®Ÿè¡Œå˜ä½ã‚’åˆ¥ã‘ã¾ã—ãŸã€‚ã“ã“ã¯äººãã‚Œãã‚Œã ã¨æ€ã„ã¾ã™ãŒã€ECS æœ¬ä½“ã¨ ECS ã®å‘¨è¾º AWS ã‚µãƒ¼ãƒ“ã‚¹ã®ä¸€èˆ¬çš„ãªç‰©ã‚’è€ƒæ…®ã—ã¤ã¤ã€ã„ã‹ã«ã‚·ãƒ³ãƒ—ãƒ«ã«æ§‹é€ åŒ–ã™ã‚‹ã‹ã‚’è€ƒãˆã‚‹ã¨è‡ªç„¶ã¨ä¸‹è¨˜ã®åŒºåˆ†ã‘ã«ãªã‚‹æ°—ãŒã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\u003c/th\u003e\n          \u003cth\u003eå…·ä½“çš„ãªãƒªã‚½ãƒ¼ã‚¹\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u003c/td\u003e\n          \u003ctd\u003evpc, route table, igw, endpoint, subnet\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eECS æœ¬ä½“\u003c/td\u003e\n          \u003ctd\u003eecs, alb, autoscaling, cloudwatch, iam\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eCI/CD\u003c/td\u003e\n          \u003ctd\u003ecodebuild, codepipeline, ecr, iam\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿\u003c/td\u003e\n          \u003ctd\u003essm, kms\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢\u003c/td\u003e\n          \u003ctd\u003es3, rds, elasticache \u0026hellip;\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003evpc ã‚„ subnet ã«é–¢ã—ã¦é »ç¹ã«æ›´æ–°ã‚’æ›ã‘ã‚‹äººã¯å°‘ãªã„ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚ã‚ˆã£ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ \u0026ldquo;å½±éŸ¿ç¯„å›²\u0026rdquo; ã‚’è€ƒæ…®ã—ã¤ã¤ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ¥ã‘ã¾ã—ãŸã€‚ã¾ãŸã€åŒã˜ç†ç”±ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ»CI/CD ã‚‚ ECS æœ¬ä½“ã¨ã¯å®Ÿè¡Œå˜ä½ã‚’åˆ¥ã‘ãŸæ–¹ãŒå¥½ã¾ã—ã„ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸ \u0026ldquo;ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ã‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ã‹\u0026rdquo; ã¨ã„ã†è¦³ç‚¹ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯é »ç¹ã«æ›´æ–°ã™ã‚‹ ECS æœ¬ä½“ã¨ã¯åˆ¥ã‘ã‚‹ã¹ãã§ã—ã‚‡ã†ã€‚\u003c/p\u003e","title":"ECS ã®æ§‹æˆã¨ Terraform ã‚³ãƒ¼ãƒ‰åŒ–ã™ã‚‹éš›ã®æ§‹é€ åŒ–ã«ã¤ã„ã¦"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šå›ã¯é›»å­æ›¸ç± \u0026lsquo;Pragmatic Terraform on AWS\u0026rsquo; ã‚’èª­ã‚“ã§ã¨ã¦ã‚‚å†…å®¹ãŒç´ æ™´ã‚‰ã—ã‹ã£ãŸã®ã§ç´¹ä»‹ã•ã›ã¦é ‚ãã¾ã™ã€‚æ›¸ç±ã®è³¼å…¥ã¯ä¸‹è¨˜ã® URL ã‹ã‚‰å¯èƒ½ã§ã™ã€‚\nhttps://booth.pm/ja/items/1318735\nãƒ–ãƒ­ã‚°è¨˜äº‹ã§ã¯æ›¸ç±ã®ç´°ã‹ã„å†…å®¹ã«ã¤ã„ã¦ã¯è¿°ã¹ã¾ã›ã‚“ã€‚ã“ã‚Œã‹ã‚‰è³¼å…¥ã•ã‚Œã‚‹æ–¹ã€…ãŒè²·ã†æ„æ¬²ã‚’ç„¡ãã™ã‚ˆã†ãªãƒ–ãƒ­ã‚°è¨˜äº‹ã«ã—ãŸããªã„ã‹ã‚‰ã§ã™ã€‚ãªã®ã§ã“ã®ãƒ–ãƒ­ã‚°ã§ã¯è‡ªåˆ†ãŒ Terraform é‹ç”¨ã«ã¤ã„ã¦æ„Ÿã˜ã¦ã„ãŸå•é¡Œç‚¹ã¨ã“ã®é›»å­æ›¸ç±ãŒã©ã†è§£æ±ºã—ã¦ãã‚ŒãŸã®ã‹ã«ã¤ã„ã¦è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nè‡ªåˆ†ãŒ Terraform é‹ç”¨ã§æ„Ÿã˜ã¦ã„ãŸå•é¡Œç‚¹ Terraform ã‚’ä½¿ã£ãŸã‚¤ãƒ³ãƒ•ãƒ©ã‚³ãƒ¼ãƒ‰åŒ–ã¨æ§‹ç¯‰ã¯è‡ªåˆ†ã®çµæ§‹çµŒé¨“ãŒã‚ã‚‹ã®ã§ã™ãŒã€ãã®æ§‹ç¯‰ã«ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ã§æ§‹æˆã‚’é‹ç”¨ã™ã‚‹é›£ã—ã•ã¯ã„ã¤ã‚‚æ„Ÿã˜ã¦ã„ã¾ã—ãŸã€‚Terraform ã‚’ä½¿ã£ãŸç¶™ç¶šçš„ãªã‚¤ãƒ³ãƒ•ãƒ©ã®é‹ç”¨ã«ã¤ã„ã¦ã§ã™ã€‚å…·ä½“çš„ã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªç–‘å•ã¨è¨€ã„ã¾ã™ã‹å•é¡Œç‚¹ã§ã™ã€‚\n(1) ã©ã®ã‚ˆã†ãªå®Ÿè¡Œå˜ä½ã§ .tf ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã‹ (2) å‰Šé™¤ç³»ãƒ»ä¿®æ­£ç³»ã®æ“ä½œã‚‚ Terraform ã§è¡Œã†ã®ã‹ (3) ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ãªã‚¤ãƒ³ãƒ•ãƒ©ã¨ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ãªã‚¤ãƒ³ãƒ•ãƒ©ã®ç®¡ç†æ–¹æ³• (1) ã¯ terraform plan/apply ã‚’å®Ÿè¡Œã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ§‹é€ ã«ã¤ã„ã¦ã§ã™ã€‚Terraform ã¯åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã«ã‚ã‚‹ .tf ãƒ•ã‚¡ã‚¤ãƒ«å…¨ã¦ã‚’èª­ã¿è¾¼ã‚“ã§ãã‚Œã¾ã™ã—ä¸€æ–‰ã«ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ã§ã™ãŒã€ä½•ã‹ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ä¿®æ­£ãƒ»å‰Šé™¤ã—ãŸã„å ´åˆã€å‰Šé™¤ã—ã¦ã¯ã„ã‘ãªã„ãƒªã‚½ãƒ¼ã‚¹ã‚‚åŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã® .tf ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã—ã¦ã„ã‚‹ã‚ã‘ã§ã™ã‹ã‚‰ä½•ã‹ã—ã‚‰ã®ãƒŸã‚¹ã§å¤§äº‹ãªã‚¤ãƒ³ãƒ•ãƒ©ã«å½±éŸ¿ã‚’ä¸ãˆã¦ã—ã¾ã†äº‹ã«ãªã‚Šã¾ã™ã€‚å½±éŸ¿ç¯„å›²ãŒå¤§ãã™ãã‚‹ã®ã§ã™ã€‚\n(2) ã¯ã€\u0026lsquo;åˆæœŸã®æ§‹æˆã®ã¿ã‚’ Terraform ã§æ§‹ç¯‰è‡ªå‹•åŒ–ã™ã‚‹\u0026rsquo; ã®ã‹ã©ã†ã‹ã€ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚æ§‹ç¯‰ã«ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ã§ç¶™ç¶šçš„ã«å‰Šé™¤ç³»ãƒ»ä¿®æ­£ç³»ã®æ“ä½œã‚‚è¡Œã†ã®ã‹ã€‚ã“ã‚Œã‚‚ (1) ã¨åŒæ§˜ã«ç®¡ç†ã™ã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã®è¦æ¨¡ãŒå¤§ãããªã‚‹ã¨å½±éŸ¿ç¯„å›²ãŒå¤§ãããªã‚Šã€é‹ç”¨è€…ã®ç²¾ç¥çš„è² æ‹…ãŒå¢—ã—ã¾ã™ã€‚\n(3) ã¯ RDS, S3 ç­‰ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ãªã‚¤ãƒ³ãƒ•ãƒ©ã¨ã€ãã‚Œä»¥å¤–ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ãªã‚¤ãƒ³ãƒ•ãƒ©ã‚’åŒã˜ .tf ã‚³ãƒ¼ãƒ‰ã§ç®¡ç†ã—ã¦ã„ã„ã®ã‹ã€ã¨ã„ã†ç–‘å•ã§ã™ã€‚ä¿®æ­£ãƒ»å‰Šé™¤ãŒå¤šç™ºã™ã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã¯ .tf ã‚³ãƒ¼ãƒ‰ã§ç¶™ç¶šçš„ã«é‹ç”¨å‡ºæ¥ãŸã¨ã—ã¦ã‚‚ã€RDS, S3 ã®æ§˜ãªçŠ¶æ…‹ãŒé‡è¦ã«ãªã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã¯æ»…å¤šã«å‰Šé™¤ãƒ»ä¿®æ­£æ“ä½œã¯é€šå¸¸è¡Œã„ã¾ã›ã‚“ã€‚ã“ã‚Œã‚‰äºŒç¨®é¡ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚’åŒã˜ã‚ˆã†ã«ç®¡ç†ã—ã¦ã—ã¾ã£ã¦ã„ã„ã®ã‹ï¼Ÿã¨ã„ã†ç–‘å•ã§ã™ã€‚\nã“ã‚Œã‚‰ã®ç–‘å•ã‚„æ€ã£ã¦ã„ãŸå•é¡Œç‚¹ã«ã¤ã„ã¦ã€ã“ã® \u0026lsquo;Pragmatic Terraform on AWS\u0026rsquo; ã¯å…¨ã¦è§£æ±ºã—ã¦ãã‚Œã¾ã—ãŸã€‚\nPragmatic Terraform on AWS ã®æ§‹æˆ ç« ã”ã¨ã®èª¬æ˜ã¯è©³ç´°ã«ã¯æ›¸ãã¾ã›ã‚“ãŒã€å¤§ä½“ã®æµã‚Œã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚\n(1) åŸºæœ¬çš„ãªåˆ©ç”¨æ–¹æ³• (2) Tips é›† (3) ECS Fargate ã‚’ä¸­å¿ƒã«ã—ãŸå®Ÿè·µçš„ãªæ§‹æˆã®ã‚³ãƒ¼ãƒ‰åŒ– (4) æ§‹é€ åŒ– (5) ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ (6) ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ (2) Tips é›†ã«ã¤ã„ã¦ å¸­ã«è¿°ã¹ãŸã‚ˆã†ã«è‡ªåˆ†ã¯ Terraform ã®çµŒé¨“ãŒçµæ§‹ã‚ã‚‹æ–¹ã ã¨æ€ã†ã®ã§ã™ãŒã€ãã‚Œã§ã‚‚çŸ¥ã‚‰ãªã„ Terraform ã®æ©Ÿèƒ½ãŒè¤‡æ•°ã‚ã‚Šã¾ã—ãŸã€‚ç‰¹ã« Terraform åˆ©ç”¨è€…ã«ã¨ã£ã¦ã€è¦ç‚¹ã ã‘ã‚’ãŠã•ãˆãŸèª¬æ˜æ–‡ã¨å…±ã«æ¬¡ã€…ã«å¤šãã® Tips ã‚’èª¬æ˜ã—ã¦ãã‚Œã‚‹ã“ã®ç« ã¯ã¨ã¦ã‚‚æ„å‘³ãŒã‚ã‚‹ã‚‚ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚ç´ æ™´ã‚‰ã—ã„ã§ã™ã€‚\n(3) ECS Fargate ã‚’ä¸­å¿ƒã«ã—ãŸå®Ÿè·µçš„ãªæ§‹æˆã®ã‚³ãƒ¼ãƒ‰åŒ– è³›å¦ä¸¡è«–ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒ2019å¹´ç¾åœ¨ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ§‹æˆã—ã‚ˆã†ã¨ã™ã‚‹ã¨ GKE ã‹ ECS ã‹ EKS ã‹ã®3æŠãªã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚ç‰¹ã«ã‚µãƒ¼ãƒ“ã‚¹ãƒ»ãƒ—ãƒ­ãƒã‚¤ãƒ€ã«ã¨ã£ã¦ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã¯ä¸»æµã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚ãã®ä¸­ã§ã‚‚å›½å†…ã§ã¯ AWS ã®åˆ©ç”¨ç‡ãŒé«˜ã„ã‚ã‘ã§ã™ã‹ã‚‰ ECS ã‚’ç†è§£ã—ã¦ãŠãã“ã¨ã¯ã‚¤ãƒ³ãƒ•ãƒ©ç³»ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã¨ã£ã¦éå¸¸ã«é‡è¦ã«ãªã‚Šã¾ã™ã€‚\nã“ã®ç« ã§ã¯ ECS Fargate ã‚’ä¸­å¿ƒã¨ã—ã¦ä¸‹è¨˜ã®ã‚ˆã†ãªç‰¹å¾´ã‚’æŒã£ãŸã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚³ãƒ¼ãƒ‰åŒ–ã™ã‚‹ã¨ã„ã†å®Ÿè·µçš„ãªã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚\nECS ã¨ãã®è£å´ã«ã‚ã‚‹ ALB, IAM, VPC ç­‰ã®åŸºæœ¬çš„ãªæ§‹æˆæ§‹ç¯‰ ECS ã«ã‚ˆã‚‹ Web ã‚µãƒ¼ãƒ“ã‚¹ãƒ»ECS ã«ã‚ˆã‚‹ãƒãƒƒãƒã‚µãƒ¼ãƒ“ã‚¹æ§‹æˆæ§‹ç¯‰ éµç®¡ç† è¨­å®šç®¡ç† ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ ãƒ­ã‚®ãƒ³ã‚° ç‰¹ã« CodePipeline, Github, ECR ã‚’ä½¿ã£ãŸã‚³ãƒ³ãƒ†ãƒŠã®ç¶™ç¶šçš„ãƒ‡ãƒ—ãƒ­ã‚¤ã«é–¢ã™ã‚‹èª¬æ˜ã¨ã€Cloudwatch Logs, S3, Athena, Kinesis Data Firehose ã‚’ä½¿ã£ãŸãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ã‚’ä¸Šã’ã‚‹ã¨ã„ã†æ„å‘³ã§ã®ãƒ­ã‚°ç®¡ç†ã®èª¬æ˜ã¯ã€ã€Œã“ã“ã¾ã§å®Ÿè·µçš„ãªèª¬æ˜ã—ã¦ãã‚Œã‚‹ã®ã‹ã€ã¨ã„ã†å°è±¡ã‚’æŒã¡ã¾ã—ãŸã€‚2019å¹´æ™‚ç‚¹ã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’ã—ã¦ã„ã‚‹æ–¹ã¯é§†ã‚‰ãšç†è§£ã—ã¦ãŠãã¹ãå†…å®¹ã ã¨æ€ã„ã¾ã™ã€‚\n(4) æ§‹é€ åŒ– ã“ã“ãŒè‡ªåˆ†çš„ã«ã¯ä¸€ç•ªçŸ¥ã‚ŠãŸã‹ã£ãŸå†…å®¹ã§ã—ãŸã€‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ–­ç‰‡çš„ãªæƒ…å ±ã¯ã‚ã£ã¦ã‚‚ã€ã‚„ã¯ã‚Š Terraform ãƒ¦ãƒ¼ã‚¶ã®ç”Ÿã®å£°ã‚’èããŸã„ãªã¨æ„Ÿã˜ã¦ã„ãŸã®ã§ã€ã“ã®ç« ã¯éå¸¸ã«è‡ªåˆ†ã«ã¨ã£ã¦å½¹ç«‹ã¤ã‚‚ã®ã§ã—ãŸã€‚\nèª°ã§ã‚‚æ€ã„ã¤ã .tf ã‚³ãƒ¼ãƒ‰ã®åˆ†é›¢ãƒ»åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç®¡ç†ãƒ»åˆ¥ãƒ¬ãƒã‚¸ãƒˆãƒªç®¡ç†ã‹ã‚‰ã€ä½•ã‚’æ„è­˜ã—ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã™ã‚‹ã‹ã®è€ƒãˆæ–¹ãŒã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¨­è¨ˆã‚’å…ƒã«éå¸¸ã«èª¬å¾—åŠ›ã‚ã‚‹èª¬æ˜ã¨å…±ã«è§£èª¬ã•ã‚Œã¦ã„ã¾ã™ã€‚\nã“ã®ç« ã¯æ¦‚ç•¥ã‚’æ›¸ã„ã¦ã—ã¾ã†ã¨å†…å®¹ãŒæŠŠæ¡å‡ºæ¥ã¦ã—ã¾ã†ã®ã§ã€èˆˆå‘³ã‚ã‚‹æ–¹ã¯æ›¸ç±ã‚’è³¼å…¥ã—ã¦èª­ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚ãã£ã¨æã¯ã—ãªã„ã§ã™ã€‚\n(5), (6) ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ é‹ç”¨ã™ã‚‹ãªã‹ã§ãŠã•ãˆã¦ãŠãã¹ããƒã‚¤ãƒ³ãƒˆãŒæ²è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã‚’è¡Œã†ä¸Šã§ã®æ³¨æ„ç‚¹ç­‰ã€é‹ç”¨ã«å…¥ã£ã¦ã‹ã‚‰è‹¦åŠ´ã—ãªã„ã‚ˆã†ã«è‰²ã‚“ãªæŠ€ãŒæ²è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚\nã¾ã¨ã‚ ä»¥ä¸Šã€è‡ªåˆ†ã®èª­æ›¸æ„Ÿæƒ³ã§ã—ãŸãŒã€ç´ æ™´ã‚‰ã—ã•ã¯ä¼ã‚ã‚Šã¾ã—ãŸã§ã—ã‚‡ã†ã‹ã€‚Terraform ã‚’ä½¿ã£ã¦ã„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã‚ã‚Œã°å¿…ãšç–‘å•ã«æ„Ÿã˜ã‚‹ç‚¹ã‚’è¦‹äº‹ã«è§£æ±ºã«å°ã„ã¦ã„ã‚‹è‰¯æ›¸ã ã¨æ€ã„ã¾ã™ã—ã€èª¬æ˜ãŒã¨ã¦ã‚‚ç°¡æ½”ã§è‰¯ã„ãƒ†ãƒ³ãƒã§ç†è§£ã§ãã‚‹å†…å®¹ã§ã—ãŸã€‚ã¾ãŸæƒ…å ±é‡ã‚„æ–‡å­—æ•°ç­‰ã€è‡ªåˆ†ã«ã¨ã£ã¦æœ€é©ã§ã—ãŸã—ã€å†…å®¹çš„ã«ã¯ \u0026ldquo;Terraform ã‚’ä½¿ã„å§‹ã‚ãŸäºº\u0026rdquo; ã‹ã‚‰ \u0026ldquo;Terraform ã‚’ä½¿ã£ã¦ã„ã‚‹ãŒè‹¦åŠ´ã—ã¦ã„ã‚‹äºº\u0026rdquo; ã¾ã§ã‚’ã‚«ãƒãƒ¼ã—ãŸã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚\nãƒãƒƒãƒˆä¸Šã«ã¯æ–­ç‰‡çš„ã«ã¯æƒ…å ±ã¯ã‚ã£ã¦ã‚‚ã€ã“ã“ã¾ã§ã¾ã¨ã¾ã£ãŸå†…å®¹ã®ã‚µã‚¤ãƒˆã¯ç„¡ã„ã¨æ€ã„ã¾ã™ã—ã€å®Ÿéš›ã« Terraform ã‚’ä½¿ã£ã¦ã„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã ã‹ã‚‰ã“ãã® \u0026ldquo;é‹ç”¨ã‚’è¡Œã†ä¸Šã§ã®è§£æ±ºç­–\u0026rdquo; ãŒæº€è¼‰ãªæ›¸ç±ã§ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/2019/07/27/pragmatic-terraform/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯é›»å­æ›¸ç± \u0026lsquo;Pragmatic Terraform on AWS\u0026rsquo; ã‚’èª­ã‚“ã§ã¨ã¦ã‚‚å†…å®¹ãŒç´ æ™´ã‚‰ã—ã‹ã£ãŸã®ã§ç´¹ä»‹ã•ã›ã¦é ‚ãã¾ã™ã€‚æ›¸ç±ã®è³¼å…¥ã¯ä¸‹è¨˜ã® URL ã‹ã‚‰å¯èƒ½ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://booth.pm/ja/items/1318735\"\u003ehttps://booth.pm/ja/items/1318735\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eãƒ–ãƒ­ã‚°è¨˜äº‹ã§ã¯æ›¸ç±ã®ç´°ã‹ã„å†…å®¹ã«ã¤ã„ã¦ã¯è¿°ã¹ã¾ã›ã‚“ã€‚ã“ã‚Œã‹ã‚‰è³¼å…¥ã•ã‚Œã‚‹æ–¹ã€…ãŒè²·ã†æ„æ¬²ã‚’ç„¡ãã™ã‚ˆã†ãªãƒ–ãƒ­ã‚°è¨˜äº‹ã«ã—ãŸããªã„ã‹ã‚‰ã§ã™ã€‚ãªã®ã§ã“ã®ãƒ–ãƒ­ã‚°ã§ã¯è‡ªåˆ†ãŒ Terraform é‹ç”¨ã«ã¤ã„ã¦æ„Ÿã˜ã¦ã„ãŸå•é¡Œç‚¹ã¨ã“ã®é›»å­æ›¸ç±ãŒã©ã†è§£æ±ºã—ã¦ãã‚ŒãŸã®ã‹ã«ã¤ã„ã¦è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"è‡ªåˆ†ãŒ-terraform-é‹ç”¨ã§æ„Ÿã˜ã¦ã„ãŸå•é¡Œç‚¹\"\u003eè‡ªåˆ†ãŒ Terraform é‹ç”¨ã§æ„Ÿã˜ã¦ã„ãŸå•é¡Œç‚¹\u003c/h2\u003e\n\u003cp\u003eTerraform ã‚’ä½¿ã£ãŸã‚¤ãƒ³ãƒ•ãƒ©ã‚³ãƒ¼ãƒ‰åŒ–ã¨æ§‹ç¯‰ã¯è‡ªåˆ†ã®çµæ§‹çµŒé¨“ãŒã‚ã‚‹ã®ã§ã™ãŒã€ãã®æ§‹ç¯‰ã«ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ã§æ§‹æˆã‚’é‹ç”¨ã™ã‚‹é›£ã—ã•ã¯ã„ã¤ã‚‚æ„Ÿã˜ã¦ã„ã¾ã—ãŸã€‚Terraform ã‚’ä½¿ã£ãŸç¶™ç¶šçš„ãªã‚¤ãƒ³ãƒ•ãƒ©ã®é‹ç”¨ã«ã¤ã„ã¦ã§ã™ã€‚å…·ä½“çš„ã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªç–‘å•ã¨è¨€ã„ã¾ã™ã‹å•é¡Œç‚¹ã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e(1) ã©ã®ã‚ˆã†ãªå®Ÿè¡Œå˜ä½ã§ .tf ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã‹\u003c/li\u003e\n\u003cli\u003e(2) å‰Šé™¤ç³»ãƒ»ä¿®æ­£ç³»ã®æ“ä½œã‚‚ Terraform ã§è¡Œã†ã®ã‹\u003c/li\u003e\n\u003cli\u003e(3) ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ãªã‚¤ãƒ³ãƒ•ãƒ©ã¨ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ãªã‚¤ãƒ³ãƒ•ãƒ©ã®ç®¡ç†æ–¹æ³•\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e(1) ã¯ \u003ccode\u003eterraform plan/apply\u003c/code\u003e ã‚’å®Ÿè¡Œã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ§‹é€ ã«ã¤ã„ã¦ã§ã™ã€‚Terraform ã¯åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã«ã‚ã‚‹ .tf ãƒ•ã‚¡ã‚¤ãƒ«å…¨ã¦ã‚’èª­ã¿è¾¼ã‚“ã§ãã‚Œã¾ã™ã—ä¸€æ–‰ã«ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ã§ã™ãŒã€ä½•ã‹ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ä¿®æ­£ãƒ»å‰Šé™¤ã—ãŸã„å ´åˆã€å‰Šé™¤ã—ã¦ã¯ã„ã‘ãªã„ãƒªã‚½ãƒ¼ã‚¹ã‚‚åŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã® .tf ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã—ã¦ã„ã‚‹ã‚ã‘ã§ã™ã‹ã‚‰ä½•ã‹ã—ã‚‰ã®ãƒŸã‚¹ã§å¤§äº‹ãªã‚¤ãƒ³ãƒ•ãƒ©ã«å½±éŸ¿ã‚’ä¸ãˆã¦ã—ã¾ã†äº‹ã«ãªã‚Šã¾ã™ã€‚å½±éŸ¿ç¯„å›²ãŒå¤§ãã™ãã‚‹ã®ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e(2) ã¯ã€\u0026lsquo;åˆæœŸã®æ§‹æˆã®ã¿ã‚’ Terraform ã§æ§‹ç¯‰è‡ªå‹•åŒ–ã™ã‚‹\u0026rsquo; ã®ã‹ã©ã†ã‹ã€ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚æ§‹ç¯‰ã«ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ã§ç¶™ç¶šçš„ã«å‰Šé™¤ç³»ãƒ»ä¿®æ­£ç³»ã®æ“ä½œã‚‚è¡Œã†ã®ã‹ã€‚ã“ã‚Œã‚‚ (1) ã¨åŒæ§˜ã«ç®¡ç†ã™ã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã®è¦æ¨¡ãŒå¤§ãããªã‚‹ã¨å½±éŸ¿ç¯„å›²ãŒå¤§ãããªã‚Šã€é‹ç”¨è€…ã®ç²¾ç¥çš„è² æ‹…ãŒå¢—ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e(3) ã¯ RDS, S3 ç­‰ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ãªã‚¤ãƒ³ãƒ•ãƒ©ã¨ã€ãã‚Œä»¥å¤–ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ãªã‚¤ãƒ³ãƒ•ãƒ©ã‚’åŒã˜ .tf ã‚³ãƒ¼ãƒ‰ã§ç®¡ç†ã—ã¦ã„ã„ã®ã‹ã€ã¨ã„ã†ç–‘å•ã§ã™ã€‚ä¿®æ­£ãƒ»å‰Šé™¤ãŒå¤šç™ºã™ã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã¯ .tf ã‚³ãƒ¼ãƒ‰ã§ç¶™ç¶šçš„ã«é‹ç”¨å‡ºæ¥ãŸã¨ã—ã¦ã‚‚ã€RDS, S3 ã®æ§˜ãªçŠ¶æ…‹ãŒé‡è¦ã«ãªã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã¯æ»…å¤šã«å‰Šé™¤ãƒ»ä¿®æ­£æ“ä½œã¯é€šå¸¸è¡Œã„ã¾ã›ã‚“ã€‚ã“ã‚Œã‚‰äºŒç¨®é¡ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚’åŒã˜ã‚ˆã†ã«ç®¡ç†ã—ã¦ã—ã¾ã£ã¦ã„ã„ã®ã‹ï¼Ÿã¨ã„ã†ç–‘å•ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã“ã‚Œã‚‰ã®ç–‘å•ã‚„æ€ã£ã¦ã„ãŸå•é¡Œç‚¹ã«ã¤ã„ã¦ã€ã“ã® \u0026lsquo;Pragmatic Terraform on AWS\u0026rsquo; ã¯å…¨ã¦è§£æ±ºã—ã¦ãã‚Œã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ch2 id=\"pragmatic-terraform-on-aws-ã®æ§‹æˆ\"\u003ePragmatic Terraform on AWS ã®æ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eç« ã”ã¨ã®èª¬æ˜ã¯è©³ç´°ã«ã¯æ›¸ãã¾ã›ã‚“ãŒã€å¤§ä½“ã®æµã‚Œã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e","title":"Pragmatic Terraform on AWS ã®å†…å®¹ãŒç´ æ™´ã‚‰ã—ã‹ã£ãŸã®ã§æ„Ÿæƒ³ã‚’è¿°ã¹ã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nå°‘ã—å‰ã®è©±ãªã®ã§ã™ãŒ Google Cloud Platform ãŒ Terraformer ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’å‡ºã—ã¾ã—ãŸã€‚æ­£ç¢ºã«ã¯æ•°å¹´å‰ã« Google ãŒè²·åã—ãŸ Waze ã¨ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢é”ãŒé–‹ç™ºã—ãŸã‚ˆã†ã§ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ GCP, AWS, OpenStack, Kubernetes ç­‰ã€å„ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ»ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«å¯¾å¿œã—ãŸãƒªãƒãƒ¼ã‚¹ Terraform ã¨è¨€ãˆã‚‹ãƒ„ãƒ¼ãƒ«ã«ãªã£ã¦ã„ã¦ã€æ§‹ç¯‰ã•ã‚ŒãŸã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã®çŠ¶æ…‹ã‚’å…ƒã« terraform ã® .tf ã‚³ãƒ¼ãƒ‰ã¨ .tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã‚Œã¾ã™ã€‚terraform import ã¯ tfstate ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ã¿ã«å¯¾å¿œã—ã¦ãŸã®ã§ã“ã‚Œã¯å¤¢ã®ãƒ„ãƒ¼ãƒ«ã˜ã‚ƒãªã„ã‹ï¼ã¨ã„ã†ã“ã¨ã§å½“åˆæœŸå¾…ã—ã¦ä½¿ã„å§‹ã‚ãŸã®ã§ã™ãŒã€ä½¿ã£ã¦ã¿ã‚‹ä¸­ã§å¹¾ã¤ã‹ã®å•é¡Œç‚¹ã‚‚è¦‹ãˆã¦ãã¾ã—ãŸã€‚ä»Šå›ã¯ãã®æ°—ã«ãªã£ãŸå•é¡Œç‚¹ã‚’ä¸­å¿ƒã« Terraformer ã®åŸºæœ¬çš„ãªå‹•ä½œã‚’èª¬æ˜ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\nå…¬å¼ã‚µã‚¤ãƒˆ ä¸‹è¨˜ã® Github ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚\nhttps://github.com/GoogleCloudPlatform/terraformer\nRequrements Terraformer ã‚’å‹•ä½œã•ã›ã‚‹ã«ã¯ä¸‹è¨˜ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒå¿…è¦ã§ã™ã€‚ä»Šå›ã¯ macos ã‚’æƒ³å®šã—ã¦æƒ…å ±ã‚’è¨˜ã—ã¦ã„ã¾ã™ãŒ Linux ã§ã‚‚å‹•ä½œã—ã¾ã™ã€‚é©å®œèª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¨è¨­å®šæ–¹æ³•ã¯ã“ã“ã§ã¯å‰²æ„›ã•ã›ã¦é ‚ãã¾ã™ã€‚\nmacos homebrew terraform awscli ä»Šå›ã®å‰æã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  è‡ªåˆ†ãŒã„ã¤ã‚‚ä½¿ã£ã¦ã„ã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¨ã„ã†ã“ã¨ã§ä»Šå›ã¯ aws ã‚’å‰æã«è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚ã“ã“ãŒçµæ§‹è‚å¿ƒãªã¨ã“ã‚ã§ã€Google Cloud Platform ãŒé–‹ç™ºã—ãŸã“ã¨ã‚‚ã‚ã‚Š GCP å‘ã‘ã®æ©Ÿèƒ½ãŒä¸€ç•ª Feature ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«èª­ã¿å–ã‚Œã¾ã™ã€‚ã¤ã¾ã‚Š aws ã‚’å¯¾è±¡ã¨ã—ãŸ Terraformer ã®æ©Ÿèƒ½ãŒä¸€éƒ¨è¿½ã„ã¤ã„ã¦ã„ãªã„ç‚¹ã‚‚å¾Œã«è¿°ã¹ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nå‹•ä½œã•ã›ã‚‹ã¾ã§ã®æº–å‚™ Terraform ã¨åŒæ§˜ã« Terraformer ã§ã‚‚å‹•ä½œã›ã›ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚\nmkdir working_dir cd working_dir Terraformer ã‚’å‹•ä½œã•ã›ã‚‹ãŸã‚ã« Terraform ã® plugin ãŒå¿…è¦ã§ã™ã€‚å…ˆã«è¿°ã¹ãŸã‚ˆã†ã«ã“ã“ã§ã¯ \u0026lsquo;aws\u0026rsquo; Plugin ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ãã®ãŸã‚ã« init.tf ã‚’ä¸‹è¨˜ã®é€šã‚Šä½œæˆã—ã¾ã™ã€‚\necho \u0026#39;provider \u0026#34;aws\u0026#34; {}\u0026#39; \u0026gt; init.tf terraform init ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ Terraform \u0026lsquo;aws\u0026rsquo; plugin ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\nterraform init awscli ã® profile ã‚’ç”¨æ„ã—ã¾ã™ã€‚ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸã„ç’°å¢ƒã‚’ç®¡ç†ã—ã¦ã„ã‚‹ aws ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã« IAM ãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆã—ã¦ã€ãã® secret key, secret access key ã¨ãƒªãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’è¨˜ã—ã¦ä¸‹ã•ã„ã€‚\naws configure åŸºæœ¬çš„å‹•ä½œã®ç¢ºèª ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ»ã‚µãƒ–ãƒãƒƒãƒˆãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ ã“ã“ã§ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ§‹æˆã™ã‚‹ EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ»ã‚µãƒ–ãƒãƒƒãƒˆãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã‚’æŒ‡å®šã—ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ“ä½œã‚’è¡Œã£ã¦ã¿ã¾ã™ã€‚ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¯ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰1ã¤å®Ÿè¡Œã™ã‚‹ã®ã¿ã§ã™ã€‚\nterraformer import aws --resources=ec2_instance,sg,subnet --connect=true --regions=ap-northeast-1 çµæœã€ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã§ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚\n. â”œ â”€ â”€ generated â”‚ â”” â”€ â”€ aws â”‚ â”œ â”€ â”€ ec2_instance â”‚ â”‚ â”” â”€ â”€ ap-northeast-1 â”‚ â”‚ â”œ â”€ â”€ instance.tf â”‚ â”‚ â”œ â”€ â”€ outputs.tf â”‚ â”‚ â”œ â”€ â”€ provider.tf â”‚ â”‚ â”” â”€ â”€ terraform.tfstate â”‚ â”œ â”€ â”€ sg â”‚ â”‚ â”” â”€ â”€ ap-northeast-1 â”‚ â”‚ â”œ â”€ â”€ outputs.tf â”‚ â”‚ â”œ â”€ â”€ provider.tf â”‚ â”‚ â”œ â”€ â”€ security_group.tf â”‚ â”‚ â”” â”€ â”€ terraform.tfstate â”‚ â”” â”€ â”€ subnet â”‚ â”” â”€ â”€ ap-northeast-1 â”‚ â”œ â”€ â”€ outputs.tf â”‚ â”œ â”€ â”€ provider.tf â”‚ â”œ â”€ â”€ subnet.tf â”‚ â”œ â”€ â”€ terraform.tfstate â”‚ â”” â”€ â”€ variables.tf â”” â”€ â”€ init.tf æ—©é€Ÿã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ§‹æˆã™ã‚‹ generated/aws/ec2_instance/ap-northeast-1/instance.tf ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚\nresource \u0026#34;aws_instance\u0026#34; \u0026#34;i-************_test-instance\u0026#34; { ami = \u0026#34;ami-***********\u0026#34; associate_public_ip_address = true availability_zone = \u0026#34;ap-northeast-1a\u0026#34; cpu_core_count = \u0026#34;1\u0026#34; cpu_threads_per_core = \u0026#34;1\u0026#34; snip ... subnet_id = \u0026#34;subnet-****************\u0026#34; // ã‚µãƒ–ãƒãƒƒãƒˆ snip... vpc_security_group_ids = [\u0026#34;sg-****************\u0026#34;] // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ— ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¨ instance.tf ã®å†…å®¹ã‹ã‚‰ä¸‹è¨˜ã®ã“ã¨ãŒè¨€ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚\naws ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹æ¯ã« terraform ã‚’å®Ÿè¡Œã™ã‚‹æƒ³å®šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒåˆ¥ã‚Œã¦ã„ã‚‹ insntace.tf ã‚’è¦‹ã‚‹ã¨ãƒªã‚½ãƒ¼ã‚¹ ID ãŒç›´æ‰“ã¡ã«ãªã£ã¦ã„ã¦ä¾å­˜é–¢ä¿‚ãŒè§£æ±ºã•ã‚Œã¦ã„ãªã„ã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã‚‹ filter ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã®ã‚³ãƒ¼ãƒ‰ã ã‘ã‚¤ãƒ³ãƒãƒ¼ãƒˆ ä¸‹è¨˜ã®ã‚ˆã†ã« filter ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”¨ã„ã¦ç‰¹å®šã® ID ã®ãƒªã‚½ãƒ¼ã‚¹ã ã‘ .tf, .tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚\nterraformer import aws --resources=vpc --filter=aws_vpc=vpc-********* --regions=ap-northeast-1 ã“ã“ã¾ã§ã§å¹¾ã¤ã‹å•é¡Œç‚¹ã«æ°—ãŒã¤ãã¨æ€ã„ã¾ã™ã€‚\nè‡ªåˆ†ãŒæ°—ã«ãªã£ãŸåˆ©ç”¨ã™ã‚‹ä¸Šã§ã®å•é¡Œç‚¹ãã®1 Terraform ã¯æ§˜ã€…ãªå˜ä½ã§ã‚³ãƒ¼ãƒ‰ã‚’æŸã­ã‚‹äº‹ã¯å‹¿è«–ãªã®ã§ã™ãŒã€ä½•ã‹ã—ã‚‰ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’å½¢æˆã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ä¸€å¼ã¨ã„ã†å˜ä½ã§ã‚³ãƒ¼ãƒ‰ã‚’æŸã­ã‚‹äº‹ã¯ã—ã¦ãã‚Œãªã„ã€ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ä¾‹ãˆã° instance, subnet ä¸¡æ–¹ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ä¿®æ­£ã‚’ã™ã‚‹å ´åˆ terraform ã‚³ãƒãƒ³ãƒ‰ã‚’2ã¤ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œã—ãªã‘ã‚Œã°ã„ã‘ãªã„ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ãªã‚“ã ã‹ã‚¹ãƒƒã‚­ãƒªã—ã¾ã›ã‚“\u0026hellip;ã€‚\nè‡ªåˆ†ãŒæ°—ã«ãªã£ãŸåˆ©ç”¨ã™ã‚‹ä¸Šã§ã®å•é¡Œç‚¹ãã®2 é€šå¸¸ Terraform ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãéš›ã« Resource é–“ã®ä¾å­˜é–¢ä¿‚ä¿ã¡ã¾ã™ã€‚ä¾‹ãˆã° \u0026lsquo;aws_instance\u0026rsquo; å†…ã® \u0026lsquo;subnet_id\u0026rsquo; ã«ã¯é€šå¸¸ä¸‹è¨˜ã®ã‚ˆã†ã«ä¾å­˜é–¢ä¿‚ã‚’è¨˜ã—ã¾ã™ã€‚\nsubnet_id = \u0026#34;${aws_subnet.foo.id}\u0026#34; ã§ã™ãŒç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã™ã‚‹ã¨ id ãŒãƒ™ã‚¿æ›¸ãã•ã‚Œã¦ã„ã¾ã™ã€‚Resource é–“ã®ä¾å­˜é–¢ä¿‚ãŒè§£æ±ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nè‡ªåˆ†ãŒæ°—ã«ãªã£ãŸåˆ©ç”¨ã™ã‚‹ä¸Šã§ã®å•é¡Œç‚¹ãã®3 Terraform ã® Module æ©Ÿèƒ½ãŒç”¨ã„ã‚‰ã‚Œã¦ã„ãªã„ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’ç°¡æ½”ã«å°šä¸”å¯èª­æ€§è‰¯ãã™ã‚‹ãŸã‚ã« Module æ©Ÿèƒ½ã‚’ç”¨ã„ã¦ Terraform ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã®ãŒä¸€èˆ¬çš„ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€å…¨ãã®ãƒ™ã‚¿æ›¸ããªã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã¨ã“ã‚ã«è‹¥å¹²å•é¡Œã‚’æ„Ÿã˜ã¾ã™ã€‚\nä»Šç¾åœ¨ 2019/07 ã§å¯¾å¿œã—ã¦ã„ã‚‹ aws ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§ 2019/07 ç¾åœ¨ã§å¯¾å¿œã—ã¦ã„ã‚‹ aws ã®ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§ã§ã™ã€‚Terraform ã® Resources åã§è¨˜ã—ã¦ã‚ã‚Šã¾ã™ã€‚\naws_elb aws_lb aws_lb_listener aws_lb_listener_rule aws_lb_listener_certificate aws_lb_target_group aws_lb_target_group_attachment aws_autoscaling_group aws_launch_configuration aws_launch_template aws_db_instance aws_db_parameter_group aws_db_subnet_group aws_db_option_group aws_db_event_subscription aws_iam_role aws_iam_role_policy aws_iam_user aws_iam_user_group_membership aws_iam_user_policy aws_iam_policy_attachment aws_iam_policy aws_iam_group aws_iam_group_membership aws_iam_group_policy aws_internet_gateway aws_network_acl aws_s3_bucket aws_s3_bucket_policy aws_security_group aws_subnet aws_vpc aws_vpn_connection aws_vpn_gateway aws_route53_zone aws_route53_record aws_acm_certificate aws_elasticache_cluster aws_elasticache_parameter_group aws_elasticache_subnet_group aws_elasticache_replication_group aws_cloudfront_distribution aws_instance è‡ªåˆ†ãŒæ°—ã«ãªã£ãŸåˆ©ç”¨ã™ã‚‹ä¸Šã§ã®å•é¡Œç‚¹ãã®3 Google Cloud Platform ãŒé–‹ç™ºã—ã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ã‚Š Google Cloud ã®å¯¾å¿œçŠ¶æ³ã¯è‰¯ã„ã¨æ€ã†ã®ã§ã™ãŒ(ã”ã‚ã‚“ãªã•ã„ã€ã‚ã¾ã‚Šç¢ºèªå‡ºæ¥ã¦ã„ã¾ã›ã‚“)ã§ã™ãŒ aws ã«é–¢ã—ã¦å¯¾å¿œã•ã‚Œã¦ã„ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã¯ä¸‹è¨˜ã§å…¨ã¦ã§ã™ã€‚ä¾‹ãˆã°åŸºæœ¬çš„ãªã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ aws_iam_instance_profile ã‚‚ãªã„ã®ã§ãƒªã‚½ãƒ¼ã‚¹ ID ã‚’ç›´æ‰“ã¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã—ã€cloudwatch ç­‰ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚å¯¾å¿œçŠ¶æ³ã¯ã ã„ã¶è‰¯ããªã„ã®ã‹ãªãã¨ã„ã†å°è±¡ã§ã™ã€‚\nè€ƒå¯Ÿ ä»¥ä¸Šã€ç°¡å˜ã«ã§ã™ãŒåŸºæœ¬çš„ãªåˆ©ç”¨æ–¹æ³•ã¨è‡ªåˆ†ãŒæ°—ã«ãªã£ãŸç®‡æ‰€ã‚’ç´¹ä»‹ã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚\nTerraform è‡ªä½“ã«ã‚‚ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ãŒ tfstate ã®ã¿å¯¾å¿œã—ã¦ã„ã¦ .tf ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã›ã‚“ã€‚ãªã®ã§ã“ã®ãƒ„ãƒ¼ãƒ«ã¸ã®æœŸå¾…ã¯ã¨ã¦ã‚‚å¤§ãã‹ã£ãŸã®ã§ã™ãŒã€ã„ã¾ç¾æ™‚ç‚¹ã§ã¯æ—¢å­˜ç’°å¢ƒã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãæ™‚ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦å‚è€ƒã«ã™ã‚‹ã€ã¨ã„ã†ç¨‹åº¦ã®ä½¿ã„æ–¹ã—ã‹å‡ºæ¥ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚å•é¡Œç‚¹ã‚’ä¸­å¿ƒã« Terraformer ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã®ç‰¹å¾´ã‚’ä¸‹è¨˜ã«ã‚ã’ã¾ã™ã€‚\nterraform plan/apply å®Ÿè¡Œã™ã‚‹å˜ä½ãŒ Resource å˜ä½ã«åˆ¥ã‚Œã¦ã—ã¾ã£ã¦ã„ã‚‹ Resource é–“ã®ä¾å­˜é–¢ä¿‚ãŒè§£æ±ºã•ã‚Œã¦ã„ãªã„ Module ãŒç”¨ã„ã‚‰ã‚Œã¦ã„ãªã„ .tf ã‚³ãƒ¼ãƒ‰ å¯¾å¿œã—ã¦ã„ã‚‹ aws Resource ãŒã¾ã ã¾ã è¿½ã„ã¤ã„ã¦ã„ãªã„ ãŸã ã€ã¾ã ç™ºè¡¨ã•ã‚Œã¦é–“ã‚‚ãªã„ãƒ„ãƒ¼ãƒ«ãªã®ã§ä»Šå¾Œã«æœŸå¾…ã§ã™ã€‚å®Œæˆåº¦ãŒä¸ŠãŒã‚Œã°æœ€é«˜ã®ãƒ„ãƒ¼ãƒ«ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚å¯¾å¿œã—ã¦ã„ã‚‹ aws resource ãŒã¾ã è¿½ã„ä»˜ã„ã¦ã„ãªã„ã‚‚ã®ä»Šå¾Œé–‹ç™ºãŒé€²ã‚ã°æ™‚é–“ã ã‘ã®å•é¡Œãªæ°—ã‚‚ã—ã¾ã™ã€‚ã¾ãŸä»Šå›ç§ã¯å‹•ä½œç¢ºèªå‡ºæ¥ã¦ã„ãªã„ã®ã§ã™ãŒã€GCP ã§ã‚ã‚Œã°å¯¾å¿œã—ã¦ã„ã‚‹ Resource çŠ¶æ³ã‚‚è‰¯ã•ãã†ã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2019/07/26/terraformer/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå°‘ã—å‰ã®è©±ãªã®ã§ã™ãŒ Google Cloud Platform ãŒ Terraformer ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’å‡ºã—ã¾ã—ãŸã€‚æ­£ç¢ºã«ã¯æ•°å¹´å‰ã« Google ãŒè²·åã—ãŸ Waze ã¨ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢é”ãŒé–‹ç™ºã—ãŸã‚ˆã†ã§ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ GCP, AWS, OpenStack, Kubernetes ç­‰ã€å„ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ»ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«å¯¾å¿œã—ãŸãƒªãƒãƒ¼ã‚¹ Terraform ã¨è¨€ãˆã‚‹ãƒ„ãƒ¼ãƒ«ã«ãªã£ã¦ã„ã¦ã€æ§‹ç¯‰ã•ã‚ŒãŸã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã®çŠ¶æ…‹ã‚’å…ƒã« terraform ã® .tf ã‚³ãƒ¼ãƒ‰ã¨ .tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã‚Œã¾ã™ã€‚\u003ccode\u003eterraform import\u003c/code\u003e ã¯ tfstate ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ã¿ã«å¯¾å¿œã—ã¦ãŸã®ã§ã“ã‚Œã¯å¤¢ã®ãƒ„ãƒ¼ãƒ«ã˜ã‚ƒãªã„ã‹ï¼ã¨ã„ã†ã“ã¨ã§å½“åˆæœŸå¾…ã—ã¦ä½¿ã„å§‹ã‚ãŸã®ã§ã™ãŒã€ä½¿ã£ã¦ã¿ã‚‹ä¸­ã§å¹¾ã¤ã‹ã®å•é¡Œç‚¹ã‚‚è¦‹ãˆã¦ãã¾ã—ãŸã€‚ä»Šå›ã¯ãã®æ°—ã«ãªã£ãŸå•é¡Œç‚¹ã‚’ä¸­å¿ƒã« Terraformer ã®åŸºæœ¬çš„ãªå‹•ä½œã‚’èª¬æ˜ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å…¬å¼ã‚µã‚¤ãƒˆ\"\u003eå…¬å¼ã‚µã‚¤ãƒˆ\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã® Github ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/GoogleCloudPlatform/terraformer\"\u003ehttps://github.com/GoogleCloudPlatform/terraformer\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"requrements\"\u003eRequrements\u003c/h2\u003e\n\u003cp\u003eTerraformer ã‚’å‹•ä½œã•ã›ã‚‹ã«ã¯ä¸‹è¨˜ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒå¿…è¦ã§ã™ã€‚ä»Šå›ã¯ macos ã‚’æƒ³å®šã—ã¦æƒ…å ±ã‚’è¨˜ã—ã¦ã„ã¾ã™ãŒ Linux ã§ã‚‚å‹•ä½œã—ã¾ã™ã€‚é©å®œèª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¨è¨­å®šæ–¹æ³•ã¯ã“ã“ã§ã¯å‰²æ„›ã•ã›ã¦é ‚ãã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003emacos\u003c/li\u003e\n\u003cli\u003ehomebrew\u003c/li\u003e\n\u003cli\u003eterraform\u003c/li\u003e\n\u003cli\u003eawscli\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ä»Šå›ã®å‰æã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ \"\u003eä»Šå›ã®å‰æã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ \u003c/h2\u003e\n\u003cp\u003eè‡ªåˆ†ãŒã„ã¤ã‚‚ä½¿ã£ã¦ã„ã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¨ã„ã†ã“ã¨ã§ä»Šå›ã¯ aws ã‚’å‰æã«è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚ã“ã“ãŒçµæ§‹è‚å¿ƒãªã¨ã“ã‚ã§ã€Google Cloud Platform ãŒé–‹ç™ºã—ãŸã“ã¨ã‚‚ã‚ã‚Š GCP å‘ã‘ã®æ©Ÿèƒ½ãŒä¸€ç•ª Feature ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«èª­ã¿å–ã‚Œã¾ã™ã€‚ã¤ã¾ã‚Š aws ã‚’å¯¾è±¡ã¨ã—ãŸ Terraformer ã®æ©Ÿèƒ½ãŒä¸€éƒ¨è¿½ã„ã¤ã„ã¦ã„ãªã„ç‚¹ã‚‚å¾Œã«è¿°ã¹ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‹•ä½œã•ã›ã‚‹ã¾ã§ã®æº–å‚™\"\u003eå‹•ä½œã•ã›ã‚‹ã¾ã§ã®æº–å‚™\u003c/h2\u003e\n\u003cp\u003eTerraform ã¨åŒæ§˜ã« Terraformer ã§ã‚‚å‹•ä½œã›ã›ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir working_dir\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecd working_dir\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eTerraformer ã‚’å‹•ä½œã•ã›ã‚‹ãŸã‚ã« Terraform ã® plugin ãŒå¿…è¦ã§ã™ã€‚å…ˆã«è¿°ã¹ãŸã‚ˆã†ã«ã“ã“ã§ã¯ \u0026lsquo;aws\u0026rsquo; Plugin ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ãã®ãŸã‚ã« init.tf ã‚’ä¸‹è¨˜ã®é€šã‚Šä½œæˆã—ã¾ã™ã€‚\u003c/p\u003e","title":"æœŸå¾…ã®ãƒ„ãƒ¼ãƒ« Terrafomer ã®åŸºæœ¬å‹•ä½œæ–¹æ³•ã¨å•é¡Œç‚¹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šå›ã¯ Hashicorp ã® Consul ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ Kubernetes ä¸Šã§ç¨¼åƒã•ã›ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚\nHashicorp Consul ã¯ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãŒè¡Œãˆã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã€ç§ã‚‚ä»¥å‰å±…ãŸè·å ´ã§åˆ©ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“ã§äº’ã„ã«æ¥ç¶šå…ˆã‚’ç¢ºèªã—åˆã†äº‹ãŒå‡ºæ¥ã¾ã™ã€‚ä»¥å‰æ§‹ç¯‰ã—ãŸ Consul ã‚¯ãƒ©ã‚¹ã‚¿ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã«ç›´ã«èµ·å‹•ã—ã¦ã„ãŸã®ã§ã™ãŒæœ€è¿‘ã ã¨ã©ã†ã‚„ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã‹èˆˆå‘³ã‚’æŒã¡ Kubernetes ä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’èª¿ã¹ãŸæ‰€ Helm ã‚’ä½¿ã£ã¦ç°¡å˜ã«ãƒ‡ãƒ—ãƒ­ã‚¤å‡ºæ¥ã‚‹äº‹ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚\nã¾ãŸä»Šå›ã¯ minikube ã‚’ä½¿ã£ã¦è¤‡æ•°ã®ãƒ¬ãƒ—ãƒªã‚«ã‚’èµ·å‹•ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ãŒã€Helm Chart ã‚’ç”¨ã„ã‚‹ã¨ Kubernetes ã®ãƒãƒ¼ãƒ‰æ¯ã« Consul Pod ãŒ1ã¤ãšã¤èµ·å‹•ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¦ã€ãƒãƒ¼ãƒ‰ã®éšœå®³ã‚’è€ƒæ…®ã—ãŸå¯ç”¨æ€§ã¨ã„ã†ç‚¹ã§ã‚‚å„ªã‚Œã¦ã„ã‚‹ãªãã¨æ„Ÿã˜ã¾ã—ãŸã€‚ã¾ãŸ Kubernetes ã® Pod ã§ã™ã®ã§ãƒ—ãƒ­ã‚»ã‚¹ãŒè½ã¡ãŸéš›ã«å³åº§ã«å†èµ·å‹•ãŒè¡Œã‚ã‚Œã‚‹ã¨ã„ã†ç‚¹ã§ã‚‚å„ªã‚Œã¦ã„ã¾ã™ã€‚å‹¿è«– Consul ã‚¯ãƒ©ã‚¹ã‚¿ã® Leader ãŒè½ã¡ãŸå ´åˆã«ã¯ Leader Election (ãƒªãƒ¼ãƒ€æ˜‡æ ¼ã®ãŸã‚ã®é¸æŒ™) ãŒè¡Œã‚ã‚Œã€ç›´ã¡ã«éš£æ¥ã—ãŸ Kubernetes ãƒãƒ¼ãƒ‰ä¸Šã® Consul Pod ãŒãƒªãƒ¼ãƒ€ãƒ¼ã«æ˜‡æ ¼ã—ã¾ã™ã€‚ã¨ã„ã£ãŸæ„å‘³ã§ã‚‚ Kubernetes ä¸Šã« Consul ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¨ã„ã†è€ƒãˆã¯å„ªã‚Œã¦ã„ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚\nRequirements ä¸‹è¨˜ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒäº‹å‰ã«å¿…è¦ã§ã™ã€‚ã“ã®æ‰‹é †ã§ã¯äºˆã‚ã“ã‚Œã‚‰ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã¨ã—ã¦è¨˜ã—ã¦ã„ãã¾ã™ã€‚\nminikube kubectl helm Consul ã‚¯ãƒ©ã‚¹ã‚¿èµ·å‹•ã¾ã§ã®æ‰‹é † æ—©é€Ÿã§ã™ãŒæ‰‹é †ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\nHashicorp ã® Github ã«ã¦ Consul ã® Helm Chart ãŒå…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚helm search ã—ã¦ã‚‚å‡ºã¦ãã¾ã™ãŒã€ä»Šå›ã¯ Github ã®ã‚‚ã®ã‚’ç”¨ã„ã¾ã—ãŸã€‚\ngit clone https://github.com/hashicorp/consul-helm.git cd consul-helm git checkout v0.7.0 æ¬¡ã«ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨˜ã—ãŸ yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ (ä¿®æ­£) ã—ã¾ã™ã€‚æœ¬æ¥ã€Kubernetes ã®ãƒãƒ¼ãƒ‰æ¯ã«1ã¤ãšã¤ã® Pod ãŒèµ·å‹•ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¦ã€é€†ã«è¨€ã†ã¨1ãƒãƒ¼ãƒ‰ã«è¤‡æ•°ã® Consul Pod ã¯èµ·å‹•ã—ã¾ã›ã‚“ã€‚ä»Šå›ã¯æ‰‹å…ƒã‚‚ç«¯æœ«ã® minikube ã§ãŠæ‰‹è»½ã«è©¦ã›ã‚‹ã‚ˆã†ãƒ¬ãƒã‚¸ãƒˆãƒªä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ« value.yml ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«ä¿®æ­£åŠ ãˆã¾ã—ãŸã€‚ã“ã®æ‰‹é †ã¯ Github ã® Issue https://github.com/hashicorp/consul-helm/issues/13 ã§è¨˜ã•ã‚Œã¦ã„ã¾ã™ã€‚\nã‚‚ã¡ã‚ã‚“ã€minikube ã§ã¯ãªã Kubernetes ç’°å¢ƒã‚’åˆ©ç”¨ã§ãã‚‹æ–¹ã¯ã“ã®æ‰‹é †ã¯é£›ã°ã—ã¦æ§‹ã„ã¾ã›ã‚“ã€‚\n# ä¸‹è¨˜ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ # affinity: | # podAntiAffinity: # requiredDuringSchedulingIgnoredDuringExecution: # - labelSelector: # matchLabels: # app: {{ template \u0026#34;consul.name\u0026#34; . }} # release: \u0026#34;{{ .Release.Name }}\u0026#34; # component: server # topologyKey: kubernetes.io/hostname # minikube ç”¨ã«ä¸‹è¨˜ã‚’æœ‰åŠ¹ã«ã™ã‚‹ affinity: | podAntiAffinity: preferredDuringSchedulingIgnoredDuringExecution: - weight: 1 podAffinityTerm: topologyKey: kubernetes.io/hostname labelSelector: matchExpressions: - key: component operator: In values: - \u0026#34;{{ .Release.Name }}-{{ .Values.Component }}\u0026#34; kubectl, helm ã‚³ãƒãƒ³ãƒ‰ãŒ minikube ã‚’å‘ãã‚ˆã†ã«ä¸‹è¨˜ã®ã‚ˆã†ã«ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\nkubectl config use-context minikube helm init Consul ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ helm ã‚’ç”¨ã„ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ‡ãƒ—ãƒ­ã‚¤ãŒä¸€æ°—ã«å®Œäº†ã—ã¾ã™ã€‚\nhelm install --name consul . æš«ãã™ã‚‹ã¨ä¸‹è¨˜ã®é€šã‚Š Pods, Services ã®çŠ¶æ…‹ãŒç¢ºèªå‡ºæ¥ã‚‹ã¨æ€ã„ã¾ã™ã€‚\n$ kubectl get pods NAME READY STATUS RESTARTS AGE consul-q5s62 1/1 Running 0 21m consul-server-0 1/1 Running 0 21m consul-server-1 1/1 Running 0 21m consul-server-2 1/1 Running 0 21m $ kubectl get services NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE consul-dns ClusterIP 10.108.171.87 \u0026lt;none\u0026gt; 53/TCP,53/UDP 22m consul-server ClusterIP None \u0026lt;none\u0026gt; 8500/TCP,8301/TCP,8301/UDP,8302/TCP,8302/UDP,8300/TCP,8600/TCP,8600/UDP 22m consul-ui ClusterIP 10.107.40.197 \u0026lt;none\u0026gt; 80/TCP 22m kubernetes ClusterIP 10.96.0.1 \u0026lt;none\u0026gt; 443/TCP 48m èµ·å‹•ã—ãŸ Consul ã‚¯ãƒ©ã‚¹ã‚¿ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚consul members ã‚³ãƒãƒ³ãƒ‰ã‚’å„ Pod ä¸Šã§å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚¯ãƒ©ã‚¹ã‚¿ã« Join ã—ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ (ã“ã®å ´åˆ Consul Pod) ã®çŠ¶æ…‹ã‚’ä¸€è¦§è¡¨ç¤ºå‡ºæ¥ã¾ã™ã€‚minikube ãƒãƒ¼ãƒ‰ã«ã‚‚ consul-agent ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªå‡ºæ¥ã¾ã™ã€‚\n$ for i in {0..2}; do kubectl exec consul-server-$i -- sh -c \u0026#39;consul members\u0026#39;; done Node Address Status Type Build Protocol DC Segment consul-server-0 172.17.0.6:8301 alive server 1.4.4 2 dc1 \u0026lt;all\u0026gt; consul-server-1 172.17.0.7:8301 alive server 1.4.4 2 dc1 \u0026lt;all\u0026gt; consul-server-2 172.17.0.8:8301 alive server 1.4.4 2 dc1 \u0026lt;all\u0026gt; minikube 172.17.0.5:8301 alive client 1.4.4 2 dc1 \u0026lt;default\u0026gt; Node Address Status Type Build Protocol DC Segment consul-server-0 172.17.0.6:8301 alive server 1.4.4 2 dc1 \u0026lt;all\u0026gt; consul-server-1 172.17.0.7:8301 alive server 1.4.4 2 dc1 \u0026lt;all\u0026gt; consul-server-2 172.17.0.8:8301 alive server 1.4.4 2 dc1 \u0026lt;all\u0026gt; minikube 172.17.0.5:8301 alive client 1.4.4 2 dc1 \u0026lt;default\u0026gt; Node Address Status Type Build Protocol DC Segment consul-server-0 172.17.0.6:8301 alive server 1.4.4 2 dc1 \u0026lt;all\u0026gt; consul-server-1 172.17.0.7:8301 alive server 1.4.4 2 dc1 \u0026lt;all\u0026gt; consul-server-2 172.17.0.8:8301 alive server 1.4.4 2 dc1 \u0026lt;all\u0026gt; minikube 172.17.0.5:8301 alive client 1.4.4 2 dc1 \u0026lt;default\u0026gt; æ¬¡ã« Consul ã®ãƒªãƒ¼ãƒ€ãƒ¼ãŒã©ã® Pod ãªã®ã‹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚ä¸‹è¨˜ã®çµæœã‹ã‚‰ consule-server-2 ã¨ã„ã† Pod ãŒãƒªãƒ¼ãƒ€ãƒ¼ã ã¨åˆ†ã‹ã‚Šã¾ã™ã€‚\n$ for i in {0..2}; do kubectl exec consul-server-$i -- sh -c \u0026#39;consul info | grep leader\u0026#39;; done leader = false leader_addr = 172.17.0.8:8300 leader = false leader_addr = 172.17.0.8:8300 leader = true leader_addr = 172.17.0.8:8300 ã“ã®çŠ¶æ…‹ã§ consule-server-2 Pod ã‚’å‰Šé™¤ã—ã¦ã¿ã¾ã™ã€‚å‰Šé™¤ã—ã¦ã‚‚ Kubernetes Pod ãªã®ã§å³åº§ã«å†ä½œæˆãƒ»èµ·å‹•ãŒã•ã‚Œã‚‹ã®ã§ã™ãŒã€Consul çš„ã«ã¯ã€Œãƒªãƒ¼ãƒ€ãƒ¼ãŒè½ã¡ãŸã€ã¨ã„ã†åˆ¤æ–­ãŒä¸‹ã‚Šã€ãƒªãƒ¼ãƒ€ãƒ¼é¸å‡ºã®ãŸã‚ã®é¸æŒ™ãŒ consule-server-0, consul-server-1 ã® 2 Pods ã§è¡Œã‚ã‚Œã¾ã™ã€‚\n$ kubectl delete pod consul-server-2 ä¸‹è¨˜ãŒ consul-server-0 ã§ç¢ºèªã—ãŸ Consul ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ­ã‚°ã«ãªã‚Šã¾ã™ã€‚\u0026ldquo;consul: New leader elected: consul-server-1\u0026rdquo; ã¨è¡¨ç¤ºã•ã‚Œæ–°ãŸã« consul-server-1 Pod ãŒãƒªãƒ¼ãƒ€ãƒ¼ã«é¸å‡ºã•ã‚ŒãŸã“ã¨ãŒç¢ºèªå‡ºæ¥ã¾ã™ã€‚\n$ kubectl logs consul-server-0 \u0026lt;snip\u0026gt; 2019/04/26 07:31:22 [INFO] serf: EventMemberLeave: consul-server-2.dc1 172.17.0.8 2019/04/26 07:31:22 [INFO] consul: Handled member-leave event for server \u0026#34;consul-server-2.dc1\u0026#34; in area \u0026#34;wan\u0026#34; 2019/04/26 07:31:26 [INFO] serf: EventMemberLeave: consul-server-2 172.17.0.8 2019/04/26 07:31:26 [INFO] consul: Removing LAN server consul-server-2 (Addr: tcp/172.17.0.8:8300) (DC: dc1) 2019/04/26 07:31:29 [WARN] raft: Rejecting vote request from 172.17.0.7:8300 since we have a leader: 172.17.0.8:8300 2019/04/26 07:31:33 [WARN] raft: Heartbeat timeout from \u0026#34;172.17.0.8:8300\u0026#34; reached, starting election 2019/04/26 07:31:33 [INFO] raft: Node at 172.17.0.6:8300 [Candidate] entering Candidate state in term 3 2019/04/26 07:31:36 [ERR] agent: Coordinate update error: No cluster leader 2019/04/26 07:31:36 [INFO] serf: EventMemberJoin: consul-server-2 172.17.0.8 2019/04/26 07:31:36 [INFO] consul: Adding LAN server consul-server-2 (Addr: tcp/172.17.0.8:8300) (DC: dc1) 2019/04/26 07:31:37 [INFO] serf: EventMemberJoin: consul-server-2.dc1 172.17.0.8 2019/04/26 07:31:37 [INFO] consul: Handled member-join event for server \u0026#34;consul-server-2.dc1\u0026#34; in area \u0026#34;wan\u0026#34; 2019/04/26 07:31:37 [INFO] raft: Node at 172.17.0.6:8300 [Follower] entering Follower state (Leader: \u0026#34;\u0026#34;) 2019/04/26 07:31:37 [INFO] consul: New leader elected: consul-server-1 \u0026lt;snip\u0026gt; å…ˆç¨‹ã¨åŒæ§˜ã«ãƒªãƒ¼ãƒ€ãƒ¼ã®ç¢ºèªã‚’ä¸‹è¨˜ã®é€šã‚Šè¡Œã„ã¾ã™ã€‚\n$ for i in {0..2}; do kubectl exec consul-server-$i -- sh -c \u0026#39;consul info | grep leader\u0026#39;; done leader = false leader_addr = 172.17.0.7:8300 leader = true leader_addr = 172.17.0.7:8300 leader = false leader_addr = 172.17.0.7:8300 ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾‹ ä»Šå›ãƒ¬ãƒã‚¸ãƒˆãƒªä¸Šã«ã‚ã‚‹ value.yaml ã‚’ä¸€éƒ¨ä¿®æ­£ã—ãŸã ã‘ã§ã—ãŸãŒã€yaml å†…ã«ã‚ã‚‹å„è¨­å®šå€¤ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§æ§‹æˆã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚å„è¨­å®šå€¤ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã«è©³ç´°ãŒè¨˜ã•ã‚Œã¦ã„ã¾ã™ã€‚å…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãªã‚Šã¾ã™ã€‚\nhttps://www.consul.io/docs/platform/k8s/helm.html\nè¨­å®šå€¤ã®ä¾‹ã‚’ã‚ã’ã‚‹ã¨\u0026hellip;\nserver - replicas replicas ã¯ãƒ¬ãƒ—ãƒªã‚«æ•°ã€‚Consul ã‚¯ãƒ©ã‚¹ã‚¿ã® Pod æ•°ã«ãªã‚Šã¾ã™ã€‚ä½†ã—å†’é ­ã§è¿°ã¹ãŸã¨ãŠã‚Š Consul Helm Chat ã¯å„ Kubernetes ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦ 1 Pod ã®åŸå‰‡ã§èµ·å‹•ã—ã¾ã™ã®ã§ã€ãã®ç‚¹èªè­˜ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nserver - bootstrapExpect ä½•å°ã® Consul ã‚¯ãƒ©ã‚¹ã‚¿ Pod ãŒèµ·å‹•ã—ã¦ã„ã‚Œã°ãƒªãƒ¼ãƒ€ãƒ¼é¸å‡ºã‚’è¡Œã†ã‹ï¼Ÿã®è¨­å®šå€¤ã§ã™ã€‚\nserver - storageClass ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ã§ã™ã€‚Ceph ç­‰ã‚’é¸æŠã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚\nclient - grpc agent ãŒ gRPC ãƒªã‚¹ãƒŠã‚’æŒã¤ã‹ã©ã†ã‹ã§ã™ã€‚true ã«è¨­å®šã™ã‚‹ã¨ gRPC ãƒªã‚¹ãƒŠãŒ 8502 ç•ªãƒãƒ¼ãƒˆã§èµ·å‹•ã—ã¾ã™ã€‚\nã¾ã¨ã‚ Kubernetes ä¸Šã§ Helm ã‚’ä½¿ã£ã¦ç°¡å˜ã« Consul ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å‡ºæ¥ã‚‹äº‹ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚ã¾ãŸé‹ç”¨ã‚’è€ƒæ…®ã•ã‚ŒãŸè¨­è¨ˆã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚‚ç¢ºèªå‡ºæ¥ã¾ã—ãŸã€‚ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’ç”¨ã„ãšã¨ã‚‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“ã€API é–“ã§äº’ã„ã«æ­£å¸¸ã«å¯å‹•ã—ã¦ã„ã‚‹å…ˆã‚’ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªã—æ¥ç¶šã—åˆãˆã‚‹ã¨ã„ã†ç‚¹ã§ Consul ã¯ã¨ã¦ã‚‚æœ‰ç”¨ãªã®ã§ Kubernetes ã‚’ç”¨ã„ãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚‚é©ã—ã¦ã„ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚\n","permalink":"https://jedipunkz.github.io/post/consul-helm-chart/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ Hashicorp ã® Consul ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ Kubernetes ä¸Šã§ç¨¼åƒã•ã›ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eHashicorp Consul ã¯ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãŒè¡Œãˆã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã€ç§ã‚‚ä»¥å‰å±…ãŸè·å ´ã§åˆ©ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“ã§äº’ã„ã«æ¥ç¶šå…ˆã‚’ç¢ºèªã—åˆã†äº‹ãŒå‡ºæ¥ã¾ã™ã€‚ä»¥å‰æ§‹ç¯‰ã—ãŸ Consul ã‚¯ãƒ©ã‚¹ã‚¿ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã«ç›´ã«èµ·å‹•ã—ã¦ã„ãŸã®ã§ã™ãŒæœ€è¿‘ã ã¨ã©ã†ã‚„ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã‹èˆˆå‘³ã‚’æŒã¡ Kubernetes ä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’èª¿ã¹ãŸæ‰€ Helm ã‚’ä½¿ã£ã¦ç°¡å˜ã«ãƒ‡ãƒ—ãƒ­ã‚¤å‡ºæ¥ã‚‹äº‹ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãŸä»Šå›ã¯ minikube ã‚’ä½¿ã£ã¦è¤‡æ•°ã®ãƒ¬ãƒ—ãƒªã‚«ã‚’èµ·å‹•ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ãŒã€Helm Chart ã‚’ç”¨ã„ã‚‹ã¨ Kubernetes ã®ãƒãƒ¼ãƒ‰æ¯ã« Consul Pod ãŒ1ã¤ãšã¤èµ·å‹•ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¦ã€ãƒãƒ¼ãƒ‰ã®éšœå®³ã‚’è€ƒæ…®ã—ãŸå¯ç”¨æ€§ã¨ã„ã†ç‚¹ã§ã‚‚å„ªã‚Œã¦ã„ã‚‹ãªãã¨æ„Ÿã˜ã¾ã—ãŸã€‚ã¾ãŸ Kubernetes ã® Pod ã§ã™ã®ã§ãƒ—ãƒ­ã‚»ã‚¹ãŒè½ã¡ãŸéš›ã«å³åº§ã«å†èµ·å‹•ãŒè¡Œã‚ã‚Œã‚‹ã¨ã„ã†ç‚¹ã§ã‚‚å„ªã‚Œã¦ã„ã¾ã™ã€‚å‹¿è«– Consul ã‚¯ãƒ©ã‚¹ã‚¿ã® Leader ãŒè½ã¡ãŸå ´åˆã«ã¯ Leader Election (ãƒªãƒ¼ãƒ€æ˜‡æ ¼ã®ãŸã‚ã®é¸æŒ™) ãŒè¡Œã‚ã‚Œã€ç›´ã¡ã«éš£æ¥ã—ãŸ Kubernetes ãƒãƒ¼ãƒ‰ä¸Šã® Consul Pod ãŒãƒªãƒ¼ãƒ€ãƒ¼ã«æ˜‡æ ¼ã—ã¾ã™ã€‚ã¨ã„ã£ãŸæ„å‘³ã§ã‚‚ Kubernetes ä¸Šã« Consul ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¨ã„ã†è€ƒãˆã¯å„ªã‚Œã¦ã„ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚\u003c/p\u003e\n\u003ch3 id=\"requirements\"\u003eRequirements\u003c/h3\u003e\n\u003cp\u003eä¸‹è¨˜ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒäº‹å‰ã«å¿…è¦ã§ã™ã€‚ã“ã®æ‰‹é †ã§ã¯äºˆã‚ã“ã‚Œã‚‰ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã¨ã—ã¦è¨˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eminikube\u003c/li\u003e\n\u003cli\u003ekubectl\u003c/li\u003e\n\u003cli\u003ehelm\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"consul-ã‚¯ãƒ©ã‚¹ã‚¿èµ·å‹•ã¾ã§ã®æ‰‹é †\"\u003eConsul ã‚¯ãƒ©ã‚¹ã‚¿èµ·å‹•ã¾ã§ã®æ‰‹é †\u003c/h3\u003e\n\u003cp\u003eæ—©é€Ÿã§ã™ãŒæ‰‹é †ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eHashicorp ã® Github ã«ã¦ Consul ã® Helm Chart ãŒå…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚\u003ccode\u003ehelm search\u003c/code\u003e ã—ã¦ã‚‚å‡ºã¦ãã¾ã™ãŒã€ä»Šå›ã¯ Github ã®ã‚‚ã®ã‚’ç”¨ã„ã¾ã—ãŸã€‚\u003c/p\u003e","title":"Consul Helm Chart ã§ Kubernetes ä¸Šã« Consul ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nå‰å›ã®è¨˜äº‹ ã€ŒIstio, Helm ã‚’ä½¿ã£ã¦ Getting Started çš„ãªã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã§ kubernetes ä¸Šã§ istio ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã— sidecar injection ã‚’æœ‰åŠ¹åŒ–ã—ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¾ã—ãŸã€‚ãã®çµæœã€sidecar çš„ã« envoy ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã™ã‚‹ã¨ã“ã‚ã¾ã§ç¢ºèªã—ã¾ã—ãŸã€‚ä»Šå›ã¯ã‚‚ã†å°‘ã—å˜ç´”ãª pod ã‚’ç”¨ã„ã¦ \u0026lsquo;sidecar injection\u0026rsquo; ã®ä¸­èº«ã‚’ã‚‚ã†å°‘ã—ã ã‘æ·±æ˜ã‚Šã—ã¦è¦‹ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\nRquirements è¨˜äº‹ã¨åŒç­‰ã®å‹•ãã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ä¸‹è¨˜ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ ãã‚Œãã‚Œã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¯äº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸå‰æã§è¨˜äº‹ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\nmacos or linux os kubectl istioctl minikube å‚è€ƒ URL ä¸‹è¨˜ã® istio å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«å‹•ä½œç¢ºèªã—ã¾ã—ãŸã€‚\nhttps://istio.io/docs/setup/kubernetes/additional-setup/sidecar-injection/ https://istio.io/docs/setup/kubernetes/additional-setup/sidecar-injection/ minikube ã§ kubenetes ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ å‰å›åŒæ§˜ã« minikube ä¸Šã§å‹•ä½œã‚’ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯é©å®œã€è‡ªåˆ†ã®ç’°å¢ƒã«èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚\nminikube start --memory=8192 --cpus=4 --kubernetes-version=v1.10.0 \\ --extra-config=controller-manager.cluster-signing-cert-file=\u0026#34;/var/lib/minikube/certs/ca.crt\u0026#34; \\ --extra-config=controller-manager.cluster-signing-key-file=\u0026#34;/var/lib/minikube/certs/ca.key\u0026#34; \\ --vm-driver=virtualbox istio ã‚’ç¨¼åƒã•ã›ã‚‹ ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨ã„ã¦ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« istio ã®ã‚µãƒ³ãƒ—ãƒ« yaml ãŒå…¥ã£ãŸãƒ•ã‚©ãƒ«ãƒ€ã‚’å±•é–‹ã—ã¾ã™ã€‚\ncurl -L https://git.io/getLatestIstio | sh - æ¬¡ã«ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ kubernetes ä¸Šã« istio ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ istio ã‚³ãƒ³ãƒ†ãƒŠé–“ã®é€šä¿¡ã‚’ãƒ—ãƒ¬ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ or TLS ã§è¡Œã†ã‚ˆã† istio-demo.yml ã‚’ apply ã—ã¦ã„ã¾ã™ã€‚\ncd istio-1.1.3/ kubectl apply -f install/kubernetes/helm/istio-init/files/crd-10.yaml kubectl apply -f install/kubernetes/helm/istio-init/files/crd-11.yaml kubectl apply -f install/kubernetes/helm/istio-init/files/crd-certmanager-10.yaml kubectl apply -f install/kubernetes/helm/istio-init/files/crd-certmanager-11.yaml kubectl apply -f install/kubernetes/istio-demo.yaml ç¨¼åƒçŠ¶æ³ã‚’ç¢ºèªã—ã¾ã™ã€‚ã¾ãš Service ã®çŠ¶æ…‹ã§ã™ã€‚\nkubectl get svc -n istio-system NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE grafana ClusterIP 10.98.111.63 \u0026lt;none\u0026gt; 3000/TCP 9s istio-citadel ClusterIP 10.97.197.128 \u0026lt;none\u0026gt; 8060/TCP,15014/TCP 8s istio-egressgateway ClusterIP 10.96.35.77 \u0026lt;none\u0026gt; 80/TCP,443/TCP,15443/TCP 9s istio-galley ClusterIP 10.100.143.114 \u0026lt;none\u0026gt; 443/TCP,15014/TCP,9901/TCP 9s istio-ingressgateway LoadBalancer 10.105.202.136 \u0026lt;pending\u0026gt; 15020:30773/TCP,80:31380/TCP,443:31390/TCP,31400:31400/TCP,15029:31398/TCP,15030:32184/TCP,15031:31724/TCP,15032:30064/TCP,15443:30160/TCP 9s istio-pilot ClusterIP 10.102.53.62 \u0026lt;none\u0026gt; 15010/TCP,15011/TCP,8080/TCP,15014/TCP 8s istio-policy ClusterIP 10.105.107.53 \u0026lt;none\u0026gt; 9091/TCP,15004/TCP,15014/TCP 8s istio-sidecar-injector ClusterIP 10.104.82.138 \u0026lt;none\u0026gt; 443/TCP 8s istio-telemetry ClusterIP 10.97.117.166 \u0026lt;none\u0026gt; 9091/TCP,15004/TCP,15014/TCP,42422/TCP 8s jaeger-agent ClusterIP None \u0026lt;none\u0026gt; 5775/UDP,6831/UDP,6832/UDP 7s jaeger-collector ClusterIP 10.107.35.224 \u0026lt;none\u0026gt; 14267/TCP,14268/TCP 7s jaeger-query ClusterIP 10.108.172.46 \u0026lt;none\u0026gt; 16686/TCP 7s kiali ClusterIP 10.107.129.129 \u0026lt;none\u0026gt; 20001/TCP 8s prometheus ClusterIP 10.109.114.141 \u0026lt;none\u0026gt; 9090/TCP 8s tracing ClusterIP 10.108.154.22 \u0026lt;none\u0026gt; 80/TCP 7s zipkin ClusterIP 10.96.151.43 \u0026lt;none\u0026gt; 9411/TCP 7s Pod ã®çŠ¶æ…‹ã§ã™ã€‚\nkubectl get pods -n istio-system NAME READY STATUS RESTARTS AGE grafana-688b8999cd-d4clx 1/1 Running 0 115m istio-citadel-5749f4b6dd-jd6qm 1/1 Running 0 115m istio-cleanup-secrets-1.1.3-mv8lq 0/1 Completed 0 115m istio-egressgateway-666b76dbf7-mjjx6 1/1 Running 0 115m istio-galley-d68bdc684-nwtzz 1/1 Running 0 115m istio-grafana-post-install-1.1.3-gkn4s 0/1 Completed 0 115m istio-ingressgateway-d67598f4-pwddm 1/1 Running 0 115m istio-pilot-865f6997cd-7jmq4 2/2 Running 0 115m istio-policy-56957d4666-vljk9 2/2 Running 5 115m istio-security-post-install-1.1.3-f894p 0/1 Completed 0 115m istio-sidecar-injector-5cf67ccc65-9p69k 1/1 Running 0 115m istio-telemetry-786796559d-dqwr2 2/2 Running 5 115m istio-tracing-5d8f57c8ff-xps9b 1/1 Running 0 115m kiali-95fcf457f-kfdhp 1/1 Running 0 115m prometheus-5554746896-ccs5x 1/1 Running 0 115m istio-injection ãªçŠ¶æ…‹ã§ã‚µãƒ³ãƒ—ãƒ« pod ã‚³ãƒ³ãƒ†ãƒŠ \u0026lsquo;sleep\u0026rsquo; ã‚’èµ·å‹• ã“ã“ã§ sleep ã‚³ãƒãƒ³ãƒ‰ãŒèµ·å‹•ã™ã‚‹ã ã‘ã® pod ã‚³ãƒ³ãƒ†ãƒŠã‚’ istio-injection=enabled ãªçŠ¶æ…‹ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚ã¾ãšå…ˆç¨‹ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã® sleep.yaml ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\ncat sample/sleep/sleep.yaml apiVersion: v1 kind: ServiceAccount metadata: name: sleep --- apiVersion: v1 kind: Service metadata: name: sleep labels: app: sleep spec: ports: - port: 80 name: http selector: app: sleep --- apiVersion: extensions/v1beta1 kind: Deployment metadata: name: sleep spec: replicas: 1 template: metadata: labels: app: sleep spec: serviceAccountName: sleep containers: - name: sleep image: pstauffer/curl command: [\u0026#34;/bin/sleep\u0026#34;, \u0026#34;3650d\u0026#34;] imagePullPolicy: IfNotPresent --- ã“ã® yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨ã„ã‚‹ã®ã§ã™ãŒã€istioctl ã‚³ãƒãƒ³ãƒ‰ã®ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ kube-inject ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã“ã®å…ƒã¨ãªã‚‹ yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ istio-injection=enabled ãªçŠ¶æ…‹ã® yaml ãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ã‚ˆã£ã¦ kubectl ã‚³ãƒãƒ³ãƒ‰ã§ apply ã™ã‚‹æ‰‹é †ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚\nkubectl apply -f \u0026lt;(istioctl kube-inject -f samples/sleep/sleep.yaml) ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸçŠ¶æ…‹ã‚’ç¢ºèªã— sidecar ã‚³ãƒ³ãƒ†ãƒŠã‚’çŸ¥ã‚‹ ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸ Deployment ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nkubectl get deployments sleep -o yaml apiVersion: extensions/v1beta1 kind: Deployment metadata: annotations: deployment.kubernetes.io/revision: \u0026#34;1\u0026#34; \u0026lt;snip\u0026gt; spec: containers: - command: - /bin/sleep - 3650d image: pstauffer/curl imagePullPolicy: IfNotPresent name: sleep \u0026lt;snip\u0026gt; image: docker.io/istio/proxyv2:1.1.3 imagePullPolicy: IfNotPresent name: istio-proxy ports: - containerPort: 15090 \u0026lt;snip\u0026gt; image: docker.io/istio/proxy_init:1.1.3 imagePullPolicy: IfNotPresent name: istio-init \u0026lt;snip\u0026gt; pstauffer/curl ã‚¤ãƒ¡ãƒ¼ã‚¸å†…ã§ \u0026lsquo;/bin/sleep\u0026rsquo; ã‚³ãƒãƒ³ãƒ‰ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã¨éš£æ¥ã—ã¦ istio-proxy ã¨ istio-init ã¨ã„ã†ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªå‡ºæ¥ã‚‹ã¨æ€ã„ã¾ã™ã€‚ãã‚Œãã‚Œã®å½¹å‰²ã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\nistio-proxy : ä»–ã® istio ã‹ã‚‰ã®é€šä¿¡ã‚’ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã«ä¸­ç¶™ã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒ†ãƒŠ istio-init : istio-proxy ã‚³ãƒ³ãƒ†ãƒŠã‚’ä»‹ã™é€šä¿¡ã‚’ iptables ã§åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒ†ãƒŠ ã“ã‚Œã‚‰ãŒ istio ã‚’ç”¨ã„ã‚‹ã“ã¨ã§èµ·å‹•ã—ãŸ sidecar ã‚³ãƒ³ãƒ†ãƒŠã¨ãªã‚Šã¾ã™ã€‚\nä¸‹è¨˜ã®é€šã‚Š pods ã‚’ describe ã™ã‚‹ã“ã¨ã§ã‚‚ã“ã‚Œã‚‰ã®ã‚³ãƒ³ãƒ†ãƒŠãŒç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\nkubectl describe pod sleep-759d5cb4ff-btqvl \u0026lt;snip\u0026gt; Init Containers: istio-init: Container ID: docker://ded035851fa141997fdca47a0c317203cda650a0f9dce2f8d46ab264aa0e168b Image: docker.io/istio/proxy_init:1.1.3 Image ID: docker-pullable://istio/proxy_init@sha256:000d022d27c198faa6cc9b03d806482d08071e146423d6e9f81aa135499c4ed3 Port: \u0026lt;none\u0026gt; Host Port: \u0026lt;none\u0026gt; \u0026lt;snip\u0026gt; Containers: sleep: Container ID: docker://b6121c749a2eb394b81728063046eb0eb48ea1b48c464debe395e4b58768513c Image: pstauffer/curl Image ID: docker-pullable://pstauffer/curl@sha256:2663156457abb72d269eb19fe53c2d49e2e4a9fdcb9fa8f082d0282d82eb8e42 Port: \u0026lt;none\u0026gt; Host Port: \u0026lt;none\u0026gt; \u0026lt;snip\u0026gt; istio-proxy: Container ID: docker://0baee18b7d6ecec985b61fd10eff3409131245d390fad8f274d420f0807bc941 Image: docker.io/istio/proxyv2:1.1.3 Image ID: docker-pullable://istio/proxyv2@sha256:b682918f2f8fcca14b3a61bbd58f4118311eebc20799f24b72ceddc5cd749306 Port: 15090/TCP Host Port: 0/TCP sidecar ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ãªã‚‹ configmap ã‚’ç¢ºèªã™ã‚‹ ä»Šå› istio-injection=enabled ãªçŠ¶æ…‹ã§ \u0026lsquo;sleep\u0026rsquo; ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—æœ¬ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠã¨ã¯åˆ¥ã« sidecar ãªã‚³ãƒ³ãƒ†ãƒŠ2ã¤ãŒç¨¼åƒã™ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚æ¬¡ã«èª¬æ˜ã™ã‚‹ã®ãŒ configmap ã§ã™ã€‚ã©ã®æ§˜ãªçŠ¶æ…‹ã§ã©ã®æ§˜ãªã‚³ãƒ³ãƒ†ãƒŠã‚’ sidecar çš„ã«ç¨¼åƒã•ã›ã‚‹ã‹ã®ãƒ«ãƒ¼ãƒ«ã‚’è¨˜ã—ãŸã‚‚ã®ãŒ istio-sidecar-injector ã¨ã„ã† configmap ã«ãªã‚Šã¾ã™ã€‚ãã® configmap ã®å†…å®¹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nkubectl -n istio-system get configmap istio-sidecar-injector -o=jsonpath=\u0026#39;{.data.config}\u0026#39; policy: enabled template: |- rewriteAppHTTPProbe: false initContainers: [[ if ne (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) \u0026#34;NONE\u0026#34; ]] - name: istio-init image: \u0026#34;docker.io/istio/proxy_init:1.1.3\u0026#34; args: - \u0026#34;-p\u0026#34; - [[ .MeshConfig.ProxyListenPort ]] - \u0026#34;-u\u0026#34; - 1337 - \u0026#34;-m\u0026#34; - [[ annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode ]] - \u0026#34;-i\u0026#34; - \u0026#34;[[ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundIPRanges` \u0026#34;*\u0026#34; ]]\u0026#34; - \u0026#34;-x\u0026#34; - \u0026#34;[[ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundIPRanges` \u0026#34;\u0026#34; ]]\u0026#34; - \u0026#34;-b\u0026#34; - \u0026#34;[[ annotation .ObjectMeta `traffic.sidecar.istio.io/includeInboundPorts` (includeInboundPorts .Spec.Containers) ]]\u0026#34; - \u0026#34;-d\u0026#34; - \u0026#34;[[ excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` 15020 ) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` \u0026#34;\u0026#34; ) ]]\u0026#34; [[ if (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces`) -]] - \u0026#34;-k\u0026#34; - \u0026#34;[[ index .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces` ]]\u0026#34; [[ end -]] imagePullPolicy: IfNotPresent resources: requests: cpu: 10m memory: 10Mi limits: cpu: 100m memory: 50Mi securityContext: runAsUser: 0 runAsNonRoot: false capabilities: add: - NET_ADMIN restartPolicy: Always [[ end -]] containers: - name: istio-proxy image: [[ annotation .ObjectMeta `sidecar.istio.io/proxyImage` \u0026#34;docker.io/istio/proxyv2:1.1.3\u0026#34; ]] ports: - containerPort: 15090 protocol: TCP name: http-envoy-prom \u0026lt;snip\u0026gt; ã“ã® configmap ã‹ã‚‰ä¸‹è¨˜ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè¨˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\nã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ CPU å‰²å½“ ãƒ¡ãƒ¢ãƒªå‰²ã‚Šå½“ã¦ ä¿®æ­£ã™ã‚‹ãŸã‚ã«å¿…è¦ãªæ¨©é™ ãƒãƒ¼ãƒˆæŒ‡å®š ãƒ—ãƒ­ãƒˆã‚³ãƒ« etc.. pod ã® iptables ã‚’ç¢ºèªã—ã¦ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã‚’ç†è§£ã™ã‚‹ æ¬¡ã« minikube ã®ãƒ›ã‚¹ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã‚µãƒ¼ãƒ“ã‚¹ pod (ä»Šå›ã¯ \u0026lsquo;sleep\u0026rsquo;) ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸ iptables ã®å†…å®¹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nminikube ssh docker ps | grep sleep b6121c749a2e pstauffer/curl \u0026#34;/bin/sleep 3650d\u0026#34; 3 hours ago Up 3 hours k8s_sleep_sleep-759d5cb4ff-btqvl_default_6f3f6854-6651-11e9-970b-080027d5d6a7_0 ã“ã® docker id `b6121c749a2e\u0026rsquo; ã¨ nsenter ã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨ã„ã¦ pod (sleep) ã«é©ç”¨ã•ã‚Œã¦ã„ã‚‹ iptables ã®å†…å®¹ã‚’ç¢ºèªã—ã¾ã™ã€‚\ndocker inspect b6121c749a2e --format \u0026#39;{{ .State.Pid }}\u0026#39; 20066 sudo nsenter -t 20066 -n iptables -t nat -S -P PREROUTING ACCEPT -P INPUT ACCEPT -P OUTPUT ACCEPT -P POSTROUTING ACCEPT -N ISTIO_IN_REDIRECT -N ISTIO_OUTPUT -N ISTIO_REDIRECT -A OUTPUT -p tcp -j ISTIO_OUTPUT -A ISTIO_IN_REDIRECT -p tcp -j REDIRECT --to-ports 15001 -A ISTIO_OUTPUT ! -d 127.0.0.1/32 -o lo -j ISTIO_REDIRECT -A ISTIO_OUTPUT -m owner --uid-owner 1337 -j RETURN -A ISTIO_OUTPUT -m owner --gid-owner 1337 -j RETURN -A ISTIO_OUTPUT -d 127.0.0.1/32 -j RETURN -A ISTIO_OUTPUT -j ISTIO_REDIRECT -A ISTIO_REDIRECT -p tcp -j REDIRECT --to-ports 15001 çµæœã‹ã‚‰ã€ã“ã® pod ã¯ INBOUND é€šä¿¡ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆãƒãƒ¼ãƒˆã¨ã—ã¦ 15001 ç•ªãƒãƒ¼ãƒˆãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ã“ã®ãƒãƒ¼ãƒˆã¯ istio-proxy ãŒå¾…ã¡å—ã‘ã¦ã„ã‚‹ãƒãƒ¼ãƒˆã«ãªã‚Šã¾ã™ã€‚ã¾ãŸ OUTBOUND é€šä¿¡ã«é–¢ã—ã¦ã‚‚åŒæ§˜ã« 15001 ç•ªãƒãƒ¼ãƒˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ã‚ˆã£ã¦ \u0026lsquo;sleep\u0026rsquo; pod ã‚³ãƒ³ãƒ†ãƒŠã®å…¨ã¦ã®é€šä¿¡ãŒ istio-proxy ã‚’ä»‹ã™ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚ã¾ãŸä»Šå›ã¯å˜ç´”ã« sleep ã™ã‚‹ã ã‘ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¾ã—ãŸãŒã€http ã‚µãƒ¼ãƒç­‰ã‚’èµ·å‹•ã™ã‚‹ pod ã‚’ç«‹ã¡ä¸Šã’ãŸå ´åˆ -A ISTIO_INBOUND -p tcp -m tcp --dport 80 -j ISTIO_IN_REDIRECT ã¨ã„ã£ãŸåˆ¶å¾¡ã‚‚ç¢ºèªå‡ºæ¥ã‚‹ã¨æ€ã„ã¾ã™ã€‚\nã¾ã¨ã‚ kubernetes ä¸Šã« istio ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã§ã€ãƒ†ã‚¹ãƒˆã§èµ·å‹•ã—ãŸ pod ã‚³ãƒ³ãƒ†ãƒŠã«éš£æ¥ã™ã‚‹å½¢ã§ sidecar ã‚³ãƒ³ãƒ†ãƒŠ istio-proxy, istio-init ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã™ã‚‹ã“ã¨ãŒç¢ºèªå‡ºæ¥ã¾ã—ãŸã€‚ã¾ãŸãã‚Œã‚‰ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ãªã‚‹ configmap ã®å†…å®¹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ã“ã® configmap ã¯ä¿®æ­£ã™ã‚‹ã“ã¨ãŒå¯èƒ½ãªæ§˜ã§ã™ã€‚ãã—ã¦ã“ã® pod ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ»ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ã®é€šä¿¡ã¯å…¨ã¦ istio-proxy ã‚³ãƒ³ãƒ†ãƒŠã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚‚åˆ†ã‹ã‚Šã¾ã—ãŸã€‚ã¾ãŸä»Šå›ã¯ configmap ã®å†…å®¹ã‚’ç¢ºèªã™ã‚‹ã«ç•™ã¾ã‚Šã¾ã—ãŸãŒã€istio ã®æ©Ÿèƒ½ã¨ã—ã¦ã¯ routing, service discovery ç­‰ã‚‚æœ‰ã—ã¦ã„ã‚‹ãŸã‚ã€æ¬¡å›ã¯ routing ã‚ãŸã‚Šã‚’èª¿ã¹ã‚ˆã†ã‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ã“ã® routing ã‚’æ“ä½œã™ã‚‹ã“ã¨ã§ä»Šå›ç¢ºèªã—ãŸ iptables ã®å†…å®¹ã‚‚å¤‰ã‚ã£ã¦ãã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚\n","permalink":"https://jedipunkz.github.io/post/istio-sidecar-injection/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå‰å›ã®è¨˜äº‹ \u003ca href=\"https://jedipunkz.github.io/blog/2018/12/31/istio/\"\u003eã€ŒIstio, Helm ã‚’ä½¿ã£ã¦ Getting Started çš„ãªã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã€\u003c/a\u003eã§ kubernetes ä¸Šã§ istio ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã— sidecar injection ã‚’æœ‰åŠ¹åŒ–ã—ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¾ã—ãŸã€‚ãã®çµæœã€sidecar çš„ã« envoy ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã™ã‚‹ã¨ã“ã‚ã¾ã§ç¢ºèªã—ã¾ã—ãŸã€‚ä»Šå›ã¯ã‚‚ã†å°‘ã—å˜ç´”ãª pod ã‚’ç”¨ã„ã¦ \u0026lsquo;sidecar injection\u0026rsquo; ã®ä¸­èº«ã‚’ã‚‚ã†å°‘ã—ã ã‘æ·±æ˜ã‚Šã—ã¦è¦‹ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch3 id=\"rquirements\"\u003eRquirements\u003c/h3\u003e\n\u003cp\u003eè¨˜äº‹ã¨åŒç­‰ã®å‹•ãã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ä¸‹è¨˜ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚\nãã‚Œãã‚Œã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¯äº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸå‰æã§è¨˜äº‹ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003emacos or linux os\u003c/li\u003e\n\u003cli\u003ekubectl\u003c/li\u003e\n\u003cli\u003eistioctl\u003c/li\u003e\n\u003cli\u003eminikube\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"å‚è€ƒ-url\"\u003eå‚è€ƒ URL\u003c/h3\u003e\n\u003cp\u003eä¸‹è¨˜ã® istio å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«å‹•ä½œç¢ºèªã—ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://istio.io/docs/setup/kubernetes/additional-setup/sidecar-injection/\"\u003ehttps://istio.io/docs/setup/kubernetes/additional-setup/sidecar-injection/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://istio.io/docs/setup/kubernetes/additional-setup/sidecar-injection/\"\u003ehttps://istio.io/docs/setup/kubernetes/additional-setup/sidecar-injection/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"minikube-ã§-kubenetes-ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤\"\u003eminikube ã§ kubenetes ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤\u003c/h3\u003e\n\u003cp\u003eå‰å›åŒæ§˜ã« minikube ä¸Šã§å‹•ä½œã‚’ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯é©å®œã€è‡ªåˆ†ã®ç’°å¢ƒã«èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eminikube start --memory\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8192\u003c/span\u003e --cpus\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e --kubernetes-version\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ev1.10.0 \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e  --extra-config\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003econtroller-manager.cluster-signing-cert-file\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/var/lib/minikube/certs/ca.crt\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e  --extra-config\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003econtroller-manager.cluster-signing-key-file\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/var/lib/minikube/certs/ca.key\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e  --vm-driver\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evirtualbox\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"istio-ã‚’ç¨¼åƒã•ã›ã‚‹\"\u003eistio ã‚’ç¨¼åƒã•ã›ã‚‹\u003c/h3\u003e\n\u003cp\u003eä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨ã„ã¦ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« istio ã®ã‚µãƒ³ãƒ—ãƒ« yaml ãŒå…¥ã£ãŸãƒ•ã‚©ãƒ«ãƒ€ã‚’å±•é–‹ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl -L https://git.io/getLatestIstio | sh -\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ¬¡ã«ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ kubernetes ä¸Šã« istio ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\nistio ã‚³ãƒ³ãƒ†ãƒŠé–“ã®é€šä¿¡ã‚’ãƒ—ãƒ¬ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ or TLS ã§è¡Œã†ã‚ˆã† istio-demo.yml ã‚’ apply ã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e","title":"Istio Sidecar Injection ã‚’ç†è§£ã™ã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\næœ€è¿‘ã¯ kubernetes ã‚’è§¦ã£ã¦ãªã‹ã£ãŸã®ã§ã™ãŒ Istio ã‚„ Envoy ç­‰ CNCF é–¢é€£ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®è¨˜äº‹ã‚’ã‚ˆãè¦‹ã‹ã‘ã‚‹ã‚ˆã†ã«ãªã£ã¦ã€å°‘ã—ç†è§£ã—ã¦ãŠã„ãŸã»ã†ãŒã„ã„ã‹ãªã¨æ€ã„ Istio ã¨ Minikube ã‚’ä½¿ã£ã¦ Getting Started çš„ãªäº‹ã‚’ã‚„ã£ã¦ã¿ã¾ã—ãŸã€‚Istio ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ä¸­ã«ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå…¥ã£ã¦ã„ã‚‹ã®ã§ãã‚Œã‚’åˆ©ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã‚’è¡Œã£ã¦ã¿ã¾ã™ã€‚\nIstio ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ãŠæ‰‹è»½ã« Istio ç’°å¢ƒã‚’ä½œã‚‹ãŸã‚ã® yaml ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã€ãã‚Œã‚’ kubectl apply ã™ã‚‹ã“ã¨ã§ Istio ç’°å¢ƒã‚’æ•´ãˆã‚‰ã‚Œã‚‹ã®ã§ã™ãŒã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã‚’æƒ³å®šã—ãŸå ´åˆã¯ Helm Template ã‚’ç”¨ã„ãŸæ–¹ãŒã„ã„ã ã‚ã†ã€ã¨è¨˜è¼‰ã‚ã£ãŸã®ã§ä»Šå›ã¯ Helm Template ã‚’ç”¨ã„ã¦ Istio ç’°å¢ƒã‚’ä½œã‚Šã¾ã™ã€‚\nå‰æã®ç’°å¢ƒ ä¸‹è¨˜ã®ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã¾ã—ãŸã€‚\nmacos Mojave minikube v0.32.0 kubectl v1.10.3 helm v2.12.1 virtualbox æº–å‚™ kubectl ã¨ helm ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« kubctl ã¨ helm ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ä¸¡è€…å…±ã« homebrew ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\nbrew install kubernetes-cli brew install kubernetes-helm minikube ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨èµ·å‹• minikube ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦èµ·å‹•ã—ã¾ã™ã€‚\ncurl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.32.0/minikube-darwin-amd64 \u0026amp;\u0026amp; chmod +x minikube \u0026amp;\u0026amp; sudo cp minikube /usr/local/bin/ \u0026amp;\u0026amp; rm minikube minikube start --memory 2048 Istio ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« Istio ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã™ã€‚å¾Œè¡“ã—ã¾ã™ãŒã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­ã« Istio ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚\ncurl -L https://git.io/getLatestIstio | sh - cd istio-1.0.5 sudo cp bin/istioctl /usr/local/bin/istioctl æ§‹ç¯‰ä½œæ¥­ Istio ã® Custom Resource Definitions ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« Istio ã® Custom Resource Definitions (ä»¥ä¸‹ CRDs) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚Kubernetes ã® CRDs ã¯ç‹¬è‡ªã®ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã‚’å®šç¾©ã—è¿½åŠ ã™ã‚‹ã‚‚ã®ã§ã™ã€‚Kubernets API Server ã‚’ä»‹ã—ã¦ä½œæˆã™ã‚‹ã“ã¨ã§ä½œæˆã—ãŸãƒªã‚½ãƒ¼ã‚¹ã® CRUD ã® API ãŒ Kubernetes API ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚\nå…ˆç¨‹ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ Istio ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« crds.yaml ãŒã‚ã‚‹ã®ã§ãã‚Œã‚’é©ç”¨ã—ã¾ã™ã€‚\nkubectl apply -f install/kubernetes/helm/istio/templates/crds.yaml Helm Template ã‚’ä½¿ã£ã¦ Istio ã® Core Components ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« Helm Template ã®ä»•çµ„ã¿ã‚’ã¤ã‹ã£ã¦ Istio ã® Core Components ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ã¾ãš Helm Template ã‚’å‡ºåŠ›ã— istio-system ã¨ã„ã†ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½œæˆã€ãã®å¾Œç”Ÿæˆã—ãŸ Template ã‚’ç”¨ã„ã¦ kubectl ã‚³ãƒãƒ³ãƒ‰ã§é©ç”¨ã—ã¾ã™ã€‚\nhelm template install/kubernetes/helm/istio --name istio --namespace istio-system \u0026gt; ./istio.yaml kubectl create namespace istio-system kubectl apply -f ./istio.yaml çŠ¶æ…‹ã®ç¢ºèª ã“ã®çŠ¶æ…‹ã§ service ã¨ pods ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚\nkubectl get svc -n istio-system NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE istio-citadel ClusterIP 10.100.143.194 \u0026lt;none\u0026gt; 8060/TCP,9093/TCP 55s istio-egressgateway ClusterIP 10.108.243.97 \u0026lt;none\u0026gt; 80/TCP,443/TCP 55s istio-galley ClusterIP 10.98.99.11 \u0026lt;none\u0026gt; 443/TCP,9093/TCP 55s istio-ingressgateway LoadBalancer 10.97.17.220 \u0026lt;pending\u0026gt; 80:31380/TCP,443:31390/TCP,31400:31400/TCP,15011:30080/TCP,8060:31309/TCP,853:31151/TCP,15030:30455/TCP,15031:30836/TCP 55s istio-pilot ClusterIP 10.102.75.110 \u0026lt;none\u0026gt; 15010/TCP,15011/TCP,8080/TCP,9093/TCP 55s istio-policy ClusterIP 10.101.145.62 \u0026lt;none\u0026gt; 9091/TCP,15004/TCP,9093/TCP 55s istio-sidecar-injector ClusterIP 10.107.131.48 \u0026lt;none\u0026gt; 443/TCP 55s istio-telemetry ClusterIP 10.96.248.64 \u0026lt;none\u0026gt; 9091/TCP,15004/TCP,9093/TCP,42422/TCP 55s prometheus ClusterIP 10.98.228.190 \u0026lt;none\u0026gt; 9090/TCP 55s kubectl get pods -n istio-system NAME READY STATUS RESTARTS AGE istio-citadel-55cdfdd57c-64tnn 0/1 ContainerCreating 0 1m istio-cleanup-secrets-x6dmj 0/1 Completed 0 1m istio-egressgateway-7798845f5d-qfx2k 1/1 Running 0 1m istio-galley-76bbb946c8-5l626 0/1 ContainerCreating 0 1m istio-ingressgateway-78c6d8b8d7-68r2z 1/1 Running 0 1m istio-pilot-5fcb895bff-pmg8z 0/2 Pending 0 1m istio-policy-7b6cc95d7b-w7ndg 2/2 Running 0 1m istio-security-post-install-jcwg5 0/1 Completed 0 1m istio-sidecar-injector-9c6698858-8lt92 0/1 ContainerCreating 0 1m istio-telemetry-bfc9ff784-2mzzj 2/2 Running 0 1m prometheus-65d6f6b6c-nttwz 0/1 ContainerCreating 0 1m ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ å…ˆç¨‹ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ Istio ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ \u0026lsquo;bookinfo\u0026rsquo; ãŒã‚ã‚Šã¾ã™ã®ã§ãã‚Œã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã¾ã™ã€‚ ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã¯2ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚ã‚Šã¾ã™ã€‚\næ–¹æ³•1. istioctl ã‚’ä½¿ã£ã¦ã‚¢ãƒ—ãƒªã® yaml ã«å¯¾ã—ã¦ sidecar ã‚’è¨˜ã™ã‚ˆã†å¤‰æ›ã—ãã‚Œã‚’ kubctl apply ã—ã¾ã™ã€‚\nkubectl apply -f \u0026lt;(istioctl kube-inject -f samples/bookinfo/platform/kube/bookinfo.yaml) æ–¹æ³•2. Sidecar Injection ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ãã¨ã—ã¦è¨­å®šã— kubectl apply ã—ã¾ã™\nkubectl label namespace default istio-injection=enabled kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yam æœ€å¾Œã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¾ã™\nkubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE details ClusterIP 10.111.252.7 \u0026lt;none\u0026gt; 9080/TCP 17s kubernetes ClusterIP 10.96.0.1 \u0026lt;none\u0026gt; 443/TCP 6m productpage ClusterIP 10.108.205.216 \u0026lt;none\u0026gt; 9080/TCP 10s ratings ClusterIP 10.102.161.24 \u0026lt;none\u0026gt; 9080/TCP 14s reviews ClusterIP 10.106.18.105 \u0026lt;none\u0026gt; 9080/TCP 12s kubectl get pods NAME READY STATUS RESTARTS AGE details-v1-5458f64c65-svrr7 0/2 PodInitializing 0 48s productpage-v1-577c9594b7-4f49s 0/2 Init:0/1 0 43s ratings-v1-79467df9b5-vrx4w 0/2 PodInitializing 0 47s reviews-v1-5d46b744bd-686s9 0/2 Init:0/1 0 46s reviews-v2-7f7d7f99f7-xsvm8 0/2 Init:0/1 0 46s reviews-v3-7bc67f66-cmt4x 0/2 Init:0/1 0 45s ã¾ã¨ã‚ ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã‚’æƒ³å®šã—ãŸ Istio æ§‹ç¯‰ã¨è¨€ã£ã¦ã‚‚ Helm Template ã‚’ç”¨ã„ã¦ç°¡å˜ã«æ“ä½œã§ãã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚\nã¾ãŸã“ã“ã§é‡è¦ãªã®ã¯ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ \u0026lsquo;bookinfo\u0026rsquo; ã® Kubenetes Pods ã« Envoy ãƒ—ãƒ­ã‚­ã‚·ã‚’ Sidecar çš„ã«é…ç½®ã™ã‚‹ãŸã‚ã®å¤‰æ›ã‚³ãƒãƒ³ãƒ‰ã¨ã—ã¦\nkubectl apply -f \u0026lt;(istioctl kube-inject -f samples/bookinfo/platform/kube/bookinfo.yaml) ãŒç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚ä¸‹è¨˜ã®æ“ä½œã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨ã‚ˆãã‚ã‹ã‚‹ã§ã—ã‚‡ã†ã€‚\nistioctl kube-inject -f samples/bookinfo/platform/kube/bookinfo.yaml \u0026gt; ./bookinfo.sidecar.yaml diff -u bookinfo.yaml bookinfo.sidecar.yaml å·®åˆ†ãŒé•·ããªã‚‹ãŸã‚ã“ã“ã§ã¯çœç•¥ã—ã¾ã™ãŒå…ƒã® bookinfo.yaml ã«ã¯è¨˜ã•ã‚Œã¦ã„ãªã‹ã£ãŸ sidecar ã®æ–‡å­—ãŒèª­ã¿å–ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚ã‚¢ãƒ—ãƒªã«éš£æ¥ã—ãŸ pods ã« Envoy ãŒèµ·å‹•ã—ã¦ã„ã‚‹ pods ãŒ Sidecar çš„ã«é…ç½®ã•ã‚Œä¸‹è¨˜ã®ã‚ˆã†ãªæ§‹æˆã«ãªã‚Šã¾ã—ãŸã€‚\ningress \u0026#34;python\u0026#34; \u0026#34;java\u0026#34; \u0026#34;nodejs\u0026#34; +-----------+ +-------------+ +-------------+ +-------------+ | +-------+ | | +-------+ | | +-------+ | | +-------+ | request -\u0026gt; | | envoy | | -\u0026gt; | | envoy | | -\u0026gt; | | envoy | | -\u0026gt; | | envoy | | | +-------+ | | +-------+ | | +-------+ | | +-------+ | +-----------+ | productpage | | review-v1 | | ratings | +-------------+ +-------------+ +-------------+ +-------------+ | +-------+ | | | envoy | | | +-------+ | | review-v2 | +-------------+ +-------------+ | +-------+ | | | envoy | | | +-------+ | | review-v3 | +-------------+ +-------------+ | +-------+ | | | envoy | | | +-------+ | | details | +-------------+ ruby å‚è€ƒ URL https://istio.io/docs/setup/kubernetes/quick-start/ https://istio.io/docs/examples/bookinfo/ https://istio.io/docs/setup/kubernetes/helm-install/ ","permalink":"https://jedipunkz.github.io/post/2018/12/31/istio/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€è¿‘ã¯ kubernetes ã‚’è§¦ã£ã¦ãªã‹ã£ãŸã®ã§ã™ãŒ Istio ã‚„ Envoy ç­‰ CNCF é–¢é€£ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®è¨˜äº‹ã‚’ã‚ˆãè¦‹ã‹ã‘ã‚‹ã‚ˆã†ã«ãªã£ã¦ã€å°‘ã—ç†è§£ã—ã¦ãŠã„ãŸã»ã†ãŒã„ã„ã‹ãªã¨æ€ã„ Istio ã¨ Minikube ã‚’ä½¿ã£ã¦ Getting Started çš„ãªäº‹ã‚’ã‚„ã£ã¦ã¿ã¾ã—ãŸã€‚Istio ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ä¸­ã«ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå…¥ã£ã¦ã„ã‚‹ã®ã§ãã‚Œã‚’åˆ©ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã‚’è¡Œã£ã¦ã¿ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eIstio ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ãŠæ‰‹è»½ã« Istio ç’°å¢ƒã‚’ä½œã‚‹ãŸã‚ã® yaml ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã€ãã‚Œã‚’ kubectl apply ã™ã‚‹ã“ã¨ã§ Istio ç’°å¢ƒã‚’æ•´ãˆã‚‰ã‚Œã‚‹ã®ã§ã™ãŒã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã‚’æƒ³å®šã—ãŸå ´åˆã¯ Helm Template ã‚’ç”¨ã„ãŸæ–¹ãŒã„ã„ã ã‚ã†ã€ã¨è¨˜è¼‰ã‚ã£ãŸã®ã§ä»Šå›ã¯ Helm Template ã‚’ç”¨ã„ã¦ Istio ç’°å¢ƒã‚’ä½œã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æã®ç’°å¢ƒ\"\u003eå‰æã®ç’°å¢ƒ\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003emacos Mojave\u003c/li\u003e\n\u003cli\u003eminikube v0.32.0\u003c/li\u003e\n\u003cli\u003ekubectl v1.10.3\u003c/li\u003e\n\u003cli\u003ehelm v2.12.1\u003c/li\u003e\n\u003cli\u003evirtualbox\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"æº–å‚™\"\u003eæº–å‚™\u003c/h2\u003e\n\u003ch3 id=\"kubectl-ã¨-helm-ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003ekubectl ã¨ helm ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h3\u003e\n\u003cp\u003ekubctl ã¨ helm ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ä¸¡è€…å…±ã« homebrew ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebrew install kubernetes-cli\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebrew install kubernetes-helm\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"minikube-ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨èµ·å‹•\"\u003eminikube ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨èµ·å‹•\u003c/h3\u003e\n\u003cp\u003eminikube ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦èµ·å‹•ã—ã¾ã™ã€‚\u003c/p\u003e","title":"Istio, Helm ã‚’ä½¿ã£ã¦ Getting Started çš„ãªã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»¥å‰ã€\u0026ldquo;Test-Kitchen, Docker ã§ Ansible Role é–‹ç™ºã‚µã‚¤ã‚¯ãƒ«é«˜é€ŸåŒ–ï¼\u0026rdquo; ã£ã¦ã‚¿ã‚¤ãƒˆãƒ«ã§ Ansible Role ã®é–‹ç™ºã‚’ test-kitchen ã‚’ä½¿ã£ã¦è¡Œã†æ–¹æ³•ã«ã¤ã„ã¦è¨˜äº‹ã«ã—ãŸã®ã§ã™ãŒã€ã‚„ã£ã±ã‚Šãƒ­ãƒ¼ã‚«ãƒ«ã§ Docker ã‚³ãƒ³ãƒ†ãƒŠç«‹ã¡ä¸Šã’ã¦ãƒ‡ãƒ—ãƒ­ã—ã¦ãƒ†ã‚¹ãƒˆã—ã¦.. ã£ã¦ã™ã”ãæ¥½ã¨ã„ã†ã‹é€Ÿãã¦ä»Šã®ç¾å ´ã§ã‚‚ä¾¿åˆ©ã«ã¤ã‹ã£ã¦ã„ã¾ã™ã€‚å‰ã®è¨˜äº‹ã® URL ã¯ä¸‹è¨˜ã§ã™ã€‚\nhttps://jedipunkz.github.io/blog/2016/07/14/test-kitchen-with-ansible/\næœ€è¿‘ï¼Ÿã¯ ansible container ã£ã¦æŠ€è¡“ã‚‚ã‚ã‚‹ã‘ã©ã€åƒ•ã‚‰ãŒ Docker ä½¿ã†ç›®çš„ã¯ã‚³ãƒ³ãƒ†ãƒŠã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã§ã¯ãªãã¦å˜ã« Ansible ã‚’å®Ÿè¡Œã™ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒãŒæ¬²ã—ã„ã£ã¦ã“ã¨ã¨ã‹ã€Serverspec ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ãƒ»å®Ÿæ©Ÿã«å®Ÿè¡Œã™ã‚‹ç’°å¢ƒãŒæ¬²ã—ã„ã£ã¦ã“ã¨ãªã®ã§ã€ä»Šã§ã‚‚ test-kitchen ä½¿ã£ã¦ã„ã¾ã™ã€‚\nã§ã€æœ€è¿‘ã«ãªã£ã¦è¤‡æ•°ãƒãƒ¼ãƒ‰ã®æ§‹æˆã® Ansible Role ã‚’ test-kitchen, Docker ã‚’ä½¿ã£ã¦é–‹ç™ºã§ãã‚‹ã“ã¨ã«æ°—ãŒã¤ã„ãŸã®ã§è¨˜äº‹ã«ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚ã“ã‚ŒãŒã§ãã‚‹ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã§ Redis Master + Redis Slave(s) + Sentinel ã£ã¦ç’°å¢ƒã‚‚å®¹æ˜“ã«ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\nä½¿ã†ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ å‰æã¯ macOS ã§ã™ãŒ Linux ãƒã‚·ãƒ³ã§ã‚‚å•é¡Œãªãå‹•ä½œã™ã‚‹ã¯ãšã§ã™ã€‚\nã»ã¼å‰å›ã¨åŒã˜ã§ã™ã€‚\nAnsible Docker test-kitchen kitchen-docker (test-kitchen ãƒ‰ãƒ©ã‚¤ãƒ) kitchen-ansible (test-kitchen ãƒ‰ãƒ©ã‚¤ãƒ) Serverspec ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã«ã¤ã„ã¦ã¯å‰å›ã®è¨˜äº‹ã‚’è¦‹ã¦ã‚‚ã‚‰ã†ã“ã¨ã¨ã—ã¦å‰²æ„›ã—ã¾ã™ã€‚\ntest-kitchen ã®ç’°å¢ƒã‚’ä½œã‚‹ test-kitchen ã®ç’°å¢ƒã‚’ä½œã‚Šã¾ã™ã€‚\u0026lsquo;kitchen init\u0026rsquo; ã‚’å®Ÿè¡Œã—ã¦åŸºæœ¬çš„ã«ã¯ç”Ÿæˆã•ã‚ŒãŸ .kitchen.yml ã‚’å¼„ã‚‹ã‚“ã˜ã‚ƒãªãã¦ .kitchen.local.yml ã‚’ä¿®æ­£ã—ã¦ã„ãã¾ã™ã€‚ã“ã¡ã‚‰ã®è¨˜è¿°ãŒå¿…ãšä¸Šæ›¸ãã•ã‚Œã¦å„ªå…ˆã•ã‚Œã¾ã™ã€‚\n.kitchen.local.yml ã®ä¾‹ã‚’ä¸‹è¨˜ã«è¨˜ã—ã¾ã™ã€‚\n--- driver: name: docker binary: /usr/local/bin/docker socker: unix:///var/run/docker.sock use_sudo: false provisioner: name: ansible_playbook roles_path: ../../roles group_vars_path: ../../group_vars/local/ hosts: kitchen-deploy require_ansible_omnibus: false ansible_platform: centos require_chef_for_busser: true platforms: - name: centos driver_config: image: centos:7.2.1511 # (ä¾‹) platform: centos require_chef_omnibus: false privileged: true # systemd ä½¿ã†ã¨ãã®ä¾‹ run_command: /sbin/init; sleep 3 # åŒä¸Š suites: - name: master provisioner: name: ansible_playbook playbook: ./site_master.yml driver_config: run_options: --net=kitchen --ip=172.18.0.11 - name: slave provisioner: name: ansible_playbook playbook: ./site_slave.yml driver_config: run_options: --net=kitchen --ip=172.18.0.12 å„ãƒ‘ãƒ©ãƒ¼ãƒ¡ã‚¿ã®è©³ç´°ã«ã¤ã„ã¦ã¯ kitchen-ansibke, kitchen-docker ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã¦ã„ãŸã ãã¨ã—ã¦\u0026hellip;\nhttps://github.com/neillturner/kitchen-ansible/blob/master/provisioner_options.md https://github.com/test-kitchen/kitchen-docker ç‰¹å¾´ã¨ã—ã¦ã¯ suites: ã®é …ç›®ã§ mater, slave ã¨ã—ã¦ Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’2ã¤æ‰±ã†ã“ã¨ã‚’å®£è¨€ã—ã¦ã„ã‚‹éƒ¨åˆ†ã§ã™ã€‚\nname: master ã§ site_master.yml ã¨ã„ã† Playbook ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’å®£è¨€ name: master ã§ 172.18.0.11 ã¨ã„ã† IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ã†ã“ã¨ã‚’å®£è¨€ name: slave ã§ site_slave.yml ã¨ã„ã† Playbook ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’å®£è¨€ name: slave ã§ 172.18.0.12 ã¨ã„ã† IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ã†ã“ã¨ã‚’å®£è¨€ å‹¿è«–ã€åŒæ§˜ã®è¨˜è¿°ã§ 3, 4.. å€‹ç›®ã®ã‚³ãƒ³ãƒ†ãƒŠç’°å¢ƒã‚’ä½œã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚\nã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚ã“ã“ã§ \u0026ldquo;å›ºå®š IP ã‚¢ãƒ‰ãƒ¬ã‚¹\u0026rdquo; ã‚’ä½¿ã†ã‚ˆã†å®£è¨€ã—ãŸã“ã¨ã¯ã¨ã¦ã‚‚é‡è¦ã§ã€ä¾‹ãˆã° NSD ã®ã‚¯ãƒ©ã‚¹ã‚¿æ§‹æˆã‚’ä½œã‚ŠãŸã„æ™‚ã€ãŠäº’ã„ã®ã‚³ãƒ³ãƒ†ãƒŠåŒå£«ãŒç›¸æ‰‹ã®ã‚³ãƒ³ãƒ†ãƒŠã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’çŸ¥ã‚Šåˆã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nNSD Master ã¯ Slave ã¸ Xfer ã™ã‚‹ãŸã‚ Slave ã‚³ãƒ³ãƒ†ãƒŠã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’çŸ¥ã‚‹å¿…è¦ã‚ã‚Š NSD Slave ã¯ Master ã‹ã‚‰ã®ã¿ Xfer å—ä¿¡ã™ã‚‹è¨­å®šãŒå¿…è¦ãªã®ã§ Master IP ã‚’çŸ¥ã‚‹å¿…è¦ã‚ã‚Š ã£ã¦æ„Ÿã˜ã§ã™ã€‚RabbitMQ ã‚„ Redis, Consul ãªã©ã®ã‚¯ãƒ©ã‚¹ã‚¿ã®éš›ã«ã‚‚åŒæ§˜ã«äº’ã„ãƒ»ã‚‚ã—ãã¯ä¸€æ–¹ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’çŸ¥ã‚‹å¿…è¦ãŒå‡ºã¦ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚\nã§ã€å›ºå®š IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãªã®ã§ã™ãŒ Docker ã§ã¯å‹•çš„ IP ãŒåŸºæœ¬ãªã®ã§ã€å›ºå®š IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç”¨ã„ã‚‹ãŸã‚ã« macOS + Docker ç’°å¢ƒã®ä¸­ã«ä¸€ã¤ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¸‹è¨˜ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§ä½œæˆã§ãã¾ã™ã€‚\ndocker network create --subnet 172.18.0.0/24 kitchen Serverspec ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ å‰å›ã®è¨˜äº‹ã§ã‚‚æ›¸ã„ãŸã‚ˆã†ã«ã€Ansible ã§ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸçµæœã«å¯¾ã—ã¦ Servrspec ãƒ†ã‚¹ãƒˆãŒæµã›ã¾ã™ã€‚ã§ä»Šå›ã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿æ§‹æˆã§è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’æ‰±ã†ã®ã§ãã‚Œãã‚Œã®ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦æµã™ãƒ†ã‚¹ãƒˆãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆãŒã‚ã‚Œã°ãã‚Œã‚’å®Ÿç¾ã§ãã¾ã™ã€‚\n. â”œâ”€â”€ README.md â”œâ”€â”€ chefignore â”œâ”€â”€ site_master.yml â”œâ”€â”€ site_slave.yml â””â”€â”€ test â””â”€â”€ integration â”œâ”€â”€ master â”‚Â â””â”€â”€ serverspec â”‚Â â””â”€â”€ nsd_master_spec.rb â””â”€â”€ slave â””â”€â”€ serverspec â””â”€â”€ nsd_slave_spec.rb ãã—ã¦ ä¸Šè¨˜ã® nsd_master_spec,rb, nsd_slave_spec.rb ã®è¨˜è¿°ã®ä»•æ–¹ã§ã™ãŒä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\nrequire \u0026#39;serverspec\u0026#39; # Required by serverspec set :backend, :exec describe package(\u0026#39;nsd\u0026#39;) do it { should be_installed } end describe process(\u0026#39;nsd\u0026#39;) do it { should be_running } end ...\u0026lt;çœç•¥\u0026gt;... ã‚³ãƒ³ãƒ†ãƒŠãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³• ã“ã“ã¾ã§ã§ç’°å¢ƒãŒæ•´ã£ãŸã¨æ€ã†ã®ã§ (å®Ÿéš›ã«ã¯ site_master.yml ç­‰ã® Playbook ã‚‚ã—ãã¯ Ansible Role ã®æŒ‡å®šãŒå¿…è¦) ã€ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦ Ansible ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ãƒ»Serverspec ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã™ã‚‹æ–¹æ³•ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚\nkitchen create # 2 ã‚³ãƒ³ãƒ†ãƒŠä½œã‚‰ã‚Œã¾ã™ kitchen converge # 2 ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦ Ansible ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™ kitchen verify # 2 ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦ Serverspec ãƒ†ã‚¹ãƒˆã•ã‚Œã¾ã™ kitchen test # destroy, create, converge, veriy, destroy ãŒä¸€æ–‰å®Ÿè¡Œã•ã‚Œã¾ã™ å„ã‚³ãƒ³ãƒ†ãƒŠæ¯ã«æ“ä½œã™ã‚‹å ´åˆ\nkitchen create master-centos # or slave-centos kitchen converge master-centos # or slave-centos kitchen verify master-centos # or slave-centos kitchen destroy master-centos # or slave-centos ã¾ã¨ã‚ ãƒ­ãƒ¼ã‚«ãƒ«ã® Docker ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ†ã‚¹ãƒˆã§ãã‚‹ã®ã§ã¨ã¦ã‚‚æ‰‹è»½ã«ã€å°šä¸”ã¤é«˜é€Ÿã« Ansible ã® Playbook ã‚„ Role ãŒé–‹ç™ºå‡ºæ¥ã‚‹ã“ã¨ã¯å‰å›ã®è¨˜äº‹ã§ã‚ã‹ã£ãŸã¨æ€ã†ã®ã§ã™ãŒã€ã‚¯ãƒ©ã‚¹ã‚¿æ§‹æˆã«ã¤ã„ã¦ã‚‚ãƒ­ãƒ¼ã‚«ãƒ«ã§é–‹ç™ºå‡ºæ¥ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚\nã¡ãªã¿ã«ç§é”ã®ç’°å¢ƒã ã¨ .kitchen.local.yml ã«ä¸‹è¨˜ã®è¨˜è¿°ã‚’ã—ã¦ã„ã‚‹ã®ã§\u0026hellip;\nroles_path: ../../roles site_master(slave).yml ã®ä¸­ã®è¨˜è¿°ã¨ã—ã¦ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚\u0026rsquo;nsd\u0026rsquo; ã£ã¦ã„ã† Role ã‚’ä½œã‚‹æƒ³å®šã§ Role æŒ‡å®šãŒã—ã¦ã‚ã£ãŸã€å°šä¸”ã¤ãƒ­ãƒ¼ã‚«ãƒ«ã§ã® Ansible Variable ã‚’ä¸Šæ›¸ã(ä¸€ç•ªå„ªå…ˆã•ã‚Œã‚‹) ã™ã‚‹ã“ã¨ã§ã€Role ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚(variable åã¯ Role ã®ä½œã‚Šæ–¹ã«ã‚ˆã‚Šã¾ã™)\n--- - hosts: kitchen-deploy sudo: yes roles: - { role: nsd, tags: nsd } vars: nsd_type: \u0026#39;master\u0026#39; nsd_master_addr: \u0026#39;172.18.0.11\u0026#39; nsd_slave_addr: \u0026#39;172.18.0.12\u0026#39; test-kitchen è‡ªä½“ã¯ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã ã„ã¶æ™‚é–“ãŒçµŒéã—ã¦ã„ã‚‹åˆ†ã€æŠ€è¡“çš„ã«æ¯ã‚Œã¦ãã¦ã„ã¦æœªã ã«ç§é”ã¯ Ansible ã®é–‹ç™ºã«å½¹ç«‹ã¦ã¦ã„ã¾ã™ã€‚å…ƒã€…ã¯ Chef å‘ã‘ã®æŠ€è¡“ã§ã¯ã‚ã‚‹ã®ã ã‘ã©ãã“ã¯ä»Šå›ç´¹ä»‹ã—ãŸ .kitchen.local.yml ã®æ›¸ãæ–¹ã§å›é¿ã§ãã‚‹ã—ã€Serverspec ã®ãƒ†ã‚¹ãƒˆã‚‚æµã›ã‚‹ã—..ã€‚\nã¾ãŸãƒ­ãƒ¼ã‚«ãƒ«(ãƒ›ã‚¹ãƒˆã® macOS) ã¸ã®ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ç­‰ã‚‚ã‚³ãƒ³ãƒ†ãƒŠæ¯ã«è¨˜ã›ã¾ã™ã®ã§ãã®è¾ºã‚Šã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚\næœ€çµ‚çš„ã«ã¯ã“ã“ã§æ›¸ã„ãŸ Serverspec ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ©Ÿã¸æµã›ã‚Œã°æ–‡å¥ãªã—ã ã¨æ€ã„ã¾ã™ã€‚æ–¹æ³•ã¯ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸæ°—ãŒã¤ã„ãŸã‚‰ç´¹ä»‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/test-kitchen-cluster/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥å‰ã€\u0026ldquo;Test-Kitchen, Docker ã§ Ansible Role é–‹ç™ºã‚µã‚¤ã‚¯ãƒ«é«˜é€ŸåŒ–ï¼\u0026rdquo; ã£ã¦ã‚¿ã‚¤ãƒˆãƒ«ã§ Ansible Role ã®é–‹ç™ºã‚’ test-kitchen ã‚’ä½¿ã£ã¦è¡Œã†æ–¹æ³•ã«ã¤ã„ã¦è¨˜äº‹ã«ã—ãŸã®ã§ã™ãŒã€ã‚„ã£ã±ã‚Šãƒ­ãƒ¼ã‚«ãƒ«ã§ Docker ã‚³ãƒ³ãƒ†ãƒŠç«‹ã¡ä¸Šã’ã¦ãƒ‡ãƒ—ãƒ­ã—ã¦ãƒ†ã‚¹ãƒˆã—ã¦.. ã£ã¦ã™ã”ãæ¥½ã¨ã„ã†ã‹é€Ÿãã¦ä»Šã®ç¾å ´ã§ã‚‚ä¾¿åˆ©ã«ã¤ã‹ã£ã¦ã„ã¾ã™ã€‚å‰ã®è¨˜äº‹ã® URL ã¯ä¸‹è¨˜ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://jedipunkz.github.io/blog/2016/07/14/test-kitchen-with-ansible/\"\u003ehttps://jedipunkz.github.io/blog/2016/07/14/test-kitchen-with-ansible/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eæœ€è¿‘ï¼Ÿã¯ ansible container ã£ã¦æŠ€è¡“ã‚‚ã‚ã‚‹ã‘ã©ã€åƒ•ã‚‰ãŒ Docker ä½¿ã†ç›®çš„ã¯ã‚³ãƒ³ãƒ†ãƒŠã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã§ã¯ãªãã¦å˜ã« Ansible ã‚’å®Ÿè¡Œã™ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒãŒæ¬²ã—ã„ã£ã¦ã“ã¨ã¨ã‹ã€Serverspec ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ãƒ»å®Ÿæ©Ÿã«å®Ÿè¡Œã™ã‚‹ç’°å¢ƒãŒæ¬²ã—ã„ã£ã¦ã“ã¨ãªã®ã§ã€ä»Šã§ã‚‚ test-kitchen ä½¿ã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã§ã€æœ€è¿‘ã«ãªã£ã¦è¤‡æ•°ãƒãƒ¼ãƒ‰ã®æ§‹æˆã® Ansible Role ã‚’ test-kitchen, Docker ã‚’ä½¿ã£ã¦é–‹ç™ºã§ãã‚‹ã“ã¨ã«æ°—ãŒã¤ã„ãŸã®ã§è¨˜äº‹ã«ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚ã“ã‚ŒãŒã§ãã‚‹ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã§ Redis Master + Redis Slave(s) + Sentinel ã£ã¦ç’°å¢ƒã‚‚å®¹æ˜“ã«ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä½¿ã†ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢\"\u003eä½¿ã†ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢\u003c/h2\u003e\n\u003cp\u003eå‰æã¯ macOS ã§ã™ãŒ Linux ãƒã‚·ãƒ³ã§ã‚‚å•é¡Œãªãå‹•ä½œã™ã‚‹ã¯ãšã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã»ã¼å‰å›ã¨åŒã˜ã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAnsible\u003c/li\u003e\n\u003cli\u003eDocker\u003c/li\u003e\n\u003cli\u003etest-kitchen\u003c/li\u003e\n\u003cli\u003ekitchen-docker (test-kitchen ãƒ‰ãƒ©ã‚¤ãƒ)\u003c/li\u003e\n\u003cli\u003ekitchen-ansible (test-kitchen ãƒ‰ãƒ©ã‚¤ãƒ)\u003c/li\u003e\n\u003cli\u003eServerspec\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003eã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003eã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã«ã¤ã„ã¦ã¯å‰å›ã®è¨˜äº‹ã‚’è¦‹ã¦ã‚‚ã‚‰ã†ã“ã¨ã¨ã—ã¦å‰²æ„›ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"test-kitchen-ã®ç’°å¢ƒã‚’ä½œã‚‹\"\u003etest-kitchen ã®ç’°å¢ƒã‚’ä½œã‚‹\u003c/h2\u003e\n\u003cp\u003etest-kitchen ã®ç’°å¢ƒã‚’ä½œã‚Šã¾ã™ã€‚\u0026lsquo;kitchen init\u0026rsquo; ã‚’å®Ÿè¡Œã—ã¦åŸºæœ¬çš„ã«ã¯ç”Ÿæˆã•ã‚ŒãŸ .kitchen.yml ã‚’å¼„ã‚‹ã‚“ã˜ã‚ƒãªãã¦ .kitchen.local.yml ã‚’ä¿®æ­£ã—ã¦ã„ãã¾ã™ã€‚ã“ã¡ã‚‰ã®è¨˜è¿°ãŒå¿…ãšä¸Šæ›¸ãã•ã‚Œã¦å„ªå…ˆã•ã‚Œã¾ã™ã€‚\u003c/p\u003e","title":"Docker,Test-Kitchen,Ansible ã§ã‚¯ãƒ©ã‚¹ã‚¿ã‚’æ§‹æˆã™ã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nå°‘ã—å‰ã¾ã§ Google Cloud Platform (GCP) ã‚’ä½¿ã£ã¦ã„ãŸã®ã§ã™ãŒã€ä»Šå›ã¯ãã®æ™‚ã«å¾—ãŸãƒã‚¦ãƒã‚¦ã‚’è¨˜äº‹ã«ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\nGoogle Container Engine (GKE) ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’çµ„ã¿åˆã‚ã›ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã¦ã„ã¾ã—ãŸã€‚æ‰‹å‹•ã§ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã‹ã‚‰ãƒãƒãƒãƒã—ã¦æ§‹ç¯‰ã™ã‚‹ã¨äººçš„ãƒŸã‚¹ã‚„æƒ…å ±å…±æœ‰ã¨ã„ã†è¦³ç‚¹ã§ãƒã‚ºã‚¤ã¨æ€ã£ãŸã®ã§ Terraform ã‚’ä½¿ã£ã¦ GCP ã®å„ãƒªã‚½ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹ã‚ˆã†ä»•æ›ã‘ãŸã®ã§ã™ãŒã€ã¾ã ã¾ã  Terraform ã‚’ä½¿ã£ã¦ GCP ã‚¤ãƒ³ãƒ•ãƒ©ã‚’æ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹æ–¹ãŒå°‘ãªã„ãŸã‚æƒ…å ±ãŒç„¡ãæƒ…å ±åé›†ã‚„æ¤œè¨¼ã«æ™‚é–“ãŒæ›ã‹ã‚Šã¾ã—ãŸã€‚ã‚ˆã£ã¦ä»Šå›ã¯ã¾ã ãƒãƒƒãƒˆä¸Šã«æƒ…å ±ãŒå°‘ãªã„ GKE ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã®æ§‹ç¯‰ã‚’ Terraform ã‚’ä½¿ã£ã¦è¡Œã†æ–¹æ³•ã‚’å…±æœ‰ã—ã¾ã™ã€‚\næ§‹ç¯‰ã®ã‚·ãƒŠãƒªã‚ª æ§‹ç¯‰ã™ã‚‹ã«ã‚ãŸã£ã¦2ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ§‹ç¯‰ã®æµã‚ŒãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚\nGKE ã‚¯ãƒ©ã‚¹ã‚¿ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’åŒæ™‚ã«æ§‹ç¯‰ã™ã‚‹ GKE ã‚¯ãƒ©ã‚¹ã‚¿ã‚’äºˆã‚æ§‹ç¯‰ã—ãã®ã‚¯ãƒ©ã‚¹ã‚¿å‘ã‘ã«ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’æ§‹ç¯‰ã™ã‚‹ ä¸¡æ–¹ã®æ–¹æ³•ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\nGKE ã‚¯ãƒ©ã‚¹ã‚¿ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’åŒæ™‚ã«æ§‹ç¯‰ã™ã‚‹ GKE ã‚¯ãƒ©ã‚¹ã‚¿ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’åŒæ™‚ã«ä½œã‚‹æ–¹æ³•ã§ã™ã€‚\næ—©é€Ÿã§ã™ãŒä¸‹è¨˜ã« terraform ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨˜ã—ã¾ã—ãŸã€‚ãã‚Œãã‚Œã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã®æ„å‘³ã«ã¤ã„ã¦ã¯ Terraform ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”è¦§ã«ãªã£ã¦ãã ã•ã„ã€‚\nå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ : https://www.terraform.io/docs/providers/google/\nã“ã“ã§ç‰¹ç­†ã™ã¹ãç‚¹ã¨ã—ã¦ã¯ä¸‹è¨˜ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚\nãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã«ç´ä»˜ã‘ã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® ID å–å¾—ã®ãŸã‚ \u0026ldquo;${replace(element\u0026hellip;\u0026rdquo; çš„ãªã“ã¨ã‚’ã—ã¦ã„ã‚‹ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã«å¯¾ã—ã¦ GKE ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ä½œæˆã—ãŸéš›ã«è‡ªå‹•ã§ä½œæˆã•ã‚Œã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã® URI ã‚’ç´ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ã¨ã—ã¦ã¯ URI ã§ã¯ãªã \u0026ldquo;ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å\u0026rdquo; ã§ã‚ã‚‹ã¨æ‰±ã„ã‚„ã™ã„ã®ã§ã™ãŒã€URI ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã“ã®æƒ…å ±ã¯ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚\nå‚è€ƒã‚µã‚¤ãƒˆ : GKEã§kubernetesã®nodesã‚’ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã—ã¦ä½¿ã„ãŸã„ã¨ã with terraform URL : http://qiita.com/techeten/items/b2ec5f11f4a70dd21d70 ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µä¸€ã¤ä½œã‚‹ãŸã‚ã« 6 å€‹ã‚‚ã®ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã£ã¦ã„ã‚‹ ä¸€ã¤ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’ä½œã‚‹ãŸã‚ã«6ã¤ã®ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ãŒå¿…è¦ã«ãªã‚‹ã¨ã„ã†ã®ã‚‚é©šãã§ã™ãŒå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€ã¨ãªã‹ãªã‹ãã®æ„Ÿè¦šãŒã¤ã‹ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚ãã‚Œãã‚Œã®ç°¡å˜ãªæ„å‘³ã‚’ä¸‹è¨˜ã«è¨˜ã—ã¦ãŠãã¾ã™ã€‚\ngoogle_compute_http_health_check : ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ google_compute_backend_service : ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ google_compute_url_map : ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µåã¨ãªã‚‹ãƒªã‚½ãƒ¼ã‚¹ google_compute_target_http_proxy : ãƒ—ãƒ­ã‚­ã‚· google_compute_global_address : ã‚°ãƒ­ãƒ¼ãƒãƒ« IP ã‚¢ãƒ‰ãƒ¬ã‚¹ google_compute_global_forwarding_rule : ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã«ã‚ˆã‚‹ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ« ãã‚Œã§ã¯å®Ÿéš›ã® Terraform ã‚³ãƒ¼ãƒ‰ã§ã™\n# å…±é€šå¤‰æ•° variable \u0026#34;credentials\u0026#34; {default = \u0026#34;/path/to/credentials.json\u0026#34;} variable \u0026#34;project\u0026#34; {default = \u0026#34;test01\u0026#34;} variable \u0026#34;region\u0026#34; {default = \u0026#34;asia-northeast\u0026#34;} variable \u0026#34;zone\u0026#34; {default = \u0026#34;asia-northeast1-b\u0026#34;} # GKE ã‚¯ãƒ©ã‚¹ã‚¿ç”¨ã®å¤‰æ•° variable \u0026#34;gke_name\u0026#34; {default = \u0026#34;gke-terraform-test\u0026#34;} variable \u0026#34;machine_type\u0026#34; {default = \u0026#34;n1-standard-1\u0026#34;} variable \u0026#34;disk_size_gb\u0026#34; {default = \u0026#34;50\u0026#34;} variable \u0026#34;node_count\u0026#34; {default = \u0026#34;2\u0026#34;} variable \u0026#34;network\u0026#34; {default = \u0026#34;default\u0026#34;} variable \u0026#34;subnetwork\u0026#34; {default = \u0026#34;default\u0026#34;} variable \u0026#34;cluster_ipv4_cidr\u0026#34; {default = \u0026#34;10.0.10.0/14\u0026#34;} variable \u0026#34;username\u0026#34; {default = \u0026#34;username\u0026#34;} variable \u0026#34;password\u0026#34; {default = \u0026#34;password\u0026#34;} # ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µç”¨ã®å¤‰æ•° variable \u0026#34;lb_name\u0026#34; {default = \u0026#34;lb-terraform-test\u0026#34;} variable \u0026#34;healthcheck_name\u0026#34; {default = \u0026#34;healthcheck-terraform-test\u0026#34;} variable \u0026#34;healthcheck_host\u0026#34; {default = \u0026#34;test.example.com\u0026#34;} variable \u0026#34;healthcheck_port\u0026#34; {default = \u0026#34;30300\u0026#34;} variable \u0026#34;backend_name\u0026#34; {default = \u0026#34;backend-terraform-test\u0026#34;} variable \u0026#34;http_proxy_name\u0026#34; {default = \u0026#34;terraform-proxy\u0026#34;} variable \u0026#34;global_address_name\u0026#34; {default = \u0026#34;terraform-global-address\u0026#34;} variable \u0026#34;global_forwarding_rule_name\u0026#34; {default = \u0026#34;terraform-global-forwarding-rule\u0026#34;} variable \u0026#34;global_forwarding_rule_port\u0026#34; {default =\u0026#34;80\u0026#34;} variable \u0026#34;port_name\u0026#34; {default = \u0026#34;port-test\u0026#34;} variable \u0026#34;enable_cdn\u0026#34; {default = false} provider \u0026#34;google\u0026#34; { credentials = \u0026#34;${file(\u0026#34;${var.credentials}\u0026#34;)}\u0026#34; project = \u0026#34;${var.project}\u0026#34; region = \u0026#34;${var.region}\u0026#34; } resource \u0026#34;google_container_cluster\u0026#34; \u0026#34;cluster-terraform\u0026#34; { name = \u0026#34;${var.gke_name}\u0026#34; zone = \u0026#34;${var.zone}\u0026#34; initial_node_count = \u0026#34;${var.node_count}\u0026#34; network = \u0026#34;${var.network}\u0026#34; subnetwork = \u0026#34;${var.subnetwork}\u0026#34; cluster_ipv4_cidr = \u0026#34;${var.cluster_ipv4_cidr}\u0026#34; master_auth { username = \u0026#34;${var.username}\u0026#34; password = \u0026#34;${var.password}\u0026#34; } node_config { machine_type = \u0026#34;${var.machine_type}\u0026#34; disk_size_gb = \u0026#34;${var.disk_size_gb}\u0026#34; oauth_scopes = [ \u0026#34;https://www.googleapis.com/auth/compute\u0026#34;, \u0026#34;https://www.googleapis.com/auth/devstorage.read_only\u0026#34;, \u0026#34;https://www.googleapis.com/auth/logging.write\u0026#34;, \u0026#34;https://www.googleapis.com/auth/monitoring\u0026#34; ] } addons_config { http_load_balancing { disabled = true } horizontal_pod_autoscaling { disabled = true } } } resource \u0026#34;google_compute_http_health_check\u0026#34; \u0026#34;healthcheck-terraform\u0026#34; { name = \u0026#34;${var.healthcheck_name}\u0026#34; project = \u0026#34;${var.project}\u0026#34; request_path = \u0026#34;/\u0026#34; host = \u0026#34;${var.healthcheck_host}\u0026#34; check_interval_sec = 5 timeout_sec = 5 port = \u0026#34;${var.healthcheck_port}\u0026#34; } resource \u0026#34;google_compute_backend_service\u0026#34; \u0026#34;backend-terraform\u0026#34; { name = \u0026#34;${var.backend_name}\u0026#34; port_name = \u0026#34;${var.port_name}\u0026#34; protocol = \u0026#34;HTTP\u0026#34; timeout_sec = 10 enable_cdn = \u0026#34;${var.enable_cdn}\u0026#34; region = \u0026#34;${var.region}\u0026#34; project = \u0026#34;${var.project}\u0026#34; backend { group = \u0026#34;${replace(element(google_container_cluster.cluster-terraform.instance_group_urls, 1), \u0026#34;Manager\u0026#34;,\u0026#34;\u0026#34;)}\u0026#34; } health_checks = [\u0026#34;${google_compute_http_health_check.healthcheck-terraform.self_link}\u0026#34;] } resource \u0026#34;google_compute_url_map\u0026#34; \u0026#34;lb-terraform\u0026#34; { name = \u0026#34;${var.lb_name}\u0026#34; default_service = \u0026#34;${google_compute_backend_service.backend-terraform.self_link}\u0026#34; project = \u0026#34;${var.project}\u0026#34; } resource \u0026#34;google_compute_target_http_proxy\u0026#34; \u0026#34;http_proxy-terraform\u0026#34; { name = \u0026#34;${var.http_proxy_name}\u0026#34; url_map = \u0026#34;${google_compute_url_map.lb-terraform.self_link}\u0026#34; } resource \u0026#34;google_compute_global_address\u0026#34; \u0026#34;ip-terraform\u0026#34; { name = \u0026#34;${var.global_address_name}\u0026#34; project = \u0026#34;${var.project}\u0026#34; } resource \u0026#34;google_compute_global_forwarding_rule\u0026#34; \u0026#34;forwarding_rule-terraform\u0026#34; { name = \u0026#34;${var.global_forwarding_rule_name}\u0026#34; target = \u0026#34;${google_compute_target_http_proxy.http_proxy-terraform.self_link}\u0026#34; ip_address = \u0026#34;${google_compute_global_address.ip-terraform.address}\u0026#34; port_range = \u0026#34;${var.global_forwarding_rule_port}\u0026#34; project = \u0026#34;${var.project}\u0026#34; } GKE ã‚¯ãƒ©ã‚¹ã‚¿ã‚’äºˆã‚æ§‹ç¯‰ã—ãã®ã‚¯ãƒ©ã‚¹ã‚¿å‘ã‘ã«ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’æ§‹ç¯‰ã™ã‚‹ æ¬¡ã« GKE ã‚¯ãƒ©ã‚¹ã‚¿ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’åˆ¥ã€…ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã§ã™ã€‚ å®Ÿéš›ã«ã¯ GKE ã‚¯ãƒ©ã‚¹ã‚¿ã®ä¸Šã«ã¯å¤šæ•°ã®ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã•ã‚Œã‚‹ã®ã§ã™ã§ã«ã‚¯ãƒ©ã‚¹ã‚¿ãŒå­˜åœ¨ã™ã‚‹çŠ¶æ…‹ã§ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’åˆ¥ã‚µãƒ¼ãƒ“ã‚¹ã®ãŸã‚ã«ä½œæˆã—ãŸã„ã¨ã„ã†ã‚±ãƒ¼ã‚¹ãŒä¸€èˆ¬çš„ãªã‚ˆã†ã«æ€ã„ã¾ã™ã€‚\nGKE ã‚¯ãƒ©ã‚¹ã‚¿ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚°ãƒ«ãƒ¼ãƒ— URI ã‚’å–å¾—ã—è¨­å®š æ—¢å­˜ GKE ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ç”¨ã„ã‚‹å ´åˆã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚°ãƒ«ãƒ¼ãƒ— URI ãŒã„ãšã‚Œã«ã›ã‚ˆå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚°ãƒ«ãƒ¼ãƒ— URI ã‚’å–å¾—ã™ã‚‹ã«ã¯ gcloud CLI ã‚’ä½¿ã£ã¦ä¸‹è¨˜ã®ã‚ˆã†ã«çŸ¥ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\n$ gcloud compute instance-groups managed describe | grep -rin URI ã“ã“ã§å¾—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚°ãƒ«ãƒ¼ãƒ— URI ã¯ä¸‹è¨˜ã®ã‚ˆã†ã« variable \u0026ldquo;backend_group\u0026rdquo; ã«è¨˜ã—ã¾ã™ã€‚\nPort ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’æ‰‹å‹•ã§è¨­å®š ã“ã“ã¯æ®‹å¿µãªã®ã§ã™ãŒ 2017/04 ç¾åœ¨ã€Port ãƒãƒƒãƒ”ãƒ³ã‚°ã®è¨­å®šã‚’ WebUI ä¸Šã‹ã‚‰è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚UI ã‹ã‚‰ GKE ã‚¯ãƒ©ã‚¹ã‚¿ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸æŠã—ã€Port ãƒãƒƒãƒ”ãƒ³ã‚°ã®è¨­å®šã‚’è¡Œã„åå‰ã‚’è¨˜ã—ã¾ã™ã€‚ã“ã“ã§ã¯ \u0026ldquo;port-test\u0026rdquo; ã¨ã—ã¦ä½œæˆã—ãŸã¨ã—èª¬æ˜ã—ã¾ã™ã€‚\nTerraform ã®ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿° ã“ã“ã§ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µå˜ç‹¬ã§æ§‹ç¯‰ã™ã‚‹éš›ã® Terraform ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚\nvariable \u0026#34;credentials\u0026#34; {default = \u0026#34;/path/to/credentials.json\u0026#34;} variable \u0026#34;project\u0026#34; {default = \u0026#34;test01\u0026#34;} variable \u0026#34;region\u0026#34; {default = \u0026#34;asia-northeast1\u0026#34;} variable \u0026#34;lb_name\u0026#34; {default = \u0026#34;lb-terraform-test\u0026#34;} variable \u0026#34;healthcheck_name\u0026#34; {default = \u0026#34;healthcheck-terraform-test\u0026#34;} variable \u0026#34;healthcheck_host\u0026#34; {default = \u0026#34;test.example.com\u0026#34;} variable \u0026#34;healthcheck_port\u0026#34; {default = \u0026#34;30300\u0026#34;} variable \u0026#34;backend_name\u0026#34; {default = \u0026#34;backend-terraform-test\u0026#34;} variable \u0026#34;backend_group\u0026#34; {default = \u0026#34;https://www.googleapis.com/compute/v1/projects/test01/zones/asia-northeast1-b/instanceGroups/gke-gke-terraform-test-default-pool-c001020e-grp\u0026#34;} variable \u0026#34;http_proxy_name\u0026#34; {default = \u0026#34;terraform-proxy\u0026#34;} variable \u0026#34;global_address_name\u0026#34; {default = \u0026#34;terraform-global-address\u0026#34;} variable \u0026#34;global_forwarding_rule_name\u0026#34; {default = \u0026#34;terraform-global-forwarding-rule\u0026#34;} variable \u0026#34;global_forwarding_rule_port\u0026#34; {default =\u0026#34;80\u0026#34;} variable \u0026#34;port_name\u0026#34; {default = \u0026#34;port-test\u0026#34;} variable \u0026#34;enable_cdn\u0026#34; {default = false} provider \u0026#34;google\u0026#34; { credentials = \u0026#34;${file(\u0026#34;${var.credentials}\u0026#34;)}\u0026#34; project = \u0026#34;${var.project}\u0026#34; region = \u0026#34;${var.region}\u0026#34; } resource \u0026#34;google_compute_http_health_check\u0026#34; \u0026#34;healthcheck-terraform-test\u0026#34; { name = \u0026#34;${var.healthcheck_name}\u0026#34; project = \u0026#34;${var.project}\u0026#34; request_path = \u0026#34;/\u0026#34; host = \u0026#34;${var.healthcheck_host}\u0026#34; check_interval_sec = 5 timeout_sec = 5 port = \u0026#34;${var.healthcheck_port}\u0026#34; } resource \u0026#34;google_compute_backend_service\u0026#34; \u0026#34;backend-terraform-test\u0026#34; { name = \u0026#34;${var.backend_name}\u0026#34; port_name = \u0026#34;${var.port_name}\u0026#34; protocol = \u0026#34;HTTP\u0026#34; timeout_sec = 10 enable_cdn = \u0026#34;${var.enable_cdn}\u0026#34; region = \u0026#34;${var.region}\u0026#34; project = \u0026#34;${var.project}\u0026#34; backend { group = \u0026#34;${var.backend_group}\u0026#34; } health_checks = [\u0026#34;${google_compute_http_health_check.healthcheck-terraform-test.self_link}\u0026#34;] } resource \u0026#34;google_compute_url_map\u0026#34; \u0026#34;lb-terraform-test\u0026#34; { name = \u0026#34;${var.lb_name}\u0026#34; default_service = \u0026#34;${google_compute_backend_service.backend-terraform-test.self_link}\u0026#34; project = \u0026#34;${var.project}\u0026#34; } resource \u0026#34;google_compute_target_http_proxy\u0026#34; \u0026#34;http_proxy-terraform-test\u0026#34; { name = \u0026#34;${var.http_proxy_name}\u0026#34; url_map = \u0026#34;${google_compute_url_map.lb-terraform-test.self_link}\u0026#34; } resource \u0026#34;google_compute_global_address\u0026#34; \u0026#34;ip-terraform-test\u0026#34; { name = \u0026#34;${var.global_address_name}\u0026#34; project = \u0026#34;${var.project}\u0026#34; } resource \u0026#34;google_compute_global_forwarding_rule\u0026#34; \u0026#34;forwarding_rule-terraform-test\u0026#34; { name = \u0026#34;${var.global_forwarding_rule_name}\u0026#34; target = \u0026#34;${google_compute_target_http_proxy.http_proxy-terraform-test.self_link}\u0026#34; ip_address = \u0026#34;${google_compute_global_address.ip-terraform-test.address}\u0026#34; port_range = \u0026#34;${var.global_forwarding_rule_port}\u0026#34; project = \u0026#34;${var.project}\u0026#34; ã¾ã¨ã‚ GCP ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãŒç‰¹å¾´çš„ãªæ§‹ç¯‰æ–¹æ³•ãŒå¿…è¦ã«ãªã‚‹ã“ã¨ãŒåˆ†ã‹ã£ãŸã¨æ€ã„ã¾ã™ã€‚å°†æ¥çš„ã« URI ã§è¨˜ã™ç®‡æ‰€ã‚’åå‰ã§è¨˜ã›ã‚Œã°æ§‹ç¯‰ãŒã‚‚ã£ã¨ç°¡å˜ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã®ã§ GCP å´ã® API ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã‚’æœŸå¾…ã—ã¾ã™ã€‚ã¾ãŸä»Šå›ã¯è¨˜ã—ã¾ã›ã‚“ã§ã—ãŸãŒ SSL (HTTPS) è¨¼æ˜æ›¸ã‚’ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã«ç´ä»˜ã‘ã‚‹ã“ã¨ã‚‚ Terraform ã‚’ä½¿ãˆã°å®¹æ˜“ã«å‡ºæ¥ã¾ã™ã€‚è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ä¸€æ—¦ Terraform åŒ–ã™ã‚Œã°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã§å„ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãŒä¸€ç™ºã§æ§‹ç¯‰ã§ãã‚‹ã®ã§è‡ªå‹•åŒ–ã¯æ˜¯éã—ã¦ãŠããŸã„ã¨ã“ã‚ã§ã™ã€‚ç§ã¯ä»¥å‰ã€ã“ã®æ§‹ç¯‰ã‚’ Terraform + Hubot ã«ã‚ˆã‚Š ChatOps åŒ–ã—ã¦ã„ã¾ã—ãŸã€‚ä½œæ¥­ã®è¦‹ãˆã‚‹åŒ–ã¨ã€ãƒ¡ãƒ³ãƒé–“ã®ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå¯èƒ½ã«ãªã‚‹ã‹ã‚‰ã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/gke-lb/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå°‘ã—å‰ã¾ã§ Google Cloud Platform (GCP) ã‚’ä½¿ã£ã¦ã„ãŸã®ã§ã™ãŒã€ä»Šå›ã¯ãã®æ™‚ã«å¾—ãŸãƒã‚¦ãƒã‚¦ã‚’è¨˜äº‹ã«ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eGoogle Container Engine (GKE) ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’çµ„ã¿åˆã‚ã›ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã¦ã„ã¾ã—ãŸã€‚æ‰‹å‹•ã§ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã‹ã‚‰ãƒãƒãƒãƒã—ã¦æ§‹ç¯‰ã™ã‚‹ã¨äººçš„ãƒŸã‚¹ã‚„æƒ…å ±å…±æœ‰ã¨ã„ã†è¦³ç‚¹ã§ãƒã‚ºã‚¤ã¨æ€ã£ãŸã®ã§ Terraform ã‚’ä½¿ã£ã¦ GCP ã®å„ãƒªã‚½ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹ã‚ˆã†ä»•æ›ã‘ãŸã®ã§ã™ãŒã€ã¾ã ã¾ã  Terraform ã‚’ä½¿ã£ã¦ GCP ã‚¤ãƒ³ãƒ•ãƒ©ã‚’æ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹æ–¹ãŒå°‘ãªã„ãŸã‚æƒ…å ±ãŒç„¡ãæƒ…å ±åé›†ã‚„æ¤œè¨¼ã«æ™‚é–“ãŒæ›ã‹ã‚Šã¾ã—ãŸã€‚ã‚ˆã£ã¦ä»Šå›ã¯ã¾ã ãƒãƒƒãƒˆä¸Šã«æƒ…å ±ãŒå°‘ãªã„ GKE ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã®æ§‹ç¯‰ã‚’ Terraform ã‚’ä½¿ã£ã¦è¡Œã†æ–¹æ³•ã‚’å…±æœ‰ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹ç¯‰ã®ã‚·ãƒŠãƒªã‚ª\"\u003eæ§‹ç¯‰ã®ã‚·ãƒŠãƒªã‚ª\u003c/h2\u003e\n\u003cp\u003eæ§‹ç¯‰ã™ã‚‹ã«ã‚ãŸã£ã¦2ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ§‹ç¯‰ã®æµã‚ŒãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003col\u003e\n\u003cli\u003eGKE ã‚¯ãƒ©ã‚¹ã‚¿ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’åŒæ™‚ã«æ§‹ç¯‰ã™ã‚‹\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eGKE ã‚¯ãƒ©ã‚¹ã‚¿ã‚’äºˆã‚æ§‹ç¯‰ã—ãã®ã‚¯ãƒ©ã‚¹ã‚¿å‘ã‘ã«ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’æ§‹ç¯‰ã™ã‚‹\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä¸¡æ–¹ã®æ–¹æ³•ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGKE ã‚¯ãƒ©ã‚¹ã‚¿ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’åŒæ™‚ã«æ§‹ç¯‰ã™ã‚‹\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003cp\u003eGKE ã‚¯ãƒ©ã‚¹ã‚¿ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’åŒæ™‚ã«ä½œã‚‹æ–¹æ³•ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæ—©é€Ÿã§ã™ãŒä¸‹è¨˜ã« terraform ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨˜ã—ã¾ã—ãŸã€‚ãã‚Œãã‚Œã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã®æ„å‘³ã«ã¤ã„ã¦ã¯ Terraform ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”è¦§ã«ãªã£ã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cp\u003eå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ : \u003ca href=\"https://www.terraform.io/docs/providers/google/\"\u003ehttps://www.terraform.io/docs/providers/google/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã“ã“ã§ç‰¹ç­†ã™ã¹ãç‚¹ã¨ã—ã¦ã¯ä¸‹è¨˜ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚\u003c/p\u003e\n\u003ch3 id=\"ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã«ç´ä»˜ã‘ã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®-id-å–å¾—ã®ãŸã‚-replaceelement-çš„ãªã“ã¨ã‚’ã—ã¦ã„ã‚‹\"\u003eãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã«ç´ä»˜ã‘ã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® ID å–å¾—ã®ãŸã‚ \u0026ldquo;${replace(element\u0026hellip;\u0026rdquo; çš„ãªã“ã¨ã‚’ã—ã¦ã„ã‚‹\u003c/h3\u003e\n\u003cp\u003eãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã«å¯¾ã—ã¦ GKE ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ä½œæˆã—ãŸéš›ã«è‡ªå‹•ã§ä½œæˆã•ã‚Œã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã® URI ã‚’ç´ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ã¨ã—ã¦ã¯ URI ã§ã¯ãªã \u0026ldquo;ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å\u0026rdquo; ã§ã‚ã‚‹ã¨æ‰±ã„ã‚„ã™ã„ã®ã§ã™ãŒã€URI ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã“ã®æƒ…å ±ã¯ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå‚è€ƒã‚µã‚¤ãƒˆ : GKEã§kubernetesã®nodesã‚’ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã—ã¦ä½¿ã„ãŸã„ã¨ã with terraform\u003c/li\u003e\n\u003cli\u003eURL : \u003ca href=\"http://qiita.com/techeten/items/b2ec5f11f4a70dd21d70\"\u003ehttp://qiita.com/techeten/items/b2ec5f11f4a70dd21d70\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µä¸€ã¤ä½œã‚‹ãŸã‚ã«-6-å€‹ã‚‚ã®ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã£ã¦ã„ã‚‹\"\u003eãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µä¸€ã¤ä½œã‚‹ãŸã‚ã« 6 å€‹ã‚‚ã®ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã£ã¦ã„ã‚‹\u003c/h3\u003e\n\u003cp\u003eä¸€ã¤ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’ä½œã‚‹ãŸã‚ã«6ã¤ã®ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ãŒå¿…è¦ã«ãªã‚‹ã¨ã„ã†ã®ã‚‚é©šãã§ã™ãŒå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€ã¨ãªã‹ãªã‹ãã®æ„Ÿè¦šãŒã¤ã‹ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚ãã‚Œãã‚Œã®ç°¡å˜ãªæ„å‘³ã‚’ä¸‹è¨˜ã«è¨˜ã—ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e","title":"GCP ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã¨ GKE ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ Terraform ã‚’ä½¿ã£ã¦æ§‹ç¯‰ã™ã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚ @jedipunkz ã§ã™ã€‚\nä»Šæ—¥ã¯ Kubernetes ã‚’ä½¿ã£ã¦ Serverless ã‚’å®Ÿç¾ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ Fission ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚\nAWS ã® Lambda ã¨ã‚ˆãä¼¼ãŸå‹•ãã‚’ã—ã¾ã™ã€‚Lambda ã‚‚å†…éƒ¨ã§ã¯å„è¨€èªã«ç‰¹åŒ–ã—ãŸã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ãƒ¦ãƒ¼ã‚¶ãŒé–‹ç™ºã—ãŸ Lambda Function ã‚’å®Ÿè¡Œã—ã¦ãã‚Œã‚‹ã®ã§ã™ãŒã€Fission ã‚‚å„è¨€èªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸ Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ãƒ¦ãƒ¼ã‚¶ãŒé–‹ç™ºã—ãŸã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—å¿œç­”ã‚’è¿”ã—ã¦ãã‚Œã¾ã™ã€‚\nãã‚Œã§ã¯æ—©é€Ÿãªã®ã§ã™ãŒã€Fission ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nå‹•ä½œã•ã›ã‚‹ãŸã‚ã®ç’°å¢ƒ macOS ã‹ Linux ã‚’å‰æã¨ã—ã¦ä¸‹è¨˜ã®ç’°å¢ƒã‚’ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸ Kubernetes ç’°å¢ƒã¯ minikube ãŒæ‰‹ã£å–ã‚Šæ—©ã„ã®ã§ç”¨ã„ã¾ã™ãŒã€ã‚‚ã¡ã‚ã‚“ minikube ä»¥å¤–ã® kubernetes ç’°å¢ƒã§ã‚‚å‹•ä½œã—ã¾ã™ã€‚\nmacOS or Linux minikube or kubernetes kubectl fission ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³• ç°¡å˜ã«ã§ã™ãŒã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã‚’æ›¸ãã¾ã™ã€‚\nOS ç§ã¯ Linux ã§å‹•ä½œã•ã›ã¾ã—ãŸãŒç­†è€…ã®æ–¹ã¯ macOS ã‚’ä½¿ã£ã¦ã„ã‚‹æ–¹ãŒå¤šæ•°ã ã¨æ€ã„ã¾ã™ã®ã§ã€ã“ã®æ‰‹é †ã§ã¯ macOS ã‚’ä½¿ã£ãŸåˆ©ç”¨æ–¹æ³•ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚\nminikube ã“ã“ã§ã¯ç°¡å˜ãªæ‰‹é †ã§ kubernetes ç’°å¢ƒã‚’æ§‹ç¯‰ã§ãã‚‹ minikube ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\ncurl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.16.0/minikube-darwin-amd64 \u0026amp;\u0026amp; chmod +x minikube \u0026amp;\u0026amp; sudo mv minikube /usr/local/bin/fission kubectl ç›´æ¥å¿…è¦ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€kubectl ãŒã‚ã‚‹ã¨ minikube ã§æ§‹ç¯‰ã—ãŸ kubernetes ç’°å¢ƒã‚’æ“ä½œã§ãã¾ã™ã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚\ncurl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.5.2/bin/linux/amd64/kubectl \u0026amp;\u0026amp; chmod +x kubectl \u0026amp;\u0026amp; sudo mv kubectl /usr/local/bin/ Fission Fission ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ã™ã€‚\ncurl http://fission.io/linux/fission \u0026gt; fission \u0026amp;\u0026amp; chmod +x fission \u0026amp;\u0026amp; sudo mv fission /usr/local/bin/fission kubernetes ã®èµ·å‹• ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ãŸã‚‰ minikube ã‚’ä½¿ã£ã¦ kubernetes ã‚’èµ·å‹•ã—ã¾ã™ã€‚\n$ minikube start $ minikube status minikubeVM: Running localkube: Running $ kubectl get nodes NAME STATUS AGE minikube Ready 1h Fission ã®èµ·å‹•ã¨ç’°å¢ƒå¤‰æ•°ã®è¨­å®š Fission ã‚’èµ·å‹•ã—ã¾ã™ã€‚\n$ kubectl create -f http://fission.io/fission.yaml $ kubectl create -f http://fission.io/fission-nodeport.yaml æ¬¡ã«ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚\n$ export FISSION_URL=http://$(minikube ip):31313 $ export FISSION_ROUTER=$(minikube ip):31314 Fission ã‚’ä½¿ã£ã¦ Python ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ ä¾‹ã¨ã—ã¦ Python ã® Hello World ã‚’ç”¨æ„ã—ã¾ã™ã€‚hello.py ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚\ndef main(): return \u0026#34;Hello, world!\\n\u0026#34; ã§ã¯ã„ã‚ˆã„ã‚ˆã€kubernetes ã¨ Fission ã‚’ä½¿ã£ã¦ä¸Šè¨˜ã® Hello World ã‚’å®Ÿè¡Œã•ã›ã¾ã™ã€‚\nã¾ãš Fission ãŒç”¨æ„ã—ã¦ãã‚Œã¦ã„ã‚‹ Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’æ‰±ã†ã‚ˆã†ã« \u0026rsquo;env\u0026rsquo; ã‚’ä½œã‚Šã¾ã™ã€‚\n$ fission env create --name python-env --image fission/python-env æ¬¡ã« Fission ã§ Function ã‚’ä½œã‚Šã¾ã™ã€‚ãã®éš›ã«ä¸Šè¨˜ã® env ã¨ python ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€hello.py ã‚’ fission/python-env ã¨ã„ã† Docker ã‚³ãƒ³ãƒ†ãƒŠã§ç¨¼åƒã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚\n$ fission function create --name python-hello -env python-env --code ./hello.py æ¬¡ã« Router ã‚’ä½œã‚Šã¾ã™ã€‚ã‚¯ã‚¨ãƒªã® Path ã«å¯¾ã—ã¦ Fuction ã‚’é–¢é€£ä»˜ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\n$ fission route add --function python-hello --url /python-hello Function ã‚’å®Ÿè¡Œã™ã‚‹ç’°å¢ƒãŒã§ãã¾ã—ãŸã€‚å®Ÿéš›ã« curl ã‚’ä½¿ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\n$ curl http://$FISSION_ROUTER/python-hello Hello, world! hello.py ã®å®Ÿè¡ŒçµæœãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚\nã¾ã¨ã‚ã¨è€ƒå¯Ÿ çµæœã‹ã‚‰ Fission ã¯ \u0026ldquo;å„è¨€èªã®å®Ÿè¡Œç’°å¢ƒã¨ã—ã¦ Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’ç”¨ã„ã¦ã„ã¦ã€ãƒ¦ãƒ¼ã‚¶ãŒé–‹ç™ºã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ãã®ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§èµ·å‹•ã—å®Ÿè¡Œçµæœã‚’å¾—ã‚‰ã‚Œã‚‹ã€‚ã¾ãŸå„ã‚³ãƒ¼ãƒ‰æ¯ã« URL ãƒ‘ã‚¹ãŒæŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã€ãã‚Œã‚’ãƒ«ãƒ¼ã‚¿ã¨ã—ã¦é–¢ä¿‚æ€§ã‚’æŒãŸã›ã‚‰ã‚Œã‚‹\u0026rdquo; ã¨ã„ã†ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚AWS ã® Lambda ã¨ã»ã¼åŒã˜ã“ã¨ãŒå®Ÿç¾å‡ºæ¥ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚\nAWS ã«ã¯ Lambda ã®å®Ÿè¡Œçµæœã‚’å¿œç­”ã™ã‚‹ãŸã‚ã® API Gateway ãŒã‚ã‚Šã€ã“ã®ãƒãƒãƒ¼ã‚¸ãƒ‰ HTTP ã‚µãƒ¼ãƒã¨ä½µç”¨ã™ã‚‹ã“ã¨ã§ API ç’°å¢ƒã‚’ç”¨æ„å‡ºæ¥ã‚‹ã®ã§ã™ãŒ Fission ã®å ´åˆã«ã¯ HTTP ã‚µãƒ¼ãƒã‚‚è¾¼ã¿ã§æä¾›ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚‚åˆ†ã‹ã‚Šã¾ã™ã€‚\nã‚ã¨ã¯ã€ã“ã® Fission ã‚’æä¾›ã—ã¦ã„ã‚‹å…ƒãŒ \u0026ldquo;Platform9\u0026rdquo; ã¨ã„ã†ä¼æ¥­ãªã®ã§ã™ãŒã€ã“ã®ä¼æ¥­ã¯ OpenStack ã‚„ kubernetes ã‚’ä½¿ã£ãŸãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚é–‹ç™ºå…ƒãŒä¸€ä¼æ¥­ã¨ã„ã†ã“ã¨ã¨ã€å®Œå…¨ãª OSS é–‹ç™ºä½“åˆ¶ã«ãªã£ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã£ã¦ã€ä¸‡ãŒä¸€ã“ã®ä¼æ¥­ã«ä½•ã‹ã‚ã£ãŸå ´åˆã«ã“ã® Fission ã‚’ä½¿ã„ç¶šã‘ã‚‰ã‚Œã‚‹ã®ã‹å•é¡ŒãŒã—ã°ã‚‰ãã¯ã‚ã‚Šãã†ã§ã™ã€‚Fission åŒç­‰ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ kubernetes ãŒå–ã‚Šè¾¼ã‚€ã¨ã„ã†è©±é¡Œã¯\u0026hellip;ã‚ã‚‹ã®ã‹ãªãï¼Ÿ\nkubernetes ã® Job Scheduler ãŒåŒç­‰ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ãã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã¾ã  Job Scheduler ã¯åˆ©ç”¨ã™ã‚‹ã«ã¯æ¯ã‚Œã¦ã„ãªã„å°è±¡ãŒã‚ã‚Šã¾ã™ã€‚Fission ã¨ Job Scheduler ã€ã©ã¡ã‚‰ãŒã„ã¡æ—©ãå®Œæˆåº¦ã‚’ä¸Šã’ã‚‰ã‚Œã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚\n","permalink":"https://jedipunkz.github.io/post/serverless-fission/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚ @jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šæ—¥ã¯ Kubernetes ã‚’ä½¿ã£ã¦ Serverless ã‚’å®Ÿç¾ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ Fission ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eAWS ã® Lambda ã¨ã‚ˆãä¼¼ãŸå‹•ãã‚’ã—ã¾ã™ã€‚Lambda ã‚‚å†…éƒ¨ã§ã¯å„è¨€èªã«ç‰¹åŒ–ã—ãŸã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ãƒ¦ãƒ¼ã‚¶ãŒé–‹ç™ºã—ãŸ Lambda Function ã‚’å®Ÿè¡Œã—ã¦ãã‚Œã‚‹ã®ã§ã™ãŒã€Fission ã‚‚å„è¨€èªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸ Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ãƒ¦ãƒ¼ã‚¶ãŒé–‹ç™ºã—ãŸã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—å¿œç­”ã‚’è¿”ã—ã¦ãã‚Œã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eãã‚Œã§ã¯æ—©é€Ÿãªã®ã§ã™ãŒã€Fission ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‹•ä½œã•ã›ã‚‹ãŸã‚ã®ç’°å¢ƒ\"\u003eå‹•ä½œã•ã›ã‚‹ãŸã‚ã®ç’°å¢ƒ\u003c/h2\u003e\n\u003cp\u003emacOS ã‹ Linux ã‚’å‰æã¨ã—ã¦ä¸‹è¨˜ã®ç’°å¢ƒã‚’ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸ Kubernetes ç’°å¢ƒã¯ minikube ãŒæ‰‹ã£å–ã‚Šæ—©ã„ã®ã§ç”¨ã„ã¾ã™ãŒã€ã‚‚ã¡ã‚ã‚“ minikube ä»¥å¤–ã® kubernetes ç’°å¢ƒã§ã‚‚å‹•ä½œã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003emacOS or Linux\u003c/li\u003e\n\u003cli\u003eminikube or kubernetes\u003c/li\u003e\n\u003cli\u003ekubectl\u003c/li\u003e\n\u003cli\u003efission\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•\"\u003eã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•\u003c/h2\u003e\n\u003cp\u003eç°¡å˜ã«ã§ã™ãŒã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã‚’æ›¸ãã¾ã™ã€‚\u003c/p\u003e\n\u003ch4 id=\"os\"\u003eOS\u003c/h4\u003e\n\u003cp\u003eç§ã¯ Linux ã§å‹•ä½œã•ã›ã¾ã—ãŸãŒç­†è€…ã®æ–¹ã¯ macOS ã‚’ä½¿ã£ã¦ã„ã‚‹æ–¹ãŒå¤šæ•°ã ã¨æ€ã„ã¾ã™ã®ã§ã€ã“ã®æ‰‹é †ã§ã¯ macOS ã‚’ä½¿ã£ãŸåˆ©ç”¨æ–¹æ³•ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003ch4 id=\"minikube\"\u003eminikube\u003c/h4\u003e\n\u003cp\u003eã“ã“ã§ã¯ç°¡å˜ãªæ‰‹é †ã§ kubernetes ç’°å¢ƒã‚’æ§‹ç¯‰ã§ãã‚‹ minikube ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ecurl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.16.0/minikube-darwin-amd64 \u0026amp;\u0026amp; chmod +x minikube \u0026amp;\u0026amp; sudo mv minikube /usr/local/bin/fission\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 id=\"kubectl\"\u003ekubectl\u003c/h4\u003e\n\u003cp\u003eç›´æ¥å¿…è¦ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€kubectl ãŒã‚ã‚‹ã¨ minikube ã§æ§‹ç¯‰ã—ãŸ kubernetes ç’°å¢ƒã‚’æ“ä½œã§ãã¾ã™ã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e","title":"Serverless on Kubernetes : Fission ã‚’ä½¿ã£ã¦ã¿ãŸ"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚ @jedipunkz ã§ã™ã€‚\nã„ã¾åƒ•ã‚‰ã¯è·å ´ã§ã¯ GKE ä¸Šã« Replication Controller ã¨ Services ã‚’ä½¿ã£ã¦ Pod ã‚’èµ·å‹•ã—ã¦ã„ã‚‹ã®ã§ã™ãŒæœ€è¿‘ã® Kubernetes é–¢é€£ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ‹è¦‹ã™ã‚‹ã¨ Deployments ã‚’ä½¿ã£ã¦ã„ã‚‹è¨˜äº‹ã‚’ã‚ˆãè¦‹æ›ã‘ã¾ã™ã€‚Kubernetes 1.2 ã‹ã‚‰å®Ÿè£…ã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚ä»Šå›ã¯ Kubernetes ã® Replication Controller ã®æ¬¡ä¸–ä»£ç‰ˆã¨è¨€ã‚ã‚Œã¦ã„ã‚‹ Deployments ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ã¾ã—ãŸã®ã§ç†è§£ã—ãŸã“ã¨ã‚’æ›¸ã„ã¦ã„ã“ã†ã‹ã¨æ€ã„ã¾ã™ã€‚\nå‚è€ƒè³‡æ–™ ä»Šå›ã¯ Kubernetes å…¬å¼ã®ä¸‹è¨˜ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’ä¸€é€šã‚Šå®Ÿè¡Œã—ã¦ã„ãã¾ã™ã€‚è¿½åŠ ã®æƒ…å ±ã‚‚ã‚ã‚Šã¾ã™ã€‚\nhttps://kubernetes.io/docs/user-guide/deployments/ Deployments ã‚’ä½¿ã£ã¦ nginx Pod ã‚’èµ·å‹• nginx ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã® Yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚\napiVersion: extensions/v1beta1 kind: Deployment metadata: name: nginx-deployment spec: replicas: 2 template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:1.7.9 ports: - containerPort: 80 ä½œæˆã—ãŸ yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦ Pod ã‚’ä½œã‚Šã¾ã™ã€‚ ä¸‹è¨˜ã®é€šã‚Šã“ã“ã§ \u0026ldquo;\u0026ndash;record\u0026rdquo; ã¨è¨˜ã—ã¦ã„ã‚‹ã®ã¯ã€å¾Œã« Deployments ã®å±¥æ­´ã‚’è¡¨ç¤ºã™ã‚‹éš›ã« \u0026ldquo;ä½•ã‚’è¡Œã£ãŸã‹\u0026rdquo; ã‚’å‡ºåŠ›ã™ã‚‹ãŸã‚ã§ã™ã€‚ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ãªã„ã¨ \u0026ldquo;ä½•ã‚’è¡Œã£ãŸã‹\u0026rdquo; ã®å‡ºåŠ›ãŒ \u0026ldquo;NONE\u0026rdquo; ã¨ãªã‚Šã¾ã™ã€‚\n$ kubectl create -f nginx.yaml --record ã“ã“ã§\ndeployments replica set pod rollout ã®çŠ¶æ…‹ã‚’ãã‚Œãã‚Œç¢ºèªã—ã¦ã¿ã¾ã™ã€‚\n$ kubectl get deployments NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE nginx-deployment 2 2 2 2 8s $ kubectl get rs NAME DESIRED CURRENT READY AGE nginx-deployment-4087004473 2 2 2 10s $ kubectl get pods --show-labels NAME READY STATUS RESTARTS AGE LABELS nginx-deployment-4087004473-6csa7 1/1 Running 0 21s app=nginx,pod-template-hash=4087004473 nginx-deployment-4087004473-teyzc 1/1 Running 0 21s app=nginx,pod-template-hash=4087004473 $ kubectl rollout status deployment/nginx-deployment deployment nginx-deployment successfully rolled out çµæœã‹ã‚‰ã€ä¸‹è¨˜ã®äº‹ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\nyaml ã«è¨˜ã—ãŸé€šã‚Š \u0026ldquo;nginx-deployment\u0026rdquo; ã¨ã„ã†åå‰ã§ deployment ãŒç”Ÿæˆã•ã‚ŒãŸ \u0026ldquo;nginx-deployment-4087004473\u0026rdquo; ã¨ã„ã†åå‰ã® rs (ãƒ¬ãƒ—ãƒªã‚«ã‚»ãƒƒãƒˆ) ãŒç”Ÿæˆã•ã‚ŒãŸ yaml ã«è¨˜ã—ãŸé€šã‚Š2ã¤ã® Pod ãŒèµ·å‹•ã—ãŸ \u0026ldquo;nginx-deployment\u0026rdquo; ãŒæ­£å¸¸ã« Rollout ã•ã‚ŒãŸ Replication Controller ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸéš›ã«ã¯ä½œã‚‰ã‚Œãªã„ replica set, rollout ã¨ã„ã†ãƒ¢ãƒãŒå‡ºã¦ãã¾ã—ãŸã€‚å¾Œã« Deployments ã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆã«ç¹‹ãŒã£ã¦ã„ãã¾ã™ã€‚\nnginx ã‚¤ãƒ¡ãƒ¼ã‚¸ã® Tag ã‚’æ›´æ–°ã—ã¦ã¿ã‚‹ ã“ã“ã§ yaml ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§æŒ‡å®šã—ã¦ã„ãŸ \u0026ldquo;image: nginx:1.7.9\u0026rdquo; ã‚’ \u0026ldquo;image: nginx:1.9.1\u0026rdquo; ã¨æ›´æ–°ã—ã¦ã¿ã¾ã™ã€‚ Replication Controller ã§è¨€ã† Rolling-Update ã«ãªã‚Šã¾ã™ã€‚å¾Œã«è¿°ã¹ã¾ã™ãŒä»–ã«ã‚‚æ›´æ–°æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚\n$ kubectl set image deployment/nginx-deployment nginx=nginx:1.9.1 ã“ã“ã§å…ˆã»ã©ã¨åŒæ§˜ã«çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚\n$ kubectl get deployments NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE nginx-deployment 2 2 2 2 2m $ kubectl get rs NAME DESIRED CURRENT READY AGE nginx-deployment-3599678771 2 2 2 39s nginx-deployment-4087004473 0 0 0 2m $ kubectl get pods NAME READY STATUS RESTARTS AGE nginx-deployment-3599678771-0vj9m 1/1 Running 0 53s nginx-deployment-3599678771-t1y62 1/1 Running 0 53s ã“ã“ã§\u0026hellip;\næ–°ã—ã„ Replica Set \u0026ldquo;nginx-deployment-3599678771\u0026rdquo; ãŒä½œæˆã•ã‚ŒãŸ å¤ã„ Replica Set \u0026ldquo;nginx-deployment-4087004473\u0026rdquo; ã® Pod ã¯ 0 å€‹ã«ãªã£ãŸ Pod å†…ã‚³ãƒ³ãƒ†ãƒŠãŒæ›´æ–°ã•ã‚ŒãŸ (NAME ã‚ˆã‚Šåˆ¤æ–­) ã¨ãªã£ãŸã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ Replication Controller ã¨ç•°ãªã‚Šã€Deployments ã§ã¯ä»¥å‰ã®çŠ¶æ…‹ãŒ Replica Set ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¦ã„ã¦çŠ¶æ…‹ã®å±¥æ­´ãŒè¿½ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚\nã“ã“ã§ Rollout ã®å±¥æ­´ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚\n$ kubectl rollout history deployment/nginx-deployment deployments \u0026#34;nginx-deployment\u0026#34; REVISION CHANGE-CAUSE 1 kubectl create -f nginx.yaml --record 2 kubectl set image deployment/nginx-deployment nginx=nginx:1.9.1 REVISION ã¨ã„ã†åå‰ã§å±¥æ­´ç•ªå·ãŒä»˜ãã€ã©ã®æ§˜ãªä½œæ¥­ã‚’è¡Œã£ãŸã‹ CHANGE-CAUSE ã¨ã„ã†é …ç›®ã§è¨˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ä½œæ¥­ã®å±¥æ­´ãŒãƒªãƒ“ã‚¸ãƒ§ãƒ³ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚\nä¸‹è¨˜ã®ã‚ˆã†ã« REVSION ç•ªå·ã‚’ä»˜ä¸ã—ã¦å±¥æ­´å†…å®¹ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚\n$ kubectl rollout history deployment/nginx-deployment --revision=2 deployments \u0026#34;nginx-deployment\u0026#34; with revision #2 Labels: app=nginx pod-template-hash=3599678771 Annotations: kubernetes.io/change-cause=kubectl set image deployment/nginx-deployment nginx=nginx:1.9.1 Containers: nginx: Image: nginx:1.9.1 Port: 80/TCP Volume Mounts: \u0026lt;none\u0026gt; Environment Variables: \u0026lt;none\u0026gt; No volumes. ä½œæ¥­ã‚’åˆ‡ã‚Šæˆ»ã—ã¦ã¿ã‚‹ å…ˆç¨‹ nginx ã® Image Tag ã‚’æ›´æ–°ã—ã¾ã—ãŸãŒã€ã“ã“ã§ Deployments ã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ä½œæ¥­ã‚’åˆ‡ã‚Šæˆ»ã—ã¦ã¿ã¾ã™ã€‚ä¸‹è¨˜ã®æ§˜ã«å®Ÿè¡Œã—ã¾ã™ã€‚\n$ kubectl rollout undo deployment/nginx-deployment çŠ¶æ…‹ã‚’ç¢ºèªã—ã¾ã™ã€‚\n$ kubectl get deployments NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE nginx-deployment 2 2 2 2 5m $ kubectl rollout history deployment/nginx-deployment deployments \u0026#34;nginx-deployment\u0026#34; REVISION CHANGE-CAUSE 2 kubectl set image deployment/nginx-deployment nginx=nginx:1.9.1 3 kubectl create -f nginx.yaml --record ã“ã“ã§ã¯\u0026hellip;\nã‚³ãƒ³ãƒ†ãƒŠãŒ2å€‹ã€æ­£å¸¸ã«èµ·å‹•ã—ãŸ REVISION ç•ªå· 3 ã¨ã—ã¦åˆæœŸæ§‹ç¯‰ã®çŠ¶æ…‹ (kubectl create ..) ãŒæ–°ãŸã«ä¿å­˜ ã¨ã„ã†ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚æ³¨æ„ã—ãŸã„ã®ã¯ REVSION ç•ªå· 1 ãŒå‰Šé™¤ã•ã‚Œ 3 ãŒç”Ÿæˆã•ã‚ŒãŸã“ã¨ã§ã™ã€‚1 ã¨ 3 ã¯åŒã˜ä½œæ¥­ã¨ã„ã†ã“ã¨ã¨æ¨æ¸¬ã—ã¾ã™ã€‚\nå¿µã®ãŸã‚ \u0026rsquo;nginx\u0026rsquo; ã‚³ãƒ³ãƒ†ãƒŠã® Image Tag ãŒåˆ‡ã‚Šæˆ»ã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚\n$ kubectl describe pod nginx-deployment-4087004473-nq35u | grep \u0026#34;Image:\u0026#34; Image: nginx:1.7.9 æœ€åˆã® Yaml ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜ã—ãŸ \u0026rsquo;nginx\u0026rsquo; ã‚¤ãƒ¡ãƒ¼ã‚¸ Tag \u0026ldquo;1.7.9\u0026rdquo; ã¨ãªã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚set image \u0026hellip; ã§ã‚¤ãƒ¡ãƒ¼ã‚¸æ›´æ–°ã‚’ã—ãŸä½œæ¥­ãŒæ­£å¸¸ã«åˆ‡ã‚Šæˆ»ã£ãŸã“ã¨ã«ãªã‚Šã¾ã™ã€‚\nãƒ¬ãƒ—ãƒªã‚«æ•°ã‚’ 2-\u0026gt;3 ã¸ã‚¹ã‚±ãƒ¼ãƒ«ã—ã¦ã¿ã‚‹ æ›´ã« replicas ã®æ•°å€¤ã‚’ 2 ã‹ã‚‰ 3 ã¸ã‚¹ã‚±ãƒ¼ãƒ«ã—ã¦ã¿ã¾ã™ã€‚\n$ kubectl scale deployment nginx-deployment --replicas 3 åŒæ§˜ã«çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚\nkubectl get pods NAME READY STATUS RESTARTS AGE nginx-deployment-4087004473-esj5l 1/1 Running 0 6s nginx-deployment-4087004473-nq35u 1/1 Running 0 4m nginx-deployment-4087004473-tyibo 1/1 Running 0 4m kubectl get rs NAME DESIRED CURRENT READY AGE nginx-deployment-3599678771 0 0 0 9m nginx-deployment-4087004473 3 3 3 11m kubectl rollout history deployment/nginx-deployment deployments \u0026#34;nginx-deployment\u0026#34; REVISION CHANGE-CAUSE 2 kubectl set image deployment/nginx-deployment nginx=nginx:1.9.1 3 kubectl scale deployment nginx-deployment --replicas 3 ã“ã“ã§æ°—ã«ãªã‚‹ã®ã¯ REVISION 3 ãŒä¸Šæ›¸ãã•ã‚ŒãŸã“ã¨ã§ã™ã€‚REVSION ç•ªå· 4 ãŒæ–°ãŸã«ä½œæˆã•ã‚Œã‚‹ã¨æ€ã£ã¦ã„ãŸã‹ã‚‰ã§ã™ã€‚å…ˆç¨‹ REVISION ç•ªå· 3 ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¦ã„ãŸä¸‹è¨˜ã®å±¥æ­´ãŒæ¶ˆãˆã¦ã—ã¾ã„ã¾ã—ãŸã€‚ã“ã®ç‚¹ã«ã¤ã„ã¦ã¯å¼•ãç¶šãæ¤œè¨¼ã—ã¦ã¿ã¾ã™ã€‚ä»Šã®è‡ªåˆ†ã«ã¯ç†è§£ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã”å­˜çŸ¥ã®æ–¹ã„ã¾ã—ãŸã‚‰ã€ã‚³ãƒ¡ãƒ³ãƒˆãŠé¡˜ã„ã—ã¾ã™ï¼\n3 kubectl create -f nginx.yaml --record Puase, Resume æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã¿ã‚‹ æ¬¡ã¯ deployments ã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ Image Tag ã‚’æ›´ã« 1.9.1 ã¸å¤‰æ›´ã—ã€ãã®å‡¦ç†ã‚’ãƒãƒ¼ã‚ºã—ã¦ã¿ã¾ã™ã€‚\nkubectl set image deployment/nginx-deployment nginx=nginx:1.9.1; kubectl åŒæ§˜ã«çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚\n$ kubectl get rs NAME DESIRED CURRENT READY AGE nginx-deployment-3599678771 2 2 2 10m nginx-deployment-4087004473 2 2 2 12m $ kubectl rollout status deployment/nginx-deployment Waiting for rollout to finish: 2 out of 3 new replicas have been updated... Ctrl-C #\u0026lt;--- ã‚­ãƒ¼å…¥åŠ› rollout status ã§ deployment \u0026ldquo;deployment/nginx-deployment\u0026rdquo; ã‚’ç¢ºèªã™ã‚‹ã¨ \u0026ldquo;waiting for rollout to finish\u0026rdquo; ã¨è¡¨ç¤ºã•ã‚Œå‡¦ç†ãŒãƒãƒ¼ã‚ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚ã¾ãŸå¤ã„ Deployment \u0026ldquo;nginx-deployment-4087004473\u0026rdquo; ä¸Šã«æœªã ã‚³ãƒ³ãƒ†ãƒŠãŒæ®‹ã‚Šã€æ–°ã—ã„ Deployment ã‚‚ã‚³ãƒ³ãƒ†ãƒŠãŒç”Ÿæˆä¸­ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\nã§ã¯ Resume ã—ã¾ã™ã€‚\n$ kubectl rollout resume deployment/nginx-deployment deployment \u0026#34;nginx-deployment\u0026#34; resumed ã“ã®æ™‚ç‚¹ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚\n$ kubectl rollout status deployment/nginx-deployment deployment nginx-deployment successfully rolled out $ kubectl get rs NAME DESIRED CURRENT READY AGE nginx-deployment-3599678771 3 3 3 11m nginx-deployment-4087004473 0 0 0 14m ã“ã“ã‹ã‚‰ã¯\u0026hellip;\næ­£å¸¸ã« Deployment \u0026ldquo;nginx-deployment\u0026rdquo; ãŒ Rollout ã•ã‚ŒãŸã“ã¨ å¤ã„ Deployment ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠæ•°ãŒ 0 ã«ã€æ–°ã—ã„ Deployment ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠæ•°ãŒ 3 ã«ãªã£ãŸ ã¨ã„ã†ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\nRolling-Update ç›¸å½“ã®ä½œæ¥­ã‚’è¡Œã†æ–¹æ³• å‰è¿°ã—ãŸé€šã‚Šã€Replication Controller æ™‚ä»£ã«ã‚ã£ãŸ Rolling-Update ä½œæ¥­ (ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ãƒ»ãƒ¬ãƒ—ãƒªã‚«æ•°ç­‰ã®æ›´æ–°) ã§ã™ãŒã€Deployments ã§ã¯ä¸‹è¨˜ã®æ–¹æ³•ã‚’ã¨ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\nset ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸ã™ã‚‹å ´åˆ set ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸ã—ã¦ Key é …ç›®ã«å¯¾ã—ã¦æ–°ã—ã„ Value ã‚’æ¸¡ã—ã¾ã™ã€‚\n$ kubectl set image deployment/nginx-deployment nginx=nginx:1.9.1 yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã™ã‚‹å ´åˆ yaml ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’æ›´æ–°ã—ã¦é©ç”¨ã—ãŸã„å ´åˆã€ä¸‹è¨˜ã®ã‚ˆã†ã« apply ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸ã—ã¾ã™ã€‚\n$ kubectl apply -f \u0026lt;æ–°ã—ã„Yamlãƒ•ã‚¡ã‚¤ãƒ«\u0026gt; ã¾ã¨ã‚ã¨è€ƒå¯Ÿ REVISION ã®å±¥æ­´ãŒä¸Šæ›¸ãã•ã‚Œã‚‹ç‚¹ãªã©ã€ã¾ã æœªå®Œæˆãªæ„ŸãŒå¦ã‚ã¾ã›ã‚“ã§ã—ãŸãŒ(è‡ªåˆ†ã®å‹˜é•ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼)ã€Replication Controller ã¨æ¯”ã¹ã‚‹ã¨ä½œæ¥­ã®åˆ‡ã‚Šæˆ»ã—ã‚„ã€å±¥æ­´ãŒä¿å­˜ã•ã‚Œå±¥æ­´å†…å®¹ã‚‚ç¢ºèªã§ãã‚‹ç‚¹ãªã©æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã§ã„ã¦ã‚‚ã‚³ãƒãƒ³ãƒ‰çµæœç­‰æ€ªã—ã„ç‚¹ãŒã‚ã£ã¦æµçŸ³ã« API ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ \u0026ldquo;v1beta1\u0026rdquo; ã ãªãã¨ã„ã†æ„Ÿã˜ã§ã¯ã‚ã‚Šã¾ã™ãŒã€æ©Ÿèƒ½ãŒæ•´ç†ã•ã‚Œã¦ã„ã¦åˆ©ä¾¿æ€§ãŒä¸ŠãŒã£ã¦ã„ã‚‹ã®ã§ Replication Controller ã‚’ä½¿ã£ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ã¯è‡ªç„¶ã¨ä»Šå¾Œã€Deployments ã«ç§»è¡Œã—ã¦ã„ãã®ã§ã¯ãªã„ã‹ã¨æ„Ÿã˜ã¾ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/kubernetes-deployments/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚ @jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã„ã¾åƒ•ã‚‰ã¯è·å ´ã§ã¯ GKE ä¸Šã« Replication Controller ã¨ Services ã‚’ä½¿ã£ã¦ Pod ã‚’èµ·å‹•ã—ã¦ã„ã‚‹ã®ã§ã™ãŒæœ€è¿‘ã® Kubernetes é–¢é€£ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ‹è¦‹ã™ã‚‹ã¨ Deployments ã‚’ä½¿ã£ã¦ã„ã‚‹è¨˜äº‹ã‚’ã‚ˆãè¦‹æ›ã‘ã¾ã™ã€‚Kubernetes 1.2 ã‹ã‚‰å®Ÿè£…ã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚ä»Šå›ã¯ Kubernetes ã® Replication Controller ã®æ¬¡ä¸–ä»£ç‰ˆã¨è¨€ã‚ã‚Œã¦ã„ã‚‹ Deployments ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ã¾ã—ãŸã®ã§ç†è§£ã—ãŸã“ã¨ã‚’æ›¸ã„ã¦ã„ã“ã†ã‹ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒè³‡æ–™\"\u003eå‚è€ƒè³‡æ–™\u003c/h2\u003e\n\u003cp\u003eä»Šå›ã¯ Kubernetes å…¬å¼ã®ä¸‹è¨˜ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’ä¸€é€šã‚Šå®Ÿè¡Œã—ã¦ã„ãã¾ã™ã€‚è¿½åŠ ã®æƒ…å ±ã‚‚ã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://kubernetes.io/docs/user-guide/deployments/\"\u003ehttps://kubernetes.io/docs/user-guide/deployments/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"deployments-ã‚’ä½¿ã£ã¦-nginx-pod-ã‚’èµ·å‹•\"\u003eDeployments ã‚’ä½¿ã£ã¦ nginx Pod ã‚’èµ·å‹•\u003c/h2\u003e\n\u003cp\u003enginx ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã® Yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eapiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.7.9\n        ports:\n        - containerPort: 80\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä½œæˆã—ãŸ yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦ Pod ã‚’ä½œã‚Šã¾ã™ã€‚\nä¸‹è¨˜ã®é€šã‚Šã“ã“ã§ \u0026ldquo;\u0026ndash;record\u0026rdquo; ã¨è¨˜ã—ã¦ã„ã‚‹ã®ã¯ã€å¾Œã« Deployments ã®å±¥æ­´ã‚’è¡¨ç¤ºã™ã‚‹éš›ã« \u0026ldquo;ä½•ã‚’è¡Œã£ãŸã‹\u0026rdquo; ã‚’å‡ºåŠ›ã™ã‚‹ãŸã‚ã§ã™ã€‚ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ãªã„ã¨ \u0026ldquo;ä½•ã‚’è¡Œã£ãŸã‹\u0026rdquo; ã®å‡ºåŠ›ãŒ \u0026ldquo;NONE\u0026rdquo; ã¨ãªã‚Šã¾ã™ã€‚\u003c/p\u003e","title":"Kubernetes Deployments ã‚’ä½¿ã£ã¦ã¿ãŸï¼"},{"content":"ã“ã‚“ã«ã¡ã¯ @jedipunkz ã§ã™ã€‚\nä»Šå›ã¯ Kubernetes ã‚’ä½¿ã£ãŸæ§‹æˆã§ Google-Fluentd ã‚’ã©ã®ã‚³ãƒ³ãƒ†ãƒŠã«è¼‰ã›ã‚‹ã‹ï¼Ÿã£ã¦ã“ã¨ã‚’è€ƒãˆã¦ã¿ãŸã®ã§æ›¸ããŸã„ã¨æ€ã„ã¾ã™ã€‚\nKubernetes ã¯ Docker ã‚’åˆ©ç”¨ã—ãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãªã®ã§ Docker ã¨åŒã˜ã \u0026ldquo;1ã‚³ãƒ³ãƒ†ãƒŠ, 1ãƒ—ãƒ­ã‚»ã‚¹\u0026rdquo; ã¨ã„ã†ãƒãƒªã‚·ãŒã‚ã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šã€ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®ãƒ—ãƒ­ã‚»ã‚¹ãŒåœæ­¢ã—ãŸã‚‰ Kubernetes ãŒãã‚Œã‚’æ¤œçŸ¥ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ãªãŠã—ã¦ãã‚Œã¾ã™ã€‚ã§ã™ãŒã€è¤‡æ•°ãƒ—ãƒ­ã‚»ã‚¹ã‚’1ã‚³ãƒ³ãƒ†ãƒŠã«ç¨¼åƒã•ã›ã‚‹ã¨ã€ãã‚ŒãŒå‡ºæ¥ã¾ã›ã‚“ã€‚ãã†ã¯è¨€ã£ã¦ã‚‚ä¸­ã«ã¯è¤‡æ•°ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¨¼åƒã•ã›ãŸã„å ´é¢ãŒã‚ã‚Šã¾ã™ã€‚ãã®å ´é¢ã¨ã—ã¦è€ƒãˆã‚‰ã‚Œã‚‹å…·ä½“çš„ãªä¾‹ã¨ã—ã¦ HTTPD ã‚µãƒ¼ãƒã®ãƒ­ã‚°ã‚’ Google-Fluentd ã‚’ä½¿ã£ã¦ GCP Cloud Logging ã«è»¢é€ã—ãŸã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚\nä»Šå›ã¯ä¸Šè¨˜ã®ä¾‹ã‚’ fluentd-sidecar-gcp ã¨ kubernetes volumes ã‚’ä½¿ã£ã¦è§£æ±ºã™ã‚‹æ–¹æ³•ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\næ§‹æˆã®ã‚·ãƒŠãƒªã‚ª ã‚·ãƒŠãƒªã‚ªã¨ã—ã¦ã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\nãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠãƒãƒƒãƒ‰ã‚’æ‰±ã† 1ã¤ã® Kubernetes Volumes ã‚’è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã§å…±æœ‰ã™ã‚‹ HTTPD ãƒ­ã‚°ã‚’ãã® Volume ã«å‡ºåŠ› éš£æ¥ã™ã‚‹ Google-Fluentd ã‚³ãƒ³ãƒ†ãƒŠã§ãã® Volume ã«å‡ºåŠ›ã•ã‚ŒãŸãƒ­ã‚°ã‚’èª­ã¿è¾¼ã¿ãƒ­ã‚°è»¢é€ fluentd-sidecar-gcp ã¨ã¯ æ¬¡ã«èª¬æ˜ã™ã‚‹ã®ã¯ fluentd-sidecar-gcp ã®æ¦‚ç•¥ã§ã™ã€‚ã“ã‚Œã¯ Kubernetes ãŒ contrib ã§æ‰±ã£ã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã§ã™ã€‚ä¸‹è¨˜ã® URL ã«ã‚ã‚Šã¾ã™ã€‚\nhttps://github.com/kubernetes/contrib/tree/master/logging/fluentd-sidecar-gcp\nGoogle-Fluentd ã‚’ç¨¼åƒã•ã›ã‚‹ Dockerfile ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€ä¸‹è¨˜ã®è¨˜è¿°ã‚’ç¢ºèªã™ã‚‹ã¨ã“ã®ã‚³ãƒ³ãƒ†ãƒŠã«ç’°å¢ƒå¤‰æ•° $FILES_TO_COLLECT ã‚’æ¸¡ã™ã¨ Google Fluentd ã§ãƒ­ã‚°ã‚’å–å¾—ã—ã¦ãã‚Œã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\nhttps://github.com/kubernetes/contrib/blob/master/logging/fluentd-sidecar-gcp/config_generator.sh#L22-L37\nã¤ã¾ã‚Šã€fluentd-sidecar-gcp ã‚³ãƒ³ãƒ†ãƒŠã«éš£æ¥ã™ã‚‹ HTTPD ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹ Kubernetes Volumes ä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚Œã° HTTPD ã®ãƒ­ã‚°ãŒå–å¾—ã§ãã€Google Cloud Logging ã¸ãƒ­ã‚°ãŒè»¢é€ã§ãã¾ã™ã€‚\nã‚µãƒ³ãƒ—ãƒ«ã® Kubernetes YAML ä¸‹è¨˜ã«ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦ Kubernetes YAML ã‚’è¨˜ã—ã¾ã™ã€‚\napiVersion: v1 kind: Pod metadata: labels: run: my-nginx name: nginx-fluentd-logging-example spec: containers: - name: nginx-container image: nginx ports: - containerPort: 80 volumeMounts: - name: log-storage mountPath: /var/log/nginx - name: sidecar-log-collector image: gcr.io/google_containers/fluentd-sidecar-gcp:1.4 resources: limits: cpu: 100m memory: 200Mi env: - name: FILES_TO_COLLECT value: \u0026#34;/mnt/log/nginx/access.log /mnt/log/nginx/error.log\u0026#34; volumeMounts: - name: log-storage readOnly: true mountPath: /mnt/log/nginx volumes: - name: log-storage emptyDir: {} --- apiVersion: v1 kind: Service metadata: name: my-nginx labels: run: my-nginx spec: ports: - port: 80 protocol: TCP selector: run: my-nginx ç‰¹å¾´ã‚’ä¸‹è¨˜ã«è§£èª¬ã—ã¾ã™ã€‚\nnginx-container, sidecar-log-collector ã®ãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠãƒãƒƒãƒ‰ã§ã™ã€‚ sidecar-log-collector ã® image: ã¨ã—ã¦ã¯ gcr.io/google_containers/fluentd-sidecar-gcp:1.4 ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ \u0026rsquo;log-storage\u0026rsquo; ã¨ã—ã¦ nginx-container ã® /var/log/nginx ãŒ sidecar-log-collector ã® /mnt/log/nginx ã¨ã—ã¦å…±æœ‰ã•ã‚Œã¦ã„ã¾ã™ FILES_TO_COLLECT ã¨ã—ã¦å…±æœ‰ Volume ä¸Šã® access.log, error.log ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ çµæœã€Nginx ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°ãŒ Kubernetes Volume ã§ Google-Fluentd ã‚³ãƒ³ãƒ†ãƒŠã«èª­ã¿è¾¼ã¿å°‚ç”¨ã§å…±æœ‰ã•ã‚Œ (readOnly è¡Œ) ã€ã“ã® Google-Fluentd ã¯ç’°å¢ƒå¤‰æ•°ã§æ¸¡ã•ã‚ŒãŸ /mnt/log/nginx/access.log ã¨ /mnt/log/nginx/error.log ã‚’èª­ã¿è¾¼ã¿é–‹å§‹ã—ã€å†…å®¹ã‚’ Google Cloud Logging ã¸è»¢é€ã—ã¾ã™ã€‚\nãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³• ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ä¸‹è¨˜ã®é€šã‚Šå®Ÿæ–½ã—ã¾ã™ã€‚\n$ kubectl create -f \u0026lt;ä¸Šè¨˜ã®ãƒ•ã‚¡ã‚¤ãƒ«å\u0026gt; çµæœã¨ã¾ã¨ã‚ ãã‚Œãã‚Œã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ Tag ã‚’ Google-Fluentd ã§ä»˜ã‘ãŸå½¢ã§ Google Cloud Logging ã¸è»¢é€å‡ºæ¥ã¾ã—ãŸã€‚ãƒ­ã‚°æ¯ã«çµæœã‚’ Cloud Logging UI ä¸Šã§ç¢ºèªã§ãã¾ã™ã€‚ æœ¬æ¥ã€Docker ãªã®ã§æ¨™æº–å‡ºåŠ›ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã— Kubernetes ãŒãã®æ¨™æº–å‡ºåŠ›ã‚’ Cloud Logging ã¸è»¢é€ã—ã¦ãã‚Œã‚‹ã®ã§ã™ãŒã€ãã‚Œã ã¨ Tag ãŒä»˜ã‘ã‚‰ã‚Œãªã„ãŸã‚ã€ãƒ­ã‚°ã‚’åˆ†é›¢ã™ã‚‹ã®ãŒä¸€è‹¦åŠ´ã ã¨æ€ã„ã¾ã™ã€‚ã§ã™ãŒã€ä»Šå›ç´¹ä»‹ã—ãŸæ–¹æ³•ã§ã¯ Google-Fluentd ã§ Tag ã‚’ä»˜ã‘ã¦ãƒ­ã‚°è»¢é€å‡ºæ¥ãŸãŸã‚ã€ãã®å¿ƒé…ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚\nã“ã® Kubernetes Volumes ã¯ä»–ã«ã‚‚åˆ©ç”¨æ–¹æ³•ãŒã‚ã‚Šãã†ã§ã™ã€‚\næœ¬æ¥ã€GKE ã‚„ Kubernetes ã‚’åˆ©ç”¨ã•ã‚Œã‚‹æ–¹ã¯ Microservice Architecture ãŒæ¡ç”¨å‡ºæ¥ã¦ã„ã‚‹æ–¹ã€…ã ã¨æ€ã†ã®ã§ã™ãŒã€fluentd ã‚’ã‚¢ãƒ—ãƒªã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰åˆ†é›¢ã™ã‚‹ã®ã¯çµæ§‹æ‚©ã‚€ã¨ã“ã‚ã˜ã‚ƒãªã„ã‹ã¨æ€ã†ã®ã§ã€ä»Šå›ç´¹ä»‹ã—ãŸæ–¹æ³•ã¯ãã†è¨€ã£ãŸå ´åˆã«æœ‰ç”¨ã‹ã¨æ€ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/fluentd-sidecar-gcp/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ @jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ Kubernetes ã‚’ä½¿ã£ãŸæ§‹æˆã§ Google-Fluentd ã‚’ã©ã®ã‚³ãƒ³ãƒ†ãƒŠã«è¼‰ã›ã‚‹ã‹ï¼Ÿã£ã¦ã“ã¨ã‚’è€ƒãˆã¦ã¿ãŸã®ã§æ›¸ããŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eKubernetes ã¯ Docker ã‚’åˆ©ç”¨ã—ãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãªã®ã§ Docker ã¨åŒã˜ã \u0026ldquo;1ã‚³ãƒ³ãƒ†ãƒŠ, 1ãƒ—ãƒ­ã‚»ã‚¹\u0026rdquo; ã¨ã„ã†ãƒãƒªã‚·ãŒã‚ã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šã€ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®ãƒ—ãƒ­ã‚»ã‚¹ãŒåœæ­¢ã—ãŸã‚‰ Kubernetes ãŒãã‚Œã‚’æ¤œçŸ¥ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ãªãŠã—ã¦ãã‚Œã¾ã™ã€‚ã§ã™ãŒã€è¤‡æ•°ãƒ—ãƒ­ã‚»ã‚¹ã‚’1ã‚³ãƒ³ãƒ†ãƒŠã«ç¨¼åƒã•ã›ã‚‹ã¨ã€ãã‚ŒãŒå‡ºæ¥ã¾ã›ã‚“ã€‚ãã†ã¯è¨€ã£ã¦ã‚‚ä¸­ã«ã¯è¤‡æ•°ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¨¼åƒã•ã›ãŸã„å ´é¢ãŒã‚ã‚Šã¾ã™ã€‚ãã®å ´é¢ã¨ã—ã¦è€ƒãˆã‚‰ã‚Œã‚‹å…·ä½“çš„ãªä¾‹ã¨ã—ã¦ HTTPD ã‚µãƒ¼ãƒã®ãƒ­ã‚°ã‚’ Google-Fluentd ã‚’ä½¿ã£ã¦ GCP Cloud Logging ã«è»¢é€ã—ãŸã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ä¸Šè¨˜ã®ä¾‹ã‚’ fluentd-sidecar-gcp ã¨ kubernetes volumes ã‚’ä½¿ã£ã¦è§£æ±ºã™ã‚‹æ–¹æ³•ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆã®ã‚·ãƒŠãƒªã‚ª\"\u003eæ§‹æˆã®ã‚·ãƒŠãƒªã‚ª\u003c/h2\u003e\n\u003cp\u003eã‚·ãƒŠãƒªã‚ªã¨ã—ã¦ã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠãƒãƒƒãƒ‰ã‚’æ‰±ã†\u003c/li\u003e\n\u003cli\u003e1ã¤ã® Kubernetes Volumes ã‚’è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã§å…±æœ‰ã™ã‚‹\u003c/li\u003e\n\u003cli\u003eHTTPD ãƒ­ã‚°ã‚’ãã® Volume ã«å‡ºåŠ›\u003c/li\u003e\n\u003cli\u003eéš£æ¥ã™ã‚‹ Google-Fluentd ã‚³ãƒ³ãƒ†ãƒŠã§ãã® Volume ã«å‡ºåŠ›ã•ã‚ŒãŸãƒ­ã‚°ã‚’èª­ã¿è¾¼ã¿ãƒ­ã‚°è»¢é€\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"fluentd-sidecar-gcp-ã¨ã¯\"\u003efluentd-sidecar-gcp ã¨ã¯\u003c/h2\u003e\n\u003cp\u003eæ¬¡ã«èª¬æ˜ã™ã‚‹ã®ã¯ fluentd-sidecar-gcp ã®æ¦‚ç•¥ã§ã™ã€‚ã“ã‚Œã¯ Kubernetes ãŒ contrib ã§æ‰±ã£ã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã§ã™ã€‚ä¸‹è¨˜ã® URL ã«ã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/kubernetes/contrib/tree/master/logging/fluentd-sidecar-gcp\"\u003ehttps://github.com/kubernetes/contrib/tree/master/logging/fluentd-sidecar-gcp\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eGoogle-Fluentd ã‚’ç¨¼åƒã•ã›ã‚‹ Dockerfile ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€ä¸‹è¨˜ã®è¨˜è¿°ã‚’ç¢ºèªã™ã‚‹ã¨ã“ã®ã‚³ãƒ³ãƒ†ãƒŠã«ç’°å¢ƒå¤‰æ•° $FILES_TO_COLLECT ã‚’æ¸¡ã™ã¨ Google Fluentd ã§ãƒ­ã‚°ã‚’å–å¾—ã—ã¦ãã‚Œã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\u003c/p\u003e","title":"fluentd-sidecar-gcp ã¨ Kubernetes Volumes ã§ Cloud Logging ãƒ­ã‚°è»¢é€"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šå›ã¯ Google Cloud Platform ã® Google CloudCDN ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ãŸã®ã§è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nCloudCDN ã¯ GCP ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã«ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ã“ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã§ CloudCDN ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã‚‹ã¨ CDN ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ©Ÿèƒ½ã•ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚å…ˆã«æ›¸ã„ã¦ãŠãã¨ã“ã® CloudCDN ã¯ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§æ‰±ã„ã‚„ã™ã„ã‚µãƒ¼ãƒ“ã‚¹ã ã¨åˆ¤ã‚Šã¾ã—ãŸã€‚é«˜æ©Ÿèƒ½ãªä»–ã® CDN ã‚µãƒ¼ãƒ“ã‚¹ã¨æ¯”ã¹ã‚‹ã¨æ©Ÿèƒ½ãŒè¶³ã‚‰ãªã„æ„Ÿã‚ã‚Šã¾ã™ãŒã€å¿…è¦æœ€ä½é™ãªã¨ã“ã‚ã‚’æŠ‘ãˆã¦ã„ã‚‹ã®ã¨ã€ä¾¡æ ¼ãŒã¨ã¦ã‚‚å®‰ã„ã§ã™ã€‚(ä¾¡æ ¼ã¯ä¸‹è¨˜ã® URL å‚ç…§)\nä¾¡æ ¼è¡¨ : https://cloud.google.com/cdn/pricing\næ§‹æˆ æ§‹æˆã¨æ§‹æˆã®ç‰¹å¾´ã§ã™ã€‚\n+----------+ +---------+ | instance |--+ +-| EndUser | +----------+ | +------------+ +----------+ | +---------+ +--|LoadBalancer|--| CloudCDN |-+-| EndUser | +----------+ | +------------+ +----------+ | +---------+ | instance |--+ +-| EndUser | +----------+ +---------+ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒåˆã‚ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸå ´åˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹ã™ã‚‹ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹ã—ãŸéš›ã«è¿‘ãã«ã‚ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å–å¾—ã—ã‚ˆã†ã¨è©¦ã¿ã‚‹ è¿‘ãã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚ã‚‹å ´åˆã€æœ€åˆã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒé€ä¿¡ã•ã‚Œã‚‹ è¿‘ãã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒãªã„å ´åˆã€HTTP ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè»¢é€ã•ã‚Œã‚‹ ãã®å¾Œã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå¿œç­”ã™ã‚‹(ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ) ã‚­ãƒ£ãƒƒã‚·ãƒ¥é–“ã®ãƒ•ã‚£ãƒ«ã¯ EndUser ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œã˜ã¦å®Ÿè¡Œã•ã‚Œã‚‹ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’äº‹å‰ã«èª­ã¿è¾¼ã‚€ã“ã¨ã§ããªã„ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ä¸–ç•Œå„åœ°ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ CloudCDN ã‚’å°å…¥ã™ã‚‹æ–¹æ³• å°å…¥ã™ã‚‹æ–¹æ³•ã¯ç°¡å˜ã§ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\næ–°è¦ LB ã‚’ WebUI ã§ä½œæˆ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆ å³ãƒ‘ãƒãƒ«ã®ä¸‹ã«ã‚ã‚‹ [Cloud CDN ã‚’æœ‰åŠ¹ã«ã™ã‚‹] ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚ªãƒ³ã« ä½œæˆãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ HTTPD ã‚µãƒ¼ãƒå´ (ä»Šå›ã¯ Apache ã‚’ä½¿ã„ã¾ã™) ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«é–¢ã™ã‚‹è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚ ä¸‹è¨˜ã¯ä¾‹ã§ã™ã€‚3600ç§’ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã›ã‚‹è¨­å®šã«ãªã‚Šã¾ã™ã€‚\nHeader set Cache-control \u0026#34;public, max-age=3600\u0026#34; ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹æ¡ä»¶ã¯ RFC7324 ã«è¦å®šã•ã‚Œã¦ã„ã‚‹ã¨ãŠã‚Šã§ã™ã€‚\nç‰¹å®šã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã™ã‚‹æ–¹æ³• Google Cloud SDK https://cloud.google.com/sdk/ ã‚’ä½¿ã†ã¨ CLI ã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æŒ‡å®šã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢ãŒå‡ºæ¥ã¾ã™ã€‚ã¾ãŸ WebUI ã§ã‚‚ã‚¯ãƒªã‚¢ã¯å¯èƒ½ã§ã™ã€‚\n$ gcloud compute url-maps invalidate-cdn-cache \u0026lt;url-map ã®åå‰\u0026gt; --path \u0026#34;ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ‘ã‚¹\u0026#34; ã“ã®ã¨ãã« \u0026ndash;path ã§æŒ‡å®šã§ãã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¨˜ã—æ–¹ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚\n--path \u0026#34;/cat.png # \u0026lt;--- 1ã¤ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ --path \u0026#34;/*\u0026#34; # \u0026lt;--- å…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ --path \u0026#34;/pix/*\u0026#34; # \u0026lt;--- ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæŒ‡å®šã§å‰Šé™¤ ã¾ã¨ã‚ ä¾¡æ ¼ãŒä½ä¾¡æ ¼ã§å¿…è¦æœ€ä½é™ãªæ©Ÿèƒ½ã«çµã‚‰ã‚Œã¦ã„ã‚‹å°è±¡ã§ã™ã€‚ã‚·ãƒ³ãƒ—ãƒ«ãªåˆ†ã€ç†è§£ã—æ˜“ã„ã§ã™ã—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã«ã¤ã„ã¦ã‚‚ Hubot åŒ–ãªã©ã™ã‚Œã°é–‹ç™ºè€…ã®æ–¹ã«å®Ÿè¡Œã—ã¦ã‚‚ã‚‰ã„ã‚„ã™ã„ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚\n","permalink":"https://jedipunkz.github.io/post/cloud-cdn/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ Google Cloud Platform ã® Google CloudCDN ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ãŸã®ã§è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eCloudCDN ã¯ GCP ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã«ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ã“ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã§ CloudCDN ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã‚‹ã¨ CDN ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ©Ÿèƒ½ã•ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚å…ˆã«æ›¸ã„ã¦ãŠãã¨ã“ã® CloudCDN ã¯ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§æ‰±ã„ã‚„ã™ã„ã‚µãƒ¼ãƒ“ã‚¹ã ã¨åˆ¤ã‚Šã¾ã—ãŸã€‚é«˜æ©Ÿèƒ½ãªä»–ã® CDN ã‚µãƒ¼ãƒ“ã‚¹ã¨æ¯”ã¹ã‚‹ã¨æ©Ÿèƒ½ãŒè¶³ã‚‰ãªã„æ„Ÿã‚ã‚Šã¾ã™ãŒã€å¿…è¦æœ€ä½é™ãªã¨ã“ã‚ã‚’æŠ‘ãˆã¦ã„ã‚‹ã®ã¨ã€ä¾¡æ ¼ãŒã¨ã¦ã‚‚å®‰ã„ã§ã™ã€‚(ä¾¡æ ¼ã¯ä¸‹è¨˜ã® URL å‚ç…§)\u003c/p\u003e\n\u003cp\u003eä¾¡æ ¼è¡¨ : \u003ca href=\"https://cloud.google.com/cdn/pricing\"\u003ehttps://cloud.google.com/cdn/pricing\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eæ§‹æˆã¨æ§‹æˆã®ç‰¹å¾´ã§ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+----------+                                    +---------+\n| instance |--+                               +-| EndUser |\n+----------+  |  +------------+  +----------+ | +---------+\n              +--|LoadBalancer|--| CloudCDN |-+-| EndUser |\n+----------+  |  +------------+  +----------+ | +---------+\n| instance |--+                               +-| EndUser |\n+----------+                                    +---------+\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒåˆã‚ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸå ´åˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹ã™ã‚‹\u003c/li\u003e\n\u003cli\u003eã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹ã—ãŸéš›ã«è¿‘ãã«ã‚ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å–å¾—ã—ã‚ˆã†ã¨è©¦ã¿ã‚‹\u003c/li\u003e\n\u003cli\u003eè¿‘ãã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚ã‚‹å ´åˆã€æœ€åˆã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒé€ä¿¡ã•ã‚Œã‚‹\u003c/li\u003e\n\u003cli\u003eè¿‘ãã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒãªã„å ´åˆã€HTTP ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè»¢é€ã•ã‚Œã‚‹\u003c/li\u003e\n\u003cli\u003eãã®å¾Œã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå¿œç­”ã™ã‚‹(ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ)\u003c/li\u003e\n\u003cli\u003eã‚­ãƒ£ãƒƒã‚·ãƒ¥é–“ã®ãƒ•ã‚£ãƒ«ã¯ EndUser ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œã˜ã¦å®Ÿè¡Œã•ã‚Œã‚‹\u003c/li\u003e\n\u003cli\u003eã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’äº‹å‰ã«èª­ã¿è¾¼ã‚€ã“ã¨ã§ããªã„\u003c/li\u003e\n\u003cli\u003eã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ä¸–ç•Œå„åœ°ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"cloudcdn-ã‚’å°å…¥ã™ã‚‹æ–¹æ³•\"\u003eCloudCDN ã‚’å°å…¥ã™ã‚‹æ–¹æ³•\u003c/h2\u003e\n\u003cp\u003eå°å…¥ã™ã‚‹æ–¹æ³•ã¯ç°¡å˜ã§ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\u003c/p\u003e","title":"Google Cloud CDN ã‚’ä½¿ã£ã¦ã¿ãŸ"},{"content":"ã“ã‚“ã«ã¡ã¯ @jedipunkz ã§ã™ã€‚\nä»Šæ—¥ã¯æŸã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«å‚åŠ ã—ã¦ã„ã¦è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã¾ã™ã€‚ è¨˜äº‹ã ã‘å…ˆå‡ºã—ã—ã¡ã‚ƒã„ã¾ã™..ã€‚\nä»Šæ—¥ã¯æœ€è¿‘ coreos ãŒãƒªãƒªãƒ¼ã‚¹ã—ãŸ \u0026rsquo;etcd-operator\u0026rsquo; ã‚’è§¦ã£ã¦ã¿ã‚ˆã†ã‹ã¨æ€ã„ã¾ã™ã€‚ã»ã¼ã€README ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹æ‰‹é †é€šã‚Šã«å®Ÿæ–½ã™ã‚‹ã®ã§ã™ãŒã€æ‰€æ„Ÿã‚’äº¤ãˆãªãŒã‚‰ä½œæ¥­ã—ã¦è¨˜äº‹ã«ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\ncoreos ãŒæä¾›ã—ã¦ã„ã‚‹ etcd ã«ã¤ã„ã¦ã”å­˜çŸ¥ãªã„æ–¹ã‚‚ã„ã‚‰ã£ã—ã‚ƒã‚‹ã¨æ€ã„ã¾ã™ãŒ etcd ã¯ KVS ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã‚ã‚ŠãªãŒã‚‰ Configuration Management Store ã¨ã—ã¦åˆ©ç”¨ã§ãã‚‹åˆ†æ•£å‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã™ã€‚Docker ç­‰ã®ç’°å¢ƒã‚’æä¾›ã™ã‚‹ coreos ã¨ã„ã†è»½é‡ OS å†…ã§ã‚‚ etcd ãŒèµ·å‹•ã—ã¦ã„ã¦ã‚¯ãƒ©ã‚¹ã‚¿ã§ç®¡ç†ã•ã‚ŒãŸæƒ…å ±ã‚’ã‚¯ãƒ©ã‚¹ã‚¿å†…ã®å„ OS ãŒèª­ã¿æ›¸ãã§ãã‚‹ã€ã¨ã„ã£ãŸæ©Ÿèƒ½ã‚’ etcd ãŒæä¾›ã—ã¦ã„ã¾ã™ã€‚ è©³ç´°ã«ã¤ã„ã¦ã¯å…¬å¼ã‚µã‚¤ãƒˆã‚’å¾¡è¦§ãã ã•ã„ã€‚\netcd å…¬å¼ã‚µã‚¤ãƒˆ : https://coreos.com/etcd/docs/latest/\netcd-operator ã¯ã“ã® etcd ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ kubernetes ä¸Šã§ã‚¯ãƒ©ã‚¹ã‚¿ç®¡ç†ã™ã‚‹ãŸã‚ã®ç°¡å˜ã«é‹ç”¨ç®¡ç†ã™ã‚‹ãŸã‚ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ãªã‚Šã¾ã™ã€‚\netcd-operator å…¬å¼ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ : https://coreos.com/blog/introducing-the-etcd-operator.html\nå¾Œã«å®Ÿéš›ã«è§¦ã‚Œã¦ã„ãã¾ã™ãŒä¸‹è¨˜ã®ã‚ˆã†ãªç®¡ç†ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚\netcd ã‚¯ãƒ©ã‚¹ã‚¿ã®æ§‹ç¯‰ etcd ã‚¯ãƒ©ã‚¹ã‚¿ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—ãƒ»ãƒ€ã‚¦ãƒ³ etcd Pod ã®éšœå®³æ™‚è‡ªå‹•å¾©æ—§ etcd ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§æœ€æ–°ã®ãƒ¢ãƒã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ ã§ã¯æ—©é€Ÿåˆ©ç”¨ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nå¿…è¦ãªç’°å¢ƒ ä¸‹è¨˜ã®ç’°å¢ƒãŒäº‹å‰ã«ç”¨æ„ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nDocker Kubernetes or minikube+kubernetes (https://github.com/kubernetes/minikube) etcdctl : https://github.com/coreos/etcd/tree/master/etcdctl ä½œæ¥­æº–å‚™ ä¸‹è¨˜ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚\n$ git clone https://github.com/coreos/etcd-operator.git Operator ã®ãƒ‡ãƒ—ãƒ­ã‚¤ ä¸‹è¨˜ã®ã‚ˆã†ãªå†…å®¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¨˜ã•ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ä¸­èº«ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚\n$ cat example/deployment.yaml apiVersion: extensions/v1beta1 kind: Deployment metadata: name: etcd-operator spec: replicas: 1 template: metadata: labels: name: etcd-operator spec: containers: - name: etcd-operator image: quay.io/coreos/etcd-operator env: - name: MY_POD_NAMESPACE valueFrom: fieldRef: fieldPath: metadata.namespace kind: Deployment ã§ etcd-operator ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ãƒ¬ãƒ—ãƒªã‚«æ•°1ã®ãƒãƒƒãƒ‰ã‚’èµ·å‹•ã—ã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚å®Ÿéš›ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\n$ kubectl create -f example/deployment.yaml ã©ã‚“ãªãƒãƒƒãƒ‰ãŒèµ·å‹•ã—ãŸã‹ç¢ºèªã—ã¾ã™ã€‚\nkubectl get pods NAME READY STATUS RESTARTS AGE etcd-operator-217127005-futo0 1/1 Running 0 1m ã‚ã¨ã€ã“ã‚Œã¯è‡ªåˆ†ã‚‚çŸ¥ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒªã‚½ãƒ¼ã‚¹ã¨ã„ã†æ ãŒã‚ã‚‹ã‚‰ã—ãä¸‹è¨˜ã®ã‚ˆã†ã«ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\nkubectl get thirdpartyresources NAME DESCRIPTION VERSION(S) etcd-cluster.coreos.com Managed etcd clusters v1 replicaæ•°1 ã§ã™ãŒã€ãƒãƒƒãƒ‰ãªã®ã§ãƒãƒƒãƒ‰å†…ã®ãƒ—ãƒ­ã‚»ã‚¹ã«å•é¡ŒãŒã‚ã‚Œã° kubernetes ãŒè‡ªå‹•ã§ä¿®å¾© (å ´åˆã«ã‚ˆã£ã¦ãƒãƒƒãƒ‰ã®å†æ§‹ç¯‰) ã•ã‚Œã¾ã™ã€‚ã¾ãŸ replica æ•°ã‚’å¢—ã‚„ã™é‹ç”¨ã‚‚è€ƒãˆã‚‰ã‚Œãã†ã§ã™ã€‚\netcd ã‚¯ãƒ©ã‚¹ã‚¿ã®æ§‹ç¯‰ ä¸‹è¨˜ã®å†…å®¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ etcd ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚ä¸­èº«ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚ API ã¯ coreos.com/v1 ã§ kind: EtcdCluster ã¨ã„ã†æƒ…å ±ãŒè¨˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸ version ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¨˜ã•ã‚Œã¦ã„ã‚‹ã®ã‹ãªã¨ã„ã†ã“ã¨ãŒå¾Œã«ç¢ºèªã§ãã¾ã™ã€‚ã¾ãŸ size ã§ãƒ¬ãƒ—ãƒªã‚«æ•°ãŒè¨˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚\n$ cat example/example-etcd-cluster.yaml apiVersion: \u0026#34;coreos.com/v1\u0026#34; kind: \u0026#34;EtcdCluster\u0026#34; metadata: name: \u0026#34;etcd-cluster\u0026#34; spec: size: 3 version: \u0026#34;v3.1.0-alpha.1\u0026#34; ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ã—ã¦ã¿ã¾ã™ã€‚\n$ kubectl create -f example/example-etcd-cluster.yaml ã‚¯ãƒ©ã‚¹ã‚¿ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‹è¦‹ã¦ã¿ã¾ã™ã€‚3ã¤ã®ãƒãƒƒãƒ‰ãŒç¢ºèªã§ãã¾ã™ã€‚ã‚„ã¯ã‚Šãƒ•ã‚¡ã‚¤ãƒ«ä¸­ size: 3 ã¯ãƒ¬ãƒ—ãƒªã‚«æ•°ã ã£ãŸã‚ˆã†ã§ã™ã€‚\n$ kubectl get pods --show-all NAME READY STATUS RESTARTS AGE etcd-cluster-0000 1/1 Running 0 1m etcd-cluster-0001 1/1 Running 0 36s etcd-cluster-0002 1/1 Running 0 21s åŒæ§˜ã« Service ã«ã¤ã„ã¦ç¢ºèªã—ã¾ã™ã€‚etcd-cluster-000[012] ã®3ã¤ãŒä»Šå›ä½œã£ãŸ etcd ã‚¯ãƒ©ã‚¹ã‚¿ã§ã™ã€‚\n$ kubectl get svc NAME CLUSTER-IP EXTERNAL-IP PORT(S) AGE etcd-cluster 10.0.0.80 \u0026lt;none\u0026gt; 2379/TCP 1m etcd-cluster-0000 10.0.0.13 \u0026lt;none\u0026gt; 2380/TCP,2379/TCP 1m etcd-cluster-0001 10.0.0.111 \u0026lt;none\u0026gt; 2380/TCP,2379/TCP 1m etcd-cluster-0002 10.0.0.183 \u0026lt;none\u0026gt; 2380/TCP,2379/TCP 50s kubernetes 10.0.0.1 \u0026lt;none\u0026gt; 443/TCP 5d etcd ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ ã§ã¯ etcd ã‚¯ãƒ©ã‚¹ã‚¿ã®ãƒ¬ãƒ—ãƒªã‚«æ•°ã‚’å¢—ã‚„ã™ã“ã¨ã§ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã—ã¦ã¿ã¾ã™ã€‚ãŒã€ä»Šç¾åœ¨ (2016/12) æ™‚ç‚¹ã§ã¯ä¸€éƒ¨ä¸å…·åˆãŒã‚ã‚‹ã‚‰ã—ãå›é¿ç­–ã¨ã—ã¦ä¸‹è¨˜ã®é€šã‚Š curl ã‚’ç”¨ã„ã¦ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ãªã‚ˆã†ã§ã™ã€‚\nä¸‹è¨˜ã®å†…å®¹ã§ body.json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚size: 5 ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¦ã€ãƒ¬ãƒ—ãƒªã‚«æ•°5ã«ãªã‚‹ã®ã ãªã¨åˆ¤æ–­ã§ãã¾ã™ã€‚\n$ cat body.json { \u0026#34;apiVersion\u0026#34;: \u0026#34;coreos.com/v1\u0026#34;, \u0026#34;kind\u0026#34;: \u0026#34;EtcdCluster\u0026#34;, \u0026#34;metadata\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;etcd-cluster\u0026#34;, \u0026#34;namespace\u0026#34;: \u0026#34;default\u0026#34; }, \u0026#34;spec\u0026#34;: { \u0026#34;size\u0026#34;: 5 } } ã“ã“ã§ curl ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ãƒ—ãƒ­ã‚­ã‚·ã‚’ç¨¼åƒã—ã¾ã™ã€‚\n$ kubectl proxy --port=8080 curl ã§å…ˆç¨‹ä½œã£ãŸ body.json ã‚’ PUT ã—ã¦ã¿ã¾ã™ã€‚\ncurl -H \u0026#39;Content-Type: application/json\u0026#39; -X PUT --data @body.json http://127.0.0.1:8080/apis/coreos.com/v1/namespaces/default/etcdclusters/etcd-cluster ã‚¯ãƒ©ã‚¹ã‚¿ãŒã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã•ã‚ŒãŸã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚\nkubectl get pods --show-all NAME READY STATUS RESTARTS AGE etcd-cluster-0000 1/1 Running 0 5m etcd-cluster-0001 1/1 Running 0 4m etcd-cluster-0002 1/1 Running 0 4m etcd-cluster-0003 1/1 Running 0 32s etcd-cluster-0004 1/1 Running 0 17s etcd-operator-217127005-futo0 1/1 Running 0 9m 5å°æ§‹æˆã®ã‚¯ãƒ©ã‚¹ã‚¿ã«ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã—ãŸã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚\netcd ã«ã‚¢ã‚¯ã‚»ã‚¹ 5å°æ§‹æˆã® etcd ã‚¯ãƒ©ã‚¹ã‚¿ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã§ããŸã®ã§ etcd ã« etcdctl ã‚’ä½¿ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚äº‹å‰ã« etcdctl ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸç§ã®ç’°å¢ƒã‚‚ãã†ã ã£ãŸã®ã§ã™ãŒãƒ­ãƒ¼ã‚«ãƒ«ã® Mac ã« minikube ã‚’ä½¿ã£ã¦ kubernetes ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹ã®ã§ä¸‹è¨˜ã®ã‚ˆã†ã« nodePort ã‚’ä½œã‚‹ãŸã‚ä½œæ¥­ãŒå¿…è¦ã§ã™ã€‚\n$ kubectl create -f example/example-etcd-cluster-nodeport-service.json $ export ETCDCTL_API=3 $ export ETCDCTL_ENDPOINTS=$(minikube service etcd-cluster-client-service --url) $ etcdctl put foo bar $ etcdctl get foo foo bar etcdctl ã§ã‚­ãƒ¼ãƒ»å€¤ã‚’å…¥åŠ›ãƒ»èª­ã¿è¾¼ã¿ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸï¼\nãƒãƒƒãƒ‰ã®è‡ªå‹•å¾©æ—§ kubernetes ã‚’æ™®æ®µä½¿ã£ã¦ã„ã‚‹æ–¹ã¯åˆ†ã‹ã‚‹ã¨æ€ã†ã®ã§ã™ãŒãƒãƒƒãƒ‰ã‚’è½ã¨ã—ã¦ã‚‚ kubernetes ãŒè‡ªå‹•å¾©æ—§ã—ã¦ãã‚Œã¾ã™ã€‚ã“ã“ã§ä¸€ã¤ãƒãƒƒãƒ‰ã‚’å‰Šé™¤ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\n$kubectl get pods NAME READY STATUS RESTARTS AGE etcd-cluster-0000 1/1 Running 0 11m etcd-cluster-0001 1/1 Running 0 11m etcd-cluster-0002 1/1 Running 0 11m etcd-cluster-0003 1/1 Running 0 6m etcd-cluster-0004 1/1 Running 0 6m etcd-operator-217127005-futo0 1/1 Running 0 16m $kubect delete pod etcd-cluster-0004 ã—ã°ã‚‰ãã™ã‚‹ã¨ä¸‹è¨˜ã®é€šã‚Š etcd-cluster-0004 ã«ä»£ã‚ã‚Š etcd-cluster-0005 ãŒç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\n$ kubectl get pods NAME READY STATUS RESTARTS AGE etcd-cluster-0000 1/1 Running 0 12m etcd-cluster-0001 1/1 Running 0 12m etcd-cluster-0002 1/1 Running 0 11m etcd-cluster-0003 1/1 Running 0 7m etcd-cluster-0005 1/1 Running 0 3s etcd-operator-217127005-futo0 1/1 Running 0 17m ã¾ã¨ã‚ kubernetes ã®ä¸Šã§æ§‹æˆã™ã‚‹ã“ã¨ã§ã†ã¾ã kubernetes ã®ãƒ¡ãƒªãƒƒãƒˆã‚’æ´»ã‹ã—ã¤ã¤ etcd ã‚¯ãƒ©ã‚¹ã‚¿ã‚’æ§‹æˆã§ãã¦ã„ã‚‹ã¨è¨€ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚è¨˜äº‹åŸ·ç­†æ™‚ã§ã¯ã¾ã ä¸å…·åˆãŒå¹¾ã¤ã‹ã‚ã‚Šã¾ã—ãŸ (ä¸Šè¨˜ã® curl ã§å®Ÿæ–½ã—ãŸç®‡æ‰€ã‚„ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰) ãŒã€etcd ã‚’æ‰‹å‹•ã§æ§‹ç¯‰ã™ã‚‹ã‚ˆã‚Š kubernetes ã§æ§‹æˆã™ã‚‹ã»ã†ãŒãƒ¡ãƒªãƒƒãƒˆãŒå¤šã„ã“ã¨ã¯æ˜ã‚‰ã‹ã§ã™ã€‚ã¾ãŸ kubernetes ã®ãƒãƒƒãƒ‰ã‹ã‚‰ kubernetes dns ã‚’ä»‹ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒ¼ãƒ ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã®ã§ãƒãƒƒãƒ‰ã‹ã‚‰ etcd ã«æƒ…å ±ã‚’èª­ã¿æ›¸ãã™ã‚‹ã“ã¨ã‚‚å®¹æ˜“ã«ãªã‚Šãã†ã§ã™ã€‚\nã§ã™ãŒ etcd ã«åã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã®æ€§è³ªã«ã‚ˆã£ã¦ã¯é‹ç”¨é¢ã§å³ã—ããªã‚‹ã“ã¨ã‚‚æƒ³å®šã§ãã¾ã™ã€‚coreos å†…ã§ etcd ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ä»‹ã—ã¦äº’ã„ã®ã‚³ãƒ³ãƒ†ãƒŠé–“ã§ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚’å…±æœ‰ã—åˆã†ä½¿ã„æ–¹ã¯éå¸¸ã«æ„å‘³ãŒã‚ã‚‹ã¨æ€ã†ã®ã§ã™ãŒã€coreos å¤–ã®ç‹¬è‡ªã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒã„ã‚ã‚“ãªç¨®åˆ¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’ etcd ã‚¯ãƒ©ã‚¹ã‚¿ã«å¤–ã‹ã‚‰å…¥å‡ºåŠ›ã™ã‚‹ã“ã¨ã®æ„å‘³ã¯ãã‚Œã»ã©ç„¡ã„ã‚ˆã†ã«æ€ãˆã¾ã™ã€‚ã§ã‚ã‚Œã°é«˜è€ä¹…æ€§ã§é‹ç”¨ã®ã—æ˜“ã„è»½é‡ãª KVS ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä½¿ã†ã¹ãã ã‹ã‚‰ã§ã™ã€‚\nã¾ãŸä»Šå›ç´¹ä»‹ã—ãŸ etcd-operator ã¨ã¯åˆ¥ã« coreos ãŒåŒæ™‚ã«ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã—ãŸ(https://coreos.com/blog/the-prometheus-operator.html) ã«é–¢ã—ã¦ã‚‚èˆˆå‘³ã‚’æŒã£ã¦ã„ã‚‹ã®ã§å¾Œã«è§¦ã£ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nä½•ã¨è¨€ã†ã‹æ‰€æ„Ÿã¨ã—ã¦æœ€å¾Œã«è¿°ã¹ã‚‹ã¨ã‚µãƒ¼ãƒãƒ¬ã‚¹ãŒå«ã°ã‚Œã¦ã„ã‚‹ä¸­ã§ã‚ã–ã‚ã–ã‚¯ãƒ©ã‚¹ã‚¿ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’è‡ªå‰ã§ç®¡ç†ã™ã‚‹ã®ã‹ï¼Ÿã¨ç–‘å•ã‚‚ç¢ºã‹ã«æ®‹ã‚Šã¾ã™ã€‚ãã‚Œã“ãã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãŒæä¾›ã™ã¹ãæ©Ÿèƒ½ã ã¨æ€ã†ã‹ã‚‰ã§ã™..ã€‚\n","permalink":"https://jedipunkz.github.io/post/etcd-operator/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ @jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šæ—¥ã¯æŸã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«å‚åŠ ã—ã¦ã„ã¦è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã¾ã™ã€‚\nè¨˜äº‹ã ã‘å…ˆå‡ºã—ã—ã¡ã‚ƒã„ã¾ã™..ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šæ—¥ã¯æœ€è¿‘ coreos ãŒãƒªãƒªãƒ¼ã‚¹ã—ãŸ \u0026rsquo;etcd-operator\u0026rsquo; ã‚’è§¦ã£ã¦ã¿ã‚ˆã†ã‹ã¨æ€ã„ã¾ã™ã€‚ã»ã¼ã€README ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹æ‰‹é †é€šã‚Šã«å®Ÿæ–½ã™ã‚‹ã®ã§ã™ãŒã€æ‰€æ„Ÿã‚’äº¤ãˆãªãŒã‚‰ä½œæ¥­ã—ã¦è¨˜äº‹ã«ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003ecoreos ãŒæä¾›ã—ã¦ã„ã‚‹ etcd ã«ã¤ã„ã¦ã”å­˜çŸ¥ãªã„æ–¹ã‚‚ã„ã‚‰ã£ã—ã‚ƒã‚‹ã¨æ€ã„ã¾ã™ãŒ etcd ã¯ KVS ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã‚ã‚ŠãªãŒã‚‰ Configuration Management Store ã¨ã—ã¦åˆ©ç”¨ã§ãã‚‹åˆ†æ•£å‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã™ã€‚Docker ç­‰ã®ç’°å¢ƒã‚’æä¾›ã™ã‚‹ coreos ã¨ã„ã†è»½é‡ OS å†…ã§ã‚‚ etcd ãŒèµ·å‹•ã—ã¦ã„ã¦ã‚¯ãƒ©ã‚¹ã‚¿ã§ç®¡ç†ã•ã‚ŒãŸæƒ…å ±ã‚’ã‚¯ãƒ©ã‚¹ã‚¿å†…ã®å„ OS ãŒèª­ã¿æ›¸ãã§ãã‚‹ã€ã¨ã„ã£ãŸæ©Ÿèƒ½ã‚’ etcd ãŒæä¾›ã—ã¦ã„ã¾ã™ã€‚\nè©³ç´°ã«ã¤ã„ã¦ã¯å…¬å¼ã‚µã‚¤ãƒˆã‚’å¾¡è¦§ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cp\u003eetcd å…¬å¼ã‚µã‚¤ãƒˆ : \u003ca href=\"https://coreos.com/etcd/docs/latest/\"\u003ehttps://coreos.com/etcd/docs/latest/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eetcd-operator ã¯ã“ã® etcd ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ kubernetes ä¸Šã§ã‚¯ãƒ©ã‚¹ã‚¿ç®¡ç†ã™ã‚‹ãŸã‚ã®ç°¡å˜ã«é‹ç”¨ç®¡ç†ã™ã‚‹ãŸã‚ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eetcd-operator å…¬å¼ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ : \u003ca href=\"https://coreos.com/blog/introducing-the-etcd-operator.html\"\u003ehttps://coreos.com/blog/introducing-the-etcd-operator.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eå¾Œã«å®Ÿéš›ã«è§¦ã‚Œã¦ã„ãã¾ã™ãŒä¸‹è¨˜ã®ã‚ˆã†ãªç®¡ç†ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eetcd ã‚¯ãƒ©ã‚¹ã‚¿ã®æ§‹ç¯‰\u003c/li\u003e\n\u003cli\u003eetcd ã‚¯ãƒ©ã‚¹ã‚¿ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—ãƒ»ãƒ€ã‚¦ãƒ³\u003c/li\u003e\n\u003cli\u003eetcd Pod ã®éšœå®³æ™‚è‡ªå‹•å¾©æ—§\u003c/li\u003e\n\u003cli\u003eetcd ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§æœ€æ–°ã®ãƒ¢ãƒã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã§ã¯æ—©é€Ÿåˆ©ç”¨ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å¿…è¦ãªç’°å¢ƒ\"\u003eå¿…è¦ãªç’°å¢ƒ\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®ç’°å¢ƒãŒäº‹å‰ã«ç”¨æ„ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDocker\u003c/li\u003e\n\u003cli\u003eKubernetes or minikube+kubernetes (\u003ca href=\"https://github.com/kubernetes/minikube\"\u003ehttps://github.com/kubernetes/minikube\u003c/a\u003e)\u003c/li\u003e\n\u003cli\u003eetcdctl : \u003ca href=\"https://github.com/coreos/etcd/tree/master/etcdctl\"\u003ehttps://github.com/coreos/etcd/tree/master/etcdctl\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ä½œæ¥­æº–å‚™\"\u003eä½œæ¥­æº–å‚™\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e$ git clone https://github.com/coreos/etcd-operator.git\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"operator-ã®ãƒ‡ãƒ—ãƒ­ã‚¤\"\u003eOperator ã®ãƒ‡ãƒ—ãƒ­ã‚¤\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®ã‚ˆã†ãªå†…å®¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¨˜ã•ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ä¸­èº«ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚\u003c/p\u003e","title":"coreos ã® etcd operator ã‚’è§¦ã£ã¦ã¿ãŸ"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šå›ã¯ Helm ã¨ã„ã† kubernetes ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£çš„ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä½¿ã£ã¦ã¿ãŸã®ã§è¨˜äº‹ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nå…¬å¼ã‚µã‚¤ãƒˆ : https://helm.sh/ Kubernetes ã‚’ä»•äº‹ã§ä½¿ã£ã¦ã„ã‚‹ã®ã§ã™ãŒ \u0026ldquo;ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©\u0026rdquo; ã‚„ \u0026ldquo;ã‚µãƒ¼ãƒ“ã‚¹\u0026rdquo; ã¨ã„ã£ãŸå˜ä½ã‚’ä½¿ã£ã¦ Pod, Service ã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚Helm ã‚’ä½¿ã†ã“ã¨ã§ã“ã‚Œã‚‰ã®ç®¡ç†æ–¹æ³•ãŒå¤‰ã‚ã‚‹ã®ã‹èª¿ã¹ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nä¾å­˜ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ ä»Šå›ã¯ MacOS ã‚’ä½¿ã£ã¦ç’°å¢ƒã‚’æ•´ãˆã¾ã™ã€‚\nvirtualbox minikube kubectl ã“ã‚Œã‚‰ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚\n$ brew cask install virtualbo $ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.12.2/minikube-darwin-amd64 \u0026amp;\u0026amp; chmod +x minikube \u0026amp;\u0026amp; sudo mv minikube /usr/local/bin/ $ brew install kubectl minikube ã‚’ä½¿ã£ã¦ç°¡æ˜“çš„ãª kubernetes ç’°å¢ƒã‚’èµ·å‹•ã—ã¾ã™ã€‚\n$ minikube start $ eval $(minikube docker-env) Helm ã‚’ä½¿ã£ã¦ã¿ã‚‹ Helm ã¯ Charts ã¨ã„ã†å˜ä½ã§ Kubernetes ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ã—ã¾ã™ã€‚Charts ã®ä¸€è¦§ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\n$ helm search NAME VERSION DESCRIPTION stable/drupal 0.3.7 One of the most versatile open source content m... stable/factorio 0.1.1 Factorio dedicated server. stable/ghost 0.4.0 A simple, powerful publishing platform that all... stable/jenkins 0.1.1 A Jenkins Helm chart for Kubernetes. stable/joomla 0.4.0 PHP content management system (CMS) for publish... stable/mariadb 0.5.3 Chart for MariaDB stable/mediawiki 0.4.0 Extremely powerful, scalable software and a fea... stable/memcached 0.4.0 Chart for Memcached stable/minecraft 0.1.0 Minecraft server stable/mysql 0.2.1 Chart for MySQL stable/phpbb 0.4.0 Community forum that supports the notion of use... stable/postgresql 0.2.0 Chart for PostgreSQL stable/prometheus 1.3.1 A Prometheus Helm chart for Kubernetes. Prometh... stable/redis 0.4.1 Chart for Redis stable/redmine 0.3.5 A flexible project management web application. stable/spark 0.1.1 A Apache Spark Helm chart for Kubernetes. Apach... stable/spartakus 1.0.0 A Spartakus Helm chart for Kubernetes. Spartaku... stable/testlink 0.4.0 Web-based test management system that facilitat... stable/traefik 1.1.0-rc3-a A Traefik based Kubernetes ingress controller w... stable/uchiwa 0.1.0 Dashboard for the Sensu monitoring framework stable/wordpress 0.3.2 Web publishing platform for building blogs and ... å„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åå‰ã§ Charts ãŒç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ ã“ã“ã§ã¯ stable/mysql ã‚’ä½¿ã£ã¦ kubernetes ã®ä¸­ã« MySQL ç’°å¢ƒã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚ã¾ãš stable/mysql ã«è¨­å®šã§ãã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚\n$ helm inspect stable/mysql Fetched stable/mysql to mysql-0.2.1.tgz description: Chart for MySQL engine: gotpl home: https://www.mysql.com/ keywords: - mysql - database - sql maintainers: - email: viglesias@google.com name: Vic Iglesias name: mysql sources: - https://github.com/kubernetes/charts - https://github.com/docker-library/mysql version: 0.2.1 --- ## mysql image version ## ref: https://hub.docker.com/r/library/mysql/tags/ ## imageTag: \u0026#34;5.7.14\u0026#34; ## Specify password for root user ## ## Default: random 10 character string # mysqlRootPassword: testing ## Create a database user ## # mysqlUser: # mysqlPassword: ## Allow unauthenticated access, uncomment to enable ## # mysqlAllowEmptyPassword: true ## Create a database ## # mysqlDatabase: ## Specify a imagePullPolicy ## \u0026#39;Always\u0026#39; if imageTag is \u0026#39;latest\u0026#39;, else set to \u0026#39;IfNotPresent\u0026#39; ## ref: http://kubernetes.io/docs/user-guide/images/#pre-pulling-images ## # imagePullPolicy: ## Persist data to a persitent volume persistence: enabled: true storageClass: generic accessMode: ReadWriteOnce size: 8Gi ## Configure resource requests and limits ## ref: http://kubernetes.io/docs/user-guide/compute-resources/ ## resources: requests: memory: 256Mi cpu: 100m stable/mysql ã¨ã„ã† Charts ã‚’æ§‹æˆã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸€è¦§ãŒå–å¾—ã§ãã¾ã—ãŸã€‚ä»Šå›ã¯ DB ä¸Šã®ãƒ¦ãƒ¼ã‚¶ã‚’ä½œã£ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚ä¸Šè¨˜ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä¸­ã‹ã‚‰ \u0026lsquo;mysqlUser\u0026rsquo;, \u0026lsquo;mysqlPasswword\u0026rsquo; ã‚’ç·¨é›†ã—ã¦ã¿ã¾ã™ã€‚ä¸‹è¨˜ã®å†…å®¹ã‚’ config.yaml ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã§ä¿å­˜ã—ã¾ã™ã€‚\nmysqlUser: user1 mysqlPassword: password1 ã“ã® config.yaml ã‚’ä½¿ã£ã¦ stable/mysql ã‚’èµ·å‹•ã—ã¦ã¿ã¾ã™ã€‚\n$ helm install -f config.yaml stable/mysql $ helm ls # \u0026lt;--- èµ·å‹•ã—ãŸç’°å¢ƒã‚’ç¢ºèªã™ã‚‹ NAME REVISION UPDATED STATUS CHART dealing-ladybug 1 Sun Nov 20 10:44:00 2016 DEPLOYED mysql-0.2.1 \u0026lsquo;dealing-ladybug\u0026rsquo; ã¨ã„ã†åå‰ã§ mysql ãŒèµ·å‹•ã—ãŸã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\nkubectl ã‚’ã¤ã‹ã£ã¦ Services ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚\n$ kubectl get svc NAME CLUSTER-IP EXTERNAL-IP PORT(S) AGE dealing-ladybug-mysql 10.0.0.24 \u0026lt;none\u0026gt; 3306/TCP 33m \u0026lsquo;dealing-ladybug-mysql\u0026rsquo; ã¨ã„ã† Service ãŒ kubernetes ç’°å¢ƒã«ä½œã‚‰ã‚Œã¾ã—ãŸã€‚ã“ã®åå‰ã¯ Kubernetes å†…ã®ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ DNS åå‰è§£æ±ºã§ãã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãªã‚Šã¾ã™ã€‚\nã“ã“ã§ mysql-client ç’°å¢ƒã‚’ä½œã‚‹ãŸã‚ã«ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¦ mysql-client ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€config.yaml ã§ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ mysql ã‚µãƒ¼ãƒã«ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèªã—ã¾ã™ã€‚\n$ kubectl run -i --tty ubuntu02 --image=ubuntu:16.04 --restart=Never -- bash -il # apt-get update; apt-get install -y mysql-client # mysql -h dealing-ladybug-mysql -u user1 -ppassword1 \u0026lt;çœç•¥\u0026gt; mysql\u0026gt; config.yaml ã«è¨˜ã—ãŸãƒ¦ãƒ¼ã‚¶æƒ…å ±ã§ MySQL ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚\nã¾ã¨ã‚ Helm ã‚’ä½¿ã†ã“ã¨ã§ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç›´æ¥ yaml ã§ä½œã‚‰ãªãã¦ã‚‚ MySQL ç’°å¢ƒæ§‹ç¯‰ã¨è¨­å®šãŒè¡Œãˆã¾ã—ãŸã€‚Helm ã® Charts ã¯è‡ªåˆ†ã§é–‹ç™ºã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚(å‚è€ƒ URL)\nhttps://github.com/kubernetes/helm/blob/master/docs/charts.md\nãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§ä»–äººã®ä½œã£ãŸè³‡æºã‚’æœ‰ç”¨ã«æ´»ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ãŸã‚ã€ã“ã†ã„ã£ãŸä½•ã‹ã‚’æŠ½è±¡åŒ–ã™ã‚‹æŠ€è¡“ã‚’æ¡ç”¨ã™ã‚‹ã“ã¨ã«ã¯ã¨ã¦ã‚‚æ„å‘³ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚è‡ªå‹•åŒ–ã‚’è€ƒãˆã‚‹ä¸Šã§ã‚‚æŠ½è±¡åŒ–ã§ãã‚‹æŠ€è¡“ã¯æœ‰ç”¨ã ã¨æ€ã„ã¾ã™ã€‚\nã§ã™ãŒãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚’ä½¿ã£ã¦ã‚‚ Helm ã§ã‚‚ Yaml ã§ç®¡ç†ã™ã‚‹ã“ã¨ã«å¤‰ã‚ã‚Šã¯ãªãã€ã¾ãŸãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã§æŒ‡å®šã§ãã‚‹è©³ç´°ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ (replicas ã‚„ command, image ãªã©) ã‚’æŒ‡å®šã§ããªã„ãŸã‚ã™ãã«å®Ÿç”¨ã™ã‚‹ã¨ã„ã†ã‚ã‘ã«ã¯ã„ã‹ãªã„ãªãã¨æ„Ÿã˜ã¾ã—ãŸã€‚\nå‚è€ƒ URL https://github.com/kubernetes/helm/blob/master/docs/charts.md https://github.com/kubernetes/helm/blob/master/docs/quickstart.md ","permalink":"https://jedipunkz.github.io/post/helm/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ Helm ã¨ã„ã† kubernetes ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£çš„ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä½¿ã£ã¦ã¿ãŸã®ã§è¨˜äº‹ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå…¬å¼ã‚µã‚¤ãƒˆ : \u003ca href=\"https://helm.sh/\"\u003ehttps://helm.sh/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eKubernetes ã‚’ä»•äº‹ã§ä½¿ã£ã¦ã„ã‚‹ã®ã§ã™ãŒ \u0026ldquo;ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©\u0026rdquo; ã‚„ \u0026ldquo;ã‚µãƒ¼ãƒ“ã‚¹\u0026rdquo; ã¨ã„ã£ãŸå˜ä½ã‚’ä½¿ã£ã¦ Pod, Service ã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚Helm ã‚’ä½¿ã†ã“ã¨ã§ã“ã‚Œã‚‰ã®ç®¡ç†æ–¹æ³•ãŒå¤‰ã‚ã‚‹ã®ã‹èª¿ã¹ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¾å­˜ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢\"\u003eä¾å­˜ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢\u003c/h2\u003e\n\u003cp\u003eä»Šå›ã¯ MacOS ã‚’ä½¿ã£ã¦ç’°å¢ƒã‚’æ•´ãˆã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003evirtualbox\u003c/li\u003e\n\u003cli\u003eminikube\u003c/li\u003e\n\u003cli\u003ekubectl\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã“ã‚Œã‚‰ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e$ brew cask install virtualbo\n$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.12.2/minikube-darwin-amd64 \u0026amp;\u0026amp; chmod +x minikube \u0026amp;\u0026amp; sudo mv minikube /usr/local/bin/\n$ brew install kubectl\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eminikube ã‚’ä½¿ã£ã¦ç°¡æ˜“çš„ãª kubernetes ç’°å¢ƒã‚’èµ·å‹•ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e$ minikube start\n$ eval $(minikube docker-env)\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"helm-ã‚’ä½¿ã£ã¦ã¿ã‚‹\"\u003eHelm ã‚’ä½¿ã£ã¦ã¿ã‚‹\u003c/h2\u003e\n\u003cp\u003eHelm ã¯ Charts ã¨ã„ã†å˜ä½ã§ Kubernetes ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ã—ã¾ã™ã€‚Charts ã®ä¸€è¦§ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e$ helm search\nNAME                    VERSION         DESCRIPTION\nstable/drupal           0.3.7           One of the most versatile open source content m...\nstable/factorio         0.1.1           Factorio dedicated server.\nstable/ghost            0.4.0           A simple, powerful publishing platform that all...\nstable/jenkins          0.1.1           A Jenkins Helm chart for Kubernetes.\nstable/joomla           0.4.0           PHP content management system (CMS) for publish...\nstable/mariadb          0.5.3           Chart for MariaDB\nstable/mediawiki        0.4.0           Extremely powerful, scalable software and a fea...\nstable/memcached        0.4.0           Chart for Memcached\nstable/minecraft        0.1.0           Minecraft server\nstable/mysql            0.2.1           Chart for MySQL\nstable/phpbb            0.4.0           Community forum that supports the notion of use...\nstable/postgresql       0.2.0           Chart for PostgreSQL\nstable/prometheus       1.3.1           A Prometheus Helm chart for Kubernetes. Prometh...\nstable/redis            0.4.1           Chart for Redis\nstable/redmine          0.3.5           A flexible project management web application.\nstable/spark            0.1.1           A Apache Spark Helm chart for Kubernetes. Apach...\nstable/spartakus        1.0.0           A Spartakus Helm chart for Kubernetes. Spartaku...\nstable/testlink         0.4.0           Web-based test management system that facilitat...\nstable/traefik          1.1.0-rc3-a     A Traefik based Kubernetes ingress controller w...\nstable/uchiwa           0.1.0           Dashboard for the Sensu monitoring framework\nstable/wordpress        0.3.2           Web publishing platform for building blogs and ...\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eå„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åå‰ã§ Charts ãŒç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\nã“ã“ã§ã¯ stable/mysql ã‚’ä½¿ã£ã¦ kubernetes ã®ä¸­ã« MySQL ç’°å¢ƒã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚ã¾ãš stable/mysql ã«è¨­å®šã§ãã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚\u003c/p\u003e","title":"Helm ã‚’ä½¿ã£ã¦ Kubernetes ã‚’ç®¡ç†ã™ã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€@jedipunkz ã§ã™ã€‚ä»Šå›ã¯ Kubernetes1.4 ã‹ã‚‰å®Ÿè£…ã•ã‚ŒãŸ ScheduledJob ã‚’è©¦ã—ã¦ã¿ãŸã®ã§ãã®å†…å®¹ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nScheduledJob ã¯ãƒãƒƒãƒçš„ãªå‡¦ç†ã‚’ Kubernetes ã® pod ã‚’ä½¿ã£ã¦å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã§ã™ã€‚ç¾åœ¨ã¯ alpha ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚ kubernetes ã® pod, service ã¯é€šå¸¸ã€æ°¸ç¶šçš„ã«ç«‹ã¡ä¸Šã’ã¦ãŠãã‚µãƒ¼ãƒãªã©ã‚’ç¨¼åƒã•ã›ã‚‹ã‚‚ã®ã§ã™ãŒã€ãã‚Œã«å¯¾ã—ã¦ã“ã® scheduledJob ã¯ cron æ„Ÿè¦šã§ãƒãƒƒãƒå‡¦ç†ã‚’ pod ã«ä»»ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\nAlpha ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã„ã†ã“ã¨ã§ä»Šå›ã®ç’°å¢ƒæ§‹ç¯‰ã¯ minikube ã‚’ä½¿ã£ã¦ç°¡æ˜“çš„ã« Mac ä¸Šã«æ§‹ç¯‰ã—ã¾ã—ãŸã€‚Docker ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚Œã° Linux ã§ã‚‚ç’°å¢ƒã‚’ä½œã‚Œã¾ã™ã€‚\nå‚è€ƒ URL ä»Šå›åˆ©ç”¨ã™ã‚‹ yaml ãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã¯ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚\nhttp://kubernetes.io/docs/user-guide/scheduled-jobs/ https://github.com/kubernetes/minikube å‰æã®ç’°å¢ƒ ç§ã®ç’°å¢ƒã§ã¯ä¸‹è¨˜ã®ç’°å¢ƒã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚\nMac OSX Docker-machine or Docker for Mac minikube kubernetes 1.4 ä»¥é™ã®æ§‹æˆã‚’ minikube ã§æ§‹ç¯‰ã™ã‚‹ ã¾ãš minikube ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã™ã€‚\n$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.12.0/minikube-darwin-amd64 \u0026amp;\u0026amp; chmod +x minikube \u0026amp;\u0026amp; sudo mv minikube /usr/local/bin/ æ—©é€Ÿ minikube ã‚’èµ·å‹•ã—ã¾ã™ã€‚\n$ docker-machine start default $ minikube start $ eval $(minikube docker-env) Google Cloud ã® GKE ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ ä»Šå›ã¯ minikube ã‚’ä½¿ã£ã¦ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã« kubernetes 1.4 ç’°å¢ƒã‚’ä½œã‚Šã¾ã—ãŸãŒ Google Cloud ã® GKE ã‚’ç”¨ã„ã¦ã„ã‚‹å ´åˆä¸‹è¨˜ã®ã‚ˆã†ã« gcloud SDK ã‚’ç”¨ã„ã¦ GKE ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒãƒ¼ãƒ‰ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã§å¯¾å¿œã§ãã¾ã™ã€‚ã§ã™ãŒ Google ã«ç¢ºèªã—ãŸã¨ã“ã‚ã“ã®æ§‹ç¯‰æ–¹æ³•ã‚’å–ã£ãŸå ´åˆã«ã¯ Google ã‹ã‚‰ã®ã‚µãƒãƒ¼ãƒˆã‚’å¾—ã‚‰ã‚Œãªã„ã®ã¨ SLA ã‚‚å¯¾è±¡å¤–ã«ãªã‚‹ã¨ã®ã“ã¨ã§ã—ãŸã€‚ãƒªã‚¹ã‚¯ã¯å¤§ãã„ã¨æ€ã„ã¾ã™ã€‚(2016/11ç¾åœ¨)\ngcloud alpha container clusters create alpha-test-cluster --zone asia-northeast1-b --enable-kubernetes-alpha gcloud container clusters get-credentials alpha-test-cluster gcloud container node-pools create alpha-test-pool --zone asia-northeast1-b --cluster alpha-test-cluster scheduledjob ã‚’è©¦ã™ yaml ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ scheduledjob ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã® yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚å…¬å¼ã‚µã‚¤ãƒˆ (http://kubernetes.io/docs/user-guide/scheduled-jobs/) ã«ã‚ã‚‹ã‚‚ã®ã‚’ä¸€éƒ¨ä¿®æ­£ã—ã¦è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«åã¯ sj.yaml ã¨ã—ã¾ã™ã€‚\napiVersion: batch/v2alpha1 kind: ScheduledJob metadata: name: hello spec: schedule: 0/1 * * * ? jobTemplate: spec: template: spec: containers: - name: hello image: busybox args: - /bin/sh - -c - date; echo Hello from the Kubernetes cluster restartPolicy: OnFailure concurrencyPolicy: Allow #suspend: true scheduledJob ã®å®Ÿè¡Œ ç”Ÿæˆã—ãŸ yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã« kubectl ã‚³ãƒãƒ³ãƒ‰ã§ scheduledjob ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\n$ kubectl create -f ./sj.yaml å®Ÿè¡Œã—ãŸã‚¸ãƒ§ãƒ–ãŒã©ã®ã‚ˆã†ãªçŠ¶æ³ã‹ç¢ºèªã—ã¾ã™ã€‚ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ç”Ÿæˆã—ãŸ scheduledjob ä¸€è¦§ãŒç¢ºèªã§ãã¾ã™ã€‚ yaml ãƒ•ã‚¡ã‚¤ãƒ«ã®é€šã‚Šã€1åˆ†é–“éš”ã§ \u0026lsquo;hello\u0026rsquo; ã¨ã„ã† scheduledJob ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\n$ kubectl get scheduledjob NAME SCHEDULE SUSPEND ACTIVE LAST-SCHEDULE hello 0/1 * * * ? False 0 \u0026lt;none\u0026gt; scheduledjob ã‚’å…ƒã«å®Ÿè¡Œã•ã‚ŒãŸ(å®Ÿè¡Œã•ã‚Œã‚‹) ã‚¸ãƒ§ãƒ–(job) ä¸€è¦§ã‚’ç¢ºèªã—ã¾ã™ã€‚ 1åˆ†é–“éš”ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹æ§˜å­ãŒç¢ºèªã§ãã¾ã™ã€‚ã¾ãŸã€DESIRED:1 ã§ SUCCESSFUL:0 ã®è¡Œã¯ã€1åˆ†é–“éš”ã§å®Ÿè¡Œã•ã‚Œã‚‹ç›´å‰ã®ã‚¸ãƒ§ãƒ–ã¨ã—ã¦èªè­˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚\n$ kubectl get jobs --watch NAME DESIRED SUCCESSFUL AGE hello-1856276298 1 1 59s NAME DESIRED SUCCESSFUL AGE hello-1780451143 1 0 0s hello-1780451143 1 0 0s hello-1780451143 1 1 5s hello-1476429627 1 0 0s hello-1476429627 1 0 0s hello-1476429627 1 1 5s hello-1628211009 1 0 0s hello-1628211009 1 0 0s hello-1628211009 1 1 5s hello-1552385854 1 0 0s hello-1552385854 1 0 0s hello-1552385854 1 1 5s ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã•ã‚ŒãŸã‚¸ãƒ§ãƒ–ä¸€è¦§ã‚’å–å¾—ã§ãã¾ã™ã€‚ã“ã¡ã‚‰ã¯çµæœã®ã¿ã§ã™ã®ã§ SUCCESSFULL=1 ã®ã¿ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚\n$ kubectl get job NAME DESIRED SUCCESSFUL AGE hello-1476429627 1 1 6m hello-1552385854 1 1 4m hello-1552516926 1 1 1m hello-1628211009 1 1 5m hello-1628342081 1 1 2m hello-1704167236 1 1 3m hello-1704298308 1 1 49s hello-1780451143 1 1 7m hello-1856276298 1 1 8m ã“ã®éš›ã« pod ã®æ§˜å­ã‚‚ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚\u0026ndash;show-all ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§éå»ã® pod ã‚’ä¸€è¦§è¡¨ç¤ºã—ã¾ã™ã€‚ä»Šå›ã®ã‚¸ãƒ§ãƒ–ã¯ä¸€ç¬ã§å®Ÿè¡Œå¯èƒ½ãªå†…å®¹ãªã®ã§ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ãªã„ã¨ pod ä¸€è¦§ãŒå–å¾—ã§ããªã„å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚\nkubectl get pod --show-all NAME READY STATUS RESTARTS AGE hello-1476429627-pxr06 0/1 Completed 0 8m hello-1552385854-y68ci 0/1 Completed 0 6m hello-1552516926-ggjpk 0/1 Completed 0 3m hello-1628211009-iih0i 0/1 Completed 0 7m hello-1628342081-ig5lg 0/1 Completed 0 4m hello-1628473153-9wvn4 0/1 Completed 0 1m hello-1704167236-zqg94 0/1 Completed 0 5m hello-1704298308-eaq8m 0/1 Completed 0 2m hello-1780254535-64mah 0/1 Completed 0 28s hello-1780451143-tjg8r 0/1 Completed 0 9m hello-1856276298-y2o65 0/1 Completed 0 10m æœ€çµ‚è¡Œã®ã‚¸ãƒ§ãƒ– \u0026lsquo;hello-1856276298-y2o65\u0026rsquo; ã®å†…å®¹ã‚’ç¢ºèªã—ã¾ã™ã€‚\n$ kubectl logs hello-1856276298-y2o65 Thu Oct 27 01:18:11 UTC 2016 Hello from the Kubernetes cluster sj.yaml å†…ã«è¨˜è¿°ã—ãŸã‚¸ãƒ§ãƒ–å†…å®¹ \u0026rsquo;echo \u0026hellip;\u0026rsquo; ã®å®Ÿè¡ŒçµæœãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚\ndocker ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚‚ç¢ºèªã—ã¾ã™ã€‚ã‚¸ãƒ§ãƒ–å†…ã§æŒ‡å®šã—ãŸ image: busybox ãŒç¢ºèªã§ãã¾ã™ã€‚ ãã®ä»–ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ minikube ã‚’æ§‹æˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚\n$ docker images REPOSITORY TAG IMAGE ID CREATED SIZE busybox latest e02e811dd08f 2 weeks ago 1.093 MB gcr.io/google_containers/kubernetes-dashboard-amd64 v1.4.0 436faaeba2e2 5 weeks ago 86.27 MB gcr.io/google-containers/kube-addon-manager v5.1 735ce4344f7f 3 months ago 255.8 MB gcr.io/google_containers/pause-amd64 3.0 99e59f495ffa 5 months ago 746.9 kB ã‚¸ãƒ§ãƒ–ã®å‰Šé™¤ ã‚¸ãƒ§ãƒ–ã‚’å‰Šé™¤ã—ã¾ã™ã€‚å‰Šé™¤ã™ã‚‹å¯¾è±¡ã¯ scheduledjob ã¨ãã‚Œã‚’å…ƒã«ç”Ÿæˆãƒ»å®Ÿè¡Œã•ã‚ŒãŸ jobs ã§ã™ã€‚\n$ kubectl delete scheduledjob hello $ kubectl delete jobs $(kubectl get jobs | awk \u0026#39;{print $1}\u0026#39; | grep -v NAME) job \u0026#34;hello-1476429627\u0026#34; deleted job \u0026#34;hello-1552385854\u0026#34; deleted job \u0026#34;hello-1552516926\u0026#34; deleted job \u0026#34;hello-1628211009\u0026#34; deleted job \u0026#34;hello-1628342081\u0026#34; deleted job \u0026#34;hello-1628473153\u0026#34; deleted job \u0026#34;hello-1628604225\u0026#34; deleted job \u0026#34;hello-1704167236\u0026#34; deleted job \u0026#34;hello-1704298308\u0026#34; deleted job \u0026#34;hello-1704429380\u0026#34; deleted job \u0026#34;hello-1780254535\u0026#34; deleted job \u0026#34;hello-1780385607\u0026#34; deleted job \u0026#34;hello-1780451143\u0026#34; deleted job \u0026#34;hello-1856276298\u0026#34; deleted ã“ã“ã§ç¢ºèªã§ããŸã®ã¯ scheduledjob ã‚’å‰Šé™¤ã™ã‚‹ã¨ãã‚Œä»¥é™ã® jobs ã¯æ–°è¦å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ãŒã€å®Ÿè¡Œã•ã‚ŒãŸå¾Œã® jobs ã¯æƒ…å ±ã¨ã—ã¦æ®‹ã£ãŸã¾ã¾ã§ã—ãŸã€‚\nãã®ä»–ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ concurrencyPolicy ä¸‹è¨˜ã®ã‚ˆã†ã« spec.concurrencyPolicy ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæŒ‡å®šã§ãã¾ã™ã€‚ä¸‹è¨˜ã®ã‚ˆã†ãª value ã‚’æ¸¡ã™ã¨å®Ÿè¡Œã•ã‚Œã‚‹ã‚¸ãƒ§ãƒ–ã®å‹•ä½œã‚’å¤‰ãˆã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚\nAllow (Default) : é‡è¤‡ã™ã‚‹ã‚¸ãƒ§ãƒ–å®Ÿè¡Œã‚’è¨±å¯ Forbid : ç›´å‰ã®ã‚¸ãƒ§ãƒ–ãŒçµ‚äº†ã—ã¦ã„ãªã„å ´åˆã‚¸ãƒ§ãƒ–å®Ÿè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ Replace : ç›´å‰ã®ã‚¸ãƒ§ãƒ–ãŒçµ‚äº†ã—ã¦ã„ãªã„å ´åˆæ–°ã—ã„ã‚¸ãƒ§ãƒ–ã‚’ä¸Šæ›¸ãã™ã‚‹ suspend \u0026lsquo;spec.suspend: true\u0026rsquo; ã«è¨­å®šã™ã‚‹ã¨ ScheduledJob ã¯ç”Ÿæˆã•ã‚Œã¾ã™ãŒæ¬¡å›å®Ÿè¡Œæ™‚ã®ã‚¸ãƒ§ãƒ–ãŒã‚µã‚¹ãƒšãƒ³ãƒ‰ã•ã‚Œå®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ false ã§ã™ã€‚\n$ kubectl get scheduledjob NAME SCHEDULE SUSPEND ACTIVE LAST-SCHEDULE hello 0/1 * * * ? True 0 \u0026lt;none\u0026gt; $ kubectl get job $ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®é©ç”¨ä¾‹ãƒ•ã‚¡ã‚¤ãƒ« apiVersion: batch/v2alpha1 kind: ScheduledJob metadata: name: hello spec: schedule: 0/1 * * * ? jobTemplate: spec: template: spec: containers: - name: hello image: busybox args: - /bin/sh - -c - date; echo Hello from the Kubernetes cluster restartPolicy: OnFailure concurrencyPolicy: Forbid suspend: true ã¾ã¨ã‚ã¨è€ƒå¯Ÿ ä»Šå›è©¦ã—ã¦ã¿ã¦ã€ãƒãƒƒãƒçš„ãªå‡¦ç†ã‚’ kubernetes ã§è¡Œã†ãªã‚‰ã“ã® scheduledJob ã—ã‹ãªã„ãªã€ã¨æ€ã„ã¾ã—ãŸã€‚ ã§ã™ãŒã€2016/11 ç¾åœ¨ã§ã¯ã¾ã  Alpha ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã„ã†ã“ã¨ã§ä¸‹è¨˜ã®ã‚ˆã†ãªãƒªã‚¹ã‚¯ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚\nã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ãƒã‚®ãƒ¼ã§ã™ ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ç„¡ã—ã«æ©Ÿèƒ½ãŒå‰Šã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ç„¡ã—ã«ãã‚Œã¾ã§ã®äº’æ›æ€§ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ ãƒ†ã‚¹ãƒˆç”¨ã¨ã—ã¦ã®åˆ©ç”¨ã‚’å‹§ã‚ã¾ã™ã€‚ å‚è€ƒã‚µã‚¤ãƒˆ : http://kubernetes.io/docs/api/\nã¾ãŸä¸Šè¨˜ã«ã‚‚è¨˜ã—ã¾ã—ãŸãŒã€ã‚¸ãƒ§ãƒ–ã®çµæœãŒæ®‹ã£ã¦ã„ããŸã‚ã€é€šå¸¸ä½¿ã† cron ã®ã‚ˆã†ã«æ•°åˆ†é–“éš”ã§å®Ÿè¡Œã—ã¦ã„ã‚‹ã¨ã‚ã£ã¨ã„ã†é–“ã« job ã®é‡ãŒå¤§é‡ã«è‚¥å¤§åŒ–ã™ã‚‹ã“ã¨ãŒäºˆæƒ³ã•ã‚Œã¾ã™ã€‚ã“ã® job ã«ã¯å®Ÿè¡Œçµæœã‚‚å«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€æ¶ˆã•ã‚Œã‚‹ã‚‚ã®ã§ã¯ãªã„ã®ã¯ç†è§£ã§ãã‚‹ã®ã§ã™ãŒ kubernetes api ãŒæŒã£ã¦ã„ã‚‹ DB ä¸Šã«å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ãŒç”Ÿæˆã•ã‚Œç¶šã‘ã¦ã—ã¾ã†ãŸã‚ã€kubernetes api/ã‚µãƒ¼ãƒã‚’ç®¡ç†ã—ã¦ã„ã‚‹å ´åˆã«ã¯å•é¡Œã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚ã“ã®è¾ºã‚Šã€ä»•æ§˜ã®ä¿®æ­£ãŒå…¥ã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/kubernetes-scheduledjob/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€@jedipunkz ã§ã™ã€‚ä»Šå›ã¯ Kubernetes1.4 ã‹ã‚‰å®Ÿè£…ã•ã‚ŒãŸ ScheduledJob ã‚’è©¦ã—ã¦ã¿ãŸã®ã§ãã®å†…å®¹ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eScheduledJob ã¯ãƒãƒƒãƒçš„ãªå‡¦ç†ã‚’ Kubernetes ã® pod ã‚’ä½¿ã£ã¦å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã§ã™ã€‚ç¾åœ¨ã¯ alpha ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚\nkubernetes ã® pod, service ã¯é€šå¸¸ã€æ°¸ç¶šçš„ã«ç«‹ã¡ä¸Šã’ã¦ãŠãã‚µãƒ¼ãƒãªã©ã‚’ç¨¼åƒã•ã›ã‚‹ã‚‚ã®ã§ã™ãŒã€ãã‚Œã«å¯¾ã—ã¦ã“ã® scheduledJob ã¯ cron æ„Ÿè¦šã§ãƒãƒƒãƒå‡¦ç†ã‚’ pod ã«ä»»ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eAlpha ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã„ã†ã“ã¨ã§ä»Šå›ã®ç’°å¢ƒæ§‹ç¯‰ã¯ minikube ã‚’ä½¿ã£ã¦ç°¡æ˜“çš„ã« Mac ä¸Šã«æ§‹ç¯‰ã—ã¾ã—ãŸã€‚Docker ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚Œã° Linux ã§ã‚‚ç’°å¢ƒã‚’ä½œã‚Œã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒ-url\"\u003eå‚è€ƒ URL\u003c/h2\u003e\n\u003cp\u003eä»Šå›åˆ©ç”¨ã™ã‚‹ yaml ãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã¯ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://kubernetes.io/docs/user-guide/scheduled-jobs/\"\u003ehttp://kubernetes.io/docs/user-guide/scheduled-jobs/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/kubernetes/minikube\"\u003ehttps://github.com/kubernetes/minikube\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å‰æã®ç’°å¢ƒ\"\u003eå‰æã®ç’°å¢ƒ\u003c/h2\u003e\n\u003cp\u003eç§ã®ç’°å¢ƒã§ã¯ä¸‹è¨˜ã®ç’°å¢ƒã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMac OSX\u003c/li\u003e\n\u003cli\u003eDocker-machine or Docker for Mac\u003c/li\u003e\n\u003cli\u003eminikube\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"kubernetes-14-ä»¥é™ã®æ§‹æˆã‚’-minikube-ã§æ§‹ç¯‰ã™ã‚‹\"\u003ekubernetes 1.4 ä»¥é™ã®æ§‹æˆã‚’ minikube ã§æ§‹ç¯‰ã™ã‚‹\u003c/h2\u003e\n\u003cp\u003eã¾ãš minikube ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.12.0/minikube-darwin-amd64 \u0026amp;\u0026amp; chmod +x minikube \u0026amp;\u0026amp; sudo mv minikube /usr/local/bin/\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæ—©é€Ÿ minikube ã‚’èµ·å‹•ã—ã¾ã™ã€‚\u003c/p\u003e","title":"kubernetes1.4 ã§å®Ÿè£…ã•ã‚ŒãŸ ScheduledJob ã‚’è©¦ã—ã¦ã¿ãŸï¼"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nkubernetes ã®ç’°å¢ƒã‚’ç°¡æ˜“çš„ã«ä½œã‚Œã‚‹ Minikube (https://github.com/kubernetes/minikube) ãŒ2ãƒ¶æœˆå‰ã»ã©ã«ãƒªãƒªãƒ¼ã‚¹ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚ç°¡å˜ã§ã™ãŒå°‘ã—è§¦ã£ã¦ã¿ãŸã®ã§ãã®éš›ã®ãƒ¡ãƒ¢ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚VirtualBox ã‚‚ã—ãã¯ VMware Fusion ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚Œã°ã™ãã«ã§ã‚‚ç¨¼åƒå¯èƒ½ã§ã™ã€‚ç§ã¯ Kubernetes åˆå¿ƒè€…ã§ã™ãŒä½•ã‚‚è€ƒãˆãšã« kubernetes ã‚’å‹•ã‹ã™ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚\nå‰æ å‰æã¨ã—ã¦ä¸‹è¨˜ã®ç’°å¢ƒãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚\nMac OSX ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ VirtualBox ã‚‚ã—ãã¯ VMware Fusion ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ minikube ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« minikube ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.6.0/minikube-darwin-amd64 \u0026amp;\u0026amp; chmod +x minikube \u0026amp;\u0026amp; sudo mv minikube /usr/local/bin/ kubetl ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« æ¬¡ã« kubectl ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n$ curl -k -o kubectl https://kuar.io/darwin/kubectl \u0026amp;\u0026amp; chmod +x kubectl \u0026amp;\u0026amp; sudo mv kubectl /usr/local/bin/ Minikube ã§ Kurbernates ã‚’ç¨¼åƒ Minikube ã‚’ä½¿ã£ã¦ Kubernetes ã‚’ç¨¼åƒã—ã¦ã¿ã¾ã™ã€‚ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ Virtualbox ä¸Šã§ä»®æƒ³ãƒã‚·ãƒ³ãŒç¨¼åƒã— Kubernetes ä¸€å¼ã‚‚ç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚\n$ minikube start Kurbernates ã‚’ä½¿ã£ã¦ã¿ã‚‹ Pods ã‚’ç«‹ã¡ä¸Šã’ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä¸‹è¨˜ã®å†…å®¹ã‚’ redis-django.yaml ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚\napiVersion: v1 kind: Pod metadata: name: redis-django labels: app: web spec: containers: - name: key-value-store image: redis ports: - containerPort: 6379 - name: frontend image: django ports: - containerPort: 8000 kubectl ã‚³ãƒãƒ³ãƒ‰ã§ Pod ã‚’ç«‹ã¡ä¸Šã’ã¾ã™ã€‚\n$ kubectl create -f ./redis-django.yaml Pod ã®æ§˜å­ã‚’ç¢ºèªã—ã¾ã™ã€‚\n$ kubectl get pods NAME READY STATUS RESTARTS AGE redis-django 1/2 CrashLoopBackOff 7 15m Minikube ã¯ã‚¯ãƒ©ã‚¹ã‚¿ã¨ã„ã£ã¦ã‚‚ãƒãƒ¼ãƒ‰ãŒ1ã¤ãªã®ã§ READY 1/2 ã¨ãªã‚‹ã‚ˆã†ã§ã™ã€‚Nodes ã®æ§˜å­ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚\n$ kubectl get nodes NAME LABELS STATUS minikubevm beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=minikubevm Ready Docker ãƒ›ã‚¹ãƒˆä¸Šã®æ§˜å­ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚Kubernetes ã‚’å½¢æˆã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã¨å…±ã« redis ã®ã‚³ãƒ³ãƒ†ãƒŠãŒç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚\n$ eval $(minikube docker-env) $ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 550285614e33 redis \u0026#34;docker-entrypoint.sh\u0026#34; 20 minutes ago Up 20 minutes k8s_key-value-store.a3b8356e_redis-django_default_4440a1d8-5272-11e6-9f19-6e0006e7fb51_90c3fec8 aba3a8c040d4 gcr.io/google_containers/pause-amd64:3.0 \u0026#34;/pause\u0026#34; 20 minutes ago Up 20 minutes k8s_POD.822b267d_redis-django_default_4440a1d8-5272-11e6-9f19-6e0006e7fb51_5bef1d2a 9ea96a3f3e10 gcr.io/google-containers/kube-addon-manager-amd64:v2 \u0026#34;/opt/kube-addons.sh\u0026#34; 48 minutes ago Up 48 minutes k8s_kube-addon-manager.a1c58ca2_kube-addon-manager-minikubevm_kube-system_48abed82af93bb0b941173334110923f_84f4fd38 192e886a5795 gcr.io/google_containers/pause-amd64:3.0 \u0026#34;/pause\u0026#34; 48 minutes ago Up 48 minutes k8s_POD.d8dbe16c_kube-addon-manager-minikubevm_kube-system_48abed82af93bb0b941173334110923f_6c65b482 7b005c68d9d4 gcr.io/google_containers/pause-amd64:3.0 \u0026#34;/pause\u0026#34; 48 minutes ago Up 48 minutes k8s_POD.2225036b_kubernetes-dashboard-pzdxy_kube-system_7005dce1-479a-11e6-a0ce-86b669e45864_c08bd009 ã¾ã¨ã‚ Kubernetes ã®ã“ã¨ã‚’æ®†ã©çŸ¥ã‚‰ãªã„ç§ã§ã‚‚ãªã‚“ã¨ãªãã§ã™ãŒç¨¼åƒã•ã›ã¦åŸºæœ¬çš„ãªæ“ä½œãŒå‡ºæ¥ã¾ã—ãŸã€‚2016/5/31 ã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«ãªã®ã§ã¾ã å®‰å®šã—ãªã„ã¨ã“ã‚ã‚‚ã‚ã‚Šã¾ã™ãŒã€ã‚ˆã‚Šå®¹æ˜“ã« Kubernetes ãŒç¨¼åƒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ•·å±…ãŒä¸‹ãŒã£ãŸã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚\n","permalink":"https://jedipunkz.github.io/post/minikube/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003ekubernetes ã®ç’°å¢ƒã‚’ç°¡æ˜“çš„ã«ä½œã‚Œã‚‹ Minikube (\u003ca href=\"https://github.com/kubernetes/minikube\"\u003ehttps://github.com/kubernetes/minikube\u003c/a\u003e) ãŒ2ãƒ¶æœˆå‰ã»ã©ã«ãƒªãƒªãƒ¼ã‚¹ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚ç°¡å˜ã§ã™ãŒå°‘ã—è§¦ã£ã¦ã¿ãŸã®ã§ãã®éš›ã®ãƒ¡ãƒ¢ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚VirtualBox ã‚‚ã—ãã¯ VMware Fusion ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚Œã°ã™ãã«ã§ã‚‚ç¨¼åƒå¯èƒ½ã§ã™ã€‚ç§ã¯ Kubernetes åˆå¿ƒè€…ã§ã™ãŒä½•ã‚‚è€ƒãˆãšã« kubernetes ã‚’å‹•ã‹ã™ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æ\"\u003eå‰æ\u003c/h2\u003e\n\u003cp\u003eå‰æã¨ã—ã¦ä¸‹è¨˜ã®ç’°å¢ƒãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMac OSX ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨\u003c/li\u003e\n\u003cli\u003eVirtualBox ã‚‚ã—ãã¯ VMware Fusion ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"minikube-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003eminikube ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003eminikube ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.6.0/minikube-darwin-amd64 \u0026amp;\u0026amp; chmod +x minikube \u0026amp;\u0026amp; sudo mv minikube /usr/local/bin/\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"kubetl-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003ekubetl ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003eæ¬¡ã« kubectl ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e$ curl -k -o kubectl https://kuar.io/darwin/kubectl \u0026amp;\u0026amp; chmod +x kubectl \u0026amp;\u0026amp; sudo mv kubectl /usr/local/bin/\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"minikube-ã§-kurbernates-ã‚’ç¨¼åƒ\"\u003eMinikube ã§ Kurbernates ã‚’ç¨¼åƒ\u003c/h2\u003e\n\u003cp\u003eMinikube ã‚’ä½¿ã£ã¦ Kubernetes ã‚’ç¨¼åƒã—ã¦ã¿ã¾ã™ã€‚ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ Virtualbox ä¸Šã§ä»®æƒ³ãƒã‚·ãƒ³ãŒç¨¼åƒã— Kubernetes ä¸€å¼ã‚‚ç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚\u003c/p\u003e","title":"Minikube ã§ç°¡æ˜“ kubernetes ç’°å¢ƒæ§‹ç¯‰"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šæ—¥ã¯ Go è¨€èªã§ã‚µãƒ¼ãƒã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ InfluxDB ã«å…¥ã‚Œã¦ãƒªã‚½ãƒ¼ã‚¹ç›£è¦–ã‚’è¡Œã†æ–¹æ³•ã«ã¤ã„ã¦æ›¸ãã¾ã™ã€‚\nAnsible, Terraform, Chef ãªã©ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å®šç¾©ã™ã‚‹ã®ãŒå½“ãŸã‚Šå‰ã«ãªã£ãŸç¾åœ¨ã§ã™ãŒã€æœ¬å½“ã®æ„å‘³ã§ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã®å®šç¾©ã£ã¦ãªã‚“ã ã‚ã¨æœ€è¿‘è€ƒãˆã¦ã„ã¾ã™ã€‚aws-sdk ã‚„ fog ãªã©ã‚’ä½¿ã£ãŸãƒã‚¤ãƒ†ã‚£ãƒ–ãªè¨€èªã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã®æ„å‘³ã‚‚ã‚ã‚‹ã‚ˆã†ã«æ„Ÿã˜ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚æŸã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¯ã“ã†ã—ãŸè¨€èªã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã®å®šç¾©ã®ä¸€ç•ªå¤§ããªãƒ¡ãƒªãƒƒãƒˆã¨ã—ã¦ \u0026ldquo;å†åˆ©ç”¨æ€§\u0026rdquo; ã‚’ã‚ã’ã¦ã„ã¾ã—ãŸã€‚ã“ã†ã—ãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã®å®šç¾©ã‚„æ§‹æˆã‚’è¡Œã†ä¸Šã§ç›£è¦–ã«ã¤ã„ã¦ã‚‚ã‚³ãƒ¼ãƒ‰åŒ–ã§ãã‚‹ã®ã§ã¯ï¼Ÿã¨è€ƒãˆã¦ä»Šå›ã®è¨˜äº‹ã«è‡³ã‚Šã¾ã—ãŸã€‚\nä½¿ã†ãƒ¢ãƒ https://github.com/influxdata/influxdb/tree/master/client å…¬å¼ã® InfluxDB Go Client ã§ã™ã€‚InfluxDB è‡ªä½“ãŒ Go è¨€èªã§æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚‚ Go è¨€èªã§è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã“ã«ã‚ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ã™ã“ã—ã„ã˜ã£ã¦ã€ä»Šå›ã®è¨˜äº‹ã‚’æ›¸ã“ã†ã¨æ€ã„ã¾ã™ã€‚\nhttps://github.com/shirou/gopsutil @shirou ã•ã‚“ãŒä½œã‚‰ã‚ŒãŸ psutil ã® Go è¨€èªç‰ˆã§ã™ã€‚CPU, Mem ãªã©ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ¢ãƒ‹ã‚¿ã™ã‚‹ã®ã«ä¾¿åˆ©ãªã®ã§åˆ©ç”¨ã—ã¾ã™ã€‚\nç’°å¢ƒæ§‹ç¯‰ ç’°å¢ƒã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚InfluxDB ã¨ Chronograf ã‚’æ§‹ç¯‰ã™ã‚‹ã®ã§ã™ãŒ Docker ã§æ§‹ç¯‰ã™ã‚‹ã®ãŒç°¡å˜ãªã®ã§ã“ã‚Œã‚’åˆ©ç”¨ã—ã¾ã™ã€‚Chronograf ã¯ InfluxDB å†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–ã™ã‚‹ãŸã‚ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ã€‚\nInfluxDB ã®èµ·å‹• InfluxDB ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¾ã™ã€‚\ndocker run -p 8083:8083 -p 8086:8086 \\ -v $PWD:/var/lib/influxdb \\ influxdb Chronograf ã®èµ·å‹• Chronograf ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¾ã™ã€‚\ndocker run -p 10000:10000 chronograf ã“ã®æ™‚ç‚¹ã§ http://${DOCKER_HOST}:10000/ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ Chronograf ã® UI ã‚’ç¢ºèªã§ãã¾ã™ã€‚\nInfluxDB ã«ãƒ¦ãƒ¼ã‚¶ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ InfluxDB ä¸Šã«ãƒ¦ãƒ¼ã‚¶ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚è¨€èªã®ä¸­ã§ã‚‚ä½œã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ãŒã€ä»Šå›ã¯æ‰‹å‹•ã§ã€‚ Mac OSX ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆ homebrew ã§ influxdb ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒç°¡å˜ã«ã§ãã¾ã™ã€‚\nbrew install influxdb ãƒ¦ãƒ¼ã‚¶ã‚’ä½œã‚Šã¾ã™ã€‚\ninflux -host 192.168.99.100 -port 8086 \u0026gt; create user foo with password \u0026#39;foo\u0026#39; \u0026gt; grant all privileges to foo ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œã‚Šã¾ã™ã€‚\ninflux -host 192.168.99.100 -port 8086 \u0026gt; CREATE DATABASE IF NOT EXISTS square_holes; Goè¨€èªã§ CPU æ™‚é–“ã‚’å–å¾—ã— InfluxDB ã«ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥ Go è¨€èªã§ãƒ¡ãƒ¢ãƒªãƒ¼ä½¿ç”¨ç‡ã‚’å–å¾—ã—å¾—ã‚‰ã‚ŒãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ InfluxDB ã«æŒ¿å…¥ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã™ã€‚\npackage main import ( \u0026#34;log\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/influxdata/influxdb/client/v2\u0026#34; \u0026#34;github.com/shirou/gopsutil/cpu\u0026#34; ) const ( MyDB = \u0026#34;square_holes\u0026#34; username = \u0026#34;foo\u0026#34; password = \u0026#34;foo\u0026#34; ) func main() { for { // Make client c, err := client.NewHTTPClient(client.HTTPConfig{ Addr: \u0026#34;http://192.168.99.100:8086\u0026#34;, Username: username, Password: password, }) if err != nil { log.Fatalln(\u0026#34;Error: \u0026#34;, err) } // Create a new point batch bp, err := client.NewBatchPoints(client.BatchPointsConfig{ Database: MyDB, Precision: \u0026#34;s\u0026#34;, }) if err != nil { log.Fatalln(\u0026#34;Error: \u0026#34;, err) } // get CPU info cp, _ := cpu.Times(true) // get CPU status info for each core var user, system, idle float64 = 0, 0, 0 for _, sub_cpu := range cp { user = user + sub_cpu.User system = system + sub_cpu.System idle = idle + sub_cpu.Idle } // Create a point and add to batch tags := map[string]string{\u0026#34;cpu\u0026#34;: \u0026#34;cpu\u0026#34;} fields := map[string]interface{}{ \u0026#34;User\u0026#34;: user / float64(len(cp)), \u0026#34;System\u0026#34;: system / float64(len(cp)), \u0026#34;Idle\u0026#34;: idle / float64(len(cp)), } pt, err := client.NewPoint(\u0026#34;cpu\u0026#34;, tags, fields, time.Now()) if err != nil { log.Fatalln(\u0026#34;Error: \u0026#34;, err) } bp.AddPoint(pt) // Write the batch c.Write(bp) time.Sleep(1 * time.Second) } } ãƒ“ãƒ«ãƒ‰ã—ã¦å®Ÿè¡Œã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã« influxdb ä¸Šã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ãŒæŒ¿å…¥ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚\ninflux -host 192.168.99.100 -port 8086 -execute \u0026#39;SELECT * FROM cpu\u0026#39; -database=square_holes -precision=s | head -8 name: cpu --------- time Idle System User cpu 1469342272 20831.04296875 3700.185546875 3544.90234375 cpu 1469342273 20831.666015625 3700.302734375 3544.966796875 cpu 1469342274 20832.2109375 3700.447265625 3545.068359375 cpu 1469342275 20832.828125 3700.546875 3545.13671875 cpu 1469342291 20841.728515625 3702.482421875 3546.806640625 cpu Chronograf ã® UI ã§ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nå¾—ã‚‰ã‚ŒãŸ CPU ã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒå¯è¦–åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚å¤‰åŒ–ã«ä¹ã—ã„ã‚°ãƒ©ãƒ•ã§ã™ãŒ\u0026hellip;ã€‚ ã“ã®è¾ºã‚Šã¯ CPU æ™‚é–“ã‹ã‚‰ CPU ä½¿ç”¨ç‡ã‚’å¾—ã‚‹ã‚³ãƒ¼ãƒ‰ã«æ›¸ãæ›ãˆã‚‹ã¨ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\nã¾ã¨ã‚ã¨è€ƒå¯Ÿ InfluxDB ã®æä¾›å…ƒãŒå‡ºã—ã¦ã„ã‚‹ Telegraf ã¨ã„ã†ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ãŒã€åŒã˜ã‚ˆã†ãªå‹•ãã‚’ Go è¨€èªã§ç°¡å˜ã«é–‹ç™ºã§ãã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚ãƒã‚¤ãƒ†ã‚£ãƒ–ãªè¨€èªã§é–‹ç™ºã™ã‚‹ã¨ã‚ˆã‚ŠæŸ”è»Ÿã«ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ãŒã§ãã‚‹ã“ã¨ã‚‚æœŸå¾…ã§ãã¾ã™ã€‚ã¾ãŸå†’é ­ã«è¿°ã¹ãŸé€šã‚Šå†åˆ©ç”¨ã‚‚ç”¨æ„ã«ãªã‚‹ã®ã§ã¯ã¨æ€ã„ã¾ã™ã€‚ã‚¤ãƒ³ãƒ•ãƒ©ã®çŠ¶æ…‹ã‚’ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æ™‚ç³»åˆ— DB ã«æŒ¿å…¥ã—ã¦å¯è¦–åŒ–ã™ã‚‹ã¨ã„ã†ã“ã¨ã¯ç›£è¦–ã®ã‚³ãƒ¼ãƒ‰åŒ–ã¨ã‚‚è¨€ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚ãŸã ã—ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå‡ºã¦ãã¦ã‚‚ã£ã¨ç°¡å˜ã«æ›¸ã‘ã‚‹ä»•çµ„ã¿ãŒå‡ºã¦ã“ãªã„ã¨å³ã—ã„æ°—ã‚‚ã—ã¾ã™ãŒã€‚æœãŸã—ã¦ã“ã‚Œã‚‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚’è¨€èªã§è¨˜è¿°ã—ã¦ã„ãã“ã¨ãŒã©ã‚Œã ã‘æœ‰ç”¨ãªã®ã‹ã¾ã ã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€ã„ã¤ã‹ç¾å ´ã§å®Ÿè·µã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/influxdb-go/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šæ—¥ã¯ Go è¨€èªã§ã‚µãƒ¼ãƒã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ InfluxDB ã«å…¥ã‚Œã¦ãƒªã‚½ãƒ¼ã‚¹ç›£è¦–ã‚’è¡Œã†æ–¹æ³•ã«ã¤ã„ã¦æ›¸ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eAnsible, Terraform, Chef ãªã©ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å®šç¾©ã™ã‚‹ã®ãŒå½“ãŸã‚Šå‰ã«ãªã£ãŸç¾åœ¨ã§ã™ãŒã€æœ¬å½“ã®æ„å‘³ã§ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã®å®šç¾©ã£ã¦ãªã‚“ã ã‚ã¨æœ€è¿‘è€ƒãˆã¦ã„ã¾ã™ã€‚aws-sdk ã‚„ fog ãªã©ã‚’ä½¿ã£ãŸãƒã‚¤ãƒ†ã‚£ãƒ–ãªè¨€èªã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã®æ„å‘³ã‚‚ã‚ã‚‹ã‚ˆã†ã«æ„Ÿã˜ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚æŸã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¯ã“ã†ã—ãŸè¨€èªã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã®å®šç¾©ã®ä¸€ç•ªå¤§ããªãƒ¡ãƒªãƒƒãƒˆã¨ã—ã¦ \u0026ldquo;å†åˆ©ç”¨æ€§\u0026rdquo; ã‚’ã‚ã’ã¦ã„ã¾ã—ãŸã€‚ã“ã†ã—ãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã®å®šç¾©ã‚„æ§‹æˆã‚’è¡Œã†ä¸Šã§ç›£è¦–ã«ã¤ã„ã¦ã‚‚ã‚³ãƒ¼ãƒ‰åŒ–ã§ãã‚‹ã®ã§ã¯ï¼Ÿã¨è€ƒãˆã¦ä»Šå›ã®è¨˜äº‹ã«è‡³ã‚Šã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ch2 id=\"ä½¿ã†ãƒ¢ãƒ\"\u003eä½¿ã†ãƒ¢ãƒ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/influxdata/influxdb/tree/master/client\"\u003ehttps://github.com/influxdata/influxdb/tree/master/client\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå…¬å¼ã® InfluxDB Go Client ã§ã™ã€‚InfluxDB è‡ªä½“ãŒ Go è¨€èªã§æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚‚ Go è¨€èªã§è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã“ã«ã‚ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ã™ã“ã—ã„ã˜ã£ã¦ã€ä»Šå›ã®è¨˜äº‹ã‚’æ›¸ã“ã†ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/shirou/gopsutil\"\u003ehttps://github.com/shirou/gopsutil\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e@shirou ã•ã‚“ãŒä½œã‚‰ã‚ŒãŸ psutil ã® Go è¨€èªç‰ˆã§ã™ã€‚CPU, Mem ãªã©ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ¢ãƒ‹ã‚¿ã™ã‚‹ã®ã«ä¾¿åˆ©ãªã®ã§åˆ©ç”¨ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ç’°å¢ƒæ§‹ç¯‰\"\u003eç’°å¢ƒæ§‹ç¯‰\u003c/h2\u003e\n\u003cp\u003eç’°å¢ƒã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚InfluxDB ã¨ Chronograf ã‚’æ§‹ç¯‰ã™ã‚‹ã®ã§ã™ãŒ Docker ã§æ§‹ç¯‰ã™ã‚‹ã®ãŒç°¡å˜ãªã®ã§ã“ã‚Œã‚’åˆ©ç”¨ã—ã¾ã™ã€‚Chronograf ã¯ InfluxDB å†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–ã™ã‚‹ãŸã‚ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eInfluxDB ã®èµ·å‹•\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eInfluxDB ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edocker run -p 8083:8083 -p 8086:8086 \\\n      -v $PWD:/var/lib/influxdb \\\n      influxdb\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eChronograf ã®èµ·å‹•\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eChronograf ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edocker run -p 10000:10000 chronograf\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eã“ã®æ™‚ç‚¹ã§ http://${DOCKER_HOST}:10000/ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ Chronograf ã® UI ã‚’ç¢ºèªã§ãã¾ã™ã€‚\u003c/p\u003e","title":"Goè¨€èªã¨InfluxDBã§ç›£è¦–ã®ã‚³ãƒ¼ãƒ‰åŒ–"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nç§ã‚‚ã‚¤ãƒ³ãƒ•ãƒ©ã®ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ Chef ã§ã¯ãªã Ansible ã‚’ä½¿ã†ã“ã¨ãŒå¢—ãˆãŸã®ã§ã™ãŒã€Chef ã‚’ä½¿ã£ã¦ã„ãŸé ƒã«åŒã˜ãåˆ©ç”¨ã—ã¦ã„ãŸ test-kitchen ãŒä¾¿åˆ©ã ã£ãŸã®ã§ ansible ã¨ä½µç”¨ã§ããªã„ã‹ã¨æ€ã„è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚test-kitchen ã¯ Docker ã‚³ãƒ³ãƒ†ãƒŠã‚„ EC2 ç­‰ã‚’èµ·å‹•ã—ã¦ Chef, Ansible ç­‰ã§æ§‹æˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã— serverspec ç­‰ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã§æ§‹æˆã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ã€‚AWS EC2 ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã‚‚ã„ã„ã®ã§ã™ãŒã€EC2 ã‚’èµ·å‹•ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦å¤±æ•—ã—ãŸã‚‰å‰Šé™¤ã—ã¦ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’å›ã™ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ã ã„ã¶é¢å€’ãªã®ã§ Docker + test-kitchen ã‚’ä½¿ã£ã¦ã“ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’é«˜é€Ÿã«å›ã™æ–¹ãŒãƒ¡ãƒªãƒƒãƒˆãŒå¤§ããã†ã§ã™ã€‚ä»Šå›ã¯ Docker + test-kitchen ã‚’ä½¿ã£ã¦ Ansible Role (Playbook) ã‚’é–‹ç™ºã™ã‚‹ã‚µã‚¤ã‚¯ãƒ«ã‚’é«˜é€ŸåŒ–ã™ã‚‹æ–¹æ³•ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®æ§‹æˆ æ§‹æˆã¯ã€ç§ã®å ´åˆ Mac OSX ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\ntest-kitchen kitchen-ansible (test-kitchen ãƒ‰ãƒ©ã‚¤ãƒ) kitchen-docker (test-kitchen ãƒ‰ãƒ©ã‚¤ãƒ) serverspec ansible docker (Docker-machine) VirtualBox Linux ã§ãƒã‚¤ãƒ†ã‚£ãƒ–ãª Docker ã‚’ä½¿ã£ã¦ã„ã‚‹æ–¹ã¯ä»¥é™ã€èª­ã¿æ›¿ãˆã¦ä¸‹ã•ã„ã€‚èª­ã¿æ›¿ãˆã‚‹ã®ã¯ãã‚Œã»ã©é›£ã—ããªã„ã¨æ€ã„ã¾ã™ã€‚\nã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ä»Šå›ã¯ä¸Šè¨˜ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯çœãã¾ã™ã€‚test-kitchen, kitchen-ansible, kitchen-docker, serverspec ã¯ Ruby ã§é–‹ç™ºã•ã‚ŒãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãªã®ã§ Gemfile ç­‰ã§ç®¡ç†ã€ansible ã¯ pip ç­‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚\nç’°å¢ƒä½œæˆ test-kitchen ãŒç¨¼åƒã™ã‚‹ã‚ˆã†ã«ç’°å¢ƒã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚ ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ kitchen ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦åˆæœŸè¨­å®šã‚’è¡Œã„ã¾ã™ã€‚ä»Šå›ã¯è©¦ã—ã« nginx ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿæ–½ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\n$ mkdir -p test-kitchen/nginx test-kitchen/roles $ cd test-kitchen/nginx $ kitchen init ã¾ãŸä¸Šè¨˜ã§ä½œæˆã—ãŸ roles ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« ansible-galaxy ã§ nginx ã® role ã‚’å–å¾—ã—ã¾ã™ã€‚\n$ ansible-galaxy install geerlingguy.nginx -p ../roles/nginx ä¸‹è¨˜ã®å†…å®¹ã‚’ .kitchen.local.yml ã¨ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚ Docker ãƒ›ã‚¹ãƒˆã®æŒ‡å®šã€Provisioner ã¨ã—ã¦ ansible ã®æŒ‡å®šã€Platform ã¨ã—ã¦ \u0026lsquo;ubuntu:16.04\u0026rsquo; ã® Docker ã‚³ãƒ³ãƒ†ãƒŠã®æŒ‡å®šã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚\n--- driver: name: docker binary: /usr/local/bin/docker socker: tcp://192.168.99.100:2376 provisioner: name: ansible_playbook playbook: ./site.yml roles_path: ../roles host_vars_path: ./host_vars hosts: kitchen-deploy require_ansible_omnibus: false ansible_platform: ubuntu require_chef_for_busser: true platforms: - name: ubuntu driver_config: image: ubuntu:16.04 platform: ubuntu require_chef_omnibus: false suites: - name: default run_list: attributes: ã“ã“ã‹ã‚‰ã¯ä¸Šè¨˜ .kitchen.local.yml ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®æº–å‚™ã‚’è¡Œã£ã¦ã„ãã¾ã™ã€‚\nsite.yml ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«æ›¸ã„ã¦ãã ã•ã„ã€‚\n--- - hosts: kitchen-deploy sudo: yes roles: - { role: geerlingguy.nginx, tags: nginx } host_vars/hosts ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚\u0026lsquo;host_vars\u0026rsquo; ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯æ‰‹å‹•ã§ä½œæˆã—ã¦ãã ã•ã„ã€‚\nlocalhost ansible_connection=local [kitchen-deploy] localhost æ¬¡ã« serverspec ã§è¡Œã†ãƒ†ã‚¹ãƒˆã®å†…å®¹ã‚’ä½œæˆã—ã¾ã™ã€‚ serverspec-init ã‚³ãƒãƒ³ãƒ‰ã§ã¯ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«å›ç­”ã—ã¾ã™ãŒã€SSH ã§ã¯ãªã EXEC(Local) ã‚’é¸æŠã™ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚\n$ mkdir -p test/integration/default/serverspec $ cd test/integration/default/serverspec $ serverspec-init # \u0026lt;--- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«å›ç­” : 1) UNIX, 2) EXEC(Local) ã‚’é¸æŠ $ rm localhost/sample_spec.rb # \u0026lt;--- å¿…è¦ãªã„ã®ã§å‰Šé™¤ test/integration/default/serverspec/localhost/nginx_spec.rb ã¨ã—ã¦ä¸‹è¨˜ã®å†…å®¹ã‚’è©¦ã—ã«æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nrequire \u0026#39;spec_helper\u0026#39; describe package(\u0026#39;nginx\u0026#39;) do it { should be_installed } end describe service(\u0026#39;nginx\u0026#39;) do it { should be_enabled } it { should be_running } end describe file(\u0026#39;/etc/nginx/nginx.conf\u0026#39;) do it { should be_file } end ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚\n. â”œâ”€â”€ nginx â”‚Â â”œâ”€â”€ chefignore â”‚Â â”œâ”€â”€ host_vars â”‚Â â”‚Â â””â”€â”€ hosts â”‚Â â”œâ”€â”€ site.yml â”‚Â â””â”€â”€ test â”‚Â â””â”€â”€ integration â”‚Â â””â”€â”€ default â”‚Â â”œâ”€â”€ Rakefile â”‚Â â””â”€â”€ serverspec â”‚Â â”œâ”€â”€ localhost â”‚Â â”‚Â â””â”€â”€ nginx_spec.rb â”‚Â â””â”€â”€ spec_helper.rb â””â”€â”€ roles â””â”€â”€ geerlingguy.nginx â”œâ”€â”€ README.md \u0026lt;çœç•¥\u0026gt; ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ ç’°å¢ƒä½œæˆãŒå®Œäº†ã—ãŸã® Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã— Ansible ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã€ãã®å¾Œ Serverspec ã§ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¾ã™ã€‚\n$ cd test-kitchen $ kitchen create # \u0026lt;--- Docker ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹• $ kitchen setup # \u0026lt;--- Ansible ãƒ‡ãƒ—ãƒ­ã‚¤ $ kitchen verify # \u0026lt;--- Serverspec ãƒ†ã‚¹ãƒˆ $ kitchen destroy # \u0026lt;--- ã‚³ãƒ³ãƒ†ãƒŠå‰Šé™¤ $ kitchen test # \u0026lt;--- ä¸Šã®4ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä¸€æ°—ã«å®Ÿè¡Œ ã¾ã¨ã‚ Ansible ã§ã‚‚ test-kitchen ã‚’ä½¿ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ãƒ†ã‚¹ãƒˆãŒå‡ºæ¥ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã™ã‚‹ã‚ˆã‚Šã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ã†ã»ã†ãŒå¤±æ•—ã—ãŸéš›ã«å‰Šé™¤ãƒ»èµ·å‹•ã™ã‚‹ã®ã‚‚ä¸€ç¬ã§çµ‚ã‚ã‚Šã¾ã™ã— Ansible é–‹ç™ºãŒé«˜é€ŸåŒ–ã§ãã‚‹ã“ã¨ã‚‚å®Ÿéš›ã«è§¦ã£ã¦ã„ãŸã ã„ã¦ã‚ã‹ã£ã¦ã„ãŸã ã‘ã‚‹ã¨æ€ã„ã¾ã™ã€‚\nãŸã ä¸Šè¨˜ã®æ‰‹é †ã§ã¯ã‚³ãƒ³ãƒ†ãƒŠã®ä¸­ã« Ruby, Chef ã‚‚ä¸€ç·’ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ test-kitchen çš„ã«ã¯ä¸‹è¨˜ã®è¨˜è¿°ã‚’ .kitchen.local.yml ã® provisioner: ã®æ¬„ã«è¨˜è¿°ã™ã‚‹ã¨ Chef ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯çœã‘ã‚‹ã¯ãš (Ruby ã¯ Serverspec ã§ç”¨ã„ã‚‹) ã®ã§ã™ãŒä»Šç¾åœ¨ (2016/7ä¸­æ—¬) ã§ã¯ NG ã§ã—ãŸã€‚ã“ã‚ŒãŒæ­£å¸¸ã«æ©Ÿèƒ½ã™ã‚‹ã‚ˆã†ã«ãªã‚‹ã¨ã‚‚ã£ã¨é«˜é€Ÿã«ã‚³ãƒ³ãƒ†ãƒŠãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã™ã‚‹ã¨æ€ã†ã®ã§æ®‹å¿µã§ã™ã€‚\nrequire_chef_for_busser: false require_ruby_for_busser: true ","permalink":"https://jedipunkz.github.io/post/test-kitchen-with-ansible/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eç§ã‚‚ã‚¤ãƒ³ãƒ•ãƒ©ã®ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ Chef ã§ã¯ãªã Ansible ã‚’ä½¿ã†ã“ã¨ãŒå¢—ãˆãŸã®ã§ã™ãŒã€Chef ã‚’ä½¿ã£ã¦ã„ãŸé ƒã«åŒã˜ãåˆ©ç”¨ã—ã¦ã„ãŸ test-kitchen ãŒä¾¿åˆ©ã ã£ãŸã®ã§ ansible ã¨ä½µç”¨ã§ããªã„ã‹ã¨æ€ã„è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚test-kitchen ã¯ Docker ã‚³ãƒ³ãƒ†ãƒŠã‚„ EC2 ç­‰ã‚’èµ·å‹•ã—ã¦ Chef, Ansible ç­‰ã§æ§‹æˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã— serverspec ç­‰ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã§æ§‹æˆã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ã€‚AWS EC2 ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã‚‚ã„ã„ã®ã§ã™ãŒã€EC2 ã‚’èµ·å‹•ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦å¤±æ•—ã—ãŸã‚‰å‰Šé™¤ã—ã¦ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’å›ã™ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ã ã„ã¶é¢å€’ãªã®ã§ Docker + test-kitchen ã‚’ä½¿ã£ã¦ã“ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’é«˜é€Ÿã«å›ã™æ–¹ãŒãƒ¡ãƒªãƒƒãƒˆãŒå¤§ããã†ã§ã™ã€‚ä»Šå›ã¯ Docker + test-kitchen ã‚’ä½¿ã£ã¦ Ansible Role (Playbook) ã‚’é–‹ç™ºã™ã‚‹ã‚µã‚¤ã‚¯ãƒ«ã‚’é«˜é€ŸåŒ–ã™ã‚‹æ–¹æ³•ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®æ§‹æˆ\"\u003eã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®æ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eæ§‹æˆã¯ã€ç§ã®å ´åˆ Mac OSX ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003etest-kitchen\u003c/li\u003e\n\u003cli\u003ekitchen-ansible (test-kitchen ãƒ‰ãƒ©ã‚¤ãƒ)\u003c/li\u003e\n\u003cli\u003ekitchen-docker (test-kitchen ãƒ‰ãƒ©ã‚¤ãƒ)\u003c/li\u003e\n\u003cli\u003eserverspec\u003c/li\u003e\n\u003cli\u003eansible\u003c/li\u003e\n\u003cli\u003edocker (Docker-machine)\u003c/li\u003e\n\u003cli\u003eVirtualBox\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLinux ã§ãƒã‚¤ãƒ†ã‚£ãƒ–ãª Docker ã‚’ä½¿ã£ã¦ã„ã‚‹æ–¹ã¯ä»¥é™ã€èª­ã¿æ›¿ãˆã¦ä¸‹ã•ã„ã€‚èª­ã¿æ›¿ãˆã‚‹ã®ã¯ãã‚Œã»ã©é›£ã—ããªã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003eã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003eä»Šå›ã¯ä¸Šè¨˜ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯çœãã¾ã™ã€‚test-kitchen, kitchen-ansible, kitchen-docker, serverspec ã¯ Ruby ã§é–‹ç™ºã•ã‚ŒãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãªã®ã§ Gemfile ç­‰ã§ç®¡ç†ã€ansible ã¯ pip ç­‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚\u003c/p\u003e","title":"Test-Kitchen, Docker ã§ Ansible Role é–‹ç™ºã‚µã‚¤ã‚¯ãƒ«é«˜é€ŸåŒ–ï¼"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šå›ã¯ StackStorm (https://stackstorm.com/) ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆãƒ‰ãƒªãƒ–ãƒ³ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ã¿ã¾ã—ãŸã®ã§ ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nã‚¯ãƒ©ã‚¦ãƒ‰ã¨ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã®ç™»å ´ã§æ˜¨ä»Šã¯ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒã»ã¼å…¨ã¦ã®æ“ä½œã‚’è‡ªå‹•åŒ–å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ ã§ã™ãŒç›£è¦–ã«ã¤ã„ã¦ã¯ã©ã†ã§ã—ã‚‡ã†ã‹ï¼Ÿç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‚’è‡ªå‹•ã§æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¦ã‚‚éšœå®³ç™ºç”Ÿæ™‚ã«å¯¾å¿œã‚’è¡Œã† ã®ã¯æ‰‹å‹•ã«ãªã£ã¦ã„ã¾ã›ã‚“ã§ã—ã‚‡ã†ã‹ã€‚ã‚‚ã¡ã‚ã‚“ã‚¯ãƒ©ã‚¹ã‚¿çµ„ã‚“ã§ã„ã‚Œã°å¤§æŠµã®ã‚¢ãƒ©ãƒ¼ãƒˆã¯æ”¾ç½®å‡ºæ¥ã¾ã™ãŒã€ã‚¯ãƒ©ã‚¹ã‚¿ ã‚’çµ„ã‚€ã“ã¨ãŒå‡ºæ¥ãªã„ã‚ˆã†ãªç®‡æ‰€ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ã‚’ä½¿ã£ã¦ã‚‚ã©ã†ã—ã¦ã‚‚å‡ºã¦ãã¾ã™ã€‚\nãã“ã§ç™»å ´ã™ã‚‹ã®ãŒä»Šå›ç´¹ä»‹ã™ã‚‹ StackStorm ã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã‹ãªãã¨è€ƒãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ã¯ä¸‹è¨˜ã® URL ã«ã‚ã‚Šã¾ã™ã€‚\nhttps://docs.stackstorm.com/install/index.html\nè‡ªåˆ†ã¯ CentOS7 ã‚’ä½¿ã£ãŸã®ã§ä¸‹è¨˜ã®ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã—ãŸã€‚ password ã¯ä»»æ„ã®ã‚‚ã®ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚\ncurl -sSL https://stackstorm.com/packages/install.sh | bash -s -- --user=st2admin --password=foo MongoDB, postgreSQL ãŒä¾å­˜ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚\n80ç•ªãƒãƒ¼ãƒˆã§ä¸‹è¨˜ã®ã‚ˆã†ãª WEB UI ã‚‚èµ·å‹•ã—ã¾ã™ã€‚\nStackStorm ã®åŸºæœ¬ åŸºæœ¬ã‚’çŸ¥ã‚‹ãŸã‚ã«å¹¾ã¤ã‹ã®è¦ç´ ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚\nã¾ãš CLI ã§æ“ä½œã™ã‚‹ãŸã‚ã« TOKEN ã‚’å–å¾—ã—ã¦ç’°å¢ƒå¤‰æ•°ã«ã‚»ãƒƒãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ ä¸Šè¨˜ã§è¨­å®šã—ãŸãƒ¦ãƒ¼ã‚¶åãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\nexport ST2_AUTH_TOKEN=`st2 auth -t -p foo st2admin` Action Action ã¯ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸéš›ã«å®Ÿè¡Œã§ãã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ãªã‚Šã¾ã™ã€‚æ—©é€Ÿã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\n$ st2 action list +---------------------------------+---------+-------------------------------------------------------------+ | ref | pack | description | +---------------------------------+---------+-------------------------------------------------------------+ | chatops.format_execution_result | chatops | Format an execution result for chatops | | chatops.post_message | chatops | Post a message to stream for chatops | | chatops.post_result | chatops | Post an execution result to stream for chatops | \u0026lt;çœç•¥\u0026gt; | core.http | core | Action that performs an http request. | | core.local | core | Action that executes an arbitrary Linux command on the | | | | localhost. | | core.local_sudo | core | Action that executes an arbitrary Linux command on the | | | | localhost. | | core.remote | core | Action to execute arbitrary linux command remotely. | | core.remote_sudo | core | Action to execute arbitrary linux command remotely. | | core.sendmail | core | This sends an email | | core.windows_cmd | core | Action to execute arbitrary Windows command remotely. | \u0026lt;çœç•¥\u0026gt; | linux.cp | linux | Copy file(s) | | linux.diag_loadavg | linux | Diagnostic workflow for high load alert | | linux.dig | linux | Dig action | \u0026lt;çœç•¥\u0026gt; | st2.kv.get | st2 | Get value from datastore | | st2.kv.set | st2 | Set value in datastore | +---------------------------------+---------+-------------------------------------------------------------+ ä¸Šè¨˜ã®ã‚ˆã†ã« Linux ã®ã‚³ãƒãƒ³ãƒ‰ã‚„ ChatOps, HTTP ã§ã‚¯ã‚¨ãƒªã‚’æŠ•ã’ã‚‹ã‚‚ã®ã€Key Value ã®èª­ã¿æ›¸ãã‚’è¡Œã†ãƒ¢ãƒã¾ã§ã‚ã‚Šã¾ã™ã€‚ ä¸Šè¨˜ã¯ã‹ãªã‚Šå’²æ¥½ã—ã¦è²¼ã‚Šä»˜ã‘ãŸã®ã§æœ¬æ¥ã¯ã‚‚ã£ã¨æ²¢å±±ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚\nTrigger Trigger ã¯ Action ã‚’å®Ÿè¡Œã™ã‚‹éš›ã®ãƒˆãƒªã‚¬ã«ãªã‚Šã¾ã™ã€‚åŒæ§˜ã«ä¸€è¦§ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\n$ st2 trigger list +--------------------------------------+-------+----------------------------------------------------------------+ | ref | pack | description | +--------------------------------------+-------+----------------------------------------------------------------+ | core.st2.generic.actiontrigger | core | Trigger encapsulating the completion of an action execution. | | core.st2.IntervalTimer | core | Triggers on specified intervals. e.g. every 30s, 1week etc. | | core.st2.generic.notifytrigger | core | Notification trigger. | | core.st2.DateTimer | core | Triggers exactly once when the current time matches the | | | | specified time. e.g. timezone:UTC date:2014-12-31 23:59:59. | | core.st2.action.file_writen | core | Trigger encapsulating action file being written on disk. | | core.st2.CronTimer | core | Triggers whenever current time matches the specified time | | | | constaints like a UNIX cron scheduler. | | core.st2.key_value_pair.create | core | Trigger encapsulating datastore item creation. | | core.st2.key_value_pair.update | core | Trigger encapsulating datastore set action. | | core.st2.key_value_pair.value_change | core | Trigger encapsulating a change of datastore item value. | | core.st2.key_value_pair.delete | core | Trigger encapsulating datastore item deletion. | | core.st2.sensor.process_spawn | core | Trigger indicating sensor process is started up. | | core.st2.sensor.process_exit | core | Trigger indicating sensor process is stopped. | | core.st2.webhook | core | Trigger type for registering webhooks that can consume | | | | arbitrary payload. | | linux.file_watch.line | linux | Trigger which indicates a new line has been detected | +--------------------------------------+-------+----------------------------------------------------------------+ CronTimer ã¯ãã®åã®é€šã‚Š Cron ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚IntervalTimer ã¯åŒã˜ã‚ˆã†ã«ä¸€å®šæ™‚é–“é–“éš”ã§å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã§ã™ã€‚ ãã®ä»– webhook ã‚„ Key Value ã®ãƒšã‚¢ãŒç”Ÿæˆãƒ»å‰Šé™¤ãƒ»å¤‰æ›´ã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€ç­‰ã‚ã‚Šã¾ã™ã€‚\nRule Rule ã¯ Trigger ãŒç™ºç”Ÿã—ã¦ Action ã‚’å®Ÿè¡Œã™ã‚‹éš›ã®ãƒ«ãƒ¼ãƒ«ã‚’è¨˜è¿°ã™ã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚\n$ st2 rule list +----------------+---------+-------------------------------------------------+---------+ | ref | pack | description | enabled | +----------------+---------+-------------------------------------------------+---------+ | chatops.notify | chatops | Notification rule to send results of action | True | | | | executions to stream for chatops | | +----------------+---------+-------------------------------------------------+---------+ åˆæœŸã§ã¯ä¸Šè¨˜ã® chatops.notify ã®ã¿ãŒã‚ã‚Šã¾ã™ã€‚\nå®Ÿéš›ã«ä½¿ã£ã¦ã¿ã‚‹ core.local ã¨ã„ã†ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ãŸã€‚\n$ st2 run core.local -- uname -a id: 5774c022e138230c66f2eefc status: succeeded parameters: cmd: uname -a result: failed: false return_code: 0 stderr: \u0026#39;\u0026#39; stdout: \u0026#39;Linux localhost.localdomain 3.10.0-327.el7.x86_64 #1 SMP Thu Nov 19 22:10:57 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\u0026#39; succeeded: true stdout ã«å®Ÿè¡ŒçµæœãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸä¸‹è¨˜ã®ã‚ˆã†ã«å®Ÿè¡Œçµæœã®ä¸€è¦§ã‚’å¾—ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\n$ st2 execution list +----------------------------+---------------+--------------+-------------------------+-----------------------------+-------------------------------+ | id | action.ref | context.user | status | start_timestamp | end_timestamp | +----------------------------+---------------+--------------+-------------------------+-----------------------------+-------------------------------+ | 5774bdbee138230c66f2eeef | core.local | st2admin | succeeded (0s elapsed) | Thu, 30 Jun 2016 06:35:42 | Thu, 30 Jun 2016 06:35:42 UTC | | | | | | UTC | | +----------------------------+---------------+--------------+-------------------------+-----------------------------+-------------------------------+ å¿œç”¨ã—ãŸä½¿ã„æ–¹ ä¸Šè¨˜ã®ã‚ˆã†ã« core.local, core.remote ç­‰ã§ãƒ›ã‚¹ãƒˆä¸Šã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚ ã“ã“ã§å¿œç”¨ã—ãŸä½¿ã„æ–¹ã‚’ã—ã¦ã¿ã¾ã™ã€‚ã¨è¨€ã„ã¾ã™ã‹ã€ä¸Šè¨˜ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã ã‘ã§ã¯ StackStorm ã‚’ ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆãŒç„¡ã„ã‚ˆã†ã«æ€ãˆã¾ã™ã€‚\nä¸‹è¨˜ã®ã‚ˆã†ãª Rule ã‚’ä½œæˆã—ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«åã¯ st2_sample_rule_webhook_remote_command.yaml ã¨ã—ã¾ã™ã€‚\n--- name: \u0026#34;st2_sample_rule_webhook_remote_command\u0026#34; pack: \u0026#34;examples\u0026#34; description: \u0026#34;Sample rule of webhook.\u0026#34; enabled: true trigger: type: \u0026#34;core.st2.webhook\u0026#34; parameters: url: \u0026#34;restart\u0026#34; criteria: action: ref: \u0026#34;core.remote\u0026#34; parameters: hosts: \u0026#34;10.0.1.250\u0026#34; username: \u0026#34;thirai\u0026#34; private_key: \u0026#34;/root/.ssh/id_rsa\u0026#34; cmd: \u0026#34;sudo service cron restart\u0026#34; StackStorm ã®åŸºæœ¬è¦ç´  Action, Criteria(Rule ã®åŸºæº–), Trigger ã‹ã‚‰æˆã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ Triger ã¯ webhoook ã§ã™ã€‚url: \u0026ldquo;restart\u0026rdquo; ã¨ãªã£ã¦ã„ã‚‹ã®ã¯ URL : https://\u0026lt;stackstorm_ip_addr\u0026gt;/api/v1/webhooks/restart ã¨ã„ã†åå‰ã§ ã‚¢ã‚¯ã‚»ã‚¹ã‚’å—ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ã¨ã„ã†æ„å‘³ã§ã™ã€‚criteria ã¯ä»Šå›ã¯ç„¡æ¡ä»¶ã§ action ã‚’å®Ÿè¡Œã—ãŸã„ã®ã§ç©ºè¡Œã«ã—ã¾ã™ã€‚ action ã§ã¯ core.remote ãŒé¸æŠã•ã‚Œã¦ã„ã¦ hosts: \u0026lsquo;10.0.1.250\u0026rsquo; ã« username ã§ SSH ã—ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚\nè¦ã™ã‚‹ã« https://\u0026lt;stackstorm_ip_addr\u0026gt;/api/v1/webhooks/restart ã¨ã„ã†ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã‚‹ã¨ 10.0.1.250 ã« \u0026lsquo;foo\u0026rsquo; ã¨ã„ã†ãƒ¦ãƒ¼ã‚¶ã§ SSH ã—ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ã«ãªã£ã¦ã„ã¾ã™ã€‚\nä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ä¸Šè¨˜ã® yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ«ãƒ¼ãƒ«ã«èª­ã¿è¾¼ã¿ã¾ã™ã€‚\nst2 rule create st2_sample_rule_webhook_remote_command.yaml å®Ÿéš›ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã¦ã¿ã¾ã—ã‚‡ã†ã€‚Token ã¯èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚\ncurl -k https://localhost/api/v1/webhooks/restart -d \u0026#39;{}\u0026#39; -H \u0026#39;Content-Type: application/json\u0026#39; -H \u0026#39;X-Auth-Token: \u0026lt;Your_Token\u0026gt;\u0026#39; ã™ã‚‹ã¨ãƒªãƒ¢ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã§ \u0026lsquo;cron\u0026rsquo; ãƒ—ãƒ­ã‚»ã‚¹ã®å†èµ·å‹•ãŒæ›ã‹ã‚Šã¾ã™ã€‚\nã¾ã¨ã‚ã¨è€ƒå¯Ÿ StackStorm ã¯ç´¹ä»‹ã—ãŸä»¥å¤–ã«ã‚‚æ²¢å±±ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šå¿œç”¨ãŒåŠ¹ãã¾ã™ã€‚ã¾ãŸç›£è¦–ãƒ„ãƒ¼ãƒ«ã§ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºç”Ÿã—ãŸéš›ã« webhook é€šçŸ¥ã™ã‚‹ã‚ˆã†ã«ã—ã¦ éšœå®³å¯¾å¿œã‚’è‡ªå‹•ã§è¡Œã†ã¨ã„ã£ãŸæ“ä½œã‚‚å¯èƒ½ãªäº‹ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚ChatOps ã§ã‚‚å¿œç”¨ãŒå¯èƒ½ãªã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚å¾“æ¥ã€ChatOps ã§ã¯ãƒªãƒ¢ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã§ ã‚³ãƒãƒ³ãƒ‰ãªã©ã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã—ãŸå ´åˆã«ã¯ Hubot ç­‰ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒç¨¼åƒã—ã¦ã„ã‚‹ãƒ›ã‚¹ãƒˆã‚‚ã—ãã¯ãã®ãƒ›ã‚¹ãƒˆã‹ã‚‰ SSH å‡ºæ¥ã‚‹ãƒ›ã‚¹ãƒˆã§å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸãŒ StackStorm ã‚’ä»‹ã™ã“ã¨ã§å®Ÿè¡Œçµæœã®é–²è¦§ã‚„ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ãŸå®Ÿè¡Œç­‰ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚\nè‡ªåˆ†ã¯ã¾ã å°‘ã—ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ»ãƒ«ãƒ¼ãƒ«ã‚’è©¦ç”¨ã—ãŸã ã‘ãªã®ã§ã™ãŒã€ä»–ã«è‰¯ã„é‹ç”¨ä¸Šã®å¿œç”¨ä¾‹ãŒãªã„ã‹æ¢ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/stackstorm/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ StackStorm (\u003ca href=\"https://stackstorm.com/\"\u003ehttps://stackstorm.com/\u003c/a\u003e) ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆãƒ‰ãƒªãƒ–ãƒ³ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ã¿ã¾ã—ãŸã®ã§\nç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã‚¯ãƒ©ã‚¦ãƒ‰ã¨ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã®ç™»å ´ã§æ˜¨ä»Šã¯ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒã»ã¼å…¨ã¦ã®æ“ä½œã‚’è‡ªå‹•åŒ–å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚\nã§ã™ãŒç›£è¦–ã«ã¤ã„ã¦ã¯ã©ã†ã§ã—ã‚‡ã†ã‹ï¼Ÿç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‚’è‡ªå‹•ã§æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¦ã‚‚éšœå®³ç™ºç”Ÿæ™‚ã«å¯¾å¿œã‚’è¡Œã†\nã®ã¯æ‰‹å‹•ã«ãªã£ã¦ã„ã¾ã›ã‚“ã§ã—ã‚‡ã†ã‹ã€‚ã‚‚ã¡ã‚ã‚“ã‚¯ãƒ©ã‚¹ã‚¿çµ„ã‚“ã§ã„ã‚Œã°å¤§æŠµã®ã‚¢ãƒ©ãƒ¼ãƒˆã¯æ”¾ç½®å‡ºæ¥ã¾ã™ãŒã€ã‚¯ãƒ©ã‚¹ã‚¿\nã‚’çµ„ã‚€ã“ã¨ãŒå‡ºæ¥ãªã„ã‚ˆã†ãªç®‡æ‰€ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ã‚’ä½¿ã£ã¦ã‚‚ã©ã†ã—ã¦ã‚‚å‡ºã¦ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eãã“ã§ç™»å ´ã™ã‚‹ã®ãŒä»Šå›ç´¹ä»‹ã™ã‚‹ StackStorm ã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã‹ãªãã¨è€ƒãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ch2 id=\"ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003eã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003eã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ã¯ä¸‹è¨˜ã® URL ã«ã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://docs.stackstorm.com/install/index.html\"\u003ehttps://docs.stackstorm.com/install/index.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eè‡ªåˆ†ã¯ CentOS7 ã‚’ä½¿ã£ãŸã®ã§ä¸‹è¨˜ã®ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã—ãŸã€‚\npassword ã¯ä»»æ„ã®ã‚‚ã®ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ecurl -sSL https://stackstorm.com/packages/install.sh | bash -s -- --user=st2admin --password=foo\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eMongoDB, postgreSQL ãŒä¾å­˜ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e80ç•ªãƒãƒ¼ãƒˆã§ä¸‹è¨˜ã®ã‚ˆã†ãª WEB UI ã‚‚èµ·å‹•ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cimg src=\"http://jedipunkz.github.io/pix/stackstorm.png\" width=\"70%\"\u003e\n\u003ch2 id=\"stackstorm-ã®åŸºæœ¬\"\u003eStackStorm ã®åŸºæœ¬\u003c/h2\u003e\n\u003cp\u003eåŸºæœ¬ã‚’çŸ¥ã‚‹ãŸã‚ã«å¹¾ã¤ã‹ã®è¦ç´ ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãš CLI ã§æ“ä½œã™ã‚‹ãŸã‚ã« TOKEN ã‚’å–å¾—ã—ã¦ç’°å¢ƒå¤‰æ•°ã«ã‚»ãƒƒãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nä¸Šè¨˜ã§è¨­å®šã—ãŸãƒ¦ãƒ¼ã‚¶åãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eexport ST2_AUTH_TOKEN=`st2 auth -t -p foo st2admin`\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eAction\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAction ã¯ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸéš›ã«å®Ÿè¡Œã§ãã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ãªã‚Šã¾ã™ã€‚æ—©é€Ÿã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e$ st2 action list\n+---------------------------------+---------+-------------------------------------------------------------+\n| ref                             | pack    | description                                                 |\n+---------------------------------+---------+-------------------------------------------------------------+\n| chatops.format_execution_result | chatops | Format an execution result for chatops                      |\n| chatops.post_message            | chatops | Post a message to stream for chatops                        |\n| chatops.post_result             | chatops | Post an execution result to stream for chatops              |\n\u0026lt;çœç•¥\u0026gt;\n| core.http                       | core    | Action that performs an http request.                       |\n| core.local                      | core    | Action that executes an arbitrary Linux command on the      |\n|                                 |         | localhost.                                                  |\n| core.local_sudo                 | core    | Action that executes an arbitrary Linux command on the      |\n|                                 |         | localhost.                                                  |\n| core.remote                     | core    | Action to execute arbitrary linux command remotely.         |\n| core.remote_sudo                | core    | Action to execute arbitrary linux command remotely.         |\n| core.sendmail                   | core    | This sends an email                                         |\n| core.windows_cmd                | core    | Action to execute arbitrary Windows command remotely.       |\n\u0026lt;çœç•¥\u0026gt;\n| linux.cp                        | linux   | Copy file(s)                                                |\n| linux.diag_loadavg              | linux   | Diagnostic workflow for high load alert                     |\n| linux.dig                       | linux   | Dig action                                                  |\n\u0026lt;çœç•¥\u0026gt;\n| st2.kv.get                      | st2     | Get value from datastore                                    |\n| st2.kv.set                      | st2     | Set value in datastore                                      |\n+---------------------------------+---------+-------------------------------------------------------------+\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸Šè¨˜ã®ã‚ˆã†ã« Linux ã®ã‚³ãƒãƒ³ãƒ‰ã‚„ ChatOps, HTTP ã§ã‚¯ã‚¨ãƒªã‚’æŠ•ã’ã‚‹ã‚‚ã®ã€Key Value ã®èª­ã¿æ›¸ãã‚’è¡Œã†ãƒ¢ãƒã¾ã§ã‚ã‚Šã¾ã™ã€‚\nä¸Šè¨˜ã¯ã‹ãªã‚Šå’²æ¥½ã—ã¦è²¼ã‚Šä»˜ã‘ãŸã®ã§æœ¬æ¥ã¯ã‚‚ã£ã¨æ²¢å±±ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e","title":"ã‚¤ãƒ™ãƒ³ãƒˆãƒ‰ãƒªãƒ–ãƒ³ãª StackStorm ã§é‹ç”¨è‡ªå‹•åŒ–"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šå›ã¯ DC/OS (https://dcos.io/) ã‚’ Vagrant ã‚’ä½¿ã£ã¦æ§‹ç¯‰ã—è©•ä¾¡ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚ DC/OS ã¯ãã®åã®é€šã‚Šãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ OS ã¨ã—ã¦åˆ©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’æœŸå¾…ã•ã‚Œé–‹ç™ºã•ã‚ŒãŸ OS ã§å†…éƒ¨ã§ Docker ã¨ Mesos ãŒç¨¼åƒã—ã¦ã„ã¾ã™ã€‚\nä¸€æ˜”å‰ã« Mesos ã®ãƒãƒ«ãƒãƒãƒ¼ãƒ‰æ§‹æˆã¯æ§‹ç¯‰ã—ãŸã“ã¨ã‚ã£ãŸã®ã§ã™ãŒã€DC/OS ã¯ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ãŒå…¨ãå¤‰ã‚ã£ã¦ã„ã¾ã—ãŸã€‚ ã¯ã˜ã‚ã«æƒ³å®šã™ã‚‹æ§‹æˆã‹ã‚‰èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚\næƒ³å®šã™ã‚‹æ§‹æˆ æœ¬æ¥ DC/OS ã¯ public, private ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã§ã™ãŒåˆ©ç”¨ã™ã‚‹ãƒ¬ãƒã‚¸ãƒˆãƒªã§ã¯ã“ã®ã‚ˆã†ãªæ§‹æˆãŒæƒ³å®šã•ã‚Œã¦ã„ã¾ã—ãŸã€‚\n+----+ +----+ +----+ +------+ | m1 | | a1 | | p1 | | boot | +----+ +----+ +----+ +------+ | | | | +------+------+------+--------- 192.168.65/24 å„ãƒãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã®é€šã‚Šå‹•ä½œã—ã¾ã™ã€‚\nm1 : Mesos ãƒã‚¹ã‚¿, Marathon a1 : Mesos ã‚¹ãƒ¬ãƒ¼ãƒ–(Private Agent) p1 : Mesos ã‚¹ãƒ¬ãƒ¼ãƒ–(Public Agent) boot : DC/OS ã‚¤ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒ‰ å‰æã®ç’°å¢ƒ Vagrant ãŒå‹•ä½œã™ã‚‹ãƒã‚·ãƒ³ã§ã‚ã‚Œã°å•é¡Œãªã„ã¨æ€ã„ã¾ã™ãŒç§ã¯ä¸‹è¨˜ã®æ§‹æˆã§åˆ©ç”¨ã—ã¾ã—ãŸã€‚ æ¯”è¼ƒçš„ãŸãã•ã‚“ã®ãƒã‚·ãƒ³ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ã†ã®ã§ãƒ¡ãƒ¢ãƒª 8GB ã¯ã»ã—ã„ã¨ã“ã‚ã§ã™ã€‚\nMac OSX Vagrant Virtualbox äº‹å‰ã®æº–å‚™ äº‹å‰ã®æ‰‹é †ã‚’è¨˜ã—ã¾ã™ã€‚\näºˆã‚ç”¨æ„ã•ã‚ŒãŸ dcos-vagrant ã‚’å–å¾—ã™ã‚‹ $ git clone https://github.com/dcos/dcos-vagrant Mac OSX ã® hosts ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ç·¨é›†ã™ã‚‹ Vagrant ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« $ vagrant plugin install vagrant-hostmanager æ§‹ç¯‰æ‰‹é † ãã‚Œã§ã¯æ§‹ç¯‰æ‰‹é †ã§ã™ã€‚\nDC/OS ãŒåˆ©ç”¨ã™ã‚‹ config ã‚’ç’°å¢ƒå¤‰æ•°ã«æŒ‡å®šæŒ‡å®š $ export DCOS_CONFIG_PATH=etc/config-1.7.yaml DC/OS ã‚’ãƒ¬ãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ DC/OS 1.7.0 (Early Access)(2016/06/21ç¾åœ¨) ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ¬ãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\n$ cd dcos-vagrant $ wget https://downloads.dcos.io/dcos/EarlyAccess/dcos_generate_config.sh VagrantConfig ã‚’ä½œæˆ \u0026lsquo;VagrantConfig.yaml.example\u0026rsquo; ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ¬ãƒã‚¸ãƒˆãƒªå†…ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹ã®ã§ã“ã‚Œã‚’å…ƒã«ä¸‹è¨˜ã®é€šã‚Šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã€‚å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¾ã¾ã ã¨æ¯”è¼ƒçš„å¤§ããª CPU/Mem ãƒªã‚½ãƒ¼ã‚¹ãŒå¿…è¦ã«ãªã‚‹ã®ã§ç’°å¢ƒã«åˆã‚ã›ã¦ãƒªã‚½ãƒ¼ã‚¹é‡ã‚’æŒ‡å®šã€‚\nm1: ip: 192.168.65.90 cpus: 1 memory: 512 type: master a1: ip: 192.168.65.111 cpus: 1 memory: 1024 memory-reserved: 512 type: agent-private p1: ip: 192.168.65.60 cpus: 1 memory: 1024 memory-reserved: 512 type: agent-public aliases: - spring.acme.org - oinker.acme.org boot: ip: 192.168.65.50 cpus: 1 memory: 1024 type: boot ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿæ–½ $ vagrant up m1 a1 p1 boot DC/OS ã® UI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ DC/OS ã® UI ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚\nhttp://m1.dcos/\nMarathon ã® UI ä¸‹è¨˜ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ Marathon ã® UI ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ Marathon ã¯åˆ†æ•£å‹ã® Linux Init æ©Ÿæ§‹ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚\nhttp://m1.dcos:8080/\nChronos ã® UI ä¸‹è¨˜ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ Chronos ã® UI ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ Chronos ã¯åˆ†æ•£å‹ã®ã‚¸ãƒ§ãƒ–ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã§ã‚ã‚Š cron ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚\nhttp://a1.dcos:1370/\nMarathon ã§ redis ã‚µãƒ¼ãƒã‚’ç«‹ã¡ä¸Šã’ã‚‹ ãƒ†ã‚¹ãƒˆã§ redis ã‚µãƒ¼ãƒã‚’ç«‹ã¡ä¸Šã’ã¦ã¿ã‚‹ã€‚Mesos-Slave (ä»Šå›ã®ç’°å¢ƒã ã¨ a1 ãƒ›ã‚¹ãƒˆ) ä¸Šã« Docker ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦ redis ã‚µãƒ¼ãƒãŒç«‹ã¡ä¸ŠãŒã‚‹ã“ã¨ã«ãªã‚‹ã€‚\nMarathon ã® UI ã«ã¦ \u0026ldquo;Create Application\u0026rdquo; ã‚’é¸æŠ General ã‚¿ãƒ–ã® ID ã«ä»»æ„ã®åå‰ã‚’å…¥åŠ› General ã‚¿ãƒ–ã® Command æ¬„ã« \u0026lsquo;redis-server\u0026rsquo; ã‚’å…¥åŠ› Docker Container ã‚¿ãƒ–ã® Image æ¬„ã« \u0026lsquo;redis\u0026rsquo; ã‚’å…¥åŠ› \u0026lsquo;Create Application\u0026rsquo; ã‚’é¸æŠ çµæœã€ä¸‹è¨˜ã®é€šã‚Šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒç”Ÿæˆã•ã‚Œã‚‹\nâ€» 20160625 ä¸‹è¨˜è¿½è¨˜\næ§‹æˆ ã“ã“ã‹ã‚‰ã¯ Mesosphere DC/OS ã®å†…éƒ¨æ§‹æˆã‚’ç†è§£ã—ã¦ã„ãã¾ã™ã€‚ä¸»ã¨ãªã‚‹ mesos-master, mesos-slave ã®æ§‹æˆã¯ä¸‹è¨˜ã®é€šã‚Šã€‚\nMesos-Master Node æ§‹æˆ +--------------+ | mesos-master | +--------------+ +-----------+ +----------+ +-------------+ +-----------+ +-----------+ | zookeeper | | mesos-dns | | marathon | | adminRouter | | minuteman | | exhibitor | +--------------+ +-----------+ +----------+ +-------------+ +-----------+ +-----------+ | mesos-master node | +-------------------------------------------------------------------------------------+ Mesos-Slave (Mesos-Agent) Node æ§‹æˆ +-------------+ +---+---+---+---+ | m-executor | | c | c | c | c | +-------------+ +---+---+---+---+ | mesos-slave | | docker-daemon | +-------------------------------+ | mesos-slave node | +-------------------------------+ å„ãƒ—ãƒ­ã‚»ã‚¹ã®å½¹å‰² ä¸Šè¨˜ã®å›³ã®å„è¦ç´ ã‚’å‚è€ƒè³‡æ–™ã‚’å…ƒã«ã¾ã¨ã‚ã¾ã—ãŸã€‚\nmesos-master masos-slave node ã‹ã‚‰ã®æƒ…å ±ã‚’å—ã‘å–ã‚Š mesos-slave ã¸ãƒ—ãƒ­ã‚»ã‚¹ã‚’åˆ†é…ã™ã‚‹ å½¹å‰²ã€‚mesos-master ã¯ zookeeper ã«ã‚ˆã£ã¦ãƒªãƒ¼ãƒ€ãƒ¼é¸å‡ºã«ã‚ˆã‚Šå†—é•·æ§‹æˆãŒä¿ ãŸã‚Œã¦ã„ã‚‹ã€‚\nmesos-dns mesos ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å†…ã§ã® DNS è§£æ±ºã‚’è¡Œã†ãƒ—ãƒ­ã‚»ã‚¹ã€‚å„ mesos-master ãƒãƒ¼ ãƒ‰ä¸Šã«ç¨¼åƒã—ã¦ã„ã‚‹ã€‚é€šå¸¸ã® DNS ã§ã„ã†ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ DNS (Authoritative DNS)ã«ãªã£ã¦ãŠã‚Š mesos-master ã‹ã‚‰ã‚¯ãƒ©ã‚¹ã‚¿æƒ…å ±ã‚’å—ã‘å–ã£ã¦ DNS ãƒ¬ã‚³ãƒ¼ ãƒ‰ç™»éŒ²ã€ãã‚Œã‚’ mesos-slave ãŒ DNS å‚ç…§ã™ã‚‹ã€‚mesos-slave ãŒå†…éƒ¨ãƒ¬ã‚³ãƒ¼ãƒ‰ ã«ç„¡ã„ DNS åã‚’è§£æ±ºã—ã«æ¥ãŸéš›ã«ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã® root DNS ã¸å•ã„åˆ ã‚ã›å®Ÿæ–½ã€‚\nmarathon ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¸ã‚Š mesos-slave ã¸æ”¯æŒã‚’å‡ºã—ã‚³ãƒ³ãƒ†ãƒŠã‚’ ç¨¼åƒã™ã‚‹å½¹å‰²ã€‚å„ mesos-master ä¸Šã§ç¨¼åƒã— zookeeper è¶Šã—ã« mesos-master ã®ã‚«ãƒ¬ãƒ³ãƒˆãƒªãƒ¼ãƒ€ã‚’æ¢ã—ã ã—ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‰µå‡ºã€‚ä»–ã«ä¸‹è¨˜ã®æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã‚‹ã€‚ \u0026lsquo;HA\u0026rsquo;, \u0026lsquo;ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚¹\u0026rsquo;, \u0026lsquo;ã‚¢ãƒ—ãƒªã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯\u0026rsquo;, \u0026lsquo;Web UI\u0026rsquo;, \u0026lsquo;REST API\u0026rsquo;, \u0026lsquo;Metrics\u0026rsquo;ã€‚\nadminRouter å®Ÿæ…‹ã¯ nginxã€‚å„ã‚µãƒ¼ãƒ“ã‚¹ã®èªè¨¼ã¨ Proxy ã®å½¹å‰²ã‚’æ‹…ã£ã¦ã„ã‚‹ã€‚\nminuteman L4 ãƒ¬ã‚¤ãƒ¤ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã€‚å„ mesos-master ãƒãƒ¼ãƒ‰ã§ç¨¼åƒã€‚\nzookeeper mesos-master ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†—é•·æ§‹æˆã•ã›ã‚‹ãŸã‚ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã€‚\nexhibitor zookeeper ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿæ–½ã€‚\nmesos-slave Task ã‚’å®Ÿè¡Œã™ã‚‹å½¹å‰²ã€‚å†…éƒ¨ã§ meosos-executor (ä¸Šè¨˜ m-executor) ã‚’å®Ÿè¡Œã— ã¦ã„ã‚‹ã€‚\nm-executor (mesos-executor) mesos-slave ãƒãƒ¼ãƒ‰ä¸Šã§ã‚µãƒ¼ãƒ“ã‚¹ã®ãŸã‚ã® TASK ã‚’ç¨¼åƒã•ã›ã‚‹ã€‚\nèµ·å‹•ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ ã“ã“ã‹ã‚‰ã¯ mesos-master, mesos-slave ã®èµ·å‹•ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«ã¤ã„ã¦ã€ã¾ã¨ã‚ã¦ãã¾ã™ã€‚\nmesos-master\nexhibitor ãŒèµ·å‹•ã— zookeeper ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿæ–½ã— zookeeper ã‚’èµ·å‹• mesos-master ãŒèµ·å‹•ã€‚è‡ªåˆ†è‡ªèº«ã‚’ãƒ¬ã‚¸ã‚¹ãƒˆå¾Œã€ä»–ã® mesos-master ãƒãƒ¼ãƒ‰ã‚’æ¢ç´¢ mesos-dns ãŒèµ·å‹• mesos-dns ãŒ leader.mesos ã«ã‚«ãƒ¬ãƒ³ãƒˆãƒªãƒ¼ãƒ€ã® mesos-master ã‚’ç™»éŒ² marathon ãŒèµ·å‹•ã— zookeeper è¶Šã—ã« mesos-master ã‚’æ¢ç´¢ã€‚ adminRouter ãŒèµ·å‹•ã—å„ UI (mesos, marathon, exhibitor) ãŒé–²è¦§å¯èƒ½ã«ã€‚ mesos-slave\nleader.mesos ã« ping ã‚’æ‰“ã£ã¦ mesos-master ã®ã‚«ãƒ¬ãƒ³ãƒˆãƒªãƒ¼ãƒ€ã‚’è¦‹ã¤ã‘å‡ºã— mesos-slave ç¨¼åƒã€‚ mesos-master ã«å¯¾ã—ã¦è‡ªåˆ†è‡ªèº«ã‚’ \u0026lsquo;agent\u0026rsquo; ã¨ã—ã¦ç™»éŒ²ã€‚ mesos-master ã¯ãã®ç™»éŒ²ã•ã‚ŒãŸ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…ƒã«æ¥ç¶šã‚’è©¦ã¿ã‚‹ mesos-slave ãŒ TASK å®Ÿè¡Œå¯èƒ½ãªçŠ¶æ…‹ã« ã¾ã¨ã‚ã¨è€ƒå¯Ÿ ä¸€æ˜”å‰ã® Mesos + Marathon + Chronos ã¨ã¯ã ã„ã¶ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ãŒå¤‰ã‚ã£ã¦ã„ãŸã€‚ã ãŒæ§‹æˆã«ã¯å¤§ããªå¤‰åŒ–ã¯è¦‹ã‚‰ã‚Œãªã„ã€‚ AWS ã®ã‚ˆã†ãª public, private ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒåˆ¥ã‚ŒãŸãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã¯ mesos-slave (DC/OS çš„ã«ã¯ Agent ã¨ã‚‚å‘¼ã¶)ã¯ public agent, private agent ã¨ã—ã¦åˆ¥ã‘ã¦ç®¡ç†ã•ã‚Œã‚‹æ¨¡æ§˜ã€‚public agent ã¯ AWS ã® ELB ç­‰ã§åˆ†æ•£ã•ã‚Œå„ã‚³ãƒ³ãƒ†ãƒŠä¸Šã®ã‚¢ãƒ—ãƒªã«ã‚¯ã‚¨ãƒªãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œãˆã‚‹ã€‚private agent ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã«é…ç½®ã•ã‚Œã¦ public agent ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚‚å¿œãˆã‚‹ã€‚ã¾ãŸã€mesos-master é”ã¯åˆ¥é€” admin ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«é…ç½®ã™ã‚‹ã®ãŒ Mesosphare ã®æ¨å¥¨ã‚‰ã—ã„ã€‚\nã ãŒã—ã‹ã— public, private ã‚’åˆ¥ã‘ãšã« DC/OS ã‚’æ§‹æˆã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ãªã‚ˆã†ã«æ€ãˆãŸã€‚ä¸‹è¨˜ã®ã‚ˆã†ã« p1 ã‚’å‰Šé™¤ã—ã¦æ§‹æˆã—ã¦ç‰©ç†ãƒ»ä»®æƒ³ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ private agent ã«é€å‡ºã™ã‚‹ã“ã¨ã§ã‚‚ DC/OS ã¯æ©Ÿèƒ½ã™ã‚‹ã®ã§ã€‚\n$ vagrant up m1 a1 boot ã¡ãªã¿ã« a2, a3, \u0026hellip; ã¨æ•°ã‚’å¢—ã‚„ã™ã“ã¨ã§ private agent ãƒãƒ¼ãƒ‰ã‚’å¢—ã‚„ã™ã“ã¨ãŒå¯èƒ½ã€‚\nã‚ã¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †(å…¬å¼)ã‚’å®Ÿæ–½ã—ã¦ã¿ã¦è§£ã£ãŸãŒã€pulic, private ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å„ãƒãƒ¼ãƒ‰ã«ã‚¢ã‚¿ãƒƒãƒã—ã¦ mesos-master, mesos-slave, ã¾ãŸãã®ä»–ã®å„æ©Ÿèƒ½ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ã€å¤–éƒ¨ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œãˆã‚‹ãŸã‚ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€ã¨ã„ã£ãŸæ§‹æˆã‚‚å¯èƒ½ã§ã—ãŸã€‚\nå‚è€ƒ URL æ‰‹é †ã¯å³è¨˜ã®ã‚‚ã®ã‚’åˆ©ç”¨ã€‚ https://github.com/dcos/dcos-vagrant/blob/master/docs/deploy.md https://docs.mesosphere.com/1.7/overview/architecture/ https://docs.mesosphere.com/1.7/overview/security/ ","permalink":"https://jedipunkz.github.io/post/mesos-dcos-vagrant/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ DC/OS (\u003ca href=\"https://dcos.io/\"\u003ehttps://dcos.io/\u003c/a\u003e) ã‚’ Vagrant ã‚’ä½¿ã£ã¦æ§‹ç¯‰ã—è©•ä¾¡ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\nDC/OS ã¯ãã®åã®é€šã‚Šãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ OS ã¨ã—ã¦åˆ©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’æœŸå¾…ã•ã‚Œé–‹ç™ºã•ã‚ŒãŸ OS ã§å†…éƒ¨ã§\nDocker ã¨ Mesos ãŒç¨¼åƒã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä¸€æ˜”å‰ã« Mesos ã®ãƒãƒ«ãƒãƒãƒ¼ãƒ‰æ§‹æˆã¯æ§‹ç¯‰ã—ãŸã“ã¨ã‚ã£ãŸã®ã§ã™ãŒã€DC/OS ã¯ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ãŒå…¨ãå¤‰ã‚ã£ã¦ã„ã¾ã—ãŸã€‚\nã¯ã˜ã‚ã«æƒ³å®šã™ã‚‹æ§‹æˆã‹ã‚‰èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æƒ³å®šã™ã‚‹æ§‹æˆ\"\u003eæƒ³å®šã™ã‚‹æ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eæœ¬æ¥ DC/OS ã¯ public, private ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã§ã™ãŒåˆ©ç”¨ã™ã‚‹ãƒ¬ãƒã‚¸ãƒˆãƒªã§ã¯ã“ã®ã‚ˆã†ãªæ§‹æˆãŒæƒ³å®šã•ã‚Œã¦ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e+----+ +----+ +----+ +------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e| m1 | | a1 | | p1 | | boot |\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e+----+ +----+ +----+ +------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e|      |      |      |\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e+------+------+------+--------- 192.168.65/24\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå„ãƒãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã®é€šã‚Šå‹•ä½œã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003em1 : Mesos ãƒã‚¹ã‚¿, Marathon\u003c/li\u003e\n\u003cli\u003ea1 : Mesos ã‚¹ãƒ¬ãƒ¼ãƒ–(Private Agent)\u003c/li\u003e\n\u003cli\u003ep1 : Mesos ã‚¹ãƒ¬ãƒ¼ãƒ–(Public Agent)\u003c/li\u003e\n\u003cli\u003eboot : DC/OS ã‚¤ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒ‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å‰æã®ç’°å¢ƒ\"\u003eå‰æã®ç’°å¢ƒ\u003c/h2\u003e\n\u003cp\u003eVagrant ãŒå‹•ä½œã™ã‚‹ãƒã‚·ãƒ³ã§ã‚ã‚Œã°å•é¡Œãªã„ã¨æ€ã„ã¾ã™ãŒç§ã¯ä¸‹è¨˜ã®æ§‹æˆã§åˆ©ç”¨ã—ã¾ã—ãŸã€‚\næ¯”è¼ƒçš„ãŸãã•ã‚“ã®ãƒã‚·ãƒ³ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ã†ã®ã§ãƒ¡ãƒ¢ãƒª 8GB ã¯ã»ã—ã„ã¨ã“ã‚ã§ã™ã€‚\u003c/p\u003e","title":"Vagrant ã§ Mesosphere DC/OS ã‚’æ§‹ç¯‰"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nInfluxdb ãŒ Influxdata (https://influxdata.com/) ã¨ã—ã¦ç”Ÿã¾ã‚Œå¤‰ã‚ã‚Šå…¬å¼ã® ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ Telegraf ã¨å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ« Chronograf ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ãŸã®ã§ ä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚\n3ã¤ã®ãƒ„ãƒ¼ãƒ«ã®å½¹å‰²ã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\nChronograf : å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«, Grafana ç›¸å½“ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ Telegraf : ãƒ¡ãƒˆãƒªã‚¯ã‚¹æƒ…å ±ã‚’ Influxdb ã«é€ä¿¡ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ Influxdb : ãƒ¡ãƒˆãƒªã‚¯ã‚¹æƒ…å ±ã‚’æ ¼ç´ã™ã‚‹æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ä»¥å‰ã« cAdvisor, influxdb, grafana ã‚’ä½¿ã£ã¦ Docker ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å¯è¦– åŒ–ã™ã‚‹è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸãŒ telegraf ã‚’ä½¿ã†ã¨ã‚µãƒ¼ãƒæƒ…å ±ã¨åˆã‚ã›ã¦ Docker ã‚³ãƒ³ãƒ†ãƒŠ ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚‚ influxdb ã«é€ä¿¡ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚å€‹äººçš„ã«ã¯ãã®ã‚³ãƒ³ãƒ†ãƒŠæƒ…å ±ã® æ‰±ã„ã‚‚ã‚µãƒ¼ãƒæƒ…å ±ã¨åŒæ§˜ã«æ‰±ã£ã¦ãã‚Œã‚‹ç‚¹ã«æœŸå¾…ã—ã¤ã¤ã€è©•ä¾¡ã—ã¦ã¿ã¾ã—ãŸã€‚\nä»Šå›ã®ç’°å¢ƒ ä»Šå›ã¯ Ubuntu 15.04 vivid64 ã‚’ä½¿ã£ã¦ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã™ã€‚\ninfluxdb ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦èµ·å‹• æœ€æ–°ãƒªãƒªãƒ¼ã‚¹ç‰ˆã® deb ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒç”¨æ„ã•ã‚Œã¦ã„ãŸã®ã§ã“ã‚Œã‚’ä½¿ã„ã¾ã—ãŸã€‚\nwget http://influxdb.s3.amazonaws.com/influxdb_0.9.5.1_amd64.deb sudo dpkg -i influxdb_0.9.5.1_amd64.deb sudo service influxdb start telegraf ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨èµ·å‹• ã“ã¡ã‚‰ã‚‚ deb ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã€‚\nwget http://get.influxdb.org/telegraf/telegraf_0.2.4_amd64.deb sudo dpkg -i telegraf_0.2.4_amd64.deb ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ãŒä»Šå›ã¯ CPU, Disk, Net, Docker ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹æƒ…å ±ã‚’é€ ä¿¡ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚\n[agent] interval = \u0026#34;0.1s\u0026#34; [outputs] [outputs.influxdb] urls = [\u0026#34;http://localhost:8086\u0026#34;] database = \u0026#34;telegraf-test\u0026#34; user_agent = \u0026#34;telegraf\u0026#34; [plugins] [[plugins.cpu]] percpu = true totalcpu = false drop = [\u0026#34;cpu_time*\u0026#34;] [[plugins.disk]] [plugins.disk.tagpass] fstype = [ \u0026#34;ext4\u0026#34;, \u0026#34;xfs\u0026#34; ] #path = [ \u0026#34;/home*\u0026#34; ] [[plugins.disk]] pass = [ \u0026#34;disk_inodes*\u0026#34; ] [[plugins.docker]] [[plugins.net]] interfaces = [\u0026#34;eth0\u0026#34;] ä»–ã«ã‚‚è‰²ã€…ãƒ¡ãƒˆãƒªã‚¯ã‚¹æƒ…å ±ã‚’å–å¾—ã§ããã†ã§ã™ã€ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã‚’å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ https://github.com/influxdb/telegraf/blob/0.3.0/CONFIGURATION.md\ntelegraf ã‚’èµ·å‹•ã—ã¾ã™ã€‚Docker ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å–å¾—ã™ã‚‹ãŸã‚ã« root ãƒ¦ãƒ¼ã‚¶ ã§èµ·å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nsudo telegraf -config telegraf.conf chronograf ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨èµ·å‹• ã“ã¡ã‚‰ã‚‚ deb ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\nwget https://s3.amazonaws.com/get.influxdb.org/chronograf/chronograf_0.4.0_amd64.deb sudo dpkg -i chronograf_0.4.0_amd64.deb sudo /opt/chronograf/chronograf -sample-config \u0026gt; /opt/chronograf/config.toml sudo service chronograf start ã‚°ãƒ©ãƒ•ã®æç”» ã“ã®çŠ¶æ…‹ã§ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nhttp://\u0026lt;ãƒ›ã‚¹ãƒˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹\u0026gt;:10000/\nã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ç°¡å˜ãªã‚¬ã‚¤ãƒ‰ãŒèµ°ã‚Šã¾ã™ã®ã§ã“ã“ã§ã¯è¨­å®šæ–¹æ³•ã¯çœãã¾ã™ã€‚Grafana ã‚’ä½¿ã£ãŸå ´åˆã¨ åŒæ§˜ã«æ°—ã‚’ã¤ã‘ã‚‹ãƒã‚¤ãƒ³ãƒˆã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\n\u0026lsquo;filter by\u0026rsquo; ã«æç”»ã—ãŸã„ãƒªã‚½ãƒ¼ã‚¹åã‚’é¸æŠ(CPU,Disk,Net,Dockerã®å„ãƒªã‚½ãƒ¼ã‚¹) Database ã« telegraf.conf ã«è¨˜ã—ãŸ \u0026rsquo;telegraf-test\u0026rsquo; ã‚’é¸æŠ ã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªã‚°ãƒ©ãƒ•ã‚„ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ä¸‹è¨˜ã¯ CPU ä½¿ç”¨ç‡ã‚’ã‚° ãƒ©ãƒ•åŒ–ã—ãŸã‚‚ã®ã§ã™ã€‚\nã“ã¡ã‚‰ã¯ Docker é–¢é€£ã®ã‚°ãƒ©ãƒ•ã€‚\nè¤‡æ•°ã®ã‚°ãƒ©ãƒ•ã‚’1ã¤ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã¾ã¨ã‚ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã‚ˆã†ã§ã™ã€‚\nã¾ã¨ã‚ +++\nå€‹äººçš„ã«ã¯ Grafana ã® UI ã¯ã¨ã¦ã‚‚ã‚ã‹ã‚Šãšã‚‰ã‹ã£ãŸã®ã§å…¬å¼ã®å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«ãŒå‡ºã¦ãã¦è‰¯ã‹ã£ãŸ ã¨æ€ã£ã¦ã„ã¾ã™ã€‚æ“ä½œã‚‚ã¨ã¦ã‚‚ç†è§£ã—ã‚„ã™ããªã£ã¦ã„ã¾ã™ã€‚Telegraf ã«ã¤ã„ã¦ã‚‚å…¬å¼ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ æƒ…å ±é€ä¿¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã„ã†ã“ã¨ã§å®‰å¿ƒæ„ŸãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸ Grafana ã¯åˆ¥é€” HTTP ã‚µãƒ¼ ãƒãŒå¿…è¦ã§ã—ãŸãŒ Chronograf ã¯ HTTP ã‚µãƒ¼ãƒã‚‚å†…åŒ…ã—ã¦ã„ã‚‹ã®ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒç°¡å˜ ã§ã—ãŸã€‚\nãŸã  configuration guide ãŒã¾ã ã¾ã èª¬æ˜ä¸ååˆ†ãªã®ã§å‡ã£ãŸã“ã¨ã‚’ã—ã‚ˆã†ã™ã¨ã™ã‚‹ ã¨ã‚½ãƒ¼ã‚¹ã‚’èª­ã¾ãªãã¦ã¯ã„ã‘ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\nã„ãšã‚Œã«ã—ã¦ã‚‚ã‚µãƒ¼ãƒã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹æƒ…å ±ã¨å…±ã« cAdvisor ç­‰ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ç”¨ã„ãªã ã¦ã‚‚ã‚µãƒ¼ãƒä¸Šã§ç¨¼åƒã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠå‘¨ã‚Šã®æƒ…å ±ã‚‚å–å¾—ã§ããŸã®ã§å€‹äººçš„ã«ã¯ãƒãƒƒãƒ”ãƒ¼ã€‚ cAdvisor ã§ã—ã‹å–å¾—ã§ããªã„æƒ…å ±ã‚‚ã‚ã‚Šãã†ã§ã™ãŒä»Šå¾Œã€å°å…¥ã‚’æ¤œè¨ã™ã‚‹ä¸Šã§è©•ä¾¡ã— ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2015/12/28/chronograf-telegraf-influxdb/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eInfluxdb ãŒ Influxdata (\u003ca href=\"https://influxdata.com/\"\u003ehttps://influxdata.com/\u003c/a\u003e) ã¨ã—ã¦ç”Ÿã¾ã‚Œå¤‰ã‚ã‚Šå…¬å¼ã®\nãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ Telegraf ã¨å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ« Chronograf ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ãŸã®ã§\nä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003e3ã¤ã®ãƒ„ãƒ¼ãƒ«ã®å½¹å‰²ã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eChronograf : å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«, Grafana ç›¸å½“ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™\u003c/li\u003e\n\u003cli\u003eTelegraf : ãƒ¡ãƒˆãƒªã‚¯ã‚¹æƒ…å ±ã‚’ Influxdb ã«é€ä¿¡ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ\u003c/li\u003e\n\u003cli\u003eInfluxdb : ãƒ¡ãƒˆãƒªã‚¯ã‚¹æƒ…å ±ã‚’æ ¼ç´ã™ã‚‹æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä»¥å‰ã« cAdvisor, influxdb, grafana ã‚’ä½¿ã£ã¦ Docker ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å¯è¦–\nåŒ–ã™ã‚‹è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸãŒ telegraf ã‚’ä½¿ã†ã¨ã‚µãƒ¼ãƒæƒ…å ±ã¨åˆã‚ã›ã¦ Docker ã‚³ãƒ³ãƒ†ãƒŠ\nã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚‚ influxdb ã«é€ä¿¡ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚å€‹äººçš„ã«ã¯ãã®ã‚³ãƒ³ãƒ†ãƒŠæƒ…å ±ã®\næ‰±ã„ã‚‚ã‚µãƒ¼ãƒæƒ…å ±ã¨åŒæ§˜ã«æ‰±ã£ã¦ãã‚Œã‚‹ç‚¹ã«æœŸå¾…ã—ã¤ã¤ã€è©•ä¾¡ã—ã¦ã¿ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ch2 id=\"ä»Šå›ã®ç’°å¢ƒ\"\u003eä»Šå›ã®ç’°å¢ƒ\u003c/h2\u003e\n\u003cp\u003eä»Šå›ã¯ Ubuntu 15.04 vivid64 ã‚’ä½¿ã£ã¦ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"influxdb-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦èµ·å‹•\"\u003einfluxdb ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦èµ·å‹•\u003c/h2\u003e\n\u003cp\u003eæœ€æ–°ãƒªãƒªãƒ¼ã‚¹ç‰ˆã® deb ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒç”¨æ„ã•ã‚Œã¦ã„ãŸã®ã§ã“ã‚Œã‚’ä½¿ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ewget http://influxdb.s3.amazonaws.com/influxdb_0.9.5.1_amd64.deb\nsudo dpkg -i influxdb_0.9.5.1_amd64.deb\nsudo service influxdb start\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"telegraf-ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨èµ·å‹•\"\u003etelegraf ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨èµ·å‹•\u003c/h2\u003e\n\u003cp\u003eã“ã¡ã‚‰ã‚‚ deb ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ewget http://get.influxdb.org/telegraf/telegraf_0.2.4_amd64.deb\nsudo dpkg -i telegraf_0.2.4_amd64.deb\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ãŒä»Šå›ã¯ CPU, Disk, Net, Docker ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹æƒ…å ±ã‚’é€\nä¿¡ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚\u003c/p\u003e","title":"Chronograf, Telegraf, Influxdbã§ã‚µãƒ¼ãƒã¨ã‚³ãƒ³ãƒ†ãƒŠæƒ…å ±ã‚’å¯è¦–åŒ–ã™ã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šå›ã¯ Weave ã¨ã„ã†ã‚³ãƒ³ãƒ†ãƒŠé–“ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æä¾›ã—ã¦ãã‚Œã‚‹ Docker ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ© ã‚°ã‚¤ãƒ³ã‚’ä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚ä¸‹è¨˜ã®ã‚ˆã†ãªæ²¢å±±ã®æ©Ÿèƒ½ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚\nFast Data Path Docker Network Plugin Security Dynamic Netwrok Attachment Service Binding Fault Tolerance etc \u0026hellip; ã“ã®è¨˜äº‹ã§ã¯ä¸Šã‹ã‚‰å¹¾ã¤ã‹æŠœç²‹ã—ã¦ã€Weave ã£ã¦ã©ã®ã‚ˆã†ã«å‹•ã‹ã›ã‚‹ã®ã‹ï¼Ÿã‚’è§£èª¬ã—ã¾ã™ã€‚ ãã“ã‹ã‚‰ Weave ãŒä¸€ä½“ãƒŠãƒ‹ãƒ¢ãƒãªã®ã‹ç†è§£ã§ãã‚Œã°ãªãã¨æ€ã„ã¾ã™ã€‚\nVagrant ã‚’ä½¿ã£ãŸæ§‹æˆ ã“ã®è¨˜äº‹ã§ã¯ä¸‹è¨˜ã®æ§‹æˆã‚’ä½œã£ã¦è‰²ã€…ã¨è©¦ã—ã¦ã„ãã¾ã™ã€‚ä½¿ã†æŠ€è¡“ã¯\nVagrant Docker Weave ã§ã™ã€‚\n+---------------------+ +---------------------+ +---------------------+ | docker container a1 | | docker container a2 | | docker container a3 | +---------------------+ +---------------------+ +---------------------+ | vagrant host 1 | | vagrant host 2 | | vagrant host 3 | +---------------------+-+---------------------+-+---------------------+ | Mac or Windows | +---------------------------------------------------------------------+ ç‰¹å¾´ã¨ã—ã¦ã¯\nä½œæ¥­ç«¯æœ«(Mac or Windows or Linux)ä¸Šã§ Vagrant ã‚’å‹•ä½œã•ã›ã‚‹ å„ Vagrant VM åŒå£«ã¯ãƒ›ã‚¹ãƒˆ OS ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä¸Šã§ç–é€šãŒå–ã‚Œã‚‹ ã§ã™ã€‚\nVagrantfile ã®ä½œæˆã¨ host1,2,3 ã®èµ·å‹• ä¸Šè¨˜ã®3å°ã®æ§‹æˆã‚’ä¸‹è¨˜ã® Vagrantfile ã§æ§‹ç¯‰ã—ã¾ã™ã€‚\nVagrant.configure(2) do |config| config.vm.box = \u0026#34;ubuntu/vivid64\u0026#34; config.vm.define \u0026#34;host1\u0026#34; do |server| server.vm.network \u0026#34;private_network\u0026#34;, ip: \u0026#34;192.168.33.11\u0026#34; end config.vm.define \u0026#34;host2\u0026#34; do |server| server.vm.network \u0026#34;private_network\u0026#34;, ip: \u0026#34;192.168.33.12\u0026#34; end config.vm.define \u0026#34;host3\u0026#34; do |server| server.vm.network \u0026#34;private_network\u0026#34;, ip: \u0026#34;192.168.33.13\u0026#34; end config.vm.provision :shell, inline: \u0026lt;\u0026lt;-SHELL apt-get update apt-get install -y libsqlite3-dev docker.io curl -L git.io/weave -o /usr/local/bin/weave chmod a+x /usr/local/bin/weave SHELL end vagrant ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ host1, host2, host3 ã‚’èµ·å‹•ã—ã¾ã™ã€‚\n$ vagrant up $ vagrant ssh host1 # \u0026lt;--- host1 ã« SSH ã™ã‚‹å ´åˆ $ vagrant ssh host2 # \u0026lt;--- host2 ã« SSH ã™ã‚‹å ´åˆ $ vagrant ssh host3 # \u0026lt;--- host3 ã« SSH ã™ã‚‹å ´åˆ ç‰©ç†ãƒãƒ¼ãƒ‰ã¾ãŸãŒã£ãŸã‚³ãƒ³ãƒ†ãƒŠé–“ã§é€šä¿¡ã‚’ã™ã‚‹ weave ã§ã¾ãšç‰©ç†ãƒãƒ¼ãƒ‰ã‚’ã¾ãŸãŒã£ãŸã‚³ãƒ³ãƒ†ãƒŠé–“ã§é€šä¿¡ã‚’ã•ã›ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã“ã“ã§ã¯ ä¸Šå›³ã® host1, host2 ã‚’ä½¿ã„ã¾ã™ã€‚é€šå¸¸ã€ç‰©ç†ãƒãƒ¼ãƒ‰ã¾ãŸãŒã£ã¦ã„ã‚‹ã¨å„ã€…ã®ãƒ›ã‚¹ãƒˆã§ ç¨¼åƒã™ã‚‹ Docker ã‚³ãƒ³ãƒ†ãƒŠã¯é€šä¿¡ã—åˆãˆã¾ã›ã‚“ãŒ weave ã‚’ä½¿ã†ã¨é€šä¿¡ã—ã‚ã†ã“ã¨ãŒå‡º æ¥ã¾ã™ã€‚\nã¾ãš weave ãŒç”¨ã„ã‚‹ Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’ç¨¼åƒã—ã¾ã™ã€‚ä¸‹è¨˜ã®ã‚ˆã†ã« /16 ã§ãƒ¬ãƒ³ã‚¸ã‚’åˆ‡ã£ã¦ æ›´ã«ãã“ã‹ã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ¬ãƒ³ã‚¸ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\nhost1# weave launch --ipalloc-range 10.2.0.0/16 --ipalloc-default-subnet 10.2.1.0/24 host1# eval $(weave env) host2# weave launch --ipalloc-range 10.2.0.0/16 --ipalloc-default-subnet 10.2.1.0/24 192.168.33.11 host2# eval $(weave env) ã“ã®çŠ¶æ…‹ã§ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒ³ãƒ†ãƒŠãŒç¨¼åƒã—ã¾ã™ã€‚\nhost1# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c55e96b4bdf9 weaveworks/weaveexec:1.4.0 \u0026#34;/home/weave/weavepr 4 seconds ago Up 3 seconds weaveproxy 394382c9c5d9 weaveworks/weave:1.4.0 \u0026#34;/home/weave/weaver 5 seconds ago Up 4 seconds weave host1, host2 ã§ãã‚Œãã‚Œãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ³ãƒ†ãƒŠã‚’ç¨¼åƒã•ã›ã¾ã™ã€‚åå‰ã‚’ \u0026ndash;name ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ä»˜ã‘ã‚‹ã®ã‚’ å¿˜ã‚Œãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚\nhost1# docker run --name a1 -ti ubuntu host2# docker run --name a2 -ti ubuntu ã©ã¡ã‚‰ã‹ä¸€æ–¹ã‹ã‚‰ ping ã‚’ã‚‚ã†ä¸€æ–¹ã«æ‰“ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä¸‹è¨˜ã§ã¯ a2 -\u0026gt; a1 ã®æµã‚Œã§ ping ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚\nroot@a2:/# ping 10.2.1.1 -c 3 PING 10.2.1.1 (10.2.1.1) 56(84) bytes of data. 64 bytes from 10.2.1.1: icmp_seq=1 ttl=64 time=0.316 ms 64 bytes from 10.2.1.1: icmp_seq=2 ttl=64 time=0.501 ms 64 bytes from 10.2.1.1: icmp_seq=3 ttl=64 time=0.619 ms --- 10.2.1.1 ping statistics --- 3 packets transmitted, 3 received, 0% packet loss, time 1999ms rtt min/avg/max/mdev = 0.316/0.478/0.619/0.127 ms ã¾ãŸ docker ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹æ™‚ã«æŒ‡å®šã—ãŸ \u0026ndash;name a1, \u0026ndash;name a2 ã®åå‰ã§ ping ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã“ã‚Œã‚‚ weave ã®æ©Ÿèƒ½ã®ï¼‘ã¤ã§ dns lookup ãŒè¡Œãˆã¾ã™ã€‚\nroot@b2:/# ping a1 -c 3 PING b1.weave.local (10.2.1.1) 56(84) bytes of data. 64 bytes from a1.weave.local (10.2.1.1): icmp_seq=1 ttl=64 time=1.14 ms 64 bytes from a1.weave.local (10.2.1.1): icmp_seq=2 ttl=64 time=0.446 ms 64 bytes from a1.weave.local (10.2.1.1): icmp_seq=3 ttl=64 time=0.364 ms --- b1.weave.local ping statistics --- 3 packets transmitted, 3 received, 0% packet loss, time 2001ms rtt min/avg/max/mdev = 0.364/0.653/1.149/0.352 ms çµæœã‹ã‚‰ã€ç•°ãªã‚‹ç‰©ç†ãƒãƒ¼ãƒ‰(ä»Šå›ã¯ VM)ä¸Šã§å‹•ä½œã•ã›ãŸ Docker ã‚³ãƒ³ãƒ†ãƒŠåŒå£«ãŒé€šä¿¡ã—åˆãˆãŸ ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã¾ãŸã‚³ãƒ³ãƒ†ãƒŠåã® DNS çš„ã¯åå‰è§£æ±ºã‚‚å¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚\nãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ã‚¢ã‚¿ãƒƒãƒãƒ»ãƒ‡ã‚¿ãƒƒãƒã™ã‚‹ æ¬¡ã« weave ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å‹•çš„(ã‚³ãƒ³ãƒ†ãƒŠãŒã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã®ã¾ã¾)ã«ã‚¢ã‚¿ãƒƒãƒãƒ»ãƒ‡ã‚¿ãƒƒ ãƒã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã®ã§è©¦ã—ã¦ã¿ã¾ã™ã€‚\næœ€åˆã« weave ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å±ã•ãªã„ a1-1 ã¨ã„ã†åå‰ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œã‚Šã¾ã™ã€‚ docker exec ã§ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã™ã‚‹ã¨ eth0, lo ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã—ã‹æŒã£ã¦ã„ãªã„ ã“ã¨ãŒåˆ¤ã‚Šã¾ã™ã€‚\nhost1# C=$(docker run --name a1-1 -e WEAVE_CIDR=none -dti ubuntu) host1# docker exec -it a1-1 ip a # \u0026lt;--- docker ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 25: eth0: \u0026lt;BROADCAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:11:00:05 brd ff:ff:ff:ff:ff:ff inet 172.17.0.5/16 scope global eth0 valid_lft forever preferred_lft forever inet6 fe80::42:acff:fe11:5/64 scope link valid_lft forever preferred_lft forever ã§ã¯ weave ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ a1-1 ã‚³ãƒ³ãƒ†ãƒŠã«ã‚¢ã‚¿ãƒƒãƒã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nhost1# weave attach $C 10.2.1.1 host1# docker exec -it a1-1 ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 25: eth0: \u0026lt;BROADCAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:11:00:05 brd ff:ff:ff:ff:ff:ff inet 172.17.0.5/16 scope global eth0 valid_lft forever preferred_lft forever inet6 fe80::42:acff:fe11:5/64 scope link valid_lft forever preferred_lft forever 27: ethwe: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1410 qdisc pfifo_fast state UP group default qlen 1000 link/ether aa:15:06:51:6a:3b brd ff:ff:ff:ff:ff:ff inet 10.2.1.1/24 scope global ethwe valid_lft forever preferred_lft forever inet6 fe80::a815:6ff:fe51:6a3b/64 scope link valid_lft forever preferred_lft forever ä¸Šè¨˜ã®ã‚ˆã†ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ethwe ãŒä»˜ä¸ã•ã‚Œæœ€åˆã«æŒ‡å®šã—ãŸãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚µãƒ–ãƒãƒƒ ãƒˆä¸Šã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä»˜ãã¾ã—ãŸã€‚\næ¬¡ã« weave ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’è¤‡æ•°ã‚¢ã‚¿ãƒƒãƒã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚default, 10.2.2.0/24, 10.2.3.0/24 ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯(ã‚µãƒ–ãƒãƒƒãƒˆ)ã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ã€‚\nhost1# weave attach net:default net:10.2.2.0/24 net:10.2.3.0/24 $C 10.2.1.1 10.2.2.1 10.2.3.1 root@vagrant-ubuntu-vivid-64:~# docker exec -it b3 ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 25: eth0: \u0026lt;BROADCAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:11:00:05 brd ff:ff:ff:ff:ff:ff inet 172.17.0.5/16 scope global eth0 valid_lft forever preferred_lft forever inet6 fe80::42:acff:fe11:5/64 scope link valid_lft forever preferred_lft forever 33: ethwe: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1410 qdisc pfifo_fast state UP group default qlen 1000 link/ether 9a:74:73:1b:24:a9 brd ff:ff:ff:ff:ff:ff inet 10.2.1.1/24 scope global ethwe valid_lft forever preferred_lft forever inet 10.2.2.1/24 scope global ethwe valid_lft forever preferred_lft forever inet 10.2.3.1/24 scope global ethwe valid_lft forever preferred_lft forever inet6 fe80::9874:73ff:fe1b:24a9/64 scope link valid_lft forever preferred_lft forever çµæœã€ethwe ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«3ã¤ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä»˜ä¸ã•ã‚Œã¾ã—ãŸã€‚ ã“ã®æ§˜ã«ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã«ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦ weave ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\nã‚³ãƒ³ãƒ†ãƒŠå¤–éƒ¨ã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã™ã‚‹ ä¸‹è¨˜ã®ã‚ˆã†ã«ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¦ã„ã‚‹ãƒ›ã‚¹ãƒˆä¸Š (Vagrant VM) ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã®æƒ…å ±ã‚’å– å¾—ã™ã‚‹äº‹ã‚‚ã§ãã¾ã™ã€‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ãŒã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»è‡ªå‹•åŒ–ã‚’è¡Œã†ä¸Šã§é‡è¦ãªæ©Ÿèƒ½ã« ãªã‚Šãã†ãªäºˆæ„ŸãŒã—ã¾ã™ã€‚\nhost1# weave expose 10.2.1.1 host1# weave dns-lookup a2 10.2.1.128 ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã«ç‰©ç†ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã— weave ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ ç‰©ç†ãƒãƒ¼ãƒ‰(ä»Šå›ã®å ´åˆ vagrant vm)ã‚’è¿½åŠ ã—ä¸Šè¨˜ã§ä½œæˆã—ãŸ weave ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸å‚ åŠ ã•ã›ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ãªãŠã€ä»Šå›ã¯ä¸Šè¨˜ã® vagrant up ã®æ™‚ç‚¹ã§è¿½åŠ åˆ†ã® vm (host3) ã‚’æ—¢ã«ç¨¼åƒã•ã›ã¦ã„ã¾ã™ã€‚\nhost1 ã§æ–°ã—ã„ç‰©ç†ãƒãƒ¼ãƒ‰ã‚’æ¥ç¶šã—ã¾ã™ã€‚\nhost1# weave connect 192.168.33.12 host1# weave status targets 192.168.33.13 192.168.33.12 host3 ã§ weave ã‚³ãƒ³ãƒ†ãƒŠãƒ»ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¾ã™ã€‚ ä¸‹è¨˜ã§æŒ‡å®šã—ã¦ã„ã‚‹ 192.168.33.11 ã¯ host1 ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™ã€‚\nhost3# weave launch --ipalloc-range 10.2.0.0/16 --ipalloc-default-subnet 10.2.1.0/24 192.168.33.11 host3# docker run --name a3 -ti ubuntu host2 ã® a2 ã‚³ãƒ³ãƒ†ãƒŠã« ping ã‚’æ‰“ã£ã¦ã¿ã¾ã™ã€‚\nroota3:/# ping a2 -c 3 PING a2.weave.local (10.2.1.128) 56(84) bytes of data. 64 bytes from a2.weave.local (10.2.1.128): icmp_seq=1 ttl=64 time=0.366 ms 64 bytes from a2.weave.local (10.2.1.128): icmp_seq=2 ttl=64 time=0.709 ms 64 bytes from a2.weave.local (10.2.1.128): icmp_seq=3 ttl=64 time=0.569 ms host3 ä¸Šã® a3 ã‚³ãƒ³ãƒ†ãƒŠãŒæ—¢å­˜ã® weave ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å‚åŠ ã—é€šä¿¡å‡ºæ¥ãŸã“ã¨ãŒç¢ºèª ã§ãã¾ã—ãŸã€‚\nã¾ã¨ã‚ã¨è€ƒå¯Ÿ ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚‰ã—ããƒ¢ãƒã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ãªã Docker ã‚³ãƒ³ãƒ†ãƒŠé–“ã®é€šä¿¡ ãŒå‡ºæ¥ã¾ã—ãŸã€‚ã“ã‚Œã¯è‡ªå‹•åŒ–ã™ã‚‹éš›ã«å„ªä½ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚ã¾ãŸä»Šå›ç´¹ä»‹ã—ãŸã®ã¯ \u0026lsquo;weave net\u0026rsquo; ã¨å‘¼ã°ã‚Œã‚‹ãƒ¢ãƒã§ã™ãŒä»–ã«ã‚‚ \u0026lsquo;weave scope\u0026rsquo;, \u0026lsquo;weave run\u0026rsquo; ã¨ã„ã£ãŸãƒ¢ãƒ ãŒã‚ã‚Šã¾ã™ã€‚\nhttp://weave.works/product/\nã¾ãŸ Docker Swarm, Compose ã¨çµ„ã¿åˆã‚ã›ã‚‹æ§‹æˆã‚‚çµ„ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚è©¦ã—ã¦ã¿ãŸã„æ–¹ ãŒã„ã¾ã—ãŸã‚‰æ˜¯éã€‚\nhttp://weave.works/guides/weave-and-docker-platform/compose-scalable-swarm-cluster-with-weave.html\nã§ã™ãŒçµæœã€ã¾ã  weave ã‚’ã©ã†è‡ªåˆ†ãŸã¡ã®ã‚µãƒ¼ãƒ“ã‚¹ã«çµ„ã¿è¾¼ã‚ã‚‹ã‹ã¯æ¤œè¨ãŒä»˜ã„ã¦ã„ ã¾ã›ã‚“ã€‚\u0026lsquo;å‡ºæ¥ã‚‹\u0026rsquo; ã¨ \u0026lsquo;é‹ç”¨ã§ãã‚‹\u0026rsquo; ãŒåˆ¥ç‰©ã§ã‚ã‚‹ã“ã¨ã¨ã€ã‚³ãƒ³ãƒ†ãƒŠã¾ã‚ã‚Šã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ ã‚¯æ©Ÿèƒ½å…¨èˆ¬ã«ç†è§£ã—ã¦é¸å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚\nå‚è€ƒã‚µã‚¤ãƒˆ +++\nhttp://weave.works/docs/\n","permalink":"https://jedipunkz.github.io/post/2015/12/22/weave-docker-network/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ Weave ã¨ã„ã†ã‚³ãƒ³ãƒ†ãƒŠé–“ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æä¾›ã—ã¦ãã‚Œã‚‹ Docker ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ©\nã‚°ã‚¤ãƒ³ã‚’ä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚ä¸‹è¨˜ã®ã‚ˆã†ãªæ²¢å±±ã®æ©Ÿèƒ½ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFast Data Path\u003c/li\u003e\n\u003cli\u003eDocker Network Plugin\u003c/li\u003e\n\u003cli\u003eSecurity\u003c/li\u003e\n\u003cli\u003eDynamic Netwrok Attachment\u003c/li\u003e\n\u003cli\u003eService Binding\u003c/li\u003e\n\u003cli\u003eFault Tolerance\u003c/li\u003e\n\u003cli\u003eetc \u0026hellip;\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã“ã®è¨˜äº‹ã§ã¯ä¸Šã‹ã‚‰å¹¾ã¤ã‹æŠœç²‹ã—ã¦ã€Weave ã£ã¦ã©ã®ã‚ˆã†ã«å‹•ã‹ã›ã‚‹ã®ã‹ï¼Ÿã‚’è§£èª¬ã—ã¾ã™ã€‚\nãã“ã‹ã‚‰ Weave ãŒä¸€ä½“ãƒŠãƒ‹ãƒ¢ãƒãªã®ã‹ç†è§£ã§ãã‚Œã°ãªãã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"vagrant-ã‚’ä½¿ã£ãŸæ§‹æˆ\"\u003eVagrant ã‚’ä½¿ã£ãŸæ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eã“ã®è¨˜äº‹ã§ã¯ä¸‹è¨˜ã®æ§‹æˆã‚’ä½œã£ã¦è‰²ã€…ã¨è©¦ã—ã¦ã„ãã¾ã™ã€‚ä½¿ã†æŠ€è¡“ã¯\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eVagrant\u003c/li\u003e\n\u003cli\u003eDocker\u003c/li\u003e\n\u003cli\u003eWeave\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã§ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+---------------------+ +---------------------+ +---------------------+\n| docker container a1 | | docker container a2 | | docker container a3 |\n+---------------------+ +---------------------+ +---------------------+\n|    vagrant host 1   | |    vagrant host 2   | |    vagrant host 3   |\n+---------------------+-+---------------------+-+---------------------+\n|                          Mac or Windows                             |\n+---------------------------------------------------------------------+\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eç‰¹å¾´ã¨ã—ã¦ã¯\u003c/p\u003e","title":"Weave ã‚’ä½¿ã£ãŸ Docker ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\næœ€è¿‘ã€æ¥­å‹™ã§ CircleCI ã‚’æ‰±ã£ã¦ã„ã¦ã€ã ã„ã¶ \u0026ldquo;å‡ºæ¥ã‚‹ã“ã¨ãƒ»å‡ºæ¥ãªã„ã“ã¨\u0026rdquo; ã‚„ \u0026ldquo;å‡ºæ¥ãªã„ã“ã¨ ã«å¯¾ã™ã‚‹å›é¿æ–¹æ³•\u0026rdquo; ç­‰ã®ãƒã‚¦ãƒã‚¦ãŒè‹¥å¹²æºœã¾ã£ã¦ããŸã®ã§å…±æœ‰ã—ãŸã„ãªã¨æ€ã„ã¾ã™ã€‚\nã“ã®è¨˜äº‹ã®å‰æ\u0026hellip; ã“ã“ã§ã¯ CodeDeploy ã®è¨­å®šæ–¹æ³•ã‚„ã€CircleCIã®è¨­å®šæ–¹æ³•ç­‰ã«é–¢ã—ã¦ã¯è¨˜è¿°ã—ã¾ã› ã‚“ã€‚ã‚ãã¾ã§ã€Tips çš„ãªå†…å®¹ã«ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸé‹ç”¨ã™ã‚‹ä¸Šã§æƒ³å®šã§ãã‚‹å•é¡Œç‚¹ã¨ã€ ãã‚Œã®å›é¿æ–¹æ³•ç­‰\u0026hellip;ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚\nCirlceCI ã¨ä½µç”¨ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦ CircleCI ã¯ Github ã¨é€£æºã—ã¦ãƒ¬ãƒã‚¸ãƒˆãƒªå†…ã®åˆ¶å¾¡ãƒ•ã‚¡ã‚¤ãƒ« circle.yml ã«å¾“ã£ã¦ãƒ† ã‚¹ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿæ–½ã—ã¦ãã‚Œã‚‹ CI ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ãŸã  CircleCI ã¯è‡ªåˆ†ãŸ ã¡ã®ç®¡ç†ã—ã¦ã„ã‚‹ã‚·ã‚¹ãƒ†ãƒ å¤–ã«ã‚ã‚‹ã®ã§ã€AWS VPC ã‚’ç”¨ã„ã¦ã„ã‚‹ã¨ VPC å†…ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ãŒé›£ã—ã„ã§ã™ã€‚ãƒ—ãƒ­ã‚­ã‚·æŒŸã‚“ã§ãƒ»ãƒ»ã£ã¦ã“ã¨ã¯å‡ºæ¥ã ã†ã§ã™ãŒãƒ—ãƒ­ã‚­ã‚·ã®é‹ç”¨ã‚‚ã—ãŸããªã„ã€AWS ã®ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ã«ä»»ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ãŸ ã‚‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ»ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’é‹ç”¨ã—ãªãã¦æ¸ˆã‚€ã®ã§é‹ç”¨ã‚³ã‚¹ãƒˆãŒ çœã‘ãã†ã€‚ã£ã¦ã“ã¨ã§\nAWS S3 (https://aws.amazon.com/jp/s3/) AWS CodeDeploy (https://aws.amazon.com/jp/codedeploy/) ã‚’ä½µç”¨ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã¾ã—ãŸã€‚\nS3 ã¯çš†ã•ã‚“ã”å­˜çŸ¥ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã™ã€‚CircleCI ç”¨ã®ãƒã‚±ãƒƒãƒˆã‚’ä½œã£ã¦ã€ ãƒ“ãƒ«ãƒ‰ã—ãŸçµæœã‚’æ ¼ç´ã—ã¾ã™ã€‚ç§ã®å‹™ã‚ã¦ã„ã‚‹ä¼šç¤¾ã§ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã¨ã—ã¦ Scala ã‚’ç”¨ã„ã¦ã„ã‚‹ã®ã§ SBT ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚ãã®çµæœã‚‚ãƒãƒ¼ã‚¸ãƒ§ ãƒ‹ãƒ³ã‚°ã—ã¤ã¤ S3 ãƒã‚±ãƒƒãƒˆã«æ ¼ç´ã§ãã‚Œã°ã€ä¸‡ãŒä¸€å•é¡ŒãŒç™ºç”Ÿã—ãŸæ™‚ã«ãƒã‚¤ãƒŠãƒªæ¯åˆ‡ã‚Š æˆ»ã™ã“ã¨ãŒå‡ºæ¥ãã†ã§ã™ã€‚\nã¾ãŸ CodeDeploy ã¯ EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ»ã¾ãŸã‚ªãƒ³ãƒ—ãƒ¬ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒ— ãƒ­ã‚¤ãŒå¯èƒ½ã«ãªã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ 2015/08 ã‹ã‚‰åˆ©ç”¨ãŒå¯èƒ½ã«ãªã‚Š ã¾ã—ãŸã€‚ã“ã‚Œã®ä¾¿åˆ©ãªã¨ã“ã‚ã¯ CircleCI ç­‰ã® CI ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ç°¡å˜ã«å©ã‘ã¦ã€VPC å†… ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¯¾ã—ã¦ã‚‚ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¯èƒ½ãªã¨ã“ã‚ã§ã™ã€‚\nTips çš„ãªæƒ…å ±ã¨ã—ã¦ +++\ncircle.yml ã¨ã„ã† CircleCI ã®åˆ¶å¾¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚Git ãƒ¬ãƒã‚¸ãƒˆãƒªå†…ã«æ ¼ç´ã™ã‚‹ã“ã¨ã§ CircleCI ã®å‹•ä½œã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯ circle.yml ã®ç´¹ä»‹ã‚’ãƒ¡ã‚¤ãƒ³ã¨ã—ãŸã„ ã¨æ€ã„ã¾ã™ã€‚\nGit push ã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã‚’è‡ªå‹•ã§è¡Œã† circle.yml Github ã¸ã® push, merge ã‚’ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã®æµã‚Œã‚’è‡ªå‹•ã§è¡Œã†æµã‚Œã‚’çµ„ã‚€å ´åˆã® circle.yml ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚å…¨ä½“ã®æµã‚Œã¨ã—ã¦ã¯\u0026hellip;\nãƒ¬ãƒã‚¸ãƒˆãƒªã« git push, merge ã“ã¨ãŒãƒˆãƒªã‚¬ã§å‡¦ç†ãŒèµ°ã‚‹ circle.yml ã‚’å…ƒã«ãƒ†ã‚¹ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰(å ´åˆã«ã‚ˆã£ã¦ã¯ãƒ†ã‚¹ãƒˆã®ã¿) ãŒèµ°ã‚‹ S3 ãƒã‚±ãƒƒãƒˆã«ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸçµæœãŒæ ¼ç´ã•ã‚Œã‚‹ CodeDeploy ãŒå®Ÿè¡Œã•ã‚Œ S3 ãƒã‚±ãƒƒãƒˆå†…ã®ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸæˆæœç‰©ã‚’å¯¾è±¡ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ ã¨ãªã‚Šã¾ã™ã€‚\nmachine: environment: SBT_VERSION: 0.13.9 SBT_OPTS: \u0026#34;-Xms512M -Xmx1536M -Xss1M -XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=256M\u0026#34; services: - docker dependencies: pre: - (äº‹å‰ã«å®Ÿè¡Œã—ãŸã„ã‚³ãƒãƒ³ãƒ‰ãƒ»ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨˜è¿°) cache_directories: - \u0026#34;~/.sbt\u0026#34; test: override: - sbt compile deployment: production: branch: master codedeploy: codedeploy-sample: application_root: / region: ap-northeast-1 revision_location: revision_type: S3 s3_location: bucket: circleci-sample-bucket key_pattern: filename-{CIRCLE_BRANCH}-{CIRCLE_BUILD_NUM}.zip deployment_group: codedeploy-sample-group ãã‚Œãã‚Œã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ„å‘³ ä¸Šè¨˜ circle.yml ã®é‡è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚ ç§ãŒå‹™ã‚ã¦ã„ã‚‹ä¼šç¤¾ã¯ Scala ã‚’ä½¿ã£ã¦ã„ã‚‹ã¨å†’é ­ã«èª¬æ˜ã—ã¾ã—ãŸãŒãƒ†ã‚¹ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰ã« SBT ã‚’ä½¿ã†ã®ã§ã“ã®ã‚ˆã†ãªè¨˜è¿°ã«ãªã£ã¦ã„ã¾ã™ã€‚Ruby ã‚„ Python ã§ã‚‚åŒæ§˜ã«è¨˜è¿°ã§ã ã‚‹ã¨æ€ã„ã¾ã™ã®ã§èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚\nmachine -\u0026gt; environment : å…¨ä½“ã§é©ç”¨ã§ãã‚‹ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©ã—ã¾ã™ dependencies -\u0026gt; pre : äº‹å‰ã«å®Ÿè¡Œã—ãŸã„ã‚³ãƒãƒ³ãƒ‰ç­‰ã‚’å®šç¾©ã§ãã¾ã™ test -\u0026gt; overide : ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’æ›¸ãã¾ã™ã€‚ deployment -\u0026gt; production -\u0026gt; branch : é©ç”¨ã™ã‚‹ãƒ–ãƒ©ãƒ³ãƒåã¨æœ¬ç•ªç’°å¢ƒã§ã‚ã‚‹ã“ã¨ã‚’è¨˜è¿°ã—ã¾ã™ã€‚ \u0026lsquo;codedeploy-sample\u0026rsquo; : CodeDeploy ä¸Šã«ã‚µãƒ³ãƒ—ãƒ«ã§ä½œæˆã—ãŸ \u0026lsquo;Application\u0026rsquo; åã§ã™ s3_location -\u0026gt; bucket : ãƒ“ãƒ«ãƒ‰ã—ãŸæˆæœç‰©ã‚’ S3 ã¸æ ¼ç´ã™ã‚‹éš›ã®ãƒã‚±ãƒƒãƒˆåã‚’è¨˜ã—ã¾ã™ s3_location -\u0026gt; key_pattern : S3 ãƒã‚±ãƒƒãƒˆã«åã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åæŒ‡å®šã§ã™ deployment_group : CodeDeploy ã§å®šç¾©ã™ã‚‹ \u0026lsquo;Deployment-Group\u0026rsquo; åã§ã™ ã‚ˆã‚Šè©³ç´°ãªèª¬æ˜ã‚’èª­ã¿ãŸã„å ´åˆã¯ä¸‹è¨˜ã® URL ã«æã„ã¦ã‚ã‚Šã¾ã™ã€‚\nhttps://circleci.com/docs/configuration\nS3 ã®ã¿ã«ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ä¾‹ ä¸Šè¨˜ã® circle.yml ã§ã¯ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ä¸€æ°—ã«å‡¦ç†ã™ã‚‹ã®ã§ã™ãŒã€ãƒ†ã‚¹ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’åˆ¥ã‘ã¦ å®Ÿè¡Œã—ãŸã„å ´é¢ã‚‚ã‚ã‚Šãã†ã§ã™ã€‚æµã‚Œã¨ã—ã¦ã¯\u0026hellip;\nãƒ¬ãƒã‚¸ãƒˆãƒªã« git push, merge ã“ã¨ãŒãƒˆãƒªã‚¬ã§å‡¦ç†ãŒèµ°ã‚‹ circle.yml ã‚’å…ƒã«ãƒ†ã‚¹ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰(å ´åˆã«ã‚ˆã£ã¦ã¯ãƒ†ã‚¹ãƒˆã®ã¿) ãŒèµ°ã‚‹ S3 ãƒã‚±ãƒƒãƒˆã«ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸçµæœãŒæ ¼ç´ã•ã‚Œã‚‹ ã§ã™ã€‚S3 ã®ãƒã‚±ãƒƒãƒˆã«æ ¼ç´ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚’ CodeDeploy ã‚’ä½¿ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã¯ CodeDeploy ã® API ã‚’ç›´æ¥å©ã‘ã°å‡ºæ¥ãã†ã§ã™ã€‚\nhttp://docs.aws.amazon.com/codedeploy/latest/APIReference/API_CreateDeployment.html\nã“ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã«ã‚ã‚‹ \u0026ldquo;CreateDeployment\u0026rdquo; ã«ã¤ã„ã¦ã¯å¾Œã«ä¾‹ã‚’ã‚ã’ã¾ã™ã€‚\nãŸã ã€åŒæ§˜ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ TravisCI ç­‰ã¯ S3 ã«ã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿæ–½ã™ã‚‹ä»•çµ„ã¿ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒ CircleCI ã«ã¯ã“ã®æ©Ÿèƒ½ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã‚µãƒãƒ¼ãƒˆã«å•ã„åˆã‚ã›ã‚‚ã—ãŸã®ã§ã™ãŒã€ã‚ã¾ã‚Šè‰¯ã„å›ç­”ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\nã‚ˆã£ã¦ã€ä¸‹è¨˜ã®ã‚ˆã†ã« awscli ã‚’ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã®åº¦ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ S3 ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚Œã° ä¸Šè¨˜ã®æµã‚ŒãŒçµ„ã‚ãã†ã§ã™ã€‚\nmachine: environment: SBT_VERSION: 0.13.9 SBT_OPTS: \u0026#34;-Xms512M -Xmx1536M -Xss1M -XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=256M\u0026#34; services: - docker dependencies: pre: - sudo pip install awscli cache_directories: - \u0026#34;~/.sbt\u0026#34; test: override: - sbt compile deployment: master: branch: master commands: - zip -r sample-code-${CIRCLE_BRANCH}-${CIRCLE_BUILD_NUM}.zip . - aws s3 cp sample-code-${CIRCLE_PROJECT_REPONAME}-${CIRCLE_BRANCH}-${CIRCLE_BUILD_NUM}.zip s3://\u0026lt;ãƒã‚±ãƒƒãƒˆå\u0026gt;/\u0026lt;ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª\u0026gt;/ --region ap-northeast-1 äº‹å‰ã« awscli ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚\nS3 ãƒã‚±ãƒƒãƒˆã«æ ¼ç´ã•ã‚ŒãŸæˆæœç‰©ã‚’ CodeDeploy ã‚’ä½¿ã£ã¦æ‰‹å‹•ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã«ã¯ä¸‹è¨˜ ã®ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿæ–½ã§ãã¾ã™ã€‚\n$ aws deploy create-deployment \\ --application-name codedeploy-sample \\ --deployment-config-name CodeDeployDefault.OneAtATime \\ --deployment-group-name codedeploy-sample-group \\ --description \u0026#34;deploy test\u0026#34; \\ --s3-location bucket=\u0026lt;ãƒã‚±ãƒƒãƒˆå\u0026gt;,bundleType=zip,key=\u0026lt;ãƒ•ã‚¡ã‚¤ãƒ«å\u0026gt; { \u0026#34;deploymentId\u0026#34;: \u0026#34;d-2B4OAMT0B\u0026#34; } deploymentId ã¯ CodeDeploy ä¸Šã® Application ã«ç´ä»˜ã„ãŸ ID ã§ã™ã€‚CodeDeploy ã® API ã‚’å©ãã‹ AWS ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèªå¯èƒ½ã§ã™ã€‚\nCircleCI ã®å•é¡Œç‚¹ã¨ãã‚Œã®å›é¿æ–¹æ³• production ã¨ staging 1ã¤ã®ãƒ–ãƒ©ãƒ³ãƒã§ç®¡ç†ã§ãã‚‹ circle.yml ã¯1ã¤ã§ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã§å®šç¾©ã§ãã‚‹ \u0026lsquo;æœ¬ç•ªç”¨\u0026rsquo;, \u0026lsquo;é–‹ç™ºç”¨\u0026rsquo; ã®å®šç¾©ã¯ deployment -\u0026gt; production, staging ã®2ç¨®é¡ã«ãªã‚Šã¾ã™ã€‚ã“ã®2ã¤ã§ç®¡ç†ã—ãã‚Œãªã„ç’°å¢ƒãŒã‚ã‚‹å ´åˆ(ä¾‹ãˆã° staging ä»¥å‰ã® development ç’°å¢ƒãŒã‚ã‚‹) ã¯ã€ãƒ¬ãƒã‚¸ãƒˆãƒªã®ãƒ–ãƒ©ãƒ³ãƒã‚’åˆ¥ã‘ã¦ circle.yml ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚\nè¤‡æ•°ã®ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆãŒã‚ã‚‹ãƒ¬ãƒã‚¸ãƒˆãƒªã®é‹ç”¨ åŒä¸€ã®ãƒ¬ãƒã‚¸ãƒˆãƒªå†…ã§ç®¡ç†ã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆãŒè¤‡æ•°ã‚ã‚‹å ´åˆã¯ CodeDeploy ä¸Šã§1ã¤ã® Application ã«å¯¾ã—ã¦è¤‡æ•°ã® Deployment-Group ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§å¯¾å¿œã§ãã¾ã™ã€‚ãŸã ã€cirlce.yml ã§å®šç¾©ã§ãã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã¯ deployment_group: ã®1ã¤( å³å¯†ã«è¨€ã†ã¨ production, staging ã®2ã¤) ã«ãªã‚‹ã®ã§ã€ã“ã¡ã‚‰ã‚‚ãƒ–ãƒ©ãƒ³ãƒã«ã‚ˆã‚‹ circle.yml ã®åˆ¥ç®¡ç†ã§å›é¿ã§ããã†ã§ã™ã€‚\nã“ã¡ã‚‰ã®å•é¡Œã«ã¤ã„ã¦ã¯ CircleCI çš„ã«ã¯ãŠãã‚‰ãã€Œ1ã¤ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã™ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã¯1ã¤ã«ã€ã¨ã„ã†ã‚³ãƒ³ã‚»ãƒ—ãƒˆãªã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\nAWS IAM ãƒ¦ãƒ¼ã‚¶ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ Policy ä½œæˆ IAM ãƒ¦ãƒ¼ã‚¶ã‚’ CircleCI ã«äº‹å‰ã«è¨­å®šã—ã¦ãŠãã“ã¨ã§ç›´æ¥ AWS ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’æ“ä½œå‡ºæ¥ã‚‹ã®ã§ã™ãŒã€ ãã®ãƒ¦ãƒ¼ã‚¶ã«ã‚¢ã‚¿ãƒƒãƒã—ã¦ãŠãã¹ã Policy ã«ã¤ã„ã¦ä¾‹ã‚’ã‚ã’ã¦ãŠãã¾ã™ã€‚\nç‰¹å®šã® S3 ãƒã‚±ãƒƒãƒˆã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ Put ã™ã‚‹ Policy\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Sid\u0026#34;: \u0026#34;Stmt1444196633000\u0026#34;, \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;s3:PutObject\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:s3:::\u0026lt;S3 ãƒã‚±ãƒƒãƒˆå\u0026gt;/*\u0026#34; ] } ] } CodeDeploy ã®å„ Action ã‚’å®Ÿè¡Œã™ã‚‹ Policy\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;codedeploy:RegisterApplicationRevision\u0026#34;, \u0026#34;codedeploy:GetApplicationRevision\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;*\u0026#34; ] }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;codedeploy:CreateDeployment\u0026#34;, \u0026#34;codedeploy:GetDeployment\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;*\u0026#34; ] }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;codedeploy:GetDeploymentConfig\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;*\u0026#34; ] } ] } ã¾ã¨ã‚ CodeDeploy, S3 ã‚’ä½µç”¨ã™ã‚‹ã“ã¨ã§ CircleCI ã‚’ä½¿ã£ã¦ã‚‚ VPC å†…ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¤ãƒ³ã‚¹ ã‚¿ãƒ³ã‚¹ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã“ã¨ãŒåˆ¤ã‚Šã¾ã—ãŸã€‚ã‚‚ã— EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆ ã¯ä»–ã®æ–¹æ³•ã‚‚å–ã‚Œã‚‹ã“ã¨ãŒåˆ¤ã£ã¦ã„ã¾ã™ã€‚circle.yml å†…ã® pre: ã§æŒ‡å®šå‡ºæ¥ã‚‹ã‚³ãƒãƒ³ ãƒ‰ãƒ»ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ç´ä»˜ã„ã¦ã„ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã«ç©´ã‚ã‘å‡¦ ç†ã‚’è¨˜è¿°ã™ã‚Œã°è‰¯ã•ãã†ã§ã™ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ãŒçµ‚ã‚ã£ãŸã‚‰ç©´ã‚’å¡ã’ã°ã„ã„ã§ã™ã­ã€‚ã“ã®è¾ºã® ä¾‹ã«ã¤ã„ã¦ã¯å›½å†…ã§ã‚‚ãƒ–ãƒ­ã‚°è¨˜äº‹ã«ã•ã‚Œã¦ã„ã‚‹æ–¹ãŒã„ã‚‰ã£ã—ã‚ƒã„ã¾ã™ã®ã§å‚è€ƒã«ã—ã¦ãã  ã•ã„ã€‚\n","permalink":"https://jedipunkz.github.io/post/2015/11/15/circleci-codedeploy/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€è¿‘ã€æ¥­å‹™ã§ CircleCI ã‚’æ‰±ã£ã¦ã„ã¦ã€ã ã„ã¶ \u0026ldquo;å‡ºæ¥ã‚‹ã“ã¨ãƒ»å‡ºæ¥ãªã„ã“ã¨\u0026rdquo; ã‚„ \u0026ldquo;å‡ºæ¥ãªã„ã“ã¨\nã«å¯¾ã™ã‚‹å›é¿æ–¹æ³•\u0026rdquo; ç­‰ã®ãƒã‚¦ãƒã‚¦ãŒè‹¥å¹²æºœã¾ã£ã¦ããŸã®ã§å…±æœ‰ã—ãŸã„ãªã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ã“ã®è¨˜äº‹ã®å‰æ\"\u003eã“ã®è¨˜äº‹ã®å‰æ\u0026hellip;\u003c/h2\u003e\n\u003cp\u003eã“ã“ã§ã¯ CodeDeploy ã®è¨­å®šæ–¹æ³•ã‚„ã€CircleCIã®è¨­å®šæ–¹æ³•ç­‰ã«é–¢ã—ã¦ã¯è¨˜è¿°ã—ã¾ã›\nã‚“ã€‚ã‚ãã¾ã§ã€Tips çš„ãªå†…å®¹ã«ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸé‹ç”¨ã™ã‚‹ä¸Šã§æƒ³å®šã§ãã‚‹å•é¡Œç‚¹ã¨ã€\nãã‚Œã®å›é¿æ–¹æ³•ç­‰\u0026hellip;ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"cirlceci-ã¨ä½µç”¨ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦\"\u003eCirlceCI ã¨ä½µç”¨ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦\u003c/h2\u003e\n\u003cp\u003eCircleCI ã¯ Github ã¨é€£æºã—ã¦ãƒ¬ãƒã‚¸ãƒˆãƒªå†…ã®åˆ¶å¾¡ãƒ•ã‚¡ã‚¤ãƒ« circle.yml ã«å¾“ã£ã¦ãƒ†\nã‚¹ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿæ–½ã—ã¦ãã‚Œã‚‹ CI ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ãŸã  CircleCI ã¯è‡ªåˆ†ãŸ\nã¡ã®ç®¡ç†ã—ã¦ã„ã‚‹ã‚·ã‚¹ãƒ†ãƒ å¤–ã«ã‚ã‚‹ã®ã§ã€AWS VPC ã‚’ç”¨ã„ã¦ã„ã‚‹ã¨ VPC å†…ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼\nãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ãŒé›£ã—ã„ã§ã™ã€‚ãƒ—ãƒ­ã‚­ã‚·æŒŸã‚“ã§ãƒ»ãƒ»ã£ã¦ã“ã¨ã¯å‡ºæ¥ã\nã†ã§ã™ãŒãƒ—ãƒ­ã‚­ã‚·ã®é‹ç”¨ã‚‚ã—ãŸããªã„ã€AWS ã®ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ã«ä»»ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ãŸ\nã‚‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ»ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’é‹ç”¨ã—ãªãã¦æ¸ˆã‚€ã®ã§é‹ç”¨ã‚³ã‚¹ãƒˆãŒ\nçœã‘ãã†ã€‚ã£ã¦ã“ã¨ã§\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAWS S3 (\u003ca href=\"https://aws.amazon.com/jp/s3/\"\u003ehttps://aws.amazon.com/jp/s3/\u003c/a\u003e)\u003c/li\u003e\n\u003cli\u003eAWS CodeDeploy (\u003ca href=\"https://aws.amazon.com/jp/codedeploy/\"\u003ehttps://aws.amazon.com/jp/codedeploy/\u003c/a\u003e)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã‚’ä½µç”¨ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eS3 ã¯çš†ã•ã‚“ã”å­˜çŸ¥ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã™ã€‚CircleCI ç”¨ã®ãƒã‚±ãƒƒãƒˆã‚’ä½œã£ã¦ã€\nãƒ“ãƒ«ãƒ‰ã—ãŸçµæœã‚’æ ¼ç´ã—ã¾ã™ã€‚ç§ã®å‹™ã‚ã¦ã„ã‚‹ä¼šç¤¾ã§ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã¨ã—ã¦\nScala ã‚’ç”¨ã„ã¦ã„ã‚‹ã®ã§ SBT ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚ãã®çµæœã‚‚ãƒãƒ¼ã‚¸ãƒ§\nãƒ‹ãƒ³ã‚°ã—ã¤ã¤ S3 ãƒã‚±ãƒƒãƒˆã«æ ¼ç´ã§ãã‚Œã°ã€ä¸‡ãŒä¸€å•é¡ŒãŒç™ºç”Ÿã—ãŸæ™‚ã«ãƒã‚¤ãƒŠãƒªæ¯åˆ‡ã‚Š\næˆ»ã™ã“ã¨ãŒå‡ºæ¥ãã†ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãŸ CodeDeploy ã¯ EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ»ã¾ãŸã‚ªãƒ³ãƒ—ãƒ¬ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒ—\nãƒ­ã‚¤ãŒå¯èƒ½ã«ãªã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ 2015/08 ã‹ã‚‰åˆ©ç”¨ãŒå¯èƒ½ã«ãªã‚Š\nã¾ã—ãŸã€‚ã“ã‚Œã®ä¾¿åˆ©ãªã¨ã“ã‚ã¯ CircleCI ç­‰ã® CI ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ç°¡å˜ã«å©ã‘ã¦ã€VPC å†…\nã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¯¾ã—ã¦ã‚‚ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¯èƒ½ãªã¨ã“ã‚ã§ã™ã€‚\u003c/p\u003e","title":"CodeDeploy, S3 ã‚’ä½µç”¨ã—ã¦ CircleCI ã«ã‚ˆã‚Š VPC ã«ãƒ‡ãƒ—ãƒ­ã‚¤"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šå›ã¯ Docker ãƒã‚¿ã§ã™ã€‚Docker å°å…¥ã™ã‚‹ã«ã—ã¦ã‚‚ç›£è¦–ã¯ã©ã†ã™ã‚‹ï¼Ÿã¨ã„ã†è©±ã«ãªã‚‹ ã¨æ€ã†ã®ã§ã™ãŒã€å„ Monitoring as a Service ã‚’ä½¿ã†ã«ã—ã¦ã‚‚ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¥ã‚Œãªã„ ã¨ã„ã‘ãªã„ã—ãŠé‡‘æ›ã‹ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã—..ã§ã€èª¿ã¹ã¦ã„ãŸã‚‰ cAdvisor ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ ãŒå‡ºã¦ãã¾ã—ãŸã€‚ä»Šå›ã¯ cAdvisor ã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠã®ç›£è¦–ãŒå‡ºæ¥ãªã„ã‹ã€ã«ã¤ã„ã¦æ›¸ ã„ã¦ã„ããŸã„ã¨æƒ³ã„ã¾ã™ã€‚\ncAdvisor ã¨ã¯ ? cAdvisor ã¯ Kubernates ã§ç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å˜ä½“ã§ã‚‚åˆ©ç”¨å¯èƒ½ã¨ã®ã“ ã¨ã€‚Google ãŒé–‹ç™ºã—ã¦ã„ã¾ã™ã€‚ã¾ãŸ Docker ã‚³ãƒ³ãƒ†ãƒŠã®ç›£è¦–ã«ãŠã„ã¦ã“ã® cAdvisor ã¯ä¸€èˆ¬åŒ–ã—ã¤ã¤ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚\nhttps://github.com/google/cadvisor\nåé›†ã—ãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ä¿å­˜ cAdvisor è‡ªä½“ã‚‚ Docker ã§èµ·å‹•ã—ã¦ã€åŒãƒ›ã‚¹ãƒˆä¸Šã«èµ·å‹•ã—ã¦ã„ã‚‹ Docker ã‚³ãƒ³ãƒ†ãƒŠã® ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã—ã¦ãã‚Œã¾ã™ã€‚ãã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã¯å¹¾ã¤ã‹ã® DB ã«ä¿å­˜å‡º æ¥ã‚‹ã®ã§ã™ãŒã€ãã®ã†ã¡ã®ä¸€ã¤ãŒ influxDB ã§ã™ã€‚influxDB ã¯æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’åã‚ã‚‹ã®ã«ã¡ã‚‡ã†ã©ã„ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãªã‚Šã¾ã™ã€‚\nhttps://influxdb.com/\nDB ã«åã‚ãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å¯è¦–åŒ– influxDB ã«åã‚ãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–ã™ã‚‹ã®ãŒ Grafana ã§ã™ã€‚Grafana ã®ãƒ‡ãƒ¼ ã‚¿ã‚½ãƒ¼ã‚¹ã¯ influxDB ã®ä»–ã«ã‚‚å¹¾ã¤ã‹ã‚ã‚Š Elasticsearch, KairosDB, Graphite ç­‰ãŒ ãã‚Œã§ã™ã€‚\nhttp://grafana.org/\nã§ã¯æ—©é€Ÿè©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nå‰æã®ç’°å¢ƒ ä»Šå›ã¯ Vagrant ã‚’ä½¿ã„ã¾ã™ã€‚ã¾ãŸ Vagrant ä¸Šã§ä¸Šè¨˜ã®3ã¤ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ Docker ã§ç¨¼åƒã—ã¾ã™ã€‚ã¾ãŸã©ã†ã›ãªã®ã§ docker-compose ã‚’ä½¿ã£ã¦3ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä¸€æ–‰ã«ç«‹ ã¡ä¸Šã’ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nVagrantFile ã®æº–å‚™ ä¸‹è¨˜ã®ã‚ˆã†ãª VagrantFile ã‚’ä½œæˆã—ã¾ã™ã€‚å„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¯ãã‚Œãã‚Œ WebUI ã‚’æŒã£ã¦ ã„ã¦ã€ãã“ã«æ‰‹å…ƒã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‹ã‚‰æ¥ç¶šã™ã‚‹ãŸã‚ forwarded_port ã—ã¦ã„ã¾ã™ã€‚\n# -*- mode: ruby -*- # vi: set ft=ruby : Vagrant.configure(2) do |config| config.vm.box = \u0026#34;ubuntu/trusty64\u0026#34; config.vm.network \u0026#34;forwarded_port\u0026#34;, guest: 8080, host: 8080 config.vm.network \u0026#34;forwarded_port\u0026#34;, guest: 8083, host: 8083 config.vm.network \u0026#34;forwarded_port\u0026#34;, guest: 3000, host: 3000 config.vm.network \u0026#34;private_network\u0026#34;, ip: \u0026#34;192.168.33.10\u0026#34; end Docker ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ã¨ docker-compose.yml ã®æº–å‚™ Vagrant ã‚’èµ·å‹•ã— docker, docker-compose ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã™ã€‚\n$ vagrant up $ vagrant ssh vagrant$ sudo apt-get update ; sudo apt-get -y install curl vagrant$ curl -sSL https://get.docker.com/ | sh vagrant$ sudo -i vagrant# export VERSION_NUM=1.4.0 vagrant# curl -L https://github.com/docker/compose/releases/download/VERSION_NUM/docker-compose-`uname -s`-`uname -m` \u0026gt; /usr/local/bin/docker-compose vagrant# chmod +x /usr/local/bin/docker-compose æ¬¡ã« docker-compose.yml ã‚’ä½œæˆã—ã¾ã™ã€‚ä¸Šè¨˜3ã¤ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒç¨¼åƒã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ ã‚’èµ·å‹•ã™ã‚‹ãŸã‚ä¸‹è¨˜ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã—ã‚‡ã†ã€‚ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä½œæˆã—ã¾ã™ã€‚\nInfluxSrv: image: \u0026#34;tutum/influxdb:0.8.8\u0026#34; ports: - \u0026#34;8083:8083\u0026#34; - \u0026#34;8086:8086\u0026#34; expose: - \u0026#34;8090\u0026#34; - \u0026#34;8099\u0026#34; environment: - PRE_CREATE_DB=cadvisor cadvisor: image: \u0026#34;google/cadvisor:0.16.0\u0026#34; volumes: - \u0026#34;/:/rootfs:ro\u0026#34; - \u0026#34;/var/run:/var/run:rw\u0026#34; - \u0026#34;/sys:/sys:ro\u0026#34; - \u0026#34;/var/lib/docker/:/var/lib/docker:ro\u0026#34; links: - \u0026#34;InfluxSrv:influxsrv\u0026#34; ports: - \u0026#34;8080:8080\u0026#34; command: \u0026#34;-storage_driver=influxdb -storage_driver_db=cadvisor -storage_driver_host=influxsrv:8086 -storage_driver_user=root -storage_driver_password=root -storage_driver_secure=False\u0026#34; grafana: image: \u0026#34;grafana/grafana:2.1.3\u0026#34; ports: - \u0026#34;3000:3000\u0026#34; environment: - INFLUXDB_HOST=localhost - INFLUXDB_PORT=8086 - INFLUXDB_NAME=cadvisor - INFLUXDB_USER=root - INFLUXDB_PASS=root links: - \u0026#34;InfluxSrv:influxsrv\u0026#34; ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹• +++\ndocker ã‚³ãƒ³ãƒ†ãƒŠã‚’ç«‹ã¡ä¸Šã’ã¾ã™ã€‚\nvagrant$ docker-compose -d influxDB ã® WebUI ã«æ¥ç¶šã™ã‚‹ ãã‚Œã§ã¯èµ·å‹•ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã®ã†ã¡ä¸€ã¤ influxDB ã® WebUI ã«æ¥ç¶šã—ã¦ã„ã¾ã—ã‚‡ã†ã€‚ ä¸Šè¨˜ã® VagrantFile ã§ã¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ 192.168.33.10 ã¨æŒ‡å®šã—ã¾ã—ãŸã€‚\nURL : http://192.168.33.10:8083\nãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã—ã¾ã™ã€‚\nãƒ¦ãƒ¼ã‚¶å : root ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ : root\næ¥ç¶šã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆç”»é¢ã«é£›ã³ã¾ã™ã®ã§ Database Datails æ ã« \u0026ldquo;cadvisor\u0026rdquo; ã¨å…¥åŠ›ã€ãã®ä»–ã®é …ç›®ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾ã§ \u0026ldquo;Create Database\u0026rdquo; ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚\ncAdvisor ã® WebUI ã«æ¥ç¶šã™ã‚‹ ç¶šã„ã¦ cAdvisor ã® WebUI ã«æ¥ç¶šã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nURL : http://192.168.33.10:8080\nã“ã“ã§ã¯ç‰¹ã«ä½œæ¥­ã®å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚³ãƒ³ãƒ†ãƒŠã®ç›£è¦–ãŒè¡Œã‚ã‚Œã‚°ãƒ©ãƒ•ãŒæç”»ã•ã‚Œã¦ã„ ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚\nGrafana ã® WebUI ã«æ¥ç¶šã™ã‚‹ æœ€å¾Œã« Grafana ã® WebUI ã§ã™ã€‚\nURL : http://192.168.33.10:3000 ãƒ¦ãƒ¼ã‚¶å : admin ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ : admin\nã¾ãšãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚å·¦ä¸Šã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã— \u0026ldquo;Data Sources\u0026rdquo; ã‚’ é¸æŠã—ã¾ã™ã€‚æ¬¡ã« \u0026ldquo;Add New Data Source\u0026rdquo; ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚\nä¸‹è¨˜ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¾ã—ã‚‡ã†ã€‚\nName : influxdb Type : influxDB 0.8.x Url : http://influxsrv:8086 Access : proxy Basic Auth User admin Basic Auth Password admin Database : cadvisor User : root Password : root ã•ã¦æœ€å¾Œã«ã‚°ãƒ©ãƒ•ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® \u0026ldquo;Dashboard\u0026rdquo; ã‚’é¸æŠã—ä¸Šéƒ¨ã® \u0026ldquo;Home\u0026rdquo; ãƒœãƒ©ãƒ³ã‚’æŠ¼ã— \u0026ldquo;+New\u0026rdquo; ã‚’æŠ¼ã—ã¾ã™ã€‚\nä¸‹è¨˜ã®ç”»é¢ã‚’å‚è€ƒã«ã—å€¤ã«å…¥åŠ›ã—ã¦ã„ãã¾ã™ã€‚\nMetrics ã‚’é¸æŠã—ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å—ä¿¡è»¢é€é‡ã‚’ã‚°ãƒ©ãƒ•ã«ã—ã¦ã„ã¾ã™ã€‚\nseries : \u0026lsquo;stats\u0026rsquo; alias : RX Bytes select mean(rx_bytes) åŒã˜ãé€ä¿¡è»¢é€é‡ã‚‚ã‚°ãƒ©ãƒ•ã«ã—ã¾ã™ã€‚Add Query ã‚’æŠ¼ã™ã¨è¿½åŠ ã§ãã¾ã™ã€‚\nseries : \u0026lsquo;stats\u0026rsquo; alias : TX Bytes select mean(tx_bytes) æ™‚é–“ãŒçµŒéã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ã‚°ãƒ©ãƒ•ãŒæç”»ã•ã‚Œã¾ã™ã€‚\nã¾ã¨ã‚ã¨è€ƒå¯Ÿ 3ã¤ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢å…±ã«é–‹ç™ºãŒæ´»ç™ºã§ã‚ã‚Šã€cAdvisor ã¯ç‰¹ã« Docker ã‚³ãƒ³ãƒ†ãƒŠã®ç›£è¦–ã¨ ã—ã¦ä¸€èˆ¬åŒ–ã—ã¤ã¤ã‚ã‚‹ã‚ˆã†ã€‚Kubernates ã®ä¸€éƒ¨ã¨ã„ã†ã“ã¨ã‚‚ã‚ã‚Šãã†ç°¡å˜ã«ã¯å»ƒã‚Œãª ã„ã¨æƒ³ã„ã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠã®ä¸­ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç­‰ã‚’å…¥ã‚Œã‚‹ã“ã¨ã‚‚ãªãã€ã“ã‚Œã§ Docker ã‚³ ãƒ³ãƒ†ãƒŠã®ãƒªã‚½ãƒ¼ã‚¹ç›£è¦–ãŒå‡ºæ¥ãã†ã€‚ãŸã ã‚µãƒ¼ãƒ“ã‚¹ç›£è¦–ã¯åˆ¥é€”è€ƒãˆãªãã¦ã¯ã„ã‘ãªã„ãªã ã¨ã„ã†å°è±¡ã§ã™ã€‚ã¾ãŸã€ä»Šå› docker-compose ã«è¨˜ã—ãŸå„ã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ Docker Hub ã‚’ç¢ºèªã™ã‚‹ã¨åˆ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚‚ã‚ã‚‹ã®ã§æ™‚æœŸãŒçµŒã£ã¦ã“ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’ã”è¦§ ã«ãªã£ãŸæ–¹ã¯ä¿®æ­£ã™ã‚‹ã¨è‰¯ã„ã¨æƒ³ã„ã¾ã™ã€‚ãŸã ã“ã®è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã‚‹æ™‚ç‚¹ã§ã¯ influxDB ã® 0.9.x ç³»ã§ã¯å‹•ä½œã—ã¾ã›ã‚“ã§ã—ãŸã€‚ã‚ˆã£ã¦ latest ã§ã¯ãªããƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡ å®šã§è¨˜ã—ã¦ã‚ã‚Šã¾ã™ã€‚\nå‚è€ƒã«ã—ãŸã‚µã‚¤ãƒˆ http://qiita.com/atskimura/items/4c4aaaaa554e2814e938 https://www.brianchristner.io/how-to-setup-docker-monitoring/ ","permalink":"https://jedipunkz.github.io/post/2015/09/12/cadvisor-influxdb-grafana-docker/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ Docker ãƒã‚¿ã§ã™ã€‚Docker å°å…¥ã™ã‚‹ã«ã—ã¦ã‚‚ç›£è¦–ã¯ã©ã†ã™ã‚‹ï¼Ÿã¨ã„ã†è©±ã«ãªã‚‹\nã¨æ€ã†ã®ã§ã™ãŒã€å„ Monitoring as a Service ã‚’ä½¿ã†ã«ã—ã¦ã‚‚ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¥ã‚Œãªã„\nã¨ã„ã‘ãªã„ã—ãŠé‡‘æ›ã‹ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã—..ã§ã€èª¿ã¹ã¦ã„ãŸã‚‰ cAdvisor ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰\nãŒå‡ºã¦ãã¾ã—ãŸã€‚ä»Šå›ã¯ cAdvisor ã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠã®ç›£è¦–ãŒå‡ºæ¥ãªã„ã‹ã€ã«ã¤ã„ã¦æ›¸\nã„ã¦ã„ããŸã„ã¨æƒ³ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecAdvisor ã¨ã¯ ?\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ecAdvisor ã¯ Kubernates ã§ç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å˜ä½“ã§ã‚‚åˆ©ç”¨å¯èƒ½ã¨ã®ã“\nã¨ã€‚Google ãŒé–‹ç™ºã—ã¦ã„ã¾ã™ã€‚ã¾ãŸ Docker ã‚³ãƒ³ãƒ†ãƒŠã®ç›£è¦–ã«ãŠã„ã¦ã“ã® cAdvisor\nã¯ä¸€èˆ¬åŒ–ã—ã¤ã¤ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/google/cadvisor\"\u003ehttps://github.com/google/cadvisor\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eåé›†ã—ãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ä¿å­˜\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ecAdvisor è‡ªä½“ã‚‚ Docker ã§èµ·å‹•ã—ã¦ã€åŒãƒ›ã‚¹ãƒˆä¸Šã«èµ·å‹•ã—ã¦ã„ã‚‹ Docker ã‚³ãƒ³ãƒ†ãƒŠã®\nãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã—ã¦ãã‚Œã¾ã™ã€‚ãã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã¯å¹¾ã¤ã‹ã® DB ã«ä¿å­˜å‡º\næ¥ã‚‹ã®ã§ã™ãŒã€ãã®ã†ã¡ã®ä¸€ã¤ãŒ influxDB ã§ã™ã€‚influxDB ã¯æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§\nã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’åã‚ã‚‹ã®ã«ã¡ã‚‡ã†ã©ã„ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://influxdb.com/\"\u003ehttps://influxdb.com/\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDB ã«åã‚ãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å¯è¦–åŒ–\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003einfluxDB ã«åã‚ãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–ã™ã‚‹ã®ãŒ Grafana ã§ã™ã€‚Grafana ã®ãƒ‡ãƒ¼\nã‚¿ã‚½ãƒ¼ã‚¹ã¯ influxDB ã®ä»–ã«ã‚‚å¹¾ã¤ã‹ã‚ã‚Š Elasticsearch, KairosDB, Graphite ç­‰ãŒ\nãã‚Œã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://grafana.org/\"\u003ehttp://grafana.org/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã§ã¯æ—©é€Ÿè©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æã®ç’°å¢ƒ\"\u003eå‰æã®ç’°å¢ƒ\u003c/h2\u003e\n\u003cp\u003eä»Šå›ã¯ Vagrant ã‚’ä½¿ã„ã¾ã™ã€‚ã¾ãŸ Vagrant ä¸Šã§ä¸Šè¨˜ã®3ã¤ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ Docker\nã§ç¨¼åƒã—ã¾ã™ã€‚ã¾ãŸã©ã†ã›ãªã®ã§ docker-compose ã‚’ä½¿ã£ã¦3ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä¸€æ–‰ã«ç«‹\nã¡ä¸Šã’ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\u003c/p\u003e","title":"cAdvisor/influxDB/Grafanaã§Dockerãƒªã‚½ãƒ¼ã‚¹ç›£è¦–"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nå‰å› OpenStack Kilo ã®ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã‚’ Chef-Zero ã‚’ä½¿ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³• ã‚’æ›¸ãã¾ã—ãŸãŒã€è¤‡æ•°å°æ§‹æˆã«ã¤ã„ã¦ã‚‚èª¿ã¹ãŸã®ã§çµæœã‚’ã¾ã¨ã‚ã¦ã„ãã¾ã™ã€‚\nä½¿ã†ã®ã¯ openstack/openstack-chef-repo ã§ã™ã€‚ä¸‹è¨˜ã® URL ã«ã‚ã‚Šã¾ã™ã€‚\nhttps://github.com/openstack/openstack-chef-repo\nã“ã®ä¸­ã« Vagrant ã‚’ä½¿ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã™ãŒã€å®Ÿæ©Ÿã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯å…¨ãå½¹ã« ç«‹ã¡ã¾ã›ã‚“ã€‚è‡ªåˆ†ã§ Environment ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»Šå›ã¯å‰æã® æ§‹æˆã‚’ä½œã£ã¦ã€ãã‚Œã«åˆã‚ã›ãŸ Environment ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨˜ã—ã¾ã™ã€‚ã»ã¼ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ ãªæ§‹æˆã«ã—ã¾ã—ãŸã®ã§ã€è‡ªåˆ†ã®ç’°å¢ƒã«åˆã‚ã›ã¦ä¿®æ­£ã™ã‚‹ã®ã‚‚æ¯”è¼ƒçš„ç°¡å˜ã ã¨æƒ³ã„ã¾ã™ã€‚ å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚\nä»Šå›ã¯ knife-zero ã‚’ä½¿ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚Chef ã‚µãƒ¼ãƒãŒå¿…è¦ãªãã€knife-zero ã‚’ ä½¿ã†ãƒ›ã‚¹ãƒˆä¸Šã®ã‚ªãƒ³ãƒ¡ãƒ¢ãƒªã§ Chef ã‚µãƒ¼ãƒãŒç¨¼åƒã™ã‚‹ã®ã§æº–å‚™ãŒã»ã¨ã‚“ã©å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚\næ—©é€Ÿã§ã™ãŒã€æ§‹æˆã¨æº–å‚™ãƒ»ãã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ä½œæ¥­ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\nå‰æã®æ§‹æˆ +------------+ | GW Router | +--+------------+ | | | +--------------+--------------+---------------------------- public network | | eth0 | eth0 | +------------+ +------------+ +------------+ +------------+ | | Controller | | Network | | Compute | | Knife-Zero | | +------------+ +-------+----+ +------+-----+ +------------+ | | eth1 | eth1 | | eth1 | | eth1 +--+--------------+-------)------+------)-------+------------- api/management network | eth2 | eth2 +-------------+--------------------- guest network ç‰¹å¾´ã¨ã—ã¦ã¯\u0026hellip;\npublic, api/management, guest ã®3ã¤ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã•ã‚ŒãŸ OpenStack ãƒ›ã‚¹ãƒˆ Controller, Network, Compute ã®æœ€å°è¤‡æ•°å°æ§‹æˆ knife-zero ã‚’å®Ÿè¡Œã™ã‚‹ \u0026lsquo;Knife-Zero\u0026rsquo; ãƒ›ã‚¹ãƒˆ Knife-zero ãƒ›ã‚¹ãƒˆã¯ api/management network ã®ã¿ã«æ¥ç¶šã§å¯ ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ api/management network ã‚’ä»‹ã—ã¦è¡Œã† public, api/management network ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸ã®ç–é€šãŒå¿…é ˆ OS ã¯ Ubuntu 14.04 amd64 ã¨ãã« api/management network ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸ã®ç–é€šãŒå¿…è¦ãªã¨ã“ã‚ã«æ³¨æ„ã—ã¦ ãã ã•ã„ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ knife-zero ãƒ›ã‚¹ãƒˆã§å®Ÿè¡Œã—ã¾ã™ãŒã€å„ãƒãƒ¼ãƒ‰ã¸ãƒ­ã‚°ã‚¤ãƒ³ã—ãƒ‡ãƒ— ãƒ­ã‚¤ã™ã‚‹éš›ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã‹ã‚‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å–å¾—ã‚’è©¦ã¿ã¾ã™ã€‚\nã¾ãŸ api/management network ã‚’2ã¤ã«åˆ†é›¢ã™ã‚‹ã®ã‚‚ä¸€èˆ¬çš„ã§ã™ãŒã€ã“ã“ã§ã¯ä¸€æœ¬ã«ã¾ ã¨ã‚ã¦ã„ã¾ã™ã€‚\nIP ã‚¢ãƒ‰ãƒ¬ã‚¹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä¸‹è¨˜ã‚’å‰æã«ã—ã¾ã™ã€‚\ninterface IP addr Controller eth0 10.0.1.10 Controller eth1 10.0.2.10 Network eth0 10.0.1.11 Network eth1 10.0.2.11 Network eth2 10.0.3.11 Compute eth1 10.0.2.12 Compute eth2 10.0.3.12 Knife-Zero eth1 10.0.2.13 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­å®š ãã‚Œãã‚Œã®ãƒ›ã‚¹ãƒˆã§ä¸‹è¨˜ã®ã‚ˆã†ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¨­å®šã—ã¾ã™ã€‚\nController ãƒ›ã‚¹ãƒˆ eth0, 1 ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚\nauto eth0 iface eth0 inet static address 10.0.1.10 netmask 255.255.255.0 gateway 10.0.1.254 dns-nameservers 8.8.8.8 dns-search jedihub.com auto eth1 iface eth1 inet static address 10.0.2.10 netmask 255.255.255.0 auto eth2 iface eth2 inet manual Network ãƒ›ã‚¹ãƒˆ eth0, 1, 2 å…¨ã¦ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚\nauto eth0 iface eth0 inet static up ifconfig $IFACE 0.0.0.0 up up ip link set $IFACE promisc on down ip link set $IFACE promisc off down ifconfig $IFACE down address 10.0.1.11 netmask 255.255.255.0 auto eth1 iface eth1 inet static address 10.0.2.11 netmask 255.255.255.0 gateway 10.0.2.248 dns-nameservers 8.8.8.8 dns-search jedihub.com auto eth2 iface eth2 inet static address 10.0.3.11 netmask 255.255.255.0 Compute ãƒ›ã‚¹ãƒˆ eth1, 2 ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚\nauto eth0 iface eth0 inet manual auto eth1 iface eth1 inet static address 10.0.2.12 netmask 255.255.255.0 gateway 10.0.2.248 dns-nameservers 8.8.8.8 dns-search jedihub.com auto eth2 iface eth2 inet static address 10.0.3.12 netmask 255.255.255.0 ã“ã‚Œã‚‰ã®ä½œæ¥­ã¯ knife-zero ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã— eth1 ã‚’ä»‹ã—ã¦è¡Œã£ã¦ãã ã•ã„ã€‚ã§ãªã„ã¨ æ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\næº–å‚™ knife-zero ãƒ›ã‚¹ãƒˆã« chef, knife-zero, berkshelf ãŒå…¥ã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€ã“ ã“ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚\nknife-zero ãƒ›ã‚¹ãƒˆã« chef ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚Omnibus ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦æ‰‹ã£ å–ã‚Šæ—©ãç’°å¢ƒã‚’æ•´ãˆã¾ã™ã€‚\nsudo -i curl -L https://www.opscode.com/chef/install.sh | bash Berkshelf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã®ã«å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\napt-get -y install build-essential zlib1g-dev libssl-dev libreadline-dev ruby-dev libxml2-dev libxslt-dev g++ Berkshelf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n/opt/chef/embedded/bin/gem install berkshelf --no-ri --no-rdoc æœ€å¾Œã« knife-zero ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n/opt/chef/embedded/bin/gem install knife-zero --no-ri --no-rdoc ãƒ‡ãƒ—ãƒ­ã‚¤ä½œæ¥­ ãã‚Œã§ã¯ openstack-chef-repo ã‚’å–å¾—ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã®æº–å‚™ã‚’è¡Œã„ã¾ã™ã€‚ ãƒ–ãƒ©ãƒ³ãƒã®æŒ‡å®šã¯è¡Œã‚ãš master ãƒ–ãƒ©ãƒ³ãƒã‚’å–å¾—ã—ã¾ã™ã€‚Kilo ã¯ master ãƒ–ãƒ©ãƒ³ãƒã§ ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚æ¬¡ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®é–‹ç™ºãŒå§‹ã¾ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ \u0026lsquo;stable/kilo\u0026rsquo; ãƒ–ãƒ© ãƒ³ãƒã«ç®¡ç†ãŒç§»ã•ã‚Œã¾ã™ã€‚\nsudo -i cd ~/ git clone https://github.com/openstack/openstack-chef-repo.git æ¬¡ã« Berkshelf ã‚’ä½¿ã£ã¦å¿…è¦ãª Cookbooks ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\ncd ~/openstack-chef-repo /opt/chef/embedded/bin/berks vendor ./cookbooks Environment ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã‚Œã¯å„ç’°å¢ƒã«åˆã‚ã›ãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ˆã†ãªã‚‚ã®ã§ã€å„ Cookbooks ã® Attributes ã‚’ä¸Šæ›¸ãã™ã‚‹ä»•çµ„ã¿ã«ãªã£ã¦ã„ã¾ã™ã€‚ä¸‹è¨˜ã®å†…å®¹ã‚’\nopenstack-chef-repo/environments/multi-neutron-kilo.json ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã§ä¿å­˜ã—ã¦ãã ã•ã„ã€‚\n{ \u0026#34;name\u0026#34;: \u0026#34;multi-neutron-kilo\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;test\u0026#34;, \u0026#34;cookbook_versions\u0026#34;: { }, \u0026#34;json_class\u0026#34;: \u0026#34;Chef::Environment\u0026#34;, \u0026#34;chef_type\u0026#34;: \u0026#34;environment\u0026#34;, \u0026#34;default_attributes\u0026#34;: { }, \u0026#34;override_attributes\u0026#34;: { \u0026#34;mysql\u0026#34;: { \u0026#34;bind_address\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;server_root_password\u0026#34;: \u0026#34;mysqlroot\u0026#34;, \u0026#34;server_debian_password\u0026#34;: \u0026#34;mysqlroot\u0026#34;, \u0026#34;server_repl_password\u0026#34;: \u0026#34;mysqlroot\u0026#34;, \u0026#34;allow_remote_root\u0026#34;: true, \u0026#34;root_network_acl\u0026#34;: [\u0026#34;10.0.0.0/8\u0026#34;] }, \u0026#34;rabbitmq\u0026#34;: { \u0026#34;address\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5672\u0026#34;, \u0026#34;loopback_users\u0026#34;: [] }, \u0026#34;openstack\u0026#34;: { \u0026#34;auth\u0026#34;: { \u0026#34;validate_certs\u0026#34;: false }, \u0026#34;dashboard\u0026#34;: { \u0026#34;session_backend\u0026#34;: \u0026#34;file\u0026#34; }, \u0026#34;block-storage\u0026#34;: { \u0026#34;syslog\u0026#34;: { \u0026#34;use\u0026#34;: false }, \u0026#34;api\u0026#34;: { \u0026#34;ratelimit\u0026#34;: \u0026#34;False\u0026#34; }, \u0026#34;debug\u0026#34;: true, \u0026#34;image_api_chef_role\u0026#34;: \u0026#34;os-image\u0026#34;, \u0026#34;identity_service_chef_role\u0026#34;: \u0026#34;os-identity\u0026#34;, \u0026#34;rabbit_server_chef_role\u0026#34;: \u0026#34;os-ops-messaging\u0026#34; }, \u0026#34;compute\u0026#34;: { \u0026#34;rabbit\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;novnc_proxy\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;libvirt\u0026#34;: { \u0026#34;virt_type\u0026#34;: \u0026#34;qemu\u0026#34;, \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;novnc_proxy\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;xvpvnc_proxy\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;image_api_chef_role\u0026#34;: \u0026#34;os-image\u0026#34;, \u0026#34;identity_service_chef_role\u0026#34;: \u0026#34;os-identity\u0026#34;, \u0026#34;nova_setup_chef_role\u0026#34;: \u0026#34;os-compute-api\u0026#34;, \u0026#34;rabbit_server_chef_role\u0026#34;: \u0026#34;os-ops-messaging\u0026#34;, \u0026#34;network\u0026#34;: { \u0026#34;public_interface\u0026#34;: \u0026#34;eth1\u0026#34;, \u0026#34;service_type\u0026#34;: \u0026#34;neutron\u0026#34; } }, \u0026#34;network\u0026#34;: { \u0026#34;debug\u0026#34;: \u0026#34;True\u0026#34;, \u0026#34;dhcp\u0026#34;: { \u0026#34;enable_isolated_metadata\u0026#34;: \u0026#34;True\u0026#34; }, \u0026#34;metadata\u0026#34;: { \u0026#34;nova_metadata_ip\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;openvswitch\u0026#34;: { \u0026#34;tunnel_id_ranges\u0026#34;: \u0026#34;1:1000\u0026#34;, \u0026#34;enable_tunneling\u0026#34;: \u0026#34;True\u0026#34;, \u0026#34;tenant_network_type\u0026#34;: \u0026#34;gre\u0026#34;, \u0026#34;tunnel_types\u0026#34;: \u0026#34;gre\u0026#34;, \u0026#34;tunnel_type\u0026#34;: \u0026#34;gre\u0026#34;, \u0026#34;bridge_mappings\u0026#34;: \u0026#34;physnet1:br-eth2\u0026#34;, \u0026#34;bridge_mapping_interface\u0026#34;: \u0026#34;br-eth2:eth2\u0026#34; }, \u0026#34;ml2\u0026#34;: { \u0026#34;tenant_network_types\u0026#34;: \u0026#34;gre\u0026#34;, \u0026#34;mechanism_drivers\u0026#34;: \u0026#34;openvswitch\u0026#34;, \u0026#34;tunnel_id_ranges\u0026#34;: \u0026#34;1:1000\u0026#34;, \u0026#34;enable_security_group\u0026#34;: \u0026#34;True\u0026#34; }, \u0026#34;api\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;l3\u0026#34;: { \u0026#34;external_network_bridge_interface\u0026#34;: \u0026#34;eth0\u0026#34; }, \u0026#34;service_plugins\u0026#34;: [\u0026#34;neutron.services.l3_router.l3_router_plugin.L3RouterPlugin\u0026#34;] }, \u0026#34;db\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34;, \u0026#34;compute\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;identity\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;image\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;network\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;volume\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;dashboard\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;telemetry\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;orchestration\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; } }, \u0026#34;developer_mode\u0026#34;: true, \u0026#34;endpoints\u0026#34;: { \u0026#34;network-openvswitch\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;compute-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8774\u0026#34; }, \u0026#34;compute-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8774\u0026#34; }, \u0026#34;compute-ec2-admin-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8773\u0026#34; }, \u0026#34;compute-ec2-admin\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8773\u0026#34; }, \u0026#34;compute-ec2-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8773\u0026#34; }, \u0026#34;compute-ec2-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8773\u0026#34; }, \u0026#34;compute-xvpvnc\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;6081\u0026#34; }, \u0026#34;compute-novnc-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;6080\u0026#34; }, \u0026#34;compute-novnc\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;6080\u0026#34; }, \u0026#34;compute-vnc\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;6080\u0026#34; }, \u0026#34;image-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9292\u0026#34; }, \u0026#34;image-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9292\u0026#34; }, \u0026#34;image-registry\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9191\u0026#34; }, \u0026#34;image-registry-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9191\u0026#34; }, \u0026#34;identity-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5000\u0026#34; }, \u0026#34;identity-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5000\u0026#34; }, \u0026#34;identity-admin\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;35357\u0026#34; }, \u0026#34;identity-internal\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;35357\u0026#34; }, \u0026#34;volume-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8776\u0026#34; }, \u0026#34;volume-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8776\u0026#34; }, \u0026#34;telemetry-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8777\u0026#34; }, \u0026#34;network-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.11\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9696\u0026#34; }, \u0026#34;network-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.11, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9696\u0026#34; }, \u0026#34;block-storage-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8776\u0026#34;, \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;block-storage-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8776\u0026#34; }, \u0026#34;orchestration-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8004\u0026#34; }, \u0026#34;orchestration-api-cfn\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8000\u0026#34; }, \u0026#34;db\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;3306\u0026#34; }, \u0026#34;bind-host\u0026#34;: \u0026#34;0.0.0.0\u0026#34; }, \u0026#34;identity\u0026#34;: { \u0026#34;admin_user\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34;, \u0026#34;debug\u0026#34;: true }, \u0026#34;image\u0026#34;: { \u0026#34;api\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;debug\u0026#34;: true, \u0026#34;identity_service_chef_role\u0026#34;: \u0026#34;os-identity\u0026#34;, \u0026#34;rabbit_server_chef_role\u0026#34;: \u0026#34;os-ops-messaging\u0026#34;, \u0026#34;registry\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;syslog\u0026#34;: { \u0026#34;use\u0026#34;: false } }, \u0026#34;mq\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;user\u0026#34;: \u0026#34;guest\u0026#34;, \u0026#34;vhost\u0026#34;: \u0026#34;/nova\u0026#34;, \u0026#34;network\u0026#34;: { \u0026#34;rabbit\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5672\u0026#34; } }, \u0026#34;compute\u0026#34;: { \u0026#34;service_type\u0026#34;: \u0026#34;rabbitmq\u0026#34;, \u0026#34;rabbit\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5672\u0026#34; } }, \u0026#34;block-storage\u0026#34;: { \u0026#34;service_type\u0026#34;: \u0026#34;rabbitmq\u0026#34;, \u0026#34;rabbit\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5672\u0026#34; } } } }, \u0026#34;queue\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;user\u0026#34;: \u0026#34;guest\u0026#34;, \u0026#34;vhost\u0026#34;: \u0026#34;/nova\u0026#34; } } } ä¸Šè¨˜ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ virt_type : qemu ã«è¨­å®šã—ã¦ã„ã¾ã™ãŒã€KVM ãƒªã‚½ãƒ¼ã‚¹ã‚’åˆ©ç”¨å‡ºæ¥ã‚‹ ç’°å¢ƒã§ã‚ã‚Œã°ã“ã“ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® \u0026lsquo;kvm\u0026rsquo; ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚ã¾ãŸæ°— ã‚’ã¤ã‘ã‚‹ã“ã¨ã¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åã§ã™ã€‚ç’°å¢ƒã«åˆã‚ã›ã¦ è¨­å®šã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ä»Šå›ã¯å‰ææ§‹æˆã«åˆã‚ã›ã¦ environemnt ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦ã„ ã¾ã™ã€‚\næ¬¡ã« openstack-chef-repo/.chef/encrypted_data_bag_secret ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒ knife-zero ãƒ›ã‚¹ãƒˆã«ã‚ã‚‹ã¯ãšã§ã™ã€‚ã“ã‚Œã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾è±¡ã®3ãƒãƒ¼ãƒ‰ã«äº‹å‰ã«è»¢é€ã—ã¦ãŠ ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nscp openstack-chef-repo/.chef/encrypted_data_bag_secret 10.0.2.10:/tmp/ scp openstack-chef-repo/.chef/encrypted_data_bag_secret 10.0.2.11:/tmp/ scp openstack-chef-repo/.chef/encrypted_data_bag_secret 10.0.2.12:/tmp/ å¯¾è±¡ãƒ›ã‚¹ãƒˆã«ã¦\nmkdir /etc/chef mv /tmp/encrypted_data_bag_secret /etc/chef/openstack_data_bag_secret ã§ã¯ã„ã‚ˆã„ã‚ˆãƒ‡ãƒ—ãƒ­ã‚¤ã§ã™ã€‚\nController ãƒ›ã‚¹ãƒˆã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤\nknife zero bootstrap 10.0.2.10 -N kilo01 -r \u0026#39;role[os-compute-single-controller-no-network]\u0026#39; -E multi-neutron-kilo -x \u0026lt;USERNAME\u0026gt; --sudo Network ãƒ›ã‚¹ãƒˆã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤\nknife zero bootstrap 10.0.2.11 -N kilo02 -r \u0026#39;role[os-client]\u0026#39;,\u0026#39;role[os-network]\u0026#39; -E multi-neutron-kilo -x \u0026lt;USERNAME\u0026gt; --sudo Compute ãƒãƒ¼ãƒ‰ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤\nknife zero bootstrap 10.0.2.12 -N kilo03 -r \u0026#39;role[os-compute-worker]\u0026#39; -E multi-neutron-kilo -x \u0026lt;USERNAME\u0026gt; --sudo ã“ã‚Œã§å®Œäº†ã§ã™ã€‚admin/mypass ã¨ã„ã†ãƒ¦ãƒ¼ã‚¶ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ãŒå¯èƒ½ã§ã™ã€‚\nã¾ã¨ã‚ openstack-chef-repo ã‚’ä½¿ã£ã¦ OpenStack Kilo ã®è¤‡æ•°å°æ§‹æˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å‡ºæ¥ã¾ã—ãŸã€‚é‡è¦ãªã®ã¯ Environment ã‚’ã©ã†ã‚„ã£ã¦ä½œã‚‹ã‹ï¼Ÿã§ã™ãŒã€ ç§ã¯ ä½œæˆ -\u0026gt; ãƒ‡ãƒ—ãƒ­ã‚¤ -\u0026gt; ä¿®æ­£ -\u0026gt; ãƒ‡ãƒ—ãƒ­ã‚¤ -\u0026gt;\u0026hellip;. ã‚’ç¹°ã‚Šè¿”ã—ã¦ä½œæˆã—ã¦ã„ã¾ã™ã€‚ä½•åº¦å®Ÿè¡Œã—ã¦ã‚‚ä¸å…·åˆã¯ç™ºç”Ÿã—ãªã„è¨­è¨ˆãªã‚¯ãƒƒã‚¯ãƒ–ãƒƒã‚¯ã« ãªã£ã¦ã„ã¾ã™ã®ã§ã€ã“ã®ã‚ˆã†ãªä½œæ¥­ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ã¾ãŸã€ã€Œã“ã“ã®è¨­å®šã‚’è¿½åŠ ã—ãŸã„ã€ã¨ã„ã†æ™‚ã¯\u0026hellip;\nè©²å½“ã® template ã‚’æ¢ã™ è©²å½“ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç¢ºèªã™ã‚‹ recipe å†…ã§ template ã«ã©ã†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã—ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ attribute ãªã‚Šã€å¤‰æ•°ãªã‚Šã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã®æ–¹æ³•ã‚’æ¢ã™ ã¨è¡Œã„ã¾ã™ã€‚æ¯”è¼ƒçš„é›£ã—ã„ä½œæ¥­ã«ãªã‚‹ã®ã§ã™ãŒã€è‡ªã‚‰ã®ç’°å¢ƒã«åˆã‚ã›ãŸ Environment ã‚’ä½œæˆã™ã‚‹ã«ã¯ã“ã‚Œã‚‰ã®ä½œæ¥­ãŒå¿…é ˆã¨ãªã£ã¦ãã¾ã™ã€‚\nä»¥ä¸Šã€è¤‡æ•°å°æ§‹æˆã®ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã«ã¤ã„ã¦ã§ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/2015/07/20/knife-zero-openstack-kilo/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå‰å› OpenStack Kilo ã®ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã‚’ Chef-Zero ã‚’ä½¿ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•\nã‚’æ›¸ãã¾ã—ãŸãŒã€è¤‡æ•°å°æ§‹æˆã«ã¤ã„ã¦ã‚‚èª¿ã¹ãŸã®ã§çµæœã‚’ã¾ã¨ã‚ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä½¿ã†ã®ã¯ openstack/openstack-chef-repo ã§ã™ã€‚ä¸‹è¨˜ã® URL ã«ã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/openstack/openstack-chef-repo\"\u003ehttps://github.com/openstack/openstack-chef-repo\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã“ã®ä¸­ã« Vagrant ã‚’ä½¿ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã™ãŒã€å®Ÿæ©Ÿã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯å…¨ãå½¹ã«\nç«‹ã¡ã¾ã›ã‚“ã€‚è‡ªåˆ†ã§ Environment ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»Šå›ã¯å‰æã®\næ§‹æˆã‚’ä½œã£ã¦ã€ãã‚Œã«åˆã‚ã›ãŸ Environment ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨˜ã—ã¾ã™ã€‚ã»ã¼ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰\nãªæ§‹æˆã«ã—ã¾ã—ãŸã®ã§ã€è‡ªåˆ†ã®ç’°å¢ƒã«åˆã‚ã›ã¦ä¿®æ­£ã™ã‚‹ã®ã‚‚æ¯”è¼ƒçš„ç°¡å˜ã ã¨æƒ³ã„ã¾ã™ã€‚\nå‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ knife-zero ã‚’ä½¿ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚Chef ã‚µãƒ¼ãƒãŒå¿…è¦ãªãã€knife-zero ã‚’\nä½¿ã†ãƒ›ã‚¹ãƒˆä¸Šã®ã‚ªãƒ³ãƒ¡ãƒ¢ãƒªã§ Chef ã‚µãƒ¼ãƒãŒç¨¼åƒã™ã‚‹ã®ã§æº–å‚™ãŒã»ã¨ã‚“ã©å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚\u003c/p\u003e\n\u003cp\u003eæ—©é€Ÿã§ã™ãŒã€æ§‹æˆã¨æº–å‚™ãƒ»ãã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ä½œæ¥­ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æã®æ§‹æˆ\"\u003eå‰æã®æ§‹æˆ\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003e   +------------+\n   | GW Router  |\n+--+------------+\n|  |\n|  +--------------+--------------+---------------------------- public network\n|  | eth0         | eth0\n|  +------------+ +------------+ +------------+ +------------+\n|  | Controller | |  Network   | |  Compute   | | Knife-Zero | \n|  +------------+ +-------+----+ +------+-----+ +------------+\n|  | eth1         | eth1  |      | eth1 |       | eth1 \n+--+--------------+-------)------+------)-------+------------- api/management network\n                          | eth2        | eth2\n                          +-------------+--------------------- guest network\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eç‰¹å¾´ã¨ã—ã¦ã¯\u0026hellip;\u003c/p\u003e","title":"Knife-Zeroã§OpenStack Kiloãƒ‡ãƒ—ãƒ­ã‚¤(è¤‡æ•°å°ç·¨)"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä¹…ã€…ã« openstack-chef-repo ã‚’è¦—ã„ã¦ã¿ãŸã‚‰ \u0026lsquo;openstack/openstack-chef-repo\u0026rsquo; ã¨ã— ã¦å…¬é–‹ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚ä»Šã¾ã§ stackforge å´ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã—ãŸãŒ \u0026lsquo;openstack\u0026rsquo; ã®æ–¹ã«ç§»å‹•ã—ãŸã‚ˆã†ã§ã™ã€‚\nhttps://github.com/openstack/openstack-chef-repo\nçµæ§‹å®‰å®šã—ã¦ãã¦ã„ã‚‹ã®ã‹ãªï¼Ÿã¨æƒ³ã„ã€ã¡ã‚‰ã£ã¨è©¦ã—ãŸã®ã§ã™ãŒæ¡ˆã®å®šã€ç°¡å˜ã«å‹•ä½œã• ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚\nä»Šå›ã¯ã“ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ä½¿ã£ã¦ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã® OpenStack Kilo ã‚’ä½œã‚‹æ–¹æ³•ã‚’ã¾ ã¨ã‚ã¦ã„ãã¾ã™ã€‚\nå‰æã®æ§‹æˆ ã“ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã¯ Vagrant ã§ OpenStack ã‚’ä½œã‚‹ãŸã‚ã®ç’°å¢ƒä¸€å¼ãŒæœ€åˆã‹ã‚‰ç”¨æ„ã•ã‚Œã¦ ã„ã¾ã™ãŒã€Vagrant ã§ã¯æœ¬ç•ªç’°å¢ƒã‚’ä½œã‚‹ã“ã¨ã¯å‡ºæ¥ãªã„ãŸã‚ã€Ubuntu ãƒ›ã‚¹ãƒˆã‚’å‰æã¨ ã—ãŸè¨˜è¿°ã«å·®ã—æ›¿ãˆã¦èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚å‰æã«ã™ã‚‹æ§‹æˆã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\nUuntu Linux 14.04 x 1 å° ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ x 3 ã¤ eth0 : External ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç”¨ eth1 : Internal (API, Manage) ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç”¨ eth2 : Guest ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç”¨ ç‰¹å¾´ã¨ã—ã¦ã¯ä¸Šè¨˜ãªã®ã§ã™ãŒã€eth2 ã«é–¢ã—ã¦ã¯ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ãªã®ã§å¿…ãšã—ã‚‚å¿…è¦ã¨ ã„ã†ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¤‡æ•°å°æ§‹æˆã‚’è€ƒæ…®ã—ãŸè¨­å®šã«ãªã£ã¦ã„ã¾ã™ã€‚\nå‰æã®IP ã‚¢ãƒ‰ãƒ¬ã‚¹ ã“ã®è¨˜äº‹ã§ã¯ä¸‹è¨˜ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰æã«ã—ã¾ã™ã€‚ãŠæ‰‹æŒã¡ã®ç’°å¢ƒã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒé• ã„å ´åˆã¯ãã‚Œã«åˆã‚ã›ã¦å¾Œã«ç¤ºã™ json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚\n10.0.1.10 (eth0) : external ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ 10.0.2.10 (eth1) : api/management ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ 10.0.3.10 (eth2) : Guest ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ äº‹å‰ã®æº–å‚™ äº‹å‰ã«å¯¾è±¡ãƒ›ã‚¹ãƒˆ (OpenStack ãƒ›ã‚¹ãƒˆ) ã« chef, berkshelf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\nsudo -i curl -L https://www.opscode.com/chef/install.sh | bash Berkshelf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã®ã«å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\napt-get -y install build-essential zlib1g-dev libssl-dev libreadline-dev ruby-dev libxml2-dev libxslt-dev g++ Berkshelf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n/opt/chef/embedded/bin/gem install berkshelf --no-ri --no-rdoc ãƒ‡ãƒ—ãƒ­ã‚¤ä½œæ¥­ ãã‚Œã§ã¯ openstack-chef-repo ã‚’å–å¾—ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã®æº–å‚™ã‚’è¡Œã„ã¾ã™ã€‚ ãƒ–ãƒ©ãƒ³ãƒã®æŒ‡å®šã¯è¡Œã‚ãš master ãƒ–ãƒ©ãƒ³ãƒã‚’å–å¾—ã—ã¾ã™ã€‚Kilo ã¯ master ãƒ–ãƒ©ãƒ³ãƒã§ ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚æ¬¡ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®é–‹ç™ºãŒå§‹ã¾ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ \u0026lsquo;stable/kilo\u0026rsquo; ãƒ–ãƒ© ãƒ³ãƒã«ç®¡ç†ãŒç§»ã•ã‚Œã¾ã™ã€‚\nsudo -i cd ~/ git clone https://github.com/openstack/openstack-chef-repo.git æ¬¡ã« Berkshelf ã‚’ä½¿ã£ã¦å¿…è¦ãª Cookbooks ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\ncd ~/openstack-chef-repo /opt/chef/embedded/bin/berks vendor ./cookbooks Environment ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã‚Œã¯å„ç’°å¢ƒã«åˆã‚ã›ãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ˆã†ãªã‚‚ã®ã§ã€å„ Cookbooks ã® Attributes ã‚’ä¸Šæ›¸ãã™ã‚‹ä»•çµ„ã¿ã«ãªã£ã¦ã„ã¾ã™ã€‚ä¸‹è¨˜ã®å†…å®¹ã‚’\nopenstack-chef-repo/environments/aio-neutron-kilo.json ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã§ä¿å­˜ã—ã¦ãã ã•ã„ã€‚\n{ \u0026#34;name\u0026#34;: \u0026#34;aio-neutron-kilo\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;test\u0026#34;, \u0026#34;cookbook_versions\u0026#34;: { }, \u0026#34;json_class\u0026#34;: \u0026#34;Chef::Environment\u0026#34;, \u0026#34;chef_type\u0026#34;: \u0026#34;environment\u0026#34;, \u0026#34;default_attributes\u0026#34;: { }, \u0026#34;override_attributes\u0026#34;: { \u0026#34;mysql\u0026#34;: { \u0026#34;bind_address\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;server_root_password\u0026#34;: \u0026#34;mysqlroot\u0026#34;, \u0026#34;server_debian_password\u0026#34;: \u0026#34;mysqlroot\u0026#34;, \u0026#34;server_repl_password\u0026#34;: \u0026#34;mysqlroot\u0026#34;, \u0026#34;allow_remote_root\u0026#34;: true, \u0026#34;root_network_acl\u0026#34;: [\u0026#34;10.0.0.0/8\u0026#34;] }, \u0026#34;rabbitmq\u0026#34;: { \u0026#34;address\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5672\u0026#34;, \u0026#34;loopback_users\u0026#34;: [] }, \u0026#34;openstack\u0026#34;: { \u0026#34;auth\u0026#34;: { \u0026#34;validate_certs\u0026#34;: false }, \u0026#34;dashboard\u0026#34;: { \u0026#34;session_backend\u0026#34;: \u0026#34;file\u0026#34; }, \u0026#34;block-storage\u0026#34;: { \u0026#34;syslog\u0026#34;: { \u0026#34;use\u0026#34;: false }, \u0026#34;api\u0026#34;: { \u0026#34;ratelimit\u0026#34;: \u0026#34;False\u0026#34; }, \u0026#34;debug\u0026#34;: true, \u0026#34;image_api_chef_role\u0026#34;: \u0026#34;os-image\u0026#34;, \u0026#34;identity_service_chef_role\u0026#34;: \u0026#34;os-identity\u0026#34;, \u0026#34;rabbit_server_chef_role\u0026#34;: \u0026#34;os-ops-messaging\u0026#34; }, \u0026#34;compute\u0026#34;: { \u0026#34;rabbit\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;novnc_proxy\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;libvirt\u0026#34;: { \u0026#34;virt_type\u0026#34;: \u0026#34;qemu\u0026#34;, \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;novnc_proxy\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;xvpvnc_proxy\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;image_api_chef_role\u0026#34;: \u0026#34;os-image\u0026#34;, \u0026#34;identity_service_chef_role\u0026#34;: \u0026#34;os-identity\u0026#34;, \u0026#34;nova_setup_chef_role\u0026#34;: \u0026#34;os-compute-api\u0026#34;, \u0026#34;rabbit_server_chef_role\u0026#34;: \u0026#34;os-ops-messaging\u0026#34;, \u0026#34;network\u0026#34;: { \u0026#34;public_interface\u0026#34;: \u0026#34;eth1\u0026#34;, \u0026#34;service_type\u0026#34;: \u0026#34;neutron\u0026#34; } }, \u0026#34;network\u0026#34;: { \u0026#34;debug\u0026#34;: \u0026#34;True\u0026#34;, \u0026#34;dhcp\u0026#34;: { \u0026#34;enable_isolated_metadata\u0026#34;: \u0026#34;True\u0026#34; }, \u0026#34;metadata\u0026#34;: { \u0026#34;nova_metadata_ip\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;openvswitch\u0026#34;: { \u0026#34;tunnel_id_ranges\u0026#34;: \u0026#34;1:1000\u0026#34;, \u0026#34;enable_tunneling\u0026#34;: \u0026#34;True\u0026#34;, \u0026#34;tenant_network_type\u0026#34;: \u0026#34;gre\u0026#34;, \u0026#34;local_ip_interface\u0026#34;: \u0026#34;eth2\u0026#34; }, \u0026#34;api\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;l3\u0026#34;: { \u0026#34;external_network_bridge_interface\u0026#34;: \u0026#34;eth0\u0026#34; }, \u0026#34;service_plugins\u0026#34;: [\u0026#34;neutron.services.l3_router.l3_router_plugin.L3RouterPlugin\u0026#34;] }, \u0026#34;db\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34;, \u0026#34;compute\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;identity\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;image\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;network\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;volume\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;dashboard\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;telemetry\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; }, \u0026#34;orchestration\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34; } }, \u0026#34;developer_mode\u0026#34;: true, \u0026#34;endpoints\u0026#34;: { \u0026#34;compute-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8774\u0026#34; }, \u0026#34;compute-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8774\u0026#34; }, \u0026#34;compute-ec2-admin-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8773\u0026#34; }, \u0026#34;compute-ec2-admin\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8773\u0026#34; }, \u0026#34;compute-ec2-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8773\u0026#34; }, \u0026#34;compute-ec2-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8773\u0026#34; }, \u0026#34;compute-xvpvnc\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;6081\u0026#34; }, \u0026#34;compute-novnc-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;6080\u0026#34; }, \u0026#34;compute-novnc\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;6080\u0026#34; }, \u0026#34;compute-vnc\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;6080\u0026#34; }, \u0026#34;image-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9292\u0026#34; }, \u0026#34;image-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9292\u0026#34; }, \u0026#34;image-registry\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9191\u0026#34; }, \u0026#34;image-registry-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9191\u0026#34; }, \u0026#34;identity-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5000\u0026#34; }, \u0026#34;identity-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5000\u0026#34; }, \u0026#34;identity-admin\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;35357\u0026#34; }, \u0026#34;identity-internal\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;35357\u0026#34; }, \u0026#34;volume-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8776\u0026#34; }, \u0026#34;volume-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8776\u0026#34; }, \u0026#34;telemetry-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8777\u0026#34; }, \u0026#34;network-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9696\u0026#34; }, \u0026#34;network-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9696\u0026#34; }, \u0026#34;orchestration-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8004\u0026#34; }, \u0026#34;orchestration-api-cfn\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8000\u0026#34; }, \u0026#34;db\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;3306\u0026#34; }, \u0026#34;bind-host\u0026#34;: \u0026#34;0.0.0.0\u0026#34; }, \u0026#34;identity\u0026#34;: { \u0026#34;admin_user\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34;, \u0026#34;debug\u0026#34;: true }, \u0026#34;image\u0026#34;: { \u0026#34;api\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;debug\u0026#34;: true, \u0026#34;identity_service_chef_role\u0026#34;: \u0026#34;os-identity\u0026#34;, \u0026#34;rabbit_server_chef_role\u0026#34;: \u0026#34;os-ops-messaging\u0026#34;, \u0026#34;registry\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;syslog\u0026#34;: { \u0026#34;use\u0026#34;: false } }, \u0026#34;mq\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;user\u0026#34;: \u0026#34;guest\u0026#34;, \u0026#34;vhost\u0026#34;: \u0026#34;/nova\u0026#34;, \u0026#34;network\u0026#34;: { \u0026#34;rabbit\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5672\u0026#34; } }, \u0026#34;compute\u0026#34;: { \u0026#34;service_type\u0026#34;: \u0026#34;rabbitmq\u0026#34;, \u0026#34;rabbit\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5672\u0026#34; } }, \u0026#34;block-storage\u0026#34;: { \u0026#34;service_type\u0026#34;: \u0026#34;rabbitmq\u0026#34;, \u0026#34;rabbit\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5672\u0026#34; } } } }, \u0026#34;queue\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.2.10\u0026#34;, \u0026#34;user\u0026#34;: \u0026#34;guest\u0026#34;, \u0026#34;vhost\u0026#34;: \u0026#34;/nova\u0026#34; } } } ä¸Šè¨˜ãƒ•ã‚¡ã‚¤ãƒ«ã¯ KVM ãŒä½¿ãˆãªã„ç’°å¢ƒç”¨ã« virt_type : qemu ã«ã—ã¦ã„ã¾ã™ãŒã€KVM ãŒ åˆ©ç”¨ã§ãã‚‹ç’°å¢ƒã‚’ã”åˆ©ç”¨ã§ã‚ã‚Œã°è©²å½“è¡Œã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã® \u0026lsquo;kvm\u0026rsquo; ãŒå…¥ã‚‹ã¯ãšã§ã™ã€‚\næ¬¡ã«ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã« databag é–¢é€£ã®äº‹å‰æ“ä½œã‚’è¡Œã„ã¾ã™ã€‚Vagrant ç”¨ã«ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ ã‚¤ãƒ«ã‚’é™¤ãã¨\u0026hellip;\nmachine \u0026#39;controller\u0026#39; do add_machine_options vagrant_config: controller_config role \u0026#39;allinone-compute\u0026#39; role \u0026#39;os-image-upload\u0026#39; chef_environment env file(\u0026#39;/etc/chef/openstack_data_bag_secret\u0026#39;, \u0026#34;#{File.dirname(__FILE__)}/.chef/encrypted_data_bag_secret\u0026#34;) converge true end ã¨ãªã£ã¦ã„ã¦ /etc/chef/openstack_data_bag_secret ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’äº‹å‰ã«ã‚³ãƒ”ãƒ¼ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚ä¸‹è¨˜ã®ã‚ˆã†ã«æ“ä½œã—ã¾ã™ã€‚\ncp .chef/encrypted_data_bag_secret /etc/chef/openstack_data_bag_secret ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\nã“ã® openstack-chef-repo ã«ã¯ .chef ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ã¦ã„ã¦ãƒãƒ¼ãƒ‰åãŒè¨˜ã•ã‚Œ ã¦ã„ã¾ã™ã€‚\u0026rsquo;nodienode\u0026rsquo; ã¨ã„ã†ãƒãƒ¼ãƒ‰åã§ã™ã€‚ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ãã®ã¾ã¾ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œ ã—ã¾ã™ã€‚\nchef-client -z knife node -z run_list add nodienode \u0026#39;role[allinone-compute]\u0026#39; chef-client -z -E aio-neutron-kilo ä¸Šè¨˜ã®èª¬æ˜ã‚’è¡Œã„ã¾ã™ã€‚ ï¼‘è¡Œç›® chef-client -z ã§ Chef-Zero ã‚µãƒ¼ãƒã‚’ãƒ¡ãƒ¢ãƒªä¸Šã«èµ·å‹•ã—ã€2è¡Œç›®ã§è‡ªãƒãƒ¼ãƒ‰ã¸ run_list ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚æœ€å¾Œã€3è¡Œç›®ã§ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œã€ã¨ãªã‚Šã¾ã™ã€‚\næ•°åˆ†å¾…ã¤ã¨ OpenStack Kilo ãŒæ§‹æˆã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚\nã¾ã¨ã‚ Chef-Zero ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ Chef ã‚µãƒ¼ãƒã‚’åˆ©ç”¨ã›ãšã«æ¥½ã«æ§‹ç¯‰ãŒè¡Œãˆã¾ã—ãŸã€‚ã§ã™ãŒã€ OpenStack ã®è¤‡æ•°å°æ§‹æˆã¨ãªã‚‹ã¨ãã‚Œãã‚Œã®ãƒãƒ¼ãƒ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é€£æºã•ã›ã‚‹å¿…è¦ãŒå‡º ã¦ãã‚‹ã®ã§ Chef ã‚µãƒ¼ãƒã‚’ç”¨ã„ãŸã»ã†ãŒè‰¯ã•ãã†ã§ã™ã€‚ä»Šåº¦ã€æ™‚é–“ã‚’è¦‹ã¤ã‘ã¦ Kilo ã® è¤‡æ•°å°æ§‹æˆã«ã¤ã„ã¦ã‚‚èª¿ã¹ã¦ãŠãã¾ã™ã€‚\nã¾ãŸã€master ãƒ–ãƒ©ãƒ³ãƒã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã®ã§ã€ã¾ã  openstack-chef-repo è‡ªä½“ãŒæµå‹• çš„ãªçŠ¶æ…‹ã¨ã‚‚è¨€ãˆã¾ã™ã€‚ãŒ launchpad ã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ Bug ãƒªã‚¹ãƒˆã‚’è¦‹ã‚‹ã¨ã€ã‚¹ãƒ†ãƒ¼ ã‚¿ã‚¹ Critical, High ã® Bug ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã®ã§ Kilo ã«é–¢ã—ã¦ã¯ã€å¤§ããªå•é¡Œ ç„¡ãå®‰å®šã—ã¦ãã¦ã„ã‚‹æ„ŸãŒã‚ã‚Šã¾ã™ã€‚\nhttps://bugs.launchpad.net/openstack-chef\n","permalink":"https://jedipunkz.github.io/post/2015/07/16/chef-zero-openstack-allinone/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä¹…ã€…ã« openstack-chef-repo ã‚’è¦—ã„ã¦ã¿ãŸã‚‰ \u0026lsquo;openstack/openstack-chef-repo\u0026rsquo; ã¨ã—\nã¦å…¬é–‹ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚ä»Šã¾ã§ stackforge å´ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã—ãŸãŒ \u0026lsquo;openstack\u0026rsquo;\nã®æ–¹ã«ç§»å‹•ã—ãŸã‚ˆã†ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/openstack/openstack-chef-repo\"\u003ehttps://github.com/openstack/openstack-chef-repo\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eçµæ§‹å®‰å®šã—ã¦ãã¦ã„ã‚‹ã®ã‹ãªï¼Ÿã¨æƒ³ã„ã€ã¡ã‚‰ã£ã¨è©¦ã—ãŸã®ã§ã™ãŒæ¡ˆã®å®šã€ç°¡å˜ã«å‹•ä½œã•\nã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ã“ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ä½¿ã£ã¦ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã® OpenStack Kilo ã‚’ä½œã‚‹æ–¹æ³•ã‚’ã¾\nã¨ã‚ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æã®æ§‹æˆ\"\u003eå‰æã®æ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eã“ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã¯ Vagrant ã§ OpenStack ã‚’ä½œã‚‹ãŸã‚ã®ç’°å¢ƒä¸€å¼ãŒæœ€åˆã‹ã‚‰ç”¨æ„ã•ã‚Œã¦\nã„ã¾ã™ãŒã€Vagrant ã§ã¯æœ¬ç•ªç’°å¢ƒã‚’ä½œã‚‹ã“ã¨ã¯å‡ºæ¥ãªã„ãŸã‚ã€Ubuntu ãƒ›ã‚¹ãƒˆã‚’å‰æã¨\nã—ãŸè¨˜è¿°ã«å·®ã—æ›¿ãˆã¦èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚å‰æã«ã™ã‚‹æ§‹æˆã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUuntu Linux 14.04 x 1 å°\u003c/li\u003e\n\u003cli\u003eãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ x 3 ã¤\u003c/li\u003e\n\u003cli\u003eeth0 : External ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç”¨\u003c/li\u003e\n\u003cli\u003eeth1 : Internal (API, Manage) ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç”¨\u003c/li\u003e\n\u003cli\u003eeth2 : Guest ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç”¨\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç‰¹å¾´ã¨ã—ã¦ã¯ä¸Šè¨˜ãªã®ã§ã™ãŒã€eth2 ã«é–¢ã—ã¦ã¯ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ãªã®ã§å¿…ãšã—ã‚‚å¿…è¦ã¨\nã„ã†ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¤‡æ•°å°æ§‹æˆã‚’è€ƒæ…®ã—ãŸè¨­å®šã«ãªã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æã®ip-ã‚¢ãƒ‰ãƒ¬ã‚¹\"\u003eå‰æã®IP ã‚¢ãƒ‰ãƒ¬ã‚¹\u003c/h2\u003e\n\u003cp\u003eã“ã®è¨˜äº‹ã§ã¯ä¸‹è¨˜ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰æã«ã—ã¾ã™ã€‚ãŠæ‰‹æŒã¡ã®ç’°å¢ƒã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒé•\nã„å ´åˆã¯ãã‚Œã«åˆã‚ã›ã¦å¾Œã«ç¤ºã™ json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e10.0.1.10 (eth0) : external ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u003c/li\u003e\n\u003cli\u003e10.0.2.10 (eth1) : api/management ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u003c/li\u003e\n\u003cli\u003e10.0.3.10 (eth2) : Guest ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"äº‹å‰ã®æº–å‚™\"\u003eäº‹å‰ã®æº–å‚™\u003c/h2\u003e\n\u003cp\u003eäº‹å‰ã«å¯¾è±¡ãƒ›ã‚¹ãƒˆ (OpenStack ãƒ›ã‚¹ãƒˆ) ã« chef, berkshelf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e","title":"Chef-Zeroã§OpenStack Kiloãƒ‡ãƒ—ãƒ­ã‚¤(ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ç·¨)"},{"content":"ã“ã‚“ã«ã¡ã¯ã€@jedipunkz ã§ã™ã€‚\nä¹…ã€…ã«ãƒ–ãƒ­ã‚°æ›´æ–°ã«ãªã‚Šã¾ã—ãŸãŒã€ã‚¦ã‚©ãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒƒãƒ—ã§ minio ã¨ã„ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ã¿ãŸãƒ¡ãƒ¢ã‚’è¨˜äº‹ã«ã—ãŸã„ã¨æƒ³ã„ã¾ã™ã€‚\nminio ã¯ Minimal Object Storage ã®åã®é€šã‚Šã€æœ€å°é™ã®å°ã•ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ ã‚¸ã«ãªã‚Šã¾ã™ã€‚å…¬å¼ã‚µã‚¤ãƒˆã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\nhttp://minio.io/\nGolang ã§è¨˜è¿°ã•ã‚Œã¦ã„ã¦ Apache License v2 ã®å…ƒã«å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚\næœ€è¿‘ã€è³‡é‡‘èª¿é”ã®è©±ã‚‚æŒ™ãŒã£ã¦ã„ãŸã®ã§ã€ã“ã‚Œã‹ã‚‰ä¸€èˆ¬çš„ã«ãªã£ã¦ãã‚‹ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\næ—©é€Ÿã§ã™ãŒã€minio ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã™ã€‚\nMinio ã‚’èµ·å‹•ã™ã‚‹ æ–¹æ³•ã¯ mithub.com/minio/minio ã® README ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã€ãƒã‚¤ãƒŠãƒªã‚’æŒã£ã¦ã ã¦å®Ÿè¡Œæ¨©é™ã‚’ä¸ãˆã‚‹ã ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãªæ‰‹é †ã«ãªã‚Šã¾ã™ã€‚\nLinux ã§ã‚‚ Mac ã§ã‚‚å‹•ä½œã—ã¾ã™ãŒã€ä»Šå›ç§ã¯ Mac ä¸Šã§å‹•ä½œã•ã›ã¾ã—ãŸã€‚\n% wget https://dl.minio.io:9000/updates/2015/Jun/darwin-amd64/minio % chmod +x minio % ./minio mode memory limit 512MB Starting minio server on: http://127.0.0.1:9000 Starting minio server on: http://192.168.1.123:9000 èµ·å‹•ã™ã‚‹ã¨ Listening Port ã¨å…±ã« EndPoint ã® URL ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\næ¬¡ã« mc ã¨ã„ã† minio client ã‚’ä½¿ã£ã¦å‹•ä½œç¢ºèªã—ã¾ã™ã€‚\nMc ã‚’ä½¿ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ mc ã¯ä¸‹è¨˜ã® URL ã«ã‚ã‚Šã¾ã™ã€‚\nhttps://github.com/minio/mc\nã“ã¡ã‚‰ã‚‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸ã™ã‚‹ã®ã¿ã§ã™ã€‚mc ã¯ minio ã ã‘ã§ã¯ãªãã€ Amazon S3 ã¨ã‚‚äº’æ›æ€§ãŒã‚ã‚Šã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã¾ã™ãŒã€ã›ã£ã‹ããªã®ã§ä¸Šè¨˜ã§èµ·å‹•ã—ãŸ minio ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚\n% wget https://dl.minio.io:9000/updates/2015/Jun/darwin-amd64/mc % chmod +x mc % ./mc config generate /mc ls http://127.0.0.1:9000/bucket01 [2015-06-25 16:21:37 JST] 0B testfile ä¸Šè¨˜ã§ã¯äºˆã‚ä½œã£ã¦ãŠã„ãŸ bucket01 ã¨ã„ã†åå‰ã®ãƒã‚±ãƒƒãƒˆã®ä¸­èº«ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚ ä½œã‚Šæ–¹ã¯ã“ã‚Œã‹ã‚‰ minio ã® Golang ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹ minio-go ã‚’ä½¿ã£ã¦ä½œã‚Šã¾ã—ãŸã€‚ ã“ã‚Œã‹ã‚‰èª¬æ˜ã—ã¾ã™ã€‚\nã¾ãŸ ls ã‚³ãƒãƒ³ãƒ‰ã®ä»–ã«ã‚‚ Usage ã‚’ç¢ºèªã™ã‚‹ã¨å¹¾ã¤ã‹ã®ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ã€‚\nMinio ã® Golang ãƒ©ã‚¤ãƒ–ãƒ©ãƒª minio-go ã‚’ä½¿ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ ã•ã¦ã€ã›ã£ã‹ãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚‚æ‰‹ä½œæ¥­ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒã‚±ãƒƒãƒˆã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ è¡Œã†ã®ã¯ã‚‚ã£ãŸã„ãªã„ã§ã™ã€‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä½¿ã£ã¦æ“ä½œã—ã¦ã™ã€‚\nminio ã®ã‚µãƒ³ãƒ—ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã—ã¦ã€ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚\npackage main import ( \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;github.com/minio/minio-go\u0026#34; ) func main() { config := minio.Config{ // AccessKeyID: \u0026#34;YOUR-ACCESS-KEY-HERE\u0026#34;, // SecretAccessKey: \u0026#34;YOUR-PASSWORD-HERE\u0026#34;, Endpoint: \u0026#34;http://127.0.0.1:9000\u0026#34;, } s3Client, err := minio.New(config) if err != nil { log.Fatalln(err) } err = s3Client.MakeBucket(\u0026#34;bucket01\u0026#34;, minio.BucketACL(\u0026#34;public-read-write\u0026#34;)) if err != nil { log.Fatalln(err) } log.Println(\u0026#34;Success: I made a bucket.\u0026#34;) object, err := os.Open(\u0026#34;testfile\u0026#34;) if err != nil { log.Fatalln(err) } defer object.Close() objectInfo, err := object.Stat() if err != nil { object.Close() log.Fatalln(err) } err = s3Client.PutObject(\u0026#34;bucket01\u0026#34;, \u0026#34;testfile\u0026#34;, \u0026#34;application/octet-stream\u0026#34;, objectInfo.Size(), object) if err != nil { log.Fatalln(err) } for bucket := range s3Client.ListBuckets() { if bucket.Err != nil { log.Fatalln(bucket.Err) } log.Println(bucket.Stat) } for object := range s3Client.ListObjects(\u0026#34;bucket01\u0026#34;, \u0026#34;\u0026#34;, true) { if object.Err != nil { log.Fatalln(object.Err) } log.Println(object.Stat) } } ç°¡å˜ã§ã™ãŒã‚³ãƒ¼ãƒ‰ã®èª¬æ˜ã‚’ã—ã¾ã™ã€‚\n11è¡Œç›®ã§ config ã®ä¸Šæ›¸ãã‚’ã—ã¾ã™ã€‚å…ˆã»ã©èµ·å‹•ã—ãŸ minio ã® EndPoint ã‚’è¨˜ã—ã¾ã™ã€‚ 17è¡Œç›®ã§ minio ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¼µã‚Šæ¥ç¶šã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚ 22è¡Œç›®ã§ \u0026lsquo;bucket01\u0026rsquo; ã¨ã„ã†ãƒã‚±ãƒƒãƒˆã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚ãã®éš›ã«ACLã‚‚è¨­å®š 28è¡Œç›®ã‹ã‚‰42è¡Œç›®ã§ \u0026rsquo;testfile\u0026rsquo; ã¨ã„ã†ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«PUTã—ã¦ã„ã¾ã™ã€‚ 44è¡Œç›®ã§ãƒã‚±ãƒƒãƒˆä¸€è¦§ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚ 51è¡Œç›®ã§ä¸Šè¨˜ã§ä½œæˆã—ãŸãƒã‚±ãƒƒãƒˆã®ä¸­ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚ å®Ÿè¡Œçµæœã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\n2015/06/25 16:56:21 Success: I made a bucket. 2015/06/25 16:56:21 {bucket01 2015-06-25 07:56:21.155 +0000 UTC} 2015/06/25 16:56:21 {\u0026#34;d41d8cd98f00b204e9800998ecf8427e\u0026#34; testfile 2015-06-25 07:56:21.158 +0000 UTC 0 {minio minio} STANDARD} ãƒã‚±ãƒƒãƒˆã®ä½œæˆã¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã® PUT ãŒæ­£å¸¸ã«è¡ŒãˆãŸã“ã¨ã‚’ãƒ­ã‚°ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚\nã¾ã¨ã‚ ä¸Šè¨˜ã®é€šã‚Šã€ä»Šç¾åœ¨å‡ºæ¥ã‚‹ã“ã¨ã¯å°‘ãªã„ã§ã™ãŒå†’é ­ã«ã‚‚è¨˜ã—ãŸã¨ãŠã‚Šè³‡é‡‘èª¿é”ã®è©±ã‚‚æŒ™ ãŒã£ã¦ãã¦ã„ã¾ã™ã®ã§ã€ã“ã‚Œã‹ã‚‰ã©ã®ã‚ˆã†ãªæ–¹å‘ã«å‘ã‹ã†ã‹æ¥½ã—ã¿ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚ã¾ãŸ æœ€åˆã‹ã‚‰ Golang, Python ç­‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã¨ã“ã‚ãŒä»Šã©ãã ãªãã¨æƒ³ ã„ã¾ã—ãŸã€‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æ‰‹ä½œæ¥­ã§æ“ä½œã™ã‚‹ã‚±ãƒ¼ã‚¹ã¯ç¾å ´ã§ã¯æ®†ã©ç„¡ã„ã¨æƒ³ ã„ã¾ã™ã®ã§ã€ãã®è¾ºã¯ç¾åœ¨ã§ã¯å½“ãŸã‚Šå‰ã«ãªã‚Šã¤ã¤ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã¡ãªã¿ã« Python ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä¸‹è¨˜ã® URL ã«ã‚ã‚Šã¾ã™ã€‚\nhttps://github.com/minio/minio-py\nä»¥ä¸Šã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2015/06/25/minio/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä¹…ã€…ã«ãƒ–ãƒ­ã‚°æ›´æ–°ã«ãªã‚Šã¾ã—ãŸãŒã€ã‚¦ã‚©ãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒƒãƒ—ã§ minio ã¨ã„ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\nã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ã¿ãŸãƒ¡ãƒ¢ã‚’è¨˜äº‹ã«ã—ãŸã„ã¨æƒ³ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eminio ã¯ Minimal Object Storage ã®åã®é€šã‚Šã€æœ€å°é™ã®å°ã•ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼\nã‚¸ã«ãªã‚Šã¾ã™ã€‚å…¬å¼ã‚µã‚¤ãƒˆã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://minio.io/\"\u003ehttp://minio.io/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eGolang ã§è¨˜è¿°ã•ã‚Œã¦ã„ã¦ Apache License v2 ã®å…ƒã«å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€è¿‘ã€è³‡é‡‘èª¿é”ã®è©±ã‚‚æŒ™ãŒã£ã¦ã„ãŸã®ã§ã€ã“ã‚Œã‹ã‚‰ä¸€èˆ¬çš„ã«ãªã£ã¦ãã‚‹ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\u003c/p\u003e\n\u003cp\u003eæ—©é€Ÿã§ã™ãŒã€minio ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"minio-ã‚’èµ·å‹•ã™ã‚‹\"\u003eMinio ã‚’èµ·å‹•ã™ã‚‹\u003c/h2\u003e\n\u003cp\u003eæ–¹æ³•ã¯ mithub.com/minio/minio ã® README ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã€ãƒã‚¤ãƒŠãƒªã‚’æŒã£ã¦ã\nã¦å®Ÿè¡Œæ¨©é™ã‚’ä¸ãˆã‚‹ã ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãªæ‰‹é †ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eLinux ã§ã‚‚ Mac ã§ã‚‚å‹•ä½œã—ã¾ã™ãŒã€ä»Šå›ç§ã¯ Mac ä¸Šã§å‹•ä½œã•ã›ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% wget https://dl.minio.io:9000/updates/2015/Jun/darwin-amd64/minio\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% chmod +x minio\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% ./minio mode memory limit 512MB\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eStarting minio server on: http://127.0.0.1:9000\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eStarting minio server on: http://192.168.1.123:9000\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eèµ·å‹•ã™ã‚‹ã¨ Listening Port ã¨å…±ã« EndPoint ã® URL ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæ¬¡ã« mc ã¨ã„ã† minio client ã‚’ä½¿ã£ã¦å‹•ä½œç¢ºèªã—ã¾ã™ã€‚\u003c/p\u003e","title":"ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ minio ã‚’ä½¿ã£ã¦ã¿ã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nVyOS ã« VXLAN ãŒå®Ÿè£…ã•ã‚ŒãŸã¨èã„ã¦å°‘ã—è§¦ã£ã¦ã¿ã¾ã—ãŸã€‚ã“ã®æƒ…å ±ã‚’çŸ¥ã£ãŸãã£ã‹ã‘ ã¯ @upaa ã•ã‚“ã®ä¸‹è¨˜ã®è³‡æ–™ã§ã™ã€‚\nå‚è€ƒè³‡æ–™ : http://www.slideshare.net/upaa/vyos-users-meeting-2-vyosvxlan\nVyOS ã¯å¾¡å­˜çŸ¥ã®é€šã‚Šå®Ÿä½“ã¯ Debian Gnu/Linux ç³»ã® OS ã§ãã®ä¸Šã« OSS ãªãƒŸãƒ‰ãƒ« ã‚¦ã‚§ã‚¢ãŒæ­è¼‰ã•ã‚Œã¦ã„ã¦ CLI ã§ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ãŒè¡Œãˆã‚‹ãƒ¢ ãƒã«ãªã£ã¦ã„ã¾ã™ã€‚Linux ã§ VXLAN ã¨ã„ãˆã° OVS ã‚’ä½¿ã£ãŸãƒ¢ãƒãŒã‚ˆãçŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ ãŒ VyOS ã® VXLAN æ©Ÿèƒ½ã¯ Linux Kernel ã®å®Ÿè£…ã‚’ä½¿ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚\nè¦ä»¶ ãƒˆãƒ³ãƒãƒ«ã‚’å¼µã‚‹ãŸã‚ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’ç”¨æ„ VyOS 1.1.1 (ç¾åœ¨æœ€æ–°ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³) ãŒå¿…è¦ Ubuntu Server 14.04 LTS (åŒã˜ã Linux VXLAN æ­è¼‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³) æ§‹æˆ ç‰¹å¾´\nãƒãƒãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç”¨ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ 10.0.1.0/24 ã‚’ç”¨æ„ GRE ã¨åŒã˜ããƒˆãƒ³ãƒãƒ«çµ‚ç«¯ãŒå¿…è¦ãªã®ã§ãã®ãŸã‚ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ 10.0.2.0/24 ã‚’ç”¨æ„ å„ eth1 ã¯ IP reachable ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§äºˆã‚ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨­å®šã¨ç–é€šã‚’ç¢ºèª VXLAN ã‚’å–‹ã‚Œã‚‹ Ubuntu 14.04 LTS x 1 å°ã¨ VyOS 1.1.1 x 2 å°ã§ç›¸äº’ã«ç–é€šç¢ºèª +-------------+-------------+------------ Management 10.0.1.0/24 |10.0.0.254 |10.0.0.253 |10.0.0.1 |eth0 |eth0 |eth0 +----------+ +----------+ +----------+ | vyos01 | | vyos02 | | ubuntu | +-+--------+ +----------+ +----------+ | |eth1 | |eth1 | |eth1 | |10.0.2.254 | |10.0.2.253 | |10.0.2.1 | +-----------)-+-----------)-+---------- Tunneling 10.0.2.0/24 | | | +-------------+-------------+------------ VXLAN(eth1ã«link) 10.0.1.0/24 10.0.1.254 10.0.1.253 10.0.1.1 è¨­å®šã‚’æŠ•å…¥ vyos01 ã®è¨­å®šã‚’è¡Œã†ã€‚VXLAN ã®è¨­å®šã«å¿…è¦ãªã‚‚ã®ã¯\u0026hellip;\nVNI (VXLAN Network Ideintity)ã¨ã„ã†è­˜åˆ¥å­ Multicast Group Address äº’ã„ã« IP reachable ãªãƒˆãƒ³ãƒãƒ«ã‚’å¼µã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ã§ã™ã€‚ã“ã‚Œã‚‰ã‚’æ„è­˜ã—ã¦ä¸‹è¨˜ã®è¨­å®šã‚’ vyos01 ã«æŠ•å…¥ã—ã¾ã™ã€‚\n$ configure % set interfaces vxlan vxlan0 % set interfaces vxlan vxlan0 group 239.1.1.1 % set interfaces vxlan vxlan0 vni 42 % set interfaces vxlan vxlan0 address \u0026#39;10.0.1.254/24\u0026#39; % set interfaces vxlan vxlan0 link eth1 è¨­å®šã‚’ç¢ºèªã—ã¾ã™\n% exit $ show int ...\u0026lt;çœç•¥\u0026gt;... vxlan vxlan0 { address 10.0.1.254/24 group 239.1.1.1 link eth1 vni 42 } VyOS ã® CLI ã‚’ä»‹ã•ãšç›´ Linux ã®è¨­å®šã‚’ iproute2 ã§ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ VNI, Multicast Group Address ã¨å…±ã« \u0026rsquo;link eth1\u0026rsquo; ã§è¨­å®šã—ãŸãƒˆãƒ³ãƒãƒ«ã‚’çµ‚ç«¯ã™ã‚‹ãŸã‚ã®ç‰©ç† NIC ãŒç¢ºèªã§ãã¾ã™ã€‚\nvyos@vyos01# ip -d link show vxlan0 5: vxlan0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1450 qdisc noqueue state UNKNOWN mode DEFAULT group default link/ether 86:24:26:b2:11:5c brd ff:ff:ff:ff:ff:ff promiscuity 0 vxlan id 42 group 239.1.1.1 dev eth1 port 32768 61000 ttl 16 ageing 300 vyos02 ã®è¨­å®šã‚’åŒæ§˜ã«è¡Œã„ã¾ã™ã€‚\n$ congigure % set interfaces vxlan vxlan0 address \u0026#39;10.0.1.253/24\u0026#39; % set interfaces vxlan vxlan0 vni 42 % set interfaces vxlan vxlan0 group 239.1.1.1 % set interfaces vxlan vxlan0 link eth1 è¨­å®šã®ç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚\n... çœç•¥ ... vxlan vxlan0 { address 10.0.1.254/24 group 239.1.1.1 link eth1 vni 42 } åŒã˜ã Linux ã® iproute2 ã§ç¢ºèªã—ã¾ã™ã€‚\nvyos@vyos01# ip -d link show vxlan0 5: vxlan0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1450 qdisc noqueue state UNKNOWN mode DEFAULT group default link/ether 86:24:26:b2:11:5c brd ff:ff:ff:ff:ff:ff promiscuity 0 vxlan id 42 group 239.1.1.1 dev eth1 port 32768 61000 ttl 16 ageing 300 ubuntu ãƒ›ã‚¹ãƒˆã®è¨­å®šã‚’è¡Œã£ã¦ã„ãã¾ã™ã€‚\nUbuntu Server 14.04 LTS ã§ã‚ã‚Œã°ãƒ‘ãƒƒãƒã‚’å½“ã¦ã‚‹ã“ã¨ç„¡ã Linux Kernel ã® VXLAN æ©Ÿèƒ½ã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚ è¨­å®šå†…å®¹ã¯ VyOS ã¨åŒç­‰ã§ã™ã€‚VyOS ãŒã“ã® Linux ã®å®Ÿè£…ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ãŒã‚ˆãåˆ†ã‹ã‚Šã¾ã™ã€‚\nsudo modprobe vxlan sudo ip link add vxlan0 type vxlan id 42 group 239.1.1.1 dev eth1 sudo ip link set up vxlan0 sudo ip a add 10.0.1.1/24 dev vxlan0 åŒã˜ã Linux iproute2 ã§ç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚\nip -d link show vxlan0 5: vxlan0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1450 qdisc noqueue state UNKNOWN mode DEFAULT group default link/ether d6:ff:c1:27:69:a0 brd ff:ff:ff:ff:ff:ff promiscuity 0 vxlan id 42 group 239.1.1.1 dev eth1 port 32768 61000 ageing 300 ç–é€šç¢ºèª ç–é€šç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚\nubuntu -\u0026gt; vyos01 ã®ç–é€šç¢ºèªã§ã™ã€‚ICMP ã§ç–é€šãŒå–ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚\nthirai@ubuntu:~$ ping 10.0.1.254 -c 3 PING 10.0.1.254 (10.0.1.254) 56(84) bytes of data. 64 bytes from 10.0.1.254: icmp_seq=1 ttl=64 time=0.272 ms 64 bytes from 10.0.1.254: icmp_seq=2 ttl=64 time=0.336 ms 64 bytes from 10.0.1.254: icmp_seq=3 ttl=64 time=0.490 ms --- 10.0.1.254 ping statistics --- 3 packets transmitted, 3 received, 0% packet loss, time 1999ms rtt min/avg/max/mdev = 0.272/0.366/0.490/0.091 ms æ¬¡ã« ubuntu -\u0026gt; vyos02 ã®ç–é€šç¢ºèªã§ã™ã€‚\nthirai@ubuntu:~$ ping 10.0.1.253 -c 3 PING 10.0.1.253 (10.0.1.253) 56(84) bytes of data. 64 bytes from 10.0.1.253: icmp_seq=1 ttl=64 time=0.272 ms 64 bytes from 10.0.1.253: icmp_seq=2 ttl=64 time=0.418 ms 64 bytes from 10.0.1.253: icmp_seq=3 ttl=64 time=0.451 ms --- 10.0.1.253 ping statistics --- 3 packets transmitted, 3 received, 0% packet loss, time 1998ms rtt min/avg/max/mdev = 0.272/0.380/0.451/0.079 ms ã“ã®æ™‚ç‚¹ã§ ubuntu ãƒ›ã‚¹ãƒˆã® fdb (forwarding db) ã®å†…å®¹ã‚’ç¢ºèªã—ã¾ã™ã€‚\n$ bridge fdb show dev vxlan0 00:00:00:00:00:00 dst 239.1.1.1 via eth1 self permanent 4e:69:a4:a7:ef:1c dst 10.0.2.253 self 86:24:26:b2:11:5c dst 10.0.2.254 self vyos01, vyos02 ã®ãƒˆãƒ³ãƒãƒ«çµ‚ç«¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ Mac ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç¢ºèªã§ãã¾ã™ã€‚ubuntu ãƒ›ã‚¹ãƒˆã‹ã‚‰è¦‹ã‚‹ã¨ é€ä¿¡å…ˆã¯ vyos0[12] ã® VXLAN ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã¯ãªãã€ã‚ãã¾ã§ã‚‚ãƒˆãƒ³ãƒãƒ«çµ‚ç«¯ã‚’è¡Œã£ã¦ã„ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ã«ãªã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚\nã¾ã¨ã‚ VyOS ver 1.1.0 ã«ã¯ VXLAN ã‚’ç‰©ç†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã« link ã™ã‚‹æ©Ÿèƒ½ã«ä¸å…·åˆãŒã‚ã‚Šãã†ãªã®ã§ä»Šã‚‰ ver 1.1.1 ã‚’ä½¿ã†ã—ã‹ ãªã•ãã†ã€‚ã¨ã¯è¨€ãˆã€ver 1.1.1 ãªã‚‰æ™®é€šã«å‹•ä½œã—ã¾ã—ãŸã€‚\nVyOS ã¯ä»®æƒ³ãƒ«ãƒ¼ã‚¿ã¨ã„ã†ä½ç½®ä»˜ã‘ãªã®ã§ä»Šå›ç´¹ä»‹ã—ãŸã‚ˆã†ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ VXLAN ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ‰€å±ã•ã›ã‚‹ æ©Ÿèƒ½ãŒã‚ã‚‹ã®ã¿ã§ã™ã€‚VXLAN Trunk ã‚’è¡Œã†ã‚ˆã†ãªè¨­å®šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã¯ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ä¸Šã§å‹•ä½œã•ã›ã‚‹ã“ã¨ã‚’å‰æ ã«è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹ã®ã§ä»•æ–¹ãªã„ã§ã™..ã¨ã„ã†ã‹ã‚¹ã‚¤ãƒƒãƒã§è¡Œã†ã¹ãæ©Ÿèƒ½ã§ã™ã‚ˆã­..ã€‚VM ã‚’æ¥ç¶šã—ã¦äº‘ã€…ã™ã‚‹ã«ã¯ OVS ã®ã‚ˆã†ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¹ã‚¤ãƒƒãƒã‚’ä½¿ãˆã°ã§ãã¾ã™ã€‚\nã¾ãŸ fdb ã¯æ™‚é–“ãŒçµŒã¤ã¨æƒ…å ±ãŒæ¶ˆãˆã¾ã™ã€‚ã“ã‚Œã¯ VXLAN ã®ãƒ¡ãƒƒã‚·ãƒ¥æ§‹é€ ãªãƒˆãƒ³ãƒãƒ«ãŒãã®éƒ½åº¦å¼µã‚‰ã‚Œã¦ã„ã‚‹ã®ã‹ã©ã†ã‹ æ°—ã«ãªã‚‹ã¨ã“ã‚ã§ã™ã€‚ICMP ã®é€ä¿¡ã§ä¸€ç™ºç›®ã®ã¿ãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆã§ãã®å¾Œãƒ¦ãƒ‹ã‚­ãƒ£ã‚¹ãƒˆã«ãªã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸãŒã€ãã® ä¸€ç™ºç›®ã®ãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆã§ãƒˆãƒ³ãƒãƒªãƒ³ã‚°ãŒã•ã‚Œã‚‹ã‚‚ã®ãªã®ã§ã—ã‚‡ã†ã‹\u0026hellip;ã€‚ã‚ã¨ã§èª¿ã¹ã¦ã¿ã¾ã™ã€‚OVS ã®ã‚ˆã†ã« CLI ã§ ãƒˆãƒ³ãƒãƒ«ãŒã©ã®ã‚ˆã†ã«å¼µã‚‰ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹æ‰‹æ®µãŒã‚ã‚Œã°è‰¯ã„ã®ã§ã™ãŒã€‚\nä»¥ä¸Šã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2014/12/16/vyos-vxlan/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eVyOS ã« VXLAN ãŒå®Ÿè£…ã•ã‚ŒãŸã¨èã„ã¦å°‘ã—è§¦ã£ã¦ã¿ã¾ã—ãŸã€‚ã“ã®æƒ…å ±ã‚’çŸ¥ã£ãŸãã£ã‹ã‘\nã¯ @upaa ã•ã‚“ã®ä¸‹è¨˜ã®è³‡æ–™ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå‚è€ƒè³‡æ–™ : \u003ca href=\"http://www.slideshare.net/upaa/vyos-users-meeting-2-vyosvxlan\"\u003ehttp://www.slideshare.net/upaa/vyos-users-meeting-2-vyosvxlan\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eVyOS ã¯å¾¡å­˜çŸ¥ã®é€šã‚Šå®Ÿä½“ã¯ Debian Gnu/Linux ç³»ã® OS ã§ãã®ä¸Šã« OSS ãªãƒŸãƒ‰ãƒ«\nã‚¦ã‚§ã‚¢ãŒæ­è¼‰ã•ã‚Œã¦ã„ã¦ CLI ã§ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ãŒè¡Œãˆã‚‹ãƒ¢\nãƒã«ãªã£ã¦ã„ã¾ã™ã€‚Linux ã§ VXLAN ã¨ã„ãˆã° OVS ã‚’ä½¿ã£ãŸãƒ¢ãƒãŒã‚ˆãçŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™\nãŒ VyOS ã® VXLAN æ©Ÿèƒ½ã¯ Linux Kernel ã®å®Ÿè£…ã‚’ä½¿ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"è¦ä»¶\"\u003eè¦ä»¶\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eãƒˆãƒ³ãƒãƒ«ã‚’å¼µã‚‹ãŸã‚ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’ç”¨æ„\u003c/li\u003e\n\u003cli\u003eVyOS 1.1.1 (ç¾åœ¨æœ€æ–°ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³) ãŒå¿…è¦\u003c/li\u003e\n\u003cli\u003eUbuntu Server 14.04 LTS (åŒã˜ã Linux VXLAN æ­è¼‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eç‰¹å¾´\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eãƒãƒãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç”¨ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ 10.0.1.0/24 ã‚’ç”¨æ„\u003c/li\u003e\n\u003cli\u003eGRE ã¨åŒã˜ããƒˆãƒ³ãƒãƒ«çµ‚ç«¯ãŒå¿…è¦ãªã®ã§ãã®ãŸã‚ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ 10.0.2.0/24 ã‚’ç”¨æ„\u003c/li\u003e\n\u003cli\u003eå„ eth1 ã¯ IP reachable ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§äºˆã‚ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨­å®šã¨ç–é€šã‚’ç¢ºèª\u003c/li\u003e\n\u003cli\u003eVXLAN ã‚’å–‹ã‚Œã‚‹ Ubuntu 14.04 LTS x 1 å°ã¨ VyOS 1.1.1 x 2 å°ã§ç›¸äº’ã«ç–é€šç¢ºèª\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+-------------+-------------+------------ Management 10.0.1.0/24\n|10.0.0.254   |10.0.0.253   |10.0.0.1\n|eth0         |eth0         |eth0\n+----------+  +----------+  +----------+ \n|  vyos01  |  |  vyos02  |  |  ubuntu  |\n+-+--------+  +----------+  +----------+ \n| |eth1       | |eth1       | |eth1\n| |10.0.2.254 | |10.0.2.253 | |10.0.2.1\n| +-----------)-+-----------)-+---------- Tunneling 10.0.2.0/24\n|             |             |\n+-------------+-------------+------------ VXLAN(eth1ã«link) 10.0.1.0/24\n10.0.1.254     10.0.1.253    10.0.1.1\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"è¨­å®šã‚’æŠ•å…¥\"\u003eè¨­å®šã‚’æŠ•å…¥\u003c/h2\u003e\n\u003cp\u003evyos01 ã®è¨­å®šã‚’è¡Œã†ã€‚VXLAN ã®è¨­å®šã«å¿…è¦ãªã‚‚ã®ã¯\u0026hellip;\u003c/p\u003e","title":"VyOS ã§ VXLAN ã‚’ä½¿ã£ã¦ã¿ã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nè‡ªåˆ†ã¯ Ruby ã‚’æ™®æ®µä½¿ã†ã®ã§ã„ã¤ã‚‚ Fog ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦ OpenStack, AWS ã‚’æ“ä½œã—ã¦ã„ã¾ã—ãŸã€‚Fog ã‚’ä½¿ã†ã¨ã‚¯ãƒ©ã‚¦ãƒ‰ã®æ“ä½œãŒ Ruby ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã§è¡Œãˆ ã‚‹ã®ã§ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒãƒ³ãƒ‰æ‰“ã¤ã‚ˆã‚ŠãƒŸã‚¹ç„¡ãæ¸ˆã¿ã¾ã™ã€‚\nFog ã‚ˆã‚Šå¾Œç™ºã§ Aviator ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒç™»å ´ã—ã¦ããŸã®ã§å°‘ã—ä½¿ã£ã¦ã¿ãŸã®ã§ã™ ãŒã¾ã æœªå®Œæˆãªã¨ã“ã‚ãŒã‚ã‚‹ã‚‚ã®ã®ä¾¿åˆ©ãªç‚¹ã‚‚ã‚ã£ã¦ä»Šå¾Œã«æœŸå¾…ã ã£ãŸã®ã§ç´¹ä»‹ã—ã¾ã™ã€‚\nèªè¨¼æƒ…å ±ã‚’ yaml ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜ã™ æ¥ç¶šã«å¿…è¦ãªèªè¨¼æƒ…å ±ã‚’ yaml ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨˜è¿°ã—ã¾ã™ã€‚åå‰ã‚’ \u0026lsquo;aviator.yml\u0026rsquo; ã¨ã—ã¦ ä¿å­˜ã€‚ã“ã®æ™‚ã«ä¸‹è¨˜ã®ã‚ˆã†ã«ç’°å¢ƒæ¯ã«èªè¨¼æƒ…å ±ã‚’åˆ¥ã‘ã¦æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã†ã™ã‚‹ ã“ã¨ã§ã‚³ãƒ¼ãƒ‰ã®ä¸­ã§é–‹ç™ºç”¨ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ç”¨ç­‰ã¨ä½¿ã„åˆ†ã‘ã‚‰ã‚Œã¾ã™ã€‚\nproduction: provider: openstack auth_service: name: identity host_uri: \u0026lt;Auth URL\u0026gt; request: create_token validator: list_tenants auth_credentials: username: \u0026lt;User Name\u0026gt; password: \u0026lt;Password\u0026gt; tenant_name: \u0026lt;Tenant Name\u0026gt; development: provider: openstack auth_service: name: identity host_uri: \u0026lt;Auth URL\u0026gt; request: create_token validator: list_tenants auth_credentials: username: \u0026lt;User Name\u0026gt; password: \u0026lt;Password\u0026gt; tenant_name: \u0026lt;Tenant Name\u0026gt; ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ç¢ºèª +++\næ¬¡ã« aviator ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’ç¢ºèªã—ã¾ã™ã€‚Fog ã«ç„¡ã„æ©Ÿèƒ½ã§ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã‚· ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’ç¢ºèªã§ãã¦ã—ã‹ã‚‚æŒ‡å®šå¯èƒ½ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨å¿…é ˆãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨å…±ã«ã‚µãƒ³ãƒ— ãƒ«ã‚³ãƒ¼ãƒ‰ã¾ã§æä¾›ã—ã¦ãã‚Œã¾ã™ã€‚å…¬å¼ã‚µã‚¤ãƒˆã«\u0026rsquo;ã‚µãƒ¼ãƒä½œæˆ\u0026rsquo;ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒæ²è¼‰ã•ã‚Œã¦ã„ ã‚‹ã®ã§ã€ã“ã“ã§ã¯ä»®æƒ³ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ä½œã‚‹ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚\n% gem install aviator % aviator describe openstack volume # \u0026lt;-- åˆ©ç”¨å¯èƒ½ãªæ©Ÿèƒ½ã‚’ç¢ºèª Available requests for openstack volume_service: v1 public list_volume_types v1 public list_volumes v1 public delete_volume v1 public create_volume v1 public get_volume v1 public update_volume v1 public root % aviator describe openstack volume v1 public create_volume # \u0026lt;-- ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’ç¢ºèª :Request =\u0026gt; create_volume Parameters: +---------------------+-----------+ | NAME | REQUIRED? | +---------------------+-----------+ | availability_zone | N | | display_description | Y | | display_name | Y | | metadata | N | | size | Y | | snapshot_id | N | | volume_type | N | +---------------------+-----------+ Sample Code: session.volume_service.request(:create_volume) do |params| params.volume_type = value params.availability_zone = value params.snapshot_id = value params.metadata = value params.display_name = value params.display_description = value params.size = value end ã“ã®ã‚ˆã†ã« create_volume ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã¦ã€æŒ‡å®šå‡ºæ¥ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ» å¿…é ˆãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒç¢ºèªã§ãã¾ã™ã€‚å¿…é ˆãªãƒ¢ãƒã«ã¯ \u0026ldquo;Y\u0026rdquo; ãŒ REQUIRED ã«ä»˜ã„ã¦ã„ã¾ã™ã€‚ ã¾ãŸã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã®ã§ã€ã‚ã¡ã‚ƒä¾¿åˆ©ã§ã™ã€‚\nã§ã¯ create_volume ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãŒã‚ã‹ã£ãŸã®ã§ã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã‚‹ +++\n#!/usr/bin/env ruby require \u0026#39;aviator\u0026#39; require \u0026#39;json\u0026#39; volume_session = Aviator::Session.new( :config_file =\u0026gt; \u0026#39;/home/thirai/aviator/aviator.yml\u0026#39;, :environment =\u0026gt; :production, :log_file =\u0026gt; \u0026#39;/home/thirai/aviator/aviator.log\u0026#39; ) volume_session.authenticate volume_session.volume_service.request(:create_volume) do |params| params.display_description = \u0026#39;testvol\u0026#39; params.display_name = \u0026#39;testvol01\u0026#39; params.size = 1 end puts volume_session.volume_service.request(:list_volumes).body 6è¡Œç›®ã§å…ˆã»ã©ä½œæˆã—ãŸèªè¨¼æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ« aviator.yml ã¨ãƒ­ã‚°å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ« aviator.log ã‚’æŒ‡å®šã—ã¾ã™ã€‚12è¡Œç›®ã§å®Ÿéš›ã« OpenStack ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã™ã€‚\n14-18è¡Œç›®ã¯ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ã§ã™ã€‚å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã® display_description, display_name, size ã®ã¿ã‚’æŒ‡å®šã—ä»®æƒ³ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ä½œæˆã—ã¾ã—ãŸã€‚æœ€å¾Œã® puts \u0026hellip; ã¯ å®Ÿéš›ã«ä½œæˆã—ãŸä»®æƒ³ãƒ‡ã‚£ã‚¹ã‚¯ä¸€è¦§ã‚’å‡ºåŠ›ã—ã¦ã„ã¾ã™ã€‚\nçµæœã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚\n{ volumes: [{ status: \u0026#39;available\u0026#39;, display_name: \u0026#39;testvol01\u0026#39;, attachments: [], availability_zone: \u0026#39;az3\u0026#39;, bootable: \u0026#39;false\u0026#39;, created_at: description = \u0026#39;testvol\u0026#39;, volume_type: \u0026#39;standard\u0026#39;, snapshot_id: nil, source_volid: nil, metadata: }, id: \u0026#39;3a5f616e-a732-4442-a419-10369111bd4c\u0026#39;, size: 1 }] } ã¾ã¨ã‚ +++\nã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸€è¦§ç­‰ãŒã²ã¨ç›®ã§ã‚ã‹ã‚‹ aviator ã¯ã¨ã¦ã‚‚ä¾¿åˆ©ã§ã™ã€‚ã¾ ã åˆ©ç”¨ã§ãã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãŒ OpenStack ã—ã‹ãªã„ã®ã¨ã€Neutron ã®æ©Ÿèƒ½ ãŒã‚¹ãƒƒãƒãƒªæŠœã‘ã¦ã„ã‚‹ã®ã§ã€ã¾ã åˆ©ç”¨ã™ã‚‹ã«ã¯æ—©ã„ã‹ã‚‚ã§ã™\u0026hellip;ã€‚é€†ã«è¨€ãˆã°ã‚³ãƒ³ãƒˆãƒª ãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ãƒãƒ£ãƒ³ã‚¹ãªã®ã§ã€ã‚‚ã—æ°—ã«ãªã£ãŸæ–¹ãŒã„ãŸã‚‰é–‹ç™ºã«å‚åŠ ã—ã¦ã¿ã‚‹ã®ã‚‚ ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\n","permalink":"https://jedipunkz.github.io/post/2014/12/13/aviator-openstack/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eè‡ªåˆ†ã¯ Ruby ã‚’æ™®æ®µä½¿ã†ã®ã§ã„ã¤ã‚‚ Fog ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦ OpenStack, AWS\nã‚’æ“ä½œã—ã¦ã„ã¾ã—ãŸã€‚Fog ã‚’ä½¿ã†ã¨ã‚¯ãƒ©ã‚¦ãƒ‰ã®æ“ä½œãŒ Ruby ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã§è¡Œãˆ\nã‚‹ã®ã§ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒãƒ³ãƒ‰æ‰“ã¤ã‚ˆã‚ŠãƒŸã‚¹ç„¡ãæ¸ˆã¿ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eFog ã‚ˆã‚Šå¾Œç™ºã§ Aviator ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒç™»å ´ã—ã¦ããŸã®ã§å°‘ã—ä½¿ã£ã¦ã¿ãŸã®ã§ã™\nãŒã¾ã æœªå®Œæˆãªã¨ã“ã‚ãŒã‚ã‚‹ã‚‚ã®ã®ä¾¿åˆ©ãªç‚¹ã‚‚ã‚ã£ã¦ä»Šå¾Œã«æœŸå¾…ã ã£ãŸã®ã§ç´¹ä»‹ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"èªè¨¼æƒ…å ±ã‚’-yaml-ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜ã™\"\u003eèªè¨¼æƒ…å ±ã‚’ yaml ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜ã™\u003c/h2\u003e\n\u003cp\u003eæ¥ç¶šã«å¿…è¦ãªèªè¨¼æƒ…å ±ã‚’ yaml ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨˜è¿°ã—ã¾ã™ã€‚åå‰ã‚’ \u0026lsquo;aviator.yml\u0026rsquo; ã¨ã—ã¦\nä¿å­˜ã€‚ã“ã®æ™‚ã«ä¸‹è¨˜ã®ã‚ˆã†ã«ç’°å¢ƒæ¯ã«èªè¨¼æƒ…å ±ã‚’åˆ¥ã‘ã¦æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã†ã™ã‚‹\nã“ã¨ã§ã‚³ãƒ¼ãƒ‰ã®ä¸­ã§é–‹ç™ºç”¨ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ç”¨ç­‰ã¨ä½¿ã„åˆ†ã‘ã‚‰ã‚Œã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eproduction\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eprovider\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eopenstack\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eauth_service\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ename\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eidentity\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ehost_uri\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;Auth URL\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erequest\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ecreate_token\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evalidator\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003elist_tenants\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eauth_credentials\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eusername\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;User Name\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003epassword\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;Password\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003etenant_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;Tenant Name\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003edevelopment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eprovider\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eopenstack\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eauth_service\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ename\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eidentity\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ehost_uri\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;Auth URL\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erequest\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ecreate_token\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evalidator\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003elist_tenants\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eauth_credentials\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eusername\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;User Name\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003epassword\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;Password\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003etenant_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;Tenant Name\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ç¢ºèª\n+++\u003c/p\u003e\n\u003cp\u003eæ¬¡ã« aviator ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’ç¢ºèªã—ã¾ã™ã€‚Fog ã«ç„¡ã„æ©Ÿèƒ½ã§ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã‚·\nãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’ç¢ºèªã§ãã¦ã—ã‹ã‚‚æŒ‡å®šå¯èƒ½ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨å¿…é ˆãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨å…±ã«ã‚µãƒ³ãƒ—\nãƒ«ã‚³ãƒ¼ãƒ‰ã¾ã§æä¾›ã—ã¦ãã‚Œã¾ã™ã€‚å…¬å¼ã‚µã‚¤ãƒˆã«\u0026rsquo;ã‚µãƒ¼ãƒä½œæˆ\u0026rsquo;ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒæ²è¼‰ã•ã‚Œã¦ã„\nã‚‹ã®ã§ã€ã“ã“ã§ã¯ä»®æƒ³ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ä½œã‚‹ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% gem install aviator\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% aviator describe openstack volume \u003cspan style=\"color:#75715e\"\u003e# \u0026lt;-- åˆ©ç”¨å¯èƒ½ãªæ©Ÿèƒ½ã‚’ç¢ºèª\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAvailable requests \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e openstack volume_service:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ev1 public list_volume_types\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ev1 public list_volumes\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ev1 public delete_volume\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ev1 public create_volume\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ev1 public get_volume\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ev1 public update_volume\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  v1 public root\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% aviator describe openstack volume v1 public create_volume \u003cspan style=\"color:#75715e\"\u003e# \u0026lt;-- ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’ç¢ºèª\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e:Request \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u0026gt; create_volume\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eParameters:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e +---------------------+-----------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e | NAME                | REQUIRED? |\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e +---------------------+-----------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e | availability_zone   |     N     |\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e | display_description |     Y     |\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e | display_name        |     Y     |\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e | metadata            |     N     |\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e | size                |     Y     |\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e | snapshot_id         |     N     |\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e | volume_type         |     N     |\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e +---------------------+-----------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSample Code:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  session.volume_service.request\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e:create_volume\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e |params|\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    params.volume_type \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e value\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    params.availability_zone \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e value\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    params.snapshot_id \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e value\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    params.metadata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e value\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    params.display_name \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e value\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    params.display_description \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e value\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    params.size \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e value\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  end\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eã“ã®ã‚ˆã†ã« create_volume ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã¦ã€æŒ‡å®šå‡ºæ¥ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ»\nå¿…é ˆãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒç¢ºèªã§ãã¾ã™ã€‚å¿…é ˆãªãƒ¢ãƒã«ã¯ \u0026ldquo;Y\u0026rdquo; ãŒ REQUIRED ã«ä»˜ã„ã¦ã„ã¾ã™ã€‚\nã¾ãŸã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã®ã§ã€ã‚ã¡ã‚ƒä¾¿åˆ©ã§ã™ã€‚\u003c/p\u003e","title":"Aviator ã§ãƒ¢ãƒ€ãƒ³ã« OpenStack ã‚’æ“ä½œã™ã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nOpenStack Juno ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸãŒã€ä»Šæ—¥ã¯ Icehouse ãƒã‚¿ã§ã™ã€‚\nicehouse ä»¥é™ã€è‡ªåˆ†ã®ä¸­ã§ OpenStack ã‚’è‡ªå‹•ã§ä½œã‚‹ä»•çµ„ã¿ãŒç„¡ããªã‚Šã¤ã¤ã‚ã‚Šã€æ°—è»½ ã« OpenStack ã‚’ä½œã£ã¦è‰²ã€…è©¦ã—ãŸã„ï¼ãƒƒã¦ã„ã†æ™‚ã«æ‰‹æ®µãŒç„¡ãå›°ã£ã¦ã„ã¾ã—ãŸã€‚ä¾‹ãˆ ã°ä»•äº‹ã§ã¡ã‚‡ã£ã¨ OpenStack å¼„ã‚ŠãŸã„ï¼ã£ã¦æ™‚ã« DevStack, RDO ã—ã‹ãªãã€‚DevStack ã¯å¾¡å­˜çŸ¥ã®é€šã‚Šå‹•ã‹ãªã„å¯èƒ½æ€§ãŒçµæ§‹ã‚ã‚‹ã— RDO ã¯ Ubuntu/Debian Gnu Linux ãƒ™ãƒ¼ã‚¹ ã˜ã‚ƒãªã„ã—ã€‚\nã£ã¦ã“ã¨ã§ã€ä»¥å‰ã«ã‚‚ç´¹ä»‹ã—ãŸ stackforge ç®¡ç†ã® openstack-chef-repo ã¨ Chef-Zero ã‚’ä½¿ã£ã¦ OpenStack Icehouse (Neutron) ã®ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã‚’ä½œã‚‹æ–¹æ³• ã‚’æ›¸ãã¾ã™ã€‚ã¡ãªã¿ã«æœ€è¿‘ Chef-Solo ãŒ Chef-Zero ã«ç½®ãæ›ã‚ã‚Šã¤ã¤ã‚ã‚‹ã‚‰ã—ã„ã§ã™ã€‚ Chef-Zero ã¯ã‚ªãƒ³ãƒ¡ãƒ¢ãƒªã§ Chef ã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚Chef-Solo ã¨é•ã£ã¦ Chef ã‚µãƒ¼ãƒã‚’æ‰±ã†æ™‚ã¨ä½•ã‚‚å¤‰æ›´ç„¡ãæ“ä½œãŒå‡ºæ¥ã‚‹ã®ã§ã¨ã¦ã‚‚æ¥½ã§ã™ã€‚ã¾ãŸã€Chef ã‚µãƒ¼ãƒã‚’ åˆ¥é€”æ§‹ã€æ§‹ç¯‰ãƒ»ç®¡ç†ã—ãªãã¦è‰¯ã„ã®ã§ã€æ°—è»½ã« OpenStack ãŒä½œã‚Œã¾ã™ã€‚\nã¡ãªã¿ã« stackforge/openstack-chef-repo ã® README.md ã« Chef-Zero ã§ã®æ§‹ç¯‰æ–¹æ³• ãŒæ›¸ã„ã¦ã‚ã‚Šã¾ã™ãŒã€æ²¢å±±ã®å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚\nnova-network æ§‹æˆ API ã® Endpoint ãŒå…¨ã¦ localhost ã«å‘ã„ã¦ã—ã¾ã†ãŸã‚å¤–éƒ¨ã‹ã‚‰æ“ä½œä¸å¯èƒ½ å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® bind_address ãŒ localhost ã‚’å‘ã„ã¦ã—ã¾ã† berkshelf ãŒãã®ã¾ã¾ã§ã¯å…¥ã‚‰ãªã„ ã‚ˆã£ã¦ã€ä»Šå›ã¯ã“ã‚Œã‚‰ã®å•é¡Œã‚’è§£æ±ºã—ã¤ã¤ \u0026ldquo;ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ãª Neutron æ§‹æˆã® Icehouse OpenStack ã‚’ä½œã‚‹æ–¹æ³•\u0026rdquo; ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚\næ§‹æˆ +----------------- 10.0.0.0/24 (api/management network) | +----------------+ | OpenStack Node | | Controller | | Compute | +----------------+ | | +--(-------------- 10.0.1.0/24 (external network) | +-------------- 10.0.2.0/24 (guest vm network) IP address é”\n10.0.0.10 (api/manageent network) : eth0 10.0.1.10 (external network) : eth1 10.0.2.10 (guest vm network) : eth2 æ³¨æ„ : æ“ä½œã¯å…¨ã¦ eth0 çµŒç”±ã§è¡Œã†\nå‰æã®ç’°å¢ƒ stackforge/openstack-chef-repo ã®ä¾å­˜ã—ã¦ã„ã‚‹ Cookbooks ã®é–¢ä¿‚ä¸Šã€upstart å‘¨ã‚Š ãŒã†ã¾ãåˆ¶å¾¡ã§ãã¦ã„ãªã„ã®ã§ Ubuntu Server 12.04.x ã‚’ä½¿ã„ã¾ã™ã€‚\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³• ä¸Šè¨˜ã®ã‚ˆã†ã«3ã¤ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒä»˜ã„ãŸã‚µãƒ¼ãƒã‚’1å°ç”¨æ„ã—ã¾ã™ã€‚ KVM ãŒåˆ©ç”¨å‡ºæ¥ãŸã»ã†ãŒã„ã„ã§ã™ãŒä½¿ãˆãªã„ãã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚KVM ãƒªã‚½ãƒ¼ã‚¹ãŒä½¿ãˆãª ã„å ´åˆã®ä¿®æ­£æ–¹æ³•ã‚’å¾Œã«è¨˜ã—ã¾ã™ã€‚\nã‚µãƒ¼ãƒã«ãƒ­ã‚°ã‚¤ãƒ³ã— root ãƒ¦ãƒ¼ã‚¶ã«ãªã‚Šã¾ã™ã€‚ãã®å¾Œ Chef ã‚’ã‚ªãƒ ãƒ‹ãƒã‚¹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ© ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% sudo -i # curl -L https://www.opscode.com/chef/install.sh | bash æ¬¡ã« stable/icehose ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã—ã¦ openstack-chef-repo ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚\n# cd ~ # git clone -b stable/icehouse https://github.com/stackforge/openstack-chef-repo # berkshelf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã®ã§ã™ãŒä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¶³ã‚‰ãªã„ã®ã§ã“ã“ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ ãƒ«ã—ã¾ã™ã€‚\n# apt-get -y install build-essential zlib1g-dev libssl-dev libreadline-dev \\ ruby-dev libxml2-dev libxslt-dev g++ berkshelf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n# /opt/chef/embedded/bin/gem install berkshelf --no-ri --no-rdoc æ¬¡ã« openstack-chef-repo ã«ä¾å­˜ã™ã‚‹ Cookbooks ã‚’å–å¾—ã—ã¾ã™ã€‚\n# cd ~/openstack-chef-repo # /opt/chef/embedded/bin/berks vendor ./cookbooks ~/openstack-chef-repo/environments ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã« neutron-allinone.json ã¨ ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã§ä½œæˆã—ã¾ã™ã€‚å†…å®¹ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚\n{ [0/215] \u0026#34;name\u0026#34;: \u0026#34;neutron-allinone\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;test\u0026#34;, \u0026#34;cookbook_versions\u0026#34;: { }, \u0026#34;json_class\u0026#34;: \u0026#34;Chef::Environment\u0026#34;, \u0026#34;chef_type\u0026#34;: \u0026#34;environment\u0026#34;, \u0026#34;default_attributes\u0026#34;: { }, \u0026#34;override_attributes\u0026#34;: { \u0026#34;mysql\u0026#34;: { \u0026#34;bind_address\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;server_root_password\u0026#34;: \u0026#34;root\u0026#34;, \u0026#34;server_debian_password\u0026#34;: \u0026#34;root\u0026#34;, \u0026#34;server_repl_password\u0026#34;: \u0026#34;root\u0026#34;, \u0026#34;allow_remote_root\u0026#34;: true, \u0026#34;root_network_acl\u0026#34;: [\u0026#34;10.0.0.0/8\u0026#34;] }, \u0026#34;rabbitmq\u0026#34;: { \u0026#34;address\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5672\u0026#34; }, \u0026#34;openstack\u0026#34;: { \u0026#34;auth\u0026#34;: { \u0026#34;validate_certs\u0026#34;: false }, \u0026#34;dashboard\u0026#34;: { \u0026#34;session_backend\u0026#34;: \u0026#34;file\u0026#34; }, \u0026#34;block-storage\u0026#34;: { \u0026#34;syslog\u0026#34;: { \u0026#34;use\u0026#34;: false }, \u0026#34;api\u0026#34;: { \u0026#34;ratelimit\u0026#34;: \u0026#34;False\u0026#34; }, \u0026#34;debug\u0026#34;: true, \u0026#34;image_api_chef_role\u0026#34;: \u0026#34;os-image\u0026#34;, \u0026#34;identity_service_chef_role\u0026#34;: \u0026#34;os-identity\u0026#34;, \u0026#34;rabbit_server_chef_role\u0026#34;: \u0026#34;os-ops-messaging\u0026#34; }, \u0026#34;compute\u0026#34;: { \u0026#34;rabbit\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;novnc_proxy\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth0\u0026#34; }, \u0026#34;libvirt\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth0\u0026#34;, }, \u0026#34;novnc_proxy\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth0\u0026#34; }, \u0026#34;xvpvnc_proxy\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth0\u0026#34; }, \u0026#34;image_api_chef_role\u0026#34;: \u0026#34;os-image\u0026#34;, \u0026#34;identity_service_chef_role\u0026#34;: \u0026#34;os-identity\u0026#34;, \u0026#34;nova_setup_chef_role\u0026#34;: \u0026#34;os-compute-api\u0026#34;, \u0026#34;rabbit_server_chef_role\u0026#34;: \u0026#34;os-ops-messaging\u0026#34;, \u0026#34;network\u0026#34;: { \u0026#34;public_interface\u0026#34;: \u0026#34;eth0\u0026#34;, \u0026#34;service_type\u0026#34;: \u0026#34;neutron\u0026#34; } }, \u0026#34;network\u0026#34;: { \u0026#34;debug\u0026#34;: \u0026#34;True\u0026#34;, \u0026#34;dhcp\u0026#34;: { \u0026#34;enable_isolated_metadata\u0026#34;: \u0026#34;True\u0026#34; }, \u0026#34;metadata\u0026#34;: { \u0026#34;nova_metadata_ip\u0026#34;: \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;openvswitch\u0026#34;: { \u0026#34;tunnel_id_ranges\u0026#34;: \u0026#34;1:1000\u0026#34;, \u0026#34;enable_tunneling\u0026#34;: \u0026#34;True\u0026#34;, \u0026#34;tenant_network_type\u0026#34;: \u0026#34;gre\u0026#34;, \u0026#34;local_ip_interface\u0026#34;: \u0026#34;eth2\u0026#34; }, \u0026#34;api\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth0\u0026#34; }, \u0026#34;l3\u0026#34;: { \u0026#34;external_network_bridge_interface\u0026#34;: \u0026#34;eth1\u0026#34; }, \u0026#34;service_plugins\u0026#34;: [\u0026#34;neutron.services.l3_router.l3_router_plugin.L3RouterPlugin\u0026#34;] }, \u0026#34;db\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth0\u0026#34;, \u0026#34;compute\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;identity\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;image\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;network\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;volume\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;dashboard\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;telemetry\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;orchestration\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34; } }, \u0026#34;developer_mode\u0026#34;: true, \u0026#34;endpoints\u0026#34;: { \u0026#34;compute-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8774\u0026#34; }, \u0026#34;compute-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8774\u0026#34; }, \u0026#34;compute-ec2-admin-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8773\u0026#34; }, \u0026#34;compute-ec2-admin\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8773\u0026#34; }, \u0026#34;compute-ec2-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8773\u0026#34; }, \u0026#34;compute-ec2-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8773\u0026#34; }, \u0026#34;compute-xvpvnc\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;6081\u0026#34; }, \u0026#34;compute-novnc-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;6080\u0026#34; }, \u0026#34;compute-novnc\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;6080\u0026#34; }, \u0026#34;compute-vnc\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;6080\u0026#34; }, \u0026#34;image-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9292\u0026#34; }, \u0026#34;image-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9292\u0026#34; }, \u0026#34;image-registry\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9191\u0026#34; }, \u0026#34;image-registry-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9191\u0026#34; }, \u0026#34;identity-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5000\u0026#34; }, \u0026#34;identity-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5000\u0026#34; }, \u0026#34;identity-admin\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;35357\u0026#34; }, \u0026#34;volume-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8776\u0026#34; }, \u0026#34;volume-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8776\u0026#34; }, \u0026#34;telemetry-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8777\u0026#34; }, \u0026#34;network-api-bind\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9696\u0026#34; }, \u0026#34;network-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;9696\u0026#34; }, \u0026#34;orchestration-api\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8004\u0026#34; }, \u0026#34;orchestration-api-cfn\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8000\u0026#34; } }, \u0026#34;identity\u0026#34;: { \u0026#34;admin_user\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;bind_interface\u0026#34;: \u0026#34;eth0\u0026#34;, \u0026#34;debug\u0026#34;: true }, \u0026#34;image\u0026#34;: { \u0026#34;api\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth0\u0026#34; }, \u0026#34;debug\u0026#34;: true, \u0026#34;identity_service_chef_role\u0026#34;: \u0026#34;os-identity\u0026#34;, \u0026#34;rabbit_server_chef_role\u0026#34;: \u0026#34;os-ops-messaging\u0026#34;, \u0026#34;registry\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth0\u0026#34; }, \u0026#34;syslog\u0026#34;: { \u0026#34;use\u0026#34;: false }, \u0026#34;upload_images\u0026#34;: [ \u0026#34;precise\u0026#34; ] }, \u0026#34;mq\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth0\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;user\u0026#34;: \u0026#34;guest\u0026#34;, \u0026#34;vhost\u0026#34;: \u0026#34;/nova\u0026#34;, \u0026#34;network\u0026#34;: { \u0026#34;rabbit\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5672\u0026#34; } }, \u0026#34;compute\u0026#34;: { \u0026#34;service_type\u0026#34;: \u0026#34;rabbitmq\u0026#34;, \u0026#34;rabbit\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5672\u0026#34; } }, \u0026#34;block-storage\u0026#34;: { \u0026#34;service_type\u0026#34;: \u0026#34;rabbitmq\u0026#34;, \u0026#34;rabbit\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5672\u0026#34; } } } }, \u0026#34;queue\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;10.0.1.10\u0026#34;, \u0026#34;user\u0026#34;: \u0026#34;guest\u0026#34;, \u0026#34;vhost\u0026#34;: \u0026#34;/nova\u0026#34; } } } å†…å®¹ã«ã¤ã„ã¦å…¨ã¦èª¬æ˜ã™ã‚‹ã®ã¯é›£ã—ã„ã§ã™ãŒã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã®ãŒä»Šå›ä¸€ç•ªè‹¦ åŠ´ã—ãŸç‚¹ã§ã™ã€‚ã¨è¨€ã†ã®ã¯ã€æ§‹æˆã‚’ä½œã‚Šã¤ã¤ãã‚Œãã‚Œã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒã‚¤ãƒ³ãƒ‰ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒªã‚¹ãƒ³ãƒãƒ¼ãƒˆç­‰ãªã©ã€å…¨ ã¦ãŒæ­£å¸¸ãªå€¤ã«ãªã‚‹ã‚ˆã†ã« Cookbooks ã‚’èª­ã¿ã¤ã¤ä½œæ¥­ã™ã‚‹ã‹ã‚‰ã§ã™ã€‚ã“ã® json ãƒ•ã‚¡ ã‚¤ãƒ«ãŒå®Œæˆã—ã¦ã—ã¾ãˆã°ã€ã‚ã¨ã¯ç°¡å˜ãªã®ã§ã™ãŒã€‚\nå‰è¿°ã—ã¾ã—ãŸãŒ KVM ãƒªã‚½ãƒ¼ã‚¹ãŒä½¿ãˆãªã„ç’°å¢ƒã®å ´åˆ Qemu ã§ä»®æƒ³ãƒã‚·ãƒ³ã‚’ç¨¼åƒã™ã‚‹ã“ ã¨ãŒã§ãã¾ã™ã€‚ãã®å ´åˆã€ä¸‹è¨˜ã®ã‚ˆã†ã« \u0026ldquo;libvirt\u0026rdquo; ã®é …ç›®ã« \u0026ldquo;virt_type\u0026rdquo; ã‚’è¿½è¨˜ã—ã¦ ãã ã•ã„ã€‚\n\u0026#34;libvirt\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth0\u0026#34;, \u0026#34;virt_type\u0026#34;: \u0026#34;qemu\u0026#34; # \u0026lt;------ è¿½è¨˜ }, ãã‚Œã§ã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ãã¾ã™ã€‚\nã“ã“ã§ \u0026lsquo;allinone\u0026rsquo; ã¯ãƒ›ã‚¹ãƒˆåã€\u0026lsquo;allinone-compute\u0026rsquo; ã¯ Role åã€neutron-allinone ã¯å…ˆã»ã©ä½œæˆã—ãŸ json ã§æŒ‡å®šã—ã¦ã„ã‚‹ environment åã§ã™ã€‚\n# chef-client -z # knife node -z run_list add allinone \u0026#39;role[allinone-compute]\u0026#39; # chef-client -z -E neutron-allinone ç’°å¢ƒã«ã‚‚ã‚ˆã‚Šã¾ã™ãŒã€æ•°åˆ†ã§ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ãª OpenStack Icehouse ãŒå®Œæˆã—ã¾ã™ã€‚\nã¾ã¨ã‚ +++\nChef ã‚µãƒ¼ãƒã‚’ä½¿ã‚ãªãã¦è‰¯ã„ã®ã§ãŠæ‰‹è»½ã« OpenStack ãŒæ§‹ç¯‰å‡ºæ¥ã¾ã—ãŸã€‚ã“ã® json ãƒ•ã‚¡ã‚¤ãƒ«ã¯å®Ÿã¯ä»–ã«ã‚‚å¿œç”¨å‡ºæ¥ã‚‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚è¤‡æ•°å°æ§‹æˆã® OpenStack ã‚‚æŒ‡å®š Role ã‚’å·¥å¤«ã™ã‚Œã°æ§‹ç¯‰å‡ºæ¥ã‚‹ã§ã—ã‚‡ã†ã€‚ãŒã€ãã®å ´åˆã¯ chef-zero ã¯ä½¿ãˆã¾ã›ã‚“ã€‚ Chef ã‚µãƒ¼ãƒæ§‹æˆã«ã™ã‚‹å¿…è¦ãŒå‡ºã¦ãã¾ã™ã€‚\nã¡ãªã¿ã« OpenStack Paris Summit 2014 ã§ã€ŒOpenStack ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ä½•ã‚’ä½¿ã£ã¦ã„ã‚‹ ã‹ï¼Ÿã€ã¨ã„ã†èª¿æŸ»çµæœãŒä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚Chef ãŒ2ä½ã§ã™ãŒ Pueppet ã«å¤§ããé›¢ã•ã‚Œ ã¦ã„ã‚‹æ„ŸãŒã‚ã‚Šã¾ã™ã€‚Juno ç‰ˆã® openstack-chef-repo ã‚‚é–‹ç™ºãŒé€²ã‚“ã§ã„ã¾ã™ã®ã§ã€é ‘ å¼µã£ã¦åºƒã‚ã¦ã„ããŸã„ã§ã™ã€‚\n1ä½ Puppet 2ä½ Chef 3ä½ Ansible 4ä½ DevStack 5ä½ PackStack 6ä½ Salt 7ä½ Juju 8ä½ Crowbar 9ä½ CFEngine å‚è€ƒ URL : http://superuser.openstack.org/articles/openstack-user-survey-insights-november-2014\nã¡ãªã¿ã«ã€Puppet ã‚’ä½¿ã£ãŸ OpenStack ãƒ‡ãƒ—ãƒ­ã‚¤ã‚‚å€‹äººçš„ã«è‰²ã€…è©¦ã—ã¦ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2014/11/15/chef-zero-openstack-icehouse/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eOpenStack Juno ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸãŒã€ä»Šæ—¥ã¯ Icehouse ãƒã‚¿ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eicehouse ä»¥é™ã€è‡ªåˆ†ã®ä¸­ã§ OpenStack ã‚’è‡ªå‹•ã§ä½œã‚‹ä»•çµ„ã¿ãŒç„¡ããªã‚Šã¤ã¤ã‚ã‚Šã€æ°—è»½\nã« OpenStack ã‚’ä½œã£ã¦è‰²ã€…è©¦ã—ãŸã„ï¼ãƒƒã¦ã„ã†æ™‚ã«æ‰‹æ®µãŒç„¡ãå›°ã£ã¦ã„ã¾ã—ãŸã€‚ä¾‹ãˆ\nã°ä»•äº‹ã§ã¡ã‚‡ã£ã¨ OpenStack å¼„ã‚ŠãŸã„ï¼ã£ã¦æ™‚ã« DevStack, RDO ã—ã‹ãªãã€‚DevStack\nã¯å¾¡å­˜çŸ¥ã®é€šã‚Šå‹•ã‹ãªã„å¯èƒ½æ€§ãŒçµæ§‹ã‚ã‚‹ã— RDO ã¯ Ubuntu/Debian Gnu Linux ãƒ™ãƒ¼ã‚¹\nã˜ã‚ƒãªã„ã—ã€‚\u003c/p\u003e\n\u003cp\u003eã£ã¦ã“ã¨ã§ã€ä»¥å‰ã«ã‚‚ç´¹ä»‹ã—ãŸ stackforge ç®¡ç†ã® openstack-chef-repo ã¨\nChef-Zero ã‚’ä½¿ã£ã¦ OpenStack Icehouse (Neutron) ã®ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã‚’ä½œã‚‹æ–¹æ³•\nã‚’æ›¸ãã¾ã™ã€‚ã¡ãªã¿ã«æœ€è¿‘ Chef-Solo ãŒ Chef-Zero ã«ç½®ãæ›ã‚ã‚Šã¤ã¤ã‚ã‚‹ã‚‰ã—ã„ã§ã™ã€‚\nChef-Zero ã¯ã‚ªãƒ³ãƒ¡ãƒ¢ãƒªã§ Chef ã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚Chef-Solo ã¨é•ã£ã¦ Chef\nã‚µãƒ¼ãƒã‚’æ‰±ã†æ™‚ã¨ä½•ã‚‚å¤‰æ›´ç„¡ãæ“ä½œãŒå‡ºæ¥ã‚‹ã®ã§ã¨ã¦ã‚‚æ¥½ã§ã™ã€‚ã¾ãŸã€Chef ã‚µãƒ¼ãƒã‚’\nåˆ¥é€”æ§‹ã€æ§‹ç¯‰ãƒ»ç®¡ç†ã—ãªãã¦è‰¯ã„ã®ã§ã€æ°—è»½ã« OpenStack ãŒä½œã‚Œã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¡ãªã¿ã« stackforge/openstack-chef-repo ã® README.md ã« Chef-Zero ã§ã®æ§‹ç¯‰æ–¹æ³•\nãŒæ›¸ã„ã¦ã‚ã‚Šã¾ã™ãŒã€æ²¢å±±ã®å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003enova-network æ§‹æˆ\u003c/li\u003e\n\u003cli\u003eAPI ã® Endpoint ãŒå…¨ã¦ localhost ã«å‘ã„ã¦ã—ã¾ã†ãŸã‚å¤–éƒ¨ã‹ã‚‰æ“ä½œä¸å¯èƒ½\u003c/li\u003e\n\u003cli\u003eå„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® bind_address ãŒ localhost ã‚’å‘ã„ã¦ã—ã¾ã†\u003c/li\u003e\n\u003cli\u003eberkshelf ãŒãã®ã¾ã¾ã§ã¯å…¥ã‚‰ãªã„\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã‚ˆã£ã¦ã€ä»Šå›ã¯ã“ã‚Œã‚‰ã®å•é¡Œã‚’è§£æ±ºã—ã¤ã¤ \u0026ldquo;ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ãª Neutron æ§‹æˆã®\nIcehouse OpenStack ã‚’ä½œã‚‹æ–¹æ³•\u0026rdquo; ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e","title":"Chef-Zero ã§ãŠæ‰‹è»½ã« OpenStack Icehouse ã‚’ä½œã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\næ˜¨æ™© Midokura ã•ã‚“ãŒ Midonet ã‚’ OSS åŒ–ã—ãŸã¨ãƒ‹ãƒ¥ãƒ¼ã‚¹ã«ãªã‚Šã¾ã—ãŸã€‚å…¬å¼ã‚µã‚¤ãƒˆã¯ ä¸‹è¨˜ã® URL ã«ãªã£ã¦ã„ã¾ã™ã€‚Midonet ã¯ OpenStack Neutron ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦å‹•ä½œ ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ã€‚\nhttp://www.midonet.org\nä¸‹è¨˜ã®Github ä¸Šã§ã‚½ãƒ¼ã‚¹ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚\nhttps://github.com/midonet\næœ¬ä½“ã® midonet ã¨å…±ã« midostack ã¨ã„ã†ãƒ¬ãƒã‚¸ãƒˆãƒªãŒã‚ã£ã¦ã©ã†ã‚„ã‚‰å…¬å¼ã‚µã‚¤ãƒˆã® QuickStart ã‚’è¦‹ã¦ã‚‚ devstack ã‚’äº¤ãˆã¦ã®ç°¡å˜ãª midonet ã®å‹•ä½œãŒç¢ºèªã§ããã†ã€‚\nhttps://github.com/midonet/midostack\næ—©é€Ÿä½¿ã£ã¦ã¿ã‚‹ æ—©é€Ÿ midostack ã‚’ä½¿ã£ã¦ midonet ã‚’ä½“é¨“ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚QuickStart ã«ã¯ Vagrant + VirtualBox ã‚’ç”¨ã„ãŸä½¿ã„æ–¹ãŒæ”¹å®šã‚ã‚Šã¾ã™ãŒæ‰‹å…ƒã® PC ç«¯æœ«ã ã¨ãƒªã‚½ãƒ¼ã‚¹ ãŒè¶³ã‚‰ãªãã¦ CirrOS VM ä¸€å€‹ã™ã‚‰ç«‹ã¡ä¸ŠãŒã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã‚ˆã£ã¦æ™®é€šã«ãƒªã‚½ãƒ¼ã‚¹ã® æ²¢å±±ã‚ã‚‹ã‚µãƒ¼ãƒã§ç¨¼åƒã—ã¦ã¿ã¾ã™ã€‚Vagrantfile è¦‹ã¦ã‚‚\nconfig.vm.synced_folder \u0026#34;./\u0026#34;, \u0026#34;/midostack\u0026#34; ã¨ã—ã¦ã„ã‚‹ã ã‘ãªã®ã§ã€Vagrant ã§ã¯ãªãã¦ã‚‚å¤§ä¸ˆå¤«ã§ã—ã‚‡ã†ã€‚\nUbuntu Server 14.04 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒã‚·ãƒ³ã‚’ç”¨æ„ã—ã¦ midostack ã‚’å–å¾—ã—ã¾ã™ã€‚\n% git clone https://github.com/midonet/midostack.git midonet_stack.sh ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\n% cd midostack % ./midonet_stack.sh æš«ãå¾…ã¤ã¨ Neutron Middonet Plugin ãŒæœ‰åŠ¹ã«ãªã£ãŸ OpenStack ãŒç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚ Horizon ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚ãƒ¦ãƒ¼ã‚¶å : admin, ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ : gogomid0 (ãƒ‡ãƒ•ã‚© ãƒ«ãƒˆ) ã§ã™ã€‚\nVM ã‚‚æ™®é€šã«ç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã— VM åŒå£«ã®é€šä¿¡ã‚‚è‰¯å¥½ã§ã™ã€‚\nNeutron ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèªã™ã‚‹ Neutron-Server ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ç«‹ã¡ä¸ŠãŒã£ã¦ã„ã¾ã™ã€‚\n16229 pts/13 S+ 0:06 python /usr/local/bin/neutron-server --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/midonet/midonet.ini /etc/neutron/neutron.conf ã® midonet ã®æŒ‡å®šã¯ã“ã‚“ãªæ„Ÿã˜ã€‚\ncore_plugin = midonet.neutron.plugin.MidonetPluginV2 api_extensions_path = /opt/stack/midonet/python-neutron-plugin-midonet/midonet/neutron/extensions æ¬¡ã« /etc/neutron/plugins/midonet/midonet.ini ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\n[midonet] # MidoNet API server URI # midonet_uri = http://localhost:8080/midonet-api # MidoNet admin username # username = admin # MidoNet admin password # password = passw0rd # ID of the project that MidoNet admin user belongs to # project_id = 77777777-7777-7777-7777-777777777777 # Virtual provider router ID # provider_router_id = 00112233-0011-0011-0011-001122334455 # Path to midonet host uuid file # midonet_host_uuid_path = /etc/midolman/host_uuid.properties [MIDONET] project_id = admin password = gogomid0 username = admin midonet_uri = http://localhost:8081/midonet-api Midonet API ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ Midonet API ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãŒä¸‹è¨˜ã® URL ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚\nhttp://docs.midonet.org/docs/v1.8/rest-api/api/rest-api-specification.html\næ—©é€Ÿä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã¾ãš Token ã‚’å¾—ã¾ã™ã€‚\ncurl -i \u0026#39;http://127.0.0.1:5000/v2.0/tokens\u0026#39; -X POST -H \u0026#34;Content-Type: application/json\u0026#34; -H \u0026#34;Accept: application/json\u0026#34; -d \u0026#39;{\u0026#34;auth\u0026#34;: {\u0026#34;tenantName\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;passwordCredentials\u0026#34;: {\u0026#34;username\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;gogomid0\u0026#34;}}}\u0026#39; Token ID ã‚’å–å¾—ã—ãŸã‚‰ \u0026ldquo;/\u0026rdquo; ã«å¯¾ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\n% curl -i -X GET http://localhost:8081/midonet-api/ -H \u0026#34;User-Agent: python-keystoneclient\u0026#34; -H \u0026#34;X-Auth-Token: \u0026lt;TokenID\u0026gt;\u0026#34; ãƒ¬ã‚¹ãƒãƒ³ã‚¹\n{ \u0026#34;routerTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/routers/{id}\u0026#34;, \u0026#34;portTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/ports/{id}\u0026#34;, \u0026#34;vipTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/vips/{id}\u0026#34;, \u0026#34;poolTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/pools/{id}\u0026#34;, \u0026#34;healthMonitorTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/health_monitors/{id}\u0026#34;, \u0026#34;healthMonitors\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/health_monitors\u0026#34;, \u0026#34;loadBalancers\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/load_balancers\u0026#34;, \u0026#34;ipAddrGroupTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/ip_addr_groups/{id}\u0026#34;, \u0026#34;tenants\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/tenants\u0026#34;, \u0026#34;tenantTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/tenants/{id}\u0026#34;, \u0026#34;portGroupTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/port_groups/{id}\u0026#34;, \u0026#34;loadBalancerTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/load_balancers/{id}\u0026#34;, \u0026#34;poolMemberTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/pool_members/{id}\u0026#34;, \u0026#34;hostVersions\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/versions\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;v1.7\u0026#34;, \u0026#34;bridgeTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/bridges/{id}\u0026#34;, \u0026#34;hostTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/hosts/{id}\u0026#34;, \u0026#34;uri\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/\u0026#34;, \u0026#34;vteps\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/vteps\u0026#34;, \u0026#34;tunnelZoneTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/tunnel_zones/{id}\u0026#34;, \u0026#34;ipAddrGroups\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/ip_addr_groups\u0026#34;, \u0026#34;writeVersion\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/write_version\u0026#34;, \u0026#34;chainTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/chains/{id}\u0026#34;, \u0026#34;vtepTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/vteps/{ipAddr}\u0026#34;, \u0026#34;adRouteTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/ad_routes/{id}\u0026#34;, \u0026#34;bgpTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/bgps/{id}\u0026#34;, \u0026#34;hosts\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/hosts\u0026#34;, \u0026#34;routeTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/routes/{id}\u0026#34;, \u0026#34;ruleTemplate\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/rules/{id}\u0026#34;, \u0026#34;systemState\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/system_state\u0026#34;, \u0026#34;vips\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/vips\u0026#34;, \u0026#34;pools\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/pools\u0026#34;, \u0026#34;routers\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/routers\u0026#34;, \u0026#34;bridges\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/bridges\u0026#34;, \u0026#34;chains\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/chains\u0026#34;, \u0026#34;portGroups\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/port_groups\u0026#34;, \u0026#34;poolMembers\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/pool_members\u0026#34;, \u0026#34;tunnelZones\u0026#34;: \u0026#34;http://localhost:8081/midonet-api/tunnel_zones\u0026#34; } ãªã‚“ã¨ãªãå¼•æ•°ã«ã“ã‚Œã‚‰ã®æ–‡å­—åˆ—ã‚’æ¸¡ã›ã°ã„ã„ã®ã ãªã¨åˆ†ã‹ã‚Šã¾ã™ã€‚\næ¬¡ã« neutron ã®ç®¡ç†ã—ã¦ã„ã‚‹ subnets ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\n% curl -i -X GET http://localhost:8081/midonet-api/neutron/subnets -H \u0026#34;User-Agent: python-keystoneclient\u0026#34; -H \u0026#34;X-Auth-Token: \u0026lt;TokenID\u0026gt;\u0026#34; ãƒ¬ã‚¹ãƒãƒ³ã‚¹\n[ { \u0026#34;enable_dhcp\u0026#34;: false, \u0026#34;tenant_id\u0026#34;: \u0026#34;65f7012145d84ac5afc36572eabe5b09\u0026#34;, \u0026#34;host_routes\u0026#34;: [], \u0026#34;dns_nameservers\u0026#34;: [], \u0026#34;id\u0026#34;: \u0026#34;3dbe5cff-8a8c-4790-85b5-b789d8ede863\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;public-subnet\u0026#34;, \u0026#34;cidr\u0026#34;: \u0026#34;200.200.200.0/24\u0026#34;, \u0026#34;shared\u0026#34;: false, \u0026#34;ip_version\u0026#34;: 4, \u0026#34;network_id\u0026#34;: \u0026#34;45269fba-e32f-40b0-a542-f5cfe34ce1a1\u0026#34;, \u0026#34;gateway_ip\u0026#34;: \u0026#34;200.200.200.1\u0026#34;, \u0026#34;allocation_pools\u0026#34;: [ { \u0026#34;last_ip\u0026#34;: null, \u0026#34;first_ip\u0026#34;: null } ] }, { \u0026#34;enable_dhcp\u0026#34;: true, \u0026#34;tenant_id\u0026#34;: \u0026#34;f34b4398015546b8b84f50c731ed6c51\u0026#34;, \u0026#34;host_routes\u0026#34;: [], \u0026#34;dns_nameservers\u0026#34;: [], \u0026#34;id\u0026#34;: \u0026#34;3dbcf04a-9738-4b1f-b084-76f2a4b17cbc\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;private-subnet\u0026#34;, \u0026#34;cidr\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34;, \u0026#34;shared\u0026#34;: false, \u0026#34;ip_version\u0026#34;: 4, \u0026#34;network_id\u0026#34;: \u0026#34;2edb78c3-0f23-4e29-a3e6-cc97f55baa6a\u0026#34;, \u0026#34;gateway_ip\u0026#34;: \u0026#34;10.0.0.1\u0026#34;, \u0026#34;allocation_pools\u0026#34;: [ { \u0026#34;last_ip\u0026#34;: null, \u0026#34;first_ip\u0026#34;: null } ] } ] ï¼’ã¤ã®ã‚µãƒ–ãƒãƒƒãƒˆãŒç¢ºèªå‡ºæ¥ã¾ã—ãŸã€‚\nã¾ã¨ã‚ å‹‰å¼·ä¸è¶³ã§ã¾ã å…¨ã midonet ã§å‡ºæ¥ã‚‹äº‹ãŒã‚ã‹ã‚‰ãªã„..æ±—ã€‚ã§ã‚‚ã¨ã‚Šã‚ãˆãšå‹•ã‹ã›ãŸ ã—ã€API ã‚‚å¼•ã£å¼µã‚Œã‚‹ã®ã§ã“ã‚Œã‹ã‚‰è‰²ã€…è©¦ã›ãã†ã§ã™ã­ã€‚OSS åŒ–ã•ã‚ŒãŸã“ã¨ã§ã€ã‚³ãƒŸãƒ¥ ãƒ‹ãƒ†ã‚£ã®é–“ã§ã‚‚ä½¿ã‚ã‚Œã¦ã„ãã“ã¨ã‚‚æƒ³åƒå‡ºæ¥ã¾ã™ã—ã€è‡ªåˆ†ãŸã¡æŠ€è¡“è€…ã¨ã—ã¦ã¯ã¨ã¦ã‚‚æœ‰ ã‚Šé›£ã„ã“ã¨ã§ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/2014/11/04/midostack/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæ˜¨æ™© Midokura ã•ã‚“ãŒ Midonet ã‚’ OSS åŒ–ã—ãŸã¨ãƒ‹ãƒ¥ãƒ¼ã‚¹ã«ãªã‚Šã¾ã—ãŸã€‚å…¬å¼ã‚µã‚¤ãƒˆã¯\nä¸‹è¨˜ã® URL ã«ãªã£ã¦ã„ã¾ã™ã€‚Midonet ã¯ OpenStack Neutron ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦å‹•ä½œ\nã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.midonet.org\"\u003ehttp://www.midonet.org\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eä¸‹è¨˜ã®Github ä¸Šã§ã‚½ãƒ¼ã‚¹ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/midonet\"\u003ehttps://github.com/midonet\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eæœ¬ä½“ã® midonet ã¨å…±ã« midostack ã¨ã„ã†ãƒ¬ãƒã‚¸ãƒˆãƒªãŒã‚ã£ã¦ã©ã†ã‚„ã‚‰å…¬å¼ã‚µã‚¤ãƒˆã®\nQuickStart ã‚’è¦‹ã¦ã‚‚ devstack ã‚’äº¤ãˆã¦ã®ç°¡å˜ãª midonet ã®å‹•ä½œãŒç¢ºèªã§ããã†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/midonet/midostack\"\u003ehttps://github.com/midonet/midostack\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"æ—©é€Ÿä½¿ã£ã¦ã¿ã‚‹\"\u003eæ—©é€Ÿä½¿ã£ã¦ã¿ã‚‹\u003c/h2\u003e\n\u003cp\u003eæ—©é€Ÿ midostack ã‚’ä½¿ã£ã¦ midonet ã‚’ä½“é¨“ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚QuickStart ã«ã¯\nVagrant + VirtualBox ã‚’ç”¨ã„ãŸä½¿ã„æ–¹ãŒæ”¹å®šã‚ã‚Šã¾ã™ãŒæ‰‹å…ƒã® PC ç«¯æœ«ã ã¨ãƒªã‚½ãƒ¼ã‚¹\nãŒè¶³ã‚‰ãªãã¦ CirrOS VM ä¸€å€‹ã™ã‚‰ç«‹ã¡ä¸ŠãŒã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã‚ˆã£ã¦æ™®é€šã«ãƒªã‚½ãƒ¼ã‚¹ã®\næ²¢å±±ã‚ã‚‹ã‚µãƒ¼ãƒã§ç¨¼åƒã—ã¦ã¿ã¾ã™ã€‚Vagrantfile è¦‹ã¦ã‚‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003econfig.vm.synced_folder \u0026#34;./\u0026#34;, \u0026#34;/midostack\u0026#34;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eã¨ã—ã¦ã„ã‚‹ã ã‘ãªã®ã§ã€Vagrant ã§ã¯ãªãã¦ã‚‚å¤§ä¸ˆå¤«ã§ã—ã‚‡ã†ã€‚\u003c/p\u003e\n\u003cp\u003eUbuntu Server 14.04 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒã‚·ãƒ³ã‚’ç”¨æ„ã—ã¦ midostack ã‚’å–å¾—ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% git clone https://github.com/midonet/midostack.git\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003emidonet_stack.sh ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% cd midostack\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% ./midonet_stack.sh\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæš«ãå¾…ã¤ã¨ Neutron Middonet Plugin ãŒæœ‰åŠ¹ã«ãªã£ãŸ OpenStack ãŒç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚\nHorizon ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚ãƒ¦ãƒ¼ã‚¶å : admin, ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ : gogomid0 (ãƒ‡ãƒ•ã‚©\nãƒ«ãƒˆ) ã§ã™ã€‚\u003c/p\u003e","title":"MidoStack ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\næ˜¨æ™© Chef ãŒ Chef-Container ã‚’ç™ºè¡¨ã—ã¾ã—ãŸã€‚\nhttp://www.getchef.com/blog/2014/07/15/release-chef-container-0-2-0-beta/ http://docs.opscode.com/containers.html ã¾ã  Beta ãƒªãƒªãƒ¼ã‚¹ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 0.2.0 ã§ã™ã€‚(gem ã ã¨ 0.1.1)\nDocker ã‚’ä»£è¡¨ã¨ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠå‘¨ã‚Šã®æŠ€è¡“ãŒæœ€è¿‘ã€ç››ã‚“ã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ã¾ã™ã—ã€ä»Š å¾Œã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¸Šã§ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ã£ã¦ã‚¢ãƒ—ãƒªã‚’å‹•ã‹ã™ã‚±ãƒ¼ã‚¹ã‚‚å¢—ãˆã¦ãã‚‹ ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚Dockerfile ã‚’ä½¿ã£ã¦ã‚‚ Chef-Solo ã‚’ä½¿ã£ã¦ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ãƒ‡ ãƒ—ãƒ­ã‚¤å‡ºæ¥ã‚‹ã®ã ã‘ã©ãã‚Œã ã‘ã ã¨ã—ã‚“ã©ã„ã®ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã«ç‰¹åŒ–ã—ãŸ Chef ãŒå‡ºã¦ã ãŸã£ã¦ã“ã¨ã ã¨æ€ã„ã¾ã™ã€‚ç‰¹å¾´ã¨ã—ã¦ SSH ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã™ã‚‹ã®ã§ ã¯ãªãã¦ Runit + Chef-init ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚\nã§ã¯å®Ÿéš›ã«ä½¿ã£ã¦ã¿ãŸã®ã§ãã®æ™‚ã®æ‰‹é †ã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã™ã€‚\näº‹å‰ã«ç”¨æ„ã™ã‚‹ç’°å¢ƒ ä¸‹è¨˜ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’äºˆã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚\ndocker chef berkshelf ã“ã“ã§æ³¨æ„ãªã®ã§ã™ãŒå¾Œã« knife ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚ ã¤ã¾ã‚Š root æ¨©é™ãŒå¿…è¦ã§ã™ã€‚rbenv ç­‰ã‚’ä½¿ã£ã¦ ruby, chef ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã€ è¾›ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã®ã§ OS ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚ ã“ã®è¾ºã‚Šã¯ä»Šå¾Œæ”¹å–„ç­–ãŒå‡ºã¦ãã‚‹ã‹ã‚‚\u0026hellip;ã€‚\nå°šã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯ã“ã“ã§ã¯å‰²æ„›ã—ã¾ã™ã€‚\nChef-Container ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ä¸‹è¨˜ã®2ã¤ã® Gems ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\nknife-container chef-container % sudo gem install knife-container % sudo gem install chef-container ä½¿ç”¨æ–¹æ³• ã¾ãš knife ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦æ“ä½œã«å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚\n% knife container docker init chef/ubuntu-12.04 -r \u0026#39;recipe[apache2]\u0026#39; -z -b ã“ã“ã§ \u0026lsquo;chef/ubuntu-12.04\u0026rsquo; ã¯ Docker ã®ã‚¤ãƒ¡ãƒ¼ã‚¸åã§ã™ã€‚chef-init ç­‰ã®ç’°å¢ƒãŒäºˆ ã‚å…¥ã£ã¦ã„ã¾ã—ãŸã€‚ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ä»¥å¤–ã§ã¯ä»Šã®ã¨ã“ã‚å‹•ä½œã‚’ç¢ºèªã—ã¦ã„ã¾ã›ã‚“..ã€‚ã“ã‚Œã¯å¾Œã«ã¾ã¨ã‚ã§è§¦ã‚Œã¾ã™ã€‚\nä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã®çµæœã§å¾—ã‚‰ã‚Œã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«é”ã§ã™ã€‚\n. â””â”€â”€ dockerfiles â””â”€â”€ chef â””â”€â”€ ubuntu-12.04 â”œâ”€â”€ Berksfile â”œâ”€â”€ chef â”‚Â â”œâ”€â”€ first-boot.json â”‚Â â””â”€â”€ zero.rb â””â”€â”€ Dockerfile ã¾ãŸ dockerfiles/chef/ubuntu-12.04/Dockerfile ã‚’ç¢ºèªã™ã‚‹ã¨\u0026hellip;\n# BASE chef/ubuntu-12.04:latest FROM chef/ubuntu-12.04 ADD chef/ /etc/chef/ RUN chef-init --bootstrap RUN rm -rf /etc/chef/secure/* ENTRYPOINT [\u0026#34;chef-init\u0026#34;] CMD [\u0026#34;--onboot\u0026#34;] ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾— -\u0026gt; ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåŒæœŸ -\u0026gt; chef-init å®Ÿè¡Œ -\u0026gt; /etc/chef/secure é…ä¸‹å‰Šé™¤ã€ã¨ å®Ÿè¡Œã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚\næ¬¡ã« first-boot.json ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚chef-init ãŒè§£é‡ˆã™ã‚‹ãƒ•ã‚¡ ã‚¤ãƒ«ã§ã™ã€‚\n{ \u0026#34;run_list\u0026#34;: [ \u0026#34;recipe[apache2]\u0026#34; ], \u0026#34;container_service\u0026#34;: { \u0026#34;apache2\u0026#34;: { \u0026#34;command\u0026#34;: \u0026#34;/usr/sbin/apache2 -k start\u0026#34; } } } ã§ã¯ã„ã‚ˆã„ã‚ˆ knife ã‚³ãƒãƒ³ãƒ‰ã§ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚\n% sudo knife container docker build chef/ubuntu-12.04 -z ã™ã‚‹ã¨ã€ä¸‹è¨˜ã®ã‚ˆã†ã« Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå‡ºæ¥ä¸ŠãŒã‚Šã¾ã™ã€‚\n% sudo docker images REPOSITORY TAG IMAGE ID CREATED VIRTUAL SIZE chef/ubuntu-12.04 11 03fd2357596f 4 days ago 397.7 MB chef/ubuntu-12.04 11.12 03fd2357596f 4 days ago 397.7 MB chef/ubuntu-12.04 11.12.8 03fd2357596f 4 days ago 397.7 MB å‡ºæ¥ä¸ŠãŒã£ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’ç¨¼åƒã—ã¾ã™ã€‚\n% sudo docker run chef/ubuntu-12.04 % sudo docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 191cfdaf0bdb 650a89f73ed8 chef-init --onboot 39 minutes ago Up 39 minutes agitated_almeida ã¾ã¨ã‚ ã‚³ãƒ³ãƒ†ãƒŠã¨è¨€ã£ã¦ã‚‚ä»Šç¾åœ¨ã¯ Docker ã®ã¿ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ã¾ãŸ init ã®éš›ã«æŒ‡å®šã™ã‚‹ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ ã®ä¸­ã« chef-init ãŒå…¥ã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚Build ã™ã‚‹å‰ã«äºˆã‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã£ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã¨ã„ã† ã®ã¯ã—ã‚“ã©ã„ã®ã§ã€ä»Šå¾Œæ”¹å–„ã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\nãã‚‚ãã‚‚ Docker ã‚„ã‚³ãƒ³ãƒ†ãƒŠæŠ€è¡“ã®ç™»å ´ã§ Puppet, Chef ã‚’ä»£è¡¨ã¨ã™ã‚‹ãƒ„ãƒ¼ãƒ«é¡ãŒä¸è¦ã«ãªã‚‹ã®ã§ã¯ï¼Ÿã¨ã„ã†è­°è«–ãŒ å¹¾ã¤ã‹ã®å ´é¢ã§ã‚ã£ãŸã‚ˆã†ã«æ€ã„ã¾ã™ã€‚ã¤ã¾ã‚Šã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã«äºˆã‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’é…å¸ƒã—ãã‚Œã‚’ç”¨ã„ã¦ç¨¼åƒ ã™ã‚‹ã“ã¨ã§ã€ãƒã‚·ãƒ³ãŒèµ·å‹•ã—ãŸå¾Œã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ãŒå¿…è¦ãªã„ã‚ˆã­ï¼Ÿã¨ã„ã†ç™ºæƒ³ã§ã™ã€‚ä»Šå›ç´¹ä»‹ã—ãŸã‚ˆã†ã«ã‚³ãƒ³ãƒ†ãƒŠã® ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹ã®ã« Chef ã‚’ç”¨ã„ã‚‹ã¨ã„ã†ã“ã¨ã§ã‚ã‚Œã°ã€ã¾ãŸåˆ¥ã®è­°è«–ã«ãªã‚Šãã†ã§ã™ã€‚ã¾ãŸç¨¼åƒã—ãŸã‚³ãƒ³ãƒ†ãƒŠã« ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã‚‚å ´åˆã«ã‚ˆã£ã¦ã¯å¿…è¦ãªã®ã§ã€ã“ã®è¾ºã‚Šã®æŠ€è¡“ã®å®Œæˆåº¦ãŒä¸ŠãŒã‚‹ã“ã¨ã‚’æœŸå¾…ã—ãŸã„ã§ã™ã€‚\nå‚è€ƒ URL CreationLine ã•ã‚“ãƒ–ãƒ­ã‚° http://www.creationline.com/lab/5346 å…¬å¼ã‚µã‚¤ãƒˆ http://docs.opscode.com/containers.html ","permalink":"https://jedipunkz.github.io/post/2014/07/16/chef-container/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæ˜¨æ™© Chef ãŒ Chef-Container ã‚’ç™ºè¡¨ã—ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://www.getchef.com/blog/2014/07/15/release-chef-container-0-2-0-beta/\"\u003ehttp://www.getchef.com/blog/2014/07/15/release-chef-container-0-2-0-beta/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://docs.opscode.com/containers.html\"\u003ehttp://docs.opscode.com/containers.html\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã¾ã  Beta ãƒªãƒªãƒ¼ã‚¹ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 0.2.0 ã§ã™ã€‚(gem ã ã¨ 0.1.1)\u003c/p\u003e\n\u003cp\u003eDocker ã‚’ä»£è¡¨ã¨ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠå‘¨ã‚Šã®æŠ€è¡“ãŒæœ€è¿‘ã€ç››ã‚“ã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ã¾ã™ã—ã€ä»Š\nå¾Œã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¸Šã§ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ã£ã¦ã‚¢ãƒ—ãƒªã‚’å‹•ã‹ã™ã‚±ãƒ¼ã‚¹ã‚‚å¢—ãˆã¦ãã‚‹\nã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚Dockerfile ã‚’ä½¿ã£ã¦ã‚‚ Chef-Solo ã‚’ä½¿ã£ã¦ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ãƒ‡\nãƒ—ãƒ­ã‚¤å‡ºæ¥ã‚‹ã®ã ã‘ã©ãã‚Œã ã‘ã ã¨ã—ã‚“ã©ã„ã®ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã«ç‰¹åŒ–ã—ãŸ Chef ãŒå‡ºã¦ã\nãŸã£ã¦ã“ã¨ã ã¨æ€ã„ã¾ã™ã€‚ç‰¹å¾´ã¨ã—ã¦ SSH ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã™ã‚‹ã®ã§\nã¯ãªãã¦ Runit + Chef-init ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã§ã¯å®Ÿéš›ã«ä½¿ã£ã¦ã¿ãŸã®ã§ãã®æ™‚ã®æ‰‹é †ã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"äº‹å‰ã«ç”¨æ„ã™ã‚‹ç’°å¢ƒ\"\u003eäº‹å‰ã«ç”¨æ„ã™ã‚‹ç’°å¢ƒ\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’äºˆã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003edocker\u003c/li\u003e\n\u003cli\u003echef\u003c/li\u003e\n\u003cli\u003eberkshelf\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã“ã“ã§æ³¨æ„ãªã®ã§ã™ãŒå¾Œã« knife ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚\nã¤ã¾ã‚Š root æ¨©é™ãŒå¿…è¦ã§ã™ã€‚rbenv ç­‰ã‚’ä½¿ã£ã¦ ruby, chef ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã€\nè¾›ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã®ã§ OS ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚\nã“ã®è¾ºã‚Šã¯ä»Šå¾Œæ”¹å–„ç­–ãŒå‡ºã¦ãã‚‹ã‹ã‚‚\u0026hellip;ã€‚\u003c/p\u003e\n\u003cp\u003eå°šã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯ã“ã“ã§ã¯å‰²æ„›ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"chef-container-ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003eChef-Container ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®2ã¤ã® Gems ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eknife-container\u003c/li\u003e\n\u003cli\u003echef-container\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo gem install knife-container\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo gem install chef-container\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ä½¿ç”¨æ–¹æ³•\"\u003eä½¿ç”¨æ–¹æ³•\u003c/h2\u003e\n\u003cp\u003eã¾ãš knife ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦æ“ä½œã«å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚\u003c/p\u003e","title":"Chef-Container Beta ã‚’ä½¿ã£ã¦ã¿ã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šæ—¥ã€JTF2014 (July Tech Festa 2014) ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆã§ Ceph ã®ã“ã¨ã‚’è©±ã—ã¦ãã¾ ã—ãŸã€‚Ceph ãƒ¦ãƒ¼ã‚¶ä¼šã®ä¼šå“¡ã¨ã—ã¦è©±ã—ã¦ããŸã®ã§ã™ãŒ Ceph ãƒ¦ãƒ¼ã‚¶ä¼šã¯å®Ÿã¯æœ€è¿‘ç™ºè¶³ ã—ãŸã°ã‹ã‚Šã®ãƒ¦ãƒ¼ã‚¶ä¼šã§ã€ã¾ã ã¾ã æ´»å‹•ãŒæ´»ç™ºã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚‚ã—èˆˆå‘³ãŒã‚ã‚‹æ–¹ã„ã‚‰ã£ ã—ã‚ƒã„ã¾ã—ãŸã‚‰æ˜¯éå‚åŠ ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ãƒ¼ã€‚ä¸‹è¨˜ã® Google Groups ã«ãªã‚Šã¾ã™ã€‚\nhttps://groups.google.com/forum/#!forum/ceph-jp\nãƒ¦ãƒ¼ã‚¶ä¼šã¨ã—ã¦ã®å‹‰å¼·ä¼šã¨ã—ã¦åˆã«ãªã‚‹ã®ã§ã™ãŒã€ä»Šå›ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã§è‡ªåˆ†ã¯ Ceph-Deploy ã«ã¤ã„ã¦è©±ã—ã¦ãã¾ã—ãŸã€‚ã¨ã‚Šã‚ãˆãšçš†ã•ã‚“ã«ä½¿ã£ã¦ã‚‚ã‚‰ã„ãŸã‹ã£ãŸã®ã§ ã“ã®è©±ã‚’ã—ã¦ãã¾ã—ãŸã€‚ãŒã€äºˆå®šæ™‚é–“ãŒãƒ¡ãƒãƒ£çŸ­ã‹ã£ãŸã®ã§è¶…çµ¶æ—©å£ã§é ‘å¼µã£ãŸåˆ†ã€çš† ã•ã‚“ã«ç†è§£ã—ã¦ã‚‚ã‚‰ãˆãªã‹ã£ãŸæ°—ãŒã—ã¦ã¡ã‚‡ã£ã¨åçœ\u0026hellip;ã€‚ãªã®ã§ã€ã“ã®ãƒ–ãƒ­ã‚°ã‚’åˆ©ç”¨ ã—ã¦å°‘ã—ç´°ãã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚\nä»Šæ—¥ã®ç™ºè¡¨è³‡æ–™ã¯ã“ã¡ã‚‰ã§ã™ï¼\nä»Šæ—¥ã®ãƒ†ãƒ¼ãƒã¯ ã€ŒCeph-Deploy ã‚’ä½¿ã£ã¦ Ceph ã‚’æ§‹ç¯‰ã—ã¦ã¿ã‚‹ã€ã ã£ãŸã®ã§ã™ãŒã€ä¸‹ è¨˜ã®ãƒ†ãƒ¼ãƒã‚’æŒã£ã¦è³‡æ–™ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚\nå˜ã«ãƒŸãƒ‹ãƒãƒ æ§‹æˆã§ã¯ãªãé‹ç”¨ã‚’è€ƒæ…®ã—ãŸå®Ÿç”¨æ€§ã®ã‚ã‚‹æ§‹æˆ OSD, MON, MDS ã®å„ãƒ—ãƒ­ã‚»ã‚¹ã¨ãƒãƒ¼ãƒ‰ãƒ»ãƒ‡ã‚£ã‚¹ã‚¯ã®æ•°ã®é–¢ä¿‚ã‚’çŸ¥ã£ã¦ã‚‚ã‚‰ã† ç‰¹ã«ã€Œå®Ÿç”¨æ€§ã®ã‚ã‚‹..ã€ã¯æ„è­˜ã—ãŸã¤ã‚‚ã‚Šã§ã—ãŸã€‚ãã®ãŸã‚ã«å‰æã¨ã—ãŸæ§‹æˆã«ä¸‹è¨˜ã® ç‰¹å¾´ã‚’æŒãŸã›ã¦ã„ã¾ã™ã€‚(è³‡æ–™ 6 ãƒšãƒ¼ã‚¸ç›®ã«æ§‹æˆå›³ãŒã‚ã‚Šã¾ã™ã€‚ç¢ºèªã—ã¦ã¿ã¦ãã ã•ã„ã€‚)\nã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ ¼ç´ç”¨ãƒ‡ã‚£ã‚¹ã‚¯ã¯è¤‡æ•°/ãƒãƒ¼ãƒ‰ã‚’å‰æ OSD ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç”¨ã„ã‚‹æ§‹æˆ OSD ã®æ‰±ã†ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«æ ¼ç´ç”¨ãƒ‡ã‚£ã‚¹ã‚¯ã¯é«˜é€Ÿãª SSD ã‚’ç”¨ã„ã‚‹ MDS ã¯åˆ©ç”¨ã™ã‚‹ HW ãƒªã‚½ãƒ¼ã‚¹ã®ç‰¹å¾´ãŒç•°ãªã‚‹ã®ã§åˆ¥ãƒãƒ¼ãƒ‰ã¸é…ç½® ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å…¨ä½“ã‚’æ‹¡å¼µã—ãŸã‘ã‚Œã°\nå›³ä¸­ ceph01-03 ã®æ§˜ãªãƒãƒ¼ãƒ‰ã‚’å¢—è¨­ã™ã‚‹ ceph01-03 ã«ãƒ‡ã‚£ã‚¹ã‚¯ã¨ãã‚Œã«å¯¾ã™ã‚‹ OSD ã‚’å¢—è¨­ã™ã‚‹ ã§ã™ãŒã€å‰è€…ãŒãƒ™ã‚¹ãƒˆã§ã—ã‚‡ã†ã€‚ãƒãƒ¼ãƒ‰å¢—è¨­ã®å ´åˆ ceph-deploy ã‚’ç”¨ã„ã¦\nceph-deploy mon create \u0026lt;æ–°è¦ãƒ›ã‚¹ãƒˆå\u0026gt; ã§ MON ã‚’ç¨¼åƒ ceph-dploy disk zap, osd create ã§ OSD ã‚’ç¨¼åƒ ã§ç°¡å˜ã«å¯èƒ½ã§ã™ã€‚MDS ã®å¢—è¨­ã‚‚è² è·çŠ¶æ³ã‚’è¦‹ãªãŒã‚‰ã™ã‚‹ã¨ã„ã„ã§ã—ã‚‡ã†ã€‚è‡ªåˆ†ã¯ã¾ã  Ceph ã‚’é‹ç”¨ã—ã¦ã„ãªã„ã®ã§ã€å„ãƒ—ãƒ­ã‚»ã‚¹ãŒã©ã®ã‚ˆã†ãªãƒªã‚½ãƒ¼ã‚¹ã®æ¶ˆè²»ã®ä»•æ–¹ã‚’ã™ã‚‹ã® ã‹çŸ¥ã‚Šã¾ã›ã‚“ã€‚MDS ãŒã©ã®ã‚ˆã†ãªæ•°ã§é‹ç”¨ã—ã¦ã„ãã¹ããªã®ã‹ã€‚æ—©ãé‹ç”¨ã‹ã‚‰å¾—ãŸãƒã‚¦ ãƒã‚¦ãŒå…±æœ‰ã•ã‚Œãªã„ã‹ãªãã¨æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚\nã¾ãŸä»Šå›è©±ã™ã®ã‚’å¿˜ã‚ŒãŸã®ã§ã™ãŒ SSD ã‚’ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«æ ¼ç´ç”¨ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã—ã¦ç”¨ã„ãŸã®ã¯ ãƒãƒ¼ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã«å¯¾ã—ã¦é«˜é€Ÿã§ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã‚‹ã“ã¨ãƒ»ã¾ãŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚ªãƒ–ã‚¸ã‚§ ã‚¯ãƒˆã«å¯¾ã—ã¦å°å®¹é‡ã§æ¸ˆã‚€ã€ã¨ã„ã£ãŸç†ç”±ã‹ã‚‰ã§ã™ã€‚ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ã®ã«é©ã—ã¦ã„ã‚‹ ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸå°†æ¥çš„ã«ã¯å¹¾ã¤ã‹ã® KVS ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ ç†ã«ä½¿ã†å®Ÿè£…ãŒã•ã‚Œã‚‹ãã†ã§ã™ã€‚\nä»¥ä¸Šã§ã™ã€‚çš†ã•ã‚“ã€æ˜¯é Ceph ã‚’ä½¿ã£ã¦ã¿ã¦ãã ã•ã„ï¼ ã¾ãŸèˆˆå‘³ã®ã‚ã‚‹æ–¹ã¯ãƒ¦ãƒ¼ã‚¶ä¼š ã¸ã®åŠ å…¥ã‚’ã”æ¤œè¨ãã ã•ã„ãƒ¼ã€‚\n","permalink":"https://jedipunkz.github.io/post/2014/06/22/jtf2014-ceph/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šæ—¥ã€JTF2014 (July Tech Festa 2014) ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆã§ Ceph ã®ã“ã¨ã‚’è©±ã—ã¦ãã¾\nã—ãŸã€‚Ceph ãƒ¦ãƒ¼ã‚¶ä¼šã®ä¼šå“¡ã¨ã—ã¦è©±ã—ã¦ããŸã®ã§ã™ãŒ Ceph ãƒ¦ãƒ¼ã‚¶ä¼šã¯å®Ÿã¯æœ€è¿‘ç™ºè¶³\nã—ãŸã°ã‹ã‚Šã®ãƒ¦ãƒ¼ã‚¶ä¼šã§ã€ã¾ã ã¾ã æ´»å‹•ãŒæ´»ç™ºã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚‚ã—èˆˆå‘³ãŒã‚ã‚‹æ–¹ã„ã‚‰ã£\nã—ã‚ƒã„ã¾ã—ãŸã‚‰æ˜¯éå‚åŠ ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ãƒ¼ã€‚ä¸‹è¨˜ã® Google Groups ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://groups.google.com/forum/#!forum/ceph-jp\"\u003ehttps://groups.google.com/forum/#!forum/ceph-jp\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eãƒ¦ãƒ¼ã‚¶ä¼šã¨ã—ã¦ã®å‹‰å¼·ä¼šã¨ã—ã¦åˆã«ãªã‚‹ã®ã§ã™ãŒã€ä»Šå›ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã§è‡ªåˆ†ã¯\nCeph-Deploy ã«ã¤ã„ã¦è©±ã—ã¦ãã¾ã—ãŸã€‚ã¨ã‚Šã‚ãˆãšçš†ã•ã‚“ã«ä½¿ã£ã¦ã‚‚ã‚‰ã„ãŸã‹ã£ãŸã®ã§\nã“ã®è©±ã‚’ã—ã¦ãã¾ã—ãŸã€‚ãŒã€äºˆå®šæ™‚é–“ãŒãƒ¡ãƒãƒ£çŸ­ã‹ã£ãŸã®ã§è¶…çµ¶æ—©å£ã§é ‘å¼µã£ãŸåˆ†ã€çš†\nã•ã‚“ã«ç†è§£ã—ã¦ã‚‚ã‚‰ãˆãªã‹ã£ãŸæ°—ãŒã—ã¦ã¡ã‚‡ã£ã¨åçœ\u0026hellip;ã€‚ãªã®ã§ã€ã“ã®ãƒ–ãƒ­ã‚°ã‚’åˆ©ç”¨\nã—ã¦å°‘ã—ç´°ãã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šæ—¥ã®ç™ºè¡¨è³‡æ–™ã¯ã“ã¡ã‚‰ã§ã™ï¼\u003c/p\u003e\n\u003cscript async class=\"speakerdeck-embed\"\ndata-id=\"592a0b90ceb30131a5d25ae3f95c3a1a\" data-ratio=\"1.33333333333333\" src=\"//speakerdeck.com/assets/embed.js\"\u003e\u003c/script\u003e\n\u003cp\u003eä»Šæ—¥ã®ãƒ†ãƒ¼ãƒã¯ ã€ŒCeph-Deploy ã‚’ä½¿ã£ã¦ Ceph ã‚’æ§‹ç¯‰ã—ã¦ã¿ã‚‹ã€ã ã£ãŸã®ã§ã™ãŒã€ä¸‹\nè¨˜ã®ãƒ†ãƒ¼ãƒã‚’æŒã£ã¦è³‡æ–™ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå˜ã«ãƒŸãƒ‹ãƒãƒ æ§‹æˆã§ã¯ãªãé‹ç”¨ã‚’è€ƒæ…®ã—ãŸå®Ÿç”¨æ€§ã®ã‚ã‚‹æ§‹æˆ\u003c/li\u003e\n\u003cli\u003eOSD, MON, MDS ã®å„ãƒ—ãƒ­ã‚»ã‚¹ã¨ãƒãƒ¼ãƒ‰ãƒ»ãƒ‡ã‚£ã‚¹ã‚¯ã®æ•°ã®é–¢ä¿‚ã‚’çŸ¥ã£ã¦ã‚‚ã‚‰ã†\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç‰¹ã«ã€Œå®Ÿç”¨æ€§ã®ã‚ã‚‹..ã€ã¯æ„è­˜ã—ãŸã¤ã‚‚ã‚Šã§ã—ãŸã€‚ãã®ãŸã‚ã«å‰æã¨ã—ãŸæ§‹æˆã«ä¸‹è¨˜ã®\nç‰¹å¾´ã‚’æŒãŸã›ã¦ã„ã¾ã™ã€‚(è³‡æ–™ 6 ãƒšãƒ¼ã‚¸ç›®ã«æ§‹æˆå›³ãŒã‚ã‚Šã¾ã™ã€‚ç¢ºèªã—ã¦ã¿ã¦ãã ã•ã„ã€‚)\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ ¼ç´ç”¨ãƒ‡ã‚£ã‚¹ã‚¯ã¯è¤‡æ•°/ãƒãƒ¼ãƒ‰ã‚’å‰æ\u003c/li\u003e\n\u003cli\u003eOSD ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç”¨ã„ã‚‹æ§‹æˆ\u003c/li\u003e\n\u003cli\u003eOSD ã®æ‰±ã†ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«æ ¼ç´ç”¨ãƒ‡ã‚£ã‚¹ã‚¯ã¯é«˜é€Ÿãª SSD ã‚’ç”¨ã„ã‚‹\u003c/li\u003e\n\u003cli\u003eMDS ã¯åˆ©ç”¨ã™ã‚‹ HW ãƒªã‚½ãƒ¼ã‚¹ã®ç‰¹å¾´ãŒç•°ãªã‚‹ã®ã§åˆ¥ãƒãƒ¼ãƒ‰ã¸é…ç½®\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å…¨ä½“ã‚’æ‹¡å¼µã—ãŸã‘ã‚Œã°\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå›³ä¸­ ceph01-03 ã®æ§˜ãªãƒãƒ¼ãƒ‰ã‚’å¢—è¨­ã™ã‚‹\u003c/li\u003e\n\u003cli\u003eceph01-03 ã«ãƒ‡ã‚£ã‚¹ã‚¯ã¨ãã‚Œã«å¯¾ã™ã‚‹ OSD ã‚’å¢—è¨­ã™ã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã§ã™ãŒã€å‰è€…ãŒãƒ™ã‚¹ãƒˆã§ã—ã‚‡ã†ã€‚ãƒãƒ¼ãƒ‰å¢—è¨­ã®å ´åˆ ceph-deploy ã‚’ç”¨ã„ã¦\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eceph-deploy mon create \u0026lt;æ–°è¦ãƒ›ã‚¹ãƒˆå\u0026gt; ã§ MON ã‚’ç¨¼åƒ\u003c/li\u003e\n\u003cli\u003eceph-dploy disk zap, osd create ã§ OSD ã‚’ç¨¼åƒ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã§ç°¡å˜ã«å¯èƒ½ã§ã™ã€‚MDS ã®å¢—è¨­ã‚‚è² è·çŠ¶æ³ã‚’è¦‹ãªãŒã‚‰ã™ã‚‹ã¨ã„ã„ã§ã—ã‚‡ã†ã€‚è‡ªåˆ†ã¯ã¾ã \nCeph ã‚’é‹ç”¨ã—ã¦ã„ãªã„ã®ã§ã€å„ãƒ—ãƒ­ã‚»ã‚¹ãŒã©ã®ã‚ˆã†ãªãƒªã‚½ãƒ¼ã‚¹ã®æ¶ˆè²»ã®ä»•æ–¹ã‚’ã™ã‚‹ã®\nã‹çŸ¥ã‚Šã¾ã›ã‚“ã€‚MDS ãŒã©ã®ã‚ˆã†ãªæ•°ã§é‹ç”¨ã—ã¦ã„ãã¹ããªã®ã‹ã€‚æ—©ãé‹ç”¨ã‹ã‚‰å¾—ãŸãƒã‚¦\nãƒã‚¦ãŒå…±æœ‰ã•ã‚Œãªã„ã‹ãªãã¨æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e","title":"JTF2014 ã§ Ceph ã«ã¤ã„ã¦è©±ã—ã¦ããŸï¼"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»¥å‰ Mesos, Docker ã«ã¤ã„ã¦è¨˜äº‹ã«ã—ã¾ã—ãŸã€‚\nhttp://jedipunkz.github.io/blog/2013/09/28/mesos-architecture-number-1/ http://jedipunkz.github.io/blog/2013/10/01/methos-architecture-number-2-docker-on-mesos/\nTwitter ã§ Docker é–¢é€£ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦å‘Ÿã„ã¦ã„ãŸã‚‰ @everpeace ã•ã‚“ã‹ã‚‰ ã“ã‚“ãªæƒ…å ±ã‚’ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚\n@jedipunkz å…ƒã€…meos-dockerã£ã¦ã„ã†mesos executorãŒã‚ã£ãŸã‚“ã§ã™ã‘ã©ã€mesosãŒcontaineréƒ¨åˆ†ã‚’pluggableã«ã—ãŸã®ã§ã€ãã‚Œã«åˆã‚ã›ã¦deimosã£ã¦ã„ã†mesosç”¨ã®external containerizer ãŒä½œã‚‰ã‚Œã¾ã—ãŸã€‚\n\u0026mdash; Shingo Omura (@everpeace) 2014, 6æœˆ 12 Deimos !!! çŸ¥ã‚‰ãªã‹ã£ãŸã€‚Mesos ã® Docker ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚‰ã—ãä¸‹è¨˜ã®å ´æ‰€ã«ã‚ã‚Šã¾ã—ãŸã€‚\nhttps://github.com/mesosphere/deimos\nè‰²ã€…èª¿ã¹ã„ãŸã‚‰ã€ã“ã‚“ãªè³‡æ–™ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚ã©ã†ã‚„ã‚‰ã¾ã å…¬é–‹ã•ã‚Œã¦4æ—¥ã—ã‹çµŒã£ã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚\nhttp://mesosphere.io/learn/run-docker-on-mesosphere/\nMesos + Marathon + Deimos + Docker ã‚’ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã§æ§‹ç¯‰ã™ã‚‹æ‰‹é †ãŒæ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚\nå†…å®¹ã¯ã»ã¼åŒã˜ã§ã™ãŒã€ä¸€å¿œè‡ªåˆ†ãŒã‚„ã£ã¦ã¿ã¦ç†è§£ã—ãŸã“ã¨ã‚’ã¾ã¨ã‚ãŸã„ã®ã§ä¸‹è¨˜ã«è¨˜ã—ã¦ã„ãã¾ã™ã€‚\næ§‹ç¯‰ã—ã¦ã¿ã‚‹ æ‰‹é †ã‚’ã¾ã¨ã‚ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã—ã¾ã—ãŸã€‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ Ubuntu 13.10 ç”¨ã®ã‚ˆã†ã§ã™ãŒ 14.04 ã®ãƒ›ã‚¹ãƒˆ ã§å®Ÿè¡Œå‡ºæ¥ã¾ã—ãŸã€‚14.04 ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã¾ã è¦‹ã¤ã‹ã£ã¦ã„ã¾ã›ã‚“ã€‚\n#!/bin/bash # disable ipv6 echo \u0026#39;net.ipv6.conf.all.disable_ipv6 = 1\u0026#39; | sudo tee -a /etc/sysctl.conf echo \u0026#39;net.ipv6.conf.default.disable_ipv6 = 1\u0026#39; | sudo tee -a /etc/sysctl.conf sudo sysctl -p # install related tools sudo apt-get update sudo apt-get -y install curl python-setuptools python-pip python-dev python-protobuf # install zookeeper sudo apt-get -y install zookeeperd echo 1 | sudo dd of=/var/lib/zookeeper/myid # install docker sudo apt-get -y install docker.io sudo ln -sf /usr/bin/docker.io /usr/local/bin/docker sudo sed -i \u0026#39;$acomplete -F _docker docker\u0026#39; /etc/bash_completion.d/docker.io sudo docker pull libmesos/ubuntu # install mesos curl -fL http://downloads.mesosphere.io/master/ubuntu/13.10/mesos_0.19.0-xcon3_amd64.deb -o /tmp/mesos.deb sudo dpkg -i /tmp/mesos.deb sudo mkdir -p /etc/mesos-master echo in_memory | sudo dd of=/etc/mesos-master/registry curl -fL http://downloads.mesosphere.io/master/ubuntu/13.10/mesos_0.19.0-xcon3_amd64.egg -o /tmp/mesos.egg sudo easy_install /tmp/mesos.egg # install marathon curl -fL http://downloads.mesosphere.io/marathon/marathon_0.5.0-xcon2_noarch.deb -o /tmp/marathon.deb sudo dpkg -i /tmp/marathon.deb # restart each services sudo service docker.io restart sudo service zookeeper restart sudo service mesos-master restart sudo service mesos-slave restart # install deimos sudo pip install deimos sudo mkdir -p /etc/mesos-slave ## Configure Deimos as a containerizer echo /usr/bin/deimos | sudo dd of=/etc/mesos-slave/containerizer_path echo external | sudo dd of=/etc/mesos-slave/isolation ãƒ—ãƒ­ã‚»ã‚¹ã®ç¢ºèª å®Ÿè¡ŒãŒçµ‚ã‚ã‚‹ã¨å„ãƒ—ãƒ­ã‚»ã‚¹ãŒç¢ºèªå‡ºæ¥ã¾ã™ã€‚ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã©ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒä½•ã‚’è¦‹ã¦ã„ã‚‹ã‹å¤§ä½“ ã‚ã‹ã‚Šã¾ã™ã®ã§è¦‹ã¦ã„ãã¾ã™ã€‚\nmesos-master mesos-master ã¯ zookeeper ã‚’å‚ç…§ã—ã¦ 5050 ç•ªãƒãƒ¼ãƒˆã§èµ·å‹•ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚\n% ps ax | grep mesos-master 1224 ? Ssl 0:30 /usr/local/sbin/mesos-master --zk=zk://localhost:2181/mesos --port=5050 --log_dir=/var/log/mesos --registry=in_memory mesos-slave mesos-slave ã¯åŒã˜ã zookeeper ã‚’å‚ç…§ã—ã¦ containerizer ã‚’ deimos ã¨ã—ã¦ç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨ãŒ ã‚ã‹ã‚Šã¾ã™ã€‚\n% ps ax | grep mesos-slave 1225 ? Ssl 0:12 /usr/local/sbin/mesos-slave --master=zk://localhost:2181/mesos --log_dir=/var/log/mesos --containerizer_path=/usr/bin/deimos --isolation=external zookeeper zookeeper ã¯ OpenJDK7 ã§ç¨¼åƒã—ã¦ã„ã‚‹ Java ãƒ—ãƒ­ã‚»ã‚¹ã§ã™ã€‚\n% ps ax | grep zookeeper 1073 ? Ssl 1:07 /usr/bin/java -cp /etc/zookeeper/conf:/usr/share/java/jline.jar:/usr/share/java/log4j-1.2.jar:/usr/share/java/xercesImpl.jar:/usr/share/java/xmlParserAPIs.jar:/usr/share/java/netty.jar:/usr/share/java/slf4j-api.jar:/usr/share/java/slf4j-log4j12.jar:/usr/share/java/zookeeper.jar -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.local.only=false -Dzookeeper.log.dir=/var/log/zookeeper -Dzookeeper.root.logger=INFO,ROLLINGFILE org.apache.zookeeper.server.quorum.QuorumPeerMain /etc/zookeeper/conf/zoo.cfg docker docker ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚‚ç¢ºèªã§ãã¾ã™ã€‚è¨­å®šã¯ç‰¹ã«ã—ã¦ã„ãªã„ã§ã™ã€‚\n% ps axuw | grep docker root 831 0.0 0.3 364776 14924 ? Sl 01:30 0:01 /usr/bin/docker.io -d Marathon ã® WebUI ã«ã‚¢ã‚¯ã‚»ã‚¹ Marathon ã® WebUI ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nã¾ã ä½•ã‚‚ Tasks ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„ã®ã§ä¸€è¦§ã«ã¯ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ã¨æ€ã„ã¾ã™ã€‚\nTasks ã®å®Ÿè¡Œ Marathon API ã«å¯¾ã—ã¦ã‚¯ã‚¨ãƒªã‚’ç™ºè¡Œã™ã‚‹ã“ã¨ã§ Mesos ã® Tasks ã¨ã—ã¦ Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’ç¨¼åƒã•ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ ä¸‹è¨˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ ubuntu.json ã¨ã—ã¦ä¿å­˜ã€‚\n{ \u0026#34;container\u0026#34;: { \u0026#34;image\u0026#34;: \u0026#34;docker:///libmesos/ubuntu\u0026#34; }, \u0026#34;id\u0026#34;: \u0026#34;ubuntu\u0026#34;, \u0026#34;instances\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;cpus\u0026#34;: \u0026#34;.5\u0026#34;, \u0026#34;mem\u0026#34;: \u0026#34;512\u0026#34;, \u0026#34;uris\u0026#34;: [ ] } ä¸‹è¨˜ã®é€šã‚Š localhost:8080 ãŒ Marathon API ã® Endpoint ã«ãªã£ã¦ã„ã‚‹ã®ã§ã“ã“ã«å¯¾ã—ã¦ä½œæˆã—ãŸ JSON ã‚’ POST ã—ã¾ã™ã€‚\n% curl -X POST -H \u0026#34;Content-Type: application/json\u0026#34; localhost:8080/v2/apps -d@ubuntu.json Tasks ã®ä¸€è¦§ã‚’å–å¾—ã—ã¦ã¿ã¾ã™ã€‚\n% curl -X GET -H \u0026#34;Content-Type: application/json\u0026#34; localhost:8080/v2/apps {\u0026#34;apps\u0026#34;:[{\u0026#34;id\u0026#34;:\u0026#34;ubuntu\u0026#34;,\u0026#34;cmd\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;env\u0026#34;:{},\u0026#34;instances\u0026#34;:1,\u0026#34;cpus\u0026#34;:0.5,\u0026#34;mem\u0026#34;:512.0,\u0026#34;executor\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;constraints\u0026#34;:[],\u0026#34;uris\u0026#34;:[],\u0026#34;ports\u0026#34;:[13049],\u0026#34;taskRateLimit\u0026#34;:1.0,\u0026#34;container\u0026#34;:{\u0026#34;image\u0026#34;:\u0026#34;docker:///libmesos/ubuntu\u0026#34;,\u0026#34;options\u0026#34;:[]},\u0026#34;version\u0026#34;:\u0026#34;2014-06-13T01:45:58.693Z\u0026#34;,\u0026#34;tasksStaged\u0026#34;:1,\u0026#34;tasksRunning\u0026#34;:0}]} Tasks ã®ä¸€è¦§ãŒ JSON ã§è¿”ã£ã¦ãã¾ã™ã€‚id : ubuntu, ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•° : 1, CPU 0.5, ãƒ¡ãƒ¢ãƒªãƒ¼ : 512MB ã§ Task ãŒç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªå‡ºæ¥ã¾ã™ã€‚\nã“ã“ã§ WebUI å´ã‚‚è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nä¸€ã¤ Task ãŒç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªå‡ºæ¥ã‚‹ã¨æ€ã„ã¾ã™ã€‚\nãã® Task ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\næ¬¡ã« Tasks ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚’è¡Œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ ä¸‹è¨˜ã®é€šã‚Š ubuntu.json ã‚’ä¿®æ­£ã— instances : 2 ã¨ã™ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ãŒ2ã«å¢—ãˆã¾ã™ã€‚\n{ \u0026#34;container\u0026#34;: { \u0026#34;image\u0026#34;: \u0026#34;docker:///libmesos/ubuntu\u0026#34; }, \u0026#34;id\u0026#34;: \u0026#34;ubuntu\u0026#34;, \u0026#34;instances\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;cpus\u0026#34;: \u0026#34;.5\u0026#34;, \u0026#34;mem\u0026#34;: \u0026#34;512\u0026#34;, \u0026#34;uris\u0026#34;: [ ] } ä¿®æ­£ã—ãŸ JSON ã‚’ POST ã—ã¾ã™ã€‚\n% curl -X PUT -H \u0026#34;Content-Type: application/json\u0026#34; localhost:8080/v2/apps/ubuntu -d@ubuntu.json Tasks ã®ä¸€è¦§ã‚’å–å¾—ã— containers ãŒ 2 ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚\n% curl -X GET -H \u0026#34;Content-Type: application/json\u0026#34; localhost:8080/v2/apps {\u0026#34;apps\u0026#34;:[{\u0026#34;id\u0026#34;:\u0026#34;ubuntu\u0026#34;,\u0026#34;cmd\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;env\u0026#34;:{},\u0026#34;instances\u0026#34;:2,\u0026#34;cpus\u0026#34;:0.5,\u0026#34;mem\u0026#34;:512.0,\u0026#34;executor\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;constraints\u0026#34;:[],\u0026#34;uris\u0026#34;:[],\u0026#34;ports\u0026#34;:[17543],\u0026#34;taskRateLimit\u0026#34;:1.0,\u0026#34;container\u0026#34;:{\u0026#34;image\u0026#34;:\u0026#34;docker:///libmesos/ubuntu\u0026#34;,\u0026#34;options\u0026#34;:[]},\u0026#34;version\u0026#34;:\u0026#34;2014-06-13T02:40:04.536Z\u0026#34;,\u0026#34;tasksStaged\u0026#34;:3,\u0026#34;tasksRunning\u0026#34;:0}]} æœ€å¾Œã« Tasks ã‚’å‰Šé™¤ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\n% curl -X DELETE -H \u0026#34;Content-Type: application/json\u0026#34; localhost:8080/v2/apps/ubuntu Tasks ãŒå‰Šé™¤ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚\n% curl -X GET -H \u0026#34;Content-Type: application/json\u0026#34; localhost:8080/v2/apps {\u0026#34;apps\u0026#34;:[]} Marathon API v2 Marathon API v2 ã«ã¤ã„ã¦ä¸‹è¨˜ã® URL ã«ä»•æ§˜ãŒè¼‰ã£ã¦ã„ã¾ã™ã€‚ä¸Šè¨˜ã«è¨˜ã—ãŸã‚¯ã‚¨ãƒªä»¥å¤–ã«ã‚‚è‰²ã€…è¼‰ã£ã¦ã„ã‚‹ã®ã§ å‹•ä½œã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã¨ã„ã„ã¨æ€ã„ã¾ã™ã€‚\nhttps://github.com/mesosphere/marathon/blob/master/docs/api/http/REST_template.md\nã¾ã¨ã‚ ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆãŒå‡ºæ¥ã¾ã—ãŸã€‚ã¾ãŸå‹•ä½œç¢ºèªã‚‚ç„¡äº‹å‡ºæ¥ã¦ã„ã¾ã™ã€‚ ä»¥å‰è©¦ã—ãŸæ™‚ã‚ˆã‚Šã‚‚å¤§åˆ†ã€æ‰‹é †ãŒç°¡æ½”ã«ãªã£ãŸå°è±¡ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸå‚è€ƒè³‡æ–™ä¸­ã«\n\u0026ldquo;checkout our other multi-node tutorials on how to scale Docker in your data center.\u0026rdquo;\nã¨ã‚ã‚Šã¾ã™ãŒã€ã¾ã è¦‹ã¤ã‹ã£ã¦ã„ã¾ã›ã‚“(Â´ãƒ»Ï‰ãƒ»ï½€)è¦‹ã¤ã‹ã£ãŸæ–¹æ•™ãˆã¦ãã ã•ã„ãƒ¼ã€‚\nä»¥å‰è©¦ã—ãŸæ™‚ã¯ Mesos-Master ã®å†—é•·åŒ–ãŒå‡ºæ¥ãªã‹ã£ãŸã®ã§ä»Šå›ã“ã Multi Mesos-Masters, Multi Mesos-Slaves ã®æ§‹æˆã‚’ä½œã£ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nã¾ãŸä»Šæœˆï¼Ÿã«ãªã£ã¦ç¶šã€…ã¨ Docker ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’å„ç¤¾ãŒå…¬é–‹ã—ã¦ã„ã¾ã™ã€‚\ncenturion New Relic ãŒé–‹ç™ºã—ãŸã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã€‚ https://github.com/newrelic/centurion\nhelios Spotify ãŒé–‹ç™ºã—ãŸã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã€‚ https://github.com/spotify/helios\nfleet CoreOS æ¨™æº–æ­è¼‰ã€‚ https://github.com/coreos/fleet\ngeard RedHat ãŒ Red Hat Enterprise Linux Atomic Host ã«æ­è¼‰ã—ã¦ã„ã‚‹ãƒ„ãƒ¼ãƒ«ã€‚ http://openshift.github.io/geard/\nKubernetes Google ãŒé–‹ç™ºã—ãŸã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã€‚ https://github.com/GoogleCloudPlatform/kubernetes\nshipper Python ã®ã‚³ãƒ¼ãƒ‰ã§ Docker ã‚’ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‡ºæ¥ã‚‹ãƒ„ãƒ¼ãƒ«ã€‚ https://github.com/mailgun/shipper\nå¹¾ã¤ã‹è©¦ã—ãŸã®ã§ã™ãŒã€ã¾ã ã¾ã å‹•ãæ‰€ã¾ã§ã„ã‹ãªã„ãƒ„ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã—ãŸã€‚github ã® README ã«ã‚‚ \u0026ldquo;çµ¶è³›é–‹ç™ºä¸­ãªã®ã§ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒ¬ãƒ‡ã‚£ã§ã¯ãªã„\u0026rdquo; ã¨æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‹ã‚‰ã§ã—ã‚‡ã†ã€‚\n","permalink":"https://jedipunkz.github.io/post/2014/06/13/mesos-marathon-deimos-docker/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥å‰ Mesos, Docker ã«ã¤ã„ã¦è¨˜äº‹ã«ã—ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://jedipunkz.github.io/blog/2013/09/28/mesos-architecture-number-1/\"\u003ehttp://jedipunkz.github.io/blog/2013/09/28/mesos-architecture-number-1/\u003c/a\u003e\n\u003ca href=\"http://jedipunkz.github.io/blog/2013/10/01/methos-architecture-number-2-docker-on-mesos/\"\u003ehttp://jedipunkz.github.io/blog/2013/10/01/methos-architecture-number-2-docker-on-mesos/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eTwitter ã§ Docker é–¢é€£ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦å‘Ÿã„ã¦ã„ãŸã‚‰ @everpeace ã•ã‚“ã‹ã‚‰\nã“ã‚“ãªæƒ…å ±ã‚’ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cblockquote class=\"twitter-tweet\" lang=\"ja\"\u003e\u003cp\u003e\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e å…ƒã€…meos-dockerã£ã¦ã„ã†mesos executorãŒã‚ã£ãŸã‚“ã§ã™ã‘ã©ã€mesosãŒcontaineréƒ¨åˆ†ã‚’pluggableã«ã—ãŸã®ã§ã€ãã‚Œã«åˆã‚ã›ã¦deimosã£ã¦ã„ã†mesosç”¨ã®external containerizer ãŒä½œã‚‰ã‚Œã¾ã—ãŸã€‚\u003c/p\u003e\u0026mdash; Shingo Omura (@everpeace) \u003ca href=\"https://twitter.com/everpeace/statuses/476998842383347712\"\u003e2014, 6æœˆ 12\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\u003cp\u003eDeimos !!! çŸ¥ã‚‰ãªã‹ã£ãŸã€‚Mesos ã® Docker ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚‰ã—ãä¸‹è¨˜ã®å ´æ‰€ã«ã‚ã‚Šã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/mesosphere/deimos\"\u003ehttps://github.com/mesosphere/deimos\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eè‰²ã€…èª¿ã¹ã„ãŸã‚‰ã€ã“ã‚“ãªè³‡æ–™ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚ã©ã†ã‚„ã‚‰ã¾ã å…¬é–‹ã•ã‚Œã¦4æ—¥ã—ã‹çµŒã£ã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://mesosphere.io/learn/run-docker-on-mesosphere/\"\u003ehttp://mesosphere.io/learn/run-docker-on-mesosphere/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eMesos + Marathon + Deimos + Docker ã‚’ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã§æ§‹ç¯‰ã™ã‚‹æ‰‹é †ãŒæ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå†…å®¹ã¯ã»ã¼åŒã˜ã§ã™ãŒã€ä¸€å¿œè‡ªåˆ†ãŒã‚„ã£ã¦ã¿ã¦ç†è§£ã—ãŸã“ã¨ã‚’ã¾ã¨ã‚ãŸã„ã®ã§ä¸‹è¨˜ã«è¨˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹ç¯‰ã—ã¦ã¿ã‚‹\"\u003eæ§‹ç¯‰ã—ã¦ã¿ã‚‹\u003c/h2\u003e\n\u003cp\u003eæ‰‹é †ã‚’ã¾ã¨ã‚ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã—ã¾ã—ãŸã€‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ Ubuntu 13.10 ç”¨ã®ã‚ˆã†ã§ã™ãŒ 14.04 ã®ãƒ›ã‚¹ãƒˆ\nã§å®Ÿè¡Œå‡ºæ¥ã¾ã—ãŸã€‚14.04 ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã¾ã è¦‹ã¤ã‹ã£ã¦ã„ã¾ã›ã‚“ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e# disable ipv6\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;net.ipv6.conf.all.disable_ipv6 = 1\u0026#39;\u003c/span\u003e | sudo tee -a /etc/sysctl.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;net.ipv6.conf.default.disable_ipv6 = 1\u0026#39;\u003c/span\u003e | sudo tee -a /etc/sysctl.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo sysctl -p\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# install related tools\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt-get update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt-get -y install curl python-setuptools python-pip python-dev python-protobuf\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# install zookeeper\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt-get -y install zookeeperd\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e | sudo dd of\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/var/lib/zookeeper/myid\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# install docker\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt-get -y install docker.io\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo ln -sf /usr/bin/docker.io /usr/local/bin/docker\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo sed -i \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;$acomplete -F _docker docker\u0026#39;\u003c/span\u003e /etc/bash_completion.d/docker.io\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo docker pull libmesos/ubuntu\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# install mesos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl -fL http://downloads.mesosphere.io/master/ubuntu/13.10/mesos_0.19.0-xcon3_amd64.deb -o /tmp/mesos.deb\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo dpkg -i /tmp/mesos.deb\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo mkdir -p /etc/mesos-master\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho in_memory  | sudo dd of\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/etc/mesos-master/registry\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl -fL http://downloads.mesosphere.io/master/ubuntu/13.10/mesos_0.19.0-xcon3_amd64.egg -o /tmp/mesos.egg\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo easy_install /tmp/mesos.egg\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# install marathon\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl -fL http://downloads.mesosphere.io/marathon/marathon_0.5.0-xcon2_noarch.deb -o /tmp/marathon.deb\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo dpkg -i /tmp/marathon.deb\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# restart each services\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo service docker.io restart\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo service zookeeper restart\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo service mesos-master restart\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo service mesos-slave restart\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# install deimos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo pip install deimos\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo mkdir -p /etc/mesos-slave\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## Configure Deimos as a containerizer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho /usr/bin/deimos  | sudo dd of\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/etc/mesos-slave/containerizer_path\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho external     | sudo dd of\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/etc/mesos-slave/isolation\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ãƒ—ãƒ­ã‚»ã‚¹ã®ç¢ºèª\"\u003eãƒ—ãƒ­ã‚»ã‚¹ã®ç¢ºèª\u003c/h2\u003e\n\u003cp\u003eå®Ÿè¡ŒãŒçµ‚ã‚ã‚‹ã¨å„ãƒ—ãƒ­ã‚»ã‚¹ãŒç¢ºèªå‡ºæ¥ã¾ã™ã€‚ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã©ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒä½•ã‚’è¦‹ã¦ã„ã‚‹ã‹å¤§ä½“\nã‚ã‹ã‚Šã¾ã™ã®ã§è¦‹ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e","title":"Mesos + Marathon + Deimos + Docker ã‚’è©¦ã—ã¦ã¿ãŸ!"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\næœ€è¿‘ OpenStack ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹ç™ºï¼.. ã˜ã‚ƒãªãã¦ AWS ã§ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚µãƒ¼ãƒ“ã‚¹ä½œã£ ã¦ã„ã‚‹ã®ã§ã™ãŒã€Ruby ã§é–‹ç™ºã—ãŸã‹ã£ãŸã®ã§ Fog ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚EC2 ã¨ ELB ã® API ã‚’å©ãã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¤ã¤ã‚ã‚‹ã®ã§ã™ãŒã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã£ã¦ä¸–ã®ä¸­ã«ä¸­ã€…ç„¡ã„ã¨æ°— ãŒã¤ã„ãŸã®ã§ã€ã“ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã«ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’è¼‰ã›ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nFog ã¨ã¯ ? Fog http://fog.io/ ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ã€‚AWS, Rackspace, CloudStack, OpenStack .. ã¨æ•°ã‚ã‚‹ä¸–ã®ä¸­ã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’æ‰±ã†ãŸã‚ã« ç”¨æ„ã•ã‚ŒãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ã€‚å¯¾å¿œã—ã¦ã„ã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ç¨®åˆ¥ã¯ä¸‹è¨˜ã‚’è¦‹ã‚‹ã¨å‚ è€ƒã«ãªã‚Šã¾ã™ã€‚\nhttp://fog.io/about/provider_documentation.html\nãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã¾ã ã¾ã æƒã£ã¦ã„ãªãã€Fog ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦—ããªãŒã‚‰å®Ÿè£…ã™ã‚‹ã—ã‹ãªã„çŠ¶ æ³ã§ã™ã€‚ãªã®ã§ã€Œã“ã†ä½¿ãˆã°è‰¯ã„ï¼ã€ã¨ã„ã†ãŠæ‰‹æœ¬ãŒã‚ã¾ã‚Šãƒãƒƒãƒˆä¸Šã«ã‚‚ç„¡ã„æ°—ãŒã—ã¾ ã™ã€‚\nãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ä¸€å¿œä¸‹è¨˜ã«ã‚ã‚Šã¾ã™ã€‚ ãŒä½¿ã„æ–¹ãŒã‚ˆãã‚ã‹ã‚‰ãªã„ãƒ»ãƒ»ï¼(Â´ï¼›Ï‰ï¼›ï½€)ï¾Œï¾ï¾œï½¯\nhttp://rubydoc.info/gems/fog/frames/index\nEC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ã£ã¦ã¿ã‚‹ ã¾ãšã¯ AWS EC2 ã® API ã‚’å©ã„ã¦ t1.micro ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nrequire \u0026#39;fog\u0026#39; compute = Fog::Compute.new({ :provider =\u0026gt; \u0026#39;AWS\u0026#39;, :aws_access_key_id =\u0026gt; \u0026#39;....\u0026#39;, :aws_secret_access_key =\u0026gt; \u0026#39;....\u0026#39;, :region =\u0026gt; \u0026#39;ap-northeast-1\u0026#39; }) server = compute.servers.create( :image_id =\u0026gt; \u0026#39;ami-cedaa2bc\u0026#39;, :flavor_id =\u0026gt; \u0026#39;t1.micro\u0026#39;, :key_name =\u0026gt; \u0026#39;test_key\u0026#39;, :tags =\u0026gt; {\u0026#39;Name\u0026#39; =\u0026gt; \u0026#39;test\u0026#39;}, :groups =\u0026gt; \u0026#39;ssh-secgroup\u0026#39; ) server.wait_for { print \u0026#34;.\u0026#34;; ready? } puts \u0026#34;created instance name :\u0026#34;, server.dns_name è§£èª¬ compute = \u0026hellip; ã¨ã‚ã‚‹ã¨ã“ã‚ã§æ¥ç¶šæƒ…å ±ã‚’è¨˜ã—ã¦ã„ã¾ã™ã€‚ \u0026ldquo;ACCESS_KEY_ID\u0026rdquo; ã‚„ \u0026ldquo;SECRET_ACCESS_KEY\u0026rdquo; ã¯ã¿ãªã•ã‚“æ¥ç¶šã™ã‚‹æ™‚ã«ãŠæŒã¡ã§ã™ã‚ˆã­ã€‚ãã‚Œ ã¨ãƒªãƒ¼ã‚¸ãƒ§ãƒ³åã‚„ãƒ—ãƒ­ãƒã‚¤ãƒ€å (ã“ã“ã§ã¯ AWS) ã‚’è¨˜ã—ã¦ AWS ã® API ã«æ¥ç¶šã—ã¾ã™ã€‚\nserver = \u0026hellip; ã¨ã‚ã‚‹ã¨ã“ã‚ã§å®Ÿéš›ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚ ã“ã“ã§ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆã«å¿…è¦ãªæƒ…å ±ã‚’ç››ã‚Šè¾¼ã‚“ã§ã„ã¾ã™ã€‚Flavor åã‚„ AMI ã‚¤ãƒ¡ãƒ¼ ã‚¸åãƒ»SSH éµã®åå‰ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—åç­‰ã§ã™ã€‚\nä¾¿åˆ©ãªãƒ¡ã‚½ãƒƒãƒ‰ server = \u0026hellip; ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ã¨ä¾¿åˆ©ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ‰±ã£ã¦æƒ…å ±ã‚’èª­ã¿è¾¼ã‚€ã“ ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\nserver.dns_name # =\u0026gt; public ãª DNS åã‚’å–å¾— server.private_dns_name # =\u0026gt; private ãª DNS åã‚’å–å¾— server.id # =\u0026gt; ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ID ã‚’å–å¾— server.availability_zone # =\u0026gt; Availability Zone ã‚’å–å¾— server.public_ip_address # =\u0026gt; public ãª IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾— server.private_ip_address # =\u0026gt; private ãª IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾— ã“ã‚Œã¯ä¾¿åˆ©\u0026hellip;\nãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã—ã¦åˆ©ç”¨ +++\næ¯å›ã‚³ãƒ¼ãƒ‰ã®ä¸­ã§ã“ã‚Œã‚‰ã®æ¥ç¶šæƒ…å ±ã‚’æ›¸ãã®ã¯ã—ã‚“ã©ã„ã®ã§ã€Ruby ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œ ã‚Šã¾ã—ã‚‡ã†ã€‚\nmodule AWSCompute def self.connect() conn = Fog::Compute.new({ :provider =\u0026gt; \u0026#39;AWS\u0026#39;, :aws_access_key_id =\u0026gt; \u0026#39;...\u0026#39;, :aws_secret_access_key =\u0026gt; \u0026#39;...\u0026#39;, :region =\u0026gt; \u0026#39;...\u0026#39; }) begin yield conn ensure # conn.close end rescue Errno::ECONNREFUSED end end ã“ã†æ›¸ã„ã¦ãŠãã¨ä¾‹ãˆã°\u0026hellip;\nã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚¿ãƒ¼ãƒŸãƒã‚¤ãƒˆ AWSCompute.connect() do |sock| server = sock.servers.get(instance_id) server.destroy return server.id end ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®èµ·å‹• AWSCompute.connect() do |sock| server = sock.servers.get(instance_id) server.start return server.id end ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®åœæ­¢ AWSCompute.connect() do |sock| server = sock.servers.get(instance_id) server.stop return server.id end ç­‰ã¨å‡ºæ¥ã¾ã™ã€‚\nELB (Elastic LoadBalancer) ã‚’ä½¿ã£ã¦ã¿ã‚‹ åŒæ§˜ã« ELB ã‚’æ‰±ã†ã‚³ãƒ¼ãƒ‰ã®ã‚µãƒ³ãƒ—ãƒ«ã‚‚è¼‰ã›ã¦ãŠãã¾ã™ã€‚åŒã˜ããƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã—ã¦æ›¸ãã¨\nmodule AWSELB def self.connect() conn = Fog::AWS::ELB.new( :aws_access_key_id =\u0026gt; \u0026#39;...\u0026#39;, :aws_secret_access_key =\u0026gt; \u0026#39;...\u0026#39;, :region =\u0026gt; \u0026#39;...\u0026#39;, ) begin yield conn ensure # conn.close end rescue Errno::ECONNREFUSED end end ã¨ã—ã¦ãŠã„ã¦\u0026hellip;\nELB ã®æ–°è¦ä½œæˆ ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ ELB ã‚’æ–°è¦ä½œæˆå‡ºæ¥ã¾ã™ã€‚\nAWSELB.connect() do |sock| availability_zone = \u0026#39;...\u0026#39; elb_name = \u0026#39;...\u0026#39; listeners = [{ \u0026#34;Protocol\u0026#34; =\u0026gt; \u0026#34;HTTP\u0026#34;, \u0026#34;LoadBalancerPort\u0026#34; =\u0026gt; 80, \u0026#34;InstancePort\u0026#34; =\u0026gt; 80, \u0026#34;InstanceProtocol\u0026#34; =\u0026gt; \u0026#34;HTTP\u0026#34; }] result = sock.create_load_balancer(availability_zone, elb_name, listeners) p result end ã“ã®çŠ¶æ…‹ã§ã¯ ELB ã«å¯¾ã—ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒç´ä»˜ã‘ã‚‰ã‚Œã¦ã„ãªã„ã®ã§ä½¿ãˆã¾ã›ã‚“ã€‚ä¸‹è¨˜ã®æ“ä½œã§ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç´ä»˜ã‘ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nAWSELB.connect() do |sock| insntance_id = \u0026#39;...\u0026#39; elb_name = \u0026#39;...\u0026#39; result = sock.register_instances_with_load_balancer(instance_id, elbname) p result end insntance_id ã«ã¯ç´ä»˜ã‘ãŸã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã® ID ã‚’ã€elb_name ã«ã¯å…ˆã»ã©ä½œæˆã—ãŸ ELB ã®åå‰ã‚’ å…¥åŠ›ã—ã¾ã™ã€‚ ã“ã®æ“ä½œã‚’ç¹°ã‚Šè¿”ã›ã° AWS ä¸Šã«ã‚¯ãƒ©ã‚¹ã‚¿ãŒæ§‹æˆå‡ºæ¥ã¾ã™ã€‚\né€†ã«ã‚¯ãƒ©ã‚¹ã‚¿ã‹ã‚‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‰Šé™¤ã—ãŸã„å ´åˆã¯ä¸‹è¨˜ã®é€šã‚Šå®Ÿè¡Œã—ã¾ã™ã€‚\nAWSELB.connect() do |sock| result = sock.deregister_instances_from_load_balancer(instance_id, elbname) p result end ã¾ã¨ã‚ ä»Šå›ã¯ Fog ã‚’ç´¹ä»‹ã—ã¾ã—ãŸãŒ Python ä½¿ã„ã®æ–¹ã«ã¯ libcloud ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚\nhttps://libcloud.apache.org/\nApache ãƒ•ã‚¡ã‚¦ãƒ³ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒç®¡ç†ã—ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ã“ã¡ã‚‰ã‚‚è¤‡æ•°ã® ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚\nFog ã§ OpenStack ã‚‚æ“ä½œã—ãŸã“ã¨ãŒã‚ã‚‹ã®ã§ã™ãŒã€AWS ç”¨ã®ã‚³ãƒ¼ãƒ‰ã®æ–¹ãŒå®Œæˆåº¦ãŒé«˜ ã„ã®ã‹ã€æˆ»ã‚Šå€¤ãªã©ãŒç¶ºéº—ã«æ•´å½¢ã•ã‚Œã¦ã„ã¦æ‰±ã„ã‚„ã™ã‹ã£ãŸã‚Šã€ãƒ¡ã‚½ãƒƒãƒ‰ã‚‚è±Šå¯Œã«ç”¨æ„ ã•ã‚Œã¦ã„ãŸã‚Šã¨ã„ã†å°è±¡ã§ã—ãŸã€‚ã“ã‚Œã¯\u0026hellip; OpenStack ç”¨ã® Fog ã‚³ãƒ¼ãƒ‰ã«ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ ãƒˆã™ã‚‹ãƒãƒ£ãƒ³ã‚¹ãƒ»ãƒ»ï¼\nçš†ã•ã‚“ã‚‚ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ãŠæŒã¡ã§ã—ãŸã‚‰ã€ãƒ–ãƒ­ã‚°ç­‰ã§å…¬é–‹ã—ã¦ã„ãã¾ã—ã‚‡ã†ãƒ¼ã€‚ ã§ã¯ã§ã¯ã€‚\n","permalink":"https://jedipunkz.github.io/post/2014/05/29/fog-aws-ec2-elb/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€è¿‘ OpenStack ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹ç™ºï¼.. ã˜ã‚ƒãªãã¦ AWS ã§ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚µãƒ¼ãƒ“ã‚¹ä½œã£\nã¦ã„ã‚‹ã®ã§ã™ãŒã€Ruby ã§é–‹ç™ºã—ãŸã‹ã£ãŸã®ã§ Fog ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚EC2 ã¨ ELB ã®\nAPI ã‚’å©ãã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¤ã¤ã‚ã‚‹ã®ã§ã™ãŒã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã£ã¦ä¸–ã®ä¸­ã«ä¸­ã€…ç„¡ã„ã¨æ°—\nãŒã¤ã„ãŸã®ã§ã€ã“ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã«ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’è¼‰ã›ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"fog-ã¨ã¯-\"\u003eFog ã¨ã¯ ?\u003c/h2\u003e\n\u003cp\u003eFog \u003ca href=\"http://fog.io/\"\u003ehttp://fog.io/\u003c/a\u003e ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ã€‚AWS, Rackspace,\nCloudStack, OpenStack .. ã¨æ•°ã‚ã‚‹ä¸–ã®ä¸­ã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’æ‰±ã†ãŸã‚ã«\nç”¨æ„ã•ã‚ŒãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ã€‚å¯¾å¿œã—ã¦ã„ã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ç¨®åˆ¥ã¯ä¸‹è¨˜ã‚’è¦‹ã‚‹ã¨å‚\nè€ƒã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://fog.io/about/provider_documentation.html\"\u003ehttp://fog.io/about/provider_documentation.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã¾ã ã¾ã æƒã£ã¦ã„ãªãã€Fog ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦—ããªãŒã‚‰å®Ÿè£…ã™ã‚‹ã—ã‹ãªã„çŠ¶\næ³ã§ã™ã€‚ãªã®ã§ã€Œã“ã†ä½¿ãˆã°è‰¯ã„ï¼ã€ã¨ã„ã†ãŠæ‰‹æœ¬ãŒã‚ã¾ã‚Šãƒãƒƒãƒˆä¸Šã«ã‚‚ç„¡ã„æ°—ãŒã—ã¾\nã™ã€‚\u003c/p\u003e\n\u003cp\u003eãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ä¸€å¿œä¸‹è¨˜ã«ã‚ã‚Šã¾ã™ã€‚\nãŒä½¿ã„æ–¹ãŒã‚ˆãã‚ã‹ã‚‰ãªã„ãƒ»ãƒ»ï¼(Â´ï¼›Ï‰ï¼›ï½€)ï¾Œï¾ï¾œï½¯\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://rubydoc.info/gems/fog/frames/index\"\u003ehttp://rubydoc.info/gems/fog/frames/index\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"ec2-ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ã£ã¦ã¿ã‚‹\"\u003eEC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ã£ã¦ã¿ã‚‹\u003c/h2\u003e\n\u003cp\u003eã¾ãšã¯ AWS EC2 ã® API ã‚’å©ã„ã¦ t1.micro ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-ruby\" data-lang=\"ruby\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erequire \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;fog\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecompute \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFog\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eCompute\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003enew({\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e:provider\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;AWS\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e:aws_access_key_id\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;....\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e:aws_secret_access_key\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;....\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e:region\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ap-northeast-1\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e})\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eserver \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e compute\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eservers\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ecreate(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e:image_id\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ami-cedaa2bc\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e:flavor_id\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;t1.micro\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e:key_name\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;test_key\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e:tags\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e {\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Name\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;test\u0026#39;\u003c/span\u003e},\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e:groups\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ssh-secgroup\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eserver\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewait_for { print \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;.\u0026#34;\u003c/span\u003e; ready? }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eputs \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;created instance name :\u0026#34;\u003c/span\u003e, server\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edns_name\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"è§£èª¬\"\u003eè§£èª¬\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003ecompute = \u0026hellip; ã¨ã‚ã‚‹ã¨ã“ã‚ã§æ¥ç¶šæƒ…å ±ã‚’è¨˜ã—ã¦ã„ã¾ã™ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u0026ldquo;ACCESS_KEY_ID\u0026rdquo; ã‚„ \u0026ldquo;SECRET_ACCESS_KEY\u0026rdquo; ã¯ã¿ãªã•ã‚“æ¥ç¶šã™ã‚‹æ™‚ã«ãŠæŒã¡ã§ã™ã‚ˆã­ã€‚ãã‚Œ\nã¨ãƒªãƒ¼ã‚¸ãƒ§ãƒ³åã‚„ãƒ—ãƒ­ãƒã‚¤ãƒ€å (ã“ã“ã§ã¯ AWS) ã‚’è¨˜ã—ã¦ AWS ã® API ã«æ¥ç¶šã—ã¾ã™ã€‚\u003c/p\u003e","title":"ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒª Fog ã§ AWS ã‚’æ“ä½œï¼..ã®ã‚µãƒ³ãƒ—ãƒ«"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nã¾ãŸã¾ãŸ OpenStack ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ã©ã†ã™ã‚‹ã‹ï¼Ÿã«ã¤ã„ã¦ã§ã™ã€‚\nä»Šã¾ã§è‡ªåˆ†ã®ä¸­ã§ã¯ Rackspace Private Cloud ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ Rackspace ç®¡ç†ã® rcbops/chef-cookbooks ãŒä»Šç¾åœ¨ä½¿ã†ãªã‚‰ãƒ™ã‚¹ãƒˆã®é¸æŠã ã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚ã“ã‚Œã¯å†… éƒ¨ã§ Chef ãŒä½¿ã‚ã‚Œã¦ã„ã¦ã—ã‹ã‚‚ Cookbooks ãŒ Github ä¸Šã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚ Apache ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§ä½¿ãˆã‚‹ã®ã§ã€ã‚µãƒ¼ãƒ“ã‚¹æ§‹ç¯‰ã«ã‚‚ä½¿ãˆã¡ã‚ƒã†ã¨ã„ã†ãƒ¢ãƒã€‚\nå…ˆæ—¥ã€ã‚ã‚‹ OpenStack ã‚³ã‚¢ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã®æ–¹ã‹ã‚‰ã€Œjedipunkz ã•ã‚“ã€ã‚„ã£ã±ã‚Š rcbops ãŒã„ã„ã§ã™ã‹ï¼Ÿé‹å–¶ã¨ã‹ã©ã†ãªã£ã¦ã„ã‚‹ã‚“ã§ã—ã‚‡ã†ï¼Ÿãƒãƒ¼ã‚¸ã®è¦æº–ã¨ã‹ã©ã†ãªã®ã‹ãªï¼Ÿã€ ã¨è³ªå•å—ã‘ã¾ã—ãŸã€‚ç¢ºã‹ã«ãƒãƒ¼ã‚¸ã®åŸºæº–ã¯ Rackspace Private Cloud ãŒãƒ™ãƒ¼ã‚¹ã«ãªã‚Š ã¾ã™ã—ã€ç®¡ç†ã—ã¦ã„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ä¸€è¦§ã‚’è¦‹ã¦ã„ã‚‹ã¨ Rackspace ç¤¾ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒãƒ¡ ã‚¤ãƒ³ã§ã™ã—ã€ä»Šå¾Œã©ã†ãªã‚‹ã®ã‹åˆ†ã‹ã‚‰ãªã„\u0026hellip;ã€‚\né€ƒã’é“ã¯ç”¨æ„ã—ãŸã»ã†ãŒè‰¯ã•ãã†ã€‚\nã¨ã„ã†ã“ã¨ã§ã€ä»¥å‰è‡ªåˆ†ã‚‚æš‘ã‹ã£ãŸã“ã¨ã®ã‚ã‚‹ StackForge ã® openstack-chef-repo ã‚’ä¹…ã€…ã«ä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚Icehouse æ§‹æˆãŒã“ã®æ™‚ç‚¹ã§æ—¢ã«çµ„ã‚ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¦ã€ ä»¥å‰ã‚ˆã‚Šã ã„ã€œã¶å®Œæˆåº¦å¢—ã—ãŸæ„ŸãŒã‚ã‚Šã¾ã™ã€‚ä»Šå›ã¯ nova-network æ§‹æˆã‚’ä½œã£ã¦ã¿ãŸ ã®ã§ã™ãŒã€Neutron æ§‹æˆã‚‚ã‚‚ã¡ã‚ã‚“å‡ºæ¥ãã†ãªã®ã§å¾Œã«èª¿ã¹ã¦ã¾ãŸå…¬é–‹ã—ãŸã„ã§ã™ã€‚\nStackForge ã¨ã¯ StackForge ã¯ OpenStack ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»CI ã®ä»•çµ„ã¿ã¨ã—ã¦å…¬å¼ã«ç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹ã‚‚ã®ã€‚ å…¬å¼ã‚µã‚¤ãƒˆã¯ä¸‹è¨˜ã®å ´æ‰€ã«ã‚ã‚‹ã€‚\nhttp://ci.openstack.org/stackforge.html\nStackForge ã® openstack-chef-repo ã¯ä¸‹è¨˜ã®å ´æ‰€ã«ã‚ã‚‹ã€‚\nhttps://github.com/stackforge/openstack-chef-repo\nopenstack-chef-repo ã¯ã¾ã  \u0026lsquo;stable/icehouse\u0026rsquo; ãƒ–ãƒ©ãƒ³ãƒãŒç”Ÿæˆã•ã‚Œã¦ã„ãªã„ã€‚ãŒç›´ ã¡ã« master ã‹ã‚‰ãƒ–ãƒ©ãƒ³ãƒãŒåˆ‡ã‚‰ã‚Œã‚‹æ§˜å­ã€‚\nç›®çš„ StackForge ã® openstack-chef-repo ã‚’ç”¨ã„ã¦ Icehouse ãƒªãƒªãƒ¼ã‚¹ç‰ˆã® OpenStack ã‚’ ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®æ–¹æ³•ã‚’è¨˜ã™ã€‚ä»Šå›ã¯æœªã  \u0026lsquo;stable/icehouse\u0026rsquo; ãƒ–ãƒ©ãƒ³ãƒãŒç„¡ã„ã®ã§ master ãƒ–ãƒ©ãƒ³ãƒã‚’ç”¨ã„ã¦ Icehouse ãƒªãƒªãƒ¼ã‚¹ç‰ˆ OpenStack ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚\næ§‹æˆ æ§‹æˆã¯ã“ã‚“ãªæ„Ÿã˜ã€‚\n+-----------------+ | GW Router | +--+-----------------+ | | | +-------------------+-------------------+-------------------------------------- | |eth0 |eth0 |eth0 VM Network (fixed) | +-----------------+ +-----------------+ +-----------------+ +-----------------+ | | Controller Node | | Compute Node | | Compute Node | | Chef Workstation| | +-----------------+ +-----------------+ +-----------------+ +-----------------+ | |eth1 |eth1 |eth1 | +--+-------------------+-------------------+-------------------+------------------ API/Management Network Nova-Network æ§‹æˆ ä»Šå›ã¯ fixed network ç”¨ã® NIC ã‚’ eth0(ç‰©ç† NIC) ã«ã‚¢ã‚µã‚¤ãƒ³ fixed network ç”¨ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã«ã™ã‚‹ API/Management Network å´ã«å…¨ã¦ã® API ã‚’å‡ºã™ã€‚ã¾ãŸã“ã“ã‹ã‚‰ The Internet ã«è¿‚å›å‡ºæ¥ã‚‹ã‚ˆã†ã«ã™ã‚‹ VM Network ã‚‚ GW ã‚’ä»‹ã—ã¦ The Internet ã¸è¿‚å›å‡ºæ¥ã‚‹ã‚ˆã†ã«ã™ã‚‹ å…¨ã¦ã®æ“ä½œã¯ \u0026lsquo;Chef Workstaion\u0026rsquo; ã‹ã‚‰è¡Œã† Compute ãƒãƒ¼ãƒ‰ã¯ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã®è¨±ã™é™ã‚Šä½•å°ã§ã‚‚å¯ IP ä¸€è¦§ (ã“ã®è¨˜äº‹ã§ã®ä¾‹)\nController : 10.200.9.46 (eth0), 10.200.10.46 (eth1) Compute : 10.200.9.47 (eth0), 10.200.10.47 (eth1) Compute : 10.200.9.48 (eth0), 10.200.10.48 (eth1) æ‰‹é † openstack-chef-repo ã‚’ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒ‰ä¸Šã§å–å¾—ã™ã‚‹ã€‚\n% git clone https://github.com/stackforge/openstack-chef-repo.git % cd openstack-chef-repo Berksfile ãŒã‚ã‚‹ã®ã§ã“ã‚Œã‚’ç”¨ã„ã¦ Chef Cookbooks ã‚’å–å¾—ã™ã‚‹ã€‚\n% berks install --path=./cookbooks Roles, Cookbooks ã‚’ Chef ã‚µãƒ¼ãƒã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚\n% knife cookbook upload -o cookbooks -a % knife role from file roles/*.rb 1 Environment ã«å¯¾ã—ã¦ 1 OpenStack ã‚¯ãƒ©ã‚¹ã‚¿ã§ã‚ã‚‹ã€‚ä»Šå›æ§‹ç¯‰ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ã®ãŸã‚ ã® Environment ã‚’ä½œæˆã™ã‚‹ã€‚\nä¸‹è¨˜ã‚’ environments/icehouse-nova-network.rb ã¨ã—ã¦ç”Ÿæˆã™ã‚‹ã€‚\nname \u0026#34;icehouse-nova-network\u0026#34; description \u0026#34;separated nodes environment\u0026#34; override_attributes( \u0026#34;release\u0026#34; =\u0026gt; \u0026#34;icehouse\u0026#34;, \u0026#34;osops_networks\u0026#34; =\u0026gt; { \u0026#34;management\u0026#34; =\u0026gt; \u0026#34;10.200.10.0/24\u0026#34;, \u0026#34;public\u0026#34; =\u0026gt; \u0026#34;10.200.10.0/24\u0026#34;, \u0026#34;nova\u0026#34; =\u0026gt; \u0026#34;10.200.10.0/24\u0026#34; }, \u0026#34;mysql\u0026#34; =\u0026gt; { \u0026#34;bind_address\u0026#34; =\u0026gt; \u0026#34;0.0.0.0\u0026#34;, \u0026#34;root_network_acl\u0026#34; =\u0026gt; \u0026#34;%\u0026#34;, \u0026#34;allow_remote_root\u0026#34; =\u0026gt; true, \u0026#34;server_root_password\u0026#34; =\u0026gt; \u0026#34;secrete\u0026#34;, \u0026#34;server_repl_password\u0026#34; =\u0026gt; \u0026#34;secrete\u0026#34;, \u0026#34;server_debian_password\u0026#34; =\u0026gt; \u0026#34;secrete\u0026#34; }, \u0026#34;nova\u0026#34; =\u0026gt; { \u0026#34;network\u0026#34; =\u0026gt; { \u0026#34;fixed_range\u0026#34; =\u0026gt; \u0026#34;172.18.0.0/24\u0026#34;, \u0026#34;public_interface\u0026#34; =\u0026gt; \u0026#34;eth0\u0026#34; } }, \u0026#34;rabbitmq\u0026#34; =\u0026gt; { \u0026#34;address\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;5672\u0026#34; }, \u0026#34;openstack\u0026#34; =\u0026gt; { \u0026#34;developer_mode\u0026#34; =\u0026gt; true, \u0026#34;compute\u0026#34; =\u0026gt; { \u0026#34;rabbit\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34; }, \u0026#34;novnc_proxy\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34; }, \u0026#34;libvirt\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34; }, \u0026#34;network\u0026#34; =\u0026gt; { \u0026#34;fixed_range\u0026#34; =\u0026gt; \u0026#34;10.200.9.0/24\u0026#34; }, \u0026#34;rabbit_server_chef_role\u0026#34; =\u0026gt; \u0026#34;os-ops-messaging\u0026#34;, \u0026#34;networks\u0026#34; =\u0026gt; [ { \u0026#34;label\u0026#34; =\u0026gt; \u0026#34;private\u0026#34;, \u0026#34;ipv4_cidr\u0026#34; =\u0026gt; \u0026#34;10.200.9.0/24\u0026#34;, \u0026#34;num_networks\u0026#34; =\u0026gt; \u0026#34;1\u0026#34;, \u0026#34;network_size\u0026#34; =\u0026gt; \u0026#34;255\u0026#34;, \u0026#34;bridge\u0026#34; =\u0026gt; \u0026#34;br200\u0026#34;, \u0026#34;bridge_dev\u0026#34; =\u0026gt; \u0026#34;eth0\u0026#34;, \u0026#34;dns1\u0026#34; =\u0026gt; \u0026#34;8.8.8.8\u0026#34;, \u0026#34;dns2\u0026#34; =\u0026gt; \u0026#34;8.8.4.4\u0026#34;, \u0026#34;multi_host\u0026#34; =\u0026gt; \u0026#34;T\u0026#34; } ] }, \u0026#34;identity\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34;, \u0026#34;users\u0026#34; =\u0026gt; { \u0026#34;demo\u0026#34; =\u0026gt; { \u0026#34;password\u0026#34; =\u0026gt; \u0026#34;demo\u0026#34;, \u0026#34;default_tenant\u0026#34; =\u0026gt; \u0026#34;service\u0026#34;, \u0026#34;roles\u0026#34; =\u0026gt; { \u0026#34;Member\u0026#34; =\u0026gt; [ \u0026#34;Member\u0026#34; ] } } } }, \u0026#34;image\u0026#34; =\u0026gt; { \u0026#34;api\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34; }, \u0026#34;debug\u0026#34; =\u0026gt; true, \u0026#34;identity_service_chef_role\u0026#34; =\u0026gt; \u0026#34;os-identity\u0026#34;, \u0026#34;rabbit_server_chef_role\u0026#34; =\u0026gt; \u0026#34;os-ops-messaging\u0026#34;, \u0026#34;registry\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34; }, \u0026#34;syslog\u0026#34; =\u0026gt; { \u0026#34;use\u0026#34; =\u0026gt; false }, \u0026#34;upload_image\u0026#34; =\u0026gt; { \u0026#34;cirros\u0026#34; =\u0026gt; \u0026#34;http://hypnotoad/cirros-0.3.0-x86_64-disk.img\u0026#34;, }, \u0026#34;upload_images\u0026#34; =\u0026gt; [ \u0026#34;cirros\u0026#34; ] }, \u0026#34;network\u0026#34; =\u0026gt; { \u0026#34;api\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34;, } }, \u0026#34;db\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34;, \u0026#34;compute\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34; }, \u0026#34;identity\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34; }, \u0026#34;image\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34; }, \u0026#34;network\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34; }, \u0026#34;volume\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34; }, \u0026#34;dashboard\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34; } }, \u0026#34;mq\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34;, \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;user\u0026#34; =\u0026gt; \u0026#34;guest\u0026#34;, \u0026#34;vhost\u0026#34; =\u0026gt; \u0026#34;/nova\u0026#34;, \u0026#34;servers\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;compute\u0026#34; =\u0026gt; { \u0026#34;service_type\u0026#34; =\u0026gt; \u0026#34;rabbitmq\u0026#34;, \u0026#34;rabbit\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;5672\u0026#34; } }, \u0026#34;block-storage\u0026#34; =\u0026gt; { \u0026#34;service_type\u0026#34; =\u0026gt; \u0026#34;rabbitmq\u0026#34;, \u0026#34;rabbit\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;5672\u0026#34; } } }, \u0026#34;endpoints\u0026#34; =\u0026gt; { \u0026#34;compute-api-bind\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8774\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v2/%(tenant_id)s\u0026#34; }, \u0026#34;compute-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8774\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v2/%(tenant_id)s\u0026#34; }, \u0026#34;compute-ec2-admin-bind\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8773\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/services/Admin\u0026#34; }, \u0026#34;compute-ec2-admin\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8773\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/services/Admin\u0026#34; }, \u0026#34;compute-ec2-api-bind\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8773\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/services/Cloud\u0026#34; }, \u0026#34;compute-ec2-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8773\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/services/Cloud\u0026#34; }, \u0026#34;compute-xvpvnc-bind\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;6081\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/console\u0026#34; }, \u0026#34;compute-xvpvnc\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;6081\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/console\u0026#34; }, \u0026#34;compute-novnc-bind\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;6080\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/vnc_auto.html\u0026#34; }, \u0026#34;compute-novnc\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;6080\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/vnc_auto.html\u0026#34; }, \u0026#34;compute-vnc\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;0.0.0.0\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;6080\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/vnc_auto.html\u0026#34; }, \u0026#34;image-api-bind\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;9292\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v2\u0026#34; }, \u0026#34;image-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;9292\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v2\u0026#34; }, \u0026#34;image-registry-bind\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;9191\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v2\u0026#34; }, \u0026#34;image-registry\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;9191\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v2\u0026#34; }, \u0026#34;identity-bind\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;5000\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v2.0\u0026#34; }, \u0026#34;identity-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;5000\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v2.0\u0026#34; }, \u0026#34;identity-admin\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;35357\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v2.0\u0026#34; }, \u0026#34;volume-api-bind\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8776\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v1/%(tenant_id)s\u0026#34; }, \u0026#34;block-storage-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8776\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v1/%(tenant_id)s\u0026#34; }, \u0026#34;telemetry-api-bind\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8777\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v1\u0026#34; }, \u0026#34;telemetry-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8777\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v1\u0026#34; }, \u0026#34;network-api-bind\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;9696\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v2\u0026#34; }, \u0026#34;network-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;9696\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v2\u0026#34; }, \u0026#34;orchestration-api-bind\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8004\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v1/%(tenant_id)s\u0026#34; }, \u0026#34;orchestration-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8004\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v1/%(tenant_id)s\u0026#34; }, \u0026#34;orchestration-api-cfn-bind\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8000\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v1\u0026#34; }, \u0026#34;orchestration-api-cfn\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.200.10.46\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;8000\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/v1\u0026#34; }, \u0026#34;mq\u0026#34; =\u0026gt; { \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;5672\u0026#34; } } } ) ç”Ÿæˆã—ãŸ environment ã‚’ Chef ã‚µãƒ¼ãƒã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚\n% knife environment from file environments/icehouse-nova-network.rb Spiceweasel ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚Spiceweasel ã¯ yml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã« knife ã®æ“ä½œ ã‚’æ›¸ãå‡ºã—ã¦ã€ã¾ãŸãã‚Œã‚’ä¸€æ°—ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚\n% gem install spiceweasel --no-ri --no-rdoc % rbenv rehash infrastructure.yml ã‚’ä¸‹è¨˜ã®é€šã‚Šä¿®æ­£ã™ã‚‹ã€‚\nberksfile: options: \u0026#39;--no-freeze --halt-on-frozen\u0026#39; cookbooks: - apache2: - apt: - aws: - build-essential: - chef_handler: - database: - dmg: - erlang: - git: - homebrew: - iptables: - logrotate: - memcached: - mysql: - openssl: - openstack-block-storage: - openstack-common: - openstack-compute: - openstack-dashboard: - openstack-identity: - openstack-image: - openstack-network: - openstack-object-storage: - openstack-ops-messaging: - openstack-ops-database: - openstack-orchestration: - openstack-telemetry: - pacman: - postgresql: - python: - rabbitmq: - runit: - selinux: - statsd: - windows: - xfs: - yum: - yum-epel: - yum-erlang_solutions: roles: - allinone-compute: - os-compute-single-controller: - os-base: - os-ops-caching: - os-ops-messaging: - os-ops-database: - os-block-storage: - os-block-storage-api: - os-block-storage-scheduler: - os-block-storage-volume: - os-client: - os-compute-api: - os-compute-api-ec2: - os-compute-api-metadata: - os-compute-api-os-compute: - os-compute-cert: - os-compute-conductor: - os-compute-scheduler: - os-compute-setup: - os-compute-vncproxy: - os-compute-worker: - os-dashboard: - os-identity: - os-image: - os-image-api: - os-image-registry: - os-image-upload: - os-telemetry-agent-central: - os-telemetry-agent-compute: - os-telemetry-api: - os-telemetry-collector: - os-network: - os-network-server: - os-network-l3-agent: - os-network-dhcp-agent: - os-network-metadata-agent: - os-network-openvswitch: - os-object-storage: - os-object-storage-account: - os-object-storage-container: - os-object-storage-management: - os-object-storage-object: - os-object-storage-proxy: environments: - icehouse-nova-network: nodes: - 10.200.10.46: run_list: role[os-compute-single-controller] options: -N opstall01 -E icehouse-nova-network --sudo -x thirai - 10.200.10.47: run_list: role[os-compute-worker] options: -N opstall02 -E icehouse-nova-network --sudo -x thirai - 10.200.10.48: run_list: role[os-compute-worker] options: -N opstall03 -E icehouse-nova-network --sudo -x thirai â€» nodes: é …ã«ã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„ãƒãƒ¼ãƒ‰ã¨ Roles ã‚’å‰²ã‚Šå½“ã¦åˆ—æŒ™ã™ã‚‹ã€‚\nspiceweasel ã‚’å®Ÿè¡Œã™ã‚‹ã€‚ã“ã®æ™‚ç‚¹ã§ã¯ã“ã‚Œã‹ã‚‰å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰ã®ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œ ã‚‹ã®ã¿ã§ã‚ã‚‹ã€‚\n% spiceweasel infrastructure.yml berks upload --no-freeze --halt-on-frozen -b ./Berksfile knife cookbook upload apache2 apt aws build-essential chef_handler database dmg erlang git homebrew iptables logrotate memcached mysql openssl openstack-block-storage openstack-common openstack-compute openstack-dashboard openstack-identity openstack-image openstack-network openstack-object-storage openstack-ops-messaging openstack-ops-database openstack-orchestration openstack-telemetry pacman postgresql python rabbitmq runit selinux statsd windows xfs yum yum-epel yum-erlang_solutions knife environment from file separated.rb knife role from file allinone-compute.rb os-base.rb os-block-storage-api.rb os-block-storage-scheduler.rb os-block-storage-volume.rb os-block-storage.rb os-client.rb os-compute-api-ec2.rb os-compute-api-metadata.rb os-compute-api-os-compute.rb os-compute-api.rb os-compute-cert.rb os-compute-conductor.rb os-compute-scheduler.rb os-compute-setup.rb os-compute-single-controller.rb os-compute-vncproxy.rb os-compute-worker.rb os-dashboard.rb os-identity.rb os-image-api.rb os-image-registry.rb os-image-upload.rb os-image.rb os-network-dhcp-agent.rb os-network-l3-agent.rb os-network-metadata-agent.rb os-network-openvswitch.rb os-network-server.rb os-network.rb os-object-storage-account.rb os-object-storage-container.rb os-object-storage-management.rb os-object-storage-object.rb os-object-storage-proxy.rb os-object-storage.rb os-ops-caching.rb os-ops-database.rb os-ops-messaging.rb os-telemetry-agent-central.rb os-telemetry-agent-compute.rb os-telemetry-api.rb os-telemetry-collector.rb knife bootstrap 10.200.10.46 -N opstall01 -E separated --sudo -x thirai -r \u0026#39;role[os-compute-single-controller]\u0026#39; knife bootstrap 10.200.10.47 -N opstall02 -E separated --sudo -x thirai -r \u0026#39;role[os-compute-worker]\u0026#39; knife bootstrap 10.200.10.48 -N opstall03 -E separated --sudo -x thirai -r \u0026#39;role[os-compute-worker]\u0026#39; -e ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸ã™ã‚‹ã¨å®Ÿéš›ã«ã“ã‚Œã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚å®Ÿè¡Œã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ã€‚\n% spiceweasel -e infrastructure.yml ã“ã®æ™‚ç‚¹ã§ã€ä¸‹è¨˜ã®æ“ä½œã‚‚è¡Œã‚ã‚Œã‚‹ã€‚\nNova-Network ä¸Šã«ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç”Ÿæˆ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨ç™»éŒ² (Environment ã«è¨˜ã—ãŸãƒ¢ãƒ) Cinder ã®è¨­å®š ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã—ãŸã¨ã“ã‚ã§ cinder-volume ãƒ—ãƒ­ã‚»ã‚¹ã¯ç¨¼åƒã—ã¦ã„ã‚‹ãŒç‰©ç†ãƒ‡ã‚£ã‚¹ã‚¯ã® ã‚¢ã‚µã‚¤ãƒ³ãŒæ¸ˆã‚“ã§ã„ãªã„ã€‚ã“ã‚Œã¯ Chef ã§ã¯æŒ‡å®šå‡ºæ¥ãªã„ã®ã§æ‰‹å‹•ã§è¡Œã†ã€‚\näºˆã‚ Cinder ç”¨ã®ç‰©ç†ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ Controller ãƒãƒ¼ãƒ‰ã«ä»˜ä¸ã™ã‚‹ã€‚(ã“ã“ã§ã¯ /dev/sdb1)\ncontroller% sudo -i controller# pvcreate /dev/sdb1 controller# vgcreate cinder-volumes /dev/sdb1 controller# service cinder-volume restart ã“ã‚Œã§å®Œäº†ã€‚\nä½¿ã£ã¦ã¿ã‚‹ ã§ã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸ OpenStack ã‚’ä½¿ã£ã¦ä»®æƒ³ãƒã‚·ãƒ³ã‚’ä½œã£ã¦ã¿ã‚‹ã€‚\ncontroller% sudo -i controller# source openrc controller# nova keypair-add novakey01 \u0026gt; novakey01 controller# chmod 400 novakey01 controller# nova boot --image cirros --flavor 1 --key_name novakey01 cirros01 controller# nova list +--------------------------------------+----------+--------+------------+-------------+--------------------+ | ID | Name | Status | Task State | Power State | Networks | +--------------------------------------+----------+--------+------------+-------------+--------------------+ | e6687359-1aef-4105-a8db-894600001610 | cirros01 | ACTIVE | - | Running | private=10.200.9.2 | +--------------------------------------+----------+--------+------------+-------------+--------------------+ controller# ssh -i novakey01 -l cirros 10.200.9.2 vm# ping www.goo.ne.jp ä»®æƒ³ãƒã‚·ãƒ³ãŒç”Ÿæˆã•ã‚Œ The Internet ã«å¯¾ã—ã¦é€šä¿¡ãŒè¡ŒãˆãŸã“ã¨ã‚’ç¢ºèªã€‚\næ¬¡ã«ä»®æƒ³ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ç”Ÿæˆã—ã¦ä¸Šè¨˜ã§ä½œæˆã—ãŸä»®æƒ³ãƒã‚·ãƒ³ã«ä»˜ä¸ã™ã‚‹ã€‚\ncontroller# cinder create --display-name vol01 1 +--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+ | ID | Status | Display Name | Size | Volume Type | Bootable | Attached to | +--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+ | 0f3726a0-c2f5-45bc-bcf2-1f6eb746f5c8 | available | vol02 | 1 | None | false | b286387c-2311-4134-ab59-850fee3e4650 | +--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+ controller# nova volume-attach e6687359-1aef-4105-a8db-894600001610 0f3726a0-c2f5-45bc-bcf2-1f6eb746f5c8 auto controller# ssh -i novakey01 -l cirros 10.200.9.2 vm# mkfs.ext4 /dev/vdb vm# mount -t ext4 /dev/vdb /mnt vm# df -h | grep mnt /dev/vdb 976M 1.3M 908M 1% /mnt ä»®æƒ³ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ä»®æƒ³ãƒã‚·ãƒ³ã«ä»˜ä¸ã—ãƒã‚¦ãƒ³ãƒˆã§ãã‚‹ã“ã¨ã‚’ç¢ºèªå‡ºæ¥ãŸã€‚\nã¾ã¨ã‚ ä»Šå›ã¯ Nova-Network æ§‹æˆã® Icehouse ã‚’æ§‹ç¯‰å‡ºæ¥ãŸã€‚Nova-Network ã¯ Havana ã§ã‚µãƒãƒ¼ãƒˆçµ‚äº†ã¨ã®è©±ãŒå»¶æœŸ ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã¯èã„ã¦ã„ãŸãŒ Icehouse ã§ã‚‚ã—ã£ã‹ã‚Šå‹•ã„ã¦ã„ã‚‹ã€‚ã¾ãŸå¾Œã« Neutron æ§‹æˆã‚‚èª¿æŸ»ã‚’è¡Œã†ã€‚ Neutron æ§‹æˆã¯ä¸‹è¨˜ã® Environments ã‚’å‚è€ƒã«ã™ã‚‹ã¨å‹•ä½œã™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚\nhttps://github.com/stackforge/openstack-chef-repo/blob/master/environments/vagrant-multi-neutron.json\nã‚­ãƒ¼ã¨ãªã‚‹ã®ã¯ã€\n\u0026#34;network\u0026#34;: { \u0026#34;debug\u0026#34;: \u0026#34;True\u0026#34;, \u0026#34;dhcp\u0026#34;: { \u0026#34;enable_isolated_metadata\u0026#34;: \u0026#34;True\u0026#34; }, \u0026#34;metadata\u0026#34;: { \u0026#34;nova_metadata_ip\u0026#34;: \u0026#34;192.168.3.60\u0026#34; }, \u0026#34;openvswitch\u0026#34;: { \u0026#34;tunnel_id_ranges\u0026#34;: \u0026#34;1:1000\u0026#34;, \u0026#34;enable_tunneling\u0026#34;: \u0026#34;True\u0026#34;, \u0026#34;tenant_network_type\u0026#34;: \u0026#34;gre\u0026#34;, \u0026#34;local_ip_interface\u0026#34;: \u0026#34;eth2\u0026#34; }, \u0026#34;api\u0026#34;: { \u0026#34;bind_interface\u0026#34;: \u0026#34;eth1\u0026#34; } }, ã“ã®è¾ºã‚Šã€‚\næ®‹ã£ã¦ã„ã‚‹å•é¡Œç‚¹ VNC ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ãªã„ã€‚èª¿ã¹ãŸã®ã§ã™ãŒã€environment ã®ä¿®æ­£ã§ç›´ã›ã‚‹å• é¡Œã§ã¯ãªã„ã‚ˆã†ã«è¦‹ãˆã¾ã—ãŸã€‚\ncookbooks/openstack-compute/templates/default/nova.conf.rb ã‚’ç¢ºèªã™ã‚‹ã¨ä¸‹è¨˜ã® ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚\n##### VNCPROXY ##### novncproxy_base_url=\u0026lt;%= @novncproxy_base_url %\u0026gt; xvpvncproxy_base_url=\u0026lt;%= @xvpvncproxy_base_url %\u0026gt; # This is only required on the server running xvpvncproxy xvpvncproxy_host=\u0026lt;%= @xvpvncproxy_bind_host %\u0026gt; xvpvncproxy_port=\u0026lt;%= @xvpvncproxy_bind_port %\u0026gt; # This is only required on the server running novncproxy novncproxy_host=\u0026lt;%= @novncproxy_bind_host %\u0026gt; novncproxy_port=\u0026lt;%= @novncproxy_bind_port %\u0026gt; vncserver_listen=\u0026lt;%= @vncserver_listen %\u0026gt; vncserver_proxyclient_address=\u0026lt;%= @vncserver_proxyclient_address %\u0026gt; vncserver_listen, vncserver_proxyclient_address ã¯ãã‚Œãã‚Œ\n@vncserver_listen @vncserver_proxyclient_address ã¨ã„ã†å¤‰æ•°ãŒæ ¼ç´ã•ã‚Œã‚‹ã“ã¨ã«ãªã£ã¦ã„ã‚‹ã€‚\nã§ã¯ cookbooks/openstack-compute/recipes/nova-common.rb ã‚’ç¢ºèªã™ã‚‹ã¨ã€\ntemplate \u0026#39;/etc/nova/nova.conf\u0026#39; do source \u0026#39;nova.conf.erb\u0026#39; owner node[\u0026#39;openstack\u0026#39;][\u0026#39;compute\u0026#39;][\u0026#39;user\u0026#39;] group node[\u0026#39;openstack\u0026#39;][\u0026#39;compute\u0026#39;][\u0026#39;group\u0026#39;] mode 00644 variables( sql_connection: sql_connection, novncproxy_base_url: novnc_endpoint.to_s, xvpvncproxy_base_url: xvpvnc_endpoint.to_s, xvpvncproxy_bind_host: xvpvnc_bind.host, xvpvncproxy_bind_port: xvpvnc_bind.port, novncproxy_bind_host: novnc_bind.host, novncproxy_bind_port: novnc_bind.port, vncserver_listen: vnc_endpoint.host, vncserver_proxyclient_address: vnc_endpoint.host, ä»¥ä¸‹ç•¥ ã¨ãªã£ã¦ã„ã‚‹ã€‚vncserver_listen, vncserver_proxyclient_address å…±ã« vnc_endpoint.host ãŒæ ¼ç´ã•ã‚Œã‚‹ã“ã¨ã«ãªã£ã¦ã„ã‚‹ã€‚vnc_endpont.host ã¯\nvnc_endpoint = endpoint \u0026#39;compute-vnc\u0026#39; || {} ã¨ãªã£ã¦ãŠã‚Šã€Attributes ã®\n\u0026#34;compute-vnc\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;0.0.0.0\u0026#34;, \u0026#34;scheme\u0026#34; =\u0026gt; \u0026#34;http\u0026#34;, \u0026#34;port\u0026#34; =\u0026gt; \u0026#34;6080\u0026#34;, \u0026#34;path\u0026#34; =\u0026gt; \u0026#34;/vnc_auto.html\u0026#34; }, ã®è¨­å®šãŒå…¥ã‚‹ã“ã¨ã«ãªã‚‹ã€‚ã¤ã¾ã‚Šä¸Šè¨˜ã®ã‚ˆã†ãª Attributes ã ã¨ vncserver_listen, vncserver_proxyclient_address å…±ã« \u0026lsquo;0.0.0.0\u0026rsquo; ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒ controller, compute ãƒãƒ¼ãƒ‰ã®åŒæ–¹ã«å…¥ã£ã¦ã—ã¾ã„ã€NoVNC ãŒæ­£ã—ãæ ¼ç´ã—ãªã„ã“ã¨ã«ãªã‚‹ã€‚\nè§£æ±ºã—ãŸã‚‰ã¾ãŸã“ã“ã«æ›´æ–°ç‰ˆã‚’è¼‰ã›ãŸã„ã¨æ€ã„ã¾ãƒ¼ã™ï¼\nä»¥ä¸Šã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2014/04/25/stackforge-openstack-chef-repo-icehouse-deploy/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãŸã¾ãŸ OpenStack ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ã©ã†ã™ã‚‹ã‹ï¼Ÿã«ã¤ã„ã¦ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šã¾ã§è‡ªåˆ†ã®ä¸­ã§ã¯ Rackspace Private Cloud ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ Rackspace ç®¡ç†ã®\nrcbops/chef-cookbooks ãŒä»Šç¾åœ¨ä½¿ã†ãªã‚‰ãƒ™ã‚¹ãƒˆã®é¸æŠã ã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚ã“ã‚Œã¯å†…\néƒ¨ã§ Chef ãŒä½¿ã‚ã‚Œã¦ã„ã¦ã—ã‹ã‚‚ Cookbooks ãŒ Github ä¸Šã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚\nApache ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§ä½¿ãˆã‚‹ã®ã§ã€ã‚µãƒ¼ãƒ“ã‚¹æ§‹ç¯‰ã«ã‚‚ä½¿ãˆã¡ã‚ƒã†ã¨ã„ã†ãƒ¢ãƒã€‚\u003c/p\u003e\n\u003cp\u003eå…ˆæ—¥ã€ã‚ã‚‹ OpenStack ã‚³ã‚¢ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã®æ–¹ã‹ã‚‰ã€Œjedipunkz ã•ã‚“ã€ã‚„ã£ã±ã‚Š rcbops\nãŒã„ã„ã§ã™ã‹ï¼Ÿé‹å–¶ã¨ã‹ã©ã†ãªã£ã¦ã„ã‚‹ã‚“ã§ã—ã‚‡ã†ï¼Ÿãƒãƒ¼ã‚¸ã®è¦æº–ã¨ã‹ã©ã†ãªã®ã‹ãªï¼Ÿã€\nã¨è³ªå•å—ã‘ã¾ã—ãŸã€‚ç¢ºã‹ã«ãƒãƒ¼ã‚¸ã®åŸºæº–ã¯ Rackspace Private Cloud ãŒãƒ™ãƒ¼ã‚¹ã«ãªã‚Š\nã¾ã™ã—ã€ç®¡ç†ã—ã¦ã„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ä¸€è¦§ã‚’è¦‹ã¦ã„ã‚‹ã¨ Rackspace ç¤¾ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒãƒ¡\nã‚¤ãƒ³ã§ã™ã—ã€ä»Šå¾Œã©ã†ãªã‚‹ã®ã‹åˆ†ã‹ã‚‰ãªã„\u0026hellip;ã€‚\u003c/p\u003e\n\u003cp\u003eé€ƒã’é“ã¯ç”¨æ„ã—ãŸã»ã†ãŒè‰¯ã•ãã†ã€‚\u003c/p\u003e\n\u003cp\u003eã¨ã„ã†ã“ã¨ã§ã€ä»¥å‰è‡ªåˆ†ã‚‚æš‘ã‹ã£ãŸã“ã¨ã®ã‚ã‚‹ StackForge ã® openstack-chef-repo\nã‚’ä¹…ã€…ã«ä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚Icehouse æ§‹æˆãŒã“ã®æ™‚ç‚¹ã§æ—¢ã«çµ„ã‚ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¦ã€\nä»¥å‰ã‚ˆã‚Šã ã„ã€œã¶å®Œæˆåº¦å¢—ã—ãŸæ„ŸãŒã‚ã‚Šã¾ã™ã€‚ä»Šå›ã¯ nova-network æ§‹æˆã‚’ä½œã£ã¦ã¿ãŸ\nã®ã§ã™ãŒã€Neutron æ§‹æˆã‚‚ã‚‚ã¡ã‚ã‚“å‡ºæ¥ãã†ãªã®ã§å¾Œã«èª¿ã¹ã¦ã¾ãŸå…¬é–‹ã—ãŸã„ã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"stackforge-ã¨ã¯\"\u003eStackForge ã¨ã¯\u003c/h2\u003e\n\u003cp\u003eStackForge ã¯ OpenStack ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»CI ã®ä»•çµ„ã¿ã¨ã—ã¦å…¬å¼ã«ç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹ã‚‚ã®ã€‚\nå…¬å¼ã‚µã‚¤ãƒˆã¯ä¸‹è¨˜ã®å ´æ‰€ã«ã‚ã‚‹ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://ci.openstack.org/stackforge.html\"\u003ehttp://ci.openstack.org/stackforge.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eStackForge ã® openstack-chef-repo ã¯ä¸‹è¨˜ã®å ´æ‰€ã«ã‚ã‚‹ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/stackforge/openstack-chef-repo\"\u003ehttps://github.com/stackforge/openstack-chef-repo\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eopenstack-chef-repo ã¯ã¾ã  \u0026lsquo;stable/icehouse\u0026rsquo; ãƒ–ãƒ©ãƒ³ãƒãŒç”Ÿæˆã•ã‚Œã¦ã„ãªã„ã€‚ãŒç›´\nã¡ã« master ã‹ã‚‰ãƒ–ãƒ©ãƒ³ãƒãŒåˆ‡ã‚‰ã‚Œã‚‹æ§˜å­ã€‚\u003c/p\u003e","title":"stackforge/openstack-chef-repo ã§ OpenStack Icehouse ãƒ‡ãƒ—ãƒ­ã‚¤"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nçš†ã•ã‚“ã€Mirantis OpenStack ã¯ã”å­˜çŸ¥ã§ã™ã‹ï¼Ÿ OpenStack ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã® 1ã¤ã§ã™ã€‚ä»¥ä¸‹ã€å…¬å¼ã‚µã‚¤ãƒˆã§ã™ã€‚\nhttp://software.mirantis.com/main/\nã“ã® Mirantis OpenStack ã‚’ä½¿ã£ã¦ OpenStack Havana (Neutron GRE) æ§‹æˆã‚’ä½œã£ã¦ã¿ ã¾ã—ãŸã€‚ãã®æ™‚ã®ãƒ¡ãƒ¢ã‚’æ›¸ã„ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\næ§‹æˆã¯? æ§‹æˆã¯ä¸‹è¨˜ã®é€šã‚Šã€‚\nâ€» CreativeCommon\nç‰¹å¾´ã¯\nAdministrative Network : Fuel Node, DHCP + PXE ãƒ–ãƒ¼ãƒˆç”¨ Management Network : å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ API ç”¨ Public/Floating IP Network : ãƒ‘ãƒ–ãƒªãƒƒã‚¯ API, VM Floating IP ç”¨ Storage Network : Cinder é…ä¸‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ \u0026lt;-\u0026gt; ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹é–“ç”¨ è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶š : Public/Floating Networks Neutron(GRE) æ§‹æˆ ã§ã™ã€‚ã‚¿ã‚° VLAN ä½¿ã£ã¦ç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æœ¬æ•°ã‚’æ¸›ã‚‰ã™ã“ã¨ã‚‚å‡ºæ¥ã‚‹ã¯ãšã§ã™ãŒã€åƒ• ã®ç’°å¢ƒã§ã¯ä½•æ•…ã‹ãƒ€ãƒ¡ã ã£ãŸã®ã§ä¸Šè¨˜ã®4ã¤ã®ç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’åˆ¥ã€…ã«ç”¨æ„ã—ã¾ã—ãŸã€‚\nFuel ãƒãƒ¼ãƒ‰ã®æ§‹ç¯‰ Fuel ãƒãƒ¼ãƒ‰ã¨ã¯ã€OpenStack ã®å„ãƒãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®ç®¡ç†ãƒãƒ¼ãƒ‰ã®ã“ã¨ã§ã™ã€‚ DHCP + PXE ã‚’ç®¡ç†ã™ã‚‹ Cobbler ã‚„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«ã® Puppet ãŒå†…éƒ¨ã§ç¨¼åƒã—ã€ Administrative Network ä¸Šã§ç¨¼åƒã—ãŸãƒãƒ¼ãƒ‰ã‚’ç®¡ç†ãƒ»ãã®å¾Œãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\næ§‹ç¯‰æ–¹æ³•ã¯\u0026hellip;\nä¸‹è¨˜ã® URL ã‚ˆã‚Š ISO ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€‚\nhttp://software.mirantis.com/main/\nAdministrative Network ã« NIC ã‚’å‡ºã—ãŸãƒãƒ¼ãƒ‰ã‚’ä¸Šè¨˜ã® ISO ã‹ã‚‰èµ·å‹•ã€‚\nGrub ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ \u0026ldquo;Tab\u0026rdquo; ã‚­ãƒ¼ã‚’æŠ¼ä¸‹ã€‚\nä¸Šè¨˜ç”»é¢ã«ã¦ã‚«ãƒ¼ãƒãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¦ hostname, ip, gw, dns ã‚’ä¿®æ­£ã€‚ä¸‹è¨˜ã¯ä¾‹ã€‚\nvmlinuz initrd=initrd.img biosdevname=0 ks=cdrom:/ks.cfg ip=10.200.10.76 gw=10.200.10.1 dns1=8.8.8.8 netmask=255.255.255.0 hostname=fuel.cpi.ad.jp showmenu=no_ ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://10.200.10.76:8080 (ä¸Šè¨˜ä¾‹)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€æ–°ã—ã„ \u0026lsquo;OpenStack Environment\u0026rsquo; ã‚’ä½œæˆã™ã‚‹ã€‚\nName : ä»»æ„ OpenStack Release : Havana on CentOS6.4 ãªãŠã€Ubuntu æ§‹æˆã‚‚çµ„ã‚ã‚‹ãŒã€ç§ã®ç’°å¢ƒã§ã¯é€”ä¸­ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã—ãŸã€‚\nNext ã‚’æŠ¼ä¸‹ã—ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã‚’è¡Œã†ã€‚ä»Šå›ã¯ \u0026lsquo;Nuetron GRE\u0026rsquo; ã‚’é¸æŠã€‚\n\u0026lsquo;Save Settings\u0026rsquo; ã‚’æŠ¼ä¸‹ã—è¨­å®šã‚’ä¿å­˜ã€‚ã“ã®æ™‚ç‚¹ã§ã¯ \u0026lsquo;Verify Networks\u0026rsquo; ã¯è¡Œãˆãªã„ã€‚ å°‘ãªãã¨ã‚‚ 2 ãƒãƒ¼ãƒ‰ãŒå¿…è¦ã€‚æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§2ãƒãƒ¼ãƒ‰ã®è¿½åŠ ã‚’è¡Œã†ã€‚\nãƒãƒ¼ãƒ‰ã®è¿½åŠ  ä¸‹è¨˜ã®4ã¤ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã« NIC ã‚’å‡ºã—ãŸãƒãƒ¼ãƒ‰ã‚’ç”¨æ„ã—ã€èµ·å‹•ã™ã‚‹ã€‚èµ·å‹• ã™ã‚‹ã¨ Administrative Network ä¸Šã§ç¨¼åƒã—ã¦ã„ã‚‹ Cobbler ã«ã‚ˆã‚Šãƒãƒ¼ãƒ‰ãŒ PXE èµ·å‹• ã—ãƒŸãƒ‹ãƒãƒ ãª OS ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ã€‚ã“ã‚Œã¯å¾Œã« Fuel ãƒãƒ¼ãƒ‰ã‚ˆã‚Šãƒ­ã‚°ã‚¤ãƒ³ãŒã•ã‚Œã€ å„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã® Mac ã‚¢ãƒ‰ãƒ¬ã‚¹ç­‰ã®æƒ…å ±ã‚’çŸ¥ã‚‹ãŸã‚ã§ã™ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ™ãƒªãƒ•ã‚¡ ã‚¤ç­‰ã‚‚ã“ã®ãƒŸãƒ‹ãƒãƒ ãª OS è¶Šã—ã«å®Ÿæ–½ã•ã‚Œã¾ã™ã€‚\nAdministrative Network Public/Floating IP Network Storage Network Management Network ãƒãƒ¼ãƒ‰ãŒç¨¼åƒã—ãŸæ™‚ç‚¹ã§ Fuel ã«ã‚ˆã‚Šãƒãƒ¼ãƒ‰ãŒèªè­˜ã•ã‚Œã‚‹ã®ã§ã€ã“ã“ã§ã¯2ã¤ã®ãƒãƒ¼ãƒ‰ ã‚’ãã‚Œãã‚Œ\nController ãƒãƒ¼ãƒ‰ Compute ãƒãƒ¼ãƒ‰ ã¨ã—ã¦ç”»é¢ä¸Šã§å‰²ã‚Šå½“ã¦ã¾ã™ã€‚\nã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®è¨­å®š http://10.200.10.76:8000/#cluster/1/nodes ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ä½œæˆã—ãŸ Environment ã‚’é¸æŠã€‚ãã®å¾Œã€\u0026lsquo;Nodes\u0026rsquo; ã‚¿ãƒ–ã‚’æŠ¼ä¸‹ã€‚ãƒãƒ¼ãƒ‰ã‚’é¸æŠã—ã€\u0026lsquo;Configure Interfaces\u0026rsquo; ã‚’ é¸æŠã€‚å„ãƒãƒ¼ãƒ‰ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã® Mac ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã—ã€å„ã€…ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚» ã‚°ãƒ¡ãƒ³ãƒˆã‚’ç´ä»˜ã‘ã‚‹ã€‚å°šã€Fuel ãƒãƒ¼ãƒ‰ã‹ã‚‰ \u0026lsquo;root\u0026rsquo; ãƒ¦ãƒ¼ã‚¶ã§ SSH(22ç•ªãƒãƒ¼ãƒˆ) ã«ãƒãƒ³ ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã§å…¬é–‹éµèªè¨¼ãƒ­ã‚°ã‚¤ãƒ³ãŒå¯èƒ½ã¨ãªã£ã¦ã„ã‚‹ã€‚Fuel ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦ã¯ SSH (22ç•ªãƒãƒ¼ãƒˆ) ã«ã¦ä¸‹è¨˜ã®ãƒ¦ãƒ¼ã‚¶ã«ã¦ãƒ­ã‚°ã‚¤ãƒ³ãŒå¯èƒ½ã§ã™ã€‚\nusername : root password : r00tme ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç¢ºèª http://10.200.10.76:8000/#cluster/1/network ã«ã¦ \u0026lsquo;Networks\u0026rsquo; ã‚¿ãƒ–ã‚’é–‹ãã€\u0026lsquo;Verify Networks\u0026rsquo; ã‚’æŠ¼ä¸‹ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šãŒæ­£ã—ãè¡Œã‚ã‚Œã¦ã„ã‚‹ã‹å¦ã‹ã‚’ç¢ºèªã€‚\nãƒ‡ãƒ—ãƒ­ã‚¤ http://10.200.10.76:8000/#cluster/1/nodes ã«ã¦ \u0026lsquo;Deploy Changes\u0026rsquo; ã‚’æŠ¼ä¸‹ã—ãƒ‡ãƒ— ãƒ­ã‚¤é–‹å§‹ã€‚kickstart ã«ã¦ OS ãŒè‡ªå‹•ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œ puppet ã«ã¦ fuel ãƒãƒ¼ãƒ‰ã‹ ã‚‰è‡ªå‹•ã§ OpenStack ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚\nOpenStack ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ SSH ã§ã¯ä¸‹è¨˜ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ OpenStack ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰ã«ãƒ­ã‚°ã‚¤ãƒ³ã€‚\nfuel ãƒãƒ¼ãƒ‰ (SSH) -\u0026gt; node-1 (OpenStack ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰)(SSH)\nãƒ–ãƒ©ã‚¦ã‚¶ã§ Horizon ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯\nhttp://10.200.10.2\nã«ã‚¢ã‚¯ã‚»ã‚¹ã€‚ã“ã‚Œã¯ä¾‹ã€‚Administrative Network ã«æ¥ç¶šã—ã¦ã„ã‚‹ NIC ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ ã¸ HTTP ã§ãƒ­ã‚°ã‚¤ãƒ³ã€‚\nã¾ã¨ã‚ Mirantis OpenStack Neutron (GRE) æ§‹æˆãŒçµ„ã‚ãŸã€‚ä¸Šè¨˜æ§‹æˆå›³ã‚’è¦‹ã¦ç–‘å•ã«æ€ã£ã¦ã„ ãŸ \u0026ldquo;VM é–“é€šä¿¡ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ\u0026rdquo; ã§ã‚ã‚‹ãŒã€Administrative Network ã®ã‚»ã‚° ãƒ¡ãƒ³ãƒˆã‚’ç”¨ã„ã¦ã„ã‚‹äº‹ãŒåˆ¤ã£ãŸã€‚ã“ã‚Œã¯åˆ©ç”¨è€…ãŒæ„å›³ã—ã¦ã„ã‚‹ã¨ã¯è€ƒãˆã¥ã‚‰ã„ã®ã§ã€æ­£ ç›´ã€ã‚ã‚‹ã¹ãå§¿ã§ã¯ç„¡ã„ã‚ˆã†ã«æ€ãˆã‚‹ã€‚ãŒã€ä¸Šè¨˜æ§‹æˆå›³ã« VM ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒç„¡ã„ç†ç”± ã¯ã“ã‚Œã«ã¦åˆ¤ã£ãŸã€‚\nä¸‹è¨˜ã¯ãƒãƒ¼ãƒ‰ä¸Šã§ ovs-vsctl show ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã£ãŸçµæœã®æŠœç²‹ã§ã™ã€‚\nBridge \u0026#34;br-eth1\u0026#34; Port \u0026#34;br-eth1\u0026#34; Interface \u0026#34;br-eth1\u0026#34; type: internal Port \u0026#34;br-eth1--br-fw-admin\u0026#34; trunks: [0] Interface \u0026#34;br-eth1--br-fw-admin\u0026#34; type: patch options: {peer=\u0026#34;br-fw-admin--br-eth1\u0026#34;} Port \u0026#34;eth1\u0026#34; Interface \u0026#34;eth1\u0026#34; ä»Šå›ã®æ§‹æˆã¯ eth1 ã¯ Administrative Network ã«å‰²ã‚Šå½“ã¦ã¦ã„ã¾ã—ãŸã€‚\nä¸€æ˜”å‰ã¯ OS ã®ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãŒæœ‰æ–™ã‚µãƒãƒ¼ãƒˆã‚’ãƒ“ã‚¸ãƒã‚¹ã«ã—ã¦ã„ã¾ã—ãŸã€‚Redhat ãŒãã®ä»£è¡¨æ ¼ã ã¨æ€ã„ã¾ã™ãŒã€ä»Šã¯ OS ä¸Šã§ä½•ã‹ã‚’å®Ÿç¾ã™ã‚‹ã«ã‚‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®å®Œæˆåº¦ ãŒé«˜ãã€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒå›°ã‚‹ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãŒãã‚Œã»ã©ç„¡ããªã£ãŸæ°—ãŒã—ã¾ã™ã€‚ãã“ã§ ãã® OS ã®ä¸Šã§ç¨¼åƒã™ã‚‹ OpenStack ã®ã‚µãƒãƒ¼ãƒˆãƒ“ã‚¸ãƒã‚¹ãŒå‡ºã¦ããŸã‹ï¼ã¨ã„ã†å°è±¡ã§ ã™ã€‚OpenStack ã¯ã¾ã ã¾ã ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã¨ã£ã¦æ•·å±…ã®é«˜ã„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ã€‚è‡ªã‚‰ã‚¯ãƒ© ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’æ§‹ç¯‰å‡ºæ¥ã‚‹ã®ã¯é­…åŠ›çš„ã§ã™ãŒã€ã‚µãƒãƒ¼ãƒˆç„¡ã—ã«æ§‹ç¯‰ãƒ»é‹ç”¨ã™ã‚‹ ã«ã¯ã€ã¾ã é›£ã—ã„æŠ€è¡“ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã“ã†ã„ã£ãŸãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‡ºã¦ãã‚‹ è¾ºã‚ŠãŒæ™‚ä»£ã ãªãã¨æ„Ÿã˜ã¾ã™ã€‚\nå°šã€ISO ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦åˆ©ç”¨ã™ã‚‹ã ã‘ã§ã—ãŸã‚‰ç„¡å„Ÿã§ OK ã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2014/04/23/mirantis-openstack/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eçš†ã•ã‚“ã€Mirantis OpenStack ã¯ã”å­˜çŸ¥ã§ã™ã‹ï¼Ÿ OpenStack ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®\n1ã¤ã§ã™ã€‚ä»¥ä¸‹ã€å…¬å¼ã‚µã‚¤ãƒˆã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://software.mirantis.com/main/\"\u003ehttp://software.mirantis.com/main/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã“ã® Mirantis OpenStack ã‚’ä½¿ã£ã¦ OpenStack Havana (Neutron GRE) æ§‹æˆã‚’ä½œã£ã¦ã¿\nã¾ã—ãŸã€‚ãã®æ™‚ã®ãƒ¡ãƒ¢ã‚’æ›¸ã„ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆã¯\"\u003eæ§‹æˆã¯?\u003c/h2\u003e\n\u003cp\u003eæ§‹æˆã¯ä¸‹è¨˜ã®é€šã‚Šã€‚\u003c/p\u003e\n\u003cimg src=\"http://jedipunkz.github.io/pix/mirantis_gre.jpg\"\u003e\n\u003cp\u003eâ€» CreativeCommon\u003c/p\u003e\n\u003cp\u003eç‰¹å¾´ã¯\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAdministrative Network : Fuel Node, DHCP + PXE ãƒ–ãƒ¼ãƒˆç”¨\u003c/li\u003e\n\u003cli\u003eManagement Network : å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ API ç”¨\u003c/li\u003e\n\u003cli\u003ePublic/Floating IP Network : ãƒ‘ãƒ–ãƒªãƒƒã‚¯ API, VM Floating IP ç”¨\u003c/li\u003e\n\u003cli\u003eStorage Network : Cinder é…ä¸‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ \u0026lt;-\u0026gt; ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹é–“ç”¨\u003c/li\u003e\n\u003cli\u003eè¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶š : Public/Floating Networks\u003c/li\u003e\n\u003cli\u003eNeutron(GRE) æ§‹æˆ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã§ã™ã€‚ã‚¿ã‚° VLAN ä½¿ã£ã¦ç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æœ¬æ•°ã‚’æ¸›ã‚‰ã™ã“ã¨ã‚‚å‡ºæ¥ã‚‹ã¯ãšã§ã™ãŒã€åƒ•\nã®ç’°å¢ƒã§ã¯ä½•æ•…ã‹ãƒ€ãƒ¡ã ã£ãŸã®ã§ä¸Šè¨˜ã®4ã¤ã®ç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’åˆ¥ã€…ã«ç”¨æ„ã—ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ch2 id=\"fuel-ãƒãƒ¼ãƒ‰ã®æ§‹ç¯‰\"\u003eFuel ãƒãƒ¼ãƒ‰ã®æ§‹ç¯‰\u003c/h2\u003e\n\u003cp\u003eFuel ãƒãƒ¼ãƒ‰ã¨ã¯ã€OpenStack ã®å„ãƒãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®ç®¡ç†ãƒãƒ¼ãƒ‰ã®ã“ã¨ã§ã™ã€‚\nDHCP + PXE ã‚’ç®¡ç†ã™ã‚‹ Cobbler ã‚„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«ã® Puppet ãŒå†…éƒ¨ã§ç¨¼åƒã—ã€\nAdministrative Network ä¸Šã§ç¨¼åƒã—ãŸãƒãƒ¼ãƒ‰ã‚’ç®¡ç†ãƒ»ãã®å¾Œãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\u003c/p\u003e","title":"Mirantis OpenStack (Neutron GRE)ã‚’çµ„ã‚“ã§ã¿ãŸï¼"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šé€± Redhat ãŒ \u0026lsquo;Redhat Enterprise Linux Atomic Host\u0026rsquo; ã—ã¾ã—ãŸã‚ˆã­ã€‚Docker ã‚’ç‰¹ å¾´ã¨ã—ãŸãƒŸãƒ‹ãƒãƒ ãª OS ã ã¨ã®ã“ã¨ã€‚ãã®å†…éƒ¨ã§ç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹æŠ€è¡“ Geard ã«ã¤ã„ã¦ å°‘ã—èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã®é–¢é€£ä»˜ã‘ãŒå¯èƒ½ãªã‚ˆã†ã§ã™ã€‚ã“ã“ã§ã¯èª¿ã¹ãŸçµæœ ã«ã¤ã„ã¦ç°¡å˜ã«ã¾ã¨ã‚ã¦ã„ãã¾ã™ã€‚\nå‚è€ƒè³‡æ–™ http://openshift.github.io/geard/deploy_with_geard.html\nåˆ©ç”¨æ–¹æ³• ã“ã“ã§ã¯ãƒ›ã‚¹ãƒˆ OS ã« Fedora20 ã‚’ç”¨æ„ã—ã¾ã™ã€‚\nã¾ãš Geard ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\n% sudo yum install --enablerepo=updates-testing geard ä¸‹è¨˜ã® json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã“ã«ã¯ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®æƒ…å ±ã¨é–¢ é€£ä»˜ã‘ã®ãŸã‚ã®æƒ…å ±ã‚’è¨˜ã—ã¾ã™ã€‚\n$ ${EDITOR} rockmongo_mongodb.json { \u0026#34;containers\u0026#34;:[ { \u0026#34;name\u0026#34;:\u0026#34;rockmongo\u0026#34;, \u0026#34;count\u0026#34;:1, \u0026#34;image\u0026#34;:\u0026#34;derekwaynecarr/rockmongo\u0026#34;, \u0026#34;publicports\u0026#34;:[{\u0026#34;internal\u0026#34;:80,\u0026#34;external\u0026#34;:6060}], \u0026#34;links\u0026#34;:[{\u0026#34;to\u0026#34;:\u0026#34;mongodb\u0026#34;}] }, { \u0026#34;name\u0026#34;:\u0026#34;mongodb\u0026#34;, \u0026#34;count\u0026#34;:1, \u0026#34;image\u0026#34;:\u0026#34;ccoleman/ubuntu-mongodb\u0026#34;, \u0026#34;publicports\u0026#34;:[{\u0026#34;internal\u0026#34;:27017}] } ] } ä¸Šè¨˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®è§£èª¬ã€‚\nã‚³ãƒ³ãƒ†ãƒŠ \u0026lsquo;rockmongo\u0026rsquo; ã¨ \u0026lsquo;mongodb\u0026rsquo; ã‚’ä½œæˆ ãã‚Œãã‚Œ1å€‹ãšã¤ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ \u0026lsquo;image\u0026rsquo; ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¦ docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æŒ‡å®š \u0026lsquo;publicports\u0026rsquo; ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¦ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã¨ãƒ›ã‚¹ãƒˆå´ã®ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã‚’è¡Œã† \u0026rsquo;links\u0026rsquo; ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ \u0026lsquo;rockmongo\u0026rsquo; ã‚’ \u0026lsquo;mongodb\u0026rsquo; ã«é–¢é€£ä»˜ã‘ ã§ã¯ã€ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹ã—ã¾ã™ã€‚\n$ sudo gear deploy rockmongo_mongo.json 2014/04/22 07:21:12 Deploying rockmongo_mongo.json.20140422-072112 2014/04/22 07:21:12 appending 27017 on rockmongo-1: \u0026amp;{PortPair:{Internal:27017 External:0} Target:127.0.0.1:27017} \u0026amp;{Id:rockmongo-1 Image:derekwaynecarr/rockmongo From:rockmongo On:0xc2100bb980 Ports:[{PortPair:{Internal:80 External:6060} Target::0}] add:true remove:false container:0xc21000be00 links:[]} 2014/04/22 07:21:12 ports: Releasing 2014/04/22 07:21:12 systemd: Reloading daemon local PortMapping: 80 -\u0026gt; 6060 local Container rockmongo-1 is installed 2014/04/22 07:21:12 ports: Releasing 2014/04/22 07:21:12 systemd: Reloading daemon local PortMapping: 27017 -\u0026gt; 4000 local Container mongodb-1 is installed linking rockmongo: 127.0.0.1:27017 -\u0026gt; localhost:4000 local Links set on local local Container rockmongo-1 starting local Container mongodb-1 starting ãƒ–ãƒ©ã‚¦ã‚¶ã«ã¦ãƒ›ã‚¹ãƒˆ OS ã«æ¥ç¶šã™ã‚‹ã“ã¨ã§ rockmongo ã®ç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ã€‚\nhttp://\u0026lt;ãƒ›ã‚¹ãƒˆOSã®IP:6060\u0026gt;/ ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ç®¡ç† ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ã¦ã€å®Ÿéš›ã« RockMongo ã®ç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ãŸã¨æ€ã„ã¾ã™ã€‚ é–¢é€£ä»˜ã‘ãŒç‰¹å¾´ã¨è¨€ãˆãã†ãªã®ã§ãã®è§£æã‚’ã—ã¦ã¿ã¾ã—ãŸã€‚\nGeard ã®ã‚³ãƒ³ãƒ†ãƒŠé–¢é€£ä»˜ã‘ã¯ãƒ›ã‚¹ãƒˆã¨ã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ãƒˆç®¡ç†ãŒã‚­ãƒ¢ã¨ãªã£ã¦ã„ã‚‹ã“ã¨ãŒ è§£ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’ç´è§£ãã“ã¨ã§ geard ã®ã‚³ãƒ³ãƒ†ãƒŠç®¡ç†ã‚’ç†è§£ã—ã¾ã™ã€‚\n\u0026#39;rockmongo\u0026#39; ã‚³ãƒ³ãƒ†ãƒŠ \u0026#39;mongodb\u0026#39; ã‚³ãƒ³ãƒ†ãƒŠ +----------+ +--------------------------+ +-------------------+ | Client |-\u0026gt;6060-\u0026gt;|-\u0026gt;80-\u0026gt; RockMongo -\u0026gt;27017-\u0026gt;|-\u0026gt;4000-\u0026gt;|-\u0026gt;27017-\u0026gt; Mongodb | +----------+ +--------------------------+ +-------------------+ |-------------------- docker ãƒ›ã‚¹ãƒˆ --------------------| ä¸Šè¨˜ \u0026lsquo;gear deploy\u0026rsquo; ã‚³ãƒãƒ³ãƒ‰ç™ºè¡Œæ™‚ã®ãƒ­ã‚°ã¨ json ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚Šä¸Šå›³ã®ã‚ˆã†ãªæ§‹æˆ ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒç†è§£ã§ãã¾ã™ã€‚ä¸€ã¤ãšã¤èª­ã¿è§£ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚\n\u0026lsquo;rockmongo\u0026rsquo; ã‚³ãƒ³ãƒ†ãƒŠã®å†…éƒ¨ã§ãƒªã‚¹ãƒ³ã—ã¦ã„ã‚‹ 80 ç•ªãƒãƒ¼ãƒˆã¯ãƒ›ã‚¹ãƒˆ OS ã® 6060 ç•ªã¸å¤‰æ› \u0026lsquo;rockmongo\u0026rsquo; ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ç¨¼åƒã™ã‚‹ RockMongo ã® config.php ã‹ã‚‰ \u0026lsquo;127.0.0.1:27017\u0026rsquo; ã§ãƒªã‚¹ãƒ³ã—ã¦ã„ã‚‹ã“ã¨ãŒè§£ã‚‹ è©¦ã—ã« \u0026lsquo;derekwaynecarr/rockmongo:latest\u0026rsquo; ã« /bin/bash ã§ãƒ­ã‚°ã‚¤ãƒ³ã— config.php ã‚’ç¢ºèªã€‚\n$ sudo docker run -i -t derekwaynecarr/rockmongo:latest /bin/bash bash-4.1# grep mongo_host /var/www/html/config.php $MONGO[\u0026#34;servers\u0026#34;][$i][\u0026#34;mongo_host\u0026#34;] = \u0026#34;127.0.0.1\u0026#34;;//mongo host $MONGO[\u0026#34;servers\u0026#34;][$i][\u0026#34;mongo_host\u0026#34;] = \u0026#34;127.0.0.1\u0026#34;; ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ãƒ­ã‚°ã¨ json ãƒ•ã‚¡ã‚¤ãƒ«ã® \u0026rsquo;links\u0026rsquo; ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚ˆã‚Šã€ãƒ›ã‚¹ãƒˆã®ãƒãƒ¼ãƒˆã«å‹•çš„ã«(ã“ã“ã§ã¯ 4000ç•ªãƒãƒ¼ãƒˆ) ã«å¤‰æ›ã•ã‚Œã‚‹ã“ã¨ãŒè§£ã‚Šã¾ã™ã€‚ linking rockmongo: 127.0.0.1:27017 -\u0026gt; localhost:4000 ãƒ›ã‚¹ãƒˆã® 4000 ç•ªãƒãƒ¼ãƒˆã¯å‹•çš„ã« \u0026lsquo;mongodb\u0026rsquo; ã‚³ãƒ³ãƒ†ãƒŠã®å†…éƒ¨ãƒãƒ¼ãƒˆ 27017 ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹ ã“ã‚Œã‚‰ã®ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã«ã‚ˆã‚Šãã‚Œãã‚Œã®ã‚³ãƒ³ãƒ†ãƒŠã®é€£æºãŒå–ã‚Œã¦ã„ã‚‹ã€‚\nã¾ã¨ã‚ã¨è€ƒå¯Ÿ Geard ã¯ä¸‹è¨˜ã®2ã¤ã‚’ç‰¹å¾´ã¨ã—ãŸæŠ€è¡“ã ã¨è¨€ãˆã‚‹ã¨ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚\nã‚³ãƒ³ãƒ†ãƒŠã‚’ json ã§ç®¡ç†ã—ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ä»•çµ„ã¿ã‚’æä¾›ã™ã‚‹ ã‚³ãƒ³ãƒ†ãƒŠé–“ã®é–¢é€£ä»˜ã‘ã‚’ãƒ›ã‚¹ãƒˆ OS ã®ãƒãƒ¼ãƒˆã‚’å‹•çš„ã«ç®¡ç†ãƒ»ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§è¡Œã† åŒã˜ã‚ˆã†ãª OS ã« CoreOS https://coreos.com/ ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã¡ã‚‰ã‚‚ docker, sytemd ç­‰ã‚’ç‰¹å¾´ã¨ã—ã¦ã„ã¾ã™ã€‚ã•ã‚‰ã« etcd ã‚’ä½¿ã£ã¦ã‚¯ãƒ©ã‚¹ã‚¿ã®æ§‹æˆç­‰ãŒå¯èƒ½ã«ãªã£ ã¦ã„ã¾ã™ãŒã€Geard ã¯ãƒ›ã‚¹ãƒˆã®ãƒãƒ¼ãƒˆã‚’å‹•çš„ã«ç®¡ç†ã™ã‚‹ã“ã¨ã§é–¢é€£ä»˜ã‘ãŒå¯èƒ½ãªã“ã¨ãŒ ã‚ã‹ã‚Šã¾ã—ãŸã€‚\nå®Ÿéš›ã«è§¦ã£ã¦ã¿ãŸæ„Ÿè¦šã‹ã‚‰è¨€ãˆã°ã€ã¾ã ã¾ã å®Ÿç”¨åŒ–ã¯å³ã—ã„çŠ¶æ³ã«æ€ãˆã¾ã™ãŒã€ä»Šå¾Œã¸ ã®å±•é–‹ã«æœŸå¾…ã—ãŸã„æŠ€è¡“ã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2014/04/22/geard-port-mapping/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šé€± Redhat ãŒ \u0026lsquo;Redhat Enterprise Linux Atomic Host\u0026rsquo; ã—ã¾ã—ãŸã‚ˆã­ã€‚Docker ã‚’ç‰¹\nå¾´ã¨ã—ãŸãƒŸãƒ‹ãƒãƒ ãª OS ã ã¨ã®ã“ã¨ã€‚ãã®å†…éƒ¨ã§ç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹æŠ€è¡“ Geard ã«ã¤ã„ã¦\nå°‘ã—èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã®é–¢é€£ä»˜ã‘ãŒå¯èƒ½ãªã‚ˆã†ã§ã™ã€‚ã“ã“ã§ã¯èª¿ã¹ãŸçµæœ\nã«ã¤ã„ã¦ç°¡å˜ã«ã¾ã¨ã‚ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒè³‡æ–™\"\u003eå‚è€ƒè³‡æ–™\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"http://openshift.github.io/geard/deploy_with_geard.html\"\u003ehttp://openshift.github.io/geard/deploy_with_geard.html\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"åˆ©ç”¨æ–¹æ³•\"\u003eåˆ©ç”¨æ–¹æ³•\u003c/h2\u003e\n\u003cp\u003eã“ã“ã§ã¯ãƒ›ã‚¹ãƒˆ OS ã« Fedora20 ã‚’ç”¨æ„ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãš Geard ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo yum install --enablerepo\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eupdates-testing geard\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‹è¨˜ã® json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã“ã«ã¯ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®æƒ…å ±ã¨é–¢\né€£ä»˜ã‘ã®ãŸã‚ã®æƒ…å ±ã‚’è¨˜ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e$\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e$\u003c/span\u003e{\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003eEDITOR\u003c/span\u003e} \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003erockmongo_mongodb.json\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;containers\u0026#34;\u003c/span\u003e:[\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;rockmongo\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;count\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;image\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;derekwaynecarr/rockmongo\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;publicports\u0026#34;\u003c/span\u003e:[{\u003cspan style=\"color:#f92672\"\u003e\u0026#34;internal\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e80\u003c/span\u003e,\u003cspan style=\"color:#f92672\"\u003e\u0026#34;external\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e6060\u003c/span\u003e}],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;links\u0026#34;\u003c/span\u003e:[{\u003cspan style=\"color:#f92672\"\u003e\u0026#34;to\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mongodb\u0026#34;\u003c/span\u003e}]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mongodb\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;count\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;image\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ccoleman/ubuntu-mongodb\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;publicports\u0026#34;\u003c/span\u003e:[{\u003cspan style=\"color:#f92672\"\u003e\u0026#34;internal\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e27017\u003c/span\u003e}]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šè¨˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®è§£èª¬ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eã‚³ãƒ³ãƒ†ãƒŠ \u0026lsquo;rockmongo\u0026rsquo; ã¨ \u0026lsquo;mongodb\u0026rsquo; ã‚’ä½œæˆ\u003c/li\u003e\n\u003cli\u003eãã‚Œãã‚Œ1å€‹ãšã¤ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ\u003c/li\u003e\n\u003cli\u003e\u0026lsquo;image\u0026rsquo; ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¦ docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æŒ‡å®š\u003c/li\u003e\n\u003cli\u003e\u0026lsquo;publicports\u0026rsquo; ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¦ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã¨ãƒ›ã‚¹ãƒˆå´ã®ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã‚’è¡Œã†\u003c/li\u003e\n\u003cli\u003e\u0026rsquo;links\u0026rsquo; ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ \u0026lsquo;rockmongo\u0026rsquo; ã‚’ \u0026lsquo;mongodb\u0026rsquo; ã«é–¢é€£ä»˜ã‘\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã§ã¯ã€ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹ã—ã¾ã™ã€‚\u003c/p\u003e","title":"Geard ã®ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ãŸ"},{"content":"ã“ã‚“ã«ã¡ã¯ï¼@jedipunkz ã§ã™ã€‚\nä»Šå›ã¯ Havana ç‰ˆã® OpenStack Glance, Cinder ã¨åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã® Ceph ã‚’é€£æºã•ã› ã‚‹æ‰‹é †ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚å…ƒãƒã‚¿ã¯ã“ã¡ã‚‰ã€‚ä¸‹è¨˜ã® Ceph ã®å…¬å¼ã‚µã‚¤ãƒˆã«æ‰‹é †ã§ã™ã€‚\nhttps://ceph.com/docs/master/rbd/rbd-openstack/\nã“ã®æ‰‹é †ã‹ã‚‰ä¸‹è¨˜ã®å¤‰æ›´ã‚’è¡Œã£ã¦ã€ã“ã“ã§ã¯è¨˜ã—ã¦ã„ãã¾ã™ã€‚\nNova + Ceph é€£æºã•ã›ãªã„ cinder-backup ã¯ä»Šã®ã¨ã“ã‚å‹•ä½œç¢ºèªå‡ºæ¥ã¦ã„ãªã„ã®ã§çœã è«¸ã€…ã®æ‰‹é †ãŒãã®ã¾ã¾ã§ã¯å®Ÿæ–½å‡ºæ¥ãªã„ã®ã§è£œè¶³ã‚’å…¥ã‚Œã¦ã„ãã€‚ cinder-backup ã¯ Cinder ã§ä½œæˆã—ãŸä»®æƒ³ãƒ‡ã‚£ã‚¹ã‚¯ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ Ceph ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ä¸Šã«å–ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã®ã§ã™ãŒã€ãã‚‚ãã‚‚ Ceph ä¸Šã«ã‚ã‚‹ä»®æƒ³ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ Ceph ã«ãƒãƒƒ ã‚¯ã‚¢ãƒƒãƒ—å–ã£ã¦ã‚‚æ„å‘³ãŒè–„ã„ã§ã™ã—ã€ã¾ã å‹•ã„ã¦ã„ãªã„ã®ã§ä»Šå›ã¯çœãã¾ã™ã€‚LVM ã‚„ã ã®ä»–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ã£ãŸ Cinder é€£æºã‚’ã•ã‚Œã¦ã„ã‚‹æ–¹ã«ã¨ã£ã¦ã¯ cinder-backup ã® Ceph é€£æºã¯æ„å‘³ãŒå¤§ãããªã£ã¦ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\næ§‹æˆ ä¸‹è¨˜ã®é€šã‚Šã®ç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯6ã¤ã®æ§‹æˆã§ã™ã€‚ OpenStack, Ceph å…±ã«æœ€å°æ§‹æˆã‚’å‰æã«ã—ã¾ã™ã€‚\n+--------------------------------------------------------------------- external | +--------------+--(-----------+--------------+------------------------------------------ public | | | | | +------------+ +------------+ +------------+ +------------+ +------------+ +------------+ | controller | | network | | compute | | ceph01 | | ceph02 | | ceph03 | +------------+ +------------+ +------------+ +------------+ +------------+ +------------+ | | | | | | | | | | | | | | | | +--------------+--(-----------+--(-----------+--(--(--------+--(--(--------+--(--(------- management | | | | | | | | | | | +--------------+--(-----------(--(-----------(--(-----------(--(------- guest | | | | | | | | +--------------------------------+-----------+--(-----------+--(-----------+--(------- storage | | | +--------------+--------------+------- cluster ç‰¹å¾´\næœ€å°æ§‹æˆ controller x 1 + network x 1 + compute x 1 + ceph x 3 OpenStack API ã®ç›¸äº’é€šä¿¡ã¯ management ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ OpenStack VM é–“é€šä¿¡ã¯ guest ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ OpenStack å¤–éƒ¨é€šä¿¡ã¯ public ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ OpenStack VM ã® floating-ip (ã‚°ãƒ­ãƒ¼ãƒãƒ«) é€šä¿¡ã¯ external ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ Ceph ã¨ OpenStack é–“ã®é€šä¿¡ã¯ storage ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ Ceph ã® OSD é–“é€šä¿¡ã¯ cluster ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã“ã“ã«ã¯è¨˜ã•ã‚Œã¦ã„ãªã„ãƒ›ã‚¹ãƒˆ \u0026lsquo;workstation\u0026rsquo; ã‹ã‚‰ OpenStack, Ceph ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ å‰æã®æ§‹æˆ å‰ææ§‹æˆã® OpenStack ã¨ Ceph ã§ã™ãŒã€ã“ã“ã§ã¯æ§‹ç¯‰æ–¹æ³•ã¯å‰²æ„›ã—ã¾ã™ã€‚OpenStack ã¯ rcbops/chef-cookbooks ã‚’ã€‚Ceph ã¯ ceph-deploy ã‚’ä½¿ã£ã¦è‡ªåˆ†ã¯æ§‹ç¯‰ã—ã¾ã—ãŸã€‚ ä¸‹è¨˜ã®è‡ªåˆ†ã®ãƒ–ãƒ­ã‚°ã«æ§‹ç¯‰æ‰‹é †ãŒè¼‰ã£ã¦ã„ã‚‹ã®ã§å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\nOpenStack æ§‹ç¯‰æ–¹æ³•\nhttp://jedipunkz.github.io/blog/2013/11/17/openstack-havana-chef-deploy/\nCeph æ§‹ç¯‰æ–¹æ³•\nhttp://jedipunkz.github.io/blog/2014/02/27/journal-ssd-ceph-deploy/\nOpenStack + Ceph é€£æºæ‰‹é † ã§ã¯å®Ÿéš›ã«é€£æºã™ã‚‹ãŸã‚ã®æ‰‹é †ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\nrbd pool ã®ä½œæˆ Ceph ãƒãƒ¼ãƒ‰ã®ä½•ã‚Œã‹ã§ä¸‹è¨˜ã®æ‰‹é †ã‚’å®Ÿæ–½ã— rbd pool ã‚’ä½œæˆã™ã‚‹ã€‚\nceph01% sudo ceph osd pool create volumes 128 ceph01% sudo ceph osd pool create images 128 ceph01% sudo ceph osd pool create backups 128 ssh éµã®é…ç½® Ceph ãƒãƒ¼ãƒ‰ã‹ã‚‰ OpenStack ã® controller, compute ãƒãƒ¼ãƒ‰ã¸æ¥ç¶šå‡ºæ¥ã‚‹ã‚ˆã†éµã‚’é… å¸ƒã—ã¾ã™ã€‚\nceph01% ssh-copy-id \u0026lt;username\u0026gt;@\u0026lt;controller_ip\u0026gt; ceph01% ssh-copy-id \u0026lt;username\u0026gt;@\u0026lt;compute_ip\u0026gt; sudoers ã®è¨­å®š controller, compute ãƒãƒ¼ãƒ‰ä¸Šã§ sudoers ã®è¨­å®šã‚’äºˆã‚å®Ÿæ–½ã™ã‚‹ã€‚ /etc/sudoers.d/ ã¨ã—ã¦ä¿å­˜ã™ã‚‹ã€‚\n\u0026lt;username\u0026gt; ALL = (root) NOPASSWD:ALL ceph ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« controller ãƒãƒ¼ãƒ‰, compute ãƒãƒ¼ãƒ‰ä¸Šã§ Ceph ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚\ncontroller% wget -q -O- \u0026#39;https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc\u0026#39; | sudo apt-key add - controller% echo deb http://ceph.com/debian/ $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/ceph.list controller% sudo apt-get update \u0026amp;\u0026amp; sudo apt-get install -y python-ceph ceph-common compute% wget -q -O- \u0026#39;https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc\u0026#39; | sudo apt-key add - compute% echo deb http://ceph.com/debian/ $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/ceph.list compute% sudo apt-get update \u0026amp;\u0026amp; sudo apt-get install -y python-ceph ceph-common controller ãƒãƒ¼ãƒ‰, compute ãƒãƒ¼ãƒ‰ä¸Šã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚\ncontroller% sudo mkdir /etc/ceph compute % sudo mkdir /etc/ceph ceph.conf ã‚’ controller, compute ãƒãƒ¼ãƒ‰ã¸é…å¸ƒã™ã‚‹ã€‚\nceph01% sudo -i ceph01# ssh \u0026lt;controller_ip\u0026gt; sudo tee /etc/ceph/ceph.conf \u0026lt;/etc/ceph/ceph.conf ceph01# ssh \u0026lt;compute_ip\u0026gt; sudo tee /etc/ceph/ceph.conf \u0026lt;/etc/ceph/ceph.conf ceph ä¸Šã«ãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆ Ceph ä¸Šã« cinder, glance ç”¨ã®æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆã™ã‚‹ã€‚\nceph auth get-or-create client.cinder mon \u0026#39;allow r\u0026#39; osd \u0026#39;allow class-read object_prefix rbd_children, allow rwx pool=volumes, allow rx pool=images\u0026#39; ceph auth get-or-create client.glance mon \u0026#39;allow r\u0026#39; osd \u0026#39;allow class-read object_prefix rbd_children, allow rwx pool=images\u0026#39; ceph auth get-or-create client.cinder-backup mon \u0026#39;allow r\u0026#39; osd \u0026#39;allow class-read object_prefix rbd_children, allow rwx pool=backups\u0026#39; ã‚­ãƒ¼ãƒªãƒ³ã‚°ã®ä½œæˆã¨é…ç½® client.cinder, client.glance, client.cinder-backup ã®ã‚­ãƒ¼ãƒªãƒ³ã‚°ã‚’ä½œæˆã™ã‚‹ã€‚ã¾ãŸä½œæˆã—ãŸã‚­ãƒ¼ãƒªãƒ³ã‚°ã‚’ controller ãƒãƒ¼ãƒ‰ã«é…å¸ƒã™ã‚‹ã€‚\nceph01% sudo ceph auth get-or-create client.glance | ssh {your-glance-api-server} sudo tee /etc/ceph/ceph.client.glance.keyring ceph01% ssh {your-glance-api-server} sudo chown glance:glance /etc/ceph/ceph.client.glance.keyring ceph01% sudo ceph auth get-or-create client.cinder | ssh {your-volume-server} sudo tee /etc/ceph/ceph.client.cinder.keyring ceph01% ssh {your-cinder-volume-server} sudo chown cinder:cinder /etc/ceph/ceph.client.cinder.keyring ceph01% sudo ceph auth get-or-create client.cinder-backup | ssh {your-cinder-backup-server} sudo tee /etc/ceph/ceph.client.cinder-backup.keyring ceph01% ssh {your-cinder-backup-server} sudo chown cinder:cinder /etc/ceph/ceph.client.cinder-backup.keyring client.cinder ã®ã‚­ãƒ¼ãƒªãƒ³ã‚°ã‚’ compute ãƒãƒ¼ãƒ‰ã«é…ç½®ã™ã‚‹ã€‚\nceph01% sudo ceph auth get-key client.cinder | ssh {your-compute-node} tee client.cinder.key libvirt ã¸ã® secret ã‚­ãƒ¼è¿½åŠ  compute ãƒãƒ¼ãƒ‰ä¸Šã§ secret ã‚­ãƒ¼ã‚’ libvirt ã«è¿½åŠ ã™ã‚‹ã€‚\ncompute% uuidgen 457eb676-33da-42ec-9a8c-9293d545c337 cat \u0026gt; secret.xml \u0026lt;\u0026lt;EOF \u0026lt;secret ephemeral=\u0026#39;no\u0026#39; private=\u0026#39;no\u0026#39;\u0026gt; \u0026lt;uuid\u0026gt;457eb676-33da-42ec-9a8c-9293d545c337\u0026lt;/uuid\u0026gt; \u0026lt;usage type=\u0026#39;ceph\u0026#39;\u0026gt; \u0026lt;name\u0026gt;client.cinder secret\u0026lt;/name\u0026gt; \u0026lt;/usage\u0026gt; \u0026lt;/secret\u0026gt; EOF compute % sudo virsh secret-define --file secret.xml Secret 457eb676-33da-42ec-9a8c-9293d545c337 created compute% sudo virsh secret-set-value --secret 457eb676-33da-42ec-9a8c-9293d545c337 --base64 $(cat client.cinder.key) \u0026amp;\u0026amp; rm client.cinder.key secret.xml glance é€£æºæ‰‹é † controller ãƒãƒ¼ãƒ‰ã® /etc/glance/glance-api.conf ã«ä¸‹è¨˜ã‚’è¿½è¨˜ã€‚ default_store=file ã¨æ¨™æº–ã§ã¯ãªã£ã¦ã„ã‚‹ã®ã§ä¸‹è¨˜ã®é€šã‚Š rbd ã«æ›¸ãæ›ãˆã‚‹ã€‚\ndefault_store=rbd rbd_store_user=glance rbd_store_pool=images cinder é€£æºæ‰‹é † controller ãƒãƒ¼ãƒ‰ã® /etc/cinder/cinder.conf ã«ä¸‹è¨˜ã‚’è¿½è¨˜ã€‚ volume_driver ã¯äºˆã‚ LVM ã®è¨­å®šãŒå…¥ã£ã¦ã„ã‚‹ã¨æ€ã‚ã‚Œã‚‹ã®ã§æ›¸ãæ›ãˆã‚‹ã€‚ ã¾ãŸ rbd_secret_uuid ã¯å…ˆã»ã©ç”Ÿæˆã—ãŸ uuid ã‚’è¨˜ã™ã€‚\nvolume_driver=cinder.volume.drivers.rbd.RBDDriver rbd_pool=volumes rbd_ceph_conf=/etc/ceph/ceph.conf rbd_flatten_volume_from_snapshot=false rbd_max_clone_depth=5 glance_api_version=2 rbd_user=cinder rbd_secret_uuid=457eb676-33da-42ec-9a8c-9293d545c337 ceph.conf ã¸ã®è¿½è¨˜ ä¸Šè¨˜ã§é…å¸ƒã—ãŸ ceph.conf ã«ã¯ã‚­ãƒ¼ãƒªãƒ³ã‚°ã®ãƒ‘ã‚¹ãŒè¨˜ã•ã‚Œã¦ã„ãªã„ã€‚controller ãƒãƒ¼ ãƒ‰ä¸Šã® /etc/ceph/ceph.conf ã«ä¸‹è¨˜ã®é€šã‚Šè¿½è¨˜ã™ã‚‹ã€‚\nã“ã“ã¯å…¬å¼ã‚µã‚¤ãƒˆã«ã¯å°ã•ã‚Œã¦ã„ãªã„ã®ã§ãƒãƒã‚Šã¾ã—ãŸã€‚ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚\n[client.keyring] keyring = /etc/ceph/ceph.client.cinder.keyring OpenStack ã®ãã‚Œãã‚Œã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å†èµ·å‹•ã‹ã‘ã‚‹ controller% sudo glance-control api restart compute % sudo service nova-compute restart controller% sudo service cinder-volume restart controller% sudo service cinder-backup restart å‹•ä½œç¢ºèª ã§ã¯å‹•ä½œç¢ºèªã‚’ã€‚Glance ã« OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç™»éŒ²ã€‚ãã®å¾Œãã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å…ƒã«ã‚¤ãƒ³ã‚¹ã‚¿ ãƒ³ã‚¹ã‚’ä½œæˆã€‚Cinder ä¸Šã«ä»®æƒ³ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ä½œæˆã€‚ãã®å¾Œå…ˆã»ã©ä½œæˆã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã« æ¥ç¶šã—ãƒã‚¦ãƒ³ãƒˆã€‚ãã®ãƒã‚¦ãƒ³ãƒˆã—ãŸä»®æƒ³ãƒ‡ã‚£ã‚¹ã‚¯ä¸Šã§æ›¸ãè¾¼ã¿ãŒè¡Œãˆã‚‹ã‹ç¢ºèªã‚’ã—ã¾ã™ã€‚\nãƒ†ã‚¹ãƒˆã§ Ubuntu Precise 12.04 ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ glance ã‚’ç”¨ã„ã¦ç™»éŒ²ã™ã‚‹ã€‚\ncontroller% wget http://cloud-images.ubuntu.com/precise/current/precise-server-cloudimg-amd64-disk1.img controller% glance image-create --name precise-image --is-public true --container-format bare --disk-format qcow2 \u0026lt; precise-server-cloudimg-amd64-disk1.img ãƒ†ã‚¹ãƒˆ VM ã‚’ç¨¼åƒã™ã‚‹ã€‚\ncontroller% nova boot --nic net-id=\u0026lt;net_id\u0026gt; --flavor 2 --image precise-image --key_name novakey01 vm01 controller% cinder create --display-name vol01 1 controller% nova volume-attach \u0026lt;instance_id\u0026gt; \u0026lt;volume_id\u0026gt; auto ãƒ†ã‚¹ãƒˆ VM ã¸ãƒ­ã‚°ã‚¤ãƒ³ã—ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œæˆå¾Œã€ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã€‚\ncontroller% ssh -i \u0026lt;key_file_path\u0026gt; -l ubuntu \u0026lt;instance_ip\u0026gt; vm01% sudo mkfs -t ext4 /dev/vdb vm01% sudo mount -t ext4 /dev/vdb /mnt ãƒã‚¦ãƒ³ãƒˆã—ãŸä»®æƒ³ãƒ‡ã‚£ã‚¹ã‚¯ä¸Šã§ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚“ã§ã¿ã‚‹ã€‚\nvm01% sudo dd if=/dev/zero of=/mnt/500M bs=1M count=5000 ã¾ã¨ã‚ Ceph, Cinder ã® Ceph é€£æºãŒå‡ºæ¥ã¾ã—ãŸï¼\nOpenStack Grizzly ç‰ˆæ™‚ä»£ã« Ceph é€£æºã¯å–ã£ã¦ã„ãŸã®ã§ã™ãŒ Havana ã§ã¯\ncinder-bacup ã® Ceph é€£æº nova ã® Ceph é€£æº ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚Nova é€£æºã‚’ã¨ã‚‹ã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç¨¼åƒã•ã›ã‚‹éš›ã«é€šå¸¸ã¯ controller ãƒãƒ¼ãƒ‰ã® /var/lib/nova é…ä¸‹ã«ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒä½œ æˆã•ã‚Œã¾ã™ãŒã€ã“ã‚ŒãŒ Ceph ä¸Šã«ä½œæˆã•ã‚Œã‚‹ã¨ã®ã“ã¨ã§ã™ã€‚Nova é€£æºã¯æ˜¯éã¨ã£ã¦ã¿ ãŸã„ã®ã§ã™ãŒã€ä»Šã®ã¨ã“ã‚å‹•ã„ã¦ã„ã¾ã›ã‚“ã€‚å¼•ãç¶šãèª¿æŸ»ã‚’è¡Œã„ã¾ã™ã€‚\ncinder-backup ã‚‚å°‘ã—é€£æºå–ã£ã¦ã¿ã¾ã—ãŸãŒ backup_driver ã« Ceph ãƒ‰ãƒ©ã‚¤ãƒã®æŒ‡å®š ã‚’ã—ã¦ã„ã‚‹ã«ã‚‚é–¢ã‚ã‚‰ãš Swift ã«æ¥ç¶šã—ã«ã„ã£ã¦ã—ã¾ã†æœ‰ã‚Šæ§˜ã§ã—ãŸ..ã€‚ã“ã¡ã‚‰ã‚‚å¼• ãç¶šãèª¿æŸ»ã—ã¾ã™ã€‚ã¾ãŸã‚¹ãƒ†ãƒ¼ãƒˆãŒ \u0026lsquo;in-use\u0026rsquo; ã®å ´åˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå–ã‚Œãš \u0026lsquo;available\u0026rsquo; ãªã‚¹ãƒ†ãƒ¼ãƒˆã§ãªã„ã¨ã„ã‘ãªã„ã‚ˆã†ã§ã™ã€‚ç¢ºã‹ã«æ›¸ãè¾¼ã¿ä¸­ã«æ“ä½œãŒè¡Œã‚ã‚Œ ã¦ã—ã¾ã£ã¦ã‚‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®æ•´åˆæ€§ãŒå–ã‚Œãªã„ã§ã™ã—ã€ã“ã“ã¯ä»•æ–¹ãªã„ã¨ã“ã‚ã§ã™ã­ã€‚\n","permalink":"https://jedipunkz.github.io/post/2014/04/04/openstack-havana-cinder-glance-ceph/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ï¼\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ Havana ç‰ˆã® OpenStack Glance, Cinder ã¨åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã® Ceph ã‚’é€£æºã•ã›\nã‚‹æ‰‹é †ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚å…ƒãƒã‚¿ã¯ã“ã¡ã‚‰ã€‚ä¸‹è¨˜ã® Ceph ã®å…¬å¼ã‚µã‚¤ãƒˆã«æ‰‹é †ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://ceph.com/docs/master/rbd/rbd-openstack/\"\u003ehttps://ceph.com/docs/master/rbd/rbd-openstack/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã“ã®æ‰‹é †ã‹ã‚‰ä¸‹è¨˜ã®å¤‰æ›´ã‚’è¡Œã£ã¦ã€ã“ã“ã§ã¯è¨˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNova + Ceph é€£æºã•ã›ãªã„\u003c/li\u003e\n\u003cli\u003ecinder-backup ã¯ä»Šã®ã¨ã“ã‚å‹•ä½œç¢ºèªå‡ºæ¥ã¦ã„ãªã„ã®ã§çœã\u003c/li\u003e\n\u003cli\u003eè«¸ã€…ã®æ‰‹é †ãŒãã®ã¾ã¾ã§ã¯å®Ÿæ–½å‡ºæ¥ãªã„ã®ã§è£œè¶³ã‚’å…¥ã‚Œã¦ã„ãã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ecinder-backup ã¯ Cinder ã§ä½œæˆã—ãŸä»®æƒ³ãƒ‡ã‚£ã‚¹ã‚¯ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ Ceph ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸\nä¸Šã«å–ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã®ã§ã™ãŒã€ãã‚‚ãã‚‚ Ceph ä¸Šã«ã‚ã‚‹ä»®æƒ³ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ Ceph ã«ãƒãƒƒ\nã‚¯ã‚¢ãƒƒãƒ—å–ã£ã¦ã‚‚æ„å‘³ãŒè–„ã„ã§ã™ã—ã€ã¾ã å‹•ã„ã¦ã„ãªã„ã®ã§ä»Šå›ã¯çœãã¾ã™ã€‚LVM ã‚„ã\nã®ä»–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ã£ãŸ Cinder é€£æºã‚’ã•ã‚Œã¦ã„ã‚‹æ–¹ã«ã¨ã£ã¦ã¯ cinder-backup ã®\nCeph é€£æºã¯æ„å‘³ãŒå¤§ãããªã£ã¦ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®é€šã‚Šã®ç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯6ã¤ã®æ§‹æˆã§ã™ã€‚\nOpenStack, Ceph å…±ã«æœ€å°æ§‹æˆã‚’å‰æã«ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e                  +--------------------------------------------------------------------- external\n                  |\n+--------------+--(-----------+--------------+------------------------------------------ public\n|              |  |           |              |\n+------------+ +------------+ +------------+ +------------+ +------------+ +------------+\n| controller | |  network   | |  compute   | |   ceph01   | |   ceph02   | |   ceph03   |\n+------------+ +------------+ +------------+ +------------+ +------------+ +------------+\n|  |           |  |           |  |  |        |  |  |        |  |  |        |  |  |\n+--------------+--(-----------+--(-----------+--(--(--------+--(--(--------+--(--(------- management\n   |              |              |  |           |  |           |  |           |  |\n   |              +--------------+--(-----------(--(-----------(--(-----------(--(------- guest\n   |                                |           |  |           |  |           |  |\n   +--------------------------------+-----------+--(-----------+--(-----------+--(------- storage\n                                                   |              |              |\n                                                   +--------------+--------------+------- cluster\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eç‰¹å¾´\u003c/p\u003e","title":"OpenStack Havana Cinder,Glance ã®åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ Ceph é€£æº"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nè¿½è¨˜ 2014/03/20 : ä¸€æ—¦å‰Šé™¤ã—ã¦ã„ãŸè¨˜äº‹ãªã®ã§ã™ãŒã€ç„¡äº‹å‹•ä½œãŒç¢ºèªå‡ºæ¥ãŸã®ã§å†åº¦ã‚¢ãƒƒ ãƒ—ã—ã¾ã™ï¼\nç¬¬17å› OpenStack å‹‰å¼·ä¼šã§ rcbops/chef-cookbooks ã®è©±ã‚’ã—ã¦ããŸã®ã§ã™ãŒä¼šå ´ã‹ã‚‰ è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚ã€ŒHavana ã® Swift æ§‹æˆã‚’ä½œã‚‹ Cookbooks ã¯ã©ã“ã«ã‚ã‚Šã¾ã™ã‹ï¼Ÿã€ ã¨ã€‚ç§ãŒè©¦ã—ãŸã®ãŒ Grizzly æ™‚ä»£ã®ãƒ¢ãƒã§ã€ã‚ˆã rcbops/chef-cookbooks ã‚’è¦‹ã¦ã¿ã‚‹ ã¨ Havana ãƒ–ãƒ©ãƒ³ãƒåˆã¯ Havana ã«å¯¾å¿œã—ãŸãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã« Swift ãŒ ç¶ºéº—ã‚µãƒƒãƒ‘ãƒªæ¶ˆãˆã¦ã„ã‚‹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ãƒ»ãƒ»ï¼ä¸‹è¨˜ã® Swift ã® Cookbooks ã¯å¹¸ã„ github ä¸Šã«æ®‹ã£ã¦ã„ã¾ã—ãŸã€‚\nhttps://github.com/rcbops-cookbooks/swift\nãŒ rcbops/chef-cookbooks ã¨ã®é–¢é€£ä»˜ã‘ãŒåˆ‡ã‚Œã¦ã„ã¾ã™ãƒ»ãƒ»ã€‚ãã‚ãã€‚\nã¨ã„ã†ã“ã¨ã§ Havana æ§‹æˆã® Keystone 2013.2.2 ã¨ Swift 1.10.0 ã®æ§‹æˆã‚’ Chef ã§ ä½œã‚‰ã­ã°ï¼ã¨æ€ã„è‰²ã€…è©¦ã—ã¦ã„ãŸã‚‰çµæ§‹ã‚ã£ã•ã‚Šã¨å‡ºæ¥ã¾ã—ãŸã€‚ä»Šå›ã¯ãã®æ–¹æ³•ã‚’æ›¸ã„ ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ï¼\næ§‹æˆ æ§‹æˆã¯\u0026hellip;ä»¥å‰ã®è¨˜äº‹ http://jedipunkz.github.io/blog/2013/10/27/swift-chef/ ã¨åŒã˜ã§ã™ã€‚\n+-----------------+ | load balancer | +-----------------+ | +-------------------+-------------------+-------------------+-------------------+---------------------- proxy network | | | | | +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ | chef server | | chef workstation| | swift-mange | | swift-proxy01 | | swift-proxy02 | +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ ...\u0026gt; scaling | | | | | +-------------------+-------------------+-------------------+-------------------+-------------------+-- storage network | | | | | | +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ | swift-storage01 | | swift-storage02 | | swift-storage03 | | swift-account01 | | swift-account02 | | swift-account03 | +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ ..\u0026gt; scaling æ‰‹é † ã§ã¯æ—©é€Ÿæ‰‹é †ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã­ã€‚æ¯å›ãªã®ã§ã™ãŒ Chef ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»Chef ã‚µãƒ¼ãƒã®ç’°å¢ƒæ§‹ç¯‰ã«ã¤ã„ã¦ã¯å‰²æ„›ã—ã¾ã™ã€‚ã‚ªãƒ ãƒ‹ãƒã‚¹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã‚’ä½¿ãˆã° Chef ã‚µãƒ¼ ãƒã®æ§‹ç¯‰ã¯ç°¡å˜ã§ã™ã—ã€ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®æ§‹ç¯‰ã‚‚ Ruby ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« -\u0026gt; gem ã§ Chef ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« -\u0026gt; .chef é…ä¸‹ã‚’æ•´ãˆã‚‹ã€ã§å‡ºæ¥ã¾ã™ã€‚\nrcbops/chef-cookbooks ã®å–å¾—ã€‚ç¾åœ¨ Stable ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® refs/tags/v4.2.1 ã‚’ç”¨ã„ã‚‹ã€‚\n% git clone https://github.com/rcbops/chef-cookbooks.git ./chef-cookbooks-4.2.1 % cd ./chef-cookbooks-4.2.1 % git checkout -b v4.2.1 refs/tags/v4.2.1 % git submodule init % git submodule sync % git submodule update ã“ã“ã§æœ¬å®¶ rcbops/chef-cookbooks ã¨é–¢é€£ä»˜ã‘ãŒæ¶ˆãˆã¦ã„ã‚‹ rcbops-cookbooks/swift ã‚’ cookbooks ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚ã‚ã¨å¿µã®ãŸã‚ \u0026lsquo;havana\u0026rsquo; ãƒ–ãƒ©ãƒ³ãƒ ã‚’æŒ‡å®šã—ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ãŸã¨ã“ã‚ä½•ã‚‚å¤‰åŒ–ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€‚\n% git clone https://github.com/rcbops-cookbooks/swift.git cookbooks/swift % cd cookbooks/swift % git checkout -b havana remotes/origin/havana % cd ../.. cookbooks, roles ã® Chef ã‚µãƒ¼ãƒã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’è¡Œã„ã¾ã™ã€‚\n% knife cookbook upload -o cookbooks -a % knife role from file role/*.rb ä»Šå›ã®æ§‹æˆ (1ã‚¯ãƒ©ã‚¹ã‚¿) ç”¨ã® environments/swift-havana.json ã‚’ä½œæˆã—ã¾ã™ã€‚json ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã¯ä»»æ„ã§ã™ã€‚\n{ \u0026#34;name\u0026#34;: \u0026#34;swift-havana\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;cookbook_versions\u0026#34;: { }, \u0026#34;json_class\u0026#34;: \u0026#34;Chef::Environment\u0026#34;, \u0026#34;chef_type\u0026#34;: \u0026#34;environment\u0026#34;, \u0026#34;default_attributes\u0026#34;: { }, \u0026#34;override_attributes\u0026#34;: { \u0026#34;package_component\u0026#34;: \u0026#34;havana\u0026#34;, \u0026#34;osops_networks\u0026#34;: { \u0026#34;management\u0026#34;: \u0026#34;10.200.9.0/24\u0026#34;, \u0026#34;public\u0026#34;: \u0026#34;10.200.10.0/24\u0026#34;, \u0026#34;swift\u0026#34;: \u0026#34;10.200.9.0/24\u0026#34; }, \u0026#34;keystone\u0026#34;: { \u0026#34;pki\u0026#34;: { \u0026#34;enabled\u0026#34;: false }, \u0026#34;admin_port\u0026#34;: \u0026#34;35357\u0026#34;, \u0026#34;admin_token\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;admin_user\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;tenants\u0026#34;: [ \u0026#34;admin\u0026#34;, \u0026#34;service\u0026#34; ], \u0026#34;users\u0026#34;: { \u0026#34;admin\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;admin\u0026#34;: [ \u0026#34;admin\u0026#34; ] } }, \u0026#34;demo\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;demo\u0026#34;, \u0026#34;default_tenant\u0026#34; : \u0026#34;service\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;admin\u0026#34;: [ \u0026#34;admin\u0026#34; ] } } }, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;keystone\u0026#34; } }, \u0026#34;mysql\u0026#34;: { \u0026#34;root_network_acl\u0026#34;: \u0026#34;%\u0026#34;, \u0026#34;allow_remote_root\u0026#34;: true, \u0026#34;server_root_password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;server_repl_password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;server_debian_password\u0026#34;: \u0026#34;secrete\u0026#34; }, \u0026#34;monitoring\u0026#34;: { \u0026#34;procmon_provider\u0026#34;: \u0026#34;monit\u0026#34;, \u0026#34;metric_provider\u0026#34;: \u0026#34;collectd\u0026#34; }, \u0026#34;vips\u0026#34;: { \u0026#34;keystone-admin-api\u0026#34;: \u0026#34;10.200.9.11\u0026#34;, \u0026#34;keystone-service-api\u0026#34;: \u0026#34;10.200.9.11\u0026#34;, \u0026#34;keystone-internal-api\u0026#34;: \u0026#34;10.200.9.11\u0026#34;, \u0026#34;swift-proxy\u0026#34;: \u0026#34;10.200.9.11\u0026#34;, \u0026#34;config\u0026#34;: { \u0026#34;10.200.9.112\u0026#34;: { \u0026#34;vrid\u0026#34;: 12, \u0026#34;network\u0026#34;: \u0026#34;management\u0026#34; } } }, \u0026#34;developer_mode\u0026#34;: false, \u0026#34;swift\u0026#34;: { \u0026#34;swift_hash\u0026#34;: \u0026#34;307c0568ea84\u0026#34;, \u0026#34;authmode\u0026#34;: \u0026#34;keystone\u0026#34;, \u0026#34;authkey\u0026#34;: \u0026#34;20281b71-ce89-4b27-a2ad-ad873d3f2760\u0026#34; } } } ä½œæˆã—ãŸ environment ãƒ•ã‚¡ã‚¤ãƒ« environments/swift-havana.json ã‚’ chef-server ã¸ã‚¢ãƒƒãƒ— ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚\n% knife environment from file environments/swift-havana.json Cookbooks ã®ä¿®æ­£ swift cookbooks ã‚’ä¿®æ­£ã—ã¾ã™ã€‚havana ã‹ã‚‰ã¯ keystone ã‚’æ‰±ã†ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ keystone.middleware.auth_token ã§ãªã keystoneclient.middleware.auth_token ã‚’ ä½¿ã†ã‚ˆã†ã«å¤‰æ›´æ›ã‹ã£ã¦ã„ã¾ã™ã®ã§ã€ä¸‹è¨˜ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã—ãŸã€‚\n% cd cookbooks/swift/templates/default % diff -u proxy-server.conf.erb.org proxy-server.conf.erb --- proxy-server.conf.erb.org 2014-03-20 16:28:28.000000000 +0900 +++ proxy-server.conf.erb 2014-03-20 16:28:13.000000000 +0900 @@ -243,7 +243,8 @@ use = egg:swift#keystoneauth [filter:authtoken] -paste.filter_factory = keystone.middleware.auth_token:filter_factory +#paste.filter_factory = keystone.middleware.auth_token:filter_factory +paste.filter_factory = keystoneclient.middleware.auth_token:filter_factory auth_host = \u0026lt;%= @keystone_api_ipaddress %\u0026gt; auth_port = \u0026lt;%= @keystone_admin_port %\u0026gt; auth_protocol = \u0026lt;%= @keystone_admin_protocol %\u0026gt; % cd ../../../.. ãƒ‡ãƒ—ãƒ­ã‚¤ ã‹ãã®ã¨ãŠã‚Š knife bootstrap ã™ã‚‹ã€‚\n% knife bootstrap \u0026lt;manage_ip_addr\u0026gt; -N swift-manage -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[mysql-master]\u0026#39;,\u0026#39;role[keystone]\u0026#39;,\u0026#39;role[swift-management-server]\u0026#39; -E swift-havana --sudo -x thirai % knife bootstrap \u0026lt;proxy01_ip_addr\u0026gt; -N swift-proxy01 -r \u0026#34;role[base]\u0026#34;,\u0026#34;role[swift-proxy-server]\u0026#34;,\u0026#39;role[swift-setup]\u0026#39;,\u0026#39;role[openstack-ha]\u0026#39; -E swift-havana --sudo -x thirai % knife bootstrap \u0026lt;proxy02_ip_addr\u0026gt; -N swift-proxy02 -r \u0026#34;role[base]\u0026#34;,\u0026#34;role[swift-proxy-server]\u0026#34;,\u0026#39;role[openstack-ha]\u0026#39; -E swift-havana --sudo -x thirai % knife bootstrap \u0026lt;storage01_ip_addr\u0026gt; -N swift-storage01 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-object-server]\u0026#39; -E swift-havana --sudo -x thirai % knife bootstrap \u0026lt;storage02_ip_addr\u0026gt; -N swift-storage02 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-object-server]\u0026#39; -E swift-havana --sudo -x thirai % knife bootstrap \u0026lt;storage03_ip_addr\u0026gt; -N swift-storage03 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-object-server]\u0026#39; -E swift-havana --sudo -x thirai % knife bootstrap \u0026lt;account01_ip_addr\u0026gt; -N swift-account01 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-account-server]\u0026#39;,\u0026#39;role[swift-container-server]\u0026#39; -E swift-havana --sudo -x thirai % knife bootstrap \u0026lt;account02_ip_addr\u0026gt; -N swift-account02 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-account-server]\u0026#39;,\u0026#39;role[swift-container-server]\u0026#39; -E swift-havana --sudo -x thirai % knife bootstrap \u0026lt;account03_ip_addr\u0026gt; -N swift-account03 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-account-server]\u0026#39;,\u0026#39;role[swift-container-server]\u0026#39; -E swift-havana --sudo -x thirai ã“ã“ã§ãƒã‚°å¯¾ç­–ã€‚Swift 1.10.0 ã«ã¯ãƒã‚°ãŒã‚ã‚‹ã®ã§ä¸‹è¨˜ã®é€šã‚Šå¯¾å‡¦ã—ã¾ã™ã€‚\nkeystone.middleware.s3_token ã«æ—¢çŸ¥ã®ãƒã‚°ãŒã‚ã‚Šã€ä¸‹è¨˜ã®ã‚ˆã†ã«å¯¾å‡¦ã—ã¾ã™ã€‚ã“ã® çŠ¶æ…‹ã§ã¯ãƒã‚°ã«ã‚ˆã‚Š swift-proxy ãŒç¨¼åƒã—ã¦ãªã„çŠ¶æ…‹ã§ã™ãŒå¾Œã®å„ãƒãƒ¼ãƒ‰ã§ã® chef-client å®Ÿè¡Œæ™‚ã«ç¨¼åƒã™ã‚‹äºˆå®šã§ã™ã€‚\n% diff /usr/lib/python2.7/dist-packages/keystone/exception.py.org /usr/lib/python2.7/dist-packages/keystone/exception.py --- exception.py.org 2014-03-12 16:45:00.181420694 +0900 +++ exception.py 2014-03-12 16:44:47.173177081 +0900 @@ -18,6 +18,7 @@ from keystone.common import config from keystone.openstack.common import log as logging +from keystone.openstack.common.gettextutils import _ from keystone.openstack.common import strutils ä¸Šè¨˜ã®ãƒã‚°å ±å‘Šã¯ä¸‹è¨˜ã® URL ã«ã‚ã‚Šã¾ã™ã€‚\nhttps://bugs.launchpad.net/ubuntu/+source/swift/+bug/1231339\nzone ç•ªå·ã‚’ä»˜ä¸ã—ã¾ã™ã€‚\n% knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-storage01\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;1\u0026#39;; n.save }\u0026#34; % knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-account01\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;1\u0026#39;; n.save }\u0026#34; % knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-storage02\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;2\u0026#39;; n.save }\u0026#34; % knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-account02\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;2\u0026#39;; n.save }\u0026#34; % knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-storage03\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;3\u0026#39;; n.save }\u0026#34; % knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-account03\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;3\u0026#39;; n.save }\u0026#34; zone ç•ªå·ãŒä»˜ä¸ã•ã‚ŒãŸã“ã¨ä¸‹è¨˜ã®é€šã‚Šã‚’ç¢ºèªã—ã¾ã™\naccount-server ã®ç¢ºèª\n% knife exec -E \u0026#39;search(:node,\u0026#34;role:swift-account-server\u0026#34;) \\ { |n| z=n[:swift][:zone]||\u0026#34;not defined\u0026#34;; puts \u0026#34;#{n.name} has the role \\ [swift-account-server] and is in swift zone #{z}\u0026#34;; }\u0026#39; swift-account01 has the role [swift-account-server] and is in swift zone 1 swift-account02 has the role [swift-account-server] and is in swift zone 2 swift-account03 has the role [swift-account-server] and is in swift zone 3 container-server ã®ç¢ºèª\n% knife exec -E \u0026#39;search(:node,\u0026#34;role:swift-container-server\u0026#34;) \\ { |n| z=n[:swift][:zone]||\u0026#34;not defined\u0026#34;; puts \u0026#34;#{n.name} has the role \\ [swift-container-server] and is in swift zone #{z}\u0026#34;; }\u0026#39; swift-account01 has the role [swift-container-server] and is in swift zone 1 swift-account02 has the role [swift-container-server] and is in swift zone 2 swift-account03 has the role [swift-container-server] and is in swift zone 3 object-server ã®ç¢ºèª\n% knife exec -E \u0026#39;search(:node,\u0026#34;role:swift-object-server\u0026#34;) \\ { |n| z=n[:swift][:zone]||\u0026#34;not defined\u0026#34;; puts \u0026#34;#{n.name} has the role \\ [swift-object-server] and is in swift zone #{z}\u0026#34;; }\u0026#39; swift-storage01 has the role [swift-object-server] and is in swift zone 1 swift-storage02 has the role [swift-object-server] and is in swift zone 2 swift-storage03 has the role [swift-object-server] and is in swift zone 3 Chef ãŒå„ã€…ã®ãƒãƒ¼ãƒ‰ã«æ­è¼‰ã•ã‚ŒãŸ Disk ã‚’æ¤œçŸ¥å‡ºæ¥ã‚‹ã‹å¦ã‹ã‚’ç¢ºèªã™ã‚‹ã€‚\n% knife exec -E \\ \u0026#39;search(:node,\u0026#34;role:swift-object-server OR \\ role:swift-account-server \\ OR role:swift-container-server\u0026#34;) \\ { |n| puts \u0026#34;#{n.name}\u0026#34;; \\ begin; n[:swift][:state][:devs].each do |d| \\ puts \u0026#34;\\tdevice #{d[1][\u0026#34;device\u0026#34;]}\u0026#34;; \\ end; rescue; puts \\ \u0026#34;no candidate drives found\u0026#34;; end; }\u0026#39; swift-storage02 device sdb1 swift-storage03 device sdb1 swift-account01 device sdb1 swift-account02 device sdb1 swift-account03 device sdb1 swift-storage01 device sdb1 swift-manage ãƒãƒ¼ãƒ‰ã«ã¦ chef-client ã‚’å®Ÿè¡Œã— /etc/swift/ring-workspace/generate-rings.sh ã‚’æ›´æ–°ã—ã¾ã™ã€‚\nswift-manage% sudo chef-client generate-rings.sh ã® \u0026rsquo;exit 0\u0026rsquo; è¡Œã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—å®Ÿè¡Œã—ã¾ã™ã€‚\nswift-manage% sudo ${EDITOR} /etc/swift/ring-workspace/generage-rings.sh swift-manage% sudo /etc/swift/ring-workspace/generate-rings.sh ã“ã®æ“ä½œã§ /etc/swift/ring-workspace/rings é…ä¸‹ã« account, container, object ç”¨ã® Rings ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ãŒç”Ÿæˆã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªå‡ºæ¥ã‚‹ã¯ãšã§ã™ã€‚ã“ã‚Œã‚‰ã‚’ swift-manage ä¸Šã§æ—¢ã«ç¨¼åƒã—ã¦ã„ã‚‹ git ã‚µãƒ¼ãƒã« push ã—ç®¡ç†ã—ã¾ã™ã€‚\nswift-manage# cd /etc/swift/ring-workspace/rings swift-manage# git add account.builder container.builder object.builder swift-manage# git add account.ring.gz container.ring.gz object.ring.gz swift-manage# git commit -m \u0026#34;initial commit\u0026#34; swift-manage# git push å„ã€…ã®ãƒãƒ¼ãƒ‰ã«ã¦ chef-client ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ git ã‚µãƒ¼ãƒä¸Šã® Rings ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ ã‚’å–å¾—ã—ã€swift ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¨¼åƒã•ã›ã¾ã™ã€‚\nswift-proxy01# chef-client swift-proxy02# chef-client swift-storage01# chef-client swift-storage02# chef-client swift-storage03# chef-client swift-account01# chef-client swift-account02# chef-client swift-account03# chef-client 3å°ã®ãƒãƒ¼ãƒ‰ãŒç™»éŒ²ã•ã‚ŒãŸã‹ã©ã†ã‹ã‚’ä¸‹è¨˜ã®é€šã‚Šç¢ºèªè¡Œã„ã¾ã™ã€‚\nswift-proxy01% sudo swift-recon --md5 [sudo] password for thirai: =============================================================================== --\u0026gt; Starting reconnaissance on 3 hosts =============================================================================== [2013-10-18 11:14:43] Checking ring md5sums 3/3 hosts matched, 0 error[s] while checking hosts. =============================================================================== å‹•ä½œç¢ºèª æ§‹ç¯‰ãŒå‡ºæ¥ã¾ã—ãŸï¼ã¨ã„ã†ã“ã¨ã§å‹•ä½œã®ç¢ºèªã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠ \u0026lsquo;container01\u0026rsquo; ã«ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« \u0026rsquo;test\u0026rsquo; ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã¿ã‚‹ã€‚\nswift-storage01% swift -V 2 -A http://\u0026lt;ip_addr_keystone\u0026gt;:5000/v2.0/ -U admin:admin -K secrete stat swift-storage01% swift -V 2 -A http://\u0026lt;ip_addr_keystone\u0026gt;:5000/v2.0/ -U admin:admin -K secrete post container01 swift-storage01% echo \u0026#34;test\u0026#34; \u0026gt; test swift-storage01% swift -V 2 -A http://\u0026lt;ip_addr_keystone\u0026gt;:5000/v2.0/ -U admin:admin -K secrete upload container01 test swift-storage01% swift -V 2 -A http://\u0026lt;ip_addr_keystone\u0026gt;:5000/v2.0/ -U admin:admin -K secrete list container01 swift-storage01% swift -V 2 -A http://\u0026lt;ip_addr_keystone\u0026gt;:5000/v2.0/ -U admin:admin -K secrete list container01 test ã¾ã¨ã‚ å‰å›ã€Œå®Ÿç”¨çš„ãª Swift æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã®è¨˜äº‹ã§è¨˜ã—ãŸå†…å®¹ã¨ã»ã¼æ‰‹é †ã¯å¤‰ ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚rcbops-cookbooks/rcbops-utils å†…ã«ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®å–å¾—å…ˆãƒ¬ãƒã‚¸ ãƒˆãƒªã‚’è¨˜ã™ãƒ¬ã‚·ãƒ”ãŒä¸‹è¨˜ã®å ´æ‰€ã«ã‚ã‚Šã¾ã™ã€‚\nhttps://github.com/rcbops-cookbooks/osops-utils/blob/master/recipes/packages.rb\nãã—ã¦ havana ãƒ–ãƒ©ãƒ³ãƒã® attributes ã‚’ç¢ºèªã™ã‚‹ã¨ Ubuntu Cloud Archive ã® URL ãŒè¨˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªå‡ºæ¥ã¾ã™ã€‚ä¸‹è¨˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚\nhttps://github.com/rcbops-cookbooks/osops-utils/blob/havana/attributes/repos.rb\nãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã®æŠœç²‹ã§ã™ã€‚\n\u0026#34;havana\u0026#34; =\u0026gt; { \u0026#34;uri\u0026#34; =\u0026gt; \u0026#34;http://ubuntu-cloud.archive.canonical.com/ubuntu\u0026#34;, \u0026#34;distribution\u0026#34; =\u0026gt; \u0026#34;precise-updates/havana\u0026#34;, \u0026#34;components\u0026#34; =\u0026gt; [\u0026#34;main\u0026#34;], \u0026#34;keyserver\u0026#34; =\u0026gt; \u0026#34;hkp://keyserver.ubuntu.com:80\u0026#34;, \u0026#34;key\u0026#34; =\u0026gt; \u0026#34;EC4926EA\u0026#34; }, ã“ã‚Œã‚‰ã®ã“ã¨ã‚ˆã‚Šã€rcbops-utils ã® attibutes ã§ havana (å®Ÿéš›ã«ã¯ \u0026lsquo;havana-proposed\u0026rsquo;) ã‚’ãƒ¬ãƒã‚¸ãƒˆãƒªæŒ‡å®šã™ã‚‹ã‚ˆã†ã« Cookbooks æ§‹æˆã‚’ç®¡ç†ã—ã¦ã‚ã’ã‚Œã° Havana æ§‹æˆã® Keystone, Swift ãŒæ§‹ç¯‰å‡ºæ¥ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã¡ãªã¿ã« havana-proposed ã§ Swift ã‚„ Keystone ã®ã©ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ã‹ã¯ã€ ä¸‹è¨˜ã® Packages ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã™ã‚‹ã¨åˆ¤æ–­å‡ºæ¥ã¾ã™ã€‚\nhttp://ubuntu-cloud.archive.canonical.com/ubuntu/dists/precise-proposed/havana/main/binary-amd64/Packages\nä»¥ä¸Šã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2014/03/16/rcbops-chef-cookbooks-keystone-havana-swift-1-10-0.deploy/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003ch4 id=\"è¿½è¨˜\"\u003eè¿½è¨˜\u003c/h4\u003e\n\u003cp\u003e2014/03/20 : ä¸€æ—¦å‰Šé™¤ã—ã¦ã„ãŸè¨˜äº‹ãªã®ã§ã™ãŒã€ç„¡äº‹å‹•ä½œãŒç¢ºèªå‡ºæ¥ãŸã®ã§å†åº¦ã‚¢ãƒƒ\nãƒ—ã—ã¾ã™ï¼\u003c/p\u003e\n\u003cp\u003eç¬¬17å› OpenStack å‹‰å¼·ä¼šã§ rcbops/chef-cookbooks ã®è©±ã‚’ã—ã¦ããŸã®ã§ã™ãŒä¼šå ´ã‹ã‚‰\nè³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚ã€ŒHavana ã® Swift æ§‹æˆã‚’ä½œã‚‹ Cookbooks ã¯ã©ã“ã«ã‚ã‚Šã¾ã™ã‹ï¼Ÿã€\nã¨ã€‚ç§ãŒè©¦ã—ãŸã®ãŒ Grizzly æ™‚ä»£ã®ãƒ¢ãƒã§ã€ã‚ˆã rcbops/chef-cookbooks ã‚’è¦‹ã¦ã¿ã‚‹\nã¨ Havana ãƒ–ãƒ©ãƒ³ãƒåˆã¯ Havana ã«å¯¾å¿œã—ãŸãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã« Swift ãŒ\nç¶ºéº—ã‚µãƒƒãƒ‘ãƒªæ¶ˆãˆã¦ã„ã‚‹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ãƒ»ãƒ»ï¼ä¸‹è¨˜ã® Swift ã® Cookbooks ã¯å¹¸ã„\ngithub ä¸Šã«æ®‹ã£ã¦ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/rcbops-cookbooks/swift\"\u003ehttps://github.com/rcbops-cookbooks/swift\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eãŒ rcbops/chef-cookbooks ã¨ã®é–¢é€£ä»˜ã‘ãŒåˆ‡ã‚Œã¦ã„ã¾ã™ãƒ»ãƒ»ã€‚ãã‚ãã€‚\u003c/p\u003e\n\u003cp\u003eã¨ã„ã†ã“ã¨ã§ Havana æ§‹æˆã® Keystone 2013.2.2 ã¨ Swift 1.10.0 ã®æ§‹æˆã‚’ Chef ã§\nä½œã‚‰ã­ã°ï¼ã¨æ€ã„è‰²ã€…è©¦ã—ã¦ã„ãŸã‚‰çµæ§‹ã‚ã£ã•ã‚Šã¨å‡ºæ¥ã¾ã—ãŸã€‚ä»Šå›ã¯ãã®æ–¹æ³•ã‚’æ›¸ã„\nã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ï¼\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eæ§‹æˆã¯\u0026hellip;ä»¥å‰ã®è¨˜äº‹ \u003ca href=\"http://jedipunkz.github.io/blog/2013/10/27/swift-chef/\"\u003ehttp://jedipunkz.github.io/blog/2013/10/27/swift-chef/\u003c/a\u003e ã¨åŒã˜ã§ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+-----------------+\n|  load balancer  |\n+-----------------+\n|\n+-------------------+-------------------+-------------------+-------------------+---------------------- proxy network\n|                   |                   |                   |                   |                   \n+-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+\n|   chef server   | | chef workstation| |   swift-mange   | |  swift-proxy01  | |  swift-proxy02  | \n+-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ ...\u0026gt; scaling\n|                   |                   |                   |                   |                   \n+-------------------+-------------------+-------------------+-------------------+-------------------+-- storage network\n|                   |                   |                   |                   |                   |\n+-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ \n| swift-storage01 | | swift-storage02 | | swift-storage03 | | swift-account01 | | swift-account02 | | swift-account03 |\n+-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ ..\u0026gt; scaling\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"æ‰‹é †\"\u003eæ‰‹é †\u003c/h2\u003e\n\u003cp\u003eã§ã¯æ—©é€Ÿæ‰‹é †ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã­ã€‚æ¯å›ãªã®ã§ã™ãŒ Chef ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»Chef\nã‚µãƒ¼ãƒã®ç’°å¢ƒæ§‹ç¯‰ã«ã¤ã„ã¦ã¯å‰²æ„›ã—ã¾ã™ã€‚ã‚ªãƒ ãƒ‹ãƒã‚¹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã‚’ä½¿ãˆã° Chef ã‚µãƒ¼\nãƒã®æ§‹ç¯‰ã¯ç°¡å˜ã§ã™ã—ã€ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®æ§‹ç¯‰ã‚‚ Ruby ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« -\u0026gt; gem ã§\nChef ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« -\u0026gt; .chef é…ä¸‹ã‚’æ•´ãˆã‚‹ã€ã§å‡ºæ¥ã¾ã™ã€‚\u003c/p\u003e","title":"rcbops/chef-cookbooks ã§ Keystone 2013.2.2(Havana) + Swift 1.10.0 ã‚’æ§‹ç¯‰"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šã¾ã§ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã® Sensu ã‚„ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã® OpenStackã€ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«ã® Chef ã‚„ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã® Fog ç­‰ä½¿ã£ã¦ãã¾ ã—ãŸãŒã€ã“ã‚Œã‚‰ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ã‚ªãƒ¬ã‚ªãƒ¬ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ©ä½œã‚Œã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ï¼Ÿã¨æ€ã„ã€ ã¡ã‚‡ã‚ã£ã¨ä½œã£ã¦ã¿ã¾ã—ãŸã€‚\nã¡ãªã¿ã«è‡ªåˆ†ã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã—ã‹ã‚‚é‹ç”¨ã®å‡ºèº«ãªã®ã§ Ruby ã«é–¢ã—ã¦ã¯åˆå¿ƒè€… ãƒ¬ãƒ™ãƒ«ã§ã™ã€‚Chef ã§æ‰±ã£ã¦ã„ã‚‹ã®ã¨ Rails ã‚¢ãƒ—ãƒªã‚’ä½œã£ãŸçµŒé¨“ã¯ã‚ã‚Šã¾ã™ãŒã€ãã®ç¨‹ åº¦ã€‚Fog ã¨ã„ã†ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã—ãŸã“ã¨ã¯ã‚¢ãƒªã¾ã™ãŒ..ã€‚ã¡ãª ã¿ã« Fog ã®ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆå†…å®¹ã¯ OpenStack Neutron(å½“æ™‚ Quantum) ã®ä»®æƒ³ãƒ«ãƒ¼ã‚¿ ã®æ“ä½œã‚’è¡Œã†å®Ÿè£…ã§ã™ã€‚\nãã‚“ãªè‡ªåˆ†ã§ã™ãŒ\u0026hellip;è¨­è¨ˆ1å‘¨é–“ãƒ»å®Ÿè£…1å‘¨é–“ã§ãƒãƒãƒ¼ã‚¸ãƒ£ã¨ CLI ãŒå‡ºæ¥ã¾ã—ãŸã€‚ ã¾ãŸæš«ãæ”¾ç½®ã—ã¦ã„ãŸãƒãƒãƒ¼ã‚¸ãƒ£ã¨ CLI ã« WebUI ãã£ã¤ã‘ã‚ˆã†ã‹ãªãï¼Ÿã¨æ€ã£ã¦ sinatra ã®å­¦ç¿’ã‚’å§‹ã‚ãŸã®ã§ã™ãŒã€å­¦ç¿’ã‚’åˆã‚ã¦ 1.5 æ—¥ã§ WebUI ãŒå‹•ãã¨ã“ã‚ã¾ã§è¡Œ ãã¾ã—ãŸã€‚ä½•æ•…ã‹ï¼ŸRuby ã«ã¯æœ‰ç”¨ãªæŠ€è¡“ãŒæƒã£ã¦ã„ã‚‹ã‹ã‚‰ãƒ»ãƒ»ï¼(Â´ï¼›Ï‰ï¼›ï½€)ï¾Œï¾ï¾œï½¯\nã‚ªãƒ¬ã‚ªãƒ¬ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ© \u0026lsquo;sclman\u0026rsquo; ã®ç½®ãå ´æ‰€ https://github.com/jedipunkz/sclman\nã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ +++\næ§‹æˆã¯ï¼Ÿ +-------------- public network +-------------+ | |sclman-api.rb| +----+----+---+ | sclman.rb | | vm | vm |.. | |sclman-cli.rb| +-------------+ +-------------+ +-------------+ +-------------+ | openstack | | chef server | | sensu server| | workstation | +-------------+ +-------------+ +-------------+ +-------------+ | | | | +---------------+---------------+---------------+--------------- management network \u0026lsquo;sclman\u0026rsquo; ã£ã¦ã„ã†åå‰ã§ã™ã€‚ä¸Šå›³ã® workstation ãƒãƒ¼ãƒ‰ã§ç¨¼åƒã—ã¾ã™ã€‚å‡¦ç†ã®æµã‚Œã¯\nå‡¦ç†ã®æµã‚Œ sclman-cli.rb ã‚‚ã—ãã¯ WebUI ã‹ã‚‰ HTTP ã‚¯ãƒ©ã‚¹ã‚¿ã®ã‚»ãƒƒãƒˆã‚’ OpenStack ä¸Šã«ç”Ÿæˆ ç”Ÿæˆã•ã‚ŒãŸ VM ã«å¯¾ã—ã¦ Chef ã§ nginx ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« Chef ã® Roles ã§ã‚ã‚‹ \u0026lsquo;LB\u0026rsquo; ã¨ \u0026lsquo;Web\u0026quot; ãŒåŒä¸€ Envrionment ã«ãªã‚‹ã‚ˆã†ã«ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ— LB VM ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã« Web VM ãŒæŒ‡ã—ç¤ºã•ã‚Œã‚‹ bootstrap ã¨åŒæ™‚ã« sensu-client ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« Web VM ã® load ã‚’ sensu ã§ç›£è¦– sclman.rb (ãƒãƒãƒ¼ã‚¸ãƒ£) ã¯ Sensu AP ã‚’å®šæœŸçš„ã«å©ã„ã¦ Web VM ã® load ã‚’ç›£è¦– load ãŒé«˜ã„ environment ãŒã‚ã‚ŒãŒè©²å½“ environment ã® HTTP ã‚¯ãƒ©ã‚¹ã‚¿ã« VM ã‚’è¿½åŠ  LB VM ã¯è¿½åŠ ã•ã‚ŒãŸ VM ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¿½åŠ  å¼•ãç¶šãç›£è¦–ã—ä¸€å®šæœŸé–“ load ãŒä¸ŠãŒã‚‰ãªã‘ã‚Œ Web VM ã‚’å‰Šé™¤ LB VM ã¯å‰Šé™¤ã•ã‚ŒãŸ VM ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‰Šé™¤ ã¨ã„ã£ãŸæ„Ÿã˜ã§ã™ã€‚è¦ç´„ã™ã‚‹ã¨ CLI/WebUI ã‹ã‚‰ HA ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ä½œæˆã€‚ãã®æ™‚ã« LB, Web ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨åŒæ™‚ã« sensu ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ VM ã«æ”¾ã‚Šè¾¼ã‚€ã€‚ç›£è¦–ã‚’ç¶™ç¶šã—ã¦è²  è·ãŒä¸Šæ˜‡ã™ã‚Œã° Web ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æ•°ã‚’å¢—åŠ ã•ã› LB ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæŒ¯ã‚Šå…ˆã«ã‚‚ãã®è¿½ åŠ ã—ãŸ VM ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ ã€‚é€†ã«è² è·ãŒä¸‹ãŒã‚Œã° VM å‰Šé™¤ã¨å…±ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæŒ¯ã‚Šå…ˆã‚‚ å‰Šé™¤ã€‚ã“ã®é–“ã€äººã®æ‰‹ã‚’ä»‹ã•ãšã«å‡¦ç†ã—ã¦ãã‚Œã‚‹ã€‚ã§ã™ã€‚\nä½¿ã„æ–¹ è©³ç´°ãªä½¿ã„æ–¹ã¯ github ã® README.md ã‚’è¦‹ã¦ä¸‹ã•ã„ã€‚ã“ã“ã«ã¯ç°¡å˜ãªèª¬æ˜ã ã‘æ›¸ã„ã¦ ãŠãã¾ã™ã€‚\nsclman ã‚’ github ã‹ã‚‰å–å¾—ã—ã¦ bundler ã§å¿…è¦ãª gems ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ chef-repo ã«ç§»å‹•ã—ã¦ Berkshelf ã§å¿…è¦ãª cookbooks ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ cookbooks ã‚’ç”¨ã„ã¦ sensu ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚ Omnibus ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ä½¿ã£ã¦ chef ã‚µãƒ¼ãƒã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ OpenStack ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ sclman.conf ã‚’ç’°å¢ƒã«åˆã‚ã›ã¦ä¿®æ­£ã—ã¾ã™ã€‚ sclman.rb (ãƒãƒãƒ¼ã‚¸ãƒ£) ã‚’ç¨¼åƒã—ã¾ã™ã€‚ sclman-api.rb (WebUI/API) ã‚’ç¨¼åƒã—ã¾ã™ã€‚ sclman-cli.rb (CLI) ã‚‚ã—ãã¯ WebUI ã‹ã‚‰æœ€å°æ§‹æˆã® HTTP ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ç¨¼åƒã—ã¾ã™ã€‚ ã“ã®çŠ¶æ…‹ã§ \u0026lsquo;Web\u0026rsquo; Role ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«è² è·ãŒæ›ã‹ã‚‹ã¨ \u0026lsquo;Web\u0026rsquo; Role ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æ•°ãŒå¢—åŠ ã—ã¾ã™ã€‚ ã¾ãŸé€†ã«è² è·ãŒä¸‹ãŒã‚‹ã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ãŒæ¸›ã‚Šã¾ã™ã€‚ è² è·ã®å¢—æ¸›ã®ã‚·ãƒ“ã‚¢ã•ã¯ sclman.conf ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ \u0026lsquo;man_sensitivity\u0026rsquo; ã§æ±ºå®šã—ã¾ã™ã€‚ å€¤ãŒé•·ã‘ã‚Œã°é•·ã„ã»ã©å¢—æ¸›ã®ã—æ˜“ã•ã¯ä½ä¸‹ã—ã¾ã™ã€‚\nã¾ã¨ã‚ +++\nã“ã‚“ãªåƒ•ã§ã‚‚ Ruby ã®å‘¨è¾ºæŠ€è¡“ä½¿ã£ã¦ãªã‚“ã¨ãªãã®å½¢ãŒå‡ºæ¥ã¾ã—ãŸãƒ¼ã€‚ãŸã ã¾ã ã¾ã èª² é¡Œã¯ã‚ã£ã¦ã€ã‚¤ãƒ³ãƒ•ãƒ©ã‚’åˆ¶å¾¡ã™ã‚‹ã‚¢ãƒ—ãƒªã£ã¦ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé›£ã—ã„ã£ã¦ã„ã†ã“ã¨ ã§ã™ã€‚å¸°ã£ã¦ãã‚‹ã‚¨ãƒ©ãƒ¼ã®ä¸€è¦§ãªã©ãŒã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ»ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒª ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã‚Œã°ã„ã„ã®ã ã‘ã©ã€ã¾ã ãã“ã¾ã§è¡Œã£ã¦ãªã„ã€‚Fog ã‚‚ã¾ã ã¾ã çµ¶è³› é–‹ç™ºä¸­ã¨è¨€ã†ã‹ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®é€²åŒ–ã«å¿…æ­»ã§è¿½ã„ã¤ã„ã¦ã„ã‚‹çŠ¶æ…‹ãªã®ã§ã€ åƒ•ã‚‰ãŒã‚¢ãƒ—ãƒªã‚’ä½œã‚‹ã¨ãã«ã¯è‡ªåˆ†ã§ã‚¨ãƒ©ãƒ¼ã‚’å…¨éƒ¨æ´—ã„å‡ºã™ç­‰ã®ä½œæ¥­ãŒå¿…è¦ã«ãªã‚‹ã‹ã‚‚ã— ã‚Œãªã„ã€‚å¤§å¤‰ã ã‘ã©é¢ç™½ã„æ‰€ã§ã‚‚ã‚ã‚Šã¾ã™ã‚ˆã­ï¼ã“ã‚Œã‹ã‚‰ã‚‚æ¥½ã—ã¿ã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2014/03/05/sensu-chef-openstack-fog-autoscaler/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šã¾ã§ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã® Sensu ã‚„ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã® OpenStackã€ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥\nãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«ã® Chef ã‚„ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã® Fog ç­‰ä½¿ã£ã¦ãã¾\nã—ãŸãŒã€ã“ã‚Œã‚‰ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ã‚ªãƒ¬ã‚ªãƒ¬ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ©ä½œã‚Œã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ï¼Ÿã¨æ€ã„ã€\nã¡ã‚‡ã‚ã£ã¨ä½œã£ã¦ã¿ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eã¡ãªã¿ã«è‡ªåˆ†ã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã—ã‹ã‚‚é‹ç”¨ã®å‡ºèº«ãªã®ã§ Ruby ã«é–¢ã—ã¦ã¯åˆå¿ƒè€…\nãƒ¬ãƒ™ãƒ«ã§ã™ã€‚Chef ã§æ‰±ã£ã¦ã„ã‚‹ã®ã¨ Rails ã‚¢ãƒ—ãƒªã‚’ä½œã£ãŸçµŒé¨“ã¯ã‚ã‚Šã¾ã™ãŒã€ãã®ç¨‹\nåº¦ã€‚Fog ã¨ã„ã†ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã—ãŸã“ã¨ã¯ã‚¢ãƒªã¾ã™ãŒ..ã€‚ã¡ãª\nã¿ã« Fog ã®ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆå†…å®¹ã¯ OpenStack Neutron(å½“æ™‚ Quantum) ã®ä»®æƒ³ãƒ«ãƒ¼ã‚¿\nã®æ“ä½œã‚’è¡Œã†å®Ÿè£…ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eãã‚“ãªè‡ªåˆ†ã§ã™ãŒ\u0026hellip;è¨­è¨ˆ1å‘¨é–“ãƒ»å®Ÿè£…1å‘¨é–“ã§ãƒãƒãƒ¼ã‚¸ãƒ£ã¨ CLI ãŒå‡ºæ¥ã¾ã—ãŸã€‚\nã¾ãŸæš«ãæ”¾ç½®ã—ã¦ã„ãŸãƒãƒãƒ¼ã‚¸ãƒ£ã¨ CLI ã« WebUI ãã£ã¤ã‘ã‚ˆã†ã‹ãªãï¼Ÿã¨æ€ã£ã¦\nsinatra ã®å­¦ç¿’ã‚’å§‹ã‚ãŸã®ã§ã™ãŒã€å­¦ç¿’ã‚’åˆã‚ã¦ 1.5 æ—¥ã§ WebUI ãŒå‹•ãã¨ã“ã‚ã¾ã§è¡Œ\nãã¾ã—ãŸã€‚ä½•æ•…ã‹ï¼ŸRuby ã«ã¯æœ‰ç”¨ãªæŠ€è¡“ãŒæƒã£ã¦ã„ã‚‹ã‹ã‚‰ãƒ»ãƒ»ï¼(Â´ï¼›Ï‰ï¼›ï½€)ï¾Œï¾ï¾œï½¯\u003c/p\u003e\n\u003ch2 id=\"ã‚ªãƒ¬ã‚ªãƒ¬ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ©-sclman-ã®ç½®ãå ´æ‰€\"\u003eã‚ªãƒ¬ã‚ªãƒ¬ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ© \u0026lsquo;sclman\u0026rsquo; ã®ç½®ãå ´æ‰€\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/jedipunkz/sclman\"\u003ehttps://github.com/jedipunkz/sclman\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ\n+++\u003c/p\u003e\n\u003cimg src=\"https://raw.github.com/jedipunkz/sclman/master/pix/sclman.png\" width=\"600\"\u003e\n\u003ch2 id=\"æ§‹æˆã¯\"\u003eæ§‹æˆã¯ï¼Ÿ\u003c/h2\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+-------------- public network                  +-------------+\n|                                               |sclman-api.rb|\n+----+----+---+                                 |  sclman.rb  |\n| vm | vm |.. |                                 |sclman-cli.rb|\n+-------------+ +-------------+ +-------------+ +-------------+\n|  openstack  | | chef server | | sensu server| | workstation |\n+-------------+ +-------------+ +-------------+ +-------------+\n|               |               |               |\n+---------------+---------------+---------------+--------------- management network\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u0026lsquo;sclman\u0026rsquo; ã£ã¦ã„ã†åå‰ã§ã™ã€‚ä¸Šå›³ã® workstation ãƒãƒ¼ãƒ‰ã§ç¨¼åƒã—ã¾ã™ã€‚å‡¦ç†ã®æµã‚Œã¯\u003c/p\u003e","title":"Sensu,Chef,OpenStack,Fog ã‚’ä½¿ã£ãŸã‚ªãƒ¬ã‚ªãƒ¬ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ©ã‚’ä½œã£ã¦ã¿ãŸï¼"},{"content":"ã“ã‚“ã«ã¡ã¯ã€@jedipunkz ã§ã™ã€‚\nå‰å›ã€\u0026lsquo;Ceph ã®ãƒ—ãƒ­ã‚»ã‚¹é…ç½®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹\u0026rsquo; ã¨ã„ã†ã‚¿ã‚¤ãƒˆãƒ«ã§è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸã€‚\nhttp://jedipunkz.github.io/blog/2014/01/29/ceph-process-best-practice/\nä»Šå›ã¯ã“ã®è¨˜äº‹ã«ã‚ã‚‹ãƒãƒªã‚·ã«å¾“ã£ã¦ä¸‹è¨˜ã®ã‚ˆã†ãªç‰¹å¾´ã‚’æŒã£ãŸæ§‹æˆã‚’ä½œã‚‹æ‰‹é †ã‚’å…·ä½“ çš„ã«æ›¸ã„ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\nceph01 - ceph04 ã®4å°æ§‹æˆ ãƒãƒ¼ãƒ‰ã« HDD 2å°æ­è¼‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æ (/dev/sdb, /dev/sdc) ãƒãƒ¼ãƒ‰ã« Journal ç”¨ SSD 1å°æ­è¼‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æ (/dev/ssd) ceph04 ã¯ mds ã‚µãƒ¼ãƒ“ã‚¹ç¨¼åƒ ceph05 ã¯ ceph-deploy ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ æœ€çµ‚çš„ã« ceph04 ã‹ã‚‰ Ceph ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ mon ã¯ ãƒãƒ¼ãƒ‰å˜ä½ã§ç¨¼åƒ osd ã¯ HDD å˜ä½ã§ç¨¼åƒ mds ã¯ ceph04 ã«ç¨¼åƒ æ§‹æˆ : ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¨ãƒãƒ¼ãƒ‰ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é–¢ä¿‚ public network +-------------------+-------------------+-------------------+-------------------+--------- | | | | | +--------+--------+ +--------+--------+ +--------+--------+ +--------+--------+ +--------+--------+ | ceph01 | | ceph02 | | ceph03 | | ceph04 | | ceph05 | | +-----+ +-----+ | | +-----+ +-----+ | | +-----+ +-----+ | | | | | | | sdb | | sdc | | | | sdb | | sdc | | | | sdb | | sdc | | | | | | | +-----+-+-----+ | | +-----+-+-----+ | | +-----+-+-----+ | | | | | | | ssd | | | | ssd | | | | ssd | | | | | | | +-------------+ | | +-------------+ | | +-------------+ | | | | | +--------+--------+ +--------+--------+ +--------+--------+ +-----------------+ +-----------------+ | | | cluster network +-------------------+-------------------+------------------------------------------------- æ§‹æˆ : ãƒ—ãƒ­ã‚»ã‚¹ã¨ãƒãƒ¼ãƒ‰ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é–¢ä¿‚ public network +-------------------+-------------------+-------------------+-------------------+--------- | | | | | +--------+--------+ +--------+--------+ +--------+--------+ +--------+--------+ +--------+--------+ | ceph01 | | ceph02 | | ceph03 | | ceph04 | | ceph05 | | +-----+ +-----+ | | +-----+ +-----+ | | +-----+ +-----+ | | +-------------+ | | | | | osd | | osd | | | | osd | | osd | | | | osd | | osd | | | | mds | | | | | +-----+-+-----+ | | +-----+-+-----+ | | +-----+-+-----+ | | +-------------+ | | | | | mon | | | | mon | | | | mon | | | | | | | +-------------+ | | +-------------+ | | +-------------+ | | | | | +--------+--------+ +--------+--------+ +--------+--------+ +-----------------+ +-----------------+ | | | cluster network +-------------------+-------------------+------------------------------------------------- æ³¨æ„ : ä¸Šè¨˜ã®å›³ã ã¨ ssd : mon ãŒå¯¾ã«è¦‹ãˆã¾ã™ãŒã€ãã†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚\nã§ã¯æ§‹ç¯‰æ–¹æ³•ã«ã¤ã„ã¦æ›¸ã„ã¦ã„ãã¾ã™ã€‚\nä½œæ¥­ç”¨ãƒ›ã‚¹ãƒˆã®æº–å‚™ ãƒãƒ³ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã® SSH å…¬é–‹éµãƒ»ç§˜å¯†éµã‚’ç”Ÿæˆã™ã‚‹ã€‚\n% ssh-keygen å…¬é–‹éµã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ›ã‚¹ãƒˆ (ceph01-03) ã«é…ç½®\n% ssh-copy-id ceph@ceph01 % ssh-copy-id ceph@ceph02 % ssh-copy-id ceph@ceph03 ceph-deploy ã®å–å¾—ã‚’è¡Œã†ã€‚\n% git clone https://github.com/ceph/ceph-deploy.git ~/ceph-deploy \u0026lsquo;python-virtualenv\u0026rsquo; ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚\n% sudo apt-get update ; sudo apt-get -y install python-virtualenv ceph-deploy ã‚’ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã™ã‚‹\n% cd ~/ceph-deploy % ./bootstrap PATH ã‚’é€šã™ã€‚ä¸‹è¨˜ã¯ä¾‹ã€‚\n% ${EDITOR} ~/.zshrc export PATH=$HOME/ceph-deploy:$PATH ãƒ›ã‚¹ãƒˆåã®è§£æ±ºã‚’è¡Œã†ã€‚IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä¾‹ã€‚\n% sudo ${EDITOR} /etc/hosts 10.200.10.11 ceph01 10.200.10.12 ceph02 10.200.10.13 ceph03 10.200.10.14 ceph04 10.200.10.15 ceph05 ä¸Šè¨˜ã®æ§‹æˆã®æ§‹ç¯‰æ–¹æ³• ä»¥å‰ã®è¨˜äº‹åŒæ§˜ã« ceph-deploy ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ç”¨ã„ã‚‹ã€‚\nceph-deploy ã«é–¢ã—ã¦ã¯ä¸‹è¨˜ã® URL ã‚’å‚ç…§ã®ã“ã¨ã€‚\nhttps://github.com/ceph/ceph-deploy\nä¸‹è¨˜ã®æ‰‹é †ã§ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨éµã®ç”Ÿæˆã‚’è¡Œã†ã€‚ã¾ãŸã“ã‚Œã‹ã‚‰ã®æ“ä½œã¯ã™ã¹ã¦ public network ä¸Šã® ceph-deploy å°‚ç”¨ node ã‹ã‚‰ã®æ“ä½œã¨ã™ã‚‹ã€‚\n% mkdir ~/ceph-work % cd ~/ceph-work % ceph-deploy --cluster cluster01 new ceph01 ceph02 ceph03 ceph04 ~/ceph-work ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã« cluster01.conf ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã®ã§ä¸‹è¨˜ã®é€šã‚Š cluster network ã‚’æ‰±ã†å½¢ã¸ã¨è¿½è¨˜ã‚’è¡Œã†ã€‚\npublic network = \u0026lt;public_network_addr\u0026gt;/\u0026lt;netmask\u0026gt; cluster network = \u0026lt;cluster_network_addr\u0026gt;/\u0026lt;netmask\u0026gt; [mon.a] host = ceph01 mon addr = \u0026lt;ceph01_ip_addr\u0026gt;:6789 [mon.b] host = ceph02 mon addr = \u0026lt;ceph02_ip_addr\u0026gt;:6789 [mon.c] host = ceph03 mon addr = \u0026lt;ceph03_ip_addr\u0026gt;:6789 [osd.0] public addr = \u0026lt;ceph01_public_ip_addr\u0026gt; cluster addr = \u0026lt;ceph01_cluster_ip_addr\u0026gt; [osd.1] public addr = \u0026lt;ceph01_public_ip_addr\u0026gt; cluster addr = \u0026lt;ceph01_cluster_ip_addr\u0026gt; [osd.2] public addr = \u0026lt;ceph01_public_ip_addr\u0026gt; cluster addr = \u0026lt;ceph01_cluster_ip_addr\u0026gt; [mds.a] host = ceph04 ceph ã®å„ nodes ã¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã†ã€‚ceph ã¯ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚‹ ceph05 ã«ã‚‚ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚å¾Œã« Ceph ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ãŸã‚ã§ã™ã€‚\n% ceph-deploy --cluster cluster01 install ceph01 ceph02 ceph03 ceph04 ceph04 mon ãƒ—ãƒ­ã‚»ã‚¹ã‚’å„ nodes ã§ç¨¼åƒã™ã‚‹ã€‚\n% ceph-deploy --cluster cluster01 mon create ceph01 ceph02 ceph03 éµã®é…å¸ƒã‚’å„ nodes ã«è¡Œã†ã€‚\n% ceph-deploy --cluster cluster01 gatherkeys ceph01 ceph02 ceph03 ceph04 ceph05 disk ã®ãƒªã‚¹ãƒˆã‚’ç¢ºèªã€‚\nå„ node æ¯ã«ç”¨ã„ã‚‹ã“ã¨ãŒå¯èƒ½ã¯ disk ã®ä¸€è¦§ã‚’ç¢ºèªã™ã‚‹ã€‚\n% ceph-deploy --cluster cluster01 disk list ceph01 % ceph-deploy --cluster cluster01 disk list ceph02 % ceph-deploy --cluster cluster01 disk list ceph03 disk ã®åˆæœŸåŒ–ã‚’è¡Œã†ã€‚ã“ã®ä½œæ¥­ã‚’è¡Œã†ã¨æŒ‡å®šãƒ‡ã‚£ã‚¹ã‚¯ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã¯æ¶ˆå»ã•ã‚Œã‚‹ã€‚\n% ceph-deploy --cluster cluster01 disk zap ceph01:/dev/sdb ceph01:/dev/sdc % ceph-deploy --cluster cluster01 disk zap ceph02:/dev/sdb ceph02:/dev/sdc % ceph-deploy --cluster cluster01 disk zap ceph03:/dev/sdb ceph03:/dev/sdc journal ç”¨ã® ssd ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã‚‹ã€‚ã“ã“ã§ã¯ 10GB æ¯ã«åˆ‡ã£ãŸ /dev/ssd1, /dev/ssd2 ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’å‰æã«è¨˜ã™ã€‚ceph ã¨åŒæ™‚ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸ gdisk ã‚’ç”¨ã„ã‚‹ã€‚\n% sudo gdisk /dev/ssd (æ³¨æ„) ä¸‹è¨˜ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ osd prepare, osc activate ã®æ‰‹é †ãŒæ²è¼‰ã•ã‚Œã¦ ã„ã‚‹ãŒãã®å¾Œã® osd create ã®ã‚³ãƒãƒ³ãƒ‰ã«ã¦ prepare ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã§ã“ã‚Œã‚‰2ã¤ã® æ‰‹é †ã‚’è¡Œã†ã¨æ­£å¸¸ã« osd create ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã§ããªã‹ã£ãŸã€‚ã‚ˆã£ã¦ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚° ã«ã¦ osd create ã‚’è¡Œã†ã‚‚ã®ã¨ã™ã‚‹ã€‚\nhttp://ceph.com/docs/master/rados/deployment/ceph-deploy-osd/#prepare-osds http://ceph.com/docs/dumpling/start/quick-ceph-deploy/ 2 ã¤ã® disk ã«å¯¾ã—ã¦ãã‚Œãã‚Œ osd ã‚’ç¨¼åƒã•ã›ã‚‹ã€‚\n% ceph-deploy --cluster cluster01 osd create ceph01:sdb:/dev/ssd1 ceph02:sdb:/dev/ssd1 ceph03:sdb:/dev/ssd1 % ceph-deploy --cluster cluster01 osd create ceph01:sdc:/dev/ssd2 ceph02:sdc:/dev/ssd2 ceph03:sdc:/dev/ssd2 mds ã®ç¨¼åƒã‚’è¡Œã†ã€‚ã“ã“ã§ã¯1å·æ©Ÿã«ã®ã¿ç¨¼åƒã‚’è¡Œã†ã€‚\n% ceph-deploy --cluster cluster01 mds create ceph04 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒã‚¦ãƒ³ãƒˆæ–¹æ³•å„ç¨® ä¸Šè¨˜ã§æ§‹ç¯‰ã—ãŸ Ceph ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã‚’3ã¤èª¬æ˜ã™ã‚‹ã€‚å…ˆã«è¿°ã¹ãŸã‚ˆã†ã« POSIX äº’æ› filesystem ã¨ã—ã¦åˆ©ç”¨ãŒå¯èƒ½ã€‚ãã‚Œãã‚Œ mds ãŒç¨¼åƒã—ã¦ã„ã‚‹ãƒ›ã‚¹ãƒˆã«å¯¾ ã—ã¦æ¥ç¶šã‚’è¡Œã†ã€‚\nBlock Device ã¨ã—ã¦ãƒã‚¦ãƒ³ãƒˆã™ã‚‹æ–¹æ³• ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šã« block device ã‚’ç”Ÿæˆã—ãã‚Œã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹\ncephclient% rbd create foo --size 4096 cephclient% sudo modprobe rbd cephclient% sudo rbd map foo --pool rbd --name client.admin cephclient% sudo mkfs.ext4 -m0 /dev/rbd/rbd/foo cephclient% sudo mkdir /mnt/myrbd cephclinet% sudo mount /dev/rbd/rbd/foo /mnt/myrbd Kernel Driver ã‚’ç”¨ã„ã¦ãƒã‚¦ãƒ³ãƒˆã™ã‚‹æ–¹æ³• kernel Driver ã‚’ç”¨ã„ã¦ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹\ncephclient% sudo mkdir /mnt/mycephfs cephclient% sudo mount -t ceph 10.200.10.26:6789:/ /mnt/mycephfs -o \\ name=admin,secret=`sudo ceph-authtool -p /etc/ceph/cluster01.client.admin.keyring` Fuse Driver (ãƒ¦ãƒ¼ã‚¶ãƒ©ãƒ³ãƒ‰) ã‚’ç”¨ã„ã¦ãƒã‚¦ãƒ³ãƒˆã™ã‚‹æ–¹æ³• ãƒ¦ãƒ¼ã‚¶ãƒ©ãƒ³ãƒ‰ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ FUSE ã‚’ç”¨ã„ã¦ãƒã‚¦ãƒ³ãƒˆã™ã‚‹æ–¹æ³•\ncephclient% sudo mkdir /home/\u0026lt;username\u0026gt;/cephfs cephclient% sudo ceph-fuse -m 10.200.10.26:6789 /home/\u0026lt;username\u0026gt;/cephfs ","permalink":"https://jedipunkz.github.io/post/2014/02/27/journal-ssd-ceph-deploy/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå‰å›ã€\u0026lsquo;Ceph ã®ãƒ—ãƒ­ã‚»ã‚¹é…ç½®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹\u0026rsquo; ã¨ã„ã†ã‚¿ã‚¤ãƒˆãƒ«ã§è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://jedipunkz.github.io/blog/2014/01/29/ceph-process-best-practice/\"\u003ehttp://jedipunkz.github.io/blog/2014/01/29/ceph-process-best-practice/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ã“ã®è¨˜äº‹ã«ã‚ã‚‹ãƒãƒªã‚·ã«å¾“ã£ã¦ä¸‹è¨˜ã®ã‚ˆã†ãªç‰¹å¾´ã‚’æŒã£ãŸæ§‹æˆã‚’ä½œã‚‹æ‰‹é †ã‚’å…·ä½“\nçš„ã«æ›¸ã„ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eceph01 - ceph04 ã®4å°æ§‹æˆ\u003c/li\u003e\n\u003cli\u003eãƒãƒ¼ãƒ‰ã« HDD 2å°æ­è¼‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æ (/dev/sdb, /dev/sdc)\u003c/li\u003e\n\u003cli\u003eãƒãƒ¼ãƒ‰ã« Journal ç”¨ SSD 1å°æ­è¼‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æ (/dev/ssd)\u003c/li\u003e\n\u003cli\u003eceph04 ã¯ mds ã‚µãƒ¼ãƒ“ã‚¹ç¨¼åƒ\u003c/li\u003e\n\u003cli\u003eceph05 ã¯ ceph-deploy ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³\u003c/li\u003e\n\u003cli\u003eæœ€çµ‚çš„ã« ceph04 ã‹ã‚‰ Ceph ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹\u003c/li\u003e\n\u003cli\u003emon ã¯ ãƒãƒ¼ãƒ‰å˜ä½ã§ç¨¼åƒ\u003c/li\u003e\n\u003cli\u003eosd ã¯ HDD å˜ä½ã§ç¨¼åƒ\u003c/li\u003e\n\u003cli\u003emds ã¯ ceph04 ã«ç¨¼åƒ\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"æ§‹æˆ--ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¨ãƒãƒ¼ãƒ‰ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é–¢ä¿‚\"\u003eæ§‹æˆ : ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¨ãƒãƒ¼ãƒ‰ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é–¢ä¿‚\u003c/h2\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e                                                                                      public network\n         +-------------------+-------------------+-------------------+-------------------+---------\n         |                   |                   |                   |                   |\n+--------+--------+ +--------+--------+ +--------+--------+ +--------+--------+ +--------+--------+\n|      ceph01     | |      ceph02     | |      ceph03     | |      ceph04     | |      ceph05     |\n| +-----+ +-----+ | | +-----+ +-----+ | | +-----+ +-----+ | |                 | |                 |\n| | sdb | | sdc | | | | sdb | | sdc | | | | sdb | | sdc | | |                 | |                 |\n| +-----+-+-----+ | | +-----+-+-----+ | | +-----+-+-----+ | |                 | |                 |\n| |     ssd     | | | |     ssd     | | | |     ssd     | | |                 | |                 |\n| +-------------+ | | +-------------+ | | +-------------+ | |                 | |                 |\n+--------+--------+ +--------+--------+ +--------+--------+ +-----------------+ +-----------------+\n         |                   |                   |                                    cluster network\n         +-------------------+-------------------+-------------------------------------------------\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"æ§‹æˆ--ãƒ—ãƒ­ã‚»ã‚¹ã¨ãƒãƒ¼ãƒ‰ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é–¢ä¿‚\"\u003eæ§‹æˆ : ãƒ—ãƒ­ã‚»ã‚¹ã¨ãƒãƒ¼ãƒ‰ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é–¢ä¿‚\u003c/h2\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e                                                                                      public network\n         +-------------------+-------------------+-------------------+-------------------+---------\n         |                   |                   |                   |                   |\n+--------+--------+ +--------+--------+ +--------+--------+ +--------+--------+ +--------+--------+\n|      ceph01     | |      ceph02     | |      ceph03     | |      ceph04     | |      ceph05     |\n| +-----+ +-----+ | | +-----+ +-----+ | | +-----+ +-----+ | | +-------------+ | |                 |\n| | osd | | osd | | | | osd | | osd | | | | osd | | osd | | | |     mds     | | |                 |\n| +-----+-+-----+ | | +-----+-+-----+ | | +-----+-+-----+ | | +-------------+ | |                 |\n| |     mon     | | | |     mon     | | | |     mon     | | |                 | |                 |\n| +-------------+ | | +-------------+ | | +-------------+ | |                 | |                 |\n+--------+--------+ +--------+--------+ +--------+--------+ +-----------------+ +-----------------+\n         |                   |                   |                                    cluster network\n         +-------------------+-------------------+-------------------------------------------------\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæ³¨æ„ : ä¸Šè¨˜ã®å›³ã ã¨ ssd : mon ãŒå¯¾ã«è¦‹ãˆã¾ã™ãŒã€ãã†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚\u003c/p\u003e","title":"Journal ç”¨ SSD ã‚’ç”¨ã„ãŸ Ceph æ§‹æˆã®æ§‹ç¯‰"},{"content":"Ceph ã¯ãƒ–ãƒ­ãƒƒã‚¯å‹ã®åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚POSIX ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ† ãƒ ã¨ã—ã¦ãƒã‚¦ãƒ³ãƒˆå‡ºæ¥ã¾ã™ã€‚Linux ã® Kernel ãƒ‰ãƒ©ã‚¤ãƒã‚„ FUSE ãƒ‰ãƒ©ã‚¤ãƒã‚’ç”¨ã„ã¦ãƒã‚¦ ãƒ³ãƒˆã—ã¾ã™ã€‚ã¾ãŸãƒ–ãƒ­ãƒƒã‚¯ãƒ‡ãƒã‚¤ã‚¹ã¨ã—ã¦ãƒã‚¦ãƒ³ãƒˆã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚\nã ã„ã¶å‰ã§ã™ãŒã€Ceph ã«é–¢ã™ã‚‹è¨˜äº‹ã‚’ä»¥å‰ä¸‹è¨˜ã®é€šã‚Šæ›¸ãã¾ã—ãŸã€‚\nhttp://jedipunkz.github.io/blog/2013/05/25/ceph-cluster-network/ http://jedipunkz.github.io/blog/2013/05/11/ceph-deploy/ Ceph ã®æ§‹ç¯‰æ–¹æ³•ã«ã¤ã„ã¦è¨˜ã—ãŸãƒ–ãƒ­ã‚°ã ã£ãŸã®ã§ã™ãŒã€ä»Šã¾ã§ mon, osd, mds ã®å„ãƒ— ãƒ­ã‚»ã‚¹ã‚’ãã‚Œãã‚Œä½•å°ã®ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦é…ç½®ã—ã€ã¾ãŸãã‚Œãã‚Œã®ãƒ—ãƒ­ã‚»ã‚¹å¹¾ã¤ã‚’ä½•ã«å¯¾ ã—ã¦é…ç½®ã™ã‚‹ã®ã‹ï¼Ÿã¨ã„ã†ç–‘å•ãŒä»˜ãã¾ã¨ã‚ã£ã¦ã„ã¾ã—ãŸã€‚node, disk, process ã®ã ã‚Œãã‚Œã®æ•°ã®é–¢ä¿‚ã«ã¤ã„ã¦çŸ¥ã‚ŠãŸã„ãªãã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚å¹¾ã¤ã‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ ã‚“ã§ã„ã¦ã€ã¼ã‚“ã‚„ã‚Šè¦‹ãˆã¦ããŸäº‹ãŒã‚ã‚‹ã®ã§ãã‚Œã‚’ä»Šå›ã¯ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nã¾ãŸã€çš†ã•ã‚“æ°—ã«ãªã‚‹ãƒˆã‚³ãƒ­ã ã¨æ€ã‚ã‚Œã‚‹å®¹é‡è¨­è¨ˆã«ã¤ã„ã¦ã‚‚è»½ãè§¦ã‚ŒãŸã„ã¨æ€ã„ã¾ã™ã€‚\nå‚è€ƒè³‡æ–™ http://ceph.com/docs/master/rados/configuration/mon-config-ref/ http://www.sebastien-han.fr/blog/2013/12/02/ceph-performance-interesting-things-going-on/ å„è¦ç´ ã®æ•°ã®é–¢ä¿‚ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢è¦ç´ ã§ã‚ã‚‹ node, disk(hdd), ssd ãã—ã¦ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¦ç´ ã§ã‚ã‚‹ mon, osd, mds ã®æ•°ã®é–¢ä¿‚ã¯ã©ã®ã‚ˆã†ã«ã™ã‚‹ã¹ãã‹ï¼ŸåŸºæœ¬ã¨ãªã‚‹é–¢ä¿‚ã¯\n1 mds process / node 1 mon process / node 1 osd process / disk n jornal ssd device / disk / node ã ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚åƒ•ãŒä»Šã®ã¨ã“ã‚ç†æƒ³ã‹ãªãã¨æ€ã£ã¦ã„ã‚‹æ§‹æˆã‚’ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾ ã™ã€‚\nä¸‹è¨˜ã®å›³ãŒãã‚Œã§ã™ã€‚\n+------------------------+ | client | +------------------------+ | +--------------------------+--------------------------+-------------------------------+------------------------- | | | | public network +------------------------+ +------------------------+ +------------------------+ +------------------------+ | mon | | mon | | mon | | mds | +------+ +------+ +------+ +------+ +------+ +------+ +------+ +------+ +------+ +------------------------+ | osd | | osd | | osd | | osd | | osd | | osd | | osd | | osd | | osd | | | +------+ +------+ +------+ +------+ +------+ +------+ +------+ +------+ +------+ | | | disk | | disk | | disk | | disk | | disk | | disk | | disk | | disk | | disk |....\u0026gt; | | +------+ +------+ +------+ +------+ +------+ +------+ +------+ +------+ +------+scale | node | | ssd | | ssd | | ssd | | | +------------------------+ +------------------------+ +------------------------+ | | | node | | node | | node | | | +------------------------+ +------------------------+ +------------------------+ +------------------------+ | | | | +--------------------------+--------------------------+-------------------------------+------------------------- cluster network mds ã¨ node ã®é–¢ä¿‚ mds ã¯ãƒªãƒ¢ãƒ¼ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ã‚’è¡Œã†ã“ã¨ã‚„ç‰¹æ€§ãŒ å…¨ãç•°ãªã‚‹ã“ã¨ã‹ã‚‰åˆ¥ãƒãƒ¼ãƒ‰ã«åˆ‡ã‚Šå‡ºã—ã¾ã—ãŸã€‚ã¾ãŸ mds ã¯å¹¾ã¤ã‹ã®ãƒãƒ¼ãƒ‰ã§ç¨¼åƒã• ã›ã‚‹äº‹ã‚‚å¯èƒ½ã€‚ãŒã€mds ã¯ãã‚Œãã‚Œã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ HA çµ„ã‚€ä»•çµ„ã¿ã¯æŒã£ã¦ã„ãªã„ã®ã§ ã©ã‚Œã‹ä¸€æ–¹ã® mds ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯æŒ‡ã—ç¤ºã™å¿…è¦ãŒã‚ã‚Šã€ãã® mds ãŒåœæ­¢ã™ã‚Œã°ç›´ ã¡ã«éšœå®³ã«ç™ºå±•ã—ã¾ã™ã€‚\nmon ã¨ node ã®é–¢ä¿‚ mon ã¯æ¯”è¼ƒçš„å°‘é‡ã®ãƒªã‚½ãƒ¼ã‚¹ã§ç¨¼åƒã—ã¾ã™ã€‚ä»Šå› osd ã¨åŒã˜ãƒãƒ¼ãƒ‰ã®æ­è¼‰ã—ã¾ã—ãŸãŒ åˆ¥ãƒãƒ¼ãƒ‰ã«åˆ‡ã‚Šå‡ºã™ã“ã¨ã‚‚å‹¿è«–å¯èƒ½ã§ã™ã€‚mon ã¯ CRUSH Maps ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å…ƒã«é€£æº ãŒå–ã‚Œã¾ã™ã®ã§è¤‡æ•°ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¨¼åƒã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã‚‚ã€æ¯”è¼ƒçš„å°‘ ãªã„ãƒãƒ¼ãƒ‰æ•°ã®ã‚¯ãƒ©ã‚¹ã‚¿ã®å ´åˆã¯ osd ã¨åŒãƒãƒ¼ãƒ‰ã«æ­è¼‰ã™ã‚‹ã®ãŒå®¹æ˜“ã‹ãªã¨è€ƒãˆã¾ã— ãŸã€‚\nosd ã¨ node ã®é–¢ä¿‚ 1 osd ãƒ—ãƒ­ã‚»ã‚¹ã«å¯¾ã—ã¦ 1 disk ãŒåŸºæœ¬ã¨ãªã‚Šã¾ã™ã€‚osd ã¯å®Ÿãƒ‡ãƒ¼ã‚¿ã®ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ ãƒ³ã‚’è¡Œã†ã“ã¨ã‹ã‚‰ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ä¸Šå›³ã®æ§˜ã«ã‚¯ãƒ©ã‚¹ã‚¿ç”¨ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ ã‚¯ã‚’ç´ä»˜ã‘ã€é«˜ãƒˆãƒ©ãƒ’ãƒƒã‚¯ã«å¯¾å¿œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸ osd ç”¨ã® disk device ã§ ã™ãŒ RAID ã‚’çµ„ã¾ãªã„ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚CEPH è‡ªä½“ã« HA ã®ä»•çµ„ã¿ãŒã‚ã‚‹ã“ã¨ã€ ã¾ãŸ RAID æ§‹æˆã«ã‚‚ã‚ˆã‚Šã¾ã™ãŒãƒ‡ã‚£ã‚¹ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãŒé…ããªã‚‹ã“ã¨ã¯ Ceph ã«ã¨ã£ã¦ãƒœãƒˆ ãƒ«ãƒãƒƒã‚¯ã‚’æ—©ãæ‹›ãã“ã¨ã«ãªã‚Šã¾ã™ã—ã€å°ã•ã„ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã—ã‹æ‰±ãˆãªããªã‚‹ã“ã¨ã¯ Ceph ã«ã¨ã£ã¦ä¸åˆ©ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚\njournal ç”¨ã® ssd device ã¨ disk, node ã®é–¢ä¿‚ ç¾åœ¨ã® Stable Release ç‰ˆã® Ceph ã¯ journal ã‚’ç”¨ã„ã¦ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã—ã¾ã™ã€‚å„ osd ã® disk å˜ä½ã« journal ç”¨ã® disk device ã‚’æŒ‡å®šå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚ãƒ¡ ã‚¿ãƒ‡ãƒ¼ã‚¿ã§ã™ã®ã§å®Ÿãƒ‡ãƒ¼ã‚¿ç”¨ã® disk ã‚ˆã‚Šã ã„ã¶å°ã•ãªå®¹é‡ã§æ§‹ã‚ãªã„ã“ã¨ã€ã¾ãŸæ¯”è¼ƒ çš„é«˜é€Ÿãªã‚¢ã‚¯ã‚»ã‚¹ã‚’è¦æ±‚ã•ã‚Œã‚‹ã“ã¨ã‹ã‚‰ã‚‚ SSD ã‚’é¸æŠã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¤ã¤ã‚ã‚‹ã‚ˆ ã†ã§ã™ã€‚å®Ÿéš›ã«ã‚¹ãƒˆã‚¢ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã®ç‰¹æ€§ã«ã‚‚ã‚ˆã‚Šã¾ã™ãŒ 1 node ã«å¯¾ã—ã¦ 1 ssd device ã‚’é…ç½®ã™ã‚Œã°ååˆ†ã‹ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸ osd ã®ãƒ—ãƒ­ã‚»ã‚¹ã®æ•° (disk ã®æ•°) ã«å¯¾ ã—ã¦ä¸€ã¤ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã‚‹ã“ã¨ã§å¯¾å¿œå‡ºæ¥ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚\nè¨­å®šæ–¹æ³•ã®ä¾‹ã‚’è¨˜ã—ã¾ã™ã€‚ã“ã“ã« ceph01-03 ã®3å°ã®ãƒãƒ¼ãƒ‰ãŒã‚ã‚Šãã‚Œãã‚Œ 2 disk, 1 ssd ãŒæ­è¼‰ã•ã‚Œã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚/dev/ssd ã¯ gdisk ç­‰ã‚’ç”¨ã„ã¦2ã¤ä»¥ä¸Šã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ ãƒ³ã«åˆ‡ã‚Šåˆ†ã‘ã¾ã™ã€‚\nä¸‹è¨˜ã®ã‚ˆã†ã« /dev/sdb (hdd) ã«å¯¾ã—ã¦ /dev/ssd1 (ssd), /dev/sdc (hdd) ã«å¯¾ã—ã¦ /dev/ssd2 (ssd) ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\n% ceph-deploy --cluster cluster01 osd create ceph01:sdb:/dev/ssd1 ceph02:sdb:/dev/ssd1 ceph03:sdb:/dev/ssd1 % ceph-deploy --cluster cluster01 osd create ceph01:sdc:/dev/ssd2 ceph02:sdc:/dev/ssd2 ceph03:sdc:/dev/ssd2 Ceph ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å…¨ä½“ã®å®¹é‡è¨­è¨ˆã¨ mon ã® ratio ã®é–¢ä¿‚ 3TB ã®ãƒ‡ã‚£ã‚¹ã‚¯ã‚’æŒã£ãŸãƒãƒ¼ãƒ‰ãŒ 33 å°ä¸¦ã‚“ã§ã„ã‚‹ã¨ã—ã¾ã™ã€‚å„ãƒãƒ¼ãƒ‰ã«ã¯ osd ãƒ—ãƒ­ ã‚»ã‚¹ãŒ1ã¤ç¨¼åƒã—ã¾ã™ã€‚åˆè¨ˆå®¹é‡ã¯ 99 TB ã¨ãªã‚Šã¾ã™ãŒ mon ãŒæŒã£ã¦ã„ã‚‹ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚‹ full ratio ã¨ã„ã†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚Šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒ 0.95 ã¨ãªã£ã¦ ã„ã¾ã™ã€‚ã‚ˆã£ã¦ã“ã®ã‚¯ãƒ©ã‚¹ã‚¿ã§æ‰±ãˆã‚‹å…¨ä½“ã®ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã¯ 95TB ã¨ãªã‚Šã¾ã™ã€‚\nã¾ãŸã€ãƒ©ãƒƒã‚¯ã«æ•°å°ã®ãƒãƒ¼ãƒ‰ã‚’ç©ã‚€ã®ãŒé€šå¸¸ã§ã™ãŒã€é›»æºæ•…éšœç­‰ã§ä¸€æ°—ã«ãƒ©ãƒƒã‚¯å˜ä½ã§ éšœå®³ãŒç™ºç”Ÿã—ãŸã¨ã—ã¾ã™ã€‚ã“ã®å ´åˆ Ceph ã¯ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã«é–¢ã—ã¦ãƒ¬ãƒ—ãƒªã‚«ã‚’å–ã‚Šå¾© æ—§ä½œæ¥­ã‚’è¡Œã„ã¾ã™ã€‚ã—ã‹ã—ãªãŒã‚‰åœæ­¢ã™ã‚‹ãƒãƒ¼ãƒ‰æ•°ã«ã‚ˆã£ã¦ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å…¨ä½“ã®æ‰±ãˆã‚‹ å®¹é‡ã‚’ã‚ªãƒ¼ãƒãƒ¼ã™ã‚‹ã“ã¨ã‚‚æ‡¸å¿µã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«å¯¾å¿œã™ã‚‹ãŸã‚ã«å…ˆã»ã©ç™»å ´ã—ãŸ ratio ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª¿æ•´ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\n[global] mon osd full ratio = .80 mon osd nearfull ratio = .70 ä¸Šè¨˜ã®ä¾‹ã§ã¯ full ã‚¹ãƒ†ãƒ¼ãƒˆã® ratio ãŒ 0.80, nearfull ã‚¹ãƒ†ãƒ¼ãƒˆã® ratio ãŒ 0.70 ã¨ãªã‚Šã¾ã™ã€‚æƒ³å®šã®éšœå®³ãƒãƒ¼ãƒ‰æ•°ã‚’è€ƒæ…®ã— ratio ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¦ãã®å°æ•°åˆ†ã‚’æ¸›ç®—ã™ ã‚Œã°è‰¯ã„ã‚ã‘ã§ã™ã€‚\nã¾ã¨ã‚ å‰è¿°ã—ãŸé€šã‚Šä¸Šå›³ã¯æ¯”è¼ƒçš„å°‘ãªã„ãƒãƒ¼ãƒ‰æ•°ã®ã‚¯ãƒ©ã‚¹ã‚¿ã‚’çµ„ã‚€å ´åˆã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚ãƒãƒ¼ ãƒ‰æ•°ãŒå¢—ãˆã‚‹å ´åˆã¯ mon ã¯ mds, osd ã¨ã‚‚å¿…è¦ã¨ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®ç‰¹æ€§ãŒç•°ãªã‚Šã¾ã™ã® ã§åˆ¥ãƒãƒ¼ãƒ‰ã«åˆ‡ã‚Šå‡ºã™ã“ã¨ã‚‚è€ƒãˆãŸã»ã†ãŒè‰¯ã•ãã†ã§ã™ã€‚2014å¹´ã®2æœˆã«ã¯ Firefly ã¨ ã„ã†æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ç‰ˆãŒå‡ºã¾ã™ã€‚ã“ã“ã§ã®ãƒ–ãƒ«ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ(è¨­è¨ˆæ›¸)ã‚’ç¢ºèªã™ã‚‹ã¨\u0026hellip;\nhttp://wiki.ceph.com/Planning/Blueprints/Firefly/osd%3A_new_key%2F%2Fvalue_backend\njournal ã«å¤‰ã‚ã‚‹æ–°ãŸãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†æ–¹æ³•ã¨ã—ã¦ KVS ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ‰±ã†ã“ã¨ã‚‚è¦– é‡ã«å…¥ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ä¸Šè¨˜ã® URL è¦‹ã‚‹é™ã‚Šã§ã¯ Facebook ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã«ã— ãŸ rocksdb ã‚„ fusionio ã® nvmkv, seagate ã® kinetic ç­‰ãŒæŒ™ãŒã£ã¦ã„ã¾ã™ã€‚2æœˆã« æœŸå¾…ã—ã¾ã—ã‚‡ã†ï¼\n","permalink":"https://jedipunkz.github.io/post/2014/01/29/ceph-process-best-practice/","summary":"\u003cp\u003eCeph ã¯ãƒ–ãƒ­ãƒƒã‚¯å‹ã®åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚POSIX ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†\nãƒ ã¨ã—ã¦ãƒã‚¦ãƒ³ãƒˆå‡ºæ¥ã¾ã™ã€‚Linux ã® Kernel ãƒ‰ãƒ©ã‚¤ãƒã‚„ FUSE ãƒ‰ãƒ©ã‚¤ãƒã‚’ç”¨ã„ã¦ãƒã‚¦\nãƒ³ãƒˆã—ã¾ã™ã€‚ã¾ãŸãƒ–ãƒ­ãƒƒã‚¯ãƒ‡ãƒã‚¤ã‚¹ã¨ã—ã¦ãƒã‚¦ãƒ³ãƒˆã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã ã„ã¶å‰ã§ã™ãŒã€Ceph ã«é–¢ã™ã‚‹è¨˜äº‹ã‚’ä»¥å‰ä¸‹è¨˜ã®é€šã‚Šæ›¸ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://jedipunkz.github.io/blog/2013/05/25/ceph-cluster-network/\"\u003ehttp://jedipunkz.github.io/blog/2013/05/25/ceph-cluster-network/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://jedipunkz.github.io/blog/2013/05/11/ceph-deploy/\"\u003ehttp://jedipunkz.github.io/blog/2013/05/11/ceph-deploy/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eCeph ã®æ§‹ç¯‰æ–¹æ³•ã«ã¤ã„ã¦è¨˜ã—ãŸãƒ–ãƒ­ã‚°ã ã£ãŸã®ã§ã™ãŒã€ä»Šã¾ã§ mon, osd, mds ã®å„ãƒ—\nãƒ­ã‚»ã‚¹ã‚’ãã‚Œãã‚Œä½•å°ã®ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦é…ç½®ã—ã€ã¾ãŸãã‚Œãã‚Œã®ãƒ—ãƒ­ã‚»ã‚¹å¹¾ã¤ã‚’ä½•ã«å¯¾\nã—ã¦é…ç½®ã™ã‚‹ã®ã‹ï¼Ÿã¨ã„ã†ç–‘å•ãŒä»˜ãã¾ã¨ã‚ã£ã¦ã„ã¾ã—ãŸã€‚node, disk, process ã®ã\nã‚Œãã‚Œã®æ•°ã®é–¢ä¿‚ã«ã¤ã„ã¦çŸ¥ã‚ŠãŸã„ãªãã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚å¹¾ã¤ã‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­\nã‚“ã§ã„ã¦ã€ã¼ã‚“ã‚„ã‚Šè¦‹ãˆã¦ããŸäº‹ãŒã‚ã‚‹ã®ã§ãã‚Œã‚’ä»Šå›ã¯ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãŸã€çš†ã•ã‚“æ°—ã«ãªã‚‹ãƒˆã‚³ãƒ­ã ã¨æ€ã‚ã‚Œã‚‹å®¹é‡è¨­è¨ˆã«ã¤ã„ã¦ã‚‚è»½ãè§¦ã‚ŒãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒè³‡æ–™\"\u003eå‚è€ƒè³‡æ–™\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://ceph.com/docs/master/rados/configuration/mon-config-ref/\"\u003ehttp://ceph.com/docs/master/rados/configuration/mon-config-ref/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.sebastien-han.fr/blog/2013/12/02/ceph-performance-interesting-things-going-on/\"\u003ehttp://www.sebastien-han.fr/blog/2013/12/02/ceph-performance-interesting-things-going-on/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å„è¦ç´ ã®æ•°ã®é–¢ä¿‚\"\u003eå„è¦ç´ ã®æ•°ã®é–¢ä¿‚\u003c/h2\u003e\n\u003cp\u003eãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢è¦ç´ ã§ã‚ã‚‹ node, disk(hdd), ssd ãã—ã¦ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¦ç´ ã§ã‚ã‚‹ mon,\nosd, mds ã®æ•°ã®é–¢ä¿‚ã¯ã©ã®ã‚ˆã†ã«ã™ã‚‹ã¹ãã‹ï¼ŸåŸºæœ¬ã¨ãªã‚‹é–¢ä¿‚ã¯\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e1 mds process / node\u003c/li\u003e\n\u003cli\u003e1 mon process / node\u003c/li\u003e\n\u003cli\u003e1 osd process / disk\u003c/li\u003e\n\u003cli\u003en jornal ssd device / disk / node\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚åƒ•ãŒä»Šã®ã¨ã“ã‚ç†æƒ³ã‹ãªãã¨æ€ã£ã¦ã„ã‚‹æ§‹æˆã‚’ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾\nã™ã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹è¨˜ã®å›³ãŒãã‚Œã§ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+------------------------+\n|         client         |\n+------------------------+\n|\n+--------------------------+--------------------------+-------------------------------+-------------------------\n|                          |                          |                               |            public network\n+------------------------+ +------------------------+ +------------------------+      +------------------------+\n|          mon           | |          mon           | |          mon           |      |          mds           |\n+------+ +------+ +------+ +------+ +------+ +------+ +------+ +------+ +------+      +------------------------+\n| osd  | | osd  | | osd  | | osd  | | osd  | | osd  | | osd  | | osd  | | osd  |      |                        |\n+------+ +------+ +------+ +------+ +------+ +------+ +------+ +------+ +------+      |                        |\n| disk | | disk | | disk | | disk | | disk | | disk | | disk | | disk | | disk |....\u0026gt; |                        |\n+------+ +------+ +------+ +------+ +------+ +------+ +------+ +------+ +------+scale |          node          |\n|          ssd           | |          ssd           | |          ssd           |      |                        |\n+------------------------+ +------------------------+ +------------------------+      |                        |\n|          node          | |          node          | |          node          |      |                        |\n+------------------------+ +------------------------+ +------------------------+      +------------------------+\n|                          |                          |                               |\n+--------------------------+--------------------------+-------------------------------+-------------------------\n                                                                                                  cluster network\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 id=\"mds-ã¨-node-ã®é–¢ä¿‚\"\u003emds ã¨ node ã®é–¢ä¿‚\u003c/h4\u003e\n\u003cp\u003emds ã¯ãƒªãƒ¢ãƒ¼ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ã‚’è¡Œã†ã“ã¨ã‚„ç‰¹æ€§ãŒ\nå…¨ãç•°ãªã‚‹ã“ã¨ã‹ã‚‰åˆ¥ãƒãƒ¼ãƒ‰ã«åˆ‡ã‚Šå‡ºã—ã¾ã—ãŸã€‚ã¾ãŸ mds ã¯å¹¾ã¤ã‹ã®ãƒãƒ¼ãƒ‰ã§ç¨¼åƒã•\nã›ã‚‹äº‹ã‚‚å¯èƒ½ã€‚ãŒã€mds ã¯ãã‚Œãã‚Œã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ HA çµ„ã‚€ä»•çµ„ã¿ã¯æŒã£ã¦ã„ãªã„ã®ã§\nã©ã‚Œã‹ä¸€æ–¹ã® mds ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯æŒ‡ã—ç¤ºã™å¿…è¦ãŒã‚ã‚Šã€ãã® mds ãŒåœæ­¢ã™ã‚Œã°ç›´\nã¡ã«éšœå®³ã«ç™ºå±•ã—ã¾ã™ã€‚\u003c/p\u003e","title":"Ceph ã®ãƒ—ãƒ­ã‚»ã‚¹é…ç½®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\næ˜¨æ™©ã€ç¬¬17å› OpenStack å‹‰å¼·ä¼šãŒé–‹å‚¬ã•ã‚Œã¾ã—ãŸ\nhttp://connpass.com/event/4545/\nã“ã“ã§ç™ºè¡¨ã‚’ã—ã¦ãã¾ã—ãŸãï¼ç™ºè¡¨ã‚¿ã‚¤ãƒˆãƒ«ã¯ \u0026ldquo;rcbops/chef-cookbooks\u0026rdquo; ã§ã™ã€‚\nä½•ã‚’ç™ºè¡¨ã—ãŸã‹ã¨è¨€ã†ã¨è©³ã—ãã¯ä¸Šè¨˜ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¦‹ã¦ã„ãŸã ãã¨ã—ã¦ã€ç°¡å˜ã«è¨€ã†ã¨ \u0026ldquo;RackSpace ç¤¾ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒç®¡ç†ã—ã¦ã„ã‚‹ Chef Cookbooks ã§OpenStack æ§‹æˆã‚’ä½œã‚ ã†\u0026rdquo; ã£ã¦ã“ã¨ã§ã™ã€‚\nä»Šæ—¥çŸ¥ã£ãŸã®ã§ã™ãŒã©ã†ã‚‚æ˜¨æ™©ã¯åˆå¿ƒè€…å‘ã‘ã®å‹‰å¼·ä¼šã¨ã„ã†ä½ç½®ä»˜ã‘ã ã£ãŸã‚‰ã—ã..å°‘ ã—ã ã‘ãƒ‡ã‚£ãƒ¼ãƒ—ãªè©±é¡Œã‚’è©±ã—ã¦ã—ã¾ã£ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼ã™ã„ã¾ã›ã‚“ï¼ï¼ï¼œ\nã§ã‚‚ã¨ã¦ã‚‚æ¥½ã—ãç™ºè¡¨å‡ºæ¥ã¾ã—ãŸã—ã€é€†ã«è³ªå•ã®ã‚³ãƒ¼ãƒŠãƒ¼ã§æœ€æ–°ã®æƒ…å ±ã‚‚æ•™ãˆã¦ã‚‚ã‚‰ãˆ ãŸã‚Šï¼ãªã‚“ã¨ Havana å¯¾å¿œã® v4.2.0 ä»¥é™ã§ã¯ Swift ã® Cookbooks ãŒæ¶ˆãˆã¦ã—ã¾ã£ãŸ ã¨ã‹ï¼\u0026hellip; çš† Swift å¥½ãããªã„ã®ï¼Ÿ\u0026hellip;; ;\nrcbops/chef-cookbooks ã¯ãšã£ã¨è¿½ã£ã¦ã„ã¾ã™ãŒã€ã‚‚ã®ã™ã”ã„ã‚¹ãƒ”ãƒ¼ãƒ‰ã§é–‹ç™ºé€²ã‚“ã§ã„ ã‚‹ã®ã§ã€ä»Šå¾Œãœã²ã¿ãªã•ã‚“ä½¿ã£ã¦ã¿ã¦ä¸‹ã•ã„ãƒ¼ã€‚\næœ€å¾Œã«è©³ã—ã„åˆ©ç”¨æ–¹æ³•ã‚’è¨˜ã—ãŸåƒ•ã®ãƒ–ãƒ­ã‚°ã® URL ã‚’è²¼ã‚Šä»˜ã‘ã¦ãŠãã¾ã™ã€‚\nOpenStack Havana ã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤ http://jedipunkz.github.io/blog/2013/11/17/openstack-havana-chef-deploy/\nSwift HA æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤ http://jedipunkz.github.io/blog/2013/07/26/swift-ha-chef-deploy/\nå®Ÿç”¨çš„ãª Swift æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤ http://jedipunkz.github.io/blog/2013/10/27/swift-chef/\n","permalink":"https://jedipunkz.github.io/post/2014/01/21/17th-openstack-study/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæ˜¨æ™©ã€ç¬¬17å› OpenStack å‹‰å¼·ä¼šãŒé–‹å‚¬ã•ã‚Œã¾ã—ãŸ\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://connpass.com/event/4545/\"\u003ehttp://connpass.com/event/4545/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã“ã“ã§ç™ºè¡¨ã‚’ã—ã¦ãã¾ã—ãŸãï¼ç™ºè¡¨ã‚¿ã‚¤ãƒˆãƒ«ã¯ \u0026ldquo;rcbops/chef-cookbooks\u0026rdquo; ã§ã™ã€‚\u003c/p\u003e\n\u003cscript async class=\"speakerdeck-embed\"\ndata-id=\"27a2739063d601314bce6a232911c4f0\" data-ratio=\"1.33333333333333\"\nsrc=\"//speakerdeck.com/assets/embed.js\"\u003e\u003c/script\u003e\n\u003cp\u003eä½•ã‚’ç™ºè¡¨ã—ãŸã‹ã¨è¨€ã†ã¨è©³ã—ãã¯ä¸Šè¨˜ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¦‹ã¦ã„ãŸã ãã¨ã—ã¦ã€ç°¡å˜ã«è¨€ã†ã¨\n\u0026ldquo;RackSpace ç¤¾ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒç®¡ç†ã—ã¦ã„ã‚‹ Chef Cookbooks ã§OpenStack æ§‹æˆã‚’ä½œã‚\nã†\u0026rdquo; ã£ã¦ã“ã¨ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šæ—¥çŸ¥ã£ãŸã®ã§ã™ãŒã©ã†ã‚‚æ˜¨æ™©ã¯åˆå¿ƒè€…å‘ã‘ã®å‹‰å¼·ä¼šã¨ã„ã†ä½ç½®ä»˜ã‘ã ã£ãŸã‚‰ã—ã..å°‘\nã—ã ã‘ãƒ‡ã‚£ãƒ¼ãƒ—ãªè©±é¡Œã‚’è©±ã—ã¦ã—ã¾ã£ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼ã™ã„ã¾ã›ã‚“ï¼ï¼ï¼œ\u003c/p\u003e\n\u003cp\u003eã§ã‚‚ã¨ã¦ã‚‚æ¥½ã—ãç™ºè¡¨å‡ºæ¥ã¾ã—ãŸã—ã€é€†ã«è³ªå•ã®ã‚³ãƒ¼ãƒŠãƒ¼ã§æœ€æ–°ã®æƒ…å ±ã‚‚æ•™ãˆã¦ã‚‚ã‚‰ãˆ\nãŸã‚Šï¼ãªã‚“ã¨ Havana å¯¾å¿œã® v4.2.0 ä»¥é™ã§ã¯ Swift ã® Cookbooks ãŒæ¶ˆãˆã¦ã—ã¾ã£ãŸ\nã¨ã‹ï¼\u0026hellip; çš† Swift å¥½ãããªã„ã®ï¼Ÿ\u0026hellip;; ;\u003c/p\u003e\n\u003cp\u003ercbops/chef-cookbooks ã¯ãšã£ã¨è¿½ã£ã¦ã„ã¾ã™ãŒã€ã‚‚ã®ã™ã”ã„ã‚¹ãƒ”ãƒ¼ãƒ‰ã§é–‹ç™ºé€²ã‚“ã§ã„\nã‚‹ã®ã§ã€ä»Šå¾Œãœã²ã¿ãªã•ã‚“ä½¿ã£ã¦ã¿ã¦ä¸‹ã•ã„ãƒ¼ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€å¾Œã«è©³ã—ã„åˆ©ç”¨æ–¹æ³•ã‚’è¨˜ã—ãŸåƒ•ã®ãƒ–ãƒ­ã‚°ã® URL ã‚’è²¼ã‚Šä»˜ã‘ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eOpenStack Havana ã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"http://jedipunkz.github.io/blog/2013/11/17/openstack-havana-chef-deploy/\"\u003ehttp://jedipunkz.github.io/blog/2013/11/17/openstack-havana-chef-deploy/\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSwift HA æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"http://jedipunkz.github.io/blog/2013/07/26/swift-ha-chef-deploy/\"\u003ehttp://jedipunkz.github.io/blog/2013/07/26/swift-ha-chef-deploy/\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå®Ÿç”¨çš„ãª Swift æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"http://jedipunkz.github.io/blog/2013/10/27/swift-chef/\"\u003ehttp://jedipunkz.github.io/blog/2013/10/27/swift-chef/\u003c/a\u003e\u003c/p\u003e","title":"ç¬¬17å› OpenStack å‹‰å¼·ä¼šã§è©±ã—ã¦ãã¾ã—ãŸ"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nSerf ã®ç™»å ´ãŒã‚ã£ãŸã‚Šã€ã“ã“æœ€è¿‘ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦è€ƒãˆã‚‹äººãŒå¢—ãˆãŸæ°— ãŒã—ã¾ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã®å¾Œå„ãƒãƒ¼ãƒ‰é–“ã®é€£çµã ã£ãŸã‚Šã‚‚åŒã˜ Chef, Puppet ç­‰ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã§è¡Œã†ã®ã‹ï¼Ÿå…¨ãåˆ¥ã®ãƒ„ãƒ¼ãƒ«ã§ï¼Ÿ..\næœ€è¿‘ Serf ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã®ç™»å ´ãŒã‚ã‚Šã¾ã—ãŸã€‚\nåƒ•ã‚‚ Serf ã‚’è§¦ã£ã¦ã¤ã„å…ˆæ—¥ãƒ–ãƒ­ã‚°ã«æ›¸ãã¾ã—ãŸã€‚æœ‰ç”¨ãªãƒ„ãƒ¼ãƒ«ã ã¨æ€ã„ã¾ã™ã€‚ã‚· ãƒ³ãƒ—ãƒ«ã ã‹ã‚‰ã“ãå¿œç”¨ãŒåŠ¹ãã¾ã™ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ã‚‚ã‚ã‚Šã€å°†æ¥çš„ã«ç•°ãªã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆä¸Šã®ãƒãƒ¼ãƒ‰ã¨ã‚‚é€£çµå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚Šãã†ã§ã™ã—ã€ã¨ã¦ã‚‚æœŸå¾…ã§ã™ã€‚\nè©±ãŒå°‘ã—é£›ã³ã¾ã™ãŒ..\nã„ã¤ã‚‚ Rebuild.fm ã‚’æ¥½ã—ãèã„ã¦ã„ã‚‹ã®ã§ã™ãŒ Immutable Infrastructure ã®è©±é¡Œã® æ™‚ã«ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®è©±é¡Œã«ãªã£ã¦ã€ã©ã†ã‚‚ \u0026lsquo;Chef ã§ã‚‚è‡ªå¾‹çš„ãªã‚¯ãƒ©ã‚¹ã‚¿ã‚’çµ„ ã‚€ã“ã¨ãŒèªçŸ¥ã•ã‚Œã¦ã„ãªã„ã®ã§ã¯ï¼Ÿ\u0026rsquo; ã¨æ€ã†ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã‚‚ã¡ã‚ã‚“ Chef ã§ã‚„ã‚‹ ã¹ãï¼ã¨ã¯è¨€ã„åˆ‡ã‚Šã¾ã›ã‚“ã—ã€ä»Šå¾Œã©ã†ãªã‚‹ã‹ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚Opscode ã®ä¸­ã®äººã‚‚ \u0026lsquo;ã‚ªãƒ¼ ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯è‡ªåˆ†ã§ã‚„ã£ã¦ã­\u0026rsquo; ã¨ã„ã†ã‚¹ã‚¿ãƒ³ã‚¹ã ã£ãŸã¨ãšã„ã¶ã‚“å‰ã§ã™ãŒèãã¾ ã—ãŸã€‚Serf ã‚’ç­‰ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ä½¿ã‚ãªã„ã®è©±ã¯ä»Šå›ã¯ã—ãªã„ã® ã§ã™ãŒ Chef ã§ã‚‚è‡ªå¾‹çš„ã‚¯ãƒ©ã‚¹ã‚¿ã‚’çµ„ã‚€ã“ã¨ã¯å‡ºæ¥ã¾ã™ã‚ˆã€œã¨ã„ã†ã®ãŒä»Šå›ã®è©±é¡Œã€‚\nã¾ãˆãŒããŒé•·ããªã‚Šã¾ã—ãŸã€‚\nä»Šå›ã¯ Chef ã§è‡ªå¾‹çš„ã‚¯ãƒ©ã‚¹ã‚¿ã‚’æ§‹æˆã™ã‚‹æ–¹æ³•ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nhaproxy ç­‰ã‚’åˆ©ç”¨ã™ã‚Œã°å°šè‰¯ã„ã¨æ€ã„ã¾ã™ãŒã€ã‚ˆã‚Šã‚¯ãƒ©ã‚¹ã‚¿ã‚’çµ„ã‚€ã®ãŒç°¡å˜ãª nginx ã‚’ä»Šå›ã¯åˆ©ç”¨ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nhttps://github.com/opscode-cookbooks/nginx\næ§‹æˆ \u0026lsquo;web\u0026rsquo; ã¨ã„ã† Role åã¨ \u0026rsquo;lb\u0026rsquo; ã¨ã„ã† Role åã§å˜ç´”ãª HTTP ã‚µãƒ¼ãƒã¨ã—ã¦ã® nginx ãƒãƒ¼ãƒ‰ã‚’è¤‡æ•°å°ã¨ã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã¨ã—ã¦ã® nginx ãƒãƒ¼ãƒ‰ã‚’1å°ã§ã‚¯ãƒ©ã‚¹ã‚¿ã‚’æ§‹æˆã—ã¾ ã™ã€‚ã¾ãŸå…±ã« environment åã¯åŒã˜ã‚‚ã®ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚åˆ¥ã® environment åã®å ´åˆã¯ åˆ¥ã‚¯ãƒ©ã‚¹ã‚¿ã¨ã„ã†åŒºåˆ‡ã‚Šã§ã™ã€‚\n\u0026rsquo;lb\u0026rsquo; node x 1 + \u0026lsquo;web\u0026rsquo; node x n (\u0026lsquo;foo\u0026rsquo; environment) \u0026rsquo;lb\u0026rsquo; node x 1 + \u0026lsquo;web\u0026rsquo; node x n (\u0026lsquo;bar\u0026rsquo; environment) \u0026rsquo;lb\u0026rsquo; nginx ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã®ãƒ¬ã‚·ãƒ” ä¸‹è¨˜ãŒ \u0026rsquo;lb\u0026rsquo; Role ã® recipes/cmomnos_conf.rb ã®ä¿®æ­£ã—ãŸå†…å®¹ã§ã™ã€‚\nenvironment = node.chef_environment webservers = search(:node, \u0026#34;role:web AND chef_environment:#{environment}\u0026#34;) template \u0026#34;#{node[\u0026#39;nginx\u0026#39;][\u0026#39;dir\u0026#39;]}/sites-available/default\u0026#34; do source \u0026#34;default-site.erb\u0026#34; owner \u0026#34;root\u0026#34; group \u0026#34;root\u0026#34; mode 00644 notifies :reload, \u0026#39;service[nginx]\u0026#39; variables ({ :webservers =\u0026gt; webservers }) end ä½•ã‚’ã‚„ã£ã¦ã„ã‚‹ã‹ã¨è¨€ã†ã¨ã€environment ã¨ã„ã†å¤‰æ•°ã«è‡ªãƒãƒ¼ãƒ‰ã® environment åã‚’ã€‚ webservers ã¨ã„ã†å¤‰æ•°ã« role åãŒ \u0026lsquo;web\u0026rsquo; ã§å°šä¸”ã¤è‡ªãƒãƒ¼ãƒ‰ã¨åŒã˜ environment å ãŒä»˜ã„ãŸãƒãƒ¼ãƒ‰åã‚’å…¥ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã§è‡ªåˆ†ã¨åŒã˜ environment ã«æ‰€å±ã—ã¦ã„ã‚‹ \u0026lsquo;web\u0026rsquo; Role ãªãƒãƒ¼ãƒ‰ã‚’ Chef ã‚µãƒ¼ãƒã«å¯¾ã—ã¦æ¤œç´¢ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€template å†…ã§ webservers ã¨ã„ã†å¤‰æ•°ã‚’ãã®ã¾ã¾åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã« variables ã§æ¸¡ã—ã¦ã„ã¾ã™ã€‚\n\u0026rsquo;lb\u0026rsquo; nginx ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ ä¸‹è¨˜ãŒ webservers å¤‰æ•°ã‚’å—ã‘å–ã£ãŸå¾Œã® template å†…ã®å‡¦ç†ã§ã™ã€‚\n\u0026lt;% if @webservers and ( @webservers != [] ) %\u0026gt; upstream backend { \u0026lt;% @webservers.each do |hostname| -%\u0026gt; server \u0026lt;%= hostname[\u0026#39;ipaddr\u0026#39;] -%\u0026gt;; \u0026lt;% end -%\u0026gt; } \u0026lt;% end %\u0026gt; server { listen 80; server_name \u0026lt;%= node[\u0026#39;hostname\u0026#39;] %\u0026gt;; access_log \u0026lt;%= node[\u0026#39;nginx\u0026#39;][\u0026#39;log_dir\u0026#39;] %\u0026gt;/localhost.access.log; location / { \u0026lt;% if @webservers and ( @webservers != [] ) %\u0026gt; proxy_pass http://backend; \u0026lt;% else %\u0026gt; root /var/www/nginx-default; index index.html index.htm; \u0026lt;% end %\u0026gt; } } upstream backend { \u0026hellip; ã¯çš†ã•ã‚“è¦‹æ…£ã‚ŒãŸè¨˜è¿°ã ã¨æ€ã†ã®ã§ã™ãŒã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® HTTP ã‚µãƒ¼ãƒã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä¸€è¦§åŒ–ã—ã¾ã™ã€‚each ã§å›ã—ã¦ã„ã‚‹ã®ã§å°æ•°åˆ†ã ã‘ server \u0026lt;ip_addr\u0026gt;; ã®è¨˜è¿°ãŒå…¥ã‚Šã¾ã™ã€‚\nchef-client ã‚’ãƒ‡ãƒ¼ãƒ¢ãƒ³ç¨¼åƒã—ã¦ãŠã‘ã°ã€æ–°è¦ã« Chef ã‚µãƒ¼ãƒã«ç™»éŒ²ã•ã‚ŒãŸ \u0026lsquo;web\u0026rsquo; Role ã® HTTP ã‚µãƒ¼ãƒã‚’è‡ªå‹•ã§ \u0026rsquo;lb\u0026rsquo; Role ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãŒçµ„ã¿è¾¼ã‚€ã€ã¤ã¾ã‚Šè‡ªå¾‹çš„ ãªã‚¯ãƒ©ã‚¹ã‚¿ãŒçµ„ã‚ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ã“ã®é–“ã®æ‰‹ä½œæ¥­ã¯ä¸€åˆ‡ã‚ã‚Šã¾ã›ã‚“ã€‚\nã¡ãªã¿ã« chef-client ã‚’ãƒ‡ãƒ¼ãƒ¢ãƒ³ç¨¼åƒã™ã‚‹ã«ã¯\nrecipe[chef-client::service] ã¨ã„ã†ãƒ¬ã‚·ãƒ”ã‚’ãƒãƒ¼ãƒ‰ã«å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã§å¯èƒ½ã§ã™ã€‚\nã¾ã¨ã‚ Chef ã§ã‚‚è‡ªå¾‹çš„ãªã‚¯ãƒ©ã‚¹ã‚¿ãŒçµ„ã‚ã¾ã—ãŸã€‚ã‚‚ã¡ã‚ã‚“ chef-client ã®ç¨¼åƒé–“éš”ãŒã‚ã‚‹ã® ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚chef-client ã®ç¨¼åƒé–“éš”ã¯ \u0026lsquo;chef-client\u0026rsquo; ãƒ¬ã‚·ãƒ”ã® attributes ã§èª¿æ•´å‡ºæ¥ã¾ã™ã€‚ãã®ç‚¹ã¯ serf ã®ã»ã†ãŒç¢ºå®Ÿã«å‹ã£ã¦ã„ã‚‹ã¨è¦‹ã‚‹ã¹ãã§ ã—ã‚‡ã†ã€‚å†’é ­ã«è¨˜ã—ãŸã‚ˆã†ã«ã“ã®è¾ºã‚Šã®æ“ä½œã‚’ Chef ã§è¡Œã†ã®ã‹åˆ¥ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã®ã‹ ã¯ã¾ã ã¾ã æ¨¡ç´¢ãŒå¿…è¦ãã†ã€‚ãŸã ã€ç§ãŒã„ã¤ã‚‚ä½¿ã£ã¦ã„ã‚‹ \u0026lsquo;OpenStack ã‚’ Chef ã§æ§‹æˆ ã™ã‚‹ Cookbooks\u0026rsquo; ç­‰ã¯è¤‡æ•°å°æ§‹æˆã‚’ Chef ã§æ§‹æˆã—ã¦ã„ã¾ã™ã€‚ãªã®ã§åƒ•ã«ã¨ã£ã¦ã¯ã“ã® è¾ºã‚Šã®è©±ã¯å½“ãŸã‚Šå‰ã ã¨æ€ã£ã¦ã„ãŸã®ã ã‘ã©ã€ã©ã†ã‚‚å‹‰å¼·ä¼šã«å‡ºãŸã‚Šã™ã‚‹ã¨ \u0026ldquo;Chef ã¯ è¤‡æ•°å°æ§‹æˆã‚’ä½œã‚‹ã®ãŒè‹¦æ‰‹ã \u0026rdquo; ã£ã¦è©±ãŒã‚ãŒã£ã¦ãã‚‹ã®ã§æ°—ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/12/09/chef-autonoumous-cluster/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eSerf ã®ç™»å ´ãŒã‚ã£ãŸã‚Šã€ã“ã“æœ€è¿‘ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦è€ƒãˆã‚‹äººãŒå¢—ãˆãŸæ°—\nãŒã—ã¾ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã®å¾Œå„ãƒãƒ¼ãƒ‰é–“ã®é€£çµã ã£ãŸã‚Šã‚‚åŒã˜ Chef,\nPuppet ç­‰ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã§è¡Œã†ã®ã‹ï¼Ÿå…¨ãåˆ¥ã®ãƒ„ãƒ¼ãƒ«ã§ï¼Ÿ..\u003c/p\u003e\n\u003cp\u003eæœ€è¿‘ Serf ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã®ç™»å ´ãŒã‚ã‚Šã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eåƒ•ã‚‚ Serf ã‚’è§¦ã£ã¦ã¤ã„å…ˆæ—¥ãƒ–ãƒ­ã‚°ã«æ›¸ãã¾ã—ãŸã€‚æœ‰ç”¨ãªãƒ„ãƒ¼ãƒ«ã ã¨æ€ã„ã¾ã™ã€‚ã‚·\nãƒ³ãƒ—ãƒ«ã ã‹ã‚‰ã“ãå¿œç”¨ãŒåŠ¹ãã¾ã™ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ã‚‚ã‚ã‚Šã€å°†æ¥çš„ã«ç•°ãªã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼\nã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆä¸Šã®ãƒãƒ¼ãƒ‰ã¨ã‚‚é€£çµå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚Šãã†ã§ã™ã—ã€ã¨ã¦ã‚‚æœŸå¾…ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eè©±ãŒå°‘ã—é£›ã³ã¾ã™ãŒ..\u003c/p\u003e\n\u003cp\u003eã„ã¤ã‚‚ Rebuild.fm ã‚’æ¥½ã—ãèã„ã¦ã„ã‚‹ã®ã§ã™ãŒ Immutable Infrastructure ã®è©±é¡Œã®\næ™‚ã«ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®è©±é¡Œã«ãªã£ã¦ã€ã©ã†ã‚‚ \u0026lsquo;Chef ã§ã‚‚è‡ªå¾‹çš„ãªã‚¯ãƒ©ã‚¹ã‚¿ã‚’çµ„\nã‚€ã“ã¨ãŒèªçŸ¥ã•ã‚Œã¦ã„ãªã„ã®ã§ã¯ï¼Ÿ\u0026rsquo; ã¨æ€ã†ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã‚‚ã¡ã‚ã‚“ Chef ã§ã‚„ã‚‹\nã¹ãï¼ã¨ã¯è¨€ã„åˆ‡ã‚Šã¾ã›ã‚“ã—ã€ä»Šå¾Œã©ã†ãªã‚‹ã‹ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚Opscode ã®ä¸­ã®äººã‚‚ \u0026lsquo;ã‚ªãƒ¼\nã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯è‡ªåˆ†ã§ã‚„ã£ã¦ã­\u0026rsquo; ã¨ã„ã†ã‚¹ã‚¿ãƒ³ã‚¹ã ã£ãŸã¨ãšã„ã¶ã‚“å‰ã§ã™ãŒèãã¾\nã—ãŸã€‚Serf ã‚’ç­‰ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ä½¿ã‚ãªã„ã®è©±ã¯ä»Šå›ã¯ã—ãªã„ã®\nã§ã™ãŒ Chef ã§ã‚‚è‡ªå¾‹çš„ã‚¯ãƒ©ã‚¹ã‚¿ã‚’çµ„ã‚€ã“ã¨ã¯å‡ºæ¥ã¾ã™ã‚ˆã€œã¨ã„ã†ã®ãŒä»Šå›ã®è©±é¡Œã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãˆãŒããŒé•·ããªã‚Šã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ Chef ã§è‡ªå¾‹çš„ã‚¯ãƒ©ã‚¹ã‚¿ã‚’æ§‹æˆã™ã‚‹æ–¹æ³•ã‚’è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003ehaproxy ç­‰ã‚’åˆ©ç”¨ã™ã‚Œã°å°šè‰¯ã„ã¨æ€ã„ã¾ã™ãŒã€ã‚ˆã‚Šã‚¯ãƒ©ã‚¹ã‚¿ã‚’çµ„ã‚€ã®ãŒç°¡å˜ãª nginx\nã‚’ä»Šå›ã¯åˆ©ç”¨ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/opscode-cookbooks/nginx\"\u003ehttps://github.com/opscode-cookbooks/nginx\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h2\u003e\n\u003cp\u003e\u0026lsquo;web\u0026rsquo; ã¨ã„ã† Role åã¨ \u0026rsquo;lb\u0026rsquo; ã¨ã„ã† Role åã§å˜ç´”ãª HTTP ã‚µãƒ¼ãƒã¨ã—ã¦ã® nginx\nãƒãƒ¼ãƒ‰ã‚’è¤‡æ•°å°ã¨ã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã¨ã—ã¦ã® nginx ãƒãƒ¼ãƒ‰ã‚’1å°ã§ã‚¯ãƒ©ã‚¹ã‚¿ã‚’æ§‹æˆã—ã¾\nã™ã€‚ã¾ãŸå…±ã« environment åã¯åŒã˜ã‚‚ã®ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚åˆ¥ã® environment åã®å ´åˆã¯\nåˆ¥ã‚¯ãƒ©ã‚¹ã‚¿ã¨ã„ã†åŒºåˆ‡ã‚Šã§ã™ã€‚\u003c/p\u003e","title":"Chef ã§è‡ªå¾‹çš„ã‚¯ãƒ©ã‚¹ã‚¿ã‚’è€ƒãˆã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nçš†ã•ã‚“ CoreOS ã¯åˆ©ç”¨ã•ã‚ŒãŸã“ã¨ã‚ã‚Šã¾ã™ã‹ï¼ŸCoreOS ã¯è»½é‡ãª docker ã¨ã®ç›¸æ€§ã®è‰¯ ã„ OS ã§ã™ã€‚ä¸‹è¨˜ãŒå…¬å¼ã‚µã‚¤ãƒˆã€‚\nhttp://coreos.com/\nç‰¹å¾´ã¨ã—ã¦ã¯ä¸‹è¨˜ã®3ã¤ãŒã‚ã‚Šã¾ã™ã€‚\netcd systemd docker ã“ã“ã§ã¯ã“ã®ä¸­ã® etcd ã«ã¤ã„ã¦æ³¨ç›®ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚etcd ã¯ã‚¯ãƒ©ã‚¹ã‚¿ã‚¨ã‚¤ ãƒ–ãƒ«ãª KVS ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã™ã€‚ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒ©ã‚¹ã‚¿é–“ã§å…±æœ‰ã™ã‚‹ã“ã¨ ãŒãªã®ã§ã€ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆ†é‡ã§ã‚‚æœŸå¾…å‡ºæ¥ã‚‹ã®ã§ã¯ï¼Ÿã¨å€‹äººçš„ã«æ„Ÿã˜ã¦ã„ã¾ ã™ã€‚ä»Šå›ã¯ etcd ã®ã‚¯ãƒ©ã‚¹ã‚¿æ§‹æˆæ§‹ç¯‰ã®æ‰‹é †ã¨ãã®åŸºæœ¬å‹•ä½œã®ç¢ºèªã€ã¾ãŸã©ã†å¿œç”¨å‡ºæ¥ ã‚‹ã®ã‹ï¼Ÿã«ã¤ã„ã¦è¨˜ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\nå‚è€ƒ URL http://coreos.com/using-coreos/etcd/ https://github.com/coreos/etcd ãƒ“ãƒ«ãƒ‰ go 1.1 or later ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ etcd ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æº–å‚™ã‚’è¡Œã„ã¾ã™ã€‚Ubuntu Saucy ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç”¨ã„ã‚‹ã¨å®¹æ˜“ã«è¡Œãˆã¾ã™ã€‚\n% apt-get -y install golang coreos/etcd ã‚’å–å¾—ã—ãƒ“ãƒ«ãƒ‰\n% git clone https://github.com/coreos/etcd % cd coreos % ./build % ./etcd --version v0.2.0-rc1-60-g73f04d5 CoreOS ã®ç”¨æ„ ã“ã“ã§ã¯ãŸã¾ãŸã¾æ‰‹å…ƒã«ã‚ã£ãŸ OpenStack ã‚’ç”¨ã„ã¦ CoreOS ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç™»éŒ²ã—ã¦ã„ ã¿ã¾ã™ã€‚ãƒ™ã‚¢ãƒ¡ã‚¿ãƒ«ã§ã‚‚å¯èƒ½ã§ã™ã®ã§ãã®å ´åˆã¯æ‰‹é †ã‚’èª­ã¿æ›¿ãˆã¦ä½œæ¥­ã—ã¦ã¿ã¦ãã ã• ã„ã€‚OpenStack ç­‰ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ metadata ã‚µãƒ¼ãƒ“ã‚¹ãŒå¿… é ˆã¨ãªã‚‹ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚\n% wget http://storage.core-os.net/coreos/amd64-generic/dev-channel/coreos_production_openstack_image.img.bz2 % bunzip2 coreos_production_openstack_image.img.bz2 % glance image-create --name coreos-image --container-format ovf \\ --disk-format qcow2 --file coreos_production_openstack_image.img nova boot ã«ã¦ CoreOS ã‚’èµ·å‹•ã—ã¾ã™ã€‚(ä¸‹è¨˜ã¯ä¾‹)\n% nova keypair-add testkey01 \u0026gt; testkey01.pem % nova boot --nic net-id .... --image coreos-image --flavor 1 --key_name testkey01 coreos01 CoreOS ä¸Šã§ã® etcd ã‚¯ãƒ©ã‚¹ã‚¿èµ·å‹• ä¸Šè¨˜ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ãŸ etcd ã®ãƒã‚¤ãƒŠãƒªã‚’èµ·å‹•ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ (CoreOS) ã«è»¢é€ã—ã¾ ã™ã€‚scp ç­‰ã§è»¢é€ã—ã¦ãã ã•ã„ã€‚\nã“ã“ã§ã¯ 1 node ä¸Šã§è¤‡æ•°ã®ãƒãƒ¼ãƒˆç•ªå·ã‚’ç”¨ã„ã¦ 3 ã¤ã® etcd ã‚’ç¨¼åƒã™ã‚‹ã“ã¨ã§ã‚¯ãƒ© ã‚¹ã‚¿ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚\n7002 ç•ªãƒãƒ¼ãƒˆã‚’ peer addr ã¨ã—ã¦ master ã‚’èµ·å‹•ã€‚listen ãƒãƒ¼ãƒˆã¯ 4002\n% ./etcd -peer-addr 127.0.0.1:7002 -addr 127.0.0.1:4002 -data-dir machines/machine1 -name machine1 ä¸Šè¨˜ã® master ã‚’å‚ç…§ã™ã‚‹ slaves (æ®‹ã‚Š2å°) ã‚’èµ·å‹•ã€‚\n% ./etcd -peer-addr 127.0.0.1:7003 -addr 127.0.0.1:4003 -peers 127.0.0.1:7002 -data-dir machines/machine2 -name machine2 % ./etcd -peer-addr 127.0.0.1:7004 -addr 127.0.0.1:4004 -peers 127.0.0.1:7002 -data-dir machines/machine3 -name machine3 ã‚¯ãƒ©ã‚¹ã‚¿æ§‹æˆå†…ã®ãƒãƒ¼ãƒ‰æƒ…å ±ã‚’ç¢ºèªã™ã‚‹ã€‚\n% curl -L http://127.0.0.1:4002/v2/machines [etcd] Dec 4 03:46:44.153 INFO | URLs: machine1 / machine1 (http://127.0.0.1:4002,http://127.0.0.1:4003,http://127.0.0.1:4004) http://127.0.0.1:4002, http://127.0.0.1:4003, http://127.0.0.1:4004 leader (master) æƒ…å ±ã‚’ç¢ºèªã™ã‚‹ã€‚\n% curl -L http://127.0.0.1:4002/v2/leader http://127.0.0.1:7002 ä¸Šè¨˜ã§èµ·å‹•ã—ãŸ master ãƒ—ãƒ­ã‚»ã‚¹ãŒ leader (master) ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªå‡ºæ¥ã‚‹ ã¨æ€ã„ã¾ã™ã€‚\nã‚­ãƒ¼ã®æŠ•å…¥ã¨å‚ç…§ ãƒ†ã‚¹ãƒˆã§ã‚­ãƒ¼ã¨å€¤ã‚’å…¥åŠ›ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\u0026lsquo;foo\u0026rsquo; ã‚­ãƒ¼ã« \u0026lsquo;bar\u0026rsquo; ã¨ã„ã†å€¤ã‚’æŠ•å…¥ã¦ãã  ã•ã„ã€‚\n% curl -L http://127.0.0.1:4002/v2/keys/foo -XPUT -d value=bar ã‚¯ãƒ©ã‚¹ã‚¿å†…å…¨ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ä¸Šè¨˜ã®ã‚­ãƒ¼ã®å–å¾—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚\n% curl -L http://127.0.0.1:4002/v2/keys/foo {\u0026#34;action\u0026#34;:\u0026#34;get\u0026#34;,\u0026#34;node\u0026#34;:{\u0026#34;key\u0026#34;:\u0026#34;/foo\u0026#34;,\u0026#34;value\u0026#34;:\u0026#34;bar\u0026#34;,\u0026#34;modifiedIndex\u0026#34;:4,\u0026#34;createdIndex\u0026#34;:4}} % curl -L http://127.0.0.1:4003/v2/keys/foo {\u0026#34;action\u0026#34;:\u0026#34;get\u0026#34;,\u0026#34;node\u0026#34;:{\u0026#34;key\u0026#34;:\u0026#34;/foo\u0026#34;,\u0026#34;value\u0026#34;:\u0026#34;bar\u0026#34;,\u0026#34;modifiedIndex\u0026#34;:4,\u0026#34;createdIndex\u0026#34;:4}} % curl -L http://127.0.0.1:4004/v2/keys/foo {\u0026#34;action\u0026#34;:\u0026#34;get\u0026#34;,\u0026#34;node\u0026#34;:{\u0026#34;key\u0026#34;:\u0026#34;/foo\u0026#34;,\u0026#34;value\u0026#34;:\u0026#34;bar\u0026#34;,\u0026#34;modifiedIndex\u0026#34;:4,\u0026#34;createdIndex\u0026#34;:4}} master ã®ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã¨ master é¸æŒ™å¾Œã®å‹•ä½œç¢ºèª ãƒ†ã‚¹ãƒˆã§ master ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã—ã¦ã¿ã¾ã™ã€‚\nmaster ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³\n% kill \u0026lt;master ãƒ—ãƒ­ã‚»ã‚¹ã® ID\u0026gt; ãã®ä»– 2 ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ \u0026lsquo;foo\u0026rsquo; ã‚­ãƒ¼ã®ç¢ºèªã‚’è¡Œã†ã€‚\n% curl -L http://127.0.0.1:4004/v2/keys/foo {\u0026#34;action\u0026#34;:\u0026#34;get\u0026#34;,\u0026#34;node\u0026#34;:{\u0026#34;key\u0026#34;:\u0026#34;/foo\u0026#34;,\u0026#34;value\u0026#34;:\u0026#34;bar\u0026#34;,\u0026#34;modifiedIndex\u0026#34;:4,\u0026#34;createdIndex\u0026#34;:4}} % curl -L http://127.0.0.1:4003/v2/keys/foo {\u0026#34;action\u0026#34;:\u0026#34;get\u0026#34;,\u0026#34;node\u0026#34;:{\u0026#34;key\u0026#34;:\u0026#34;/foo\u0026#34;,\u0026#34;value\u0026#34;:\u0026#34;bar\u0026#34;,\u0026#34;modifiedIndex\u0026#34;:4,\u0026#34;createdIndex\u0026#34;:4}} å‹¿è«–ã€æ—§ master ã‹ã‚‰ã¯ç¢ºèªå‡ºæ¥ãªã„ã€‚\n% curl -L http://127.0.0.1:4002/v2/keys/foo curl: (7) Failed connect to 127.0.0.1:4002; Connection refused æ–° master ã®ç¢ºèªã‚’è¡Œã†ã€‚é¸æŒ™ã®çµæœ 3 ã¤ç›®ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒ master ã«æ˜‡æ ¼ã—ã¦ã„ã‚‹ã“ ã¨ãŒç¢ºèªå‡ºæ¥ã‚‹ã€‚\n% curl -L http://127.0.0.1:4003/v2/leader http://127.0.0.1:7004 è€ƒå¯Ÿã¨ãã®å¿œç”¨æ€§ã«ã¤ã„ã¦ ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãª KVS ã§ã¯ã‚ã‚‹ã‘ã©å¤§ããªå¯èƒ½æ€§ã‚’ç§˜ã‚ã¦ã„ã‚‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ã‚ªãƒ¼ ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ã¸ã®å¿œç”¨ã§ã™ã€‚ãŠäº’ã„ã®ãƒãƒ¼ãƒ‰ (ä»Šå›ã¯ãƒ—ãƒ­ã‚»ã‚¹) é–“ã§æƒ…å ±ã‚’ã‚„ã‚Š ã¨ã‚Šã§ãã‚‹ã®ã§è‡ªå¾‹çš„ãªã‚¯ãƒ©ã‚¹ã‚¿ã®æ§‹ç¯‰ã‚‚å¯èƒ½ã«ãªã‚‹ã®ã§ã¯ï¼Ÿã¨æ€ã£ã¦ã„ã¾ã™ã€‚\n\u0026rsquo;etcenv\u0026rsquo; ã¨ã„ã† @mattn ã•ã‚“ãŒé–‹ç™ºã—ãŸãƒ„ãƒ¼ãƒ«ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nhttps://github.com/mattn/etcdenv\nä¸‹è¨˜ã€README ã‹ã‚‰å¼•ç”¨ã€‚\n$ curl http://127.0.0.1:4001/v1/keys/app/db -d value=\u0026#34;newdb\u0026#34; $ curl http://127.0.0.1:4001/v1/keys/app/cache -d value=\u0026#34;new cache\u0026#34; $ curl http://localhost:4001/v1/keys/app [{\u0026#34;action\u0026#34;:\u0026#34;GET\u0026#34;,\u0026#34;key\u0026#34;:\u0026#34;/app/db\u0026#34;,\u0026#34;value\u0026#34;:\u0026#34;newdb\u0026#34;,\u0026#34;index\u0026#34;:4},{\u0026#34;action\u0026#34;:\u0026#34;GET\u0026#34;,\u0026#34;key\u0026#34;:\u0026#34;/app/cache\u0026#34;,\u0026#34;value\u0026#34;:\u0026#34;new cache\u0026#34;,\u0026#34;index\u0026#34;:4}] $ etcdenv -key=/app/ DB=newdb CACHE=new cache $ etcdenv -key=/app/ ruby web.rb ã‚¯ãƒ©ã‚¹ã‚¿é–“ã®æƒ…å ±ã‚’ç’°å¢ƒå¤‰æ•°ã«è½ã¨ã—ã“ã‚€ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚è‡ªãƒãƒ¼ãƒ‰ã®ç’°å¢ƒå¤‰æ•°ã¾ã§è½ã¡ã‚Œ ã°ã€ã‚¯ãƒ©ã‚¹ã‚¿æ§‹ç¯‰ã‚‚è‰²ã€…æƒ³åƒå‡ºæ¥ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ\nè»½é‡ã§ docker ã¨ã®ç›¸æ€§ã‚‚è‰¯ãã¦ etcd ç­‰ã®ä»•çµ„ã¿ã‚‚æŒã£ã¦ã„ã‚‹ CoreOS ã«ã¯ã“ã‚Œã‹ã‚‰ ã‚‚æœŸå¾…ã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/12/09/coreos-etcd-cluster/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eçš†ã•ã‚“ CoreOS ã¯åˆ©ç”¨ã•ã‚ŒãŸã“ã¨ã‚ã‚Šã¾ã™ã‹ï¼ŸCoreOS ã¯è»½é‡ãª docker ã¨ã®ç›¸æ€§ã®è‰¯\nã„ OS ã§ã™ã€‚ä¸‹è¨˜ãŒå…¬å¼ã‚µã‚¤ãƒˆã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://coreos.com/\"\u003ehttp://coreos.com/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eç‰¹å¾´ã¨ã—ã¦ã¯ä¸‹è¨˜ã®3ã¤ãŒã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eetcd\u003c/li\u003e\n\u003cli\u003esystemd\u003c/li\u003e\n\u003cli\u003edocker\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã“ã“ã§ã¯ã“ã®ä¸­ã® etcd ã«ã¤ã„ã¦æ³¨ç›®ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚etcd ã¯ã‚¯ãƒ©ã‚¹ã‚¿ã‚¨ã‚¤\nãƒ–ãƒ«ãª KVS ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã™ã€‚ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒ©ã‚¹ã‚¿é–“ã§å…±æœ‰ã™ã‚‹ã“ã¨\nãŒãªã®ã§ã€ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆ†é‡ã§ã‚‚æœŸå¾…å‡ºæ¥ã‚‹ã®ã§ã¯ï¼Ÿã¨å€‹äººçš„ã«æ„Ÿã˜ã¦ã„ã¾\nã™ã€‚ä»Šå›ã¯ etcd ã®ã‚¯ãƒ©ã‚¹ã‚¿æ§‹æˆæ§‹ç¯‰ã®æ‰‹é †ã¨ãã®åŸºæœ¬å‹•ä½œã®ç¢ºèªã€ã¾ãŸã©ã†å¿œç”¨å‡ºæ¥\nã‚‹ã®ã‹ï¼Ÿã«ã¤ã„ã¦è¨˜ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒ-url\"\u003eå‚è€ƒ URL\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://coreos.com/using-coreos/etcd/\"\u003ehttp://coreos.com/using-coreos/etcd/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/coreos/etcd\"\u003ehttps://github.com/coreos/etcd\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ãƒ“ãƒ«ãƒ‰\"\u003eãƒ“ãƒ«ãƒ‰\u003c/h2\u003e\n\u003cp\u003ego 1.1 or later ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ etcd ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æº–å‚™ã‚’è¡Œã„ã¾ã™ã€‚Ubuntu\nSaucy ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç”¨ã„ã‚‹ã¨å®¹æ˜“ã«è¡Œãˆã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% apt-get -y install golang\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ecoreos/etcd ã‚’å–å¾—ã—ãƒ“ãƒ«ãƒ‰\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% git clone https://github.com/coreos/etcd\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% cd coreos\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% ./build\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% ./etcd --version\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ev0.2.0-rc1-60-g73f04d5\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"coreos-ã®ç”¨æ„\"\u003eCoreOS ã®ç”¨æ„\u003c/h2\u003e\n\u003cp\u003eã“ã“ã§ã¯ãŸã¾ãŸã¾æ‰‹å…ƒã«ã‚ã£ãŸ OpenStack ã‚’ç”¨ã„ã¦ CoreOS ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç™»éŒ²ã—ã¦ã„\nã¿ã¾ã™ã€‚ãƒ™ã‚¢ãƒ¡ã‚¿ãƒ«ã§ã‚‚å¯èƒ½ã§ã™ã®ã§ãã®å ´åˆã¯æ‰‹é †ã‚’èª­ã¿æ›¿ãˆã¦ä½œæ¥­ã—ã¦ã¿ã¦ãã ã•\nã„ã€‚OpenStack ç­‰ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ metadata ã‚µãƒ¼ãƒ“ã‚¹ãŒå¿…\né ˆã¨ãªã‚‹ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚\u003c/p\u003e","title":"CoreOS etcd ã®ã‚¯ãƒ©ã‚¹ã‚¿ã¨ãã®å¿œç”¨æ€§"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®å­£ç¯€ãŒã‚„ã£ã¦å‚ã‚Šã¾ã—ãŸã€‚\nIronic ã‚’ä½¿ã£ã¦ OpenStack ã§ãƒ™ã‚¢ãƒ¡ã‚¿ãƒ«ã‚µãƒ¼ãƒã‚’æ‰±ã„ãŸã„ï¼ã¨ã„ã†ã“ã¨ã§è‰²ã€…ã¨ã‚„ã£ ã¦ã„ã‚‹æœ€ä¸­ (ä»Šé€±ã‹ã‚‰å§‹ã‚ã¾ã—ãŸ..) ãªã®ã§ã™ãŒã€ã¾ã ã¾ã  incubator ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ã¨ã„ã†ã“ã¨ã‚‚ã‚ã£ã¦å®Ÿè£…ãŒè¿½ã„ä»˜ã„ã¦ã„ãªã‹ã£ãŸã‚Šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚æƒã£ã¦ã„ãªã‹ã£ãŸã‚Š ã¨ã‚·ãƒ³ãƒ‰ã„çŠ¶æ³ï½— ã“ã“2æ—¥ç¨‹ã§é›†ã‚ãŸæƒ…å ±ã‚’æ•´ç†ã™ã‚‹ãŸã‚ã«ã‚‚ 2013å¹´ OpenStack ã‚¢ãƒ‰ ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«å‚åŠ ã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã™ãƒ¼ã€‚\nå‚è€ƒè³‡æ–™ã®ã¾ã¨ã‚ ã¾ãšã¯å…¬å¼ wiki ãƒšãƒ¼ã‚¸ã€‚é€†ã«è¨€ã†ã¨ã“ã“ã«è¨˜ã•ã‚Œã¦ã„ã‚‹ä»¥ä¸Šã®æƒ…å ±ã¯ç„¡ã„ã‚“ã˜ã‚ƒï¼Ÿã‚ ã¨ã¯ã‚³ãƒ¼ãƒ‰èª­ã‚ï¼ã®ä¸–ç•Œã‹ã‚‚..ã€‚\nhttps://wiki.openstack.org/wiki/Ironic\ndevtest_undercloud ã§ã™ã€‚ä¸Šã®è³‡æ–™ã®ä¸­ã§ã‚‚æ‰‹é †ã®ä¸­ã§åº¦ã€…ã“ã¡ã‚‰ã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¦ã„ã‚‹ã€‚ åŒã˜ã incubator ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® TrippleO ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãªã£ã¦ã„ã‚‹ã€‚ ä¸Šè¨˜ã®å…¬å¼ wiki ã®æƒ…å ±ã‚’åˆã‚ã›èª­ã‚€ã“ã¨ã§ Ironic ã‚’ä½¿ã£ãŸãƒ‡ãƒ—ãƒ­ã‚¤ã®æ‰‹é †ã«ä»•ä¸ŠãŒã‚Šã¾ã™ã€‚\nhttp://docs.openstack.org/developer/tripleo-incubator/devtest_undercloud.html\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€‚ã‚ã¨ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆæ–¹æ³•ã‚’è¨˜ã—ã¾ã™ãŒã€ã“ã¡ã‚‰ã‚’å– å¾—ã—ã¦ä½œæˆã—ã¾ã™ã€‚\nhttps://github.com/openstack/ironic\nãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ãƒˆã€‚ã¾ã æƒ…å ±ãŒæƒã£ã¦ã„ã¾ã›ã‚“ã€‚ã‚ˆã£ã¦ä¸Šã® github ã‹ã‚‰å–å¾—ã—ãŸãƒ¢ ãƒã‹ã‚‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œã‚‹æ–¹æ³•ã‚’å¾Œã§æ›¸ãã¾ã™ã€‚\nhttp://docs.openstack.org/developer/ironic/\nlaunchpad ã‚µã‚¤ãƒˆã€‚å…¨ã¦ã®ãƒã‚°æƒ…å ±ã‚„ãƒ–ãƒ«ãƒ¼ãƒ—ãƒªãƒ³ãƒˆç­‰ãŒé–²è¦§å‡ºæ¥ã¾ã™ã€‚ã¾ã çµ¶è³›é–‹ç™º ä¸­ãªã®ã§èª­ã‚€å¿…è¦ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚\nhttps://launchpad.net/ironic\nãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œã‚‹ +++\nå…¬å¼ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ãƒˆã¯ä¸€å¿œã€ä¸Šè¨˜ã®é€šã‚Šã‚ã‚‹ã®ã§ã™ãŒã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚çµ¶è³›åŸ·ç­† ä¸­ã¨ã„ã†ã“ã¨ã§æ‰€ã€…æŠœã‘ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ãƒˆãŒã©ã®ã‚¹ãƒ‘ãƒ³ã§æ›´æ–° ã•ã‚Œã¦ã„ã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ã®ã§ã€ã„ã¡æ—©ãæƒ…å ±ã‚’ã‚²ãƒƒãƒˆã—ãŸã„å ´åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œã‚‹å¿… è¦ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚ã¨ã„ã†ã“ã¨ã§ã€ãã®ä½œã‚Šæ–¹ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚å°šã€å…¬å¼ wiki ã‚µ ã‚¤ãƒˆã«ã‚‚æ‰‹é †ãŒè¼‰ã£ã¦ã„ã¾ã™ãŒ Vagrant ã¨ Apache ã‚’ç”¨ã„ãŸæ–¹æ³•ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€ æ™®é€šã« Ubuntu ã‚µãƒ¼ãƒãŒæ‰‹å…ƒã«ã‚ã‚‹ç’°å¢ƒã‚’æƒ³å®šã—ã¦èª­ã¿æ›¿ãˆãªãŒã‚‰èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚\nå¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã™ã€‚\n% sudo apt-get update % sudo apt-get install -y git python-dev swig libssl-dev python-pip \\ libmysqlclient-dev libxml2-dev libxslt-dev libxslt1-dev python-mysqldb \\ libpq-dev % sudo pip install virtualenv setuptools-git flake8 tox % sudo easy_install nose ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚\n% git clone git://github.com/openstack/ironic.git Sphinx ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã®ã§ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚\n% cd ironic % tox -evenv -- echo \u0026#39;done\u0026#39; % source .tox/venv/bin/activate \u0026gt; python setup.ph build_sphinx \u0026gt; deactivate ironic/doc/build/html ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã« HTML ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒç”Ÿæˆã•ã‚ŒãŸã¯ãšã§ ã™ã€‚ã“ã‚Œã‚’æ‰‹å…ƒã®ç«¯æœ«ã«æŒã£ã¦ãã¦é–‹ã‘ã°ãƒ–ãƒ©ã‚¦ã‚¶ã§æœ€æ–°ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒé–²è¦§å‡ºæ¥ã¾ ã™ã€‚\nironic ã‚’æœ‰åŠ¹ã«ã—ãŸ devstack ã«ã‚ˆã‚‹æ§‹ç¯‰ devstack ã‚’ä½¿ã£ã¦ ironic ã‚’æ©Ÿèƒ½ã•ã›ã¦ã„ãã¾ã™ã€‚ç§ã¯ä¸‹è¨˜ã® localrc ã‚’ç”¨ã„ã¦ ironic ã®è©¦é¨“ã‚’ã—ã¦ã„ã¾ã—ãŸã€‚ã¾ãŸãƒ–ãƒ©ãƒ³ãƒã¯ \u0026lsquo;master\u0026rsquo; ã‚’ä½¿ã„ã¾ã™ã€‚\n% git clone https://github.com/openstack-dev/devstack.git % cd devstack % ${EDITOR} localrc # ä¸‹è¨˜ã®é€šã‚Š HOST_IP=\u0026lt;your_machine_ip_addr\u0026gt; LOGFILE=stack.sh.log ADMIN_PASSWORD=nomoresecrete MYSQL_PASSWORD=$ADMIN_PASSWORD RABBIT_PASSWORD=$ADMIN_PASSWORD SERVICE_PASSWORD=$ADMIN_PASSWORD SERVICE_TOKEN=admintoken disable_service n-obj # ironic enable_service ir-api enable_service ir-cond # use neutron disable_service n-net enable_service q-svc enable_service q-agt enable_service q-dhcp enable_service q-l3 enable_service q-meta enable_service q-lbaas enable_service neutron ENABLE_TENANT_TUNNELS=True # heat ENABLED_SERVICES+=,heat,h-api,h-api-cfn,h-api-cw,h-eng ## It would also be useful to automatically download and register VM images that Heat can launch. # 64bit image (~660MB) IMAGE_URLS+=\u0026#34;,http://fedorapeople.org/groups/heat/prebuilt-jeos-images/F17-x86_64-cfntools.qcow2\u0026#34; # 32bit image (~640MB) IMAGE_URLS+=\u0026#34;,http://fedorapeople.org/groups/heat/prebuilt-jeos-images/F17-i386-cfntools.qcow2\u0026#34; # syslog SYSLOG=True SYSLOG_HOST=$HOST_IP SYSLOG_PORT=514 stack.sh ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\n% ./stack.sh Ironic ã‚’æœ‰åŠ¹ã«ã—ãŸ OpenStack ç’°å¢ƒãŒå‡ºæ¥ä¸ŠãŒã£ãŸã¯ãšã§ã™ã€‚\ndiskimage-builder ã‚’ä½¿ã£ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆ ãƒ™ã‚¢ãƒ¡ã‚¿ãƒ«ã‚µãƒ¼ãƒã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚å…ƒã€…ã¯ TrippleO ã®ãƒ— ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã«å­˜åœ¨ã—ã¦ã„ã¾ã—ãŸãŒã€ç¾åœ¨ã¯ git ãƒ¬ãƒã‚¸ãƒˆãƒªãŒåˆ¥ã‚Œã¦ã„ã¾ã™ã€‚\nå…ˆã»ã© devstack ã‚’å°å…¥ã—ãŸãƒ›ã‚¹ãƒˆã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã‚Šã¾ã™ã€‚ä½œæˆã«ã¯çµæ§‹æ™‚é–“ãŒæ›ã‹ã‚Šã¾ã™ã€‚\n% cd ~ % git clone https://github.com/openstack/diskimage-builder.git % git clone https://github.com/openstack/tripleo-incubator.git % git clone https://github.com/openstack/tripleo-image-elements.git % git clone https://github.com/openstack/tripleo-heat-templates.git % export UNDERCLOUD_DIB_EXTRA_ARGS=\u0026#39;ironic-api ironic-conductor\u0026#39; % export ELEMENTS_PATH=/home/thirai/tripleo-image-elements/elements % ./diskimage-builder/bin/disk-image-create -a amd64 -o ~/undercloud boot-stack \\ nova-baremetal os-collect-config stackuser dhcp-all-interfaces \\ neutron-dhcp-agent ${UNDERCLOUD_DIB_EXTRA_ARGS:-} ubuntu 2\u0026gt;\u0026amp;1 | tee /tmp/undercloud.log ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒ ~/undercloud.qcow2 ãŒç”Ÿæˆã•ã‚ŒãŸã¯ãšã§ã™ã€‚ä½œæˆã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ Glance ã«ç™»éŒ²ã—ã¾ã™ã€‚\n% ~/tripleo-incubator/scripts/load-image undercloud.qcow2 undercloud.yaml ã¨ ironic.yaml ã‚’ãƒãƒ¼ã‚¸ã—ã¾ã™ã€‚\n% cd ~/tripleo-heat-templates % make undercloud-vm-ironic.yaml ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç”Ÿæˆã¨ç’°å¢ƒå¤‰æ•°ã¸ã®èª­ã¿è¾¼ã¿ã‚’è¡Œã„ã¾ã™ã€‚\n% cd ~/tripleo-incubator/scripts/ % export PATH=$PATH:. % ./setup-undercloud-passwords % source tripleo-undercloud-passwords UNDERCLOUD_IRONIC_PASSWORD ç’°å¢ƒå¤‰æ•°ã«ã‚‚èª­ã¿è¾¼ã¿ã¾ã™ã€‚\n% export UNDERCLOUD_IRONIC_PASSWORD=$(~/tripleo-incubator/scripts/os-make-password) ã•ã¦ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã—ãŸãƒ™ã‚¢ãƒ¡ã‚¿ãƒ«ã¸ã®ç¨¼åƒã§ã™ãŒã€\u0026hellip;\nif [ \u0026#34;$DHCP_DRIVER\u0026#34; = \u0026#34;bm-dnsmasq\u0026#34; ]; then UNDERCLOUD_NATIVE_PXE=\u0026#34;\u0026#34; else UNDERCLOUD_NATIVE_PXE=\u0026#34;;NeutronNativePXE=True\u0026#34; fi heat stack-create -f ./tripleo-heat-templates/undercloud-vm-ironic.yaml \\ -P \u0026#34;PowerUserName=$(whoami);\\ AdminToken=${UNDERCLOUD_ADMIN_TOKEN};\\ AdminPassword=${UNDERCLOUD_ADMIN_PASSWORD};\\ GlancePassword=${UNDERCLOUD_GLANCE_PASSWORD};\\ HeatPassword=${UNDERCLOUD_HEAT_PASSWORD};\\ NeutronPassword=${UNDERCLOUD_NEUTRON_PASSWORD};\\ NovaPassword=${UNDERCLOUD_NOVA_PASSWORD};\\ BaremetalArch=${NODE_ARCH}$UNDERCLOUD_NATIVE_PXE\u0026#34; \\ IronicPassword=${UNDERCLOUD_IRONIC_PASSWORD}\u0026#34; \\ undercloud ã‚³ã‚±ã¾ã—ãŸã€‚\u0026hellip;ã‚¨ãƒ©ãƒ¼ã¯ä¸‹è¨˜ã®é€šã‚Šã€‚\nTRACE heat.engine.resource Error: Creation of server teststack01-WikiDatabase-5nyiqluilnxn failed: No valid host was found. Exceeded max scheduling attempts 3 for instance 733b69df-2b54-44ae-9d61-de766746f21a (500)#0122013-12-03 16:04:14.513 10022 TRACE heat.engine.resource No Valid Host ã¨ãª\u0026hellip;ã€‚ã†ãƒ¼ã‚“ã€‚ç¢ºã‹ã« IPMI ã‚’ç©ã‚“ã ãƒ™ã‚¢ãƒ¡ã‚¿ãƒ«ãƒã‚·ãƒ³ã®æƒ…å ±ã£ã¦ ã©ã“ã«ã‚‚è¨˜ã—ã¦ã„ãªã„ã‚“ã ã‚ˆãªãã€‚ã—ã‹ã‚‚ heat ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ (underclound-vm-ironic.yaml) è¦‹ã¦ã‚‚ã‚ˆãç†è§£ã—ã¦ã„ãªã„è‡ªåˆ†ãŒã„ã‚‹\u0026hellip;(Â´ãƒ»Ï‰ãƒ»`)\nã¨ã„ã†ã‹æ‰‹é †ã«ã¯ãã®å‘¨ã‚Šã®ã“ã¨ä½•ã‚‚æ›¸ã„ã¦ã„ãªã„ã®ã§ã‡ã™ãŒãï¼\u0026hellip;\nã¨ã„ã†ã“ã¨ã§ã€ã¾ã ã¾ã ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã™ã‚‹ãƒãƒ£ãƒ³ã‚¹æº€è¼‰ã®çŠ¶æ…‹ãªã®ã§ã€ã‚ˆã‹ã£ãŸã‚‰ çš†ã•ã‚“å‚åŠ ã•ã‚Œã¾ã›ã‚“ã‹ !?!?\nhttps://wiki.openstack.org/wiki/HowToContribute\n","permalink":"https://jedipunkz.github.io/post/2013/12/05/ironic-openstack-beremetal/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®å­£ç¯€ãŒã‚„ã£ã¦å‚ã‚Šã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eIronic ã‚’ä½¿ã£ã¦ OpenStack ã§ãƒ™ã‚¢ãƒ¡ã‚¿ãƒ«ã‚µãƒ¼ãƒã‚’æ‰±ã„ãŸã„ï¼ã¨ã„ã†ã“ã¨ã§è‰²ã€…ã¨ã‚„ã£\nã¦ã„ã‚‹æœ€ä¸­ (ä»Šé€±ã‹ã‚‰å§‹ã‚ã¾ã—ãŸ..) ãªã®ã§ã™ãŒã€ã¾ã ã¾ã  incubator ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ\nã¨ã„ã†ã“ã¨ã‚‚ã‚ã£ã¦å®Ÿè£…ãŒè¿½ã„ä»˜ã„ã¦ã„ãªã‹ã£ãŸã‚Šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚æƒã£ã¦ã„ãªã‹ã£ãŸã‚Š\nã¨ã‚·ãƒ³ãƒ‰ã„çŠ¶æ³ï½— ã“ã“2æ—¥ç¨‹ã§é›†ã‚ãŸæƒ…å ±ã‚’æ•´ç†ã™ã‚‹ãŸã‚ã«ã‚‚ 2013å¹´ OpenStack ã‚¢ãƒ‰\nãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«å‚åŠ ã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã™ãƒ¼ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒè³‡æ–™ã®ã¾ã¨ã‚\"\u003eå‚è€ƒè³‡æ–™ã®ã¾ã¨ã‚\u003c/h2\u003e\n\u003cp\u003eã¾ãšã¯å…¬å¼ wiki ãƒšãƒ¼ã‚¸ã€‚é€†ã«è¨€ã†ã¨ã“ã“ã«è¨˜ã•ã‚Œã¦ã„ã‚‹ä»¥ä¸Šã®æƒ…å ±ã¯ç„¡ã„ã‚“ã˜ã‚ƒï¼Ÿã‚\nã¨ã¯ã‚³ãƒ¼ãƒ‰èª­ã‚ï¼ã®ä¸–ç•Œã‹ã‚‚..ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://wiki.openstack.org/wiki/Ironic\"\u003ehttps://wiki.openstack.org/wiki/Ironic\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003edevtest_undercloud ã§ã™ã€‚ä¸Šã®è³‡æ–™ã®ä¸­ã§ã‚‚æ‰‹é †ã®ä¸­ã§åº¦ã€…ã“ã¡ã‚‰ã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¦ã„ã‚‹ã€‚\nåŒã˜ã incubator ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® TrippleO ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãªã£ã¦ã„ã‚‹ã€‚\nä¸Šè¨˜ã®å…¬å¼ wiki ã®æƒ…å ±ã‚’åˆã‚ã›èª­ã‚€ã“ã¨ã§ Ironic ã‚’ä½¿ã£ãŸãƒ‡ãƒ—ãƒ­ã‚¤ã®æ‰‹é †ã«ä»•ä¸ŠãŒã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://docs.openstack.org/developer/tripleo-incubator/devtest_undercloud.html\"\u003ehttp://docs.openstack.org/developer/tripleo-incubator/devtest_undercloud.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€‚ã‚ã¨ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆæ–¹æ³•ã‚’è¨˜ã—ã¾ã™ãŒã€ã“ã¡ã‚‰ã‚’å–\nå¾—ã—ã¦ä½œæˆã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/openstack/ironic\"\u003ehttps://github.com/openstack/ironic\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ãƒˆã€‚ã¾ã æƒ…å ±ãŒæƒã£ã¦ã„ã¾ã›ã‚“ã€‚ã‚ˆã£ã¦ä¸Šã® github ã‹ã‚‰å–å¾—ã—ãŸãƒ¢\nãƒã‹ã‚‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œã‚‹æ–¹æ³•ã‚’å¾Œã§æ›¸ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://docs.openstack.org/developer/ironic/\"\u003ehttp://docs.openstack.org/developer/ironic/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003elaunchpad ã‚µã‚¤ãƒˆã€‚å…¨ã¦ã®ãƒã‚°æƒ…å ±ã‚„ãƒ–ãƒ«ãƒ¼ãƒ—ãƒªãƒ³ãƒˆç­‰ãŒé–²è¦§å‡ºæ¥ã¾ã™ã€‚ã¾ã çµ¶è³›é–‹ç™º\nä¸­ãªã®ã§èª­ã‚€å¿…è¦ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://launchpad.net/ironic\"\u003ehttps://launchpad.net/ironic\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œã‚‹\n+++\u003c/p\u003e\n\u003cp\u003eå…¬å¼ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ãƒˆã¯ä¸€å¿œã€ä¸Šè¨˜ã®é€šã‚Šã‚ã‚‹ã®ã§ã™ãŒã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚çµ¶è³›åŸ·ç­†\nä¸­ã¨ã„ã†ã“ã¨ã§æ‰€ã€…æŠœã‘ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ãƒˆãŒã©ã®ã‚¹ãƒ‘ãƒ³ã§æ›´æ–°\nã•ã‚Œã¦ã„ã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ã®ã§ã€ã„ã¡æ—©ãæƒ…å ±ã‚’ã‚²ãƒƒãƒˆã—ãŸã„å ´åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œã‚‹å¿…\nè¦ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚ã¨ã„ã†ã“ã¨ã§ã€ãã®ä½œã‚Šæ–¹ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚å°šã€å…¬å¼ wiki ã‚µ\nã‚¤ãƒˆã«ã‚‚æ‰‹é †ãŒè¼‰ã£ã¦ã„ã¾ã™ãŒ Vagrant ã¨ Apache ã‚’ç”¨ã„ãŸæ–¹æ³•ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€\næ™®é€šã« Ubuntu ã‚µãƒ¼ãƒãŒæ‰‹å…ƒã«ã‚ã‚‹ç’°å¢ƒã‚’æƒ³å®šã—ã¦èª­ã¿æ›¿ãˆãªãŒã‚‰èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo apt-get update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo apt-get install -y git python-dev swig libssl-dev python-pip \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e  libmysqlclient-dev libxml2-dev libxslt-dev libxslt1-dev python-mysqldb \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e  libpq-dev\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo pip install virtualenv setuptools-git flake8 tox\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo easy_install nose\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚\u003c/p\u003e","title":"Ironic ã§ãƒ™ã‚¢ãƒ¡ã‚¿ãƒ« OpenStack ï¼..ã®ä¸€æ­©æ‰‹å‰"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»¥å‰ã€Sensu ã‚’ Chef ã§ç®¡ç†ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦æ›¸ãã¾ã—ãŸã€‚\nhttp://jedipunkz.github.io/blog/2013/06/20/sensu-chef-controll/\nã“ã‚Œã¯ä»Šå¹´(2013)ã®6æœˆé ƒã®è¨˜äº‹ã§ã™ãŒã€ã“ã®æ™‚ã¯ã¾ã  sensu-chef ã‚’ include ã—ã¦ä½¿ã†åˆ¥ã® Chef Cookbook ãŒå¿…è¦ã§ã—ãŸã€‚ã¾ãŸ Redis å‘¨ã‚Šã® Cookbooks ãŒå®Œæˆåº¦ã‚ã¾ãã€ã¾ãŸã“ã‚Œã‚‚ å…¬å¼ã¨ã¯åˆ¥ã® Cookbooks ã‚’æ”¹ä¿®ã—ã¦å†åˆ©ç”¨ã™ã‚‹å½¢ã§ã—ãŸã€‚ã“ã®ä½œæ¥­ã¯çµæ§‹ã—ã‚“ã©ã‹ã£ ãŸè¨˜æ†¶ãŒã‚ã‚‹ã®ã§ã™ãŒã€æœ€è¿‘ GlideNote ã•ã‚“ã®ãƒ–ãƒ­ã‚°ã‚’èª­ã‚“ã§( ï¾ŸĞ´ï¾Ÿ)ï¾Šï½¯!ã¨æ€ã„ã€ sensu-chef ã‚’å†ç¢ºèªã—ãŸã®ã§ã™ãŒã€ã ã„ã¶æ›´æ–°ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚\nä¸‹è¨˜ãŒ sensu-chef ã§ã™ã€‚\nhttps://github.com/sensu/sensu-chef\nã“ã® Chef Cookbook å˜ä½“ã§åˆ©ç”¨ã§ãã‚‹å½¢ã«æ›´æ–°ã•ã‚Œã¦ã„ã¦ã€plugins, checks ç­‰ã¯ Recipe ã«è¿½è¨˜ã™ã‚‹ã“ã¨ã§å¯¾å¿œå¯èƒ½ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚æ—©é€Ÿåˆ©ç”¨ã—ã¦ã¿ãŸã®ã§ç°¡å˜ã«ä½¿ ã„æ–¹ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚\nä¸‹è¨˜ãŒ Sensu ã®ç®¡ç†ç”»é¢ã§ã™ã€‚æœ€çµ‚çš„ã«ã“ã®ç”»é¢ã«ç›£è¦–å¯¾è±¡ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒä¸ŠãŒã£ã¦ãã¾ã™ã€‚\n{% img /pix/sensu.png %}\nä½¿ã„æ–¹ sensu-chef ã‚’å–å¾—ã™ã‚‹ã€‚chef-repo ã«ãªã£ã¦ã„ã¾ã™ã€‚\n% git clone https://github.com/sensu/sensu-chef.git ~/chef-repo-sensu bundle ã«ã¦ Gemfile ã«è¨˜è¿°ã®åœ¨ã‚‹ gem ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% cd ~/chef-repo-sensu % bundle install .chef/ é…ä¸‹ã®è¨­å®šã¯å‰²æ„›ã—ã¾ã™ã€‚chef ã‚µãƒ¼ãƒã®æƒ…å ±ã«åˆã‚ã›ã¦è¨­å®šã—ã¾ã™ã€‚\nssl éµã‚’ç”Ÿæˆã—ã¦ data bags ã«æŠ•å…¥ã—ã¾ã™ã€‚\n% cd examples/ssl % ./ssl_certs.sh generate % cd ../../ % knife data bag create sensu % knife data bag from file sensu examples/ssl/ssl.json % ./examples/ssl/ssl_certs.sh clean Roles ã‚’ä½œæˆã—ã¾ã™ã€‚chef-repo ãªã®ã«ä½•ã‚‚å…¥ã£ã¦ã„ã¾ã›ã‚“ã§ã—ãŸ\u0026hellip;æ±— ã“ã“ã§é¢ç™½ã„ã®ã¯ \u0026lsquo;sensu-client\u0026rsquo; ã¯ sensu ã§è¨€ã† subscribers ã®åå‰ã«ãã®ã¾ã¾åˆ© ç”¨ã•ã‚Œã‚‹ã¨ã“ã‚ã§ã™ã€‚ã¤ã¾ã‚Š \u0026lsquo;sensu-client\u0026rsquo; ã®åå‰ãŒè¨˜ã•ã‚ŒãŸ sensu ã‚µãƒ¼ãƒä¸Šã®ç›£ è¦–é …ç›® (checks) ãŒã“ã® sensu ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚\n% mkdir roles % ${EDITOR} roles/sensu-server.rb name \u0026#34;sensu-server\u0026#34; description \u0026#34;role applied to sensu server.\u0026#34; run_list \u0026#39;recipe[sensu::default]\u0026#39;, \u0026#39;recipe[sensu::rabbitmq]\u0026#39;, \u0026#39;recipe[sensu::redis]\u0026#39;, \u0026#39;recipe[sensu::server_service]\u0026#39;, \u0026#39;recipe[sensu::api_service]\u0026#39;, \u0026#39;recipe[sensu::dashboard_service]\u0026#39;, \u0026#39;recipe[chef-client::service]\u0026#39; % ${EDITOR} roles/sensu-client.rb name \u0026#34;sensu-client\u0026#34; description \u0026#34;role applied to sensu client.\u0026#34; run_list \u0026#39;recipe[sensu::default]\u0026#39;, \u0026#39;recipe[sensu::client_service]\u0026#39;, \u0026#39;recipe[chef-client::service]\u0026#39; Cheffile ã« \u0026lsquo;chef-client\u0026rsquo; ã® Cookbook åã‚’è¿½è¨˜ã—ã¾ã™ã€‚\nsite \u0026#39;http://community.opscode.com/api/v1\u0026#39; cookbook \u0026#39;sensu\u0026#39;, path: \u0026#39;./\u0026#39; cookbook \u0026#39;sensu-test\u0026#39;, path: \u0026#39;./test/cookbooks/sensu-test\u0026#39; cookbook \u0026#39;chef-client\u0026#39; # \u0026lt;---- è¿½è¨˜ librarian-chef ã‚’å®Ÿè¡Œã—ã¦ Cookbooks ã‚’å–å¾—ã—ã¾ã™ã€‚\n% librarian-chef install Rabbitmq, Redis, API ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®šã—ã¾ã™ã€‚IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä¾‹ã§ã™ã€‚\n% ${EDITOR} cookbooks/sensu/attributes/default.rb default.sensu.rabbitmq.host = \u0026#34;172.24.19.11\u0026#34; default.sensu.redis.host = \u0026#34;172.24.19.11\u0026#34; default.sensu.api.host = \u0026#34;172.24.19.11\u0026#34; sensu-server ç”¨ã® Recipe ã«ç›£è¦–é …ç›®ã‚’è¿½è¨˜ã—ã¾ã™ã€‚ã“ã“ã§ã¯ cron ãƒ‡ãƒ¼ãƒ¢ãƒ³ã®ç¨¼åƒ çŠ¶æ³ã‚’ç›£è¦–ã—ã¦ã¿ã¾ã—ãŸã€‚\n% ${EDITOR} cookbooks/sensu/recipes/server_service.rb # ä¸‹è¨˜ã‚’è¿½è¨˜ sensu_check \u0026#34;cron_process\u0026#34; do command \u0026#34;check-procs.rb -p cron -C 1\u0026#34; handlers [\u0026#34;default\u0026#34;] subscribers [\u0026#34;sensu-client\u0026#34;] interval 30 additional(:notification =\u0026gt; \u0026#34;Cron is not running\u0026#34;, :occurrences =\u0026gt; 5) end sensu-client ç”¨ã® Recipe ã« client.json (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«) ã®è¨˜è¿°ã¨ ä¸Šè¨˜ç›£è¦–é …ç›®ã«åˆã£ãŸ plugins è¨­å®šã®è¿½è¨˜ã‚’è¡Œã„ã¾ã™ã€‚\n% ${EDITOR} cookbooks/sensu/recipes/client_service.rb # ä¸‹è¨˜ã‚’è¿½è¨˜ sensu_client node.name do address node.ipaddress subscriptions node.roles + [\u0026#34;all\u0026#34;] end cookbook_file \u0026#39;check-procs.rb\u0026#39; do source \u0026#39;check-procs.rb\u0026#39; mode 0755 path \u0026#39;/etc/sensu/plugins/check-procs.rb\u0026#39; end ä¸Šè¨˜ check-procs.rb ã¯ community ã‚µã‚¤ãƒˆã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ãŒ cookbook_file ã§å¯¾å¿œã—ãŸã®ã§ files/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«ç½®ã„ã¦ãŠãã¾ã™ã€‚\n% mkdir -p cookbooks/sensu/files/default % wget -o cookbooks/sensu/files/default/check-procs.rb \\ https://github.com/sensu/sensu-community-plugins/raw/master/plugins/processes/check-procs.rb ä¸Šè¨˜ã® check-procs.rb ã¯è¡Œé ­ã« \u0026lsquo;#!/usr/bin/env ruby\u0026rsquo; ãŒè¨˜ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒ Sensu ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«å…¥ã‚‹ ruby ã¯ /opt/sensu/embedded/bin/ruby ã«ã‚ã‚‹ã®ã§è¡Œé ­ ã®1è¡Œã‚’æ›¸ãæ›ãˆã¾ã™ã€‚\n% diff cookbooks/sensu/files/default/check-procs.rb.org cookbooks/sensu/files/default/check-procs.rb - #!/usr/bin/env ruby + #!/opt/sensu/embedded/bin/ruby Roles, Cookbooks ã‚’ Chef ã‚µãƒ¼ãƒã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\n% knife cookbook upload -o ./cookbooks -a % knife role from file roles/*.rb ã„ã‚ˆã„ã‚ˆãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã—ã¾ã™!\nã¾ãšã¯ sensu-server ã‚’ã€‚\n% knife bootstrap \u0026lt;server_ip_addr\u0026gt; -N sensu-server -r \u0026#39;role[sensu-server]\u0026#39; \\ -x ubuntu --sudo æ¬¡ã«ç›£è¦–å¯¾è±¡ã§ã‚ã‚‹ sensu-client ã‚’ã€‚\n% knife bootstrap \u0026lt;client_ip_addr\u0026gt; -N sensu-client01 -r \u0026#39;role[sensu-client]\u0026#39; \\ -x ubuntu --sudo http://\u0026lt;sensu-server ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹\u0026gt;:8080/ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ Sensu ã®ç®¡ç†ç”»é¢ãŒ è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚èªè¨¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ cookbooks/sensu/attributes/default.rb ã«è¨˜è¿°ãŒ ã‚ã‚Šã¾ã™ã®ã§ç¢ºèªã—ã¦ä¸‹ã•ã„ã€‚\nã¾ã¨ã‚ ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ã®ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŒ–ã«ã¤ã„ã¦æƒ…å ±ãƒªã‚µãƒ¼ãƒã—ã¦ã„ã¾ã™ãŒç›£è¦–ã‚‚ é‡è¦ãªã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ã®ä¸€éƒ¨ã§ã™ã€‚Sensu ã‚µãƒ¼ãƒãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå‡º æ¥ãŸã®ã§ã“ã‚Œã§ä¸€ã¤ãƒ‘ãƒ¼ãƒ„ãŒæƒã£ãŸã“ã¨ã«ã€‚Sensu ã¯ API ã‚’æŒã£ã¦ã„ã¾ã™ã®ã§ã‚¢ãƒ—ãƒª ã‹ã‚‰æ¤œçŸ¥ã™ã‚‹ã“ã¨ã‚‚ç°¡å˜ã«å‡ºæ¥ã¾ã™ã‚ˆã€‚API ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚\nhttp://sensuapp.org/docs/0.12/api\nã¾ãŸä»¥å‰æŠ±ãˆã¦ã„ãŸå•é¡Œã‚‚ã‚¹ãƒƒã‚­ãƒªã‚¯ãƒªã‚¢ã«ãªã£ã¦ã€ã“ã‚Œã§ã¾ãŸå‰é€²ã§ããŸæ„ŸãŒã‚ã‚Šã¾ã™ã€‚\nå‚è€ƒã‚µã‚¤ãƒˆ http://sensuapp.org/docs/0.12 http://blog.glidenote.com/blog/2013/11/26/sensu/ https://github.com/sensu/sensu-chef ","permalink":"https://jedipunkz.github.io/post/2013/11/27/sensu-chef-deploy-2/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥å‰ã€Sensu ã‚’ Chef ã§ç®¡ç†ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦æ›¸ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://jedipunkz.github.io/blog/2013/06/20/sensu-chef-controll/\"\u003ehttp://jedipunkz.github.io/blog/2013/06/20/sensu-chef-controll/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã“ã‚Œã¯ä»Šå¹´(2013)ã®6æœˆé ƒã®è¨˜äº‹ã§ã™ãŒã€ã“ã®æ™‚ã¯ã¾ã  sensu-chef ã‚’ include ã—ã¦ä½¿ã†åˆ¥ã® Chef\nCookbook ãŒå¿…è¦ã§ã—ãŸã€‚ã¾ãŸ Redis å‘¨ã‚Šã® Cookbooks ãŒå®Œæˆåº¦ã‚ã¾ãã€ã¾ãŸã“ã‚Œã‚‚\nå…¬å¼ã¨ã¯åˆ¥ã® Cookbooks ã‚’æ”¹ä¿®ã—ã¦å†åˆ©ç”¨ã™ã‚‹å½¢ã§ã—ãŸã€‚ã“ã®ä½œæ¥­ã¯çµæ§‹ã—ã‚“ã©ã‹ã£\nãŸè¨˜æ†¶ãŒã‚ã‚‹ã®ã§ã™ãŒã€æœ€è¿‘ GlideNote ã•ã‚“ã®ãƒ–ãƒ­ã‚°ã‚’èª­ã‚“ã§( ï¾ŸĞ´ï¾Ÿ)ï¾Šï½¯!ã¨æ€ã„ã€\nsensu-chef ã‚’å†ç¢ºèªã—ãŸã®ã§ã™ãŒã€ã ã„ã¶æ›´æ–°ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹è¨˜ãŒ sensu-chef ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/sensu/sensu-chef\"\u003ehttps://github.com/sensu/sensu-chef\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã“ã® Chef Cookbook å˜ä½“ã§åˆ©ç”¨ã§ãã‚‹å½¢ã«æ›´æ–°ã•ã‚Œã¦ã„ã¦ã€plugins, checks ç­‰ã¯\nRecipe ã«è¿½è¨˜ã™ã‚‹ã“ã¨ã§å¯¾å¿œå¯èƒ½ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚æ—©é€Ÿåˆ©ç”¨ã—ã¦ã¿ãŸã®ã§ç°¡å˜ã«ä½¿\nã„æ–¹ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹è¨˜ãŒ Sensu ã®ç®¡ç†ç”»é¢ã§ã™ã€‚æœ€çµ‚çš„ã«ã“ã®ç”»é¢ã«ç›£è¦–å¯¾è±¡ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒä¸ŠãŒã£ã¦ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e{% img /pix/sensu.png %}\u003c/p\u003e\n\u003ch2 id=\"ä½¿ã„æ–¹\"\u003eä½¿ã„æ–¹\u003c/h2\u003e\n\u003cp\u003esensu-chef ã‚’å–å¾—ã™ã‚‹ã€‚chef-repo ã«ãªã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% git clone https://github.com/sensu/sensu-chef.git ~/chef-repo-sensu\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ebundle ã«ã¦ Gemfile ã«è¨˜è¿°ã®åœ¨ã‚‹ gem ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% cd ~/chef-repo-sensu\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% bundle install\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e.chef/ é…ä¸‹ã®è¨­å®šã¯å‰²æ„›ã—ã¾ã™ã€‚chef ã‚µãƒ¼ãƒã®æƒ…å ±ã«åˆã‚ã›ã¦è¨­å®šã—ã¾ã™ã€‚\u003c/p\u003e","title":"sensu-chef ã§ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ  Sensu ã‚’ç®¡ç† #2"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nè‡ªå®…ãƒ«ãƒ¼ã‚¿ã‚’ Vyatta ã§é‹ç”¨ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€è«¸é›»åŠ›ãªç­ä½“ã«äº¤æ›ã—ãŸéš›ã« HDD ã‚¹ ãƒ­ãƒƒãƒˆãŒä½™ã£ã¦ã„ãŸã®ã§ HDD ã‚’ä¸€æœ¬ã•ã—ã¦ã¿ã¾ã—ãŸã€‚ã‚‚ã£ãŸã„ãªã„ã®ã§ Netatalk ã‚’ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ Mac ç”¨ã® TimeMachine ã‚µãƒ¼ãƒã«ã™ã‚‹ã‹ï¼ãã‚“ã§ã‚‚ã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ ãƒå…¼å‹™ã«ã—ã‚ˆã†ï¼ã¨æ€ã„ç«‹ã£ã¦ä½œæ¥­ã—ãŸã‚‰ç°¡å˜ã«å‡ºæ¥ãŸã®ã§å…±æœ‰ã—ã¾ã™ã€‚\nVyatta ã¯ã”å­˜çŸ¥ã®é€šã‚Š Debian Gnu/Linux ãŒãƒ™ãƒ¼ã‚¹ã«ãªã£ã¦ã„ã‚‹ã®ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ¬ãƒ ã‚¸ãƒˆãƒªã‚’è¿½åŠ ã—ã¦ã¡ã‚‡ã¡ã‚‡ã„ã§è¨­å®šå‡ºæ¥ã¾ã™ã€‚\næ‰‹é † é›»æºã‚’é€šã—ã¦ Disk ã‚’è¿½åŠ ã—ã¾ã™ã€‚ãã®å¾Œèµ·å‹•ã€‚ç§ã¯ 3TB Disk ãŒä½™ã£ã¦ã„ãŸã®ã§ãã‚Œ ã‚’æŒ¿ã—ã¾ã—ãŸã€‚\ndebian wheezy ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ Vyatta ã«è¿½è¨˜ã—ã¾ã™ã€‚\n% configure # set system package repository debian url http://ftp.jp.debian.org/debian # set system package repository debian distribution wheezy # set system package repository debian components \u0026#34;main contrib\u0026#34; # commit # save # exit netatalk, avahi ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚ãã®éš›ã« libgcrypt11 ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.5.0 ãŒ å¿…è¦ã«ãªã‚‹ã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã€‚\n% sudo apt-get update % sudo apt-get install netatalk avahi-daemon avahi-utils libgcrypt11 ãƒ‡ã‚£ã‚¹ã‚¯ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’è¡Œã†ãŸã‚ã« e2fsprogs, gdisk ã‚’å…¥ã‚Œ ã‚‹ã€‚2TB ã‚ªãƒ¼ãƒãƒ¼ãª disk ãŒä¸€èˆ¬çš„ã«ãªã£ãŸã®ã§ fdisk ã§ã¯ãªã gdisk ã‚’ä½¿ã†ã€‚\n% sudo apt-get install e2fsprogs gdisk ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ã‚’è¡Œã†ã€‚ç§ã¯1ã¤ã®å¤§ããªãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ä½œã‚Šã¾ã—ãŸã€‚ãã®å¾Œãƒ•ã‚¡ ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ  ext4 ã«ã¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’è¡Œã„ã¾ã™ã€‚\n% sudo gdisk /dev/sdb # ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°æ–¹æ³•ã¯å‰²æ„› % sudo mkfs.ext4 /dev/sdb1 /mnt ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚/mnt/storage ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒç”¨, /mnt/timemachine ã‚’ Mac ã® TimeMachine ç”¨ã¨ã—ã¦ç¨¼åƒã•ã›ã‚‹ãŸã‚ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ ä½œæˆã—ã¾ã™ã€‚\n% sudo mount -t ext4 /dev/sdb1 /mnt % sudo vi /etc/fstab # /mnt ã®è¨˜è¿°è¿½åŠ  % sudo mkdir /mnt/storage ; sudo chown \u0026lt;userid\u0026gt;:users /mnt/storage % sudo mkdir /mnt/timemachine ; sudo chown \u0026lt;userid\u0026gt;:users /mnt/timemachine /etc/netatalk/apfd.conf ã‚’ä¿®æ­£ã—ã¾ã™ã€‚\n% diff /etc/netatalk/apfd.conf.org /etc/netatalk/afpd.conf - # - -tcp -noddp -uamlist uams_dhx.so,uams_dhx2.so -nosavepassword + - -tcp -noddp -uamlist uams_guest.so,uams_dhx.so,uams_dhx2.so -nosavepassword TimeMachine ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ã«ä¸‹è¨˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ touch ã—ã¾ã™ã€‚ä¸­èº«ã¯ç©ºã§ OK ã§ã™ã€‚\n% touch /mnt/timemachine/.com.apple.timemachine.supported /etc/netatalk/AppleVolumes.default ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒ, TimeMachine ç”¨ã® è¨­å®šã‚’æŠ•å…¥ã—ã¾ã™ã€‚TimeMachine ç”¨ã¯ä¸‹è¨˜ã®é€šã‚Šã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚\n% sudo vi /etc/netatalk/AppleVolumes.default # ä¸‹è¨˜ã‚’è¿½è¨˜ /mnt/storage \u0026#34;Storage\u0026#34; /mnt/timemachine \u0026#34;TimeMachine\u0026#34; cnidscheme:dbd options:usedots,upriv,tm netatalk ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚\n% sudo /etc/init.d/netatalk restart TimeMachine ã‚’è¨­å®šã™ã‚‹ Mac å´ã®è¨­å®š ä»Šå›ã®æ§˜ã« Apple å…¬å¼ã® TimeCupsule ä»¥å¤–ã®ãƒã‚·ãƒ³ã‚’ TimeMachine ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— å…ˆã¨ã—ã¦åˆ©ç”¨ã™ã‚‹å ´åˆã€Mac å´ã§ä¸‹è¨˜ã®è¨­å®šãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚\n% defaults write com.apple.systempreferences TMShowUnsupportedNetworkVolumes 1 ã‚ã¨ã¯ \u0026lsquo;ç’°å¢ƒè¨­å®š\u0026rsquo; -\u0026gt; \u0026lsquo;TimeMachine\u0026rsquo; ã«ã¦ Vyatta ã‚’ TimeMachine ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å…ˆ ã«æŒ‡å®šã™ã‚Œã° OK ã§ã™ã€‚\nã¾ã¨ã‚ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ¬ãƒã‚¸ãƒˆãƒªã¯ Wheezy ã® main, contrib ã‚’è¨­å®šã—ã¾ã—ãŸãŒä»–ã®ãƒ¢ãƒã‚’å…¥ã‚Œ ã‚‹ã“ã¨ã‚‚å‹¿è«–å¯èƒ½ã€‚æœ€è¿‘ã® Netatalk ã¯ TimeMachine ç”¨ã®è¨­å®šãŒç°¡å˜ã«ã§ãã‚‹ã‚ˆã†ã« ãªã£ã¦ã„ã¾ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/11/26/vyatta-timemachine-netatalk/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eè‡ªå®…ãƒ«ãƒ¼ã‚¿ã‚’ Vyatta ã§é‹ç”¨ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€è«¸é›»åŠ›ãªç­ä½“ã«äº¤æ›ã—ãŸéš›ã« HDD ã‚¹\nãƒ­ãƒƒãƒˆãŒä½™ã£ã¦ã„ãŸã®ã§ HDD ã‚’ä¸€æœ¬ã•ã—ã¦ã¿ã¾ã—ãŸã€‚ã‚‚ã£ãŸã„ãªã„ã®ã§ Netatalk ã‚’\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ Mac ç”¨ã® TimeMachine ã‚µãƒ¼ãƒã«ã™ã‚‹ã‹ï¼ãã‚“ã§ã‚‚ã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼\nãƒå…¼å‹™ã«ã—ã‚ˆã†ï¼ã¨æ€ã„ç«‹ã£ã¦ä½œæ¥­ã—ãŸã‚‰ç°¡å˜ã«å‡ºæ¥ãŸã®ã§å…±æœ‰ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eVyatta ã¯ã”å­˜çŸ¥ã®é€šã‚Š Debian Gnu/Linux ãŒãƒ™ãƒ¼ã‚¹ã«ãªã£ã¦ã„ã‚‹ã®ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ¬ãƒ\nã‚¸ãƒˆãƒªã‚’è¿½åŠ ã—ã¦ã¡ã‚‡ã¡ã‚‡ã„ã§è¨­å®šå‡ºæ¥ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ‰‹é †\"\u003eæ‰‹é †\u003c/h2\u003e\n\u003cp\u003eé›»æºã‚’é€šã—ã¦ Disk ã‚’è¿½åŠ ã—ã¾ã™ã€‚ãã®å¾Œèµ·å‹•ã€‚ç§ã¯ 3TB Disk ãŒä½™ã£ã¦ã„ãŸã®ã§ãã‚Œ\nã‚’æŒ¿ã—ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003edebian wheezy ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ Vyatta ã«è¿½è¨˜ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% configure\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# set system package repository debian url http://ftp.jp.debian.org/debian\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# set system package repository debian distribution wheezy\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# set system package repository debian components \u0026#34;main contrib\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# commit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# save\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# exit \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003enetatalk, avahi ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚ãã®éš›ã« libgcrypt11 ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.5.0 ãŒ\nå¿…è¦ã«ãªã‚‹ã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã€‚\u003c/p\u003e","title":"Vyatta ã§ Mac ç”¨ TimeMachine ã‚µãƒ¼ãƒå…¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ï¼"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\næ¯åº¦ãŠé¦´æŸ“ã¿ã«ãªã£ãŸ OpenStack ã® Chef ã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ã§ã™ãŒã€ä»Šå›ã¯ OpenStack Havana æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã§ã™ã€‚ä½¿ç”¨ã™ã‚‹ã®ã¯ä»Šå›ã‚‚ rcbops/chef-cookbooks ã§ã™ã€‚ãƒ–ãƒ©ãƒ³ãƒã¯ \u0026lsquo;havana\u0026rsquo; ã‚’ç”¨ã„ã¾ã™ã€‚\næ—©é€Ÿã§ã™ãŒæ§‹æˆã«ã¤ã„ã¦ã€‚4.1.2 è¾ºã‚Šã‹ã‚‰ã ã¨æ€ã†ã®ã§ã™ãŒæ§‹æˆã®å‰æãŒç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼ ã‚¯4ã¤ã‚’å‰æã«ã—å§‹ã‚ã¾ã—ãŸã€‚public, external (VM) ã‚’åˆ¥ã‘ã‚‹å¿…è¦ãŒå‡ºã¦ãã¾ã—ãŸã€‚ é€šä¿¡ã®ç‰¹æ€§ã‚‚ç•°ãªã‚‹ã®ã§ (public ã¯ public API ã‚’ã€‚external ã¯ VM ç”¨) ã€åˆ¥ã‘ã‚‹ã® ãŒå¾—ç­–ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\næ§‹æˆ +--------------+------------------------------------------------------- external | | +--------------+--(-----------+--(-----------+--------------+---------------------------- public | | | | | | | +------------+ +------------+ +------------+ +------------+ +------------+ +------------+ | controller | | network | | network | | compute | | compute | | workstation| +------------+ +------------+ +------------+ +------------+ +------------+ +------------+ | | | | | | | | | | +--------------+--(-----------+--(-----------+--(-----------+--(-----------+------------- management | | | | +--------------+--------------+--------------+------------------------- guest ä¸Šè¨˜ã®æ§‹æˆã®ç‰¹å¾´ 4ã¤ã®ç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å‰æ public ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ : å¤–éƒ¨ API ç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ external ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ : ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤–éƒ¨æ¥ç¶šç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ guest ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ : ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†…éƒ¨ç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ management ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ : å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ¥ç¶šç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ public, external ã®ã¿ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ controller : 2 nics, network : 4 nics, compute : 3nics ã®æ§‹æˆ controller ã¯ã‚·ãƒ³ã‚°ãƒ«æ§‹æˆ network ãƒãƒ¼ãƒ‰ã¯å°æ•°æ‹¡å¼µå¯èƒ½, agent å˜ä½ã§ãƒãƒ¼ãƒ‰é–“ç§»å‹•å¯èƒ½ compute ãƒãƒ¼ãƒ‰ã‚‚å°æ•°æ‹¡å¼µå¯èƒ½ workstation ã¯ chef-repo ã®æ‰€åœ¨åœ°, management ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ‰€å± å„ãƒãƒ¼ãƒ‰ã®æº–å‚™ OS ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€å„ãƒãƒ¼ãƒ‰ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®è¨­å®šã‚’ä¸‹è¨˜ã®é€šã‚Šè¡Œã£ ã¦ãã ã•ã„ã€‚ã¾ãŸ LVM ã‚’ä½¿ã†ã®ã§ã‚ã‚Œã° cinder ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®è¨­å®šã‚‚å¿…è¦ã«ãªã£ã¦ãã¾ã™ã€‚\ncontroller ãƒãƒ¼ãƒ‰ 2 nics ã‚’ä¸‹è¨˜ã®é€šã‚Šè¨­å®šã—ã¾ã™ã€‚\neth0 ã‚’ public ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã€‚gateway ã‚’ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«è¨­å®š eth1 ã‚’ guest ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã€‚gateway ã¯ãªã— /etc/network/interfaces ã®ä¾‹\nauto eth0 iface eth0 inet static address \u0026lt;ip_addr\u0026gt; netmask \u0026lt;netmask\u0026gt; gateway \u0026lt;gateway\u0026gt; dns-nameservers \u0026lt;dns_cache_server\u0026gt; dns-search \u0026lt;domain\u0026gt; auto eth1 iface eth1 inet static address \u0026lt;ip_addr\u0026gt; netmask \u0026lt;netmask\u0026gt; /dev/sdb ã‚’ cinder ç”¨ãƒ‡ã‚£ã‚¹ã‚¯ãƒ‡ãƒã‚¤ã‚¹ã¨ã—ã¾ã™ã€‚\n% sudo pvcreate /dev/sdb % sudo vgcreate cinder-volumes /dev/sdb network ãƒãƒ¼ãƒ‰ 4 nics ã‚’ä¸‹è¨˜ã®é€šã‚Šè¨­å®šã—ã¾ã™ã€‚up route ã§ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’æ›¸ ã„ã¦ã‚ã’ã‚‹ã¨ã€network ãƒãƒ¼ãƒ‰ã‹ã‚‰ç›´æ¥ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸é€šä¿¡ã™ã‚‹ ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚æœ€åˆã¯æ›¸ã‹ãªãã¦ã‚‚ OK ã§ã™ã€‚\nauto eth0 iface eth0 inet static address \u0026lt;ip_addr\u0026gt; netmask \u0026lt;netmask\u0026gt; dns-nameservers \u0026lt;dns_cache_server\u0026gt; dns-search \u0026lt;domain\u0026gt; auto eth1 iface eth1 inet static address \u0026lt;ip_addr\u0026gt; netmask \u0026lt;netmask\u0026gt; auto eth2 iface eth2 inet static address \u0026lt;ip_addr\u0026gt; netmask \u0026lt;netmask\u0026gt; gateway 10.200.10.1 dns-nameservers 8.8.8.8 8.8.4.4 dns-search cpi.ad.jp auto eth3 iface eth3 inet static address \u0026lt;ip_addr\u0026gt; netmask \u0026lt;netmask\u0026gt; # ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° # up route add -net \u0026lt;virtual_net_cidr\u0026gt; gw \u0026lt;neutron_gw\u0026gt; # up route add -net \u0026lt;virtual_net_cidr\u0026gt; gw \u0026lt;neutron_gw\u0026gt; compute ãƒãƒ¼ãƒ‰ 3 nics ã‚’ä¸‹è¨˜ã®é€šã‚Šè¨­å®šã—ã¾ã™ã€‚\nauto eth0 iface eth0 inet static address \u0026lt;ip_addr\u0026gt; netmask \u0026lt;netmask\u0026gt; dns-nameservers \u0026lt;dns_cache_server\u0026gt; dns-search \u0026lt;domain\u0026gt; auto eth1 iface eth1 inet static address \u0026lt;ip_addr\u0026gt; netmask \u0026lt;netmask\u0026gt; auto eth2 iface eth2 inet static address \u0026lt;ip_addr\u0026gt; netmask \u0026lt;netmask\u0026gt; gateway \u0026lt;gateway\u0026gt; dns-nameservers \u0026lt;dns_cache_server\u0026gt; dns-search \u0026lt;domain\u0026gt; Cookbooks, Roles, Environments ç­‰ã®æº–å‚™ ä¸‹è¨˜ã®æ“ä½œã¯å…¨ã¦ workstation ãƒãƒ¼ãƒ‰ã‹ã‚‰ã®æ“ä½œã§ã™ã€‚ ã¾ãŸ chef ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚„ chef ã‚µãƒ¼ãƒã®æ§‹ç¯‰æ–¹æ³•ã«ã¤ã„ã¦ã¯å‰²æ„›ã—ã¾ã™ã€‚\nrcbops/chef-cookbooks ã‚’å–å¾—ã—ã¾ã™ã€‚\n% git clone https://github.com/rcbops/chef-cookbooks.git % cd chef-cookbooks % git checkout -b havana remotes/origin/havana % # .chef é…ä¸‹ã®æº–å‚™å‰²æ„›ã€‚å„ Chef ã‚µãƒ¼ãƒç’°å¢ƒã«åˆã‚ã›ã‚‹ % git submodule init % git submodule sync % git submodule update % knife cookbook upload -o cookbooks -a % knife role from file roles/*.rb ä»Šå›ã®æ§‹æˆç”¨ã® environment ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ãã‚Œãã‚Œã®ç’°å¢ƒã«åˆã‚ã›ã¦ä½œæˆã—ã¦ãã  ã•ã„ã€‚ç”Ÿæˆã®ã‚³ãƒ„ã¯å„ Cookbooks ã® attributes ã‚’è¦‹ãªãŒã‚‰è¨­å®šã™ã‚‹ã“ã¨ã§ã™ã€‚ ç”Ÿæˆã—ãŸ json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ environments ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«é…ç½®ã—ã¾ã™ã€‚\n{ \u0026#34;name\u0026#34;: \u0026#34;havana-neutron\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;cookbook_versions\u0026#34;: { }, \u0026#34;json_class\u0026#34;: \u0026#34;Chef::Environment\u0026#34;, \u0026#34;chef_type\u0026#34;: \u0026#34;environment\u0026#34;, \u0026#34;default_attributes\u0026#34;: { }, \u0026#34;override_attributes\u0026#34;: { \u0026#34;package_component\u0026#34;: \u0026#34;havana\u0026#34;, \u0026#34;osops_networks\u0026#34;: { \u0026#34;management\u0026#34;: \u0026#34;10.200.10.0/24\u0026#34;, \u0026#34;public\u0026#34;: \u0026#34;10.200.9.0/24\u0026#34;, \u0026#34;nova\u0026#34;: \u0026#34;10.200.10.0/24\u0026#34; }, \u0026#34;nova\u0026#34;: { \u0026#34;config\u0026#34;: { \u0026#34;use_single_default_gateway\u0026#34;: false, \u0026#34;ram_allocation_ratio\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;cpu_allocation_ratio\u0026#34;: \u0026#34;16\u0026#34; }, \u0026#34;network\u0026#34;: { \u0026#34;provider\u0026#34;: \u0026#34;neutron\u0026#34;, \u0026#34;network_type\u0026#34;: \u0026#34;vlan\u0026#34; }, \u0026#34;apply_patches\u0026#34;: true, \u0026#34;libvirt\u0026#34;: { \u0026#34;vncserver_listen\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;virt_type\u0026#34;: \u0026#34;kvm\u0026#34; }, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;nova\u0026#34; }, \u0026#34;services\u0026#34;: { \u0026#34;novnc-proxy\u0026#34;: { \u0026#34;network\u0026#34;: \u0026#34;public\u0026#34; }, \u0026#34;ec2-admin\u0026#34;: { \u0026#34;network\u0026#34;: \u0026#34;management\u0026#34; } } }, \u0026#34;cinder\u0026#34;: { \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;cinder\u0026#34; } }, \u0026#34;keystone\u0026#34;: { \u0026#34;admin_user\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;tenants\u0026#34;: [ \u0026#34;admin\u0026#34;, \u0026#34;service\u0026#34; ], \u0026#34;users\u0026#34;: { \u0026#34;admin\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;admin\u0026#34;: [ \u0026#34;admin\u0026#34; ] } }, \u0026#34;demo\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;demo\u0026#34;, \u0026#34;default_tenant\u0026#34; : \u0026#34;service\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;service\u0026#34;: [ \u0026#34;service\u0026#34; ] } } }, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;keystone\u0026#34; } }, \u0026#34;horizon\u0026#34;: { \u0026#34;theme\u0026#34;: \u0026#34;Rackspace\u0026#34;, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;horizon\u0026#34; }, \u0026#34;endpoint_type\u0026#34; : \u0026#34;publicURL\u0026#34;, \u0026#34;endpoint_scheme\u0026#34; : \u0026#34;http\u0026#34; }, \u0026#34;mysql\u0026#34;: { \u0026#34;root_network_acl\u0026#34;: \u0026#34;%\u0026#34;, \u0026#34;allow_remote_root\u0026#34;: true, \u0026#34;server_root_password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;server_repl_password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;server_debian_password\u0026#34;: \u0026#34;secrete\u0026#34; }, \u0026#34;monitoring\u0026#34;: { \u0026#34;procmon_provider\u0026#34;: \u0026#34;monit\u0026#34;, \u0026#34;metric_provider\u0026#34;: \u0026#34;collectd\u0026#34; }, \u0026#34;glance\u0026#34;: { \u0026#34;images\u0026#34;: [ \u0026#34;precise\u0026#34;, \u0026#34;cirros\u0026#34; ], \u0026#34;image\u0026#34;: { }, \u0026#34;image_upload\u0026#34;: false, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;glance\u0026#34; } }, \u0026#34;neutron\u0026#34;: { \u0026#34;service_pass\u0026#34;: \u0026#34;neutron\u0026#34;, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;neutron\u0026#34; } }, \u0026#34;developer_mode\u0026#34;: false } } environment ãƒ•ã‚¡ã‚¤ãƒ«ã® chef ã‚µãƒ¼ãƒã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€‚\n% knife environment from file environments/havana-neutron.json knife bootstrap ã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ ä¸‹è¨˜ã®é€šã‚Š knife bootstrap ã™ã‚‹ã“ã¨ã§å„ãƒãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\ncontroller ãƒãƒ¼ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€‚\n% knife bootstrap \u0026lt;controller_ipaddr\u0026gt; -N \u0026lt;controller_name\u0026gt; \\ -r \u0026#39;role[single-controller]\u0026#39;,\u0026#39;role[cinder-volume]\u0026#39; \\ -E havana-neutron -x \u0026lt;username\u0026gt; --sudo network ãƒãƒ¼ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€‚å°æ•°åˆ†ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„ã€‚\n% knife bootstrap \u0026lt;network_ipaddr\u0026gt; -N \u0026lt;network_name\u0026gt; \\ -r \u0026#39;role[single-network-node]\u0026#39;,\u0026#39;recipe[nova-network::neutron-l3-agent]\u0026#39; \\ -E neutron-havana -x \u0026lt;username\u0026gt; --sudo compute ãƒãƒ¼ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€‚å°æ•°åˆ†ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„ã€‚\n% knife bootstrap \u0026lt;compute_ipaddr\u0026gt; -N \u0026lt;compute_name\u0026gt; \\ -r \u0026#39;role[single-compute]\u0026#39; \\ -E havana-neutron -x \u0026lt;username\u0026gt; --sudo openvswitch ã®ç‰©ç† NIC ã¨ãƒ–ãƒªãƒƒã‚¸ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°ä½œæ¥­ å„ãƒãƒ¼ãƒ‰ã§ä¸‹è¨˜ã®é€šã‚Šç‰©ç† NIC ã¨ãƒ–ãƒªãƒƒã‚¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°ä½œæ¥­ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚æ“ä½œ ã¯å¿…ãš management ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä»‹ã—ã¦è¡Œã†ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚ãã®ä»–ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ ã‚¯ã‹ã‚‰æ“ä½œã™ã‚‹ã¨é€šä¿¡ãŒé€”çµ¶ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\nnetwork ãƒãƒ¼ãƒ‰\n% sudo ovs-vsctl add-port br-eth1 eth1 % sudo ovs-vsctl add-port br-ex eth3 compute ãƒãƒ¼ãƒ‰\n% sudo ovs-vsctl add-port br-eth1 eth1 ã¾ã¨ã‚ã¨è€ƒå¯Ÿ havana ã® roles ã«ã¯ã‚³ã‚¢ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå…¥ã£ã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Š ceilometer ã¨ heat ã‚‚ä¸Šè¨˜ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã§å…¥ã£ã¦ãã¾ã™ã€‚ceilometer ã«é–¢ã—ã¦å…¬å¼ã®ãƒ‰ ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ãƒ‡ãƒ¼ã‚¿æ ¼ç´ç”¨ DB ã¨ã—ã¦ mongodb ãŒè¨˜ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã“ã§ã¯ mysqld ä¸Šã«æ ¼ç´ã™ã‚‹æ§‹æˆã«ãªã£ã¦ã„ã¾ã—ãŸã€‚ã“ã‚Œã¯å€‹äººçš„ã«ã¯éå¸¸ã«åŠ©ã‹ã‚Šã¾ã™ã€‚ ã¾ãŸã€compute ãƒãƒ¼ãƒ‰ã‹ã‚‰ controller ãƒãƒ¼ãƒ‰ã® public api ã‚’å©ãå¿…è¦ãŒå‡ºã¦ãã¦ã€ compute ãƒãƒ¼ãƒ‰ã«ã‚‚ public ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç”¨ã® NIC ã‚’è¶³ã—ã¾ã—ãŸãŒã€ã“ã†ã™ã‚‹ã¹ããª ã®ã‹ã©ã†ã‹ã¯ä»Šå¾Œè€ƒãˆã¦ã¿ã¾ã™ã€‚ç†æƒ³ã¯ management ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä»‹ã™ã‚‹ã“ã¨ã§ã™ãŒ attributes ã®èª¿æ•´ã§ã‘ã§ã¯ã†ã¾ãã„ãã¾ã›ã‚“ã§ã—ãŸã€‚\u0026lsquo;havana\u0026rsquo; ãƒ–ãƒ©ãƒ³ãƒã¯ã¾ã é–‹ç™ºãŒ é€²ã‚“ã§ã„ã‚‹ã®ã§æ”¹å–„ã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã™ã‚‹ã®ã‚‚æ‰‹ã ã¨æ€ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/11/17/openstack-havana-chef-deploy/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæ¯åº¦ãŠé¦´æŸ“ã¿ã«ãªã£ãŸ OpenStack ã® Chef ã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ã§ã™ãŒã€ä»Šå›ã¯ OpenStack\nHavana æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã§ã™ã€‚ä½¿ç”¨ã™ã‚‹ã®ã¯ä»Šå›ã‚‚\nrcbops/chef-cookbooks ã§ã™ã€‚ãƒ–ãƒ©ãƒ³ãƒã¯ \u0026lsquo;havana\u0026rsquo; ã‚’ç”¨ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæ—©é€Ÿã§ã™ãŒæ§‹æˆã«ã¤ã„ã¦ã€‚4.1.2 è¾ºã‚Šã‹ã‚‰ã ã¨æ€ã†ã®ã§ã™ãŒæ§‹æˆã®å‰æãŒç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼\nã‚¯4ã¤ã‚’å‰æã«ã—å§‹ã‚ã¾ã—ãŸã€‚public, external (VM) ã‚’åˆ¥ã‘ã‚‹å¿…è¦ãŒå‡ºã¦ãã¾ã—ãŸã€‚\né€šä¿¡ã®ç‰¹æ€§ã‚‚ç•°ãªã‚‹ã®ã§ (public ã¯ public API ã‚’ã€‚external ã¯ VM ç”¨) ã€åˆ¥ã‘ã‚‹ã®\nãŒå¾—ç­–ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h2\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e                  +--------------+------------------------------------------------------- external\n                  |              |\n+--------------+--(-----------+--(-----------+--------------+---------------------------- public\n|              |  |           |  |           |              |\n+------------+ +------------+ +------------+ +------------+ +------------+ +------------+\n| controller | |  network   | |  network   | |  compute   | |  compute   | | workstation|\n+------------+ +------------+ +------------+ +------------+ +------------+ +------------+\n|              |  |           |  |           |  |           |  |           |\n+--------------+--(-----------+--(-----------+--(-----------+--(-----------+------------- management\n                  |              |              |              |\n                  +--------------+--------------+--------------+------------------------- guest\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 id=\"ä¸Šè¨˜ã®æ§‹æˆã®ç‰¹å¾´\"\u003eä¸Šè¨˜ã®æ§‹æˆã®ç‰¹å¾´\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e4ã¤ã®ç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å‰æ\u003c/li\u003e\n\u003cli\u003epublic ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ : å¤–éƒ¨ API ç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u003c/li\u003e\n\u003cli\u003eexternal ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ : ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤–éƒ¨æ¥ç¶šç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u003c/li\u003e\n\u003cli\u003eguest ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ : ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†…éƒ¨ç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u003c/li\u003e\n\u003cli\u003emanagement ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ : å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ¥ç¶šç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u003c/li\u003e\n\u003cli\u003epublic, external ã®ã¿ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u003c/li\u003e\n\u003cli\u003econtroller : 2 nics, network : 4 nics, compute : 3nics ã®æ§‹æˆ\u003c/li\u003e\n\u003cli\u003econtroller ã¯ã‚·ãƒ³ã‚°ãƒ«æ§‹æˆ\u003c/li\u003e\n\u003cli\u003enetwork ãƒãƒ¼ãƒ‰ã¯å°æ•°æ‹¡å¼µå¯èƒ½, agent å˜ä½ã§ãƒãƒ¼ãƒ‰é–“ç§»å‹•å¯èƒ½\u003c/li\u003e\n\u003cli\u003ecompute ãƒãƒ¼ãƒ‰ã‚‚å°æ•°æ‹¡å¼µå¯èƒ½\u003c/li\u003e\n\u003cli\u003eworkstation ã¯ chef-repo ã®æ‰€åœ¨åœ°, management ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ‰€å±\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å„ãƒãƒ¼ãƒ‰ã®æº–å‚™\"\u003eå„ãƒãƒ¼ãƒ‰ã®æº–å‚™\u003c/h2\u003e\n\u003cp\u003eOS ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€å„ãƒãƒ¼ãƒ‰ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®è¨­å®šã‚’ä¸‹è¨˜ã®é€šã‚Šè¡Œã£\nã¦ãã ã•ã„ã€‚ã¾ãŸ LVM ã‚’ä½¿ã†ã®ã§ã‚ã‚Œã° cinder ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®è¨­å®šã‚‚å¿…è¦ã«ãªã£ã¦ãã¾ã™ã€‚\u003c/p\u003e","title":"OpenStack Havana ã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nç¬¬2å› Elasticsearch å‹‰å¼·ä¼šã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚ç®‡æ¡æ›¸ãã§ã™ãŒå‚åŠ ãƒ¬ãƒãƒ¼ãƒˆã‚’è¨˜ã— ã¦ãŠãã¾ã™ã€‚\né–‹å‚¬æ—¥ : 2013/11/12 å ´æ‰€ : æ±äº¬é§… ã‚°ãƒ©ãƒ³ãƒˆã‚¦ã‚­ãƒ§ã‚¦ã‚µã‚¦ã‚¹ã‚¿ãƒ¯ãƒ¼ ãƒªã‚¯ãƒ«ãƒ¼ãƒˆãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã‚ºã•ã¾ URL : http://elasticsearch.doorkeeper.jp/events/6532 Routing å‘¨ã‚Šã®è©± æ ªå¼ä¼šç¤¾ã‚·ãƒ¼ãƒãƒ¼ã‚¯ã€€å¤§è°·ç´”ã•ã‚“ (@johtani) Index æ§‹æˆ cluster ã®ä¸­ã« index -\u0026gt; type ãŒä½œæˆã•ã‚Œã‚‹ index ã¯ shard ã¨ã„ã†éƒ¨åˆ†çš„ãª index ã®é›†ã¾ã‚Š shard æ•°ã¯ç”Ÿæˆæ™‚ã®ã¿æŒ‡å®šå¯èƒ½ node ã”ã¨ã« replica, primary ã‚’åˆ¥ã‘ã‚‹ replica æ•°ã¯å¾Œã«å¤‰ãˆã‚‰ã‚Œã‚‹ doc -\u0026gt; hash å€¤ã‚’ shard æ•°ã§å‰²ã£ã¦ replica, primary ã«ç™»éŒ² doc ã® id ã® ãƒãƒƒã‚·ãƒ¥å€¤ã‚’åˆ©ç”¨ type ã‚‚å«ã‚ã‚‹å ´åˆã¯ã‹ã®è¨­å®šã‚’ true ã« ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã©ã®ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦ã‚¯ã‚¨ãƒªã‚’æŠ•ã’ã¦ã‚‚ OK routing id ã®ä»£ã‚ã‚Šã« routing (URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿) ã§ç™»éŒ² url ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ç™»éŒ²æ™‚ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç™»éŒ² id ã®ä»£ã‚ã‚Šã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æŒ‡å®šã•ã‚ŒãŸå€¤ã®ãƒãƒƒã‚·ãƒ¥å€¤ã‚’è¨ˆç®—ã—ã¦åˆ©ç”¨ æ¤œç´¢æ™‚ routing æŒ‡å®šã§é–¢ä¿‚ã®ã‚ã‚‹ shard ã®ã¿ã‚’æŒ‡å®šå‡ºæ¥ã‚‹ ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ sharding ã«ã‚ˆã‚‹ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆæ•° = ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆæ™‚ã«æŒ‡å®š shard ã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®åˆ†å‰²ä»¥å¤–ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è‡ªä½“ã‚’è¤‡æ•°æŒã¤ã“ã¨ã«ã‚ˆã‚‹ã‚¹ã‚±ãƒ¼ãƒ« è¤‡æ•°ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚¨ã‚¤ãƒªã‚¢ã‚¹æ›¸ã‘ã‚‹ã“ã¨ãŒå¯èƒ½ æ‰€æ„Ÿ å€‹äººçš„ã«ã¯éå¸¸ã«èˆˆå‘³ã®ã‚ã‚‹ã¨ã“ã‚ã§ã—ãŸã€‚mongodb ã®ã‚ˆã†ãª sharding ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã— ã¦ã‚ˆã„ã®ã‹ï¼Ÿãã†ã§ãªã„ã®ã‹ï¼Ÿã™ã‚‰ç†è§£å‡ºæ¥ã¦ã„ãªã‹ã£ãŸã®ã§ã€‚sharding ã‚’ç†è§£ã™ã‚‹ å‰æçŸ¥è­˜ã®è©±ã‚‚ã‚ã£ã¦éå¸¸ã«å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚\nElasticSearchã‚’ä½¿ã£ãŸBaaSåŸºç›¤ã®é–‹ç™º æ ªå¼ä¼šç¤¾å¯Œå£«é€šã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã‚º æ»ç”°è–å·±ã•ã‚“ï¼ˆ@pisatoshiï¼‰ é‹ç”¨ã®è©±ã€‚ã“ã‚Œã¯è²´é‡\u0026hellip;ã€‚\nshard æ•° : 10 , replica : 1 ã§é‹ç”¨ã—ã¦ã„ã‚‹ ãƒ‡ãƒ¼ã‚¿ã¯æ¥­å‹™ãƒ‡ãƒ¼ã‚¿ , ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆ, æ›´æ–°ã®å³æ™‚åæ˜ , ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã‚ˆã‚‹æ€§èƒ½å‘ä¸Š ãŒè¦ä»¶ ç™»éŒ²æ›´æ–° -\u0026gt; æ¤œç´¢çµæœåæ˜ ã¾ã§ã‚¿ã‚¤ãƒ ãƒ©ã‚°ãŒã‚ã‚‹ -\u0026gt; replica å®Œäº†ã¾ã§å¾…ã¤ã®ã§é«˜ã‚³ã‚¹ãƒˆ replica æ•°ã‚’æ¸›ã‚‰ã™ã“ã¨ã§æ€§èƒ½å‘ä¸Š routing id ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§\u0026hellip; doc id ã® has ã‹ã‚‰ shard è‡ªå‹•é¸æŠãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ -\u0026gt; hash key ã‚’æŒ‡å®šã—ã¦æ ¼ç´ã‚·ãƒ£ãƒ¼ãƒ‰ã‚’åˆ¶å¾¡å‡ºæ¥ã‚‹ -\u0026gt; doc ç™»éŒ²æ€§èƒ½å‘ä¸Š -\u0026gt; æ¤œç´¢å¯¾è±¡ã® shard ã‚’çµã‚Šã“ã¿ãˆã‚‹ -\u0026gt; ä¸å¯ã‚’è»½æ¸› ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—/ãƒªã‚¹ãƒˆã‚¢ mysql ã«ã‚‚ãƒ‡ãƒ¼ã‚¿æ ¼ç´ -\u0026gt; backup elasticsearch ã® index ã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å–ã‚‰ãš -\u0026gt; bug ã‚’è¸ã¿ãŸããªã„ã®ãŒç†ç”± dynamic mapping ã®å•é¡Œ å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‹ã‚’æ¨æ¸¬ -\u0026gt; è‡ªå‹•ãƒãƒƒãƒ”ãƒ³ã‚°ç™»éŒ² -\u0026gt; ãƒãƒƒãƒ”ãƒ³ã‚°å®šç¾©ãŒè‚¥å¤§åŒ– -\u0026gt; ãƒ‡ãƒ¼ã‚¿å‹ã®ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆ mapping ã®è‚¥å¤§åŒ– mapping å®šç¾©ã¯ type, field ã®æ•°ã«å¿œã˜ã¦ã‚µã‚¤ã‚ºãŒå¢—åŠ  -\u0026gt; index æ€§èƒ½ä½ä¸‹ -\u0026gt; mapping ã‚’ä¼´ã† doc ç™»éŒ² 3sec (mapping size 80MB) -\u0026gt; å„ node ã¸ã® mapping å®šç¾©ã®åŒæœŸ å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ°—ã«ç™»éŒ²ã™ã‚‹ã¨ãã¯ 1 node ãŒé€Ÿã„ -\u0026gt; ãã®å¾Œã‚·ãƒ£ãƒ¼ãƒ‰å†é…ç½®ã—ãŸã“ã¨ãŒã‚ã‚‹ =\u0026gt; dynamic mapping ã‚’ä½¿ã†ã®ã‚’ã‚„ã‚ãŸ -\u0026gt; app ã§æŒ‡å®š\nã‚ˆãåˆ©ç”¨ã™ã‚‹ãƒ„ãƒ¼ãƒ« bigdesk elasticsearch-head sense (chrome extention) unit test unit test ã¯ã©ã†ã™ã‚‹ï¼Ÿ\nnodeClient ãƒ†ã‚¹ãƒˆé–‹å§‹æ™‚ã«èµ·å‹• ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’é…ç½®ã—ã¦èµ·å‹•, çµ‚äº†æ™‚ã«å‰Šé™¤ memoryIndex ã§é«˜é€Ÿã«å®Ÿè¡Œ elasticsearch-test ãŒä¾¿åˆ© æ‰€æ„Ÿ é‹ç”¨ã®è©±ã¯ã©ã®æŠ€è¡“ã§ã‚‚é‡è¦!!! å®Ÿéš›ã«å›°ã£ãŸè©±ã€ãƒˆãƒ©ãƒ–ãƒ«ç­‰èã‘ã¦è²´é‡ãªæ™‚é–“ã§ã—ãŸã€‚ ã‚ˆãä½¿ã†ãƒ„ãƒ¼ãƒ«ã®è©±ã‚‚æ„å¤–ã¨å‚è€ƒã«ãªã‚‹ã®ã§èã‘ã¦ã‚ˆã‹ã£ãŸã€‚\nKibana Cookpad æ°´æˆ¸ç¥ä»‹ã•ã‚“ (@y_310) ä½œã£ãŸ dashboard ã¯ elasticsearch ã«ä¿å­˜ã•ã‚Œã‚‹ db è¦ã‚‰ãš , web ã‚µãƒ¼ãƒã®ã¿, ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®æŠ€è¡“ã®ã¿ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ term, trends, map, table, column\u0026hellip; ãã‚Œãã‚Œå›³å½¢å¼ãŒã‚ã‚‹ title = \u0026ldquo;test\u0026rdquo;, -title 1ã¤ã® index ã«ç•°ãªã‚‹ã‚¹ã‚­ãƒ¼ãƒã‚’æŒã¤ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‰ã‚Œã‚‹ 1ã¤ã® index ã«å…¥ã‚Œã‚‹ã“ã¨ã§ã‚°ãƒ©ãƒ•ã‚’é‡ã­ã¦æ¯”è¼ƒå‡ºæ¥ã‚‹ ã‚„ã¯ã‚Š dynamic mapping ã¯ä½¿ã‚ãªã„ã»ã†ãŒè‰¯ã„ m1.large x 1 : 1æ—¥ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚ºãŒ10GB è¶…ãˆã‚‹ã‚ãŸã‚Šã§ ES ãŒè©°ã¾ã‚‹ ä¸‹è¨˜ãŒå½“æ—¥ã®è³‡æ–™ã§ã™ã€‚\næ‰€æ„Ÿ Cookpad ã•ã‚“ã§å®Ÿéš›ã«åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã¨ã‹ã€‚é‹ç”¨ã®è©±ã¨åŒã˜ãã‚„ã¯ã‚Š dynamic routing ã§ã®ãƒˆãƒ©ãƒ–ãƒ«ã®è©±ãŒã‚ã£ãŸã€‚ã¾ãŸ Cookpad ã•ã‚“ã§ã®ãƒˆãƒ©ãƒ–ãƒ«ä¾‹ã®è©±ã‚‚ã‚ã£ã¦ã‚ˆã‹ã£ãŸã€‚\nElasticSearchï¼‹Kibana v3ã‚’åˆ©ç”¨ã™ã‚‹éš›ã®é‹ç”¨ãƒã‚¦ãƒã‚¦ æ ªå¼ä¼šç¤¾ãƒªãƒ–ã‚»ãƒ³ã‚¹ Y.Kentaro ã•ã‚“ (@yoshi_ken) ä¸‹è¨˜ãŒç™ºè¡¨è³‡æ–™ã€‚\nElasticSearch+Kibanaã§ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ã®æ¤œç´¢ã¨è¦–è¦šåŒ–ã‚’å®Ÿ ç¾ã™ã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¨é‹ç”¨ãƒã‚¦ãƒã‚¦ from Kentaro Yoshida nginx ã® basic èªè¨¼ç­‰ã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ã‚’æ›ã‘ã‚‹ä¾‹ ç­‰ãªã©\u0026hellip; ã”ã‚ã‚“ãªã•ã„ï¼ãƒ¡ãƒ¢ãŒå–ã‚Œã¦ãªã‹ã£ãŸï¼\u0026hellip;æ±—\nFluentd as a Kibana @repeatedly ã•ã‚“ fluentd-plugin-kibana-server ã¨ã„ã†kibana ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã‚‹ã®ãŒã‚ã‚“ã©ã„ ã®ã§ fluentd ã®ä¸­ã§ kibana ã‚’å‹•ã‹ã™ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œã£ãŸè©±ã€‚ä¸‹è¨˜ãŒç™ºè¡¨è³‡æ–™ã€‚\nhttps://gist.github.com/repeatedly/7427856\nfluentd input plugin ã¨ã—ã¦å®Ÿè£… logstash ç‰ˆã‚‚ã‚ã‚‹ã‚‰ã—ã„ æ‰€æ„Ÿ ã•ã™ãŒ\u0026hellip;ã€‚ç¢ºã‹ã«ã‚µãƒ¼ãƒã‚’ã„ã¡ã„ã¡ä½œã‚‹ã®ã‚ã‚“ã©ã„ã§ã™ã€‚fluentd plugin ã®ä¸­ã§ kibana ã‚’å‹•ã‹ã™ã£ã¦ç™ºæƒ³ãŒ\u0026hellip;ã€‚\nauth ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« æ ªå¼ä¼šç¤¾ã‚¨ãƒŒãƒ„ãƒ¼ã‚¨ã‚¹ã‚¨ãƒ  è…è°·ä¿¡ä»‹ã•ã‚“ (@shinsuke_sugaya) elasticsearch ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’ã—ãŸã„ rest api ã‚’ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã™ã‚‹ ãƒ¦ãƒ¼ã‚¶ç®¡ç†, REST API ã®ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†, ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ»ãƒˆãƒ¼ã‚±ãƒ³ ãƒ¦ãƒ¼ã‚¶ç®¡ç†ã¯ elasticsearch å†…ã«æ ¼ç´ path, http method, role ã®çµ„ã¿åˆã‚ã›ã§åˆ¶å¾¡ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ä¸‹è¨˜ã®é€šã‚Š elasticsearch plugin ã‚³ãƒãƒ³ãƒ‰ã§ã€‚\n% ./bin/plugin --install org.codelibs/elasticsearch-auth/1.0.0 ãƒ¦ãƒ¼ã‚¶ä½œæˆã¯ POST ã§å¯èƒ½ æ‰€æ„Ÿã¨ã¾ã¨ã‚ ç®‡æ¡æ›¸ãã®ã–ã£ãã‚Šã—ãŸã¾ã¨ã‚ã§ã—ãŸãŒ\u0026hellip;ã€‚å€‹äººçš„ã«ã¯ sharding ã®è©±ã¯ã¨ã¦ã‚‚èã ãŸã‹ã£ãŸã®ã§è²´é‡ãªæ™‚é–“ã§ã—ãŸã€‚ã¾ãŸã€é‹ç”¨ã®è©±ã‚‚ã¨ã¦ã‚‚ãŠã‚‚ã—ã‚ã‹ã£ãŸã— plugin ä½œã£ ã¦ã¿ãŸè©±ã‚‚ã€Œã™ã”ã„..ã€ã£ã¦æ„Ÿã˜ã§ã—ãŸã€‚åƒ•ã¯ã“ã‚Œã‹ã‚‰ã‚¢ãƒ—ãƒªã‚‚æ›¸ãã‘ã©ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ ã‚¸ãƒ‹ã‚¢ãªã®ã§ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ã¾ãšçŸ¥ã‚ŠãŸã„ã‹ãªãã¨ã„ã†å°è±¡ã€‚ã¨è¨€ã†ã‹ã‚¹ã‚±ãƒ¼ãƒ«ã•ã› ã‚‹ã¨ãã«ã‚‚æ¨ªã«ä¸¦ã¹ã¦ shard ã™ã‚‹ã ã‘ã®æ§˜ãªè©±ã«èã“ãˆã¾ã—ãŸãŒã€ã¾ã ã¼ã‚“ã‚„ã‚Šæ„ŸãŒ ã‚ã‚Šã¾ã™ã€‚ç‰¹ã« shard å‘¨ã‚Šã€‚mongo ã® sharding ã¨åŒã˜æ§˜ãªã‚‚ã®ã‚’æƒ³åƒã—ã¦ã„ã¾ã™ãŒã€‚ ã¾ãŸãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ä¸ŠãŒã£ãŸã®ã§é€±æœ«ã‚„ã£ã¦ã¿ã¾ã™ãƒ¼ï¼\nkibana3 ã¯ä¸€å›ä½¿ã„ã¾ã—ãŸã€‚javascript, html ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã®ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ ã‚‰ elasticsearch ã¾ã§ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ãªã‘ã‚Œã°ãªã‚‰ãªã„ã¨ãªã£ã¦ã€æ§‹æˆçš„ã«ã©ã†ãª ã®ã‹ãªï¼Ÿã¨æ€ã£ã¦ã„ãŸã‚‰è…è°·ã•ã‚“ã® \u0026lsquo;auth ãƒ—ãƒ©ã‚°ã‚¤ãƒ³\u0026rsquo; ã®è©±ãŒã‚ã£ãŸã‚Šã—ãŸã®ã§ã€è‰¯ ã‹ã£ãŸã§ã™ã€‚ä½¿ã£ã¦ã¿ã¾ã™ï¼\nä¸»å‚¬ã®æ–¹ã€…ã€ç™ºè¡¨è€…ã®æ–¹ã€…ã€å½“æ—¥ã¯ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸãƒ¼ã€‚ã¾ãŸå‚åŠ ã•ã›ã¦ã‚‚ã‚‰ã„ ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/11/13/elasticsearch-second-study-report/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eç¬¬2å› Elasticsearch å‹‰å¼·ä¼šã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚ç®‡æ¡æ›¸ãã§ã™ãŒå‚åŠ ãƒ¬ãƒãƒ¼ãƒˆã‚’è¨˜ã—\nã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eé–‹å‚¬æ—¥ : 2013/11/12\nå ´æ‰€ : æ±äº¬é§… ã‚°ãƒ©ãƒ³ãƒˆã‚¦ã‚­ãƒ§ã‚¦ã‚µã‚¦ã‚¹ã‚¿ãƒ¯ãƒ¼ ãƒªã‚¯ãƒ«ãƒ¼ãƒˆãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã‚ºã•ã¾\nURL : http://elasticsearch.doorkeeper.jp/events/6532\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"routing-å‘¨ã‚Šã®è©±\"\u003eRouting å‘¨ã‚Šã®è©±\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003eæ ªå¼ä¼šç¤¾ã‚·ãƒ¼ãƒãƒ¼ã‚¯ã€€å¤§è°·ç´”ã•ã‚“ (@johtani)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"index-æ§‹æˆ\"\u003eIndex æ§‹æˆ\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003ecluster ã®ä¸­ã« index -\u0026gt; type ãŒä½œæˆã•ã‚Œã‚‹\u003c/li\u003e\n\u003cli\u003eindex ã¯ shard ã¨ã„ã†éƒ¨åˆ†çš„ãª index ã®é›†ã¾ã‚Š\u003c/li\u003e\n\u003cli\u003eshard æ•°ã¯ç”Ÿæˆæ™‚ã®ã¿æŒ‡å®šå¯èƒ½\u003c/li\u003e\n\u003cli\u003enode ã”ã¨ã« replica, primary ã‚’åˆ¥ã‘ã‚‹\u003c/li\u003e\n\u003cli\u003ereplica æ•°ã¯å¾Œã«å¤‰ãˆã‚‰ã‚Œã‚‹\u003c/li\u003e\n\u003cli\u003edoc -\u0026gt; hash å€¤ã‚’ shard æ•°ã§å‰²ã£ã¦ replica, primary ã«ç™»éŒ²\u003c/li\u003e\n\u003cli\u003edoc ã® id ã® ãƒãƒƒã‚·ãƒ¥å€¤ã‚’åˆ©ç”¨\u003c/li\u003e\n\u003cli\u003etype ã‚‚å«ã‚ã‚‹å ´åˆã¯ã‹ã®è¨­å®šã‚’ true ã«\u003c/li\u003e\n\u003cli\u003eã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã©ã®ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦ã‚¯ã‚¨ãƒªã‚’æŠ•ã’ã¦ã‚‚ OK\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"routing\"\u003erouting\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003eid ã®ä»£ã‚ã‚Šã« routing (URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿) ã§ç™»éŒ²\u003c/li\u003e\n\u003cli\u003eurl ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ç™»éŒ²æ™‚ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç™»éŒ²\u003c/li\u003e\n\u003cli\u003eid ã®ä»£ã‚ã‚Šã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æŒ‡å®šã•ã‚ŒãŸå€¤ã®ãƒãƒƒã‚·ãƒ¥å€¤ã‚’è¨ˆç®—ã—ã¦åˆ©ç”¨\u003c/li\u003e\n\u003cli\u003eæ¤œç´¢æ™‚ routing æŒ‡å®šã§é–¢ä¿‚ã®ã‚ã‚‹ shard ã®ã¿ã‚’æŒ‡å®šå‡ºæ¥ã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ\"\u003eã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003esharding ã«ã‚ˆã‚‹ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆæ•° = ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆæ™‚ã«æŒ‡å®š\u003c/li\u003e\n\u003cli\u003eshard ã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®åˆ†å‰²ä»¥å¤–ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è‡ªä½“ã‚’è¤‡æ•°æŒã¤ã“ã¨ã«ã‚ˆã‚‹ã‚¹ã‚±ãƒ¼ãƒ«\u003c/li\u003e\n\u003cli\u003eè¤‡æ•°ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚¨ã‚¤ãƒªã‚¢ã‚¹æ›¸ã‘ã‚‹ã“ã¨ãŒå¯èƒ½\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"æ‰€æ„Ÿ\"\u003eæ‰€æ„Ÿ\u003c/h4\u003e\n\u003cp\u003eå€‹äººçš„ã«ã¯éå¸¸ã«èˆˆå‘³ã®ã‚ã‚‹ã¨ã“ã‚ã§ã—ãŸã€‚mongodb ã®ã‚ˆã†ãª sharding ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã—\nã¦ã‚ˆã„ã®ã‹ï¼Ÿãã†ã§ãªã„ã®ã‹ï¼Ÿã™ã‚‰ç†è§£å‡ºæ¥ã¦ã„ãªã‹ã£ãŸã®ã§ã€‚sharding ã‚’ç†è§£ã™ã‚‹\nå‰æçŸ¥è­˜ã®è©±ã‚‚ã‚ã£ã¦éå¸¸ã«å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚\u003c/p\u003e","title":"ç¬¬2å› Elasticsearch å‹‰å¼·ä¼šå‚åŠ ãƒ¬ãƒãƒ¼ãƒˆ"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nåƒ•ã¯ Chef ä½¿ã„ãªã®ã§ã™ãŒã€Chef ã¯ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¾ã§è¸ã¿è¾¼ã‚“ã ãƒ„ãƒ¼ãƒ«ã§ã¯ ãªã„ã‚ˆã†ã«æ€ã„ã¾ã™ã€‚ã›ã„ãœã„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‡ºæ¥ã‚‹ç¨‹åº¦ãªã®ã‹ãªãã¨ã€‚ ã—ã‹ã‚‚ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã«ã‚‚ Cookbooks ã®å·¥å¤«ãŒå¿…è¦ã§ã™ã€‚ä»¥å‰èã„ãŸã“ã¨ã® ã‚ã‚‹è©±ã§ã™ãŒ Opscode ç¤¾ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢æ›°ãã€Œã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ã¸ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ ã¯ãã‚Œãã‚Œå¥½ãã«ã‚„ã£ã¦ã­ã€ã ãã†ã§ã™ã€‚\nå€‹äººçš„ã«ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ†ãƒ¼ãƒã«è‰²ã€…èª¿ã¹ã‚ˆã†ã‹ã¨è€ƒãˆã¦ã„ã‚‹ã®ã§ã™ãŒã€ Serf ã¨ã„ã†é¢ç™½ã„ãƒ„ãƒ¼ãƒ«ãŒå‡ºã¦ãã¾ã—ãŸã€‚\u0026lsquo;Serf\u0026rsquo; ã¯ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‰‹åŠ©ã‘ã— ã¦ãã‚Œã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ„ãƒ¼ãƒ«ã«ãªã£ã¦ã„ã¾ã™ã€‚\nã‚‚ã†æ—¢ã«ã„ã‚ã‚“ãªæ–¹ãŒ Serf ã«ã¤ã„ã¦èª¿ã¹ã¦ã„ã¾ã™ãŒã€ã©ã®ã‚ˆã†ãªå‹•ãã‚’ã™ã‚‹ã®ã‹ã‚’è‡ª åˆ†ãªã‚Šã«ç†è§£ã—ãŸç‚¹ã‚’è¨˜ã—ã¦ãŠã“ã†ã¨æ€ã„ã¾ã™ã€‚\nå‚è€ƒã«ã—ãŸã‚µã‚¤ãƒˆ å…¬å¼ã‚µã‚¤ãƒˆ http://www.serfdom.io/ ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰é–‹ç™ºè€…ãƒ–ãƒ­ã‚° http://dev.classmethod.jp/cloud/aws/serf_on_ec2/ Glidenote ã•ã‚“ http://blog.glidenote.com/blog/2013/10/30/serf-haproxy/ Serf ã¨ã¯ Serf ã¯ gossip protocol ã‚’ã‚¯ãƒ©ã‚¹ã‚¿ã«ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã™ã‚‹ã€‚gossip protocol ã¯ SWIM : Scalable Weakly-consistent Infecton-style process Group Membership Protocolâ€ ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦å½¢æˆã•ã‚Œã¦ã„ã‚‹ã€‚\nSWIM Protocol æ¦‚ç•¥ serf ã¯æ–°ã—ã„ã‚¯ãƒ©ã‚¹ã‚¿ã¨ã—ã¦ç¨¼åƒã™ã‚‹ã‹ã€æ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚¿ã« â€˜joinâ€™ ã™ã‚‹å½¢ã§ç¨¼åƒ ã™ã‚‹ã‹ã®ã©ã¡ã‚‰ã‹ã§èµ·å‹•ã™ã‚‹ã€‚\næ–°ã—ã„ãƒ¡ãƒ³ãƒã¯ TCP ã§çŠ¶æ…‹ã‚’ \u0026lsquo;full state sync\u0026rsquo; ã•ã‚Œæ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚¿å†…ã«ã¦ â€˜gossipin (å™‚)ã•ã‚Œã‚‹ã€‚ã“ã® â€™gosipingâ€™ ã¯ UDP ã§é€šä¿¡ã•ã‚Œã“ã‚Œã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä½¿ ç”¨é‡ã¯ãƒãƒ¼ãƒ‰æ•°ã«æ¯”ä¾‹ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚\nãƒ©ãƒ³ãƒ€ãƒ ãªãƒãƒ¼ãƒ‰ã¨ã® \u0026lsquo;full state sync\u0026rsquo; ã¯ TCP ã§è¡Œã‚ã‚Œã‚‹ã‘ã©ã“ã‚Œã¯ â€˜gossipingâ€™ ã«æ¯”ã¹ã¦å°‘ã„\nã‚ã‚‹ä¸€å®šæœŸé–“ã€ã‚ã‚‹ãƒãƒ¼ãƒ‰ãŒ fails çŠ¶æ…‹ã®å ´åˆã€è¿‚å›çµŒè·¯ã‚’ä½¿ã£ã¦ãã®ãƒãƒ¼ãƒ‰ã«å¯¾ã— ã¦ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã€‚ä¸¡æ–¹ã®çµŒè·¯ã«ã¦ fails ãªå ´åˆãƒãƒ¼ãƒ‰ãŒ â€˜suspiciou\u0026rsquo; (å®¹ç–‘è€…) çŠ¶æ…‹ã«ãªã‚‹ã€‚ã‚‚ã—è¿‚å›çµŒè·¯ã®ãƒã‚§ãƒƒã‚¯ãŒ fails ã—ãªã‹ã£ãŸå ´åˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³ã¨ã—ã¦ åˆ¤æ–­ã•ã‚Œã‚‹ã€‚\nSerf ã® SWIM Protocol ã‹ã‚‰ã®æ”¹ä¿®ç‚¹ Serf ã¯ SWIM Protocol ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã‚‹ã¨è¨˜ã—ã¾ã—ãŸãŒã€ã©ã®ã‚ˆã†ãªç‚¹ã‚’æ”¹ä¿®ã—ãŸ ã®ã‹ã¾ã¨ã‚ã¾ã—ãŸã€‚\n\u0026lsquo;full state sync\u0026rsquo; ã® TCP åŒ– serf ã¯ â€˜full state syncâ€™ ã‚’ TCP ã«ã¦è¡Œã†ã€‚ã“ã‚Œã«ã‚ˆã‚Š serf ã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚»ã‚° ãƒ¡ãƒ³ãƒˆãŒåˆ†é›¢ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§ã‚‚é€šä¿¡å‡ºæ¥ã‚‹ã€‚\ngossip ãƒ¬ã‚¤ãƒ¤ã®åˆ†é›¢ serf ã¯ failure detection protocol ã‹ã‚‰å®Œå…¨ã« gossip ãƒ¬ã‚¤ãƒ¤ã‚’åˆ†é›¢ã€‚ã“ã‚Œã§ã‚ˆã‚Š é«˜é€Ÿã«ãƒ‡ãƒ¼ã‚¿å¢—æ®–ãŒè¡Œãˆã‚‹ã€‚\ndead node ã®æ‰±ã„ serf ã¯ ãƒ‡ãƒƒãƒ‰ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦å›æ•°ã‚’è¨˜æ†¶ã—ã¦ã„ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Š full state sync ãŒ å®Ÿæ–½ã•ã‚ŒãŸå ´åˆã€é€†ã«æ­»ã‚“ã ãƒãƒ¼ãƒ‰ã®æƒ…å ±ã‚’å—å–ã‚‹ã€‚SWIM ã§ã¯ full state sync ã‚’è¡Œ ã‚ãªã„ã®ã§æ­»ã‚“ã ãƒãƒ¼ãƒ‰ã«ã‚’å‰Šé™¤ã—ã¦ã—ã¾ã†ã€‚ã“ã‚Œã¯ã‚¯ãƒ©ã‚¹ã‚¿ã«å¯¾ã™ã‚‹æƒ…å ±ä¸€ç‚¹é›†ä¸­åŒ– ã«å½¹ç«‹ã¤ã€‚\nä½¿ã£ã¦ã¿ã‚‹ æ—©é€Ÿä½¿ã£ã¦ã¿ã¾ã™ã€‚ä¸‹è¨˜ã® URL ã«ã‚ã‚‹ demo ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å°‘ã—æ”¹ä¿®ã—ã¦ä½¿ã£ã¦ã¿ã¾ ã—ãŸã€‚\nhttps://github.com/hashicorp/serf/tree/master/demo/web-load-balancer\n2ã¤ãƒãƒ¼ãƒ‰ã‚’ç«‹ã¡ä¸Šã’ã‚‹ AWS ã§ã‚‚ OpenStack ã§ã‚‚ãƒ™ã‚¢ãƒ¡ã‚¿ãƒ«ã§ã‚‚ä½•ã§ã‚‚è‰¯ã„ã®ã§ãƒãƒ¼ãƒ‰ã‚’2å°ç”¨æ„ã™ã‚‹ã€‚\nä¸‹è¨˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç½®ã„ã¦ä¸¡ãƒãƒ¼ãƒ‰ã§å®Ÿè¡Œã™ã‚‹ã€‚ #!/bin/sh set -e export SERF_ROLE=role01 sudo apt-get install -y unzip # Download and install Serf cd /tmp until wget -O serf.zip https://dl.bintray.com/mitchellh/serf/0.2.1_linux_amd64.zip; do sleep 1 done unzip serf.zip sudo mv serf /usr/local/bin/serf # The member join script is invoked when a member joins the Serf cluster. # Our join script simply adds the node to the load balancer. cat \u0026lt;\u0026lt;EOF \u0026gt;/tmp/join.sh #!/bin/sh echo \u0026#39;member joined\u0026#39; \u0026gt;\u0026gt; /tmp/serf_join.log EOF sudo mv /tmp/join.sh /usr/local/bin/serf_member_join.sh chmod +x /usr/local/bin/serf_member_join.sh # Configure the agent cat \u0026lt;\u0026lt;EOF \u0026gt;/tmp/agent.conf description \u0026#34;Serf agent\u0026#34; start on runlevel [2345] stop on runlevel [!2345] exec /usr/local/bin/serf agent \\\\ -event-handler \u0026#34;member-join=/usr/local/bin/serf_member_join.sh\u0026#34; \\\\ -role=${SERF_ROLE} \u0026gt;\u0026gt;/var/log/serf.log 2\u0026gt;\u0026amp;1 EOF sudo mv /tmp/agent.conf /etc/init/serf.conf # Start the agent! sudo start serf å®Ÿè¡Œã™ã‚‹ã¨ \u0026lsquo;role01\u0026rsquo; ã¨ã„ã† Role åã§ serf agent ãŒç¨¼åƒã—ã¦ã„ã‚‹ã¯ãšã€‚ã¾ãŸã‚¹ã‚¯ãƒª ãƒ—ãƒˆã‚’è¦‹ã¦ã‚ã‹ã‚‹ã¨æ€ã†ãŒ \u0026ndash;event-handler \u0026ldquo;member-join=\u0026lt;ã‚¹ã‚¯ãƒªãƒ—ãƒˆ\u0026gt;\u0026rdquo; ã¨ã—ã¦ã„ã‚‹ã€‚ ã“ã‚Œã§ã‚¯ãƒ©ã‚¹ã‚¿ã«æ–°ã—ã„ãƒ¡ãƒ³ãƒãŒ join ã™ã‚‹ã¨ /tmp/serf_join.log ã« \u0026lsquo;member joined\u0026rsquo; ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã¯ãšã ã€‚å®Ÿéš›ã«å®Ÿè¡Œã—ã¦ã¿ã‚‹ã€‚\n% sudo serf join \u0026lt;ã‚‚ã†ç‰‡ç³»ãƒãƒ¼ãƒ‰ã® IP\u0026gt; % sudo serf members vm01 10.0.2.1 alive role01 vm02 10.0.2.3 alive role01 % tail /tmp/serf_join.log â€˜member joined â€˜member joined ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã«ã¯ãƒ¦ãƒ¼ã‚¶æŒ‡å®šã®ã‚‚ã®ã‚‚æ‰±ãˆã‚‹ã€‚\nuser:deploy=foo.sh ã“ã®å ´åˆã®ãƒãƒ³ãƒ‰ãƒ©ã¯ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ç™ºç”Ÿå‡ºæ¥ã‚‹ã€‚\n% serf event deploy ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ« ä»Šå›ã¯ init èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ç™ºç”Ÿæ™‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆæŒ‡å®šç­‰ã‚’è¡Œã£ãŸ ãŒã€json å½¢å¼ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦è¨˜è¿°ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã€‚\n{ \u0026#34;role\u0026#34;: \u0026#34;load-balancer\u0026#34;, \u0026#34;event_handlers\u0026#34;: [ \u0026#34;member_join.sh\u0026#34;, \u0026#34;user:deploy=foo.sh\u0026#34; ] } ä¸Šè¨˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ serf.conf ã¨ã—ãŸå ´åˆã€ã“ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ã®æŒ‡å®šã¯ \u0026ndash;config-file=serf.conf ã§è¡Œãˆã‚‹ã€‚\nãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ— æœ€å¾Œã« Serf ã®ä»Šå¾Œã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã«ã¤ã„ã¦è¨˜ã—ã¦ã‚ã£ãŸã®ã§ã€ã¾ã¨ã‚ã¦ã¿ãŸã€‚\nã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ« ã‚ˆã‚Šã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰±ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚\nSIGHUP SIGHUP ä¿¡å·ã§ãƒªãƒ­ãƒ¼ãƒ‰å‡ºæ¥ãªã„ã®ã§ã€ã“ã‚Œã«å¯¾å¿œã™ã‚‹ã€‚\nã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ©ã‚¤ãƒ–ãƒ©ãƒª ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è‡ªä½œãƒ»ã‚·ã‚§ã‚¢ã‚’å®¹æ˜“ã«è¡Œãˆã‚‹ã‚ˆã†ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åŒ–ã‚’é€²ã‚ã‚‹ã€‚\nã¾ã¨ã‚ã¨è€ƒå¯Ÿ å†’é ­ã«ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦è§¦ã‚Œã¾ã—ãŸãŒã€ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã ã‘ã§ã¯è‡ªåˆ†ã® è€ƒãˆã¦ã„ã‚‹ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯ãªã‚‰ãªã„ã¨æ€ã„ã¾ã—ãŸã€‚å½“ãŸã‚Šå‰ã§ã™ã­ã€‚ã€‚è¤‡æ•° ãƒãƒ¼ãƒ‰ã‚’æŸã­ã¦æ§‹æˆã‚’å½¢æˆã™ã‚‹ã€ã¾ãŸãã‚Œã‚’ãƒˆãƒªã‚¬ã™ã‚‹ã®ãŒäººé–“ã§ã‚ã‚Œã°ãã‚Œã¯ã‚¤ãƒ³ãƒ† ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¯„å›²ã‹ãªãã¨ã€‚ãã®å…ˆã«ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹ã¨ã™ã‚Œã°ãƒˆãƒªã‚¬è‡ª èº«ã‚‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ãã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’äººé–“ãŒæ›¸ãå¿…è¦ãŒã‚ã‚‹ã® ã‹ãªãã¨ã€‚ã‚‚ã¡ã‚ã‚“ãã®ãŸã‚ã«ã“ã®Serf ã¯è²´é‡ãªãƒ‘ãƒ¼ãƒ„ã¨ãªã£ã¦ãã‚Œãã†ã€‚\nã‚ã¨ã€ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã«ã‚‚è¨˜ã—ã¾ã—ãŸãŒé–‹ç™ºãŒç››ã‚“ã«ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ä»Šå¾ŒãŒæ¥½ã—ã¿ ã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/11/10/serf/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eåƒ•ã¯ Chef ä½¿ã„ãªã®ã§ã™ãŒã€Chef ã¯ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¾ã§è¸ã¿è¾¼ã‚“ã ãƒ„ãƒ¼ãƒ«ã§ã¯\nãªã„ã‚ˆã†ã«æ€ã„ã¾ã™ã€‚ã›ã„ãœã„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‡ºæ¥ã‚‹ç¨‹åº¦ãªã®ã‹ãªãã¨ã€‚\nã—ã‹ã‚‚ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã«ã‚‚ Cookbooks ã®å·¥å¤«ãŒå¿…è¦ã§ã™ã€‚ä»¥å‰èã„ãŸã“ã¨ã®\nã‚ã‚‹è©±ã§ã™ãŒ Opscode ç¤¾ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢æ›°ãã€Œã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ã¸ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ\nã¯ãã‚Œãã‚Œå¥½ãã«ã‚„ã£ã¦ã­ã€ã ãã†ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå€‹äººçš„ã«ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ†ãƒ¼ãƒã«è‰²ã€…èª¿ã¹ã‚ˆã†ã‹ã¨è€ƒãˆã¦ã„ã‚‹ã®ã§ã™ãŒã€\nSerf ã¨ã„ã†é¢ç™½ã„ãƒ„ãƒ¼ãƒ«ãŒå‡ºã¦ãã¾ã—ãŸã€‚\u0026lsquo;Serf\u0026rsquo; ã¯ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‰‹åŠ©ã‘ã—\nã¦ãã‚Œã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ„ãƒ¼ãƒ«ã«ãªã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã‚‚ã†æ—¢ã«ã„ã‚ã‚“ãªæ–¹ãŒ Serf ã«ã¤ã„ã¦èª¿ã¹ã¦ã„ã¾ã™ãŒã€ã©ã®ã‚ˆã†ãªå‹•ãã‚’ã™ã‚‹ã®ã‹ã‚’è‡ª\nåˆ†ãªã‚Šã«ç†è§£ã—ãŸç‚¹ã‚’è¨˜ã—ã¦ãŠã“ã†ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒã«ã—ãŸã‚µã‚¤ãƒˆ\"\u003eå‚è€ƒã«ã—ãŸã‚µã‚¤ãƒˆ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eå…¬å¼ã‚µã‚¤ãƒˆ \u003ca href=\"http://www.serfdom.io/\"\u003ehttp://www.serfdom.io/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰é–‹ç™ºè€…ãƒ–ãƒ­ã‚° \u003ca href=\"http://dev.classmethod.jp/cloud/aws/serf_on_ec2/\"\u003ehttp://dev.classmethod.jp/cloud/aws/serf_on_ec2/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eGlidenote ã•ã‚“ \u003ca href=\"http://blog.glidenote.com/blog/2013/10/30/serf-haproxy/\"\u003ehttp://blog.glidenote.com/blog/2013/10/30/serf-haproxy/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"serf-ã¨ã¯\"\u003eSerf ã¨ã¯\u003c/h2\u003e\n\u003cp\u003eSerf ã¯ gossip protocol ã‚’ã‚¯ãƒ©ã‚¹ã‚¿ã«ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã™ã‚‹ã€‚gossip protocol ã¯\nSWIM : Scalable Weakly-consistent Infecton-style process Group Membership\nProtocolâ€ ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦å½¢æˆã•ã‚Œã¦ã„ã‚‹ã€‚\u003c/p\u003e\n\u003ch2 id=\"swim-protocol-æ¦‚ç•¥\"\u003eSWIM Protocol æ¦‚ç•¥\u003c/h2\u003e\n\u003cp\u003eserf ã¯æ–°ã—ã„ã‚¯ãƒ©ã‚¹ã‚¿ã¨ã—ã¦ç¨¼åƒã™ã‚‹ã‹ã€æ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚¿ã« â€˜joinâ€™ ã™ã‚‹å½¢ã§ç¨¼åƒ\nã™ã‚‹ã‹ã®ã©ã¡ã‚‰ã‹ã§èµ·å‹•ã™ã‚‹ã€‚\u003c/p\u003e\n\u003cp\u003eæ–°ã—ã„ãƒ¡ãƒ³ãƒã¯ TCP ã§çŠ¶æ…‹ã‚’ \u0026lsquo;full state sync\u0026rsquo; ã•ã‚Œæ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚¿å†…ã«ã¦\nâ€˜gossipin (å™‚)ã•ã‚Œã‚‹ã€‚ã“ã® â€™gosipingâ€™ ã¯ UDP ã§é€šä¿¡ã•ã‚Œã“ã‚Œã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä½¿\nç”¨é‡ã¯ãƒãƒ¼ãƒ‰æ•°ã«æ¯”ä¾‹ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚\u003c/p\u003e\n\u003cp\u003eãƒ©ãƒ³ãƒ€ãƒ ãªãƒãƒ¼ãƒ‰ã¨ã® \u0026lsquo;full state sync\u0026rsquo; ã¯ TCP ã§è¡Œã‚ã‚Œã‚‹ã‘ã©ã“ã‚Œã¯\nâ€˜gossipingâ€™ ã«æ¯”ã¹ã¦å°‘ã„\u003c/p\u003e","title":"Serf ã‚’ä½¿ã£ã¦ã¿ãŸ"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»¥å‰ã€\u0026ldquo;Swift HA æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤\u0026rdquo; ã¨ã„ã†ã‚¿ã‚¤ãƒˆãƒ«ã§è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸã€‚\nhttp://jedipunkz.github.io/blog/2013/07/26/swift-ha-chef-deploy/\nã“ã¡ã‚‰ã§ã™ãŒã€Swift-Proxy, MySQL, Keystone ã‚’ãã‚Œãã‚Œ haproxy, keepalived ã§ HA çµ„ã¿ã¾ã—ãŸã€‚ã§ã™ãŒã€ã“ã‚Œã¯å®Ÿç”¨çš„ãªã®ã‹ã©ã†ã‹è‡ªåˆ†ã§ãšã£ã¨è€ƒãˆã¦ã„ã¾ã—ãŸã€‚\nMySQL ã¨ KeepAlived ã¯ã§ãã‚Œã°ã‚·ãƒ³ã‚°ãƒ«æ§‹æˆã«ã—ãŸã„ã®ã¨ã€Swift-Proxy ã¯ HA ã§çµ„ ã¿ãŸã„ã€‚MySQL ã¯ Master/Master ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆã«ãªã‚Šã€ã©ã¡ã‚‰ã‹ã®ãƒãƒ¼ãƒ‰ãŒ éšœå®³ã‚’èµ·ã“ã—ä¸‡ãŒä¸€å¾©æ—§ãŒé›£ã—ããªã£ãŸæ™‚ã€æ§‹ç¯‰ã—ç›´ã—ãŒã—ã‚“ã©ããªã‚Šã¾ã™ã€‚ã‹ã¨è¨€ã£ ã¦ Swift-Proxy ã‚’ã‚·ãƒ³ã‚°ãƒ«æ§‹æˆã«ã™ã‚‹ã¨ä»Šåº¦ã¯ãƒãƒ¼ãƒ‰è¿½åŠ ãƒ»å‰Šé™¤ã®ä½œæ¥­æ™‚ã«ã‚µãƒ¼ãƒ“ã‚¹ æ–­ãŒç™ºç”Ÿã—ã¾ã™ã€‚Swift-Proxy ã‚’å†èµ·å‹•æ›¸ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚ãªã®ã§ Swift-Proxy ã¯å¼•ãç¶šã HA æ§‹æˆã«ã—ãŸã„ã€‚\nã‚‚ã†ä¸€ç‚¹ã€è¦‹ç›´ã—ãŸã„ã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚\næ—¥çµŒã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‹ã‚‰å‡ºç‰ˆã•ã‚Œã¦ã„ã‚‹ \u0026ldquo;ä»®æƒ³åŒ–å¤§å…¨ 2014\u0026rdquo; ã®è¨˜äº‹ã‚’èª­ã‚“ã§ã„ã¦ æ°—ãŒã¤ã„ãŸã®ã§ã™ãŒã€‚Swift ã«ã¯ä¸‹è¨˜ã®é€šã‚Šãã‚Œãã‚Œã®ã‚µãƒ¼ãƒãŒã‚ã‚Šã¾ã™ã€‚\nswift-proxy-server swift-account-server swift-container-server swift-object-server Swift ã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªç‰¹å¾´ãŒã‚ã‚‹äº‹ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚\nswift-object swift-object ã¯ swift-accout, swift-container ã¨ã¯ç‰©ç†ãƒªã‚½ãƒ¼ã‚¹ã®æ‰±ã„ã«å…¨ãç•°ãª ã‚‹ç‰¹æ€§ã‚’æŒã£ã¦ã„ã¾ã™ã€‚swift-account, swift-container ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ ã‚¹ãƒˆã«å¯¾ã—ã¦ \u0026ldquo;ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å­˜åœ¨ã‚’ç¢ºèª\u0026rdquo;, \u0026ldquo;ACL æƒ…å ±ã®ç¢ºèª\u0026rdquo; ç­‰ã‚’è¡Œã†ã‚µãƒ¼ãƒã§ã‚ã‚‹ã® ã«å¯¾ã—ã¦ swift-object ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æä¾›ã€ã¾ãŸã¯ é€†ã«æ ¼ç´ã™ã‚‹ã‚µãƒ¼ãƒã§ã™ã€‚ã‚ˆã£ã¦ã€Disk I/O ã®åˆ©ç”¨ç‰¹æ€§ã¨ã—ã¦ swift-account, container ã¯ SSD ç­‰ã€é«˜ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã® Disk ã‚’åˆ©ç”¨ã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒæ¨å¥¨ã•ã‚Œã‚‹ã®ã«å¯¾ ã—ã¦ swift-object ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®Ÿä½“ã‚’æ ¼ç´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ Disk å®¹é‡ã®å¤§ã ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’è¦ã™ã‚‹ã€‚\nã‚ˆã£ã¦ä»Šå›ã¯ä¸‹è¨˜ã®æ§‹æˆå¤‰æ›´ã‚’ã—ã¦ã‚ˆã‚Šå®Ÿç”¨çš„ãªæ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’è¨˜ ãã†ã¨æ€ã„ã¾ã™ã€‚\nswift-object ã‚’ swift-account, swift-container ã¨ãƒãƒ¼ãƒ‰ã‚’åˆ†é›¢ã™ã‚‹ MySQL/Keystone ã® HA ã‚’è¡Œã‚ãš Swift-Proxy ã®ã¿ HA åŒ–ã™ã‚‹ å‚è€ƒè³‡æ–™ http://www.rackspace.com/knowledge_center/article/managing-openstack-object-storage-with-chef ä»®æƒ³åŒ–å¤§å…¨ æ§‹æˆ +-----------------+ | load balancer | +-----------------+ | +-------------------+-------------------+-------------------+-------------------+---------------------- proxy network | | | | | +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ | chef server | | chef workstation| | swift-mange | | swift-proxy01 | | swift-proxy02 | +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ ...\u0026gt; scaling | | | | | +-------------------+-------------------+-------------------+-------------------+-------------------+-- storage network | | | | | | +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ | swift-storage01 | | swift-storage02 | | swift-storage03 | | swift-account01 | | swift-account02 | | swift-account03 | +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ ..\u0026gt; scaling ç‰¹å¾´ load balancer ã¯ä¸€èˆ¬çš„ãªãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ç”¨æ„ (ä»Šå›ã¯å‰²æ„›) swift-proxy ã¯åŒç­‰ã®æ©Ÿèƒ½ã®ãƒ¢ãƒã‚’ä¸¦åˆ—ã« swift-storage ã¨ \u0026lsquo;swift-account, container\u0026rsquo; ã¯ãã‚Œãã‚Œã® zone æ¯ã«ä¸¦ã¹ã‚‹ãŸã‚åŒæ•° swift-account ã¯ swift-account, swift-container ãŒç¨¼åƒ swift-manage ã¯ mysql, keystone, git server ã‚’æ­è¼‰ chef server ã¯å¤–éƒ¨ã«é…ç½®ã—ã¦ã‚‚æ§‹ã‚ãªã„ãŒåˆ°é”å‡ºæ¥ã‚‹ç®‡æ‰€ã« chef workstation ã¯å…¨ã¦ã®æ“ä½œã‚’è¡Œã†ç«¯æœ«ã€‚å…¨ã¦ã®ãƒãƒ¼ãƒ‰ã«åˆ°é”å‡ºæ¥ã‚‹ç®‡æ‰€ã« ãã‚Œãã‚Œã®ãƒãƒ¼ãƒ‰ã§ã® disk ã®æº–å‚™ object, account, container å…±ã« OS é ˜åŸŸã¨ã¯åˆ¥ã® disk ã‚’å¿…è¦ã¨ã™ã‚‹ãŸã‚ /dev/sdb ç­‰ã®ãƒ‡ã‚£ã‚¹ã‚¯ã‚’è¿½åŠ ã—ä¸‹è¨˜ã®é€šã‚Š gdisk ã§ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã‚‹ã€‚\n% sudo apt-get update; sudo apt-get -y install gdisk % sudo gdisk /dev/sdb # ãƒ‡ãƒã‚¤ã‚¹åã¯ä¾‹ å¯¾è±¡ãƒãƒ¼ãƒ‰ : swift-object0[1-3], swift-account0[1-3]\nãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™ ä¸‹è¨˜ã¯å…¨ã¦ chef-workstation ã§ã®æ“ä½œ\nrcpops ç®¡ç†ã® chef-repo ã‚’å–å¾—ã™ã‚‹ã€‚\n% git clone https://github.com/rcbops/chef-cookbooks.git % cd chef-cookbooks ç¾æ™‚ç‚¹ã§ v4.1.2 ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ã‚‹ã®ã§ tag ã‚’åˆ©ç”¨ã—ã¦ checkout ã™ã‚‹ã€‚\n% git tag -l 1.0.0 release-2011.3-d5 release-v2.0 v2.9.0 v2.9.1 v2.9.2 v2.9.3 v2.9.4 v2.9.5 v2.9.6 v2.9.7 v2.9.8 v3.0.0 v3.0.1 v3.1.0 v4.1.0 v4.1.1 v4.1.2 % git checkout -b v4.1.2 refs/tags/v4.1.2 git submodule åŒ–ã•ã‚Œã¦ã„ã‚‹ cookbooks ã‚’å–å¾—ã™ã‚‹ã€‚\n% git submodule init % git submodule sync % git submodule upate cookbooks, roles ã® chef-server ã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’è¡Œã†ã€‚\n% knife cookbook upload -o cookbook -a % knife role from file role/*.rb ä»Šå›ã®æ§‹æˆä¸€å¼ã‚’åå®¹ã™ã‚‹ chef environment ã‚’ä½œæˆã™ã‚‹ã€‚\n{ \u0026#34;name\u0026#34;: \u0026#34;swift\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;cookbook_versions\u0026#34;: { }, \u0026#34;json_class\u0026#34;: \u0026#34;Chef::Environment\u0026#34;, \u0026#34;chef_type\u0026#34;: \u0026#34;environment\u0026#34;, \u0026#34;default_attributes\u0026#34;: { }, \u0026#34;override_attributes\u0026#34;: { \u0026#34;package_component\u0026#34;: \u0026#34;grizzly\u0026#34;, \u0026#34;osops_networks\u0026#34;: { \u0026#34;management\u0026#34;: \u0026#34;10.200.9.0/24\u0026#34;, \u0026#34;public\u0026#34;: \u0026#34;10.200.9.0/24\u0026#34;, \u0026#34;nova\u0026#34;: \u0026#34;10.200.9.0/24\u0026#34;, \u0026#34;swift\u0026#34;: \u0026#34;10.200.9.0/24\u0026#34; }, \u0026#34;keystone\u0026#34;: { \u0026#34;admin_user\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;tenants\u0026#34;: [ \u0026#34;admin\u0026#34;, \u0026#34;service\u0026#34; ], \u0026#34;users\u0026#34;: { \u0026#34;admin\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;admin\u0026#34;: [ \u0026#34;admin\u0026#34; ] } }, \u0026#34;demo\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;demo\u0026#34;, \u0026#34;default_tenant\u0026#34; : \u0026#34;service\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;admin\u0026#34;: [ \u0026#34;admin\u0026#34; ] } } }, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;keystone\u0026#34; } }, \u0026#34;mysql\u0026#34;: { \u0026#34;root_network_acl\u0026#34;: \u0026#34;%\u0026#34;, \u0026#34;allow_remote_root\u0026#34;: true, \u0026#34;server_root_password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;server_repl_password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;server_debian_password\u0026#34;: \u0026#34;secrete\u0026#34; }, \u0026#34;monitoring\u0026#34;: { \u0026#34;procmon_provider\u0026#34;: \u0026#34;monit\u0026#34;, \u0026#34;metric_provider\u0026#34;: \u0026#34;collectd\u0026#34; }, \u0026#34;vips\u0026#34;: { \u0026#34;keystone-admin-api\u0026#34;: \u0026#34;10.200.9.112\u0026#34;, \u0026#34;keystone-service-api\u0026#34;: \u0026#34;10.200.9.112\u0026#34;, \u0026#34;keystone-internal-api\u0026#34;: \u0026#34;10.200.9.112\u0026#34;, \u0026#34;swift-proxy\u0026#34;: \u0026#34;10.200.9.112\u0026#34;, \u0026#34;config\u0026#34;: { \u0026#34;10.200.9.112\u0026#34;: { \u0026#34;vrid\u0026#34;: 12, \u0026#34;network\u0026#34;: \u0026#34;management\u0026#34; } } }, \u0026#34;developer_mode\u0026#34;: false, \u0026#34;swift\u0026#34;: { \u0026#34;swift_hash\u0026#34;: \u0026#34;107c0568ea84\u0026#34;, \u0026#34;authmode\u0026#34;: \u0026#34;keystone\u0026#34;, \u0026#34;authkey\u0026#34;: \u0026#34;3f281b71-ce89-4b27-a2ad-ad873d3f2760\u0026#34; } } } ä½œæˆã—ãŸ environment ãƒ•ã‚¡ã‚¤ãƒ« environments/swift.json ã‚’ chef-server ã¸ã‚¢ãƒƒãƒ— ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚\n% knife environment from file environments/swift.json ãƒ‡ãƒ—ãƒ­ã‚¤ ã‹ãã®ã¨ãŠã‚Š knife bootstrap ã™ã‚‹ã€‚\n% knife bootstrap \u0026lt;manage_ip_addr\u0026gt; -N swift-manage -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[mysql-master]\u0026#39;,\u0026#39;role[keystone]\u0026#39;,\u0026#39;role[swift-management-server]\u0026#39; -E swift --sudo -x thirai % knife bootstrap \u0026lt;proxy01_ip_addr\u0026gt; -N swift-proxy01 -r \u0026#34;role[base]\u0026#34;,\u0026#34;role[swift-proxy-server]\u0026#34;,\u0026#39;role[swift-setup]\u0026#39;,\u0026#39;role[openstack-ha]\u0026#39; -E swift --sudo -x thirai % knife bootstrap \u0026lt;proxy02_ip_addr\u0026gt; -N swift-proxy02 -r \u0026#34;role[base]\u0026#34;,\u0026#34;role[swift-proxy-server]\u0026#34;,\u0026#39;role[openstack-ha]\u0026#39; -E swift --sudo -x thirai % knife bootstrap \u0026lt;storage01_ip_addr\u0026gt; -N swift-storage01 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-object-server]\u0026#39; -E swift --sudo -x thirai % knife bootstrap \u0026lt;storage02_ip_addr\u0026gt; -N swift-storage02 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-object-server]\u0026#39; -E swift --sudo -x thirai % knife bootstrap \u0026lt;storage03_ip_addr\u0026gt; -N swift-storage03 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-object-server]\u0026#39; -E swift --sudo -x thirai % knife bootstrap \u0026lt;account01_ip_addr\u0026gt; -N swift-account01 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-account-server]\u0026#39;,\u0026#39;role[swift-container-server]\u0026#39; -E swift --sudo -x thirai % knife bootstrap \u0026lt;account02_ip_addr\u0026gt; -N swift-account02 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-account-server]\u0026#39;,\u0026#39;role[swift-container-server]\u0026#39; -E swift --sudo -x thirai % knife bootstrap \u0026lt;account03_ip_addr\u0026gt; -N swift-account03 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-account-server]\u0026#39;,\u0026#39;role[swift-container-server]\u0026#39; -E swift --sudo -x thirai zone ç•ªå·ã‚’ä»˜ä¸ã™ã‚‹ã€‚\n% knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-storage01\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;1\u0026#39;; n.save }\u0026#34; % knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-account01\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;1\u0026#39;; n.save }\u0026#34; % knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-storage02\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;2\u0026#39;; n.save }\u0026#34; % knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-account02\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;2\u0026#39;; n.save }\u0026#34; % knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-storage03\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;3\u0026#39;; n.save }\u0026#34; % knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-account03\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;3\u0026#39;; n.save }\u0026#34; zone ç•ªå·ãŒä»˜ä¸ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚\naccount-server ã®ç¢ºèª\n% knife exec -E \u0026#39;search(:node,\u0026#34;role:swift-account-server\u0026#34;) \\ { |n| z=n[:swift][:zone]||\u0026#34;not defined\u0026#34;; puts \u0026#34;#{n.name} has the role \\ [swift-account-server] and is in swift zone #{z}\u0026#34;; }\u0026#39; swift-account01 has the role [swift-account-server] and is in swift zone 1 swift-account02 has the role [swift-account-server] and is in swift zone 2 swift-account03 has the role [swift-account-server] and is in swift zone 3 container-server ã®ç¢ºèª\n% knife exec -E \u0026#39;search(:node,\u0026#34;role:swift-container-server\u0026#34;) \\ { |n| z=n[:swift][:zone]||\u0026#34;not defined\u0026#34;; puts \u0026#34;#{n.name} has the role \\ [swift-container-server] and is in swift zone #{z}\u0026#34;; }\u0026#39; swift-account01 has the role [swift-container-server] and is in swift zone 1 swift-account02 has the role [swift-container-server] and is in swift zone 2 swift-account03 has the role [swift-container-server] and is in swift zone 3 object-server ã®ç¢ºèª\n% knife exec -E \u0026#39;search(:node,\u0026#34;role:swift-object-server\u0026#34;) \\ { |n| z=n[:swift][:zone]||\u0026#34;not defined\u0026#34;; puts \u0026#34;#{n.name} has the role \\ [swift-object-server] and is in swift zone #{z}\u0026#34;; }\u0026#39; swift-storage01 has the role [swift-object-server] and is in swift zone 1 swift-storage02 has the role [swift-object-server] and is in swift zone 2 swift-storage03 has the role [swift-object-server] and is in swift zone 3 Chef ãŒå„ã€…ã®ãƒãƒ¼ãƒ‰ã«æ­è¼‰ã•ã‚ŒãŸ Disk ã‚’æ¤œçŸ¥å‡ºæ¥ã‚‹ã‹å¦ã‹ã‚’ç¢ºèªã™ã‚‹ã€‚\n% knife exec -E \\ \u0026#39;search(:node,\u0026#34;role:swift-object-server OR \\ role:swift-account-server \\ OR role:swift-container-server\u0026#34;) \\ { |n| puts \u0026#34;#{n.name}\u0026#34;; \\ begin; n[:swift][:state][:devs].each do |d| \\ puts \u0026#34;\\tdevice #{d[1][\u0026#34;device\u0026#34;]}\u0026#34;; \\ end; rescue; puts \\ \u0026#34;no candidate drives found\u0026#34;; end; }\u0026#39; swift-storage02 device sdb1 swift-storage03 device sdb1 swift-account01 device sdb1 swift-account02 device sdb1 swift-account03 device sdb1 swift-storage01 device sdb1 swift-manage ãƒãƒ¼ãƒ‰ã«ã¦ chef-client ã‚’å®Ÿè¡Œã— /etc/swift/ring-workspace/generate-rings.sh ã‚’æ›´æ–°ã™ã‚‹ã€‚\nswift-manage% sudo chef-client generate-rings.sh ã® \u0026rsquo;exit 0\u0026rsquo; è¡Œã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—å®Ÿè¡Œ\nswift-manage% sudo ${EDITOR} /etc/swift/ring-workspace/generage-rings.sh swift-manage% sudo /etc/swift/ring-workspace/generate-rings.sh ã“ã®æ“ä½œã§ /etc/swift/ring-workspace/rings é…ä¸‹ã« account, container, object ç”¨ã® Rings ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ãŒç”Ÿæˆã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªå‡ºæ¥ã‚‹ã¯ãšã§ã‚ã‚‹ã€‚ã“ã‚Œã‚‰ã‚’ swift-manage ä¸Šã§æ—¢ã«ç¨¼åƒã—ã¦ã„ã‚‹ git ã‚µãƒ¼ãƒã« push ã—ç®¡ç†ã™ã‚‹ã€‚\nswift-manage# cd /etc/swift/ring-workspace/rings swift-manage# git add account.builder container.builder object.builder swift-manage# git add account.ring.gz container.ring.gz object.ring.gz swift-manage# git commit -m \u0026#34;initial commit\u0026#34; swift-manage# git push å„ã€…ã®ãƒãƒ¼ãƒ‰ã«ã¦ chef-client ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ git ã‚µãƒ¼ãƒä¸Šã® Rings ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ ã‚’å–å¾—ã—ã€swift ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¨¼åƒã•ã›ã‚‹ã€‚\nswift-proxy01# chef-client swift-proxy02# chef-client swift-storage01# chef-client swift-storage02# chef-client swift-storage03# chef-client swift-account01# chef-client swift-account02# chef-client swift-account03# chef-client 3å°ã®ãƒãƒ¼ãƒ‰ãŒç™»éŒ²ã•ã‚ŒãŸã‹ã©ã†ã‹ã‚’ä¸‹è¨˜ã®é€šã‚Šç¢ºèªè¡Œã†ã€‚\nswift-proxy01% sudo swift-recon --md5 [sudo] password for thirai: =============================================================================== --\u0026gt; Starting reconnaissance on 3 hosts =============================================================================== [2013-10-18 11:14:43] Checking ring md5sums 3/3 hosts matched, 0 error[s] while checking hosts. =============================================================================== å‹•ä½œç¢ºèª swift-storage01# source swift-openrc swift-storage01# swift post container01 swift-storage01# echo \u0026#34;test\u0026#34; \u0026gt; test swift-storage01# swift upload container01 test swift-storage01# swift list swift-storage01# swift list container01 ãƒãƒ¼ãƒ‰ã®è¿½åŠ æ–¹æ³• æ¬¡ã«ãƒãƒ¼ãƒ‰ã®è¿½åŠ æ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚\ngdisk ã«ã¦ /dev/sdb1 ç­‰ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ã€‚\nä¸‹è¨˜ã®é€šã‚Š knife bootstrap ã™ã‚‹ã€‚\n% knife bootstrap \u0026lt;storage04_ip_addr\u0026gt; -N swift-storage04 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-object-server]\u0026#39; -E swift --sudo -x thirai % knife bootstrap \u0026lt;account04_ip_addr\u0026gt; -N swift-account04 -r \u0026#39;role[base]\u0026#39;,\u0026#39;role[swift-account-server]\u0026#39;,\u0026#39;role[swift-container-server]\u0026#39; -E swift --sudo -x thirai zone ç•ªå·ã‚’ä»˜ä¸ã™ã‚‹ã€‚\n% knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-storage04\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;4\u0026#39;; n.save }\u0026#34; % knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-account04\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;4\u0026#39;; n.save }\u0026#34; zone ç•ªå·ãŒä»˜ä¸ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚\naccount-server ã®ç¢ºèª\n% knife exec -E \u0026#39;search(:node,\u0026#34;role:swift-account-server\u0026#34;) \\ { |n| z=n[:swift][:zone]||\u0026#34;not defined\u0026#34;; puts \u0026#34;#{n.name} has the role \\ [swift-account-server] and is in swift zone #{z}\u0026#34;; }\u0026#39; swift-account01 has the role [swift-account-server] and is in swift zone 1 swift-account02 has the role [swift-account-server] and is in swift zone 2 swift-account03 has the role [swift-account-server] and is in swift zone 3 swift-account04 has the role [swift-account-server] and is in swift zone 4 container-server ã®ç¢ºèª\n% knife exec -E \u0026#39;search(:node,\u0026#34;role:swift-container-server\u0026#34;) \\ { |n| z=n[:swift][:zone]||\u0026#34;not defined\u0026#34;; puts \u0026#34;#{n.name} has the role \\ [swift-container-server] and is in swift zone #{z}\u0026#34;; }\u0026#39; swift-account01 has the role [swift-container-server] and is in swift zone 1 swift-account02 has the role [swift-container-server] and is in swift zone 2 swift-account03 has the role [swift-container-server] and is in swift zone 3 swift-account04 has the role [swift-container-server] and is in swift zone 4 object-server ã®ç¢ºèª\n% knife exec -E \u0026#39;search(:node,\u0026#34;role:swift-object-server\u0026#34;) \\ { |n| z=n[:swift][:zone]||\u0026#34;not defined\u0026#34;; puts \u0026#34;#{n.name} has the role \\ [swift-object-server] and is in swift zone #{z}\u0026#34;; }\u0026#39; swift-storage01 has the role [swift-object-server] and is in swift zone 1 swift-storage02 has the role [swift-object-server] and is in swift zone 2 swift-storage03 has the role [swift-object-server] and is in swift zone 3 swift-storage04 has the role [swift-object-server] and is in swift zone 4 swift-manage ãƒãƒ¼ãƒ‰ã«ã¦ chef-client ã‚’å®Ÿè¡Œã— /etc/swift/ring-workspace/generate-rings.sh ã‚’æ›´æ–°ã™ã‚‹ã€‚\nswift-manage% sudo chef-client generate-rings.sh ã® \u0026rsquo;exit 0\u0026rsquo; è¡Œã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—å®Ÿè¡Œ\nswift-manage% sudo ${EDITOR} /etc/swift/ring-workspace/generage-rings.sh swift-manage% sudo /etc/swift/ring-workspace/generate-rings.sh ã“ã®æ“ä½œã§ /etc/swift/ring-workspace/rings é…ä¸‹ã« account, container, object ç”¨ã® Rings ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ãŒç”Ÿæˆã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªå‡ºæ¥ã‚‹ã¯ãšã§ã‚ã‚‹ã€‚ã“ã‚Œã‚‰ã‚’ swift-manage ä¸Šã§æ—¢ã«ç¨¼åƒã—ã¦ã„ã‚‹ git ã‚µãƒ¼ãƒã« push ã—ç®¡ç†ã™ã‚‹ã€‚\nswift-manage# cd /etc/swift/ring-workspace/rings swift-manage# git add account.builder container.builder object.builder swift-manage# git add account.ring.gz container.ring.gz object.ring.gz swift-manage# git commit -m \u0026#34;added zone 4 nodes\u0026#34; swift-manage# git push å„ã€…ã®ãƒãƒ¼ãƒ‰ã«ã¦ chef-client ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ git ã‚µãƒ¼ãƒä¸Šã® Rings ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ ã‚’å–å¾—ã—ã€swift ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¨¼åƒã•ã›ã‚‹ã€‚\nswift-proxy01# chef-client swift-proxy02# chef-client swift-storage01# chef-client swift-storage02# chef-client swift-storage03# chef-client swift-storage04# chef-client swift-account01# chef-client swift-account02# chef-client swift-account03# chef-client swift-account04# chef-client 4å°ã®ãƒãƒ¼ãƒ‰ãŒç™»éŒ²ã•ã‚ŒãŸã‹ã©ã†ã‹ã‚’ä¸‹è¨˜ã®é€šã‚Šç¢ºèªè¡Œã†ã€‚\nswift-proxy01% sudo swift-recon --md5 [sudo] password for thirai: =============================================================================== --\u0026gt; Starting reconnaissance on 4 hosts =============================================================================== [2013-10-18 11:14:43] Checking ring md5sums 4/4 hosts matched, 0 error[s] while checking hosts. =============================================================================== proxy ãƒãƒ¼ãƒ‰ã® swift ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢ãƒ»èµ·å‹•ã™ã‚‹\nswift-proxy01# swift-init all stop swift-proxy01# swift-init all start swift-proxy02# swift-init all stop swift-proxy02# swift-init all start ãƒãƒ¼ãƒ‰å‰Šé™¤æ–¹æ³• æ¬¡ã«ãƒãƒ¼ãƒ‰ã®å‰Šé™¤æ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚\ndisk éšœå®³ç­‰ã®zone4 ã®ãƒãƒ¼ãƒ‰ swift-storage04, swift-account04 ã‚’å‰Šé™¤ã™ã‚‹å‰æã§è¨˜ã™ã€‚\nswift-manage# swift-ring-builder /etc/swift/ring-workspace/rings/account.builder remove 10.200.9.109 swift-manage# swift-ring-builder /etc/swift/ring-workspace/rings/container.builder remove 10.200.9.109 swift-manage# swift-ring-builder /etc/swift/ring-workspace/rings/object.builder remove 10.200.9.110 swift-manage ä¸Šã§æ—¢ã«ç¨¼åƒã—ã¦ã„ã‚‹ git ã‚µãƒ¼ãƒã« push ã—ç®¡ç†ã™ã‚‹ã€‚\nswift-manage# cd /etc/swift/ring-workspace/rings swift-manage# git add account.builder container.builder object.builder swift-manage# git add account.ring.gz container.ring.gz object.ring.gz swift-manage# git commit -m \u0026#34;added zone 4 nodes\u0026#34; swift-manage# git push å…¨ã¦ã®ãƒãƒ¼ãƒ‰ã§ chef-client ã‚’å®Ÿè¡Œã™ã‚‹ã€‚ã“ã®æ“ä½œã§ rings ãƒ•ã‚¡ã‚¤ãƒ«ã®é…å¸ƒãŒè¡Œãˆã‚‹ã€‚\nswift-proxy01# chef-client swift-proxy02# chef-client swift-storage01# chef-client swift-storage02# chef-client swift-storage03# chef-client swift-storage04# chef-client swift-account01# chef-client swift-account02# chef-client swift-account03# chef-client swift-account04# chef-client proxy ãƒãƒ¼ãƒ‰ã® swift ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢ãƒ»èµ·å‹•ã™ã‚‹\nswift-proxy01# swift-init all stop swift-proxy01# swift-init all start swift-proxy02# swift-init all stop swift-proxy02# swift-init all start ã¾ã¨ã‚ã¨è€ƒå¯Ÿ MySQL ã®ãƒªã‚«ãƒãƒªã¯å˜ç´”ã«ãƒ€ãƒ³ãƒ—ã‹ã‚‰ã®ãƒªã‚¹ãƒˆã‚¢ãŒè‰¯ã‹ã£ãŸã®ã§ã‚·ãƒ³ã‚°ãƒ«æ§‹æˆã«å‡ºæ¥ã¦ ã‚ˆã‹ã£ãŸã€‚ã¾ãŸã€é€šå¸¸ã®ã‚·ãƒ³ã‚°ãƒ«ã‚¹ã‚¿ãƒ¼ãƒ»ãƒãƒ«ãƒã‚¹ãƒ¬ãƒ¼ãƒ–ã®æ§‹æˆã«å¤‰ãˆã¦ã‚‚ OK ã‹ã¨æ€ ã„ã¾ã™ãŒã€Cookbooks ã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã€‚ã¾ã Keystone ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’ç®¡ç† ã—ã¦ã„ã‚‹ MySQL ãªã®ã§è² è·ã¯ç„¡ã„ã§ã™ã—ã‚·ãƒ³ã‚°ãƒ«æ§‹æˆãŒè‰¯ã„ã¨å€‹äººçš„ã«ã¯æ€ã„ã¾ã™ã€‚ ã¾ãŸ Swift-Proxy ã¯ 2 å°æ§‹æˆã® HA ã«ãªã‚Šã¾ã™ã€‚VRRP ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ä»•çµ„ã¿ã€ã¾ãŸ haproxy ã®æ§‹æˆä¸Š 3 å°ä»¥ä¸Šã§ã‚‚ OK ã§ã‚ã‚Šã¾ã™ãŒã€Cookbooks çš„ã« NG ã§ã—ãŸã€‚ã“ã‚Œ ã¯ä¿®æ­£ã™ã‚‹ä¾¡å€¤ãŒå¤§ã„ã«ã‚ã‚Šãã†ã€‚\nã¾ãŸã“ã®æ§‹æˆã‚’ Chef ã§ç®¡ç†ã—å§‹ã‚ã‚‹ã¨å¤§é‡ã®ãƒãƒ¼ãƒ‰ã§ Chef-Client ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ ã«ãªã‚‹ã®ã§ Gnu Prallel ã‚„ pssh ã‚’ä½¿ã£ãŸæ–¹ãŒè‰¯ã•ãã†\u0026hellip;ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/10/27/swift-chef/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥å‰ã€\u0026ldquo;Swift HA æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤\u0026rdquo; ã¨ã„ã†ã‚¿ã‚¤ãƒˆãƒ«ã§è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://jedipunkz.github.io/blog/2013/07/26/swift-ha-chef-deploy/\"\u003ehttp://jedipunkz.github.io/blog/2013/07/26/swift-ha-chef-deploy/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã“ã¡ã‚‰ã§ã™ãŒã€Swift-Proxy, MySQL, Keystone ã‚’ãã‚Œãã‚Œ haproxy, keepalived ã§\nHA çµ„ã¿ã¾ã—ãŸã€‚ã§ã™ãŒã€ã“ã‚Œã¯å®Ÿç”¨çš„ãªã®ã‹ã©ã†ã‹è‡ªåˆ†ã§ãšã£ã¨è€ƒãˆã¦ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eMySQL ã¨ KeepAlived ã¯ã§ãã‚Œã°ã‚·ãƒ³ã‚°ãƒ«æ§‹æˆã«ã—ãŸã„ã®ã¨ã€Swift-Proxy ã¯ HA ã§çµ„\nã¿ãŸã„ã€‚MySQL ã¯ Master/Master ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆã«ãªã‚Šã€ã©ã¡ã‚‰ã‹ã®ãƒãƒ¼ãƒ‰ãŒ\néšœå®³ã‚’èµ·ã“ã—ä¸‡ãŒä¸€å¾©æ—§ãŒé›£ã—ããªã£ãŸæ™‚ã€æ§‹ç¯‰ã—ç›´ã—ãŒã—ã‚“ã©ããªã‚Šã¾ã™ã€‚ã‹ã¨è¨€ã£\nã¦ Swift-Proxy ã‚’ã‚·ãƒ³ã‚°ãƒ«æ§‹æˆã«ã™ã‚‹ã¨ä»Šåº¦ã¯ãƒãƒ¼ãƒ‰è¿½åŠ ãƒ»å‰Šé™¤ã®ä½œæ¥­æ™‚ã«ã‚µãƒ¼ãƒ“ã‚¹\næ–­ãŒç™ºç”Ÿã—ã¾ã™ã€‚Swift-Proxy ã‚’å†èµ·å‹•æ›¸ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚ãªã®ã§\nSwift-Proxy ã¯å¼•ãç¶šã HA æ§‹æˆã«ã—ãŸã„ã€‚\u003c/p\u003e\n\u003cp\u003eã‚‚ã†ä¸€ç‚¹ã€è¦‹ç›´ã—ãŸã„ã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eæ—¥çµŒã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‹ã‚‰å‡ºç‰ˆã•ã‚Œã¦ã„ã‚‹ \u0026ldquo;ä»®æƒ³åŒ–å¤§å…¨ 2014\u0026rdquo; ã®è¨˜äº‹ã‚’èª­ã‚“ã§ã„ã¦\næ°—ãŒã¤ã„ãŸã®ã§ã™ãŒã€‚Swift ã«ã¯ä¸‹è¨˜ã®é€šã‚Šãã‚Œãã‚Œã®ã‚µãƒ¼ãƒãŒã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eswift-proxy-server\u003c/li\u003e\n\u003cli\u003eswift-account-server\u003c/li\u003e\n\u003cli\u003eswift-container-server\u003c/li\u003e\n\u003cli\u003eswift-object-server\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSwift ã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªç‰¹å¾´ãŒã‚ã‚‹äº‹ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eswift-object\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eswift-object ã¯ swift-accout, swift-container ã¨ã¯ç‰©ç†ãƒªã‚½ãƒ¼ã‚¹ã®æ‰±ã„ã«å…¨ãç•°ãª\nã‚‹ç‰¹æ€§ã‚’æŒã£ã¦ã„ã¾ã™ã€‚swift-account, swift-container ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨\nã‚¹ãƒˆã«å¯¾ã—ã¦ \u0026ldquo;ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å­˜åœ¨ã‚’ç¢ºèª\u0026rdquo;, \u0026ldquo;ACL æƒ…å ±ã®ç¢ºèª\u0026rdquo; ç­‰ã‚’è¡Œã†ã‚µãƒ¼ãƒã§ã‚ã‚‹ã®\nã«å¯¾ã—ã¦ swift-object ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æä¾›ã€ã¾ãŸã¯\né€†ã«æ ¼ç´ã™ã‚‹ã‚µãƒ¼ãƒã§ã™ã€‚ã‚ˆã£ã¦ã€Disk I/O ã®åˆ©ç”¨ç‰¹æ€§ã¨ã—ã¦ swift-account,\ncontainer ã¯ SSD ç­‰ã€é«˜ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã® Disk ã‚’åˆ©ç”¨ã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒæ¨å¥¨ã•ã‚Œã‚‹ã®ã«å¯¾\nã—ã¦ swift-object ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®Ÿä½“ã‚’æ ¼ç´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ Disk å®¹é‡ã®å¤§ã\nãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’è¦ã™ã‚‹ã€‚\u003c/p\u003e","title":"å®Ÿç”¨çš„ãª Swift æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nå‰å›ã€OpenStack ã¨ test-kitchen ã‚’ä½¿ã£ãŸç’°å¢ƒæ§‹ç¯‰æ–¹æ³•ã‚’æ›¸ãã¾ã—ãŸã€‚ä¸‹è¨˜ã®è¨˜äº‹ã§ ã™ã€‚\nhttp://jedipunkz.github.io/blog/2013/10/13/test-kitchn-openstack-chef-cookbooks-test/\nä»Šå›ã¯å®Ÿéš›ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãæ–¹æ³•ã‚’è¨˜ã—ã¦ã„ãŸã„æ€ã„ã¾ã™ã€‚\nä»Šå›ä½¿ç”¨ã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã¯ä¸‹è¨˜ã®2ã¤ã§ã™ã€‚\nrspec ã¨ serverspec busser-bats å‚è€ƒè³‡æ–™ Creationline lab ã•ã‚“ã®è³‡æ–™ã‚’å‚è€ƒã«ã•ã›ã¦é ‚ãã¾ã—ãŸã€‚\nhttp://www.creationline.com/lab/2933\nç”¨æ„ã™ã‚‹ãƒ¢ãƒé” OpenStack ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ã‚¶ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ Keystone ã® AUTH_URL ãƒ†ã‚¹ãƒˆã«ç”¨ã„ã‚‹ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã® Image ID ãƒ†ãƒŠãƒ³ãƒˆ ID nova ç®¡ç†ã®ã‚­ãƒ¼ãƒšã‚¢ã®ä½œæˆ ã“ã‚Œã‚‰ã¯ OpenStack ã‚’æ™®æ®µã‹ã‚‰åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹æ–¹ãªã‚‰é¦´æŸ“ã¿ã®ãƒ¢ãƒã‹ã¨æ€ã„ã¾ã™ã€‚\n.kitchen.yml ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ ä¸‹è¨˜ã®é€šã‚Š .kitchen.yml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ test-kitchen ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä½œæˆã—ã¾ ã™ã€‚ä»Šå¾Œã®æ“ä½œã¯å…¨ã¦ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä½œæ¥­è¡Œã„ã¾ã™ã€‚\n\u0026ldquo;\u0026lt;\u0026gt;\u0026rdquo; ã§æ‹¬ã£ãŸç®‡æ‰€ãŒç’°å¢ƒã«åˆã‚ã›ãŸè¨­å®šã«ãªã‚Šã¾ã™ã€‚\nã¾ãŸã€ã“ã“ã§ã¯å‰å›åŒæ§˜ã« \u0026rsquo;ntp\u0026rsquo; ã® Cookbook ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹å‰æã§è¨˜ã—ã¾ã™ã€‚\n+++ driver_plugin: openstack suites: - name: default run_list: - recipe[ntp::default] attributes: {} platforms: - name: ubuntu-12.04 driver_config: openstack_username: \u0026lt;openstack_username\u0026gt; openstack_api_key: \u0026lt;openstack_password\u0026gt; openstack_auth_url: http://\u0026lt;openstack_ip_addr\u0026gt;:5000/v2.0/tokens image_ref: \u0026lt;image_id\u0026gt; flavor_ref: 1 key_name: \u0026lt;key_name\u0026gt; openstack_tenant: \u0026lt;tenant_name\u0026gt; username: \u0026lt;ssh_username\u0026gt; private_key_path: \u0026lt;path_to_secretkey\u0026gt; - name: centos-64 driver_config: openstack_username: \u0026lt;openstack_username\u0026gt; openstack_api_key: \u0026lt;openstack_password\u0026gt; openstack_auth_url: http://\u0026lt;openstack_ip_addr\u0026gt;:5000/v2.0/tokens image_ref: \u0026lt;image_id\u0026gt; flavor_ref: 1 key_name: \u0026lt;key_name\u0026gt; openstack_tenant: \u0026lt;tenant_name\u0026gt; username: \u0026lt;ssh_username\u0026gt; private_key_path: \u0026lt;path_to_secretkey\u0026gt; busser-bats ãƒ†ã‚¹ãƒˆ +++\nã¾ãšã¯ã˜ã‚ã« busser-bats ã®ãƒ†ã‚¹ãƒˆã‚’è¨˜ã—ã¾ã™ã€‚\nãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ kitchen init ã‚’è¡Œã†ã“ã¨ã§ã‚‚ã“ã®æ“ä½œã¯å¯èƒ½ãªã®ã§ã™ãŒ kitchen-openstack ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ ã‚’æƒ³å®šã—ãªã„å½¢ã§æˆå½¢ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã€ä¸‹è¨˜ã®é€šã‚Šå®Ÿè¡Œã™ã‚‹ã€‚\n% cd $TEST-KITCHEN-ROOT/ % mkdir -p test/integration/default/bats ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯\ntest/integration/${SUITE_NAME}/${BUSSER_NAME}/${TEST_NAME} ã¨ãªã£ã¦ã„ã¾ã™ã€‚\nãƒ†ã‚¹ãƒˆä½œæˆ test/integration/default/bats/test.bats ã¨ã—ã¦ä¸‹è¨˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚\n@test \u0026#34;ntp must be installed\u0026#34; { which ntpd } @test \u0026#34;ntp.conf must be exist\u0026#34; { cat /etc/ntp.conf | grep \u0026#34;server 0.pool.ntp.org iburst\u0026#34; } ä¸€é …ç›®ã¨äºŒé …ç›®ã®èª¬æ˜ã‚’æ›¸ã„ã¦ãŠãã¾ã™ã€‚\nä¸€é …ç›®ã® @test ntpd ã‚³ãƒãƒ³ãƒ‰ãŒå­˜åœ¨ã™ã‚‹ã‹å¦ã‹ã§ package \u0026rsquo;ntp\u0026rsquo; ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã€‚\näºŒé …ç›®ã® @test ç‰¹å®šã®æ–‡å­—åˆ—ãŒ /etc/ntp.conf ã«è¨˜è¿°ã‚ã‚‹ã‹å¦ã‹ã§ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ã‚’ç¢ºèªã€‚\nrspec serverspec ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆå®Ÿæ–½ æ¬¡ã« rspec + serverspec ã®ãƒ†ã‚¹ãƒˆã®è¨˜è¿°æ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚\nãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚\n% mkdir test/integration/default/rspec Gemfile è¿½è¨˜ ä¸‹è¨˜ã®é€šã‚Š test/integration/default/rspec/Gemfile ã‚’ä½œæˆã—ã¾ã™ã€‚\nsource \u0026#39;https://rubygems.org\u0026#39; gem \u0026#39;serverspec\u0026#39; serverspec-init ã®å®Ÿè¡Œ serverspec-init ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚ŠåˆæœŸåŒ–ã‚’è¡Œã„ã¾ã™ã€‚\n% cd test/integration/default/rspec % serverspec-init Select OS type: 1) UN*X 2) Windows Select number: 1 Select a backend type: 1) SSH 2) Exec (local) Select number: 2 + spec/ + spec/localhost/ + spec/localhost/httpd_spec.rb + spec/spec_helper.rb + Rakefile ä¸Šè¨˜ã®é€šã‚Š spec ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚\nntp_spec.rb ã‚’ä½œæˆ ä¸‹è¨˜ã®é€šã‚Š test/integration/default/rspec/spec/localhost/ntp_spec.rb ã‚’ä½œæˆã— ã¾ã™ã€‚\nrequire \u0026#39;spec_helper\u0026#39; describe package(\u0026#39;ntp\u0026#39;) do it { should be_installed } end describe service(\u0026#39;ntp\u0026#39;) do it { should be_enabled } it { should be_running } end describe port(123) do it { should be_listening } end describe file(\u0026#39;/etc/ntp.conf\u0026#39;) do it { should be_file } it { should contain \u0026#34;server 0.pool.ntp.org iburst\u0026#34; } end ãƒ†ã‚¹ãƒˆå†…å®¹ã®è§£èª¬ã¯\u0026hellip;\n\u0026rsquo;ntp\u0026rsquo; ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª \u0026rsquo;ntp\u0026rsquo; ã‚µãƒ¼ãƒ“ã‚¹ãŒå†èµ·å‹•æ™‚æœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãƒ»èµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª 123 ç•ªãƒãƒ¼ãƒˆã§ Listen ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª /etc/ntp.conf ã«ç‰¹å®šã®æ–‡å­—åˆ—ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ ä¸‹è¨˜ã®é€šã‚Šãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã€‚\n% cd $TEST-KITCHEN-ROOT % bundle exec kitchen create # \u0026lt;---- OpenStack ä¸Šã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ % bundle exec kitchen setup # \u0026lt;---- Chef Cookbooks ã®å®Ÿè¡Œ % bundle exec kitchen verify # \u0026lt;---- ãƒ†ã‚¹ãƒˆã®å®Ÿæ–½ ã¾ãŸã“ã‚Œã‚‰ã®æ“ä½œã¯ä¸‹è¨˜ã®ä¸€ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿæ–½å‡ºæ¥ã‚‹ã€‚\n% bundle exec kitchen test ãƒ†ã‚¹ãƒˆçµæœ busser-bats ä¸‹è¨˜ã®é€šã‚Š2ã¤ã®ãƒ†ã‚¹ãƒˆãŒå®Ÿæ–½ã•ã‚Œ \u0026lsquo;ok\u0026rsquo; ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå¸°ã£ã¦æ¥ãŸã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚\n-----\u0026gt; Running bats test suite 1..2 ok 1 ntp must be installed ok 2 ntp.conf must be exist serverspec ä¸‹è¨˜ã®é€šã‚Š 6 å€‹ã®ãƒ†ã‚¹ãƒˆå…¨ã¦ãŒé€šã‚Š failure 0 å€‹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚\n-----\u0026gt; Running rspec test suite [2013-10-17T02:27:19+00:00] INFO: Run List is [] [2013-10-17T02:27:19+00:00] INFO: Run List expands to [] Recipe: (chef-apply cookbook)::(chef-apply recipe) * execute[bundle install --local || bundle install] action run [2013-10-17T02:27:19+00:00] INFO: Processing execute[bundle install --local || bundle install] action run ((chef-apply cookbook)::(chef-apply recipe) line 42) Resolving dependencies... Using diff-lcs (1.2.4) Using highline (1.6.20) Using net-ssh (2.7.0) Using rspec-core (2.14.6) Using rspec-expectations (2.14.3) Using rspec-mocks (2.14.4) Using rspec (2.14.1) Using serverspec (0.10.6) Using bundler (1.3.5) Your bundle is complete! Use `bundle show [gemname]` to see where a bundled gem is installed. [2013-10-17T02:27:19+00:00] INFO: execute[bundle install --local || bundle install] ran successfully - execute bundle install --local || bundle install \u0026hellip;\u0026hellip;\nFinished in 0.0567 seconds 6 examples, 0 failures Finished verifying (0m7.44s).\nã¾ã¨ã‚ ----- busser-bats ã¯ã¾ã åœ°é“ãªãƒ†ã‚¹ãƒˆã®è¨˜è¿°ãŒå¿…è¦ã‚‰ã—ã„ã€‚ãã‚Œã«æ¯”ã¹ã¦ serverspec ã¯æ—¢ ã«å®Ÿç”¨çš„ã¨è¨€ãˆã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚ã©ã¡ã‚‰ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã‚‚ Cookbook ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸ ç’°å¢ƒã® *çŠ¶æ…‹* ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãƒ¢ãƒã§ã‚ã£ã¦ Cookbook, Recipe ã®ãƒ†ã‚¹ãƒˆã¨ã¯é•ã†ã€‚ã“ã‚Œ ã¯ã‚ã‚‹æ„å‘³éƒ½åˆãŒè‰¯ã„ã€‚Cookbooks ã®ãƒ†ã‚¹ãƒˆã¯ ChefSpec ç­‰ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã§ãƒ†ã‚¹ãƒˆã‚’ è¡Œã„ã€å®Œæˆã•ã‚ŒãŸ Cookbooks ã‚’å®Ÿéš›ã«è¤‡æ•°ã® OS ä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãƒ†ã‚¹ãƒˆã™ã‚‹ã®ãŒä»Š å›ç´¹ä»‹ã—ãŸãƒ¢ãƒã¨ãªã‚‹ã€‚ ","permalink":"https://jedipunkz.github.io/post/2013/10/20/test-kitchen-openstack-chef-cookbooks-test-2/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå‰å›ã€OpenStack ã¨ test-kitchen ã‚’ä½¿ã£ãŸç’°å¢ƒæ§‹ç¯‰æ–¹æ³•ã‚’æ›¸ãã¾ã—ãŸã€‚ä¸‹è¨˜ã®è¨˜äº‹ã§\nã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://jedipunkz.github.io/blog/2013/10/13/test-kitchn-openstack-chef-cookbooks-test/\"\u003ehttp://jedipunkz.github.io/blog/2013/10/13/test-kitchn-openstack-chef-cookbooks-test/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯å®Ÿéš›ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãæ–¹æ³•ã‚’è¨˜ã—ã¦ã„ãŸã„æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ä½¿ç”¨ã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã¯ä¸‹è¨˜ã®2ã¤ã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003erspec ã¨ serverspec\u003c/li\u003e\n\u003cli\u003ebusser-bats\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å‚è€ƒè³‡æ–™\"\u003eå‚è€ƒè³‡æ–™\u003c/h2\u003e\n\u003cp\u003eCreationline lab ã•ã‚“ã®è³‡æ–™ã‚’å‚è€ƒã«ã•ã›ã¦é ‚ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.creationline.com/lab/2933\"\u003ehttp://www.creationline.com/lab/2933\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"ç”¨æ„ã™ã‚‹ãƒ¢ãƒé”\"\u003eç”¨æ„ã™ã‚‹ãƒ¢ãƒé”\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eOpenStack ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ã‚¶ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰\u003c/li\u003e\n\u003cli\u003eKeystone ã® AUTH_URL\u003c/li\u003e\n\u003cli\u003eãƒ†ã‚¹ãƒˆã«ç”¨ã„ã‚‹ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã® Image ID\u003c/li\u003e\n\u003cli\u003eãƒ†ãƒŠãƒ³ãƒˆ ID\u003c/li\u003e\n\u003cli\u003enova ç®¡ç†ã®ã‚­ãƒ¼ãƒšã‚¢ã®ä½œæˆ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã“ã‚Œã‚‰ã¯ OpenStack ã‚’æ™®æ®µã‹ã‚‰åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹æ–¹ãªã‚‰é¦´æŸ“ã¿ã®ãƒ¢ãƒã‹ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"kitchenyml-ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ\"\u003e.kitchen.yml ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®é€šã‚Š .kitchen.yml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ test-kitchen ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä½œæˆã—ã¾\nã™ã€‚ä»Šå¾Œã®æ“ä½œã¯å…¨ã¦ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä½œæ¥­è¡Œã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u0026ldquo;\u0026lt;\u0026gt;\u0026rdquo; ã§æ‹¬ã£ãŸç®‡æ‰€ãŒç’°å¢ƒã«åˆã‚ã›ãŸè¨­å®šã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãŸã€ã“ã“ã§ã¯å‰å›åŒæ§˜ã« \u0026rsquo;ntp\u0026rsquo; ã® Cookbook ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹å‰æã§è¨˜ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e+++\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003edriver_plugin\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eopenstack\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003esuites\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e- \u003cspan style=\"color:#f92672\"\u003ename\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003edefault\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003erun_list\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  - \u003cspan style=\"color:#ae81ff\"\u003erecipe[ntp::default]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eattributes\u003c/span\u003e: {}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eplatforms\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e- \u003cspan style=\"color:#f92672\"\u003ename\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eubuntu-12.04\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003edriver_config\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eopenstack_username\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;openstack_username\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eopenstack_api_key\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;openstack_password\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eopenstack_auth_url\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ehttp://\u0026lt;openstack_ip_addr\u0026gt;:5000/v2.0/tokens\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage_ref\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;image_id\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eflavor_ref\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ekey_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;key_name\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eopenstack_tenant\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;tenant_name\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eusername\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;ssh_username\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eprivate_key_path\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;path_to_secretkey\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e- \u003cspan style=\"color:#f92672\"\u003ename\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ecentos-64\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003edriver_config\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eopenstack_username\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;openstack_username\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eopenstack_api_key\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;openstack_password\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eopenstack_auth_url\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ehttp://\u0026lt;openstack_ip_addr\u0026gt;:5000/v2.0/tokens\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage_ref\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;image_id\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eflavor_ref\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ekey_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;key_name\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eopenstack_tenant\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;tenant_name\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eusername\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;ssh_username\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eprivate_key_path\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;path_to_secretkey\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ebusser-bats ãƒ†ã‚¹ãƒˆ\n+++\u003c/p\u003e","title":"test-kitchen ã¨ OpenStack ã§ Chef Cookbooks ãƒ†ã‚¹ãƒˆ (å¾Œç¯‡)"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\ntest-kitchen + Vagrant ã‚’åˆ©ç”¨ã—ã¦è¤‡æ•°ç’°å¢ƒã§ Chef Cookbooks ã®ãƒ†ã‚¹ãƒˆã‚’è¡Œã†æ–¹æ³•ã¯ çµæ§‹çš†ã•ã‚“åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã¨æ€ã†ã®ã§ã™ãŒ Vagrant ã ã¨æ‰‹å…ƒã®ãƒã‚·ãƒ³ã«ä»®æƒ³ãƒã‚·ãƒ³ãŒ ãƒã‚·ãƒã‚·ç«‹ã¡ä¸Šã’ã‚‹ã®ã§åƒ•ã¯ã‚ã¾ã‚Šå¥½ãã§ã¯ãªã„ã§ã™ã€‚ãã“ã§ã€OpenStack ã®ã‚¤ãƒ³ã‚¹ã‚¿ ãƒ³ã‚¹ã‚’ãã®ä»£æ›¿ã§ä½¿ãˆã‚Œã°ã„ã„ãªãã¨çµæ§‹å‰ã‹ã‚‰æ€ã£ã¦ã„ãŸã®ã§ã™ãŒã€ä»Šå›ã†ã¾ãã„ã£ ãŸã®ã§ãã®æ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚\nç”¨æ„ã™ã‚‹ãƒ¢ãƒ OpenStack ç’°å¢ƒä¸€å¼ Chef ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ãã® ID test-kitchen ã‚’å®Ÿè¡Œã™ã‚‹ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ (ãŠæ‰‹æŒã¡ã® Macbook ç­‰) OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆã§ã™ãŒ Veewee ãªã©ã§è‡ªå‹•æ§‹ç¯‰ã§ãã¾ã™ã—ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã§ Chef ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã£ãŸå¾Œã«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆã—ã¦ãã‚Œã‚’åˆ©ç”¨ã—ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚\ntest-kitchen ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« test-kitchen ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚versoin 1.0.0 ã¯ã¾ã ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ãªã„ã® ã§ github ã‹ã‚‰ master ãƒ–ãƒ©ãƒ³ãƒã‚’å–å¾—ã—ã¦ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚ç›´è¿‘ã§ OpenStack ã«é–¢é€£ ã™ã‚‹ä¸å…·åˆã®ä¿®æ­£ç­‰ãŒå…¥ã£ã¦ã„ã‚‹ã®ã§ã“ã®æ–¹æ³•ã‚’å–ã‚Šã¾ã™ã€‚\n% git clone https://github.com/opscode/test-kitchen.git % cd test-kitchen % bundle install % rake build # \u0026lt;--- gem ã‚’ãƒ“ãƒ«ãƒ‰ % gen install ./pkg/test-kitchen-1.0.0.dev.gem ç¾æ™‚ç‚¹ (2013/10/13) ã§ berkshelf ã®åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¨è¡çªã‚’èµ·ã“ã™å•é¡Œ ãŒã‚ã‚‹ã®ã§ bundle ã§è§£æ±ºã—ã¾ã™ã€‚ä¸‹è¨˜ã®ã‚ˆã†ã« Gemfile ã« gem \u0026lsquo;kitchen-openstack\u0026rsquo; ã¨è¨˜è¿°ã—ã¾ã™ã€‚\nsource \u0026#39;https://rubygems.org\u0026#39; gemspec gem \u0026#39;kitchen-openstack\u0026#39; # \u0026lt;--- è¿½è¨˜ group :guard do gem \u0026#39;rb-inotify\u0026#39;, :require =\u0026gt; false gem \u0026#39;rb-fsevent\u0026#39;, :require =\u0026gt; false gem \u0026#39;rb-fchange\u0026#39;, :require =\u0026gt; false gem \u0026#39;guard-minitest\u0026#39;, \u0026#39;~\u0026gt; 1.3\u0026#39; gem \u0026#39;guard-cucumber\u0026#39;, \u0026#39;~\u0026gt; 1.4\u0026#39; end kitchen-openstack ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« kitchen-openstack ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ã“ã¡ã‚‰ã‚‚ gem ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ã—ã¾ã™ã€‚\n% git clone https://github.com/RoboticCheese/kitchen-openstack.git % cd kitchen-openstack % bundle insatll #\u0026lt;---- é–¢é€£ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« % rake build #\u0026lt;---- gem ã‚’ãƒ“ãƒ«ãƒ‰ % gem install ./pkg/kitchen-openstack-0.5.1.gem .kitchen.yml ã®ä½œæˆ .kitchen.yml ã‚’ç”¨æ„ã—ã¾ã™ã€‚test-kitchen ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã— .kitchen.yml ã‚’ ä¸‹è¨˜ã®ä¾‹ã«å¾“ã£ã¦ä½œæˆã—ã¾ã™ã€‚ä»Šå›ã¯ Ubuntu OS, CentOS ã«ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\n% cd /path/to/test-kitchen % ${EDITOR} .kitchen.yml +++ driver_plugin: openstack suites: - name: default run_list: - recipe[ntp::default] attributes: {} platforms: - name: ubuntu-12.04 driver_config: openstack_username: \u0026lt;openstac_username\u0026gt; openstack_api_key: \u0026lt;openstack_password\u0026gt; openstack_auth_url: http://\u0026lt;openstack_ip_addr\u0026gt;:5000/v2.0/tokens image_ref: \u0026lt;image_id\u0026gt; flavor_ref: 1 key_name: \u0026lt;key_name\u0026gt; openstack_tenant: service username: ubuntu private_key_path: \u0026lt;path_to_secretkey\u0026gt; - name: centos-64 driver_config: openstack_username: \u0026lt;openstac_username\u0026gt; openstack_api_key: \u0026lt;openstack_password\u0026gt; openstack_auth_url: http://\u0026lt;openstack_ip_addr\u0026gt;:5000/v2.0/tokens image_ref: \u0026lt;image_id\u0026gt; flavor_ref: 1 key_name: \u0026lt;key_name\u0026gt; openstack_tenant: service username: root private_key_path: \u0026lt;path_to_secretkey\u0026gt; ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚\nsuites: å®Ÿè¡Œã—ãŸã„ Chef Cookbooks ã®ãƒ¬ã‚·ãƒ”åã‚’æŒ‡å®šã—ã¾ã™ã€‚attriutes ãªã©ã‚’ã“ã“ã§ä¸Šæ›¸ã ã™ã‚‹ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚\nplatforms: ãƒ†ã‚¹ãƒˆã«ç”¨ã„ãŸã„ OS ã‚’åˆ—æŒ™ã—ã¦ã„ã‘ã¾ã™ã€‚ã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ Ubuntu, CentOS ã‚’è¨˜ã— ã¾ã—ãŸã€‚\nopenstack_username, openstack_api_key OpenStack ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã™ã€‚keystone ã§ä½œæˆã—ã¾ã™ã€‚\nopenstack_auth_url Keystone ã® URL ã§ã™ã€‚æœ€å¾Œã« /tokens ã¨ä»˜ã‘ã‚‹ã®ã‚’å¿˜ã‚Œãšã«ã€‚\nimage_ref ãã‚Œãã‚Œã® OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã® ID ã‚’è¨˜ã—ã¾ã™ã€‚å‰è¿°ã—ãŸã¨ãŠã‚Šã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ ãƒ³å¾Œã«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆã—ãã‚Œã‚’è¨˜ã™ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚\nflavor_ref Flavor ID ã‚’è¨˜ã—ã¾ã™ã€‚ã“ã“ã§ã¯ä¸€ç•ªå°ã•ã„ Flavor ã§ã‚ã‚‹ m1.tiny ã‚’è¨˜ã—ã¾ã—ãŸã€‚\nkey_name ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæ™‚ã«é¸æŠã™ã‚‹ Nova ã®ã‚­ãƒ¼ãƒšã‚¢åã§ã™ã€‚OpenStack ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ è¨€ã† \u0026ndash;key_name ã§ã™ã€‚\nopenstack_tenant ã©ã®ãƒ†ãƒŠãƒ³ãƒˆã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ã‹ï¼Ÿã‚’è¨˜ã—ã¾ã™ã€‚\nusername ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹éš›ã®ãƒ¦ãƒ¼ã‚¶åã‚’è¨˜ã—ã¾ã™ã€‚\nprivate_key_path ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ãŸã‚ã® SSH ç§˜å¯†éµã®ãƒ‘ã‚¹ã‚’è¨˜ã—ã¾ã™ã€‚ã“ã“ã§ã¯ãƒãƒ³ãƒ‘ã‚¹ ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³å‡ºæ¥ã‚‹ã‚ˆã†éµã‚’ç”Ÿæˆã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nCookbooks ã®é…ç½® ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã« \u0026lsquo;cookbooks\u0026rsquo; ã¨ã„ã†åå‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç”¨æ„ã— ãƒ†ã‚¹ãƒˆã§ç”¨ã„ãŸã„ Cookbooks ã‚’é…ç½®ã—ã¾ã™ã€‚Berkshelf ã‚’ç”¨ã„ã‚Œã°ç°¡å˜ã§ã™ã€‚ãŒã€ ç¾æ™‚ç‚¹ã§ Berkshelf ã®ç”¨ã„ã¦ã„ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ test-kitchen ã®ãã‚ŒãŒè¡çªã‚’èµ·ã“ã™ ã®ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«ã¯ Berkshelf ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€€é¿ã—ã¦ãã ã•ã„ã€‚\n% ${EDITOR} Berksfile site :opscode cookbook \u0026#39;ntp; % berks install --path=./cookbooks % mv Berksfile Berksfile.old ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ ã„ã‚ˆã„ã‚ˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ä¸Šè¨˜ã®ä¾‹ã§ã¯ Ubuntu OS, Debian OS ã«å¯¾ã—ã¦ ntp ã® Chef Cookbooks ã‚’å®Ÿéš›ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã¾ã™ã€‚\n% bundle exec kitchen test \u0026rsquo;test\u0026rsquo; ã‚’å¼•æ•°ã§æ¸¡ã™ã¨\nã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ Chef ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« Cookbooks ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ chef-solo ã®å®Ÿè¡Œ Cookbooks ä¸­ã« \u0026rsquo;test\u0026rsquo; ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã‚ã‚‹å ´åˆã¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ ã‚’è¡Œã£ã¦ãã‚Œã¾ã™ã€‚ãã‚Œãã‚Œåˆ¥ã€…ã«å®Ÿè¡Œã—ãŸã„å ´åˆã¯\n% bundle exec kitchen create # \u0026lt;---- ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆ % bundle exec kitchen setup # \u0026lt;---- chef ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨åˆå›ã® converge % bundle exec kitchen converge # \u0026lt;---- chef-solo ã‚’å†åº¦å®Ÿè¡Œ % bundle exec kitchen verify # \u0026lt;---- \u0026#39;test\u0026#39; ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å¾“ã„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ % bundle exec kitchen destroy # \u0026lt;---- ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‰Šé™¤ ã¨è¡Œãˆã°è‰¯ã„ã§ã™ã€‚converge, verify ã¯ä½•åº¦ã§ã‚‚ç¹°ã‚Šè¿”ã—å®Ÿè¡ŒãŒå¯èƒ½ã€‚\nã¾ã¨ã‚ å‰è¿°ã—ãŸã¨ãŠã‚Š Vagrant ã‚’ä½¿ã†ã¨æ‰‹å…ƒã®ãƒã‚·ãƒ³ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å¤§é‡ã«æ¶ˆè²»ã—ã¦ã—ã¾ã†ã® ã§ OpenStack ã‚’åˆ©ç”¨ã™ã‚‹ä¾¡å€¤ã¯çµæ§‹ã‚ã‚‹ã®ã‹ãªãã¨æ€ã£ã¦ã„ã¾ã™ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.0.0 ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹æ™‚æœŸã‚‚è¿‘ã„ã¨æ€ã†ã®ã§ä»Šã®ã†ã¡ã«çŸ¥ã£ã¦ãŠãã¨è‰¯ã„ã‹ã¨æ€ã„ã¾ã™ã€‚\nã¾ãŸã€ãƒ†ã‚¹ãƒˆã¨è¨€ã£ã¦ã‚‚ test-kitchen ã®å ´åˆ2ã¤ã®æ„å‘³ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚å®Ÿéš›ã« Cookbooks ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãƒ†ã‚¹ãƒˆã€ã¨ Cookbooks è‡ªä½“ã®ãƒ†ã‚¹ãƒˆã¨ ã„ã†æ„å‘³ã§ã™ã€‚å¾Œè€…ã«ã¤ã„ã¦ã¯ã¾ãŸå¾Œã»ã©è¨˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/10/13/test-kitchn-openstack-chef-cookbooks-test/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003etest-kitchen + Vagrant ã‚’åˆ©ç”¨ã—ã¦è¤‡æ•°ç’°å¢ƒã§ Chef Cookbooks ã®ãƒ†ã‚¹ãƒˆã‚’è¡Œã†æ–¹æ³•ã¯\nçµæ§‹çš†ã•ã‚“åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã¨æ€ã†ã®ã§ã™ãŒ Vagrant ã ã¨æ‰‹å…ƒã®ãƒã‚·ãƒ³ã«ä»®æƒ³ãƒã‚·ãƒ³ãŒ\nãƒã‚·ãƒã‚·ç«‹ã¡ä¸Šã’ã‚‹ã®ã§åƒ•ã¯ã‚ã¾ã‚Šå¥½ãã§ã¯ãªã„ã§ã™ã€‚ãã“ã§ã€OpenStack ã®ã‚¤ãƒ³ã‚¹ã‚¿\nãƒ³ã‚¹ã‚’ãã®ä»£æ›¿ã§ä½¿ãˆã‚Œã°ã„ã„ãªãã¨çµæ§‹å‰ã‹ã‚‰æ€ã£ã¦ã„ãŸã®ã§ã™ãŒã€ä»Šå›ã†ã¾ãã„ã£\nãŸã®ã§ãã®æ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ç”¨æ„ã™ã‚‹ãƒ¢ãƒ\"\u003eç”¨æ„ã™ã‚‹ãƒ¢ãƒ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eOpenStack ç’°å¢ƒä¸€å¼\u003c/li\u003e\n\u003cli\u003eChef ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ãã® ID\u003c/li\u003e\n\u003cli\u003etest-kitchen ã‚’å®Ÿè¡Œã™ã‚‹ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ (ãŠæ‰‹æŒã¡ã® Macbook ç­‰)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eOS ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆã§ã™ãŒ Veewee ãªã©ã§è‡ªå‹•æ§‹ç¯‰ã§ãã¾ã™ã—ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã§ Chef\nã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã£ãŸå¾Œã«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆã—ã¦ãã‚Œã‚’åˆ©ç”¨ã—ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚\u003c/p\u003e\n\u003ch2 id=\"test-kitchen-ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003etest-kitchen ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003etest-kitchen ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚versoin 1.0.0 ã¯ã¾ã ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ãªã„ã®\nã§ github ã‹ã‚‰ master ãƒ–ãƒ©ãƒ³ãƒã‚’å–å¾—ã—ã¦ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚ç›´è¿‘ã§ OpenStack ã«é–¢é€£\nã™ã‚‹ä¸å…·åˆã®ä¿®æ­£ç­‰ãŒå…¥ã£ã¦ã„ã‚‹ã®ã§ã“ã®æ–¹æ³•ã‚’å–ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% git clone https://github.com/opscode/test-kitchen.git\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% cd test-kitchen\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% bundle install\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% rake build \u003cspan style=\"color:#75715e\"\u003e# \u0026lt;--- gem ã‚’ãƒ“ãƒ«ãƒ‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% gen install ./pkg/test-kitchen-1.0.0.dev.gem\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¾æ™‚ç‚¹ (2013/10/13) ã§ berkshelf ã®åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¨è¡çªã‚’èµ·ã“ã™å•é¡Œ\nãŒã‚ã‚‹ã®ã§ bundle ã§è§£æ±ºã—ã¾ã™ã€‚ä¸‹è¨˜ã®ã‚ˆã†ã« Gemfile ã« gem\n\u0026lsquo;kitchen-openstack\u0026rsquo; ã¨è¨˜è¿°ã—ã¾ã™ã€‚\u003c/p\u003e","title":"test-kitchen ã¨ OpenStack ã§ Chef Cookbooks ãƒ†ã‚¹ãƒˆ(å‰ç¯‡)"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nGlusterFS ã‚’ã¡ã‚‡ã£ã¨å‰ã«èª¿ã¹ã¦ã¾ã—ãŸã€‚ä½•æ•…ã‹ã¨è¨€ã†ã¨ OpenStack Havana ãŒã‚‚ã†ã™ ããƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ã®ã§ã™ãŒã€Havana ã‹ã‚‰ GlusterFS ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹äºˆå®šã ã‹ã‚‰ã§ã™ã€‚\nã“ã®è¾ºã‚Šã«è‰²ã€…æƒ…å ±ãŒè¼‰ã£ã¦ã„ã¾ã™ã€‚\nhttp://www.gluster.org/category/openstack/\nãã®å‰ã« GlusterFS ã‚’æ§‹ç¯‰å‡ºæ¥ãªã„ã¨ã„ã‘ãªã„ã®ã§ã€ä»Šå›ã¯ãã®æ–¹æ³•ã‚’æ›¸ã„ã¦ã„ãã¾ ã™ã€‚å„ã‚¯ãƒ©ã‚¹ã‚¿ã‚¿ã‚¤ãƒ—æ¯ã«ç‰¹å¾´ã‚„æ§‹ç¯‰æ–¹æ³•ãŒç•°ãªã‚‹ã®ã§ãã®è¾ºã‚Šã‚’é‡ç‚¹çš„ã«ã€‚\nç’°å¢ƒ Ubuntu Server 12.04.3 LTS PPA ãƒ¬ãƒã‚¸ãƒˆãƒªåˆ©ç”¨ /dev/sdb ã‚’ OS é ˜åŸŸã¨ã¯åˆ¥ã® disk ã¨ã—ã¦ã‚µãƒ¼ãƒã«è¿½åŠ ã™ã‚‹ ç”¨ã„ã‚‹ PPA ãƒ¬ãƒã‚¸ãƒˆãƒª Ubuntu 12.04.3 LTS ã® GlusterFS ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 3.2 ã§ã™ã€‚3.4 ç³»ãŒä»Šå›ä½¿ã„ãŸã‹ã£ ãŸã®ã§ä¸‹è¨˜ã® PPA ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’åˆ©ç”¨ã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚ã¡ã‚ƒã‚“ã¨æ§‹ç¯‰ã™ã‚‹ãªã‚‰è‡ªåˆ†ã§ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚’ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã™ã€‚\nhttps://launchpad.net/~semiosis/+archive/ubuntu-glusterfs-3.4\næº–å‚™ ã“ã“ã‹ã‚‰ã®æ‰‹é †ã¯å…¨ã¦ã®ã‚µãƒ¼ãƒã§æ“ä½œã—ã¾ã™ã€‚\nãƒ¬ãƒã‚¸ãƒˆãƒªã®åˆ©ç”¨æ–¹æ³• % sudo aptitude install python-software-properties % sudo add-apt-repository ppa:semiosis/ubuntu-glusterfs-3.4 % sudo apt-get update GlusterFS3.4 ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« % sudo apt-get install glusterfs-server gluserfs-client xfsprogs ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« glusterfs ã¯ xfs ã‚’æ‰±ã†ãŸã‚ xfsprogs ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚\n% sudo apt-get install xfsprogs ãƒ‡ã‚£ã‚¹ã‚¯ã®æº–å‚™ % sudo mkfs.xfs -i size=512 /dev/sdb % sudo mkdir -p /export/brick1 % sudo vim /etc/fstab /dev/sdb /export/brick1 xfs defaults 1 2 # \u0026lt;- è¿½è¨˜ % sudo mount -a % mount å„ã‚¯ãƒ©ã‚¹ã‚¿ã‚¿ã‚¤ãƒ—ã§ã®ãƒã‚¦ãƒ³ãƒˆæ–¹æ³• ã“ã“ã‹ã‚‰ã®æ‰‹é †ã¯ã©ã“ã‹ä¸€å°ã®ãƒãƒ¼ãƒ‰ã§è¡Œãˆã° OK ã§ã™ã€‚\ndistributed ã‚¿ã‚¤ãƒ— ã¾ãšã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ãªã‚‹ distributed ã®ãƒã‚¦ãƒ³ãƒˆæ–¹æ³•ã€‚\n% sudo gluster peer probe \u0026lt;other_node_ip_addr\u0026gt; ... % sudo gluster volume create gv0 \u0026lt;mine_ip_addr\u0026gt;:/export/brick1/sdb \u0026lt;another_node_ip_addr\u0026gt;:/export/brick1/sdb % sudo gluster volume start gv0 % sudo gluster volume info Volume Name: gv0 Type: Distribute Volume ID: 803fdd46-4735-444a-99c8-83d1cee172e6 Status: Started Number of Bricks: 2 Transport-type: tcp Bricks: Brick1: \u0026lt;mine_ip_addr\u0026gt;:/export/brick1/sdb Brick2: \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb ãƒã‚¦ãƒ³ãƒˆè¡Œã†ã€‚ã©ã¡ã‚‰ã®ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦è¡Œã†ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚\n% sudo mount -t glusterfs \u0026lt;mine_ip_addr\u0026gt;:/gv0 /mnt ãã®ä»–ã®ã‚¯ãƒ©ã‚¹ã‚¿ã‚¿ã‚¤ãƒ—ã®ãƒã‚¦ãƒ³ãƒˆæ–¹æ³• replicated ã®å ´åˆ\u0026hellip;\n% sudo gluster volume create gv0 replica 2 \u0026lt;mine_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_node_ip_addr\u0026gt;:/export/brick1/sdb striped ã®å ´åˆ\u0026hellip;\n% sudo gluster volume create gv0 stripe 2 \u0026lt;mine_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_node_ip_addr\u0026gt;:/export/brick1/sdb distributed replicated ã®å ´åˆ\u0026hellip;\n% sudo gluster volume create dist-repl replica 2 \\ \u0026lt;mine_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb striped replicated ã®å ´åˆ\u0026hellip;\n% sudo gluster volume create strip-repl stripe 2 replica 2 \\ \u0026lt;mine_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb distributed striped replicated ã®å ´åˆ\u0026hellip;\n% sudo gluster volume create dist-strip-repl stripe 2 replica 2 \\ \u0026lt;mine_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb \\ \u0026lt;other_ip_addr\u0026gt;:/export/brick1/sdb å„ã‚¯ãƒ©ã‚¹ã‚¿ã‚¿ã‚¤ãƒ—ã®ç‰¹å¾´ distributed 1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ GlusterFS ä¸Šã«ä¿ç®¡ã™ã‚‹ã¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ã§ã©ã‚Œã‹ã®ãƒãƒ¼ãƒ‰ã« å¯¾ã—ã¦ä¿ç®¡ã™ã‚‹ã€‚ã‚ˆã£ã¦ \u0026lsquo;ãƒãƒ¼ãƒ‰ä¸Šã® disk x ãƒãƒ¼ãƒ‰æ•°\u0026rsquo; ãŒåˆè¨ˆå®¹é‡ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒ å‡ºæ¥ã‚‹ã€‚ãƒãƒ¼ãƒ‰éšœå®³ã®å ´åˆã«ã¯ãã®è©²å½“ãƒãƒ¼ãƒ‰ä¸Šã® disk ã«ä¿ç®¡ã•ã‚Œã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ ãƒˆã®èª­ã¿æ›¸ãã¯ NG ã€‚ãã®ä»–ã®ãƒãƒ¼ãƒ‰ä¸Š disk ã«ä¿ç®¡ã•ã‚Œã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ ã¯èª­ã¿æ›¸ããŒæ­£å¸¸ã«è¡Œãˆã‚‹ã€‚\nstripe 1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯å˜ä½ã§åˆ†å‰²ã—å„ãƒãƒ¼ãƒ‰ã«ä¿ç®¡ã™ã‚‹ã€‚æ‰±ãˆã‚‹åˆè¨ˆå®¹é‡ã¯ distributed ã¨åŒã˜ã \u0026lsquo;ãƒãƒ¼ãƒ‰ä¸Šã® disk x ãƒãƒ¼ãƒ‰æ•°\u0026rsquo; ã¨ãªã‚‹ã€‚éšœå®³ãŒã©ã“ã‹ã®ãƒãƒ¼ãƒ‰ ã§ç™ºç”Ÿã—ãŸå ´åˆã€å…¨ã¦ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®èª­ã¿æ›¸ããŒè¡Œãˆãªããªã‚‹ã€‚\nreplicated 1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ 2 å°ã®ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦ãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ã‚’è¡Œã„ä¿ç®¡ã™ã‚‹ã€‚éšœå®³ç³»ã®å¯¾ å¿œãŒå¯èƒ½ã«ãªã‚‹ã€‚ãã®åˆ†ã€æ‰±ãˆã‚‹åˆè¨ˆå®¹é‡ã¯ distrubuted/stripe ã«æ¯”ã¹åŠåˆ†ã¨ãªã‚‹ã€‚\ndistributed replicated æ§‹æˆã‚¤ãƒ¡ãƒ¼ã‚¸å›³\u0026hellip;\n+--------+ | client | +--------+ | +---------------------+ | | +----------+ +----------+ | | | | +--------+ +--------+ +--------+ +--------+ | node1 | | node2 | | node3 | | node4 | +--------+ +--------+ +--------+ +--------+ node1, 2 ã¨ 3, 4 ã«ã¦ replicated ã—ãã‚Œãã‚Œã«å¯¾ã—ã¦ distributed ã‚’çµ„ã‚€ã€‚æ‰±ãˆã‚‹ disk å®¹é‡ã¯ node ã®æŒã£ã¦ã„ã‚‹ disk å®¹é‡ x ãƒãƒ¼ãƒ‰æ•° / 2 ã¨ãªã‚‹ã€‚distributed ã¯ å®Ÿè³ªã€éšœå®³ç³»ã®å¯¾å¿œãŒè‰¯ããªã„ã®ã§ distributed ã‚’æ‰±ã†ã®ã§ã‚ã‚Œã°ã€ã“ã® volume type ãŒæ¨å¥¨ã•ã‚Œã‚‹ã‚‚ã®ã¨æ€ã‚ã‚Œã‚‹ã€‚\nstriped replicated distributed replicated ã¨åŒç­‰ã®æ§‹æˆã ãŒãƒ–ãƒ­ãƒƒã‚¯å˜ä½ã§ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¿ç®¡ã¨ãª ã‚‹ã€‚\nã¾ã¨ã‚ GlusterFS ã«ã¯ä¸€è²«æ€§ã®å•é¡Œ (disk å®¹é‡ã®ä¸€è²«æ€§ã‚’ä¿ã¤å¿…è¦ãŒã‚ã‚‹) ã¨æ€ã£ã¦ã„ãŸãŒã€ æ˜”ã®è©±ã—ã‚‰ã—ã„ã€‚å®¹é‡ã®ã“ã¨ãªã‚‹ disk ã‚’ãƒãƒ¼ãƒ‰ã«è¿½åŠ ã—ã¦ã‚‚ã€ãã‚Œã‚’ã†ã¾ãåˆè¨ˆå®¹é‡ ã«åˆç®—ã•ã‚Œã‚‹ã®ã‚’ç¢ºèªã—ãŸã€‚ã¾ãŸåˆ†æ•£ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®ç¾å‘³ã—ã„ã¨ã“ã‚ã¨å†—é•·æ€§ã‚’å…¼ ã­ãŸæ§‹æˆã‚’çµ„ã‚€ã®ãŒè‰¯ã„ã¨æ€ã†ã®ã§ distributed replicated ã‚‚ã—ãã¯ striped replicated ã‚’é¸æŠã™ã‚‹ã®ãŒã‚ªã‚¹ã‚¹ãƒ¡ã€‚ä»Šå›ã¯ TCP ã§æ‰±ã£ãŸãŒãƒãƒ¼ã‚¸ãƒ§ãƒ³ 3.4 ã‹ã‚‰ã¯ Infiniband ã¨çµ„ã¿åˆã‚ã›ã¦ RDMA ã‚’æ‰±ã†ã“ã¨ãŒå¯èƒ½ã€‚ä¸‹è¨˜ã® URL ãŒå‚è€ƒã«ãªã‚‹ã€‚\nhttp://gluster.org/community/documentation/index.php/Gluster_3.2:_Configuring_GlusterFS_to_work_over_InfiniBand\n","permalink":"https://jedipunkz.github.io/post/2013/10/12/glusterfs-install/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eGlusterFS ã‚’ã¡ã‚‡ã£ã¨å‰ã«èª¿ã¹ã¦ã¾ã—ãŸã€‚ä½•æ•…ã‹ã¨è¨€ã†ã¨ OpenStack Havana ãŒã‚‚ã†ã™\nããƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ã®ã§ã™ãŒã€Havana ã‹ã‚‰ GlusterFS ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹äºˆå®šã ã‹ã‚‰ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã“ã®è¾ºã‚Šã«è‰²ã€…æƒ…å ±ãŒè¼‰ã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.gluster.org/category/openstack/\"\u003ehttp://www.gluster.org/category/openstack/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eãã®å‰ã« GlusterFS ã‚’æ§‹ç¯‰å‡ºæ¥ãªã„ã¨ã„ã‘ãªã„ã®ã§ã€ä»Šå›ã¯ãã®æ–¹æ³•ã‚’æ›¸ã„ã¦ã„ãã¾\nã™ã€‚å„ã‚¯ãƒ©ã‚¹ã‚¿ã‚¿ã‚¤ãƒ—æ¯ã«ç‰¹å¾´ã‚„æ§‹ç¯‰æ–¹æ³•ãŒç•°ãªã‚‹ã®ã§ãã®è¾ºã‚Šã‚’é‡ç‚¹çš„ã«ã€‚\u003c/p\u003e\n\u003ch2 id=\"ç’°å¢ƒ\"\u003eç’°å¢ƒ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eUbuntu Server 12.04.3 LTS\u003c/li\u003e\n\u003cli\u003ePPA ãƒ¬ãƒã‚¸ãƒˆãƒªåˆ©ç”¨\u003c/li\u003e\n\u003cli\u003e/dev/sdb ã‚’ OS é ˜åŸŸã¨ã¯åˆ¥ã® disk ã¨ã—ã¦ã‚µãƒ¼ãƒã«è¿½åŠ ã™ã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ç”¨ã„ã‚‹-ppa-ãƒ¬ãƒã‚¸ãƒˆãƒª\"\u003eç”¨ã„ã‚‹ PPA ãƒ¬ãƒã‚¸ãƒˆãƒª\u003c/h2\u003e\n\u003cp\u003eUbuntu 12.04.3 LTS ã® GlusterFS ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 3.2 ã§ã™ã€‚3.4 ç³»ãŒä»Šå›ä½¿ã„ãŸã‹ã£\nãŸã®ã§ä¸‹è¨˜ã® PPA ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’åˆ©ç”¨ã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚ã¡ã‚ƒã‚“ã¨æ§‹ç¯‰ã™ã‚‹ãªã‚‰è‡ªåˆ†ã§\nãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚’ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://launchpad.net/~semiosis/\u0026#43;archive/ubuntu-glusterfs-3.4\"\u003ehttps://launchpad.net/~semiosis/+archive/ubuntu-glusterfs-3.4\u003c/a\u003e\u003c/p\u003e\n\u003ch1 id=\"æº–å‚™\"\u003eæº–å‚™\u003c/h1\u003e\n\u003cp\u003eã“ã“ã‹ã‚‰ã®æ‰‹é †ã¯å…¨ã¦ã®ã‚µãƒ¼ãƒã§æ“ä½œã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ãƒ¬ãƒã‚¸ãƒˆãƒªã®åˆ©ç”¨æ–¹æ³•\"\u003eãƒ¬ãƒã‚¸ãƒˆãƒªã®åˆ©ç”¨æ–¹æ³•\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo aptitude install python-software-properties\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo add-apt-repository ppa:semiosis/ubuntu-glusterfs-3.4\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo apt-get update\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"glusterfs34-ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003eGlusterFS3.4 ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo apt-get install glusterfs-server gluserfs-client\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"xfsprogs-ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003exfsprogs ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003eglusterfs ã¯ xfs ã‚’æ‰±ã†ãŸã‚ xfsprogs ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚\u003c/p\u003e","title":"GlusterFS ã®å„ã‚¯ãƒ©ã‚¹ã‚¿ã‚¿ã‚¤ãƒ—æ§‹ç¯‰"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nMesos ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦2ã¤ã‚ã®è¨˜äº‹ã§ã™ã€‚\nhttp://jedipunkz.github.io/blog/2013/09/28/mesos-architecture-number-1/\nä¸Šè¨˜ã®å‰å›ã®è¨˜äº‹ã§ Mesos è‡ªä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦è§¦ã‚Œã¾ã—ãŸãŒã€ä»Šå›ã¯ Mesos + Marathon + Docker ã®æ§‹æˆã«ã¤ã„ã¦ç†è§£ã—ãŸã“ã¨ã‚’æ›¸ã„ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚\nmesos ã‚¯ãƒ©ã‚¹ã‚¿ã¯ å¹¾ã¤ã‹ã® mesos masters ã¨æ²¢å±±ã® mesos slaves ã‹ã‚‰æˆã£ã¦ãŠã‚Šã€ mesos slaves ã®ä¸Šã§ã¯ docker ã‚’æ“ä½œã™ã‚‹ executor ãŒç¨¼åƒã—ã¦ã„ã‚‹ã€‚marathon ã¯ mesos master ã®ä¸Šã§ç¨¼åƒã™ã‚‹ mesos framework ã§ã‚ã‚‹ã€‚init ã‚„ upstart ã®æ§˜ãªå­˜åœ¨ ã§ã‚ã‚‹ã“ã¨ãŒè¨€ãˆã€REST API ã‚’æŒã¡ container ã®å‹•ä½œã‚’åˆ¶å¾¡ã™ã‚‹ã€‚marathon ã«ã¯ ruby ã® client ç­‰ã‚‚å­˜åœ¨ã™ã‚‹ã€‚ä¸‹è¨˜ãŒãã‚Œã€‚\nhttps://github.com/mesosphere/marathon_client\næ§‹æˆ +-----------------+ | docker registry | index.docker.io (ã‚‚ã—ãã¯ local registry) +-----------------+ | +----------------+ | | +--------------+ +--------------+ | mesos master | | mesos master | +--------------+ +--------------+ | | |----------------+-----------------------------------| +--------------+ +--------------+ +--------------+ | mesos slave | | mesos slave | ... | mesos slave | +--------------+ +--------------+ +--------------+ | | | +--------------+ +--------------+ +--------------+ | mesos slave | | mesos slave | ... | mesos slave | +--------------+ +--------------+ +--------------+ . . . . . . . . . +--------------+ +--------------+ +--------------+ | mesos slave | | mesos slave | ... | mesos slave | +--------------+ +--------------+ +--------------+ ã‚ªãƒ•ã‚¡ã‹ã‚‰ docker ãŒç¨¼åƒã™ã‚‹ã¾ã§ã®æµã‚Œ ä¸Šè¨˜ã®æ§‹æˆã®å›³ã‚’è¦‹ãªãŒã‚‰ç†è§£ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚\nHTTP API ã‚‚ã—ãã¯ web UI ã§ marathon ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã‚‹ marathon ã¯ãƒªã‚½ãƒ¼ã‚¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã‚ªãƒ•ã‚¡ãŒå—ã‘ä»˜ã‘ã‚‰ã‚Œã‚‹ã®ã‚’å¾…ã¤ ã‚ªãƒ•ã‚¡ãŒå—ã‘ä»˜ã‘ã‚‰ã‚ŒãŸå¾Œã€mesos master ã¯ slave ã« task ã®ä»•æ§˜ã‚’é€ä¿¡ã™ã‚‹ slave ã§ã¯ docker ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ mesos docker ã‚’ mesos slave ãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒå‘¼ã³å‡ºã™ docker ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã® docker ãƒ‡ãƒ¼ãƒ¢ãƒ³ã¨ image cache, lxc ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã‚Šé€šä¿¡ã™ã‚‹ ã‚‚ã— image cache ãŒå­˜åœ¨ã™ã‚Œã°ãã‚Œã‚’ã€ç„¡ã‘ã‚Œã° docker registry ã‹ã‚‰ pull ã™ã‚‹ã€‚ ãã®æ™‚ã€index.docker.io ã®ä»£ã‚ã‚Šã«ãƒ­ãƒ¼ã‚«ãƒ«ã® docker registry ã‚’ç¨¼åƒã•ã›ã‚‹ã“ã¨ã‚‚å¯èƒ½ docker ãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒ container ã‚’ç¨¼åƒã•ã›ã‚‹ marathon ã®ã‚¯ãƒ©ã‚¹ã‚¿ã¨ã—ã¦ã®å‹•ä½œ marathon ã¯ init ã‚„ upstart ã®ã‚ˆã†ãªãƒ¢ãƒã ã¨ä¸Šè¨˜ã§èª¬æ˜ã—ã¾ã—ãŸãŒã€å›³ã‚’äº¤ãˆã¦èª¬æ˜ã—ã¦ ã„ãã¾ã—ã‚‡ã†ã€‚\nmarathon ãŒ \u0026lsquo;serarch service\u0026rsquo; ã¨ \u0026lsquo;docker\u0026rsquo; ã‚’ç¨¼åƒã•ã›ã¦ã„ã‚‹çŠ¶æ…‹ã ã¨ã™ã‚‹ã€‚\n+----------+ +----------+ +----------+ | | | | | | | |search| | | |docker| | | |docker| | +----------+ +----------+ +----------+ +----------+ +----------+ +----------+ | | | | | | | |search| | | |docker| | | |docker| | +----------+ +----------+ +----------+ +----------+ +----------+ +----------+ | | | | | | | |search| | | |docker| | | |docker| | +----------+ +----------+ +----------+ ã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ³ã«ã‚ˆã‚Šã‚ªãƒ•ã‚¡ãŒç«‹ã¦è¾¼ã‚“ã§ãã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã« docker ã‚’ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ ãƒˆãŒç™ºç”Ÿã™ã‚‹ã€‚\n+----------+ +----------+ +----------+ | |docker| | | |docker| | | | | |search| | | |docker| | | |docker| | +----------+ +----------+ +----------+ +----------+ +----------+ +----------+ | | | |docker | | |docker| | | |search| | | |docker| | | |docker| | +----------+ +----------+ +----------+ +----------+ +----------+ +----------+ | |docker| | | |docker| | | |docker| | | |search| | | |docker| | | |docker| | +----------+ +----------+ +----------+ ã‚·ã‚¹ãƒ†ãƒ ã«ç•°å¸¸ãŒã‚ã‚Šãƒãƒ¼ãƒ‰ãŒè½ã¡ãŸå ´åˆã€ä¸‹è¨˜ã®ã‚ˆã†ã« marathon ã¯ serach service ã¨ docker ã‚’ãƒãƒ¼ãƒ‰é–“ã§ç§»å‹•ã•ã›ã‚‹å‡¦ç½®ã‚’è¡Œã†ã€‚\n+----------+ +----------+ | |docker| | | |search| | | |docker| | | |docker| | +----------+ +----------+ +----------+ +----------+ +----------+ | |docker| | |docker| | | |docker| | | |search| | | |docker| | | |docker| | +----------+ +----------+ +----------+ +----------+ +----------+ +----------+ | |docker| | | |docker| | | |docker| | | |search| | | |docker| | | |docker| | +----------+ +----------+ +----------+ ã¾ã¨ã‚ mesos ã¨ docker, marathon ã®é–¢ä¿‚ã«ã¤ã„ã¦è¨˜ã—ã¦ã„ãã¾ã—ãŸã€‚ä»Šåº¦ã€å®Ÿéš›ã«ã“ã®æ§‹æˆ ã‚’çµ„ã‚“ã§ã¿ã¦éšœå®³ç³»ã®ãƒ†ã‚¹ãƒˆã—ã¦ã¿ãŸã„ã§ã™ã€‚ã‚ã¨ã¯ framework ã«ã¤ã„ã¦ç†è§£ã—ã¦ã„ ãå¿…è¦ãŒã‚ã‚Šãã†ã€‚ã‚ã¨ã¯ chronos ã«ã¤ã„ã¦ã‚‚ã€‚chronos ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ã® URL ãŒå…¬ å¼ã‚‰ã—ã„ã€‚ã“ã‚Œã¯ cron ä»£æ›¿ãªä»•çµ„ã¿ã‚‰ã—ã„ã§ã™ã€‚\nhttps://github.com/airbnb/chronos\nã¾ã ã¾ã ç†è§£ã§ãã¦ã„ãªã„ã“ã¨ã ã‚‰ã‘ã \u0026hellip;ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/10/01/methos-architecture-number-2-docker-on-mesos/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eMesos ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦2ã¤ã‚ã®è¨˜äº‹ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://jedipunkz.github.io/blog/2013/09/28/mesos-architecture-number-1/\"\u003ehttp://jedipunkz.github.io/blog/2013/09/28/mesos-architecture-number-1/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eä¸Šè¨˜ã®å‰å›ã®è¨˜äº‹ã§ Mesos è‡ªä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦è§¦ã‚Œã¾ã—ãŸãŒã€ä»Šå›ã¯\nMesos + Marathon + Docker ã®æ§‹æˆã«ã¤ã„ã¦ç†è§£ã—ãŸã“ã¨ã‚’æ›¸ã„ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003emesos ã‚¯ãƒ©ã‚¹ã‚¿ã¯ å¹¾ã¤ã‹ã® mesos masters ã¨æ²¢å±±ã® mesos slaves ã‹ã‚‰æˆã£ã¦ãŠã‚Šã€\nmesos slaves ã®ä¸Šã§ã¯ docker ã‚’æ“ä½œã™ã‚‹ executor ãŒç¨¼åƒã—ã¦ã„ã‚‹ã€‚marathon ã¯\nmesos master ã®ä¸Šã§ç¨¼åƒã™ã‚‹ mesos framework ã§ã‚ã‚‹ã€‚init ã‚„ upstart ã®æ§˜ãªå­˜åœ¨\nã§ã‚ã‚‹ã“ã¨ãŒè¨€ãˆã€REST API ã‚’æŒã¡ container ã®å‹•ä½œã‚’åˆ¶å¾¡ã™ã‚‹ã€‚marathon ã«ã¯\nruby ã® client ç­‰ã‚‚å­˜åœ¨ã™ã‚‹ã€‚ä¸‹è¨˜ãŒãã‚Œã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/mesosphere/marathon_client\"\u003ehttps://github.com/mesosphere/marathon_client\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h2\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+-----------------+\n| docker registry | index.docker.io (ã‚‚ã—ãã¯ local registry)\n+-----------------+\n|\n+----------------+\n|                |\n+--------------+ +--------------+\n| mesos master | | mesos master |\n+--------------+ +--------------+\n|                |\n|----------------+-----------------------------------|\n\n+--------------+ +--------------+     +--------------+\n| mesos slave  | | mesos slave  | ... | mesos slave  | \n+--------------+ +--------------+     +--------------+\n|                |                    |\n+--------------+ +--------------+     +--------------+\n| mesos slave  | | mesos slave  | ... | mesos slave  | \n+--------------+ +--------------+     +--------------+\n.                .                    .\n.                .                    .\n.                .                    .\n+--------------+ +--------------+     +--------------+\n| mesos slave  | | mesos slave  | ... | mesos slave  |\n+--------------+ +--------------+     +--------------+\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"ã‚ªãƒ•ã‚¡ã‹ã‚‰-docker-ãŒç¨¼åƒã™ã‚‹ã¾ã§ã®æµã‚Œ\"\u003eã‚ªãƒ•ã‚¡ã‹ã‚‰ docker ãŒç¨¼åƒã™ã‚‹ã¾ã§ã®æµã‚Œ\u003c/h2\u003e\n\u003cp\u003eä¸Šè¨˜ã®æ§‹æˆã®å›³ã‚’è¦‹ãªãŒã‚‰ç†è§£ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚\u003c/p\u003e","title":"Methos ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ #2 (Docker on Mesos)"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nDevOps Day Tokyo 2013 ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚ãŸãã•ã‚“ã®åˆºæ¿€ã‚’å—ã‘ãŸã®ã§ãƒ¬ãƒãƒ¼ãƒˆæ›¸ ã„ã¦ãŠãã¾ã™ã€‚\né–‹å‚¬æ—¥ : 2013å¹´09æœˆ28æ—¥ å ´æ‰€ : æ±äº¬å…­æœ¬æœ¨ãƒŸãƒƒãƒ‰ã‚¿ã‚¦ãƒ³ Yahoo! Japan ã•ã¾ URL : http://www.devopsdays.org/events/2013-tokyo/ Making Operation Visible Nick Galbreath (@ngalbreath) ã•ã‚“ DevOps ã®æ‹ ç‚¹ Etsy ã«åŠªã‚ãŸçµŒç·¯ã®ã‚ã‚‹ DevOps ãƒªãƒ¼ãƒ€ Galbreath ã•ã‚“ã€‚DevOps ã® æ¦‚ç•¥ã‹ã‚‰ä½•ãŒå¿…è¦ã§ã‚ã‚Šã©ã†è¡Œå‹•ã«èµ·ã“ã›ã°ã‚ˆã„ã‹èª¬æ˜ã—ã¦ãã ã•ã„ã¾ã—ãŸã€‚\nMaking operations visible - devopsdays tokyo 2013 from Nick Galbreath ã“ã¡ã‚‰ã€Galbreath ã•ã‚“ã®å½“æ—¥ã®è³‡æ–™ã€‚\nDevOps ãŒå®Ÿè¡Œå‡ºæ¥ãªã„ç†ç”± Tool ãŒè¶³ã‚Šãªã„ ç¤¾é¢¨ã®å½±éŸ¿ è¦‹ãˆãªã„ãƒ¢ãƒãŒä¾¡å€¤ãŒãªã„ã¨äº‹æ¥­ã‹ã‚‰è€ƒãˆã‚‰ã‚Œã¦ã„ã‚‹ å‡ºæ¥ã‚‹äº‹ã¯ã€ä¾¡å€¤ãŒã‚ã‚‹ãƒ¢ãƒã®ç¤¾å†…ã¸ã®èª¬æ˜ã¨ã€Tool ã‚’ä½¿ã£ãŸå¯è¦–åŒ–ã€‚ãƒ‡ãƒ¼ã‚¿ã®å¯è¦– åŒ–ãŒé‡è¦ã€‚Ops ã®äººã¯çµæ§‹ã€Œãƒ‡ãƒ¼ã‚¿ã‚’ã©ã“ãã“ã®éƒ¨ç½²ã«è¦‹ã›ã¦ã‚‚ç†è§£ã—ã¦ã‚‚ã‚‰ãˆãªã„ã€ ã ã¨ã‹ã€Œãƒ‡ãƒ¼ã‚¿ã‚’é–²è¦§ã•ã›ã‚‹ã¨ä¸‡ãŒä¸€ã®æ™‚ã«ã‚·ã‚¹ãƒ†ãƒ ãŒç ´æã™ã‚‹ã€ç­‰ã¨è€ƒãˆãŒã¡ã€‚ãŒã€ ãƒ“ã‚¸ãƒã‚¹å¯„ã‚Šã®äººã«ã¨ã£ã¦é‡è¦ãªã‚°ãƒ©ãƒ•ãŒå«ã¾ã‚Œã¦ã„ãŸã‚Šã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ‹…å½“ã®äººã«å½¹ç«‹ ã¤ã‚‚ã®ã‚‚å«ã¾ã‚Œã¦ã„ã‚‹ã€‚ã¾ã—ã¦ã‚·ã‚¹ãƒ†ãƒ ãŒç ´æã™ã‚‹ã“ã¨ãªã©æ±ºã—ã¦ç„¡ã„ã€‚\né‡è¦ãªã®ã¯ \u0026ldquo;é‹ç”¨ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å…¬é–‹ã™ã‚‹\u0026rdquo; ã“ã¨ï¼\nGraphite ã‚°ãƒ©ãƒ•æç”»ãƒ„ãƒ¼ãƒ« ã¾ãšå®Œæˆåº¦ãŒé«˜ã„ã‚ã‘ã§ã¯ãªã„ åŒé¡ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã¯è¡Œãˆãªã„ã‚¯ã‚¨ãƒªãŒç™ºè¡Œå‡ºæ¥ã‚‹ REST API Flexible Input \u0026amp; Output Simple UI \u0026amp; Dashboard 3rd Party Custom Client Side Dashboard ã‚ã‚Š URL å‹ãªã®ã§ Dashboard é–‹ç™ºãŒæ¥½ã¡ã‚“ ç¨¼åƒã•ã›ã‚‹ãŸã‚ã®ç‰©ç†ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ã¯çµæ§‹å¿…è¦ apt-get install graphite ã§ãã‚‹ã‚ˆ statd UDP ä½¿ã£ã¦ã‚‹ Event Data ã‚’ Application ã‹ã‚‰ statd ã¸ ä¸‹è¨˜ã¯ä¾‹ã€‚ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’é€ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã¯ã“ã‚Œã ã‘ã€‚\nStatD::increment('logins') å›½åˆ¥ã«ã‚‚å‡ºæ¥ã‚‹ã€‚\nStatD::increment('logins'); $kuni = geoip2country($ipv4); StatD::increment('logins.$kuni') å¾Œã« DataDog ã®æ–¹ã‹ã‚‰è©³ã—ãèª¬æ˜ãŒã‚ã‚‹ã€‚\nSensu Sean Porter ã•ã‚“ ãƒ¡ãƒ¢ã¨ã‚Šã«ãã„ãƒ—ãƒ¬ã‚¼ãƒ³ã ã£ãŸã®ã§æ€ã„å‡ºã—ãªãŒã‚‰\u0026hellip;.\nSensu ã¯ Nagios ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç­‰ãŒãã®ã¾ã¾å†åˆ©ç”¨ã§ãã‚‹ç›£è¦–ãƒ„ãƒ¼ãƒ«ã€‚API ã‚’ä»‹ã—ã¦ã‚¢ ãƒ©ãƒ¼ãƒˆã®å…·åˆã‚„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒªã‚¹ãƒˆãƒ»ç›£è¦–é …ç›®ã®ãƒªã‚¹ãƒˆç­‰ãŒå–å¾—ã§ãã¾ã™ã€‚Nagios ã‚’ä½¿ã£ãŸå ´åˆã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒ¼ãƒ‰ã®è¿½åŠ ã®ãŸã³ã«ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã—ãªã ã¦ã¯ãªã‚‰ãªã‹ã£ãŸã‚Šä¸ä¾¿ã ã£ãŸã®ãŒ Sensu ã‚’é–‹ç™ºã—ã‚ˆã†ã¨ã—ãŸå‹•æ©Ÿã ã¨ã‹ã€‚Chef ã¨ã® è¦ªå’Œæ€§ãŒé«˜ãã€Chef Cookbook ã®å…¬é–‹ã‚‚ã—ã¦ã„ã‚‹ã€‚ç§ã‚‚å®Ÿéš›ã«ä½¿ã£ã¦ã„ã¾ã™ãŒã€\nSensu ã‚µãƒ¼ãƒã®æ§‹ç¯‰ ç›£è¦–é …ç›®ã®è¿½åŠ  ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒ¼ãƒ‰ã¸ã®ã‚¢ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¿½åŠ  ç­‰ã¯ã™ã¹ã¦ Chef ã® Knife ã‚³ãƒãƒ³ãƒ‰ã§å‡ºæ¥ã¾ã™ã€‚ç‰¹ã« Chef ã‹ã‚‰ã®å½±éŸ¿ã ã¨æ€ã‚ã‚Œã‚‹ ãŒ Omnibus å½¢å¼ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ ãƒ«ã¯ç°¡å˜ã§ã™ã€‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¸­ã«å‹•ä½œã«å¿…è¦ãª Ruby ä¸€å¼ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\nãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ä¸‹è¨˜ã®ã¨ã“ã‚ã«ã‚ã‚Šã¾ã™ã€‚\nhttp://docs.sensuapp.org/0.10/index.html\npuppet max martin for next level +++\nPuppet 3.x Hiera integration PuppetDB Mcollective 2.x Geppetto : IDE Puppet Forge : web site Puppet ãŒæä¾›ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚„ã‚µãƒ¼ãƒ“ã‚¹é”ã€‚DevOps ã®æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸ã®å¿…è¦ãªæŠ€è¡“ è¦ç´ ã€‚\npuppet 3.x pupput2 ã«æ¯”è¼ƒã—ã¦ speedup x 3 agents/server : 100% up ã“ã‚Œã‚‰ã¯ç†è«–å€¤ã§ã¯ãªãå®ŸåŠ¹å€¤ï¼ Puppet2 ã¨æ¯”è¼ƒã—ã¦ã‹ãªã‚Šã®æ€§èƒ½ã‚¢ãƒƒãƒ—ã‚‰ã—ã„ã€‚å‡¦ç†é€Ÿåº¦3å€ã¯å®ŸåŠ¹å€¤ã ãã†ã§ã™ã€‚\npuppet3.0 = hiera functions + data bindings hiera : hierarchical key value store with pluggable backend (json, yaml..) keep site specific data out of puppet code parameter values are now automatically looked up in hiera data bind ã§ã‚³ãƒ¼ãƒ‰ãŒã‚·ãƒ³ãƒ—ãƒ«ã« : include ntp -\u0026gt; yaml, json.. json ã‚„ yaml ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨˜è¿°å‡ºæ¥ã‚‹ã®ã§ã‚³ãƒ¼ãƒ‰ãŒã‚·ãƒ³ãƒ—ãƒ«ã§ç¶ºéº—ã«ãªã‚‹ã‚ˆã€ã¨ã® ã“ã¨ã€‚Chef ã§ã„ã† Attributes ã ã¨æ€ã‚ã‚Œã‚‹ã€‚\npuppetdb puppet ãƒ‡ãƒ¼ã‚¿ã™ã¹ã¦ã‚’æ ¼ç´ (facts, catalogs, reports,..) replaces existing library is much faster and more faster postgreSQL, Clojure, JVM -\u0026gt; JAR ãƒ•ã‚¡ã‚¤ãƒ«ã§å±•é–‹ ã‚¯ã‚¨ãƒªã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’è‡ªã‚‰å®šç¾©å¯èƒ½ API ãŒã‚·ãƒ³ãƒ—ãƒ«ãªã®ã§ dashboard ãªã©ã®é–‹ç™ºã‚‚ç°¡å˜ PostgreSQL ãŒæœ€è¿‘ã‚ã¡ã‚‰ã®å›½ã§ã¯ã‚¤ã‚±ã¦ã‚‹ã£ã¦ã„ã†è©±ã¯ã‚ˆãèã„ã¦ã„ãŸã‘ã© Puppet3 ã¯ PostgreSQL, Clojur, JVM ã®çµ„ã¿åˆã‚ã›ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã‚‰ã—ã„ã€‚Chef ã‚‚ Erlang ã«ç½®ãæ›ã‚ã£ãŸã‚ãŸã‚Šã‚’è¦‹ã¦ã®åå¿œã‹ãªãï¼Ÿã¨æƒ³åƒã€‚\nMCollective orchestration engine ruby ã‚’ä½¿ã£ã¦ç‹¬è‡ªã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–‹ç™ºå¯èƒ½ mco rpc service restart service=httpd \u0026ndash;nodes=hosts.txt # query a file mco rpc service restart service=httpd -W country=uk -dm=puppetdb # discover mco rpc rpcutil ping -I example.com # direct addressing ruby ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦åˆ©ç”¨å¯èƒ½ query a file ã®ã‚µãƒ³ãƒ—ãƒ«\nc = rpcclient(\u0026quot;service\u0026quot;) c.discover :nodes =\u0026gt; File.readline(\u0026quot;host.txt\u0026quot;).map {|i| i.chomp} printrpc c.restart(:service =\u0026gt; \u0026quot;httpd\u0026quot;) ã“ã‚Œã¯ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã€‚ãƒ›ã‚¹ãƒˆåã®è¨˜è¿°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€ãã‚Œã‚‰ã®ãƒ› ã‚¹ãƒˆã«å¯¾ã—ã¦ä¸€æ–‰ã«æŒ‡ç¤ºã‚’é€ã£ãŸã‚Šæ¤œç´¢ã‚’è¡Œã£ãŸã‚Šã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡ŒãŒå‡ºæ¥ã‚‹ã€‚ã“ã‚Œã¯ Ruby ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦å†åˆ©ç”¨å‡ºæ¥ã‚‹ã‚‰ã—ã„ã€‚ã“ã‚Œã¯ä¾¿åˆ©ã€‚\nGeppetto IDE for developing puppet modules and code git \u0026amp; svn Linux, Mac OSX, Windows Linux, Mac, Windows ç”¨ã® IDE ã¾ã§æä¾›ã—ã¦ã‚‹ã‚“ã§ã™ã­ã€‚é©šãã€‚Puppet ã‚‚ã®ã™ã”ã„å‹¢ ã„ã€‚\nPuppet Forge module repository 1,500+ modules puppet module install foo/foo module ã®ãŸã‚ã®ãƒãƒ¼ãƒ ãŒå†…éƒ¨ã«ã‚ã‚‹ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ä½œã£ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å…¬é–‹ã—ã¦ã„ã‚‹ãƒ¬ãƒã‚¸ãƒˆãƒª WEB ã‚µãƒ¼ãƒ“ã‚¹ã€‚1,500 ä»¥ ä¸Šã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‚‰ã—ã„ã€‚ã“ã®ãŸã‚ã®ãƒãƒ¼ãƒ ã‚‚ Puppet ç¤¾å†…ã«ã„ã‚‹ã¨ã‹ã€‚\nè¿·ã£ãŸã‚‰å¥å…¨ãªæ–¹ã‚’ Cookpad Naruta Issei ã•ã‚“ å°è±¡çš„ãªãƒ—ãƒ¬ã‚¼ãƒ³ã§ã—ãŸã€‚\nç¾å®Ÿã«èµ·ã“ã£ãŸå•é¡Œã‚’åˆ‡ã‚Šå£ã« Devops ã«ã¤ã„ã¦èªã£ã¦ã„ã¾ã—ãŸã€‚ãƒªãƒªãƒ¼ã‚¹æ—¥å½“æ—¥ Ops ãŒã€Œä»Šæ—¥ãƒªãƒªãƒ¼ã‚¹ã ã¨åˆã‚ã¦çŸ¥ã‚‹ã€ã¨ã„ã†äº‹ä»¶ã€‚ç¹°ã‚Šè¿”ã•ãªã„ãŸã‚ã«ã©ã†ã™ã‚‹ã‹ï¼Ÿ\nãƒªãƒªãƒ¼ã‚¹æ—¥ã®æ±ºå®šã« Ops ã®æ‰¿èªãŒå¿…è¦ãªãƒ«ãƒ¼ãƒ«ã«ã™ã‚‹ï¼Ÿ Ops ã€Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒ fix ã—ã¦ã‹ã‚‰ãƒªãƒªãƒ¼ã‚¹æ—¥ã¾ã§3å–¶æ¥­æ—¥å¿…è¦ï¼Ÿã€ ã“ã®ã‚ˆã†ãªãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚ŠãŒã¡ã ã‘ã©ã€ã“ã‚Œã§ã¯ Ops ãŒæ¨©å¨ã«ãªã£ã¦ã—ã¾ã†ã€‚Ops ã®ç«‹ å ´ã‹ã‚‰ã—ã¦ã“ã®ã€Œæ¨©å¨ã€ã«ãªã‚Šã‚„ã™ã„ã¨ã„ã†ç‰¹å¾´ãŒã‚ã‚‹ãŒã€Ops ã¯ãã†æŒ¯ã‚‹èˆã£ã¦ã¯ã„ ã‘ãªã„ï¼ã¨ã„ã†è©±ã€‚DevOps ã«å¿…è¦ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å›é¿å‡ºæ¥ã‚‹ã¨ã€‚DevOps ã§ã‚ ã‚‹é™ã‚Šä»•äº‹ã¯æ¥½ã—ããªãã¦ã¯ãªã‚‰ãªã„ã€‚æ‰¿èªã‚’å–ã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãƒ»æ”¿æ²»ãŒç™ºç”Ÿã™ã‚‹ã®ã‚‚ã“ ã‚Œã¾ãŸå•é¡Œã€‚\nCookpad ã¯ã“ã‚Œã‹ã‚‰ã‚‚ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã“ã†ã„ã£ãŸå•é¡Œã‚’ã‚¯ãƒªã‚¢ã—ã¦ã„ãï¼ã¨å®£è¨€ ãŒã‚ã‚Šã¾ã—ãŸã€‚æœ€å¾Œã¯è‹¥å¹² Ops é¿é›£ã®ã‚ˆã†ãªãƒ—ãƒ¬ã‚¼ãƒ³ã‚’ Ops ã®å‰ã§ã™ã‚‹ã‹ã®ã‚ˆã†ãªçŠ¶ æ³ã« Issei ã•ã‚“ã‚‚å£°ã‚’éœ‡ã‚ã›ãªãŒã‚‰ã®ãƒ—ãƒ¬ã‚¼ãƒ³ã§ã—ãŸãŒã€é€†ã«ãã‚ŒãŒåƒ•ã«ã¯éŸ¿ãã¾ã— ãŸã€‚ã¼ãã‚‚ Ops å‡ºèº«ã ã—ã€ã“ã†ã„ã£ãŸå•é¡Œã¯å«Œã«ãªã‚‹ç¨‹è¦‹ã¦ãã¦ã„ã‚‹ã®ã§ã€ã“ã®è¨´ãˆ ã‹ã‘ã¯ã‚¬ãƒ„ãƒ³ã¨ããŸã€‚ãƒ—ãƒ¬ã‚¼ãƒ³æœ€é«˜ã§ã—ãŸï¼\nDataDog Alexis LÃª-QuÃ´c ã•ã‚“ ç›£è¦–ãƒ„ãƒ¼ãƒ«ã«ã¨ã£ã¦ã®é‡è¦ãªè¦ç´ \nTimely Correct Comprehensive (åŒ…æ‹¬çš„) ã“ã‚Œã‚‰ã‚’æº€ãŸã›ãªã‘ã‚Œã°å…¨ãç„¡é§„ã€‚\nå‰ææ¡ä»¶ã‚’å…ƒã«ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’æ±ºã‚ã¦ã„ã‚‹ -\u0026gt; ä¸å®Œå…¨ãªãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒå¤šã„ -\u0026gt; æœ€ä½é™ã®æ¡ä»¶ã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«è¦ç´ ã‚’è¿½åŠ ã§ãã‚‹ã“ã¨ãŒé‡è¦ã ã¨è€ƒãˆã‚‹ statd types gauges counters histgrams timers sets å‚è€ƒè³‡æ–™ statd ã¨ graphite ã®é€£æº\nhttps://github.com/etsy/statsd/blob/master/docs/graphite.md\nã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä¸€è¦§\nhttps://github.com/etsy/statsd/blob/master/docs/backend.md\nã¾ã¨ã‚ ã¨ã¦ã‚‚æœ‰æ„ç¾©ã ã£ãŸã€‚ä¸¸ä¸€æ—¥ã€æœ€å¾Œã¾ã§èã„ã¦ã„ã‚‹ã®ã‚‚è¾›ã‹ã£ãŸã‘ã©ã€é‹å–¶ã•ã‚Œã¦ã„ã‚‹ å´ã®æ–¹ã€…ã¯ã‚‚ã£ã¨å¤§å¤‰ã ã£ãŸã§ã—ã‚‡ã†ã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚æ—¥æœ¬ã§ã¯ãªã‹ãªã‹è©± ã‚’èã‘ãªã„ã‚ã¡ã‚ƒãƒ›ãƒƒãƒˆãªæ–¹ã€…ã®è©±ã‚’ç›´ã«èã‘ã‚‹ãªã‚“ã¦ç„¡ã„ã®ã§ãƒ›ãƒ³ãƒˆè²´é‡ã§ã—ãŸã€‚ã¾ ãŸãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã«ã¯å‚åŠ å‡ºæ¥ãªã‹ã£ãŸã‘ã©ã€ä¹…ã—ã¶ã‚Šã«ä¼šãˆãŸæ–¹ãŒã„ã¦ã‚ã¡ã‚ƒè‰¯ã‹ã£ ãŸã§ã™ã€‚åŒã˜æ–¹å‘å‘ã„ã¦ã„ã‚‹æ–¹ã€…ãŒã“ã‚Œã ã‘ç¤¾å¤–ã«ã¯å±…ã‚‹ã‚“ã ã¨ã„ã†æ°—ä»˜ãã‚‚ã‚ã£ãŸã‚Šã€‚\nçš†ã•ã‚“ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼\n","permalink":"https://jedipunkz.github.io/post/2013/09/29/devops-day-tokyo-2013-report/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eDevOps Day Tokyo 2013 ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚ãŸãã•ã‚“ã®åˆºæ¿€ã‚’å—ã‘ãŸã®ã§ãƒ¬ãƒãƒ¼ãƒˆæ›¸\nã„ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eé–‹å‚¬æ—¥ : 2013å¹´09æœˆ28æ—¥\nå ´æ‰€   : æ±äº¬å…­æœ¬æœ¨ãƒŸãƒƒãƒ‰ã‚¿ã‚¦ãƒ³ Yahoo! Japan ã•ã¾\nURL    : http://www.devopsdays.org/events/2013-tokyo/\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1 id=\"making-operation-visible\"\u003eMaking Operation Visible\u003c/h1\u003e\n\u003cpre\u003e\u003ccode\u003eNick Galbreath (@ngalbreath) ã•ã‚“\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDevOps ã®æ‹ ç‚¹ Etsy ã«åŠªã‚ãŸçµŒç·¯ã®ã‚ã‚‹ DevOps ãƒªãƒ¼ãƒ€ Galbreath ã•ã‚“ã€‚DevOps ã®\næ¦‚ç•¥ã‹ã‚‰ä½•ãŒå¿…è¦ã§ã‚ã‚Šã©ã†è¡Œå‹•ã«èµ·ã“ã›ã°ã‚ˆã„ã‹èª¬æ˜ã—ã¦ãã ã•ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ciframe src=\"http://www.slideshare.net/slideshow/embed_code/26632342\"\nwidth=\"427\" height=\"356\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\"\nscrolling=\"no\" style=\"border:1px solid #CCC;border-width:1px 1px\n0;margin-bottom:5px\" allowfullscreen\u003e \u003c/iframe\u003e \u003cdiv\nstyle=\"margin-bottom:5px\"\u003e \u003cstrong\u003e \u003ca\nhref=\"https://www.slideshare.net/nickgsuperstar/making-operations-visible-dev-opsdays-tokyo-2013key\"\ntitle=\"Making operations visible - devopsdays tokyo 2013\"\ntarget=\"_blank\"\u003eMaking operations visible - devopsdays tokyo 2013\u003c/a\u003e\n\u003c/strong\u003e from \u003cstrong\u003e\u003ca href=\"http://www.slideshare.net/nickgsuperstar\"\ntarget=\"_blank\"\u003eNick Galbreath\u003c/a\u003e\u003c/strong\u003e \u003c/div\u003e\n\u003cp\u003eã“ã¡ã‚‰ã€Galbreath ã•ã‚“ã®å½“æ—¥ã®è³‡æ–™ã€‚\u003c/p\u003e\n\u003ch2 id=\"devops-ãŒå®Ÿè¡Œå‡ºæ¥ãªã„ç†ç”±\"\u003eDevOps ãŒå®Ÿè¡Œå‡ºæ¥ãªã„ç†ç”±\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eTool ãŒè¶³ã‚Šãªã„\u003c/li\u003e\n\u003cli\u003eç¤¾é¢¨ã®å½±éŸ¿\u003c/li\u003e\n\u003cli\u003eè¦‹ãˆãªã„ãƒ¢ãƒãŒä¾¡å€¤ãŒãªã„ã¨äº‹æ¥­ã‹ã‚‰è€ƒãˆã‚‰ã‚Œã¦ã„ã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå‡ºæ¥ã‚‹äº‹ã¯ã€ä¾¡å€¤ãŒã‚ã‚‹ãƒ¢ãƒã®ç¤¾å†…ã¸ã®èª¬æ˜ã¨ã€Tool ã‚’ä½¿ã£ãŸå¯è¦–åŒ–ã€‚ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–\nåŒ–ãŒé‡è¦ã€‚Ops ã®äººã¯çµæ§‹ã€Œãƒ‡ãƒ¼ã‚¿ã‚’ã©ã“ãã“ã®éƒ¨ç½²ã«è¦‹ã›ã¦ã‚‚ç†è§£ã—ã¦ã‚‚ã‚‰ãˆãªã„ã€\nã ã¨ã‹ã€Œãƒ‡ãƒ¼ã‚¿ã‚’é–²è¦§ã•ã›ã‚‹ã¨ä¸‡ãŒä¸€ã®æ™‚ã«ã‚·ã‚¹ãƒ†ãƒ ãŒç ´æã™ã‚‹ã€ç­‰ã¨è€ƒãˆãŒã¡ã€‚ãŒã€\nãƒ“ã‚¸ãƒã‚¹å¯„ã‚Šã®äººã«ã¨ã£ã¦é‡è¦ãªã‚°ãƒ©ãƒ•ãŒå«ã¾ã‚Œã¦ã„ãŸã‚Šã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ‹…å½“ã®äººã«å½¹ç«‹\nã¤ã‚‚ã®ã‚‚å«ã¾ã‚Œã¦ã„ã‚‹ã€‚ã¾ã—ã¦ã‚·ã‚¹ãƒ†ãƒ ãŒç ´æã™ã‚‹ã“ã¨ãªã©æ±ºã—ã¦ç„¡ã„ã€‚\u003c/p\u003e","title":"DevOps Day Tokyo 2013 å‚åŠ ãƒ¬ãƒãƒ¼ãƒˆ"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šå›ã¯ã‚¯ãƒ©ã‚¹ã‚¿ãƒãƒãƒ¼ã‚¸ãƒ£ã§ã‚ã‚‹ Mesos ã«ã¤ã„ã¦æ›¸ã“ã†ã¨æ€ã„ã¾ã™ã€‚\nMesos ã¯ Apache Software Foundation ã«ã‚ˆã£ã¦ç®¡ç†ã•ã‚Œã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§åˆ†æ•£ã‚¢ãƒ—ãƒª ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒ©ã‚¹ã‚¿åŒ–ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ãƒãƒãƒ¼ã‚¸ãƒ£ã§ã™ã€‚Twitter ãŒæ¡ç”¨ã—ã¦ã„ã‚‹ã“ ã¨ã§æœ‰åã ãã†ã§ã€é–‹ç™ºã«ã‚‚ç©æ¥µçš„ã«å‚åŠ ã—ã¦ã„ã‚‹ãã†ã§ã™ã€‚\nhttp://mesos.apache.org/\n@riywo ã•ã‚“ãŒæ—¢ã« Mesos + Marathon + Zookeper + Docker ãªæ§‹æˆã‚’çµ„ã‚€æ‰‹é †ã‚’ãƒ–ãƒ­ ã‚°ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã®ã§æ˜¯éè©¦ã—ã¦ã¿ã‚‹ã¨é¢ç™½ã„ã¨æ€ã„ã¾ã™ã€‚\nhttp://tech.riywo.com/blog/2013/09/27/mesos-introduction-1/\nç§ã¯ç†è§£ã—ãŸ Mesos ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦å°‘ã—æ›¸ã„ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\nå…¨ä½“ã®æ§‹é€  +-----------+ | zookeeper | | quorum | +-----------+ | +----------------+----------------+ | | | +--------------+ +--------------+ +--------------+ | mesos-master | | mesos-master | | mesos-master | | active | | hot standby | | hot standby | +--------------+ +--------------+ +--------------+ ... | +----------------+----------------+ | | | +--------------+ +--------------+ +--------------+ | mesos-slave | | mesos-slave | | mesos-slave | | executor | | executor | | executor | | +----++----+ | | +----++----+ | | +----++----+ | | |task||task| | | |task||task| | | |task||task| | | +----++----+ | | +----++----+ | | +----++----+ | +--------------+ +--------------+ +--------------+ ... åŸºæœ¬çš„ã« few masters + many slaves ã®æ§‹æˆã§ã™ã€‚task ã¯ slaves ã®ä¸Šã§èµ°ã‚Šã¾ã™ã€‚ master ã¯ã‚ªãƒ•ã‚¡ãƒ¼ã«ã‚ˆã‚Šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³(ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯)ã«å¯¾ã—ã¦ CPU, ãƒ¡ãƒ¢ãƒªã® ãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚·ã‚§ã‚¢å‡ºæ¥ã¾ã™ã€‚ãƒªã‚½ãƒ¼ã‚¹ã¯ slave ID, resource1: amount1, resource2, amount2, \u0026hellip; ã¨ã„ã£ãŸé…åˆ—ã‚’å«ã¿ã¾ã™ã€‚master ã¯ãƒãƒªã‚·ã«å¾“ã„ãã‚Œãã‚Œ ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«å¯¾ã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ã©ã‚Œã ã‘æä¾›ã™ã‚‹ã‹æ±ºå®šã—ã¾ã™ã€‚ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å½¢å¼ ã§æ§˜ã€…ãªãƒãƒªã‚·ã‚’å–ã‚Šè¾¼ã‚€ä»•çµ„ã¿ã«ãªã£ã¦ã„ã¾ã™ã€‚\nmesos ã¯ zookeeper ã«ã‚ˆã‚Š HA ã‚’çµ„ã‚€ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚1ã¤ã® active master ã¨è¤‡æ•° (ã‚‚ã—ãã¯1ã¤ã®) stand-by master(s) ã®æ§‹æˆã§ã™ã€‚active ã‚’æŠ•ç¥¨ã™ã‚‹ãŸã‚ zookeeper ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒç”¨ã„ã‚‰ã‚Œã¾ã™ã€‚\nmesos-master ã‚’èµ·å‹•ã™ã‚‹éš›ã«ä¸‹è¨˜ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã¨multi masters ã®æ§‹æˆãŒçµ„ã‚ ã¾ã™ã€‚\n--zk=zk://host1:port1/path,host2:port2/path,... ãã‚Œã«å¯¾ã—ã¦ multi slaves ã«å¯¾ã—ã¦ã¯ä¸‹è¨˜ã®ãƒ‘ãƒ©ãƒ¼ã‚¿ã‚’æ¸¡ã—ã¾ã™ã€‚\n--master=zk://host1:port1/path,host2:port2/path,... ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®åˆ†æ–­ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®åˆ†æ–­ã«ã‚ˆã‚Šæ§˜ã€…ãªäº‹è±¡ãŒç™ºç”Ÿã—ã¾ã™ã€‚å¹¾ã¤ã‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹å‹•ãã«ã¤ ã„ã¦è¦‹ã¦ã„ãã¾ã™ã€‚\nslave ãŒ master ã¨åˆ†æ–­ã•ã‚ŒãŸå ´åˆ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•—ã€‚master ã¯ slave ã®ã“ã¨ã‚’ \u0026lsquo;deactivated\u0026rsquo; ã¨åˆ¤æ–­ã—ãã® slave ã«åˆ†é…ã—ãŸ task ã‚’ LOST ã¨ã—ã¾ã™ã€‚\nmaster ã«å†æ¥ç¶šå‡ºæ¥ãªã„å ´åˆ \u0026lsquo;deactivated\u0026rsquo; ã¨ãªã£ãŸ slave ãŒ master ã«å†æ¥ç¶šå‡ºæ¥ãªã„å ´åˆã€ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã® æŒ‡ç¤ºãŒé€ã‚‰ã‚Œã‚‹\nslave ãŒ zookeeper ã¨åˆ†æ–­ã•ã‚ŒãŸå ´åˆ master ãŒã„ãªã„çŠ¶æ…‹ã¨ãªã‚Šã€å†ã³ master ã®æŠ•ç¥¨ãŒè¡Œã‚ã‚Œ active master ãŒç¾ã‚Œã‚‹ã¾ ã§ master ã‹ã‚‰ã®æŒ‡ç¤ºã‚’æ‹’å¦ã™ã‚‹\nãƒªã‚½ãƒ¼ã‚¹ã®ã‚ªãƒ•ã‚¡ +-------------------+ | framework | | +----+----+ | | |job1|job2| | | +----+----+ | | scheduler | +-------------------+ ~(2) |(3) | ~ +-------------------+ | mesos-master | | allocation module | +-------------------+ ~(1) |(4) | ~ +-------------------+ | mesos-slave | | executor | | +----+----+ | | |task|task| | | +----+----+ | +-------------------+ ãƒªã‚½ãƒ¼ã‚¹ã®ã‚ªãƒ•ã‚¡ã®æµã‚Œã«ã¤ã„ã¦ã€‚\n(1) mesos-slave ãŒç©ºãã® CPU, Mem ã®çŠ¶æ³(4cpus,4g mem)ã‚’ mesos-mater ã«ä¼ãˆã‚‹ã€‚ (2) mesos-master ã¯ãã®ãƒªã‚½ãƒ¼ã‚¹ç©ºãçŠ¶æ³ã‚’ framework ã«å¯¾ã—ã¦ä¼ãˆã‚‹ (3) framework ã® scheduler ã¯ mesos-mater ã«å¯¾ã—ã¦ mesos-slave ã®ä¸Šã§å‹•ã‹ã™ã¹ ã2å€‹ã®ã‚¿ã‚¹ã‚¯ã«ã¤ã„ã¦ä¼ãˆã‚‹ã€‚1å€‹ã‚ã¯ 2cpus, 1g memã€‚2å€‹ã‚ã¯ 1cpus, 2g memã¨ã€‚ (4) master ã¯ task ã‚’ slave ã«å¯¾ã—ã¦ä¼ãˆã‚‹ã€‚çµæœ 1cpu, 1gb mem ãŒã‚¢ãƒ­ã‚±ãƒ¼ãƒˆã• ã‚Œãªã„çŠ¶æ³ã ãŒã€ãã‚Œã«ã¤ã„ã¦ã¯åˆ¥ã® framework ã«å¯¾ã—ã¦ã‚¢ãƒ­ã‚±ãƒ¼ãƒˆã™ã‚‹ã“ã¨ã¨ãª ã‚‹ã€‚ ã¾ã¨ã‚ ã“ã®ã‚¯ãƒ©ã‚¹ã‚¿è‡ªä½“ãŒ1ã¤ã® OS ã‹ã®ã‚ˆã†ãªå‹•ãã‚’å–ã‚‹ã“ã¨ãŒè¦‹ã¦å–ã‚Œã¾ã™ã€‚Mesos ã®ä¸Š ã§ Hadoop, Spark ãªã©ã‚’ç¨¼åƒã•ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ãã†ã§ã™ãŒã€æ¬¡å›ã€ç§ã¯ docker ã‚’å‹• ã‹ã—ã¦ã¿ãŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚\nhttp://mesosphere.io/2013/09/26/docker-on-mesos/\nã“ã“ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚\né§†ã‘è¶³ã§ã—ãŸãŒã€ä»¥ä¸Šã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/09/28/mesos-architecture-number-1/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ã‚¯ãƒ©ã‚¹ã‚¿ãƒãƒãƒ¼ã‚¸ãƒ£ã§ã‚ã‚‹ Mesos ã«ã¤ã„ã¦æ›¸ã“ã†ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eMesos ã¯ Apache Software Foundation ã«ã‚ˆã£ã¦ç®¡ç†ã•ã‚Œã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§åˆ†æ•£ã‚¢ãƒ—ãƒª\nã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒ©ã‚¹ã‚¿åŒ–ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ãƒãƒãƒ¼ã‚¸ãƒ£ã§ã™ã€‚Twitter ãŒæ¡ç”¨ã—ã¦ã„ã‚‹ã“\nã¨ã§æœ‰åã ãã†ã§ã€é–‹ç™ºã«ã‚‚ç©æ¥µçš„ã«å‚åŠ ã—ã¦ã„ã‚‹ãã†ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://mesos.apache.org/\"\u003ehttp://mesos.apache.org/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e@riywo ã•ã‚“ãŒæ—¢ã« Mesos + Marathon + Zookeper + Docker ãªæ§‹æˆã‚’çµ„ã‚€æ‰‹é †ã‚’ãƒ–ãƒ­\nã‚°ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã®ã§æ˜¯éè©¦ã—ã¦ã¿ã‚‹ã¨é¢ç™½ã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://tech.riywo.com/blog/2013/09/27/mesos-introduction-1/\"\u003ehttp://tech.riywo.com/blog/2013/09/27/mesos-introduction-1/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eç§ã¯ç†è§£ã—ãŸ Mesos ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦å°‘ã—æ›¸ã„ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å…¨ä½“ã®æ§‹é€ \"\u003eå…¨ä½“ã®æ§‹é€ \u003c/h2\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+-----------+\n| zookeeper |\n|  quorum   |\n+-----------+\n|\n+----------------+----------------+\n|                |                |\n+--------------+ +--------------+ +--------------+\n| mesos-master | | mesos-master | | mesos-master |\n|    active    | |  hot standby | |  hot standby |\n+--------------+ +--------------+ +--------------+ ...\n|\n+----------------+----------------+\n|                |                |\n+--------------+ +--------------+ +--------------+\n|  mesos-slave | |  mesos-slave | |  mesos-slave |\n|   executor   | |   executor   | |   executor   |\n| +----++----+ | | +----++----+ | | +----++----+ |\n| |task||task| | | |task||task| | | |task||task| |\n| +----++----+ | | +----++----+ | | +----++----+ |\n+--------------+ +--------------+ +--------------+ ...\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eåŸºæœ¬çš„ã« few masters + many slaves ã®æ§‹æˆã§ã™ã€‚task ã¯ slaves ã®ä¸Šã§èµ°ã‚Šã¾ã™ã€‚\nmaster ã¯ã‚ªãƒ•ã‚¡ãƒ¼ã«ã‚ˆã‚Šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³(ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯)ã«å¯¾ã—ã¦ CPU, ãƒ¡ãƒ¢ãƒªã®\nãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚·ã‚§ã‚¢å‡ºæ¥ã¾ã™ã€‚ãƒªã‚½ãƒ¼ã‚¹ã¯ slave ID, resource1: amount1,\nresource2, amount2, \u0026hellip; ã¨ã„ã£ãŸé…åˆ—ã‚’å«ã¿ã¾ã™ã€‚master ã¯ãƒãƒªã‚·ã«å¾“ã„ãã‚Œãã‚Œ\nã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«å¯¾ã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ã©ã‚Œã ã‘æä¾›ã™ã‚‹ã‹æ±ºå®šã—ã¾ã™ã€‚ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å½¢å¼\nã§æ§˜ã€…ãªãƒãƒªã‚·ã‚’å–ã‚Šè¾¼ã‚€ä»•çµ„ã¿ã«ãªã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e","title":"Mesos ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ #1"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nå‰å› kibana + elasticsearch + fluentd ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’è¼‰ã›ãŸã®ã ã‘ã©æ‰‹å‹•ã§æ§‹ç¯‰ ã—ãŸã®ã§æ ¼å¥½æ‚ªã„ãªãã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚ã„ã†ã“ã¨ã§ï¼ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’èª¿ ã¹ã¦ã¿ã¾ã—ãŸã€‚\næ„å¤–ã¨ç°¡å˜ã«å‡ºæ¥ãŸã—ã€ã‚¹ãƒƒã‚­ãƒªã—ãŸå½¢ã§ãƒ‡ãƒ—ãƒ­ã‚¤å‡ºæ¥ãŸã®ã§ã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚\nå‰æã®ç’°å¢ƒã¯\u0026hellip; Ubuntu 12.04 LTS precise Chef ã‚µãƒ¼ãƒæ§‹æˆ å…¥åŠ›ã™ã‚‹ãƒ­ã‚°ã¯ nginx (ä¾‹) ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆ Cookbook ãŒä»–ã® OS ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã„ãªã„ã®ã§ Ubuntu ã‚’å‰æã«ã—ã¦ã„ã¾ ã™ã€‚Chef ã‚µãƒ¼ãƒã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚„ knife ã®è¨­å®šã¯æ¸ˆã‚“ã§ã„ã‚‹ã‚‚ã®ã¨ã—ã¦èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚ ä¾‹ã§ nginx ã®ãƒ­ã‚°ã‚’å…¥åŠ›ã—ã¾ã™ã€‚ãªã®ã§ nginx ã‚‚ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚ã“ã“ã¯ä»– ã®ã‚‚ã®ã«ç½®ãæ›ãˆã¦ã‚‚ã‚‰ã£ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚æ‰‹é †ã‚’çœç•¥åŒ–ã™ã‚‹ãŸã‚ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆ ã§èª¬æ˜ã—ã¾ã™ã€‚nginx, fluentd ã¯è¤‡æ•°ã®ãƒãƒ¼ãƒ‰ã«é…ç½®ã™ã‚‹ã“ã¨ã‚‚æ‰‹é †ã‚’èª­ã¿æ›¿ãˆã‚Œã° ã‚‚ã¡ã‚ã‚“å¯èƒ½ã§ã™ã€‚\nCookbook ã®æº–å‚™ ãŠæ±ºã¾ã‚Šã€‚Cookbooks ã®å–å¾—ã« Berkshelf ã‚’ç”¨ã„ã‚‹ã€‚\n% cd chef-repo % gem install berkshelf % ${EDITOR} Berksfile cookbook \u0026#39;elasticsearch\u0026#39;, git: \u0026#39;https://github.com/elasticsearch/cookbook-elasticsearch.git\u0026#39; cookbook \u0026#39;td-agent\u0026#39;, git: \u0026#39;https://github.com/treasure-data/chef-td-agent.git\u0026#39; cookbook \u0026#39;kibana\u0026#39;, git: \u0026#39;https://github.com/realityforge/chef-kibana.git\u0026#39; cookbook \u0026#39;nginx\u0026#39;, git: \u0026#39;https://github.com/opscode-cookbooks/nginx.git\u0026#39; Cookbooks ã‚’å–å¾—ã—ã¾ã™ã€‚\n% berks install --path=./cookbooks elasticsearch ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™ elasticsearch ã® Role ã‚’ä½œæˆã™ã‚‹ã€‚java, elasticsearch ãƒ¬ã‚·ãƒ”ã‚’æŒ‡å®šã€‚ã¾ãŸ Java ã« openjdk7 ã‚’ override_attributes ã«ã¦æŒ‡å®šã™ã‚‹ã€‚openjdk6 ã ã¨ elasticsearch ãŒèµ·å‹•ã— ãªã‹ã£ãŸã€‚å°šã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ 6 ã§ã™ã€‚Environment ã§ override_attributes ã‚’æŒ‡å®šã— ã¦ã‚‚ã‚‰ã£ã¦ã‚‚æ§‹ã‚ãªã„ã§ã™ã€‚\n% ${EDITOR} roles/elasticsearch.rb name \u0026#34;elasticsearch\u0026#34; description \u0026#34;Base role applied to elasticsearch nodes.\u0026#34; run_list( \u0026#34;recipe[java]\u0026#34;, \u0026#34;recipe[elasticsearch]\u0026#34; ) override_attributes \u0026#34;java\u0026#34; =\u0026gt; { \u0026#34;install_flavor\u0026#34; =\u0026gt; \u0026#34;openjdk\u0026#34;, \u0026#34;jdk_version\u0026#34; =\u0026gt; \u0026#34;7\u0026#34; } fluentd ãƒ‡ãƒ—ãƒ­ã‚¤ã®æº–å‚™ td-agent (fluentd) ã® Role ã‚’ä½œæˆã™ã‚‹ã€‚override_attributes ã«ã¦ td-agent ã®ãƒ— ãƒ©ã‚°ã‚¤ãƒ³ã‚’æŒ‡å®šã€‚é…åˆ—ã§è¤‡æ•°æŒ‡å®šå¯èƒ½ã€‚ã“ã¡ã‚‰ã‚‚åŒã˜ã Role ã§ override_attributes ã‚’æŒ‡å®šã—ãŸãŒ Environments ã§æŒ‡å®šã—ã¦ã‚‚æ§‹ã‚ãªã„ã§ã™ã€‚ã‚ã¨å…¬å¼ã® README ã«ã¯ attributes ã«ç›´æ¥ plugins ã‚’æŒ‡å®šã™ã‚‹ã‚ˆã†æ›¸ã„ã¦ã‚ã‚Šã¾ã—ãŸãŒã€æ§‹æˆæ¯ã« plugins ã¯å¤‰ãˆãŸã„ã¨æ€ã†ã®ã§ã€ã“ã®æ§˜ã« Roles, Environments ã§æŒ‡å®šã™ã‚‹ã®ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚\n% ${EDITOR} roles/td-agent.rb name \u0026#34;td-agent\u0026#34; description \u0026#34;Base role applied to td-agent nodes.\u0026#34; run_list( \u0026#34;recipe[td-agent]\u0026#34; ) override_attributes \u0026#34;td_agent\u0026#34; =\u0026gt; { \u0026#34;plugins\u0026#34; =\u0026gt; [ \u0026#34;elasticsearch\u0026#34; ] } td-agent.conf ã® template ã‚’ä½œæˆã€‚ä»Šå›ã¯ nginx ã® /var/log/nginx/localhost.access.log ã‚’å…¥åŠ›ã™ã‚‹ã€‚ã“ã‚Œã¯ä¾‹ãªã®ã§å¥½ããªãƒ­ã‚°ã‚’æŒ‡å®š å¯èƒ½ã€‚\n% ${EDITOR} cookbooks/td-agent/templates/default/td-agent.conf.erb \u0026lt;source\u0026gt; type tail format nginx path /var/log/nginx/localhost.access.log tag foo01.nginx.access \u0026lt;/source\u0026gt; \u0026lt;match *.nginx.*\u0026gt; index_name adminpack type_name nginx type elasticsearch include_tag_key true tag_key @log_name host localhost port 9200 logstash_format true flush_interval 10s \u0026lt;/match\u0026gt; ãƒ‡ãƒ—ãƒ­ã‚¤ Cookbooks, Roles ã‚’ Chef ã‚µãƒ¼ãƒã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€‚\n% knife cookbook upload -o cookbooks -a % knife role from file roles/*.rb knife bootstrap ã—ãƒ‡ãƒ—ãƒ­ã‚¤ï¼\n% knife bootstrap \u0026lt;ip_addr\u0026gt; -N \u0026lt;hostname\u0026gt; -r \\ \u0026#39;role[td-agent]\u0026#39;,\u0026#39;role[elasticsearch]\u0026#39;,\u0026#39;recipe[kibana]\u0026#39;,\u0026#39;recipe[nginx]\u0026#39; \\ --sudo -x \u0026lt;username\u0026gt; ä¸‹è¨˜ã® URL ã«ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã— nginx ã®ãƒ­ã‚°ã‚’ç”Ÿæˆã€‚\nhttp://\u0026lt;ip_addr\u0026gt;/ ä¸‹è¨˜ã® URL ã«ã¦ Kibana ã® UI è¶Šã—ã«ãƒ­ã‚°è§£æçµæœã‚’ç¢ºèªå‡ºæ¥ã‚‹ã€‚\nhttp://\u0026lt;ip_addr\u0026gt;:5601 ã¾ã¨ã‚ fluentd plugins ã¯è¤‡æ•°æŒ‡å®šå¯èƒ½ã€‚ç’°å¢ƒæ¯ã« td-agent.conf ã‚’å¤‰æ›´ã—ãŸã„ã¨ã„ã†è¦æœ› ãŒã‚ã‚‹ã¨æ€ã†ã‘ã© fluentd ã® Recipe ã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã€‚ãã‚Œã¨ã‚‚ td-agent.conf è‡ªä½“ã§ã†ã¾ãã•ã°ã‘ã‚‹ã®ã‹ãªï¼Ÿèª¿ã¹ã¦ãªã„ã€‚ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã§èª¬æ˜ ã—ã¾ã—ãŸãŒã€elasticsearch + kibana ã®ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦ã€è¤‡æ•°ã® nginx(ãªã‚“ã§ã‚‚è‰¯ã„)\ntd-agent ãƒãƒ¼ãƒ‰ã®æ§‹æˆãŒä¸€èˆ¬çš„ã ã¨æ€ã„ã¾ã™ã€‚æ‰‹é †ã‚’èª­ã¿æ›¿ãˆã¦ã‚„ã£ã¦ã¿ã¦ãã ã• ã„ã€‚ãã®å ´åˆ kibana ã® Cookbook ã® attributes ä¸­ã« elasticsearch ã® IP ã‚¢ãƒ‰ãƒ¬ ã‚¹ãƒ»ãƒãƒ¼ãƒˆã‚’è¨˜ã™ç®‡æ‰€ãŒã‚ã‚‹ã®ã§ Role, Environments ã§ä¸Šæ›¸ãã—ã¦ã‚ã’ã¦ãã ã•ã„ã€‚ default[\u0026#39;kibana\u0026#39;][\u0026#39;elasticsearch\u0026#39;][\u0026#39;hosts\u0026#39;] = [\u0026#39;127.0.0.1\u0026#39;] default[\u0026#39;kibana\u0026#39;][\u0026#39;elasticsearch\u0026#39;][\u0026#39;port\u0026#39;] = 9200 ã‚ã¨ td-agent/templates/default/td-agent.conf.erb ã®ä¸­ã«è¨˜ã—ãŸ host, port ã®æŒ‡ å®šã‚‚ elasticsearch ã®ãƒ›ã‚¹ãƒˆæƒ…å ±ã«æ›¸ãæ›ãˆã¦ã‚ã’ã¦ãã ã•ã„ã€‚\nhost localhost port 9200 ä»¥ä¸Šã§ã™ã€‚æ„å¤–ã¨ç°¡å˜ã«å‡ºæ¥ã¾ã—ãŸã€‚ã‚¹ãƒƒã‚­ãƒªã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/09/13/chef-kibana-elasticsearch-fluentd/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå‰å› kibana + elasticsearch + fluentd ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’è¼‰ã›ãŸã®ã ã‘ã©æ‰‹å‹•ã§æ§‹ç¯‰\nã—ãŸã®ã§æ ¼å¥½æ‚ªã„ãªãã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚ã„ã†ã“ã¨ã§ï¼ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’èª¿\nã¹ã¦ã¿ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eæ„å¤–ã¨ç°¡å˜ã«å‡ºæ¥ãŸã—ã€ã‚¹ãƒƒã‚­ãƒªã—ãŸå½¢ã§ãƒ‡ãƒ—ãƒ­ã‚¤å‡ºæ¥ãŸã®ã§ã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æã®ç’°å¢ƒã¯\"\u003eå‰æã®ç’°å¢ƒã¯\u0026hellip;\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eUbuntu 12.04 LTS precise\u003c/li\u003e\n\u003cli\u003eChef ã‚µãƒ¼ãƒæ§‹æˆ\u003c/li\u003e\n\u003cli\u003eå…¥åŠ›ã™ã‚‹ãƒ­ã‚°ã¯ nginx (ä¾‹)\u003c/li\u003e\n\u003cli\u003eã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eCookbook ãŒä»–ã® OS ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã„ãªã„ã®ã§ Ubuntu ã‚’å‰æã«ã—ã¦ã„ã¾\nã™ã€‚Chef ã‚µãƒ¼ãƒã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚„ knife ã®è¨­å®šã¯æ¸ˆã‚“ã§ã„ã‚‹ã‚‚ã®ã¨ã—ã¦èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚\nä¾‹ã§ nginx ã®ãƒ­ã‚°ã‚’å…¥åŠ›ã—ã¾ã™ã€‚ãªã®ã§ nginx ã‚‚ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚ã“ã“ã¯ä»–\nã®ã‚‚ã®ã«ç½®ãæ›ãˆã¦ã‚‚ã‚‰ã£ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚æ‰‹é †ã‚’çœç•¥åŒ–ã™ã‚‹ãŸã‚ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆ\nã§èª¬æ˜ã—ã¾ã™ã€‚nginx, fluentd ã¯è¤‡æ•°ã®ãƒãƒ¼ãƒ‰ã«é…ç½®ã™ã‚‹ã“ã¨ã‚‚æ‰‹é †ã‚’èª­ã¿æ›¿ãˆã‚Œã°\nã‚‚ã¡ã‚ã‚“å¯èƒ½ã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"cookbook-ã®æº–å‚™\"\u003eCookbook ã®æº–å‚™\u003c/h2\u003e\n\u003cp\u003eãŠæ±ºã¾ã‚Šã€‚Cookbooks ã®å–å¾—ã« Berkshelf ã‚’ç”¨ã„ã‚‹ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% cd chef-repo\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% gem install berkshelf\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% \u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eEDITOR\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e Berksfile\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecookbook \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;elasticsearch\u0026#39;\u003c/span\u003e, git: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;https://github.com/elasticsearch/cookbook-elasticsearch.git\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecookbook \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;td-agent\u0026#39;\u003c/span\u003e, git: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;https://github.com/treasure-data/chef-td-agent.git\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecookbook \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;kibana\u0026#39;\u003c/span\u003e, git: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;https://github.com/realityforge/chef-kibana.git\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecookbook \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;nginx\u0026#39;\u003c/span\u003e, git: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;https://github.com/opscode-cookbooks/nginx.git\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eCookbooks ã‚’å–å¾—ã—ã¾ã™ã€‚\u003c/p\u003e","title":"Chef ã§ kibana + elasticsearch + fluentd ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ãŸ"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nOpenStack ç¬¬14å›å‹‰å¼·ä¼š ãƒãƒƒã‚«ã‚½ãƒ³ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚ãã®æ™‚ã®è‡ªåˆ†ã®ä½œæ¥­ãƒ­ã‚°ã‚’ è¨˜ã—ã¦ãŠãã¾ã™ã€‚è‡ªåˆ†ã®ä½œæ¥­å†…å®¹ã¯ \u0026lsquo;OpenStack + Docker æ§‹ç¯‰\u0026rsquo; ã§ã™ã€‚\nå ´æ‰€ : CreationLine ã•ã¾ æ—¥æ™‚ : 2013å¹´9æœˆ8æ—¥(åœŸ) å½“æ—¥ã® atndã€‚\nhttp://atnd.org/events/42891\nå½“æ—¥ç™ºè¡¨ã®ã‚ã£ãŸå†…å®¹\nAnsible ã§ OpenStack ã‚’å®Ÿéš›ã«çš†ã®å‰ã§ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ Yoshiyama ã•ã‚“é–‹ç™º LogCas ãŠæŠ«éœ²ç›® Havana ã®æ©Ÿèƒ½æ”¹å–„ãƒ»æ©Ÿèƒ½è¿½åŠ å†…å®¹ç¢ºèª ãã®ä»– Horizon ã®æ©Ÿèƒ½ã«ã¤ã„ã¦ã ã£ãŸã‚Š openstack.jp ã®é‹ç”¨ã«ã¤ã„ã¦ãªã© è‡ªåˆ†ãŒè©±ã‚’èããªãŒã‚‰é»™ã€…ã¨ã‚„ã£ãŸã“ã¨ã¯\nOpenStack + Docker æ§‹ç¯‰ çµæœ\u0026hellip; NG å‹•ã‹ãšã€‚æ™‚é–“åˆ‡ã‚Œã€‚å…¬å¼ã® wiki ã®æ‰‹é †ãŒã ã„ã¶å¤‰ãªã®ã§æ‰‹é †ã‚’ä¿®æ­£ã—ãªãŒã‚‰é€²ã‚ã¾ã—ãŸã€‚\nå…¬å¼ã® wiki ã¯ã“ã¡ã‚‰ã«ã‚ã‚Šã¾ã™ã€‚\nhttps://wiki.openstack.org/wiki/Docker\nãã®ä¿®æ­£ã—ãªãŒã‚‰ãƒ¡ãƒ¢ã£ãŸæ‰‹é †ã‚’ä¸‹è¨˜ã«è²¼ã‚Šä»˜ã‘ã¦ãŠãã¾ã™ã€‚\nä½œæ¥­ç’°å¢ƒ ãƒ›ã‚¹ãƒˆ : Ubuntu 12.04.3 Precise OpenStack ãƒãƒ¼ã‚¸ãƒ§ãƒ³ : devstack (2013/09/08 master ãƒ–ãƒ©ãƒ³ãƒ) æ§‹æˆ : ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ (with heat, ceilometer, neutron) æ™®é€šã«å‹•ã‹ã™ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œã‚‹ ã“ã‚Œã¯ devstack (2013/09/08 æ™‚ç‚¹) ã§ã®ä¸å…·åˆãªã®ã§ç›´ã¡ã«ä¿®æ­£ã•ã‚Œã‚‹ã‹ã‚‚ã€‚\nãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒ \u0026lsquo;ascii\u0026rsquo; ã«ãªã£ã¦ã„ã‚‹ã®ãŒåŸå› ã‚‰ã—ã„.\n% python Python 2.7.3 (default, Apr 10 2013, 06:20:15) [GCC 4.6.3] on linux2 Type \u0026#34;help\u0026#34;, \u0026#34;copyright\u0026#34;, \u0026#34;credits\u0026#34; or \u0026#34;license\u0026#34; for more information. \u0026gt;\u0026gt;\u0026gt; import sys \u0026gt;\u0026gt;\u0026gt; sys.getdefaultencoding() \u0026#39;ascii\u0026#39; \u0026gt;\u0026gt;\u0026gt; ã‚¨ãƒ©ãƒ¼ã®å†…å®¹ã¯â€¦ ã“ã®çŠ¶æ…‹ã ã¨â€¦ ä¸‹è¨˜ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒ nova ã‹ã‚‰å‡ºåŠ›ã•ã‚Œã‚‹ã€‚ã‚€ã‚€ã‚€ã€‚\n% nova boot --image \u0026#34;ubuntu:latest\u0026#34; --flavor 1 vm01 ERROR: UnicodeError: \u0026#39;ascii\u0026#39; codec can\u0026#39;t decode byte 0xe5 in position 2: ordinal not in range(128) (HTTP 400) (Request-ID: req-40ebfb9b-d76a-40b8-8f75-facb4dd73db4) ã¨ã‚Šã‚ãˆãšæš«å®šå‡¦ç½®ã¨ã—ã¦ã€ä¸‹è¨˜ã®ã‚ˆã†ã« setdefaultencoding(\u0026lsquo;utf-8\u0026rsquo;) ã‚’è¿½è¨˜ã€‚ã¡ ãªã¿ã« devstack ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ã“ã®ä½œæ¥­ã‚’æ¸ˆã¾ã›ã¾ã—ãŸã€‚ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã ã¨è‰²ã€…ã‚ã‚“ã©ã„ã€‚ å½“æ—¥ã€ä½•åº¦ã‚‚ã‚ã‚“ã©ã„å ´é¢ã«é­é‡ã—ã¾ã—ãŸ\u0026hellip;\n% ${EDITOR} /usr/lib/python2.7/sitecustomize.py # install the apport exception handler if available try: import apport_python_hook except ImportError: pass else: apport_python_hook.install() # ä¸‹è¨˜ã®2è¡Œã‚’è¿½è¨˜ import sys sys.setdefaultencoding(\u0026#39;utf-8\u0026#39;) Ubuntu12.04 ã®å ´åˆ Linux Kernel 3.8 ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ wiki ã«ã¯è¼‰ã£ã¦ã„ãªã„ãŒ docker ãŒ Linux Kernel 3.8 ä»¥ä¸Šã‚’æ¨å¥¨ã—ã¦ã„ã‚‹ãŸã‚ raring ã‹ã‚‰ 3.8 ã‚’æŒã£ã¦ãã‚‹ã€‚\n% sudo apt-get update % sudo apt-get install linux-image-generic-lts-raring linux-headers-generic-lts-raring % sudo reboot socat ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« å¾Œã«å®Ÿè¡Œã™ã‚‹ install_docker.sh ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå¿…è¦ã¨ã™ã‚‹ã€‚å®Ÿè¡Œå‰ã«å…¥ã‚Œãªã„ã¨ã¨ç—› ã„ç›®è¦‹ã‚‹ã€‚å½“æ—¥ä½•åº¦ã‚‚ç—›ã„ç›®è¦‹ã¾ã—ãŸ\u0026hellip;\n% sudo apt-get install socat localrc è¿½è¨˜ localrc ã«ä¸‹è¨˜ã‚’è¿½è¨˜ã€‚ãã®ä»–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯å„è‡ªã®ãƒ¢ãƒã§è‰¯ã„ã€‚\nVIRT_DRIVER=docker install_docker.sh å®Ÿè¡Œ ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶æ¨©é™ã§ OK ã€‚ä¸­ã§ sudo ã—ã¦ã„ã‚‹ã€‚ãŒã€æ¥µç¨€ã« sudo ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒæ¥ã‚‹ ã®ã§ã€è‰²ã€…ã—ã‚“ã©ã„ã€‚ã¡ãªã¿ã«åƒ•ã¯ã“ã“ã§ä½•åº¦ã‚‚ã‚„ã‚ŠãªãŠã—ã¾ã—ãŸã€‚\u0026hellip;\n% ./tools/docker/install_docker.sh devstack ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« devstack ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€‚\n% ./stack.sh index.docker.io ã‹ã‚‰ \u0026lsquo;ubuntu\u0026rsquo; ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ index.docker.io ã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã‹ã‚‰ \u0026lsquo;ubuntu\u0026rsquo; ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾—ã€‚ã©ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã‚‚è‰¯ã„ã€‚\n% sudo docker pull ubuntu Pulling repository ubuntu 8dbd9e392a96: Download complete b750fe79269d: Download complete 27cf78414709: Download complete docker-registry (ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ãƒã‚¸ãƒˆãƒª) ã«å¯¾ã—ã¦ push ã™ã‚‹ -\u0026gt; Glance ã«ç™»éŒ² ã“ã®çŠ¶æ…‹ã§ docker-registry.sh ã¨ã„ã†ãƒ—ãƒ­ã‚»ã‚¹ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã¯ãšã€‚ã“ã‚Œã¯ docker\nã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ãƒã‚¸ãƒˆãƒªã«ç›¸å½“ã€‚5042 tcp ã§å¾…ã¡å—ã‘ã¦ã„ã‚‹ã®ã§ä¸‹è¨˜ã®ã‚ˆã†ã« tag ã‚’æ‰“ã£ãŸå¾Œã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ãƒã‚¸ãƒˆãƒªã« ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€‚\n% sudo docker tag ubuntu 10.200.9.25:5042/ubuntu % sudo docker push 10.200.9.25:5042/ubuntu The push refers to a repository [10.200.9.25:5042/ubuntu] (len: 1) Sending image list Pushing repository 10.200.9.25:5042/ubuntu (1 tags) Pushing 8dbd9e392a964056420e5d58ca5cc376ef18e2de93b5cc90e868a1bbc8318c1c Pushing tags for rev [8dbd9e392a964056420e5d58ca5cc376ef18e2de93b5cc90e868a1bbc8318c1c] on {http://10.200.9.25:5042/v1/repositories/ubuntu/tags/latest} docker ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã«ã¤ã„ã¦ã¯ã“ã“ãŒå‚è€ƒã«ãªã‚‹ã€‚\nhttp://docs.docker.io/en/latest/use/workingwithrepository/\nglance ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª \u0026lsquo;ubuntu:latest\u0026rsquo; ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã€‚ã‚„ã£ãŸã€‚\n% glance image-list +--------------------------------------+---------------------------------+-------------+------------------+----------+--------+ | ID\t| Name\t| Disk Format | Container Format | Size\t| Status | +--------------------------------------+---------------------------------+-------------+------------------+----------+--------+ | f5845be4-1ac0-42c7-9280-a8c316be6beb | cirros-0.3.1-x86_64-uec\t| ami\t| ami\t| 25165824 | active | | aa8bcdff-6eb9-402b-9e27-675648dbe311 | cirros-0.3.1-x86_64-uec-kernel | aki\t| aki\t| 4955792 | active | | f8857736-5613-401a-b28c-02c286271af4 | cirros-0.3.1-x86_64-uec-ramdisk | ari\t| ari\t| 3714968 | active | | ae56cacb-7eb6-413e-bd75-46f3cd63123b | docker-busybox:latest\t| raw\t| docker\t| 2271796 | active | | 613b05c3-30f6-4c53-aa94-103ea516373e | ubuntu:latest\t| raw\t| docker\t| 71497587 | active | +--------------------------------------+---------------------------------+-------------+------------------+----------+--------+ nova boot ãã£ãŸã‚Š\u0026hellip; nova-scheduler ãŒã‚¨ãƒ©ãƒ¼åã„ã¦ã‚‹ã½ã„ã‘ã©ã€åŸå› ã¤ã‹ã‚ãšã€‚ãƒãƒƒã‚«ã‚½ãƒ³æ™‚é–“åˆ‡ã‚Œã€‚\n% nova boot --image \u0026#34;ubuntu:latest\u0026#34; --flavor m1.tiny vm01 % nova list +--------------------------------------+------+--------+------------+-------------+----------+ | ID | Name | Status | Task State | Power State | Networks | +--------------------------------------+------+--------+------------+-------------+----------+ | e1563b55-bb5d-43a6-a1fc-c3bc63600ac7 | vm01 | ERROR | None | NOSTATE | | +--------------------------------------+------+--------+------------+-------------+----------+ ã‚¨ãƒ©ãƒ¼å†…å®¹.. ä¸‹è¨˜ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ãŸã€‚ãªã‚“ã ã‹ OpenStack ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã˜ã‚ƒãªã„ã‚ˆã†ãªã€‚ èª¿ã¹ã¦ãŸã‚‰ç´ ã® Python ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‰ã—ãã€‚ã†ãƒ¼ã‚“ã€‚devstack ãªã®ã§ä»•æ–¹ãªã„ã€‚\nSep 7 14:53:08 devstack01 2013-09-07 14:53:08.490 ERROR nova.compute.manager [req-d4ff6a45-88bc-4d6e-8f9d-43de79e601c6 demo demo] [instance: fdd0fdfb-aaa2-4e91-98cc-cdb347e9ae09] Instance failed to spawn#0122013-09-07 14:53:08.490 31835 TRACE nova.compute.manager [instance: fdd0fdfb-aaa2-4e91-98cc-cdb347e9ae09] Traceback (most recent call last):#0122013-09-07 14:53:08.490 31835 TRACE nova.compute.manager [instance: fdd0fdfb-aaa2-4e91-98cc-cdb347e9ae09] File \u0026#34;/opt/stack/nova/nova/compute/manager.py\u0026#34;, line 1416, in _spawn#0122013-09-07 14:53:08.490 31835 TRACE nova.compute.manager [instance: fdd0fdfb-aaa2-4e91-98cc-cdb347e9ae09] block_device_info)#0122013-09-07 14:53:08.490 31835 TRACE nova.compute.manager [instance: fdd0fdfb-aaa2-4e91-98cc-cdb347e9ae09] File \u0026#34;/opt/stack/nova/nova/virt/docker/driver.py\u0026#34;, line 305, in spawn#0122013-09-07 14:53:08.490 31835 TRACE nova.compute.manager [instance: fdd0fdfb-aaa2-4e91-98cc-cdb347e9ae09] raise exception.InstanceDeployFailure(msg.format(e),#0122013-09-07 14:53:08.490 31835 TRACE nova.compute.manager [instance: fdd0fdfb-aaa2-4e91-98cc-cdb347e9ae09] File \u0026#34;/opt/stack/nova/nova/openstack/common/gettextutils.py\u0026#34;, line 255, in __getattribute__#0122013-09-07 14:53:08.490 31835 TRACE nova.compute.manager [instance: fdd0fdfb-aaa2-4e91-98cc-cdb347e9ae09] return UserString.UserString.__getattribute__(self, name)#0122013-09-07 14:53:08.490 31835 TRACE nova.compute.manager [instance: fdd0fdfb-aaa2-4e91-98cc-cdb347e9ae09] AttributeError: \u0026#39;Message\u0026#39; object has no attribute \u0026#39;format\u0026#39;#0122013-09-07 14:53:08.490 31835 TRACE nova.compute.manager [instance: fdd0fdfb-aaa2-4e91-98cc-cdb347e9ae09] æ‰€æ„Ÿã¨ã¾ã¨ã‚ å‰åŠã®1,2æ™‚é–“ã€ã¿ãªã•ã‚“ã®è©±ã«èãå…¥ã£ã¦ã—ã¾ã£ãŸã®ã§æ™‚é–“ãŒâ€¦ã€‚ç™ºè¡¨ã®å†…å®¹ã‚‚çš†ã• ã‚“ã®ä¼šè©±ã‚‚æ¥½ã—ã‹ã£ãŸã€‚ã¾ãŸå‚åŠ ã—ãŸã„ã€‚Netron å‘¨ã‚Šã§èããŸã„äº‹ã¨ã‹è‰²ã€…ã‚ã£ãŸã® ã ã‘ã©ã‚³ã‚¢ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ã®æ–¹ã«èã‘ãªã‹ã£ãŸã®ãŒå¾Œæ‚”ã€‚ä»Šåº¦æ•™ãˆã¦ã‚‚ã‚‰ãŠã†ã€‚ã‚ã¨ã‚„ã£ã± ã‚Šã¿ãªã•ã‚“è©³ã—ã„ã€‚ãã®æƒ…å ±ã©ã“ã‹ã‚‰ï¼Ÿã¨ã„ã†ã“ã¨ã¾ã§ã‚ˆãçŸ¥ã£ã¦ã„ã‚‹ã—çŸ¥è­˜ãŒæ·±ã„ã€‚ ç†è§£åº¦ãŒã¾ã ã¾ã ã¡ã‚ƒã†ãªãã¨å®Ÿæ„Ÿã€‚æ¬¡å›ã‚‚å‚åŠ ã•ã›ã¦ã„ãŸã ã“ã†ã¨æ€ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/09/09/14th-openstack-study-hackathon/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eOpenStack ç¬¬14å›å‹‰å¼·ä¼š ãƒãƒƒã‚«ã‚½ãƒ³ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚ãã®æ™‚ã®è‡ªåˆ†ã®ä½œæ¥­ãƒ­ã‚°ã‚’\nè¨˜ã—ã¦ãŠãã¾ã™ã€‚è‡ªåˆ†ã®ä½œæ¥­å†…å®¹ã¯ \u0026lsquo;OpenStack + Docker æ§‹ç¯‰\u0026rsquo; ã§ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eå ´æ‰€ : CreationLine ã•ã¾\næ—¥æ™‚ : 2013å¹´9æœˆ8æ—¥(åœŸ)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eå½“æ—¥ã® atndã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://atnd.org/events/42891\"\u003ehttp://atnd.org/events/42891\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eå½“æ—¥ç™ºè¡¨ã®ã‚ã£ãŸå†…å®¹\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAnsible ã§ OpenStack ã‚’å®Ÿéš›ã«çš†ã®å‰ã§ãƒ‡ãƒ—ãƒ­ã‚¤ï¼\u003c/li\u003e\n\u003cli\u003eYoshiyama ã•ã‚“é–‹ç™º LogCas ãŠæŠ«éœ²ç›®\u003c/li\u003e\n\u003cli\u003eHavana ã®æ©Ÿèƒ½æ”¹å–„ãƒ»æ©Ÿèƒ½è¿½åŠ å†…å®¹ç¢ºèª\u003c/li\u003e\n\u003cli\u003eãã®ä»– Horizon ã®æ©Ÿèƒ½ã«ã¤ã„ã¦ã ã£ãŸã‚Š openstack.jp ã®é‹ç”¨ã«ã¤ã„ã¦ãªã©\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè‡ªåˆ†ãŒè©±ã‚’èããªãŒã‚‰é»™ã€…ã¨ã‚„ã£ãŸã“ã¨ã¯\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eOpenStack + Docker æ§‹ç¯‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eçµæœ\u0026hellip; NG å‹•ã‹ãšã€‚æ™‚é–“åˆ‡ã‚Œã€‚å…¬å¼ã® wiki ã®æ‰‹é †ãŒã ã„ã¶å¤‰ãªã®ã§æ‰‹é †ã‚’ä¿®æ­£ã—ãªãŒã‚‰é€²ã‚ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eå…¬å¼ã® wiki ã¯ã“ã¡ã‚‰ã«ã‚ã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://wiki.openstack.org/wiki/Docker\"\u003ehttps://wiki.openstack.org/wiki/Docker\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eãã®ä¿®æ­£ã—ãªãŒã‚‰ãƒ¡ãƒ¢ã£ãŸæ‰‹é †ã‚’ä¸‹è¨˜ã«è²¼ã‚Šä»˜ã‘ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä½œæ¥­ç’°å¢ƒ\"\u003eä½œæ¥­ç’°å¢ƒ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eãƒ›ã‚¹ãƒˆ : Ubuntu 12.04.3 Precise\u003c/li\u003e\n\u003cli\u003eOpenStack ãƒãƒ¼ã‚¸ãƒ§ãƒ³ : devstack (2013/09/08 master ãƒ–ãƒ©ãƒ³ãƒ)\u003c/li\u003e\n\u003cli\u003eæ§‹æˆ : ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ (with heat, ceilometer, neutron)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"æ™®é€šã«å‹•ã‹ã™ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œã‚‹\"\u003eæ™®é€šã«å‹•ã‹ã™ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œã‚‹\u003c/h2\u003e\n\u003cp\u003eã“ã‚Œã¯ devstack (2013/09/08 æ™‚ç‚¹) ã§ã®ä¸å…·åˆãªã®ã§ç›´ã¡ã«ä¿®æ­£ã•ã‚Œã‚‹ã‹ã‚‚ã€‚\u003c/p\u003e","title":"ç¬¬14å› OpenStack å‹‰å¼·ä¼šå‚åŠ ãƒ­ã‚°"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\n{% img /pix/kibana3.png %}\nå‰å›ã®è¨˜äº‹ã§ Kibana + elasticsearch + fluentd ã‚’è©¦ã—ã¾ã—ãŸãŒã€ãƒ„ã‚¤ãƒƒã‚¿ãƒ¼ã§ @nora96o ã•ã‚“ã« \u0026ldquo;Kibana3 ä½¿ã†ã¨ã€å¹¸ã›ã«ãªã‚Œã¾ã™ã‚ˆï¼\u0026rdquo; ã¨æ•™ãˆã¦ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚æ—© é€Ÿè©¦ã—ã¦ã¿ã¾ã—ãŸã®ã§ã€ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚\nå‰å›ã®è¨˜äº‹ã€‚\nhttp://jedipunkz.github.io/blog/2013/09/07/kibana-plus-elasticsearch-plus-fluentd/\nå‰åŠã®æ‰‹é †ã¯å‰å›ã¨åŒæ§˜ã§ã™ãŒã€å¿µã®ãŸã‚æ›¸ã„ã¦ãŠãã¾ã™ã€‚\nå‰æã®ç’°å¢ƒ OS : Ubuntu 12.04 Precise (åŒã˜æ–¹æ³•ã§ 13.04 Raring ã§ã‚‚å‡ºæ¥ã¾ã—ãŸ) å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ä¸‹è¨˜ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’äº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% sudo apt-get install git-core build-essential ruby1.9.3 openjdk-7-jdk æ‰‹é †ã‚’çœããŸã‚ã« Ruby ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§å…¥ã‚Œã¾ã—ãŸã€‚ã¾ãŸ Java ã¯ä»–ã®ç‰©ã‚’åˆ©ç”¨ã—ã¦ã‚‚ æ§‹ã„ã¾ã›ã‚“ã€‚Ruby ã¯ fluentd ãŒã€Java ã¯ elasticsearch ãŒå¿…è¦ã¨ã—ã¾ã™ã€‚\nelasticsearch ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã‚ˆã‚Š elasticsearch ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\nhttp://www.elasticsearch.org/download/\nç¾æ™‚ç‚¹ (2013/09/08) ã§æœ€æ–°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 0.90.3 ã§ã—ãŸã€‚\n% wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-0.90.3.deb % sudo dpkg -i elasticsearch-0.90.3.deb % sudo service elasticsearch start fluentd ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« fluentd ã‚’ä¸‹è¨˜ã®é€šã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% sudo -i % curl -L http://toolbelt.treasure-data.com/sh/install-ubuntu-precise.sh | sh /etc/td-agent/td-agent.conf ã‚’ä¸‹è¨˜ã®é€šã‚Šã«ä¿®æ­£ã—ã¾ã™ã€‚ã‚µãƒ³ãƒ—ãƒ«ã§ Apache ã®ãƒ­ã‚° ã‚’ elasticsearch ã«é£›ã°ã™è¨­å®šã«ã—ã¾ã™ã€‚\n\u0026lt;source\u0026gt; type tail format apache path /var/log/apache2/access.log tag kibana01.apache.access \u0026lt;/source\u0026gt; \u0026lt;match *.apache.*\u0026gt; index_name adminpack type_name apache type elasticsearch include_tag_key true tag_key @log_name host 10.0.1.8 port 9200 logstash_format true flush_interval 3s \u0026lt;/match\u0026gt; host ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã—ã¾ã™ã€‚\nfluentd ã‚’èµ·å‹•ã—ã¾ã™ã€‚\n% sudo service td-agent start Apache ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ã‚·ã‚¹ãƒ†ãƒ ã«å¿…è¦ãªã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã‚µãƒ³ãƒ—ãƒ«ã§ Apache ã®ãƒ­ã‚°ã‚’ fluentd çµŒç”± ã§é£›ã°ã—ã¦ Kibana ã§ç¢ºèªã—ãŸã„ã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% sudo apt-get install apache2 % sudo chown -R td-agent /var/log/apache2 ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ªãƒ¼ãƒŠã‚’ td-agent ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚\nKibana3 ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã‹ã‚‰ Kibana3 ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\nhttp://three.kibana.org/intro.html\n% wget https://github.com/elasticsearch/kibana/archive/master.tar.gz % tar zxvf master.tar.gz % sudo mv kibana-master /var/www/kibana3\nconfig.js ã‚’ä¿®æ­£ã—ã¾ã™ã€‚elasticsearch ã®èµ·å‹•ã—ã¦ã„ã‚‹ URL ã‚’å…¥åŠ›ã—ã¾ã™ã€‚ã“ã“ã§ æ³¨æ„ãŒå¿…è¦ãªã®ãŒã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã‚‹ elasticsearch ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã™ã‚‹å¿… è¦ãŒã‚ã‚‹ã¨ã„ã†ç‚¹ã§ã™ã€‚å¾“æ¥ã® Kibana ã®å ´åˆã¯ Ruby è£½ã ã£ãŸãŸã‚ Kibana ã‹ã‚‰ elasticsearch ã«åˆ°é”ã§ãã‚Œã°è‰¯ã‹ã£ãŸã®ã§ã™ãŒã€Kibana3 ã¯ JavaScript è£½ã§ã™ã®ã§ ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ elasticsearch ã® 9200 ç‰ˆãƒãƒ¼ãƒˆã«åˆ°é”å‡ºæ¥ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n% sudo ${EDITOR} /var/www/kibana3/config.js ...snip... elasticsearch: \u0026#34;http://\u0026lt;ElasticSearch IP addr\u0026gt;:9200\u0026#34;, ...snip... ã“ã‚Œã§å®Œäº†ã§ã™ã€‚\nãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ ã‚ã¨ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã ã‘ã§ã™ã€‚\nhttp://\u0026lt;kibana IP addr\u0026gt;/kibana3/ ã¾ã¨ã‚ ElasticSearch ã‚’å¤–éƒ¨ã«å…¬é–‹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã ã‘ã©ã€ãã®è¾ºã‚Šã©ã†åˆ¶é™æ›ã‘ã‚‹ã‹ã¯åˆ¥ é€”èª¿ã¹ãªã„ã¨ã„ã‘ãªã„ãªãã¨ã€‚ã‚ã¨ ElasticSearch, fluentd ã‚’ Cookbook ã§ãƒ‡ãƒ—ãƒ­ã‚¤ ã™ã‚‹ã®ã‚‚å‡ºæ¥ãã†ã€‚ã‚‚ã¡ã‚ã‚“ Apache ã‚‚ã€‚æ¬¡å›ä»¥é™ã®è¨˜äº‹ã«è¼‰ã›ã¾ã™ã€‚ã¾ãŸãƒ–ãƒ©ã‚¦ã‚¶ã§ ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå¾Œã«æ§˜ã€…ãªå½¢å¼ã®ã‚°ãƒ©ãƒ•ç­‰ã‚’è¿½åŠ ã—ã¦ã„ã‘ã¾ã—ãŸã€‚ã‚‚ã¡ã‚ã‚“ Kibana3 ã‚’ ä½¿ã‚ãªã„ã§ã‚‚ elasticseach ã ã‘ã§ API ã«ã‚ˆã‚‹ãƒ­ã‚°ã®æ¤œç´¢ãŒå‡ºæ¥ãŸã‚Šã—ã¦ã€åƒ•ã‚‰ã‚¨ãƒ³ ã‚¸ãƒ‹ã‚¢ã«ã¨ã£ã¦ã¯ã‚ã£ã¡ã‚ƒãã¡ã‚ƒãƒ¡ãƒªãƒƒãƒˆã‚ã‚Šã¾ã™ã€‚ã‚ããªã‚“ã§ã‚‚ã£ã¨æ—©ãä½¿ã£ã¦ãªã‹ã£ ãŸã‚“ã ã‚ã†ã€‚elasticsearch\u0026hellip;ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/09/08/kibana3-plus-elasticsearch-plus-fluentd/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e{% img /pix/kibana3.png %}\u003c/p\u003e\n\u003cp\u003eå‰å›ã®è¨˜äº‹ã§ Kibana + elasticsearch + fluentd ã‚’è©¦ã—ã¾ã—ãŸãŒã€ãƒ„ã‚¤ãƒƒã‚¿ãƒ¼ã§\n@nora96o ã•ã‚“ã« \u0026ldquo;Kibana3 ä½¿ã†ã¨ã€å¹¸ã›ã«ãªã‚Œã¾ã™ã‚ˆï¼\u0026rdquo; ã¨æ•™ãˆã¦ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚æ—©\né€Ÿè©¦ã—ã¦ã¿ã¾ã—ãŸã®ã§ã€ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå‰å›ã®è¨˜äº‹ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://jedipunkz.github.io/blog/2013/09/07/kibana-plus-elasticsearch-plus-fluentd/\"\u003ehttp://jedipunkz.github.io/blog/2013/09/07/kibana-plus-elasticsearch-plus-fluentd/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eå‰åŠã®æ‰‹é †ã¯å‰å›ã¨åŒæ§˜ã§ã™ãŒã€å¿µã®ãŸã‚æ›¸ã„ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æã®ç’°å¢ƒ\"\u003eå‰æã®ç’°å¢ƒ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eOS : Ubuntu 12.04 Precise (åŒã˜æ–¹æ³•ã§ 13.04 Raring ã§ã‚‚å‡ºæ¥ã¾ã—ãŸ)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003eå¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’äº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo apt-get install git-core build-essential ruby1.9.3 openjdk-7-jdk\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ‰‹é †ã‚’çœããŸã‚ã« Ruby ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§å…¥ã‚Œã¾ã—ãŸã€‚ã¾ãŸ Java ã¯ä»–ã®ç‰©ã‚’åˆ©ç”¨ã—ã¦ã‚‚\næ§‹ã„ã¾ã›ã‚“ã€‚Ruby ã¯ fluentd ãŒã€Java ã¯ elasticsearch ãŒå¿…è¦ã¨ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"elasticsearch-ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003eelasticsearch ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã‚ˆã‚Š elasticsearch ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.elasticsearch.org/download/\"\u003ehttp://www.elasticsearch.org/download/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eç¾æ™‚ç‚¹ (2013/09/08) ã§æœ€æ–°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 0.90.3 ã§ã—ãŸã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-0.90.3.deb\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo dpkg -i elasticsearch-0.90.3.deb\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo service elasticsearch start\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"fluentd-ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003efluentd ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003efluentd ã‚’ä¸‹è¨˜ã®é€šã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e","title":"Kibana3 + elasticsearch + fluentd ã‚’è©¦ã—ãŸ"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nè‡ªå‹•åŒ–ã®æµã‚Œã‚’æ¤œè¨ã™ã‚‹ä¸­ã§ãƒ­ã‚°è§£æã‚‚å¿˜ã‚Œã¦ã¯ã„ã‘ãªã„ã¨ã„ã†ã“ã¨ã§ ElasticSearch ã‚’ä½¿ã„ãŸã„ãªãã¨ã¼ã‚“ã‚„ã‚Šè€ƒãˆã¦ã„ã¦ Logstash ã¨ã‹ Kibana ã¨ã‹ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚‚ç›® ã«æ­¢ã¾ã‚‹ã‚ˆã†ã«ãªã£ã¦ãã¾ã—ãŸã€‚\nElasticSaerch ã¯ API ã§æƒ…å ±ã‚’æ¤œç´¢å‡ºæ¥ãŸã‚Šã™ã‚‹ã®ã§è‡ªå‹•åŒ–ã«ã‚‚ã£ã¦ã“ã„ã€‚ãƒãƒƒã‚¯ã‚¨ ãƒ³ãƒ‰ã« Logstash ã‚’ä½¿ã£ã¦\u0026hellip; ã¨æ€ã£ã¦ãŸã®ã§ã™ãŒæœ€è¿‘ã‚ˆãèãã‚ˆã†ã«ãªã£ãŸ fluentd ã‚’ãã‚ãã‚çœŸé¢ç›®ã«ä½¿ã„ãŸã„ï¼ã¨ã„ã†ã“ã¨ã§ã€ä»Šå›ã¯ Kibana + ElasticSearch + fluentd ã®çµ„ã¿åˆã‚ã›ã§ãƒ­ã‚°è§£æã‚·ã‚¹ãƒ†ãƒ ã‚’çµ„ã‚€æ–¹æ³•ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚\nå‚è€ƒã«ã•ã›ã¦é ‚ã„ãŸ URL http://memocra.blogspot.jp/2013/04/kibanakibanaelasticsearchfluentd.html\nå‰æã®ç’°å¢ƒ OS : Ubuntu 12.04 Precise (åŒã˜æ–¹æ³•ã§ 13.04 Raring ã§ã‚‚å‡ºæ¥ã¾ã—ãŸ) å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ä¸‹è¨˜ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’äº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% sudo apt-get install git-core build-essential ruby1.9.3 openjdk-7-jdk æ‰‹é †ã‚’çœããŸã‚ã« Ruby ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§å…¥ã‚Œã¾ã—ãŸã€‚ã¾ãŸ Java ã¯ä»–ã®ç‰©ã‚’åˆ©ç”¨ã—ã¦ã‚‚ æ§‹ã„ã¾ã›ã‚“ã€‚Ruby ã¯ Kibana, fluentd ãŒã€Java ã¯ ElasticSearch ãŒå¿…è¦ã¨ã—ã¾ã™ã€‚\nElasticSearch ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã‚ˆã‚Š ElasticSearch ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\nhttp://www.elasticsearch.org/download/\nç¾æ™‚ç‚¹ (2013/09/07) ã§æœ€æ–°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 0.90.3 ã§ã—ãŸã€‚\n% wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-0.90.3.deb % sudo dpkg -i elasticsearch-0.90.3.deb % sudo service elasticsearch start Kibana ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« Kibana ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ Gemfile ã«ã—ãŸãŒã£ã¦å¿…è¦ãªãƒ¢ãƒã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% git clone --branch=kibana-ruby https://github.com/rashidkpc/Kibana.git % sudo gem install bundler % cd Kibana % sudo bundle install % sudo gem install tzinfo-data KibanaConfig.rb ã® KibanaHost ã¯ãƒªã‚¹ãƒ³ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãªã‚‹ã®ã§ 0.0.0.0 ã«ä¿®æ­£sã¾ã™ã€‚\nKibanaHost = \u0026#39;0.0.0.0\u0026#39; Kibana ã‚’èµ·å‹•ã—ã¾ã™ã€‚\n% ruby kibana.rb == Sinatra/1.4.3 has taken the stage on 5601 for development with backup from Thin \u0026gt;\u0026gt; Thin web server (v1.5.1 codename Straight Razor) \u0026gt;\u0026gt; Maximum connections set to 1024 \u0026gt;\u0026gt; Listening on 0.0.0.0:5601, CTRL+C to stop fluentd ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« fluentd ã‚’ä¸‹è¨˜ã®é€šã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% sudo -i % curl -L http://toolbelt.treasure-data.com/sh/install-ubuntu-precise.sh | sh /etc/td-agent/td-agent.conf ã‚’ä¸‹è¨˜ã®é€šã‚Šã«ä¿®æ­£ã—ã¾ã™ã€‚ã‚µãƒ³ãƒ—ãƒ«ã§ Apache ã®ãƒ­ã‚° ã‚’ ElasticSearch ã«é£›ã°ã™è¨­å®šã«ã—ã¾ã™ã€‚\n\u0026lt;source\u0026gt; type tail format apache path /var/log/apache2/access.log tag kibana01.apache.access \u0026lt;/source\u0026gt; \u0026lt;match *.apache.*\u0026gt; index_name adminpack type_name apache type elasticsearch include_tag_key true tag_key @log_name host 10.0.1.8 port 9200 logstash_format true flush_interval 3s \u0026lt;/match\u0026gt; host ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã—ã¾ã™ã€‚\nfluentd ã‚’èµ·å‹•ã—ã¾ã™ã€‚\n% sudo service td-agent start Apache ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ã‚·ã‚¹ãƒ†ãƒ ã«å¿…è¦ãªã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã‚µãƒ³ãƒ—ãƒ«ã§ Apache ã®ãƒ­ã‚°ã‚’ fluentd çµŒç”± ã§é£›ã°ã—ã¦ Kibana ã§ç¢ºèªã—ãŸã„ã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% sudo apt-get install apache2 % sudo chown -R td-agent /var/log/apache2 ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ªãƒ¼ãƒŠã‚’ td-agent ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚\nãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ Apache2 ã®ãƒãƒ¼ãƒˆ 80 ã«ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãã®å¾Œ ãƒãƒ¼ãƒˆ 5601 ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ ã¨ Kibana ã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒãƒ¼ãƒˆ 80 ã®ã‚¢ã‚¯ã‚»ã‚¹ã«å¿œã˜ã¦çµæœãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚\n{% img /pix/kibana-cap.png %}\nã¾ã¨ã‚ LogStash ã§ã‚‚ä»Šåº¦è©¦ã—ã¦ã¿ãŸã„ã€‚ ã‚ã¨ API ã‚’ã©ã†å©ãã‹ã¯..\nhttp://www.elasticsearch.org/guide/reference/api/\nã«ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãŒã‚ã‚‹ã®ã§ã€æ™‚é–“ã‚’è¦‹ã¤ã‘ã¦ã‚„ã£ã¦ã¿ã‚‹ã€‚Apache ä»¥å¤–ã®ãƒ­ã‚°è»¢é€ã«ã¤ ã„ã¦ã¯ fluentd ã‚’è©³ç´°ã«çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€ãã¡ã‚‰ã‚‚æ™‚é–“ã‚’è¦‹ã¤ã‘ã¦ã‚„ã£ã¦ã¿ã‚‹ã€‚ kibana.rb ã‚’èµ·å‹•ã™ã‚‹ã‚‚ã£ã¨è‰¯ã„æ–¹æ³•ãŒãªã„ã‹ã‚‚èª¿ã¹ãªã„ã¨ã€‚\n2013.09.08è¿½è¨˜\n@nora96o ã•ã‚“ã«ã€ŒKibana3 ä½¿ã†ã¨å¹¸ã›ã«ãªã‚Œã¾ã™ã‚ˆï¼ã€ã¨æ•™ãˆã¦é ‚ã„ã¦æ—©é€Ÿ Kibana3 ã‚‚è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚\nhttp://jedipunkz.github.io/blog/2013/09/08/kibana3-plus-elasticsearch-plus-fluentd/\n","permalink":"https://jedipunkz.github.io/post/2013/09/07/kibana-plus-elasticsearch-plus-fluentd/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eè‡ªå‹•åŒ–ã®æµã‚Œã‚’æ¤œè¨ã™ã‚‹ä¸­ã§ãƒ­ã‚°è§£æã‚‚å¿˜ã‚Œã¦ã¯ã„ã‘ãªã„ã¨ã„ã†ã“ã¨ã§ ElasticSearch\nã‚’ä½¿ã„ãŸã„ãªãã¨ã¼ã‚“ã‚„ã‚Šè€ƒãˆã¦ã„ã¦ Logstash ã¨ã‹ Kibana ã¨ã‹ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚‚ç›®\nã«æ­¢ã¾ã‚‹ã‚ˆã†ã«ãªã£ã¦ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eElasticSaerch ã¯ API ã§æƒ…å ±ã‚’æ¤œç´¢å‡ºæ¥ãŸã‚Šã™ã‚‹ã®ã§è‡ªå‹•åŒ–ã«ã‚‚ã£ã¦ã“ã„ã€‚ãƒãƒƒã‚¯ã‚¨\nãƒ³ãƒ‰ã« Logstash ã‚’ä½¿ã£ã¦\u0026hellip; ã¨æ€ã£ã¦ãŸã®ã§ã™ãŒæœ€è¿‘ã‚ˆãèãã‚ˆã†ã«ãªã£ãŸ fluentd\nã‚’ãã‚ãã‚çœŸé¢ç›®ã«ä½¿ã„ãŸã„ï¼ã¨ã„ã†ã“ã¨ã§ã€ä»Šå›ã¯ Kibana + ElasticSearch +\nfluentd ã®çµ„ã¿åˆã‚ã›ã§ãƒ­ã‚°è§£æã‚·ã‚¹ãƒ†ãƒ ã‚’çµ„ã‚€æ–¹æ³•ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒã«ã•ã›ã¦é ‚ã„ãŸ-url\"\u003eå‚è€ƒã«ã•ã›ã¦é ‚ã„ãŸ URL\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"http://memocra.blogspot.jp/2013/04/kibanakibanaelasticsearchfluentd.html\"\u003ehttp://memocra.blogspot.jp/2013/04/kibanakibanaelasticsearchfluentd.html\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"å‰æã®ç’°å¢ƒ\"\u003eå‰æã®ç’°å¢ƒ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eOS : Ubuntu 12.04 Precise (åŒã˜æ–¹æ³•ã§ 13.04 Raring ã§ã‚‚å‡ºæ¥ã¾ã—ãŸ)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003eå¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’äº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo apt-get install git-core build-essential ruby1.9.3 openjdk-7-jdk\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ‰‹é †ã‚’çœããŸã‚ã« Ruby ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§å…¥ã‚Œã¾ã—ãŸã€‚ã¾ãŸ Java ã¯ä»–ã®ç‰©ã‚’åˆ©ç”¨ã—ã¦ã‚‚\næ§‹ã„ã¾ã›ã‚“ã€‚Ruby ã¯ Kibana, fluentd ãŒã€Java ã¯ ElasticSearch ãŒå¿…è¦ã¨ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"elasticsearch-ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003eElasticSearch ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã‚ˆã‚Š ElasticSearch ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.elasticsearch.org/download/\"\u003ehttp://www.elasticsearch.org/download/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eç¾æ™‚ç‚¹ (2013/09/07) ã§æœ€æ–°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 0.90.3 ã§ã—ãŸã€‚\u003c/p\u003e","title":"Kibana + ElasticSearch + fluentd ã‚’è©¦ã—ã¦ã¿ãŸ"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nè‡ªå®…ã® IPv6 åŒ–ã€ã—ãŸã„ãªãã¨ã¼ã‚“ã‚„ã‚Šè€ƒãˆã¦ã„ãŸã®ã§ã™ãŒã€Hurricane Electric Internet Services ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚IPv4 ã®å›ºå®šã‚°ãƒ­ãƒ¼ãƒãƒ« IP ã‚’æŒã£ã¦ã„ã‚Œã°èª°ã§ ã‚‚ IPv6 ã®ãƒˆãƒ³ãƒãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç„¡æ–™ã§å—ã‘ã‚‰ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚\n1ã¤ã®ãƒ¦ãƒ¼ã‚¶ã§5ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¾ã§å–å¾—ã§ã (5 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)ã€1ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ /64 ã® ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã‚‚ã‚‰ãˆã¾ã™ã€‚ã¾ãŸç”³è«‹ã•ãˆã™ã‚Œã° (ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã ã‘) /48 ã‚‚1ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ æ¯ã«ã‚‚ã‚‰ãˆã¾ã™ã€‚ã¤ã¾ã‚Š /48 x 5 + /64 x 5 \u0026hellip; ã§ã‹ï¼\nç§ã®å®…å†…ã¯ Vyatta ã§ PPPOE ã—ã¦ã‚‹ã®ã§ã™ãŒã€å„ç¨® OS (Debian, NetBSD\u0026hellip;) ã‚„æ©Ÿå™¨ (Cisco, JunOS..)ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•ç”Ÿæˆã—ã¦ãã‚Œã‚‹ã®ã§ã€æ¥ç¶šã™ã‚‹ã ã‘ ã§ã‚ã‚Œã°ãã‚Œã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«è²¼ã‚Šä»˜ã‘ã‚‹ã ã‘ï¼ã§ã™ã€‚\nã‚µãƒ¼ãƒ“ã‚¹ URL Hurricane Electric ã¯ä¸‹è¨˜ã® URL ã§ã™ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚‚ã“ã“ã§ä½œæˆå‡ºæ¥ã¾ã™ã€‚\nhttp://tunnelbroker.net\nIPv6 æ¥ç¶šæ€§ã‚’ç¢ºä¿ã™ã‚‹æ–¹æ³• Vyatta ãŒ IPv6 ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒã¡æ¥ç¶šæ€§ã‚’ç¢ºä¿ã™ã‚‹ã ã‘ã§ã‚ã‚Œã°ã€ä¸Šã«è¨˜ã—ãŸã‚ˆã†ã« ã‚³ãƒ”ãƒšã§å‡ºæ¥ã¾ã™ã€‚ä¸Šè¨˜ã® URL ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® \u0026ldquo;Create Regular Tunnel\u0026rdquo; ã‚’æŠ¼ã—ã¦ã€è‡ªåˆ†ã®æƒ…å ± (IPv4 ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ç­‰) ã‚’å…¥åŠ›ã—ã¾ã™ã€‚ãã®å¾Œã€å–å¾—ã—ãŸ IPv6 ã®ãƒ¬ãƒ³ã‚¸ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ä¸Šè¨˜ãƒ¡ãƒ‹ãƒ¥ãƒ¼ \u0026ldquo;Example Configuration\u0026rdquo; ã‚’é¸æŠã—ã¾ã™ã€‚ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒç¾ã‚Œã‚‹ã®ã§ã€è‡ªå®…ã® OS ã‚„æ©Ÿå™¨ã«åˆã£ãŸåå‰ã‚’é¸æŠã—ã¾ã™ã€‚\nã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ãŒãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«å‡ºåŠ›ã•ã‚Œã‚‹ã®ã§ã“ã‚Œã‚’ã‚³ãƒ”ãƒšã™ã‚‹\u0026hellip;ã  ã‘ã§ã™ã€‚\nconfigure edit interfaces tunnel tun0 set encapsulation sit set local-ip xxx.xxx.xxx.xxx set remote-ip xxx.xxx.xxx.xxx set address 2001:470:xx:xxx:2/64 set description \u0026#34;HE.NET IPv6 Tunnel\u0026#34; exit set protocols static interface-route6 ::/0 next-hop-interface tun0 commit ã‚³ãƒ”ãƒšã—ãŸã‚‰æ¥ç¶šã§ããŸã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚\n% ping6 ipv6.google.com -c 3 PING ipv6.google.com(2404:6800:4004:803::1010) 56 data bytes 64 bytes from 2404:6800:4004:803::1010: icmp_seq=1 ttl=59 time=32.6 ms 64 bytes from 2404:6800:4004:803::1010: icmp_seq=2 ttl=59 time=27.4 ms 64 bytes from 2404:6800:4004:803::1010: icmp_seq=3 ttl=59 time=20.5 ms --- ipv6.google.com ping statistics --- 3 packets transmitted, 3 received, 0% packet loss, time 2002ms rtt min/avg/max/mdev = 20.542/26.901/32.677/4.971 ms Vyatta é…ä¸‹ã®å®…å†… LAN ã®ç«¯æœ«ã‚’ IPv6 åŒ–ã™ã‚‹ ã“ã“ã¾ã§ã®æ“ä½œã ã¨ Vyatta ã¯ IPv6 ãƒˆãƒ³ãƒãƒ«æ¥ç¶šå‡ºæ¥ã¾ã—ãŸãŒã€ãã®é…ä¸‹ã®æ©Ÿå™¨ã¯ã¾ ã æ¥ç¶šã§ãã¦ã„ã¾ã›ã‚“ã€‚ãã“ã§ IPv6 RA (Router Advertise) ã—ã¾ã™ã€‚\nconfigure edit interfaces ethernet eth0 set ipv6 router-advert send-advert true set ipv6 router-advert cur-hop-limit 64 set ipv6 router-advert max-interval 10 set ipv6 router-advert other-config-flag true set ipv6 router-advert default-preference high set ipv6 router-advert managed-flag true set ipv6 router-advert prefix 2001:470:xx:xxx::/64 set ipv6 router-advert prefix 2001:470:xx:xxx::/64 autonomous-flag true commit ã“ã“ã§ RA ã®ã¿ã®èµ·å‹•ã‚’ã—ã¦ã„ã¾ã™ãŒã€LAN å†…ã« Windows ç«¯æœ«ãŒã‚ã‚‹å ´åˆã€IPv6 ãƒãƒ¼ ãƒ ã‚µãƒ¼ãƒã®æƒ…å ±ãŒå–å¾—ã§ããªã„ãŸã‚ DHCPv6 ã‚µãƒ¼ãƒã‚’åˆ¥é€”èµ·å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãŒã€ ç§ã® LAN å†…ã«ã¯ Mac, Linux, *BSD ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã®ã§èµ·å‹•ã—ã¾ã›ã‚“ã§ã—ãŸã€‚ å¿…è¦ã«å¿œã˜ã¦èµ·å‹•ã—ã¦ãã ã•ã„ã€‚\nIPv6 ãƒ•ã‚¡ã‚¤ã‚¢ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š ã“ã‚Œã§ç«¯æœ«ã‚‚ IPv6 ãƒˆãƒ³ãƒãƒ«æ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸï¼ã®ã§ã™ãŒã€å¤–éƒ¨ã‹ã‚‰ç«¯æœ«ã«ç›´æ¥ æ¥ç¶šãŒå‡ºæ¥ã¦ã—ã¾ã„ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ã‚¢ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¾ã—ã‚‡ã†ã€‚\nconfigure set firewall ipv6-name tun-in description \u0026#34;IPv6 Traffice to Internal\u0026#34; set firewall ipv6-name tun-in default-action drop set firewall ipv6-name tun-in rule 10 action accept set firewall ipv6-name tun-in rule 10 description \u0026#34;Accept Established-Related\u0026#34; set firewall ipv6-name tun-in rule 10 state established enable set firewall ipv6-name tun-in rule 10 state related enable set firewall ipv6-name tun-local default-action drop set firewall ipv6-name tun-local description \u0026#34;IPv6 Traffic to Router\u0026#34; set firewall ipv6-name tun-local rule 10 action accept set firewall ipv6-name tun-local rule 10 description \u0026#34;Accept Established-Related\u0026#34; set firewall ipv6-name tun-local rule 10 state established enable set firewall ipv6-name tun-local rule 10 state related enable set interface tunnel tun0 firewall in ipv6-name tun-in set interface tunnel tun0 firewall local ipv6-name tun-local commit save ã¾ã¨ã‚ ãƒ«ãƒ¼ã‚¿é…ä¸‹ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ IPv6 ã§å¤–éƒ¨ã«å…¬é–‹ã—ãŸã„å ´åˆã¯ tun-in ã®ãƒ•ã‚¡ã‚¤ã‚¢ãƒ¼ã‚¦ã‚©ãƒ¼ãƒ«ã« ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ã™ã‚Œã° OK ã§ã™ã€‚\nã¾ãŸè‡ªå‹•ç”Ÿæˆå‡ºæ¥ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾å¿œã—ãŸOS, æ©Ÿå™¨ã®ç¨®é¡ãŒè±Šå¯Œã§ã™ã€‚ pfSense ã‚„ Solaris, Windows, ScreenOS, Fortigate ç­‰ãªã©ã€å¤šå²ã«ã‚ãŸã£ã¦ã„ã‚‹ã® ã§ã€å¤§æŠµã®æ–¹ã¯å•é¡Œãªã„ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/09/01/hurricane-electric-vyatta-ipv6/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eè‡ªå®…ã® IPv6 åŒ–ã€ã—ãŸã„ãªãã¨ã¼ã‚“ã‚„ã‚Šè€ƒãˆã¦ã„ãŸã®ã§ã™ãŒã€Hurricane Electric\nInternet Services ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚IPv4 ã®å›ºå®šã‚°ãƒ­ãƒ¼ãƒãƒ« IP ã‚’æŒã£ã¦ã„ã‚Œã°èª°ã§\nã‚‚ IPv6 ã®ãƒˆãƒ³ãƒãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç„¡æ–™ã§å—ã‘ã‚‰ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e1ã¤ã®ãƒ¦ãƒ¼ã‚¶ã§5ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¾ã§å–å¾—ã§ã (5 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)ã€1ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ /64 ã®\nã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã‚‚ã‚‰ãˆã¾ã™ã€‚ã¾ãŸç”³è«‹ã•ãˆã™ã‚Œã° (ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã ã‘) /48 ã‚‚1ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ\næ¯ã«ã‚‚ã‚‰ãˆã¾ã™ã€‚ã¤ã¾ã‚Š /48 x 5 + /64 x 5 \u0026hellip; ã§ã‹ï¼\u003c/p\u003e\n\u003cp\u003eç§ã®å®…å†…ã¯ Vyatta ã§ PPPOE ã—ã¦ã‚‹ã®ã§ã™ãŒã€å„ç¨® OS (Debian, NetBSD\u0026hellip;) ã‚„æ©Ÿå™¨\n(Cisco, JunOS..)ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•ç”Ÿæˆã—ã¦ãã‚Œã‚‹ã®ã§ã€æ¥ç¶šã™ã‚‹ã ã‘\nã§ã‚ã‚Œã°ãã‚Œã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«è²¼ã‚Šä»˜ã‘ã‚‹ã ã‘ï¼ã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ã‚µãƒ¼ãƒ“ã‚¹-url\"\u003eã‚µãƒ¼ãƒ“ã‚¹ URL\u003c/h2\u003e\n\u003cp\u003eHurricane Electric ã¯ä¸‹è¨˜ã® URL ã§ã™ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚‚ã“ã“ã§ä½œæˆå‡ºæ¥ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://tunnelbroker.net\"\u003ehttp://tunnelbroker.net\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"ipv6-æ¥ç¶šæ€§ã‚’ç¢ºä¿ã™ã‚‹æ–¹æ³•\"\u003eIPv6 æ¥ç¶šæ€§ã‚’ç¢ºä¿ã™ã‚‹æ–¹æ³•\u003c/h2\u003e\n\u003cp\u003eVyatta ãŒ IPv6 ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒã¡æ¥ç¶šæ€§ã‚’ç¢ºä¿ã™ã‚‹ã ã‘ã§ã‚ã‚Œã°ã€ä¸Šã«è¨˜ã—ãŸã‚ˆã†ã«\nã‚³ãƒ”ãƒšã§å‡ºæ¥ã¾ã™ã€‚ä¸Šè¨˜ã® URL ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®\n\u0026ldquo;Create Regular Tunnel\u0026rdquo; ã‚’æŠ¼ã—ã¦ã€è‡ªåˆ†ã®æƒ…å ± (IPv4 ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ç­‰)\nã‚’å…¥åŠ›ã—ã¾ã™ã€‚ãã®å¾Œã€å–å¾—ã—ãŸ IPv6 ã®ãƒ¬ãƒ³ã‚¸ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ä¸Šè¨˜ãƒ¡ãƒ‹ãƒ¥ãƒ¼\n\u0026ldquo;Example Configuration\u0026rdquo; ã‚’é¸æŠã—ã¾ã™ã€‚ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒç¾ã‚Œã‚‹ã®ã§ã€è‡ªå®…ã®\nOS ã‚„æ©Ÿå™¨ã«åˆã£ãŸåå‰ã‚’é¸æŠã—ã¾ã™ã€‚\u003c/p\u003e","title":"Hurricane Electric + Vyatta ã§å®…å†… IPv6 åŒ–"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»¥å‰ã€ã“ã‚“ãªè¨˜äº‹ã‚’ãƒ–ãƒ­ã‚°ã«è¨˜ã—ã¾ã—ãŸã€‚2012/06 ã®è¨˜äº‹ã§ã™ã€‚\nhttp://jedipunkz.github.io/blog/2012/06/13/vyatta-vpn/\nãã®å¾Œã€PPTP ã§ä¿è­·ã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã® VPN ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¥ªå–å‡ºæ¥ã‚‹ãƒ„ãƒ¼ãƒ«ãŒå…¬é–‹ ã•ã‚Œã¾ã—ãŸã€‚2012/07 ã®ã“ã¨ã§ã™ã€‚ã‚ˆã£ã¦ä»Šã§ã¯ VPN ã« PPTP ã‚’ç”¨ã„ã‚‹ã“ã¨ãŒæ¨å¥¨ã• ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nã¨ã„ã†ã“ã¨ã§ L2TP over IPsec ã«ã‚ˆã‚‹ VPN æ§‹ç¯‰ã‚’ Vyatta ã§è¡Œã†æ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚\nfig.1 : home lan ã¨ vyatta ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ +--------+ +-----+ home lan ---| vyatta | --- the internet --- | CPE | +--------+ +-----+ X.X.X.X/X(NAT) pppoe0 Y.Y.Y.Y ã“ã®æ§˜ã« X.X.X.X/X ã¨ Y.Y.Y.Y/Y ãŒé–¢ä¿‚ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚CPE ã¯ VPN ã«ã‚ˆã‚Š X.X.X.X/X ã«æ¥ç¶šã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\næ‰‹é † : IPsec ä¸‹è¨˜ã®æ“ä½œã§ IPsec ã‚’å¾…ã¡å—ã‘ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®è¨­å®šã—ã¾ã™ã€‚\n% configure # edit vpn ipsec # set ipsec-interface interface pppoe0 ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åã¯ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã—ã¦ãã ã•ã„ã€‚ç§ã®ç’°å¢ƒã§ã¯ pppoe0 ã§ã™ã€‚\nIPsec ãƒ‘ã‚±ãƒƒãƒˆãŒ NAT ã‚’è¶…ãˆã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚\n# set nat-traversal enable CPE ãŒã©ã®ç’°å¢ƒã«ã„ã‚‹ã‹ã€IPsec æ¥ç¶šã‚’è¨±å¯ã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¾ã™ã€‚ æ¸¡ã—ã®å ´åˆã¯ã©ã“ã‹ã‚‰ã§ã‚‚æ¥ç¶šã§ãã‚‹ã‚ˆã† 0.0.0.0/0 ã‚’å…¥åŠ›ã—ã¾ã—ãŸã€‚\n# set nat-networks allowed-network 0.0.0.0/0 # exit æ‰‹é † : L2TP å…¥åŠ›ã‚’çœããŸã‚ã« edit ã—ã¾ã™ã€‚\n# edit vpn l2tp remote-access IPsec èªè¨¼ãƒ¢ãƒ¼ãƒ‰ã« pre-shared-secret ã‚’é¸æŠã— pre-shared-secret (ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰) ã‚’è¨­å®šã—ã¾ã™ã€‚ã“ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯æ¥ç¶šã™ã‚‹ãƒ¦ãƒ¼ã‚¶å…¨å“¡ãŒçŸ¥ã‚‹ã‚‚ã®ã§ã™ã€‚ã¾ãŸèªè¨¼ãƒ¢ãƒ¼ãƒ‰ ã‚’ local ã«è¨­å®šã—ã¾ã™ã€‚\n# set ipsec-settings authentication mode pre-shared-secret # set ipsec-settings authentication pre-shared-secret \u0026lt;ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰\u0026gt; # set authentication mode local æ¥ç¶šãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆã—ã¾ã™ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ãƒ¦ãƒ¼ã‚¶ã«åˆã‚ã›ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚å…ˆ ã»ã©è¨­å®šã—ãŸ pre-shared-secret ã¨ã¯åˆ¥ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ã¹ãã§ã™ã€‚\n# set authentication local-users username \u0026lt;ãƒ¦ãƒ¼ã‚¶å\u0026gt; password \u0026lt;ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰\u0026gt; æ¥ç¶šã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±ã‚’è¨˜ã—ã¾ã™ã€‚pool ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ã¯ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã— ã¦ãã ã•ã„ã€‚æ¸¡ã—ã®å ´åˆã¯ç¬¬4ã‚ªã‚¯ãƒ†ãƒƒãƒˆ 100 - 120 ã‚’è¨­å®šã—ã¾ã—ãŸã€‚\n# set outside-address Y.Y.Y.Y # set client-ip-pool start X.X.X.100 # set client-ip-pool stop X.X.X.120 æœ€å¾Œã« commit \u0026amp; save ã‚’å¿˜ã‚Œãšã«ã€‚\n# commit # save ã¾ã¨ã‚ iPhone ã§æ¥ç¶šã‚’ç¢ºèªã—ã¾ã—ãŸã€‚iOS ã®å ´åˆã¯ L2TP, PPTP, IPsec ã¨3ã¤ã®ã‚¿ãƒ–ãŒã‚ã‚Šã€ ã©ã‚Œã‹ã‚’é¸æŠã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ãŒã€L2TP over IPsec ã®å ´åˆã«ã¯ L2TP ã‚¿ãƒ–ã®é … ç›®ã«æƒ…å ±ã‚’å…¥åŠ›ã™ã‚Œã° OK ã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/08/24/vyatta-l2tp-ipsec-vpn/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥å‰ã€ã“ã‚“ãªè¨˜äº‹ã‚’ãƒ–ãƒ­ã‚°ã«è¨˜ã—ã¾ã—ãŸã€‚2012/06 ã®è¨˜äº‹ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://jedipunkz.github.io/blog/2012/06/13/vyatta-vpn/\"\u003ehttp://jedipunkz.github.io/blog/2012/06/13/vyatta-vpn/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eãã®å¾Œã€PPTP ã§ä¿è­·ã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã® VPN ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¥ªå–å‡ºæ¥ã‚‹ãƒ„ãƒ¼ãƒ«ãŒå…¬é–‹\nã•ã‚Œã¾ã—ãŸã€‚2012/07 ã®ã“ã¨ã§ã™ã€‚ã‚ˆã£ã¦ä»Šã§ã¯ VPN ã« PPTP ã‚’ç”¨ã„ã‚‹ã“ã¨ãŒæ¨å¥¨ã•\nã‚Œã¦ã„ã¾ã›ã‚“ã€‚\u003c/p\u003e\n\u003cp\u003eã¨ã„ã†ã“ã¨ã§ L2TP over IPsec ã«ã‚ˆã‚‹ VPN æ§‹ç¯‰ã‚’ Vyatta ã§è¡Œã†æ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"fig1--home-lan-ã¨-vyatta-ã®ã‚¢ãƒ‰ãƒ¬ã‚¹\"\u003efig.1 : home lan ã¨ vyatta ã®ã‚¢ãƒ‰ãƒ¬ã‚¹\u003c/h2\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e                +--------+                      +-----+\n    home lan ---| vyatta | --- the internet --- | CPE |\n                +--------+                      +-----+\n    X.X.X.X/X(NAT)     pppoe0\n                       Y.Y.Y.Y\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eã“ã®æ§˜ã« X.X.X.X/X ã¨ Y.Y.Y.Y/Y ãŒé–¢ä¿‚ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚CPE ã¯ VPN ã«ã‚ˆã‚Š\nX.X.X.X/X ã«æ¥ç¶šã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ‰‹é †--ipsec\"\u003eæ‰‹é † : IPsec\u003c/h2\u003e\n\u003cp\u003eä¸‹è¨˜ã®æ“ä½œã§ IPsec ã‚’å¾…ã¡å—ã‘ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®è¨­å®šã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% configure\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# edit vpn ipsec\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# set ipsec-interface interface pppoe0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åã¯ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã—ã¦ãã ã•ã„ã€‚ç§ã®ç’°å¢ƒã§ã¯ pppoe0 ã§ã™ã€‚\u003c/p\u003e","title":"Vyatta ã§ L2TP over IPsec ã«ã‚ˆã‚‹ VPN æ§‹ç¯‰"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™\nä»Šæ›´ãªã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€OpenStack ã® nova-network ã‚’ IPv6 å¯¾å¿œã™ã‚‹æ–¹æ³•ã‚’èª¿ã¹ ã¦ã¿ã¾ã—ãŸã€‚ä½•æ•… nova-network ãªã®ã‹? è‡ªå®…ã®æ§‹æˆãŒ nova-network ã ã‹ã‚‰ã§ã™..ã€‚ ä»¥å‰ã¯ Quantum (ç¾ Neutron) æ§‹æˆã§ä½¿ã£ã¦ã„ã¾ã—ãŸãŒã€ãƒãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¨ã‚³ãƒ³ ãƒ”ãƒ¥ãƒ¼ãƒˆã«åˆ¥ã‘ãŸæ™‚ã« NIC ãŒè¶³ã‚‰ãªããªã‚Š\u0026hellip;ã€‚\nã•ã¦æœ¬é¡Œã§ã™ã€‚ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚ã»ã¼ãã®ã¾ã¾ã®æ‰‹é †ã§ã™ãŒã€è‡ªåˆ†ã®ãŸ ã‚ã«ã‚‚ãƒ¡ãƒ¢ã§ã™ã€‚\nå‚è€ƒ URL http://docs.openstack.org/grizzly/openstack-compute/admin/content/configuring-compute-to-use-ipv6-addresses.html\nå‰æ OpenStack ã®æ§‹æˆã¯äºˆã‚æ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹ nova-network ã‚’ç”¨ã„ã¦ã„ã‚‹ æ§‹æˆã¯ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ã§ã‚‚è¤‡æ•°å°æ§‹æˆã§ã‚‚å¯èƒ½ æ‰‹é † nova ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒãƒ¼ãƒ‰ã§ python-netaddr ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã— ã¾ã™ã€‚ç§ã®å ´åˆã¯ rcbops ã® chef cookbooks ã§æ§‹ç¯‰ã—ãŸã®ã§ã™ãŒã€æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚\n% sudo apt-get install python-netaddr nova-network ãŒç¨¼åƒã—ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ã§ radvd ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ã“ã‚Œã¯ IPv6 ã‚’ Advertise ã—ã¦ã„ã‚‹ãƒ«ãƒ¼ã‚¿ç­‰ãŒäºˆã‚å‚™ã‚ã£ã¦ã„ã‚‹ç’°å¢ƒã§ã‚ã£ã¦ã‚‚ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸ /etc/radvd.conf ãŒåˆã‚ç„¡ã„ã®ã§ radvd å˜ä½“ã§ã¯ç¨¼åƒã— ã¾ã›ã‚“ãŒã€å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚OpenStack ã®å ´åˆ /var/lib/nova é…ä¸‹ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ãã‚Œã¾ã™ã€‚\n% sudo apt-get install radvd /etc/sysctl.conf ã«ä¸‹è¨˜ã®è¨˜è¿°ã‚’è¿½è¨˜ã—ã¾ã™ã€‚RA ã®å—ä¿¡ã¨ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¨±å¯ã— ã¦ã„ã¾ã™ã€‚\n% ${EDITOR} /etc/sysctl.conf net.ipv6.conf.default.forwarding=1 net.ipv6.conf.all.forwarding = 1 net.ipv6.conf.all.accept_ra = 1 % sudo sysctl -p nova ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å…¨ã¦ã®ãƒãƒ¼ãƒ‰ã§ /etc/nova.conf ã«ä¸‹è¨˜ã®è¡Œã‚’è¿½è¨˜ã— ã¾ã™ã€‚\n% sudo ${EDITOR} /etc/nova/nova.conf use_ipv6=true # \u0026lt;- è¿½è¨˜ nova ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚\n% cd /etc/init.d/; for i in $( ls nova-* ); do sudo service $i restart; done æ¬¡ã« IPv6 ã®ãƒ¬ãƒ³ã‚¸ã®ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ nova-manage ã‚³ãƒãƒ³ãƒ‰ã§ç”Ÿæˆã—ã¾ã™ã€‚ç’°å¢ƒã«ã‚ã£ãŸãƒ¬ãƒ³ã‚¸ã‚’ è¿½åŠ ã—ã¦ãã ã•ã„ã€‚\n% sudo nova-manage network create public --fixed_range_v4 x.x.x.x/24 \\ --fixed_range_v6 xxxx:xxx:xx:xxx::/64 --bridge=br300 --bridge_interface=eth0 \\ --dns1=8.8.8.8 --dns2=8.8.4.4 --multi_host=T ã“ã“ã§ IPv4 ã®ãƒ¬ãƒ³ã‚¸ã‚‚è¿½åŠ ã—ãªãã¦ã¯ãªã‚‰ãªã„ã‚ˆã†ã§ã™ã€‚IPv6 ã‚ªãƒ³ãƒªãƒ¼ã§ç”Ÿæˆã—ãŸã¨ã“ã‚ã€ nova-network ãŒä¸‹è¨˜ã®ã‚¨ãƒ©ãƒ¼ã‚’åã„ã¦ãƒãƒ³ã‚°ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸã€‚\nTRACE nova Stderr: \u0026#39;Error: an inet prefix is expected rather than \u0026#34;None\u0026#34;.\\n\u0026#39; ã¾ãŸä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç”Ÿæˆæ™‚ã«æŒ‡å®šã—ãŸç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åã¯ IPv6 ãŒé€šä¿¡å‡ºæ¥ã‚‹ ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ã‚‚ã®ã‚’åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚(ç’°å¢ƒã«åˆã‚ã›ã¦ãã ã•ã„)\nã‚ã¨ã¯ nova boot ã§ä»®æƒ³ãƒã‚·ãƒ³ã‚’ç”Ÿæˆã™ã‚‹ã¨ IPv4, IPv6 ã®ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã§èµ·å‹•ã—ã¦ãã¾ã™ã€‚\nã¾ã¨ã‚ OpenStack å¤–ã®æ§‹æˆã«ã¤ã„ã¦ã‚‚ IPv6 ã«ã‚‚ã¡ã‚ã‚“å¯¾å¿œã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¸Šè¨˜ã®ä¾‹ã ã¨ OpenStack ã® eth0 å´ã® IPv6 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’é©åˆ‡ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã—ã¦ãã‚Œã‚‹ãƒ«ãƒ¼ã‚¿ãŒå¿…è¦ã§ã™ã€‚ è‡ªåˆ†ã®å ´åˆã¯è‡ªå®…ã§ Vyatta ã‚’ä½¿ã£ã¦è¡Œã„ã¾ã—ãŸã€‚(ä»Šåº¦ãã®æ–¹æ³•ã‚‚è¨˜ãã†ã¨æ€ã„ã¾ã™) ã¾ãŸ floating ip ã¯ IPv6 ã«ã¯å¯¾å¿œã—ã¦ã„ãªã„ãã†ã§ã™ã€‚ã¯ã˜ã‚ã“ã®æ–¹æ³•ã‚’å–ã‚ã†ã¨æ€ã£ãŸã®ã§ã™ãŒãƒ€ãƒ¡ã§ã—ãŸã€‚ ä¸Šè¨˜ã®ã‚ˆã†ã« public ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å´ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ãƒ–ãƒªãƒƒã‚¸ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã—ã¦ public ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç”Ÿæˆã™ã‚‹æ–¹æ³•ã§å¯¾å¿œå‡ºæ¥ã¾ã™ã®ã§å•é¡Œãªã„ã‹ã¨ã€‚\nã¾ãŸã€Neutron æ§‹æˆã§ã‚‚ä»Šåº¦ IPv6 å¯¾å¿œã—ã¦ã¿ãªã„ã¨ã€‚:D\n","permalink":"https://jedipunkz.github.io/post/2013/08/18/openstack-nova-network-ipv6/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™\u003c/p\u003e\n\u003cp\u003eä»Šæ›´ãªã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€OpenStack ã® nova-network ã‚’ IPv6 å¯¾å¿œã™ã‚‹æ–¹æ³•ã‚’èª¿ã¹\nã¦ã¿ã¾ã—ãŸã€‚ä½•æ•… nova-network ãªã®ã‹? è‡ªå®…ã®æ§‹æˆãŒ nova-network ã ã‹ã‚‰ã§ã™..ã€‚\nä»¥å‰ã¯ Quantum (ç¾ Neutron) æ§‹æˆã§ä½¿ã£ã¦ã„ã¾ã—ãŸãŒã€ãƒãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¨ã‚³ãƒ³\nãƒ”ãƒ¥ãƒ¼ãƒˆã«åˆ¥ã‘ãŸæ™‚ã« NIC ãŒè¶³ã‚‰ãªããªã‚Š\u0026hellip;ã€‚\u003c/p\u003e\n\u003cp\u003eã•ã¦æœ¬é¡Œã§ã™ã€‚ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚ã»ã¼ãã®ã¾ã¾ã®æ‰‹é †ã§ã™ãŒã€è‡ªåˆ†ã®ãŸ\nã‚ã«ã‚‚ãƒ¡ãƒ¢ã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒ-url\"\u003eå‚è€ƒ URL\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"http://docs.openstack.org/grizzly/openstack-compute/admin/content/configuring-compute-to-use-ipv6-addresses.html\"\u003ehttp://docs.openstack.org/grizzly/openstack-compute/admin/content/configuring-compute-to-use-ipv6-addresses.html\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"å‰æ\"\u003eå‰æ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eOpenStack ã®æ§‹æˆã¯äºˆã‚æ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹\u003c/li\u003e\n\u003cli\u003enova-network ã‚’ç”¨ã„ã¦ã„ã‚‹\u003c/li\u003e\n\u003cli\u003eæ§‹æˆã¯ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ã§ã‚‚è¤‡æ•°å°æ§‹æˆã§ã‚‚å¯èƒ½\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"æ‰‹é †\"\u003eæ‰‹é †\u003c/h2\u003e\n\u003cp\u003enova ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒãƒ¼ãƒ‰ã§ python-netaddr ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—\nã¾ã™ã€‚ç§ã®å ´åˆã¯ rcbops ã® chef cookbooks ã§æ§‹ç¯‰ã—ãŸã®ã§ã™ãŒã€æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\nã•ã‚Œã¦ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo apt-get install python-netaddr\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003enova-network ãŒç¨¼åƒã—ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ã§ radvd ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ã“ã‚Œã¯\nIPv6 ã‚’ Advertise ã—ã¦ã„ã‚‹ãƒ«ãƒ¼ã‚¿ç­‰ãŒäºˆã‚å‚™ã‚ã£ã¦ã„ã‚‹ç’°å¢ƒã§ã‚ã£ã¦ã‚‚ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼\nãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸ /etc/radvd.conf ãŒåˆã‚ç„¡ã„ã®ã§ radvd å˜ä½“ã§ã¯ç¨¼åƒã—\nã¾ã›ã‚“ãŒã€å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚OpenStack ã®å ´åˆ /var/lib/nova é…ä¸‹ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼\nã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ãã‚Œã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo apt-get install radvd\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e/etc/sysctl.conf ã«ä¸‹è¨˜ã®è¨˜è¿°ã‚’è¿½è¨˜ã—ã¾ã™ã€‚RA ã®å—ä¿¡ã¨ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¨±å¯ã—\nã¦ã„ã¾ã™ã€‚\u003c/p\u003e","title":"OpenStack nova-network IPv6 å¯¾å¿œ"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nrcbops Cookbooks ã§ Neutron æ§‹æˆã® OpenStack ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’æ›¸ããŸã„ã¨æ€ ã„ã¾ã™ã€‚å…ˆæ—¥ç´¹ä»‹ã—ãŸ openstack-chef-repo ã«ã‚‚ Neutron ã®ãƒ¬ã‚·ãƒ”ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã® ã§ã™ãŒã€ã¾ã ã¾ã æœªå®Œæˆã§æ‰‹ä½œæ¥­ã‚’ãŠã‚Šã¾ãœãªãŒã‚‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ãªã£ã¦ã„ã¾ã†ã®ã§ã€ä»Š ç¾åœ¨ã®ã¨ã“ã‚ Neutron æ§‹æˆã‚’çµ„ã¿ãŸã„ã®ã§ã‚ã‚Œã°ã“ã® rcbops ã® Cookbooks ã‚’ç”¨ã„ã‚‹ ã—ã‹ãªã„ã¨æ€ã„ã¾ã™ã€‚\nä»Šå›ã¯ VLAN ãƒ¢ãƒ¼ãƒ‰ã®æ§‹ç¯‰ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚GRE ãƒ¢ãƒ¼ãƒ‰ã‚‚å°‘ã—æ‰‹é †ã‚’ä¿®æ­£ã™ã‚Œã°æ§‹æˆå¯èƒ½ ã§ã™ã€‚æœ€å¾Œã®ã¾ã¨ã‚ã« GRE ãƒ¢ãƒ¼ãƒ‰ã®æ§‹ç¯‰ã«ã¤ã„ã¦å°‘ã—è§¦ã‚Œã¦ã„ã¾ã™ã€‚\næ§‹æˆ public network +----------------+----------------+----------------+----------------+---------------- | | | +--------------+ +--------------+ +--------------+ +--------------+ +--------------+ | controller01 | | network01 | | network02 | | compute01 | | compute02 | +--------------+ +-------+------+ +-------+------+ +-------+------+ +-------+------+ | | | | | | | | | management network +----------------+-------o--------+-------o--------+-------o--------+-------o-------- | | | | vm network +----------------+----------------+----------------+-------- ç‰¹å¾´ã¯\u0026hellip;\nnetwork ãƒãƒ¼ãƒ‰ 2å° (ä½•å°ã§ã‚‚å¯) compute ãƒãƒ¼ãƒ‰ 2å° (ä½•å°ã§ã‚‚å¯) api ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ management ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã«å±•é–‹ (åˆ¥ã‘ã¦ã‚‚å¯) controller ãƒãƒ¼ãƒ‰ã¯1å° (ha ãª cookbooks ã‚’ä½¿ã†ã®ã§2å°æ§‹æˆã‚‚å¯) å›³ã«ã¯è¡¨ç¾ã•ã‚Œã¦ã„ã¾ã›ã‚“ãŒ management ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã« Chef ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¨ Chef ã‚µãƒ¼ãƒãŒå¿…è¦ ç‰©ç† NIC ã®ãƒãƒƒãƒ”ãƒ³ã‚°æƒ…å ± controller : management(eth0), public(eth1) network : management(eth0), vm(eth1), public(eth2) compute : management(eth0), vm(eth1) å‰æã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæƒ…å ± ã“ã“ã§ã¯ä»®ã«ä¸‹è¨˜ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’å‰æã¨ã—ã¦æ‰‹é †ã‚’è¨˜ã—ã¾ã™ã€‚\npublic ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ : 10.0.0.0/24 vm ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ : 10.0.1.0/24 management(api) ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ : 10.0.2.0/24 ãƒ‡ãƒ—ãƒ­ã‚¤ã®æº–å‚™ Chef çš„ãªãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç«¯æœ«ã‹ã‚‰æ“ä½œã‚’è¡Œã„ã¾ã™ã€‚çš†ã•ã‚“ã®ä½¿ã£ã¦ã„ã‚‹ãƒãƒ¼ãƒˆ PC ç­‰ã§ OK ã§ã™ã€‚\n% git clone https://github.com/rcbops/chef-cookbooks.git ~/chef-repo % cd ~/chef-repo v4.0.0 (å®‰å®šã—ãŸæœ€æ–°ç‰ˆ) ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚\n% git checkout v4.0.0 % git submodule init % git submodule sync % git submodule update Chef ã‚µãƒ¼ãƒã« Cookbooks ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\n% knife cookbook upload -o cookbooks -a Chef ã‚µãƒ¼ãƒã« Roles ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\n% knife role from file roles/*rb environment ã‚’ json å½¢å¼ã§ç”Ÿæˆã—ã¾ã™ã€‚ã“ã‚Œã¯å„ Cookbooks ã® attributes ã‚’ä¸Šæ›¸ãã—ã€ä¸€ã¤ã®æ§‹æˆ ã‚’ä½œã‚‹ãŸã‚ã«ç”¨ã„ã‚‰ã‚Œã¾ã™ã€‚\n% ${EDITOR} environments/env-neutron.json { \u0026#34;name\u0026#34;: \u0026#34;env-neutron\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;cookbook_versions\u0026#34;: { }, \u0026#34;json_class\u0026#34;: \u0026#34;Chef::Environment\u0026#34;, \u0026#34;chef_type\u0026#34;: \u0026#34;environment\u0026#34;, \u0026#34;default_attributes\u0026#34;: { }, \u0026#34;override_attributes\u0026#34;: { \u0026#34;package_component\u0026#34;: \u0026#34;grizzly\u0026#34;, \u0026#34;osops_networks\u0026#34;: { \u0026#34;management\u0026#34;: \u0026#34;10.0.2.0/24\u0026#34;, \u0026#34;public\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34;, \u0026#34;nova\u0026#34;: \u0026#34;10.0.2.0/24\u0026#34; }, \u0026#34;nova\u0026#34;: { \u0026#34;config\u0026#34;: { \u0026#34;use_single_default_gateway\u0026#34;: false, \u0026#34;ram_allocation_ratio\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;cpu_allocation_ratio\u0026#34;: \u0026#34;16\u0026#34; }, \u0026#34;network\u0026#34;: { \u0026#34;provider\u0026#34;: \u0026#34;quantum\u0026#34;, \u0026#34;network_type\u0026#34;: \u0026#34;vlan\u0026#34; }, \u0026#34;apply_patches\u0026#34;: true, \u0026#34;libvirt\u0026#34;: { \u0026#34;vncserver_listen\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;virt_type\u0026#34;: \u0026#34;kvm\u0026#34; }, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;nova\u0026#34; }, \u0026#34;services\u0026#34;: { \u0026#34;novnc-proxy\u0026#34;: { \u0026#34;network\u0026#34;: \u0026#34;public\u0026#34; } } }, \u0026#34;cinder\u0026#34;: { \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;cinder\u0026#34; } }, \u0026#34;keystone\u0026#34;: { \u0026#34;admin_user\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;tenants\u0026#34;: [ \u0026#34;admin\u0026#34;, \u0026#34;service\u0026#34; ], \u0026#34;users\u0026#34;: { \u0026#34;admin\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;admin\u0026#34;: [ \u0026#34;admin\u0026#34; ] } }, \u0026#34;demo\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;demo\u0026#34;, \u0026#34;default_tenant\u0026#34; : \u0026#34;service\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;service\u0026#34;: [ \u0026#34;service\u0026#34; ] } } }, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;keystone\u0026#34; } }, \u0026#34;horizon\u0026#34;: { \u0026#34;theme\u0026#34;: \u0026#34;Default\u0026#34;, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;horizon\u0026#34; } }, \u0026#34;mysql\u0026#34;: { \u0026#34;root_network_acl\u0026#34;: \u0026#34;%\u0026#34;, \u0026#34;allow_remote_root\u0026#34;: true, \u0026#34;server_root_password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;server_repl_password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;server_debian_password\u0026#34;: \u0026#34;secrete\u0026#34; }, \u0026#34;monitoring\u0026#34;: { \u0026#34;procmon_provider\u0026#34;: \u0026#34;monit\u0026#34;, \u0026#34;metric_provider\u0026#34;: \u0026#34;collectd\u0026#34; }, \u0026#34;glance\u0026#34;: { \u0026#34;images\u0026#34;: [ \u0026#34;precise\u0026#34;, \u0026#34;cirros\u0026#34; ], \u0026#34;image\u0026#34;: { }, \u0026#34;image_upload\u0026#34;: false, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;glance\u0026#34; } }, \u0026#34;quantum\u0026#34;: { \u0026#34;service_pass\u0026#34;: \u0026#34;quantum\u0026#34;, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;quantum\u0026#34; } }, \u0026#34;developer_mode\u0026#34;: false } } ç”Ÿæˆã—ãŸ environment ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ Chef ã‚µãƒ¼ãƒã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\n% knife environment from file environments/env-neutron.json ãƒ‡ãƒ—ãƒ­ã‚¤ å„ãƒãƒ¼ãƒ‰ã€ä¸‹è¨˜ã®é€šã‚Šãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\ncontroller ãƒãƒ¼ãƒ‰ % knife bootstrap \u0026lt;ip_of_controller01\u0026gt; -N controller01 -r \\ \u0026#39;role[ha-controller1]\u0026#39;,\u0026#39;role[cinder-volume]\u0026#39; -E env-neutron --sudo -x \u0026lt;your_accout\u0026gt; cinder-volumes ç”¨ã®ãƒ‡ã‚£ã‚¹ã‚¯ãŒã‚ã‚‹å ´åˆã¯ä¸‹è¨˜ã®æ‰‹é †ã§ Cinder ãŒåˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã« ãªã‚Šã¾ã™ã€‚\n% sudo pvcreate /dev/sdb #ãƒ‡ãƒã‚¤ã‚¹åã¯ä»® % sudo vgcreate cinder-volumes /dev/sdb % sudo service cinder-volume restart network ãƒãƒ¼ãƒ‰ % knife bootstrap \u0026lt;ip_of_network01\u0026gt; -N network01 -r \\ \u0026#39;role[single-network-node]\u0026#39;,\u0026#39;recipe[nova-network::quantum-l3-agent]\u0026#39; \\ -E env-neutron --sudo -x \u0026lt;your_account\u0026gt; % knife bootstrap \u0026lt;ip_of_network02\u0026gt; -N network02 -r \\ \u0026#39;role[single-network-node]\u0026#39;,\u0026#39;recipe[nova-network::quantum-l3-agent]\u0026#39; \\ -E env-neutron --sudo -x \u0026lt;your_account\u0026gt; compute ãƒãƒ¼ãƒ‰ % knife bootstrap \u0026lt;ip_of_compute01\u0026gt; -N compute01 -r \u0026#39;role[single-compute]\u0026#39; \\ -E env-neutron --sudo -x \u0026lt;your_account\u0026gt; % knife bootstrap \u0026lt;ip_of_compute02\u0026gt; -N compute02 -r \u0026#39;role[single-compute]\u0026#39; \\ -E env-neutron --sudo -x \u0026lt;your_account\u0026gt; ç‰©ç† NIC ã®ãƒ–ãƒªãƒƒã‚¸ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°æ“ä½œ Open vSwitch ãŒç®¡ç†ã—ã¦ã„ã‚‹ãƒ–ãƒªãƒƒã‚¸ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ç‰©ç†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ãƒãƒƒ ãƒ”ãƒ³ã‚°ã—ã¦ã‚ã’ã¾ã™ã€‚\nnetwork ãƒãƒ¼ãƒ‰ã®2å°ã«ã¦ä¸‹è¨˜ã®æ“ä½œã‚’è¡Œã„ã¾ã™ã€‚\n% sudo ovs-vsctl add-port br-eth1 eth1 % sudo ovs-vsctl add-port br-ex eth2 compute ãƒãƒ¼ãƒ‰ã®2å°ã«ã¦ä¸‹è¨˜ã®æ“ä½œã‚’è¡Œã„ã¾ã™ã€‚\n% sudo ovs-vsctl add-port br-eth1 eth1 ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ä»®æƒ³ãƒã‚·ãƒ³ã®ç”Ÿæˆ ç’°å¢ƒã«ã‚ˆã£ã¦ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ§‹æˆãŒç•°ãªã‚Šã¾ã™ã®ã§æ‰‹é †ã¯å‰²æ„›ã—ã¾ã™ãŒã€Horizon ã‹ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»API ã‚’ä½¿ã£ã¦ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç”Ÿæˆã—ä»®æƒ³ãƒã‚·ãƒ³ã‚’æ¥ç¶šã™ã‚Œã°å®Œ äº†ã§ã™ã€‚\nã¾ã¨ã‚ network ãƒãƒ¼ãƒ‰ã‚’2å°æ§‹æˆã«ã—ã¾ã—ãŸãŒä½•ãŒå¬‰ã—ã„ã‹ã¨è¨€ã†ã¨ã€l3-agent, dhcp-agent ã‚’å†—é•·å–ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚éšœå®³æ™‚ã€æ‰‹ä½œæ¥­ã«ãªã‚Šã¾ã™ãŒåˆ‡ã‚Šæ›¿ãˆãŒå¯èƒ½ã§ã™ã€‚ l3-agent ã¯ä»®æƒ³ãƒ«ãƒ¼ã‚¿æ¯ã«ã€dhcp-agent ã¯ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¯ã«åˆ‡ã‚Šæ›¿ãˆãŒå¯èƒ½ã§ã™ã€‚ è©³ã—ãã¯ç§ã®ä»¥å‰ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚\nhttp://jedipunkz.github.io/blog/2013/04/26/quantum-network-distributing/\nã¾ãŸã€compute ãƒãƒ¼ãƒ‰ã‚’æ›´ã«å¢—ã‚„ã›ã°ä»®æƒ³ãƒã‚·ãƒ³ã®æ•°ã‚’å¢—ã‚„ã™ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\nä»Šå›ã¯ controller ãƒãƒ¼ãƒ‰ã‚’1å°æ§‹æˆã«ã—ã¾ã—ãŸãŒã€æ›´ã«ä¸‹è¨˜ã®æ‰‹é †ã§ controller02 ãƒãƒ¼ãƒ‰ã‚’å¢—ã‚„ã— controller ãƒãƒ¼ãƒ‰ã® HA åŒ–ã‚’è¡Œã†ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚\n% knife bootstrap \u0026lt;ip_of_controller02\u0026gt; -N controller02 -r \\ \u0026#39;role[ha-controller1]\u0026#39; -E env-neutron --sudo -x \u0026lt;your_accout\u0026gt; HA æ§‹æˆã‚’å„ã€…ã®ãƒãƒ¼ãƒ‰ã«æ§‹æˆã•ã›ã‚‹ãŸã‚å„ãƒãƒ¼ãƒ‰ã§ chef-client ã‚’1å›ãšã¤å®Ÿè¡Œã—ã¾ ã™ã€‚\ncontroller01% sudo chef-client controller02% sudo chef-client HA æ§‹æˆã¯ haproxy, keepalived ã§å½¢æˆã•ã‚Œã¦ã„ã¾ã™ã€‚\nã¾ãŸã€environment ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«ä¿®æ­£ã™ã‚‹ã¨ VLAN ã®ä»£ã‚ã‚Šã« GRE ãƒˆãƒ³ãƒ ãƒ«ãŒæ‰±ãˆã¾ã™ã€‚\n\u0026#34;nova\u0026#34;: { \u0026#34;network\u0026#34;: { \u0026#34;provider\u0026#34;: \u0026#34;quantum\u0026#34;, \u0026#34;network_type\u0026#34;: \u0026#34;gre\u0026#34; } }, \u0026lt;snip\u0026gt;... \u0026#34;quantum\u0026#34;: { \u0026#34;ovs\u0026#34;: { \u0026#34;network_type\u0026#34; : \u0026#34;gre\u0026#34;, \u0026#34;tunnnel_range\u0026#34; : \u0026#34;1:1000\u0026#34; } }, ä»¥ä¸Šã§ã™ã€‚roles ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«æ§˜ã€…ãª Roles ãŒã‚ã‚‹ã®ã§ã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ¯ ã«ãƒãƒ¼ãƒ‰ã‚’åˆ¥ã‘ã‚‹ãªã©ã®æ§‹æˆã‚‚å¯èƒ½ãã†ã§ã™ã€‚çš†ã•ã‚“è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/08/16/rcbops-cookbooks-neutron-openstack/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003ercbops Cookbooks ã§ Neutron æ§‹æˆã® OpenStack ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’æ›¸ããŸã„ã¨æ€\nã„ã¾ã™ã€‚å…ˆæ—¥ç´¹ä»‹ã—ãŸ openstack-chef-repo ã«ã‚‚ Neutron ã®ãƒ¬ã‚·ãƒ”ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã®\nã§ã™ãŒã€ã¾ã ã¾ã æœªå®Œæˆã§æ‰‹ä½œæ¥­ã‚’ãŠã‚Šã¾ãœãªãŒã‚‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ãªã£ã¦ã„ã¾ã†ã®ã§ã€ä»Š\nç¾åœ¨ã®ã¨ã“ã‚ Neutron æ§‹æˆã‚’çµ„ã¿ãŸã„ã®ã§ã‚ã‚Œã°ã“ã® rcbops ã® Cookbooks ã‚’ç”¨ã„ã‚‹\nã—ã‹ãªã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ VLAN ãƒ¢ãƒ¼ãƒ‰ã®æ§‹ç¯‰ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚GRE ãƒ¢ãƒ¼ãƒ‰ã‚‚å°‘ã—æ‰‹é †ã‚’ä¿®æ­£ã™ã‚Œã°æ§‹æˆå¯èƒ½\nã§ã™ã€‚æœ€å¾Œã®ã¾ã¨ã‚ã« GRE ãƒ¢ãƒ¼ãƒ‰ã®æ§‹ç¯‰ã«ã¤ã„ã¦å°‘ã—è§¦ã‚Œã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h2\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e                                                                                 public network\n+----------------+----------------+----------------+----------------+----------------\n|                |                |                                  \n+--------------+ +--------------+ +--------------+ +--------------+ +--------------+\n| controller01 | |  network01   | |  network02   | |  compute01   | |  compute02   |\n+--------------+ +-------+------+ +-------+------+ +-------+------+ +-------+------+\n|                |       |        |       |        |       |        |       |    management network\n+----------------+-------o--------+-------o--------+-------o--------+-------o--------\n                         |                |                |                |    vm network\n                         +----------------+----------------+----------------+--------\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eç‰¹å¾´ã¯\u0026hellip;\u003c/p\u003e","title":"rcbops Cookbooks ã§ Neutron æ§‹æˆ OpenStack"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šæ—¥ã‚‚è»½ã‚ã®è©±é¡Œã‚’ã€‚\nGmail ã‚’ Emacs + Mew ã§èª­ã¿æ›¸ãã™ã‚‹æ–¹æ³•ã‚’ä½•æ•…ã‹ã„ã¤ã‚‚å¿˜ã‚Œã¦ã—ã¾ã†ã®ã§è‡ªåˆ†ã®ãŸ ã‚ã«ã‚‚ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚Gmail ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã§èª­ã¿æ›¸ãå‡ºæ¥ã‚‹ã®ã«ï¼ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã— ã‚Œã¾ã›ã‚“ãŒã€Emacs ã§æ–‡ç« ãŒæ›¸ã‘ã‚‹ã®ã¯é‡è¦ãªã“ã¨ã§ã™ã€‚:D\nå¯¾è±¡ OS æ¯”è¼ƒçš„æ–°ã—ã„\u0026hellip;\nDebian Gnu/Linux Ubuntu ã‚’ä½¿ã„ã¾ã™ã€‚\næ‰‹é † Emacs, Mew, stunnel4 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚Emacs ã¯å¥½ããªç‰©ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚\n% sudo apt-get install emacs24-nox stunnel4 mew mew-bin ca-certificates openssl ã‚³ãƒãƒ³ãƒ‰ã§ mail.pem ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ç”Ÿæˆã—ãŸã‚‚ã®ã‚’ /etc/stunnel é…ä¸‹ã«è¨­ ç½®ã—ã¾ã™ã€‚\n% openssl req -new -out mail.pem -keyout mail.pem -nodes -x509 -days 365 % sudo cp mail.pem /etc/stunnel/ stunnel ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç›´å¾Œã€èµ·å‹•ã—ã¦ãã‚Œãªã„ã®ã§ ENABLE=1 ã«ä¿®æ­£ã—ã¾ã™ã€‚\n% sudo ${EDITOR} /etc/default/stunnel4 ENABLE=1 # 0 -\u0026gt; 1 ã¸å¤‰æ›´ stunenl.conf ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ /etc/stunnel é…ä¸‹ã«è¨­ç½®ã—ã¾ã™ã€‚\n% sudo cp /usr/share/doc/stunnel4/examples/stunnel.conf-sample /etc/stunnel/stunnel.conf $HOME/.mew.el ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ãªã©ã‚’å…¥åŠ›ã—ã¾ã™ã€‚\n; Stunnel (setq mew-prog-ssl \u0026#34;/usr/bin/stunnel4\u0026#34;) ; IMAP for Gmail (setq mew-proto \u0026#34;%\u0026#34;) (setq mew-imap-server \u0026#34;imap.gmail.com\u0026#34;) (setq mew-imap-user \u0026#34;example@gmail.com\u0026#34;) (setq mew-imap-auth t) (setq mew-imap-ssl t) (setq mew-imap-ssl-port \u0026#34;993\u0026#34;) (setq mew-smtp-auth t) (setq mew-smtp-ssl t) (setq mew-smtp-ssl-port \u0026#34;465\u0026#34;) (setq mew-smtp-user \u0026#34;example@gmail.com\u0026#34;) (setq mew-smtp-server \u0026#34;smtp.gmail.com\u0026#34;) (setq mew-fcc \u0026#34;%Sent\u0026#34;) ; é€ä¿¡ãƒ¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ (setq mew-imap-trash-folder \u0026#34;%[Gmail]/ã‚´ãƒŸç®±\u0026#34;) (setq mew-use-cached-passwd t) (setq mew-ssl-verify-level 0) $HOME/.emacs.d/init.el ã« Mew ã®è¨˜è¿°ã‚’è¿½è¨˜ã—ã¾ã™ã€‚\n(autoload \u0026#39;mew \u0026#34;mew\u0026#34; nil t) (autoload \u0026#39;mew-send \u0026#34;mew\u0026#34; nil t) (setq mew-fcc \u0026#34;+outbox\u0026#34;) ; é€ä¿¡ãƒ¡ãƒ¼ãƒ«ã‚’ä¿å­˜ (setq exec-path (cons \u0026#34;/usr/bin\u0026#34; exec-path)) Emacs + Mew ã‚’èµ·å‹•ã—ã¾ã™ã€‚\n% emacs -e mew ã¾ã¨ã‚ ä»¥ä¸Šã§ã™ã€‚ä»–ã® distro ã ã¨ ca-certificate ã¨ã‹ç„¡ã„ã®ã§ã€å¤§å¤‰ã ãªãã¨ã„ã¤ã‚‚æ€ã£ ã¦ã—ã¾ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/08/12/emacs-mew-gmail/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šæ—¥ã‚‚è»½ã‚ã®è©±é¡Œã‚’ã€‚\u003c/p\u003e\n\u003cp\u003eGmail ã‚’ Emacs + Mew ã§èª­ã¿æ›¸ãã™ã‚‹æ–¹æ³•ã‚’ä½•æ•…ã‹ã„ã¤ã‚‚å¿˜ã‚Œã¦ã—ã¾ã†ã®ã§è‡ªåˆ†ã®ãŸ\nã‚ã«ã‚‚ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚Gmail ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã§èª­ã¿æ›¸ãå‡ºæ¥ã‚‹ã®ã«ï¼ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—\nã‚Œã¾ã›ã‚“ãŒã€Emacs ã§æ–‡ç« ãŒæ›¸ã‘ã‚‹ã®ã¯é‡è¦ãªã“ã¨ã§ã™ã€‚:D\u003c/p\u003e\n\u003ch2 id=\"å¯¾è±¡-os\"\u003eå¯¾è±¡ OS\u003c/h2\u003e\n\u003cp\u003eæ¯”è¼ƒçš„æ–°ã—ã„\u0026hellip;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDebian Gnu/Linux\u003c/li\u003e\n\u003cli\u003eUbuntu\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã‚’ä½¿ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ‰‹é †\"\u003eæ‰‹é †\u003c/h2\u003e\n\u003cp\u003eEmacs, Mew, stunnel4 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚Emacs ã¯å¥½ããªç‰©ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo apt-get install emacs24-nox stunnel4 mew mew-bin ca-certificates\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eopenssl ã‚³ãƒãƒ³ãƒ‰ã§ mail.pem ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ç”Ÿæˆã—ãŸã‚‚ã®ã‚’ /etc/stunnel é…ä¸‹ã«è¨­\nç½®ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% openssl req -new -out mail.pem -keyout mail.pem -nodes -x509 -days \u003cspan style=\"color:#ae81ff\"\u003e365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo cp mail.pem /etc/stunnel/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003estunnel ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç›´å¾Œã€èµ·å‹•ã—ã¦ãã‚Œãªã„ã®ã§ ENABLE=1 ã«ä¿®æ­£ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo \u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eEDITOR\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e /etc/default/stunnel4\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eENABLE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e# 0 -\u0026gt; 1 ã¸å¤‰æ›´\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003estunenl.conf ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ /etc/stunnel é…ä¸‹ã«è¨­ç½®ã—ã¾ã™ã€‚\u003c/p\u003e","title":"Emacs + Mew ã§ Gmail ã‚’èª­ã¿æ›¸ãã™ã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nLinux ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒãƒãƒ¼ã‚¸ãƒ£ã¯ä½¿ã„ç¶šã‘ã¦é•·ã„ã®ã§ã™ãŒã€æ—¢ã«1å‘¨åŠã—ã¾ã—ãŸã€‚twm -\u0026gt; gnome -\u0026gt; enlightenment -\u0026gt; OpenBox -\u0026gt; .. å¿˜ã‚ŒãŸ .. -\u0026gt; twm -\u0026gt; vtwm -\u0026gt; awesome -\u0026gt; kde -\u0026gt; gnome -\u0026gt; enligtenment \u0026hellip;\nå··ã§ã¯ Linux ã®ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç’°å¢ƒã¯æ­»ã‚“ã ã¨ã‹è¨€ã‚ã‚Œã¦ã„ã‚‹ã‚‰ã—ã„ã§ã™ãŒã€stumpwm ã¨ã„ã†ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒãƒãƒ¼ã‚¸ãƒ£ã¯çµæ§‹ã„ã„ãªã¨æ€ã„ã¾ã—ãŸã€‚ã‚¿ã‚¤ãƒ«å‹ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒãƒãƒ¼ ã‚¸ãƒ£ã§ Emacs å¥½ãã®äººãŒé–‹ç™ºã—ãŸã‚‰ã—ã„ã§ã™ã€‚è¨­å®šã¯ lisp ã§æ›¸ã‘ã¾ã™ã€‚\nè¦‹ãŸç›®ã¯æ´¾æ‰‹ã§ã¯ç„¡ã„ã®ã§ã™ãŒã€\nã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°æ©Ÿèƒ½ ã™ã¹ã¦ã®æ“ä½œãŒã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§å‡ºæ¥ã‚‹ ã‚¿ã‚¤ãƒ«å‹ã§ã‚ã‚‹ã®ã§ç…©ã‚ã—ã„ãƒã‚¦ã‚¹ã§ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ“ä½œãŒä¸è¦ ã¨ã„ã†ç‚¹ã«æƒ¹ã‹ã‚Œã¾ã—ãŸã€‚\nLinux ã‚’ä½¿ã†æ™‚ã€ç§ã®å ´åˆ Debian Gnu/Linux Unstalble ã‚’ã„ã¤ã‚‚ä½¿ã†ã®ã§ã™ãŒã€ Unstable ã ã¨ apt-get install stumpwm ã—ãŸãƒã‚¤ãƒŠãƒªãŒã‚³ã‚±ã‚‹\u0026hellip;ã¨ã„ã†ã“ã¨ã§ãƒ“ãƒ« ãƒ‰ã—ã¦ã‚ã’ã¾ã—ãŸã€‚æ™®æ®µæ…£ã‚Œãªã„ãƒ“ãƒ«ãƒ‰æ–¹æ³•ã ã£ãŸã®ã§ã€ãã®æ™‚ã®æ‰‹é †ã‚’è‡ªåˆ†ã®ãŸã‚ã« ã‚‚ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚\nå‰æç’°å¢ƒ Debian Gnu/Linux unstable åˆ©ç”¨ X ã®ç’°å¢ƒã¯æƒã£ã¦ã„ã‚‹ ãƒ“ãƒ«ãƒ‰æ‰‹é † clisp ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« clisp ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% sudo apt-get install clisp-dev lisp.run ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ stumpwm ãŒè¦‹ã¤ã‘ã‚‰ã‚Œãªã„ã®ã§ symlink å¼µã£ã¦ã‚ã’ã¾ã™ã€‚ ã¡ã‚‡ã£ã¨æ³¥è‡­ã„ã€‚\n% sudo ln -s /usr/lib/clisp-2.49/base /usr/lib/clisp-2.49/full sbcl ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« sbcl ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% sudo apt-get install sbcl quicklisp ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« quicklisp ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ã¾ãŸ lisp init file ã«è«¸ã€…è¿½åŠ ã—ã¾ã™ã€‚\n% wget http://beta.quicklisp.org/quicklisp.lisp % sbcl --load quicklisp.lisp * (quicklisp-quickstart:install) * (ql:system-apropos \u0026#34;vecto\u0026#34;) * (ql:quickload \u0026#34;vecto\u0026#34;) * (ql:add-to-init-file) * (ql:quickload \u0026#34;clx\u0026#34;) * (ql:quickload \u0026#34;cl-ppcre\u0026#34;) * quit stumpwm ã®ãƒ“ãƒ«ãƒ‰ stumpwm ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚\n% git clone https://github.com/sabetts/stumpwm.git % cd stumpwm % ./configure % make % sudo make install ã¾ã¨ã‚ $HOME/.stumpwmrc ã‚’é…ç½®ã—ã¦ã€ã„ã‚ã„ã‚ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå‡ºæ¥ã¾ã™ã€‚ã‚¦ã‚§ãƒ–ã‚’æ¤œç´¢ã™ã‚‹ã¨ çš†ã•ã‚“ã® rc ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‹ã®ã§å‚è€ƒã«ã™ã‚‹ã¨è‰¯ã„ã‹ã‚‚ã€‚prefix ã‚­ãƒ¼ã¯ C-t ãªã® ã§ã™ãŒã€tmux ã¨è¢«ã‚Šã¾ã™ã‚ˆã­\u0026hellip;ã€‚tmux å´ã¯å¤‰ãˆãŸããªã„ã®ã§ stumpwm å´ã‚’ C-z ç­‰ ã«å¤‰æ›´ã—ã¦ä½¿ã£ã¦ã„ã¾ã™ã€‚\n(set-prefix-key (kbd \u0026#34;C-z\u0026#34;)) ","permalink":"https://jedipunkz.github.io/post/2013/08/09/debian-unstable-stumpwm/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eLinux ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒãƒãƒ¼ã‚¸ãƒ£ã¯ä½¿ã„ç¶šã‘ã¦é•·ã„ã®ã§ã™ãŒã€æ—¢ã«1å‘¨åŠã—ã¾ã—ãŸã€‚twm -\u0026gt; gnome -\u0026gt;\nenlightenment -\u0026gt; OpenBox -\u0026gt;  .. å¿˜ã‚ŒãŸ .. -\u0026gt; twm -\u0026gt; vtwm -\u0026gt; awesome -\u0026gt; kde -\u0026gt;\ngnome -\u0026gt; enligtenment \u0026hellip;\u003c/p\u003e\n\u003cp\u003eå··ã§ã¯ Linux ã®ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç’°å¢ƒã¯æ­»ã‚“ã ã¨ã‹è¨€ã‚ã‚Œã¦ã„ã‚‹ã‚‰ã—ã„ã§ã™ãŒã€stumpwm\nã¨ã„ã†ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒãƒãƒ¼ã‚¸ãƒ£ã¯çµæ§‹ã„ã„ãªã¨æ€ã„ã¾ã—ãŸã€‚ã‚¿ã‚¤ãƒ«å‹ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒãƒãƒ¼\nã‚¸ãƒ£ã§ Emacs å¥½ãã®äººãŒé–‹ç™ºã—ãŸã‚‰ã—ã„ã§ã™ã€‚è¨­å®šã¯ lisp ã§æ›¸ã‘ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eè¦‹ãŸç›®ã¯æ´¾æ‰‹ã§ã¯ç„¡ã„ã®ã§ã™ãŒã€\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°æ©Ÿèƒ½\u003c/li\u003e\n\u003cli\u003eã™ã¹ã¦ã®æ“ä½œãŒã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§å‡ºæ¥ã‚‹\u003c/li\u003e\n\u003cli\u003eã‚¿ã‚¤ãƒ«å‹ã§ã‚ã‚‹ã®ã§ç…©ã‚ã—ã„ãƒã‚¦ã‚¹ã§ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ“ä½œãŒä¸è¦\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã¨ã„ã†ç‚¹ã«æƒ¹ã‹ã‚Œã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eLinux ã‚’ä½¿ã†æ™‚ã€ç§ã®å ´åˆ Debian Gnu/Linux Unstalble ã‚’ã„ã¤ã‚‚ä½¿ã†ã®ã§ã™ãŒã€\nUnstable ã ã¨ apt-get install stumpwm ã—ãŸãƒã‚¤ãƒŠãƒªãŒã‚³ã‚±ã‚‹\u0026hellip;ã¨ã„ã†ã“ã¨ã§ãƒ“ãƒ«\nãƒ‰ã—ã¦ã‚ã’ã¾ã—ãŸã€‚æ™®æ®µæ…£ã‚Œãªã„ãƒ“ãƒ«ãƒ‰æ–¹æ³•ã ã£ãŸã®ã§ã€ãã®æ™‚ã®æ‰‹é †ã‚’è‡ªåˆ†ã®ãŸã‚ã«\nã‚‚ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æç’°å¢ƒ\"\u003eå‰æç’°å¢ƒ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eDebian Gnu/Linux unstable åˆ©ç”¨\u003c/li\u003e\n\u003cli\u003eX ã®ç’°å¢ƒã¯æƒã£ã¦ã„ã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ãƒ“ãƒ«ãƒ‰æ‰‹é †\"\u003eãƒ“ãƒ«ãƒ‰æ‰‹é †\u003c/h2\u003e\n\u003ch4 id=\"clisp-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003eclisp ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h4\u003e\n\u003cp\u003eclisp ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% sudo apt-get install clisp-dev\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003elisp.run ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ stumpwm ãŒè¦‹ã¤ã‘ã‚‰ã‚Œãªã„ã®ã§ symlink å¼µã£ã¦ã‚ã’ã¾ã™ã€‚\nã¡ã‚‡ã£ã¨æ³¥è‡­ã„ã€‚\u003c/p\u003e","title":"Debian Unstable ã§ stumpwm"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nå‰å›ã€github.com/rcbops ã® Cookbooks ã‚’åˆ©ç”¨ã—ãŸ OpenStack ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã‚’ç´¹ä»‹ã— ã¾ã—ãŸã€‚ã“ã‚Œã¯ RackSpace ç¤¾ã® Private Cloud Service ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ Cookbooks ã§ Apache ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®å…ƒã€èª°ã§ã‚‚åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚HA æ§‹æˆã‚’ çµ„ã‚ãŸã‚Š Swift ã®æ“ä½œ (Rings æƒ…å ±ç®¡ç†ãªã©) ã‚‚ Chef ã§å‡ºæ¥ã‚‹å„ªã‚ŒãŸ Cookbooks ãª ã‚ã‘ã§ã™ãŒã€é‹ç”¨ã™ã‚‹ã«ã‚ãŸã‚Šå¹¾ã¤ã‹è€ƒãˆãªãã¦ã¯ãªã‚‰ãªã„ã“ã¨ã‚‚ã‚ã‚Šãã†ã§ã™ã€‚\nchef-client ã®å®Ÿè¡Œé †ç•ªã¨å®Ÿè¡Œå›æ•°ãŒå¯†æ¥ã«é–¢ã‚ã£ã¦ã„ã‚‹ã“ã¨ HA æ§‹æˆã®æ‰‹å‹•åˆ‡æ›¿ç­‰ã€é‹ç”¨ä¸Šå¿…è¦ãªæ“ä½œã«ã¤ã„ã¦è€ƒæ…®ã™ã‚‹å¿…è¦æ€§ â€» å¾Œè€…ã«ã¤ã„ã¦ã¯ OpenStack ãƒ¦ãƒ¼ã‚¶ä¼šã®æ–¹ã€…ã«æ„è¦‹ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚\nç‰¹ã«å‰é …ã¯ Chef ã‚’åˆ©ç”¨ã™ã‚‹ä¸€ç•ªã®æ„ç¾©ã§ã‚ã‚‹ \u0026ldquo;å†ªç­‰æ€§\u0026rdquo; ã‚’ã‚ã‚‹ç¨‹åº¦ (å…¨ãã¨ã„ã†æ„å‘³ ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒ) çŠ ç‰²ã«ã—ã¦ã„ã‚‹ã¨è¨€ãˆã¾ã™ã€‚ã¾ãŸ chef-client ã®å®Ÿè¡Œå›æ•°ã€ã‚¿ã‚¤ ãƒŸãƒ³ã‚°ç­‰ Cookbooks ã‚’å®Œå…¨ã«ç†è§£ã—ã¦ã„ãªã„ã¨é‹ç”¨ã¯é›£ã—ã„ã§ã—ã‚‡ã†ã€‚è‡ªã‚‰ç®¡ç†ã—ã¦ ã„ã‚‹ Cookbooks ãªã‚‰å•é¡Œãªã„ã§ã™ãŒã€rcbops ãŒç®¡ç†ã—ã¦ã„ã‚‹ã®ã§å¸¸ã«æ›´æ–°çŠ¶æ³ã‚’è¿½ã£ ã¦ã„ãå¿…è¦ã‚‚ã‚ã‚Šãã†ã§ã™ã€‚\nä¸€æ–¹ã€Opscode, RackSpace, AT\u0026amp;T ç­‰ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒç®¡ç†ã—ã¦ã„ã‚‹ Cookbooks ãŒã‚ã‚Šã¾ ã™ã€‚ã“ã‚Œã¯ä»¥å‰ã€æ—¥æœ¬ã® OpenStack å‹‰å¼·ä¼šã§ç§ãŒè©±ã—ãŸ \u0026lsquo;openstack-chef-repo\u0026rsquo; ã‚’åˆ© ç”¨ã—ãŸãƒ¢ãƒã§ã™ã€‚github.com/stackforge ã®å…ƒã«ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚ openstack-chef-repo ã¯ Berksfile, Roles, Environments ã®ã¿ã®æ§‹æˆã§å„ Cookbooks ã¯ Berksfile ã‚’å…ƒã«å–å¾—ã™ã‚‹å½¢ã«ãªã‚Šã¾ã™ã€‚å–å¾—å…ˆã¯åŒã˜ã github.com/stackforge ä¸Šã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚\nã“ã¡ã‚‰ã® Cookbooks ã‚’åˆ©ç”¨ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆã¨ã—ã¦ã¯\nå†ªç­‰æ€§ãŒä¿ãŸã‚Œã‚‹ è¤‡æ•°ãƒ™ãƒ³ãƒ€ç®¡ç†ãªã®ã§ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ç¨‹åº¦è»½æ¸›ã•ã‚Œã‚‹ ãªã©ã§ã™ã€‚é€†ã«ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã¯\u0026hellip;\nå®¹æ˜“ã« HA æ§‹æˆã‚’çµ„ã‚€ã“ã¨ãŒå‡ºæ¥ãªã„ node, environment, role ã«ã‚ˆã‚‹ search ã§è‡ªå¾‹çš„ã«æ§‹æˆã—ã¦ãã‚Œãªã„ ã§ã™ã€‚ä¸€é•·ä¸€çŸ­ã§ã™ãŒã€é‹ç”¨ã—åˆ‡ã‚Œãªã„ HA æ§‹æˆã‚’çµ„ã‚€ã®ã§ã‚ã‚Œã°ã€å†ªç­‰æ€§ãŒä¿ãŸã‚Œã‚‹ ã“ã¡ã‚‰ã® Cookbooks ã‚’ä½¿ã†ã€ã¨ã„ã†ã®ã‚‚ä¸€ã¤ã®è€ƒãˆã ã¨æ€ã„ã¾ã™ã€‚\nä»Šå›ã¯ nova-network ã‚’ç”¨ã„ãŸè¤‡æ•°å°æ§‹æˆ (controller + compute x n) ã‚’ ã“ã® Stackforge Cookbooks ã‚’ä½¿ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ï¼\nå‰ææ¡ä»¶ Chef ã‚µãƒ¼ãƒã®æ§‹ç¯‰ã¯æ¸ˆã¾ã›ã¦ã„ã‚‹ knife ã‚’ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§æ‰±ãˆã‚‹ã¾ã§ã®æº–å‚™ã¯å‡ºæ¥ã¦ã„ã‚‹ ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å…ˆã®ãƒãƒ¼ãƒ‰ (controller01 , compute0[12]) ã¯ sshd ãŒèµ·å‹•ã—ã¦ã„ã‚‹ æ§‹æˆ +----------------+----------------+------------------------------------------------- public | eth0 | eth0 | eth0 network +--------------+ +--------------+ +--------------+ +--------------+ +--------------+ | controller01 | | compute01 | | compute02 | | chef server | | workstation | +--------------+ +--------------+ +--------------+ +--------------+ +--------------+ | eth1 | eth2 | | eth2 | | eth0 | eth0 +----------------+-------o--------+-------o--------+----------------+--------------- api/management | eth1 | eth1 network +----------------+----------------------------------------- vm network ç‰¹å¾´ã¯\u0026hellip;\ncontroller01 ãƒãƒ¼ãƒ‰ã¯ OpenStack ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰ compute0[12] ãƒãƒ¼ãƒ‰ã¯ OpenStack ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ Chef ã‚µãƒ¼ãƒã€ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯ api/management ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã«é…ç½® compute0[12] ã¯ 3 æœ¬ç›®ã® NIC (eth1) ã‚’å‡ºã— vm ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ãƒãƒƒãƒ”ãƒ³ã‚° (bridge ãƒ‡ãƒã‚¤ã‚¹) API endpoint ã¯ controller01 ã® eth1 ã§å—ã‘ã‚‹ ä»®æƒ³ãƒã‚·ãƒ³ã¯ compute ãƒãƒ¼ãƒ‰ã® eth1 ã«ãƒ–ãƒªãƒƒã‚¸æ¥ç¶šã— eth0 ã‚’ä»‹ã—ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸ IP ã‚¢ãƒ‰ãƒ¬ã‚¹æƒ…å ±\u0026hellip;\ncontroller01, eth0 : 10.0.0.10, eth1 : 10.0.1.10 compute01, eth0 : 10.0.0.11, eth1 : 172.24.18.11, eth2 : 10.0.1.11 compute02, eth0 : 10.0.0.12, eth1 : 172.24.18.12, eth2 : 10.0.1.12 chef server, eth0 : 10.0.1.13 workstation, eth0 : 10.0.1.14 ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é † ã“ã“ã‹ã‚‰ã®æ“ä½œã¯å…¨ã¦ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ä¸Šã‹ã‚‰è¡Œã„ã¾ã™ã€‚\nã¾ãšã€openstakc-chef-repo ã‚’å–å¾—ã—ã¾ã™ã€‚ç§ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸Šã®ã‚‚ã®ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚stackforge ã®ãƒ¢ãƒã¯ ç®¡ç†ãŒè¿½ã„ã¤ã„ã¦ã„ãªã„ãŸã‚ã€å‹•ä½œã—ã¾ã›ã‚“\u0026hellip;ã€‚ç§ã®ãƒ¢ãƒã¯ fork ã—ã¦ Roles ã‚’ä¸»ã«ä¿®æ­£ã—ã¦ã„ã¾ã™ã€‚\n% git clone git://github.com/jedipunkz/openstack-chef-repo.git ~/openstack-chef-repo % cd ~/openstack-chef-repo Cookbooks ã‚’å–å¾—ã—ã¾ã™ã€‚Berksfile ã«å¾“ã£ã¦å–å¾—ã—ã¾ã™ãŒäºˆã‚ berkshelf ã‚’ gem ã§ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã€‚\n% gem install berkshelf --no-ri --no-rdoc % rbenv rehash # rbenv ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆ % berks install --path=./coobooks ä¸Šè¨˜ã®ç’°å¢ƒã«åˆã‚ã› environment ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã® environment ã¯å„ Cookbooks ã® attributes ã‚’ä¸Šæ›¸ãã— 1ã¤ã® environment ã§ 1ã¤ã®æ§‹æˆ (controller, compute..) ã‚’å½¢æˆã—ã¾ã™ã€‚knife bootstrap, chef-client ã‚’ å®Ÿè¡Œã™ã‚‹ã¨ã“ã® environment ã‚’ã‚µãƒ¼ãƒã—ã€ãã‚Œãã‚ŒãŒé€£æºã—åˆã£ã¦ãã‚Œã¾ã™ã€‚\n% ${EDITOR} environments/openstack-cluster01.rb name \u0026#34;separated\u0026#34; description \u0026#34;separated nodes environment\u0026#34; override_attributes( \u0026#34;release\u0026#34; =\u0026gt; \u0026#34;grizzly\u0026#34;, \u0026#34;osops_networks\u0026#34; =\u0026gt; { \u0026#34;management\u0026#34; =\u0026gt; \u0026#34;10.0.1.0/24\u0026#34;, \u0026#34;public\u0026#34; =\u0026gt; \u0026#34;10.0.1.0/24\u0026#34;, \u0026#34;nova\u0026#34; =\u0026gt; \u0026#34;10.0.1.0/24\u0026#34; }, \u0026#34;mysql\u0026#34; =\u0026gt; { \u0026#34;bind_address\u0026#34; =\u0026gt; \u0026#34;0.0.0.0\u0026#34;, \u0026#34;root_network_acl\u0026#34; =\u0026gt; \u0026#34;%\u0026#34;, \u0026#34;allow_remote_root\u0026#34; =\u0026gt; true, \u0026#34;server_root_password\u0026#34; =\u0026gt; \u0026#34;secrete\u0026#34;, \u0026#34;server_repl_password\u0026#34; =\u0026gt; \u0026#34;secrete\u0026#34;, \u0026#34;server_debian_password\u0026#34; =\u0026gt; \u0026#34;secrete\u0026#34; }, \u0026#34;nova\u0026#34; =\u0026gt; { \u0026#34;network\u0026#34; =\u0026gt; { \u0026#34;fixed_range\u0026#34; =\u0026gt; \u0026#34;172.18.0.0/24\u0026#34;, \u0026#34;public_interface\u0026#34; =\u0026gt; \u0026#34;eth0\u0026#34; } }, \u0026#34;openstack\u0026#34; =\u0026gt; { \u0026#34;developer_mode\u0026#34; =\u0026gt; true, \u0026#34;compute\u0026#34; =\u0026gt; { \u0026#34;rabbit\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;novnc_proxy\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34; }, \u0026#34;libvirt\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34; }, \u0026#34;network\u0026#34; =\u0026gt; { \u0026#34;fixed_range\u0026#34; =\u0026gt; \u0026#34;172.18.0.0/24\u0026#34; }, \u0026#34;networks\u0026#34; =\u0026gt; [ { \u0026#34;label\u0026#34; =\u0026gt; \u0026#34;private\u0026#34;, \u0026#34;ipv4_cidr\u0026#34; =\u0026gt; \u0026#34;172.18.0.0/24\u0026#34;, \u0026#34;num_networks\u0026#34; =\u0026gt; \u0026#34;1\u0026#34;, \u0026#34;network_size\u0026#34; =\u0026gt; \u0026#34;255\u0026#34;, \u0026#34;bridge\u0026#34; =\u0026gt; \u0026#34;br200\u0026#34;, \u0026#34;bridge_dev\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34;, \u0026#34;dns1\u0026#34; =\u0026gt; \u0026#34;8.8.8.8\u0026#34;, \u0026#34;dns2\u0026#34; =\u0026gt; \u0026#34;8.8.4.4\u0026#34;, \u0026#34;multi_host\u0026#34; =\u0026gt; \u0026#34;T\u0026#34; } ] }, \u0026#34;identity\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34;, \u0026#34;users\u0026#34; =\u0026gt; { \u0026#34;demo\u0026#34; =\u0026gt; { \u0026#34;password\u0026#34; =\u0026gt; \u0026#34;demo\u0026#34;, \u0026#34;default_tenant\u0026#34; =\u0026gt; \u0026#34;service\u0026#34;, \u0026#34;roles\u0026#34; =\u0026gt; { \u0026#34;Member\u0026#34; =\u0026gt; [ \u0026#34;Member\u0026#34; ] } } } }, \u0026#34;image\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34;, }, \u0026#34;network\u0026#34; =\u0026gt; { \u0026#34;api\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34;, } }, \u0026#34;db\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34;, \u0026#34;compute\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;identity\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;image\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;network\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;volume\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;dashboard\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34; } }, \u0026#34;mq\u0026#34; =\u0026gt; { \u0026#34;bind_interface\u0026#34; =\u0026gt; \u0026#34;eth1\u0026#34; }, \u0026#34;endpoints\u0026#34; =\u0026gt; { \u0026#34;identity-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;identity-admin\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;compute-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;compute-ec2-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;compute-ec2-admin\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34; }, \u0026#34;compute-novnc\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34;, }, \u0026#34;network-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34;, }, \u0026#34;image-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34;, }, \u0026#34;image-registry\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34;, }, \u0026#34;volume-api\u0026#34; =\u0026gt; { \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;10.0.1.10\u0026#34;, } } } ) spiceweasel ã‚’ gem ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ã“ã‚Œã¯ Cookbooks, Roles, Environments ç­‰ã‚’ Chef ã‚µãƒ¼ãƒã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚Šã€knife bootstrap ã‚’ä¸€æ°—ã«è¡Œãªã£ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ ãƒ«ã§ã™ã€‚knife bootstrap ã‚³ãƒãƒ³ãƒ‰ã®æ›¸å¼ã‚‚æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚\n% gem install spiceweasel --no-ri --no-rdoc % rbenv rehash # rbenv ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆ infrastracture.yml ã‚’ä¿®æ­£ã—ã¾ã™ã€‚ä½œæˆã—ãŸ environments åã®ä¿®æ­£ã¨ node: ã‚’ä¿®æ­£ ã—ã¾ã™ã€‚\n...\u0026lt;snip\u0026gt;... environments: - separated: ...\u0026lt;snip\u0026gt;... nodes: - 10.0.0.10: run_list: role[os-compute-single-controller] options: -N controller01 -E separated --sudo -x \u0026lt;your_accout_name\u0026gt; - 10.0.0.11: run_list: role[os-compute-worker] options: -N compute01 -E separated --sudo -x \u0026lt;your_accout_name\u0026gt; - 10.0.0.12: run_list: role[os-compute-worker] options: -N compute02 -E separated --sudo -x \u0026lt;your_accout_name\u0026gt; spiceweasel ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã™ã‚‹ã¨ knife ã‚³ãƒãƒ³ãƒ‰ã®ä¸€è¦§ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã®ã§å®Ÿè¡Œã• ã‚Œã‚‹å†…å®¹ã‚’ç¢ºèªã—ã¾ã™ã€‚ã“ã“ã§ã¯ã¾ã å®Ÿè¡ŒãŒè¡Œã‚ã‚Œã¾ã›ã‚“ã€‚\n% spiceweasel infrastructure.yml -e ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦å®Ÿè¡Œã™ã‚‹ã¨å…ˆã»ã©å‡ºåŠ›ã•ã‚ŒãŸ knife ã‚³ãƒãƒ³ãƒ‰ãŒé †ã«å®Ÿè¡Œã•ã‚Œã¾ ã™ã€‚ã“ã®æ“ä½œã§3å°ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ã¾ã™ã€‚\n% spiceweasel -e infrastructure.yml ã¾ã¨ã‚ã¨è€ƒå¯Ÿ ä»¥ä¸Šã®æ“ä½œã§ OpenStack è¤‡æ•°å°æ§‹æˆãŒçµ„ã‚ã‚‹ã€‚Neutron æ§‹æˆã«ã¤ã„ã¦ã‚‚ \u0026lsquo;openstack-network\u0026rsquo; Cookbook ã«å®Ÿè£…ãŒå…¥ã£ã¦ã„ã‚‹æ§˜å­ãªã®ã§ä»¥å¾Œè©¦ã—ã¦ã¿ãŸã„ã§ã™ã€‚ ä»Šå›ã¯ public ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ»api/management ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ»vm ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®3ã¤ ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã§çµ„ã¿ã¾ã—ãŸã€‚é‹ç”¨ã™ã‚‹ã®ã§ã‚ã‚Œã° public ã¨ api/management ãŒ åˆ¥ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã®ã§ã€‚è‡ªå®…ã§ä½œã£ã¦ã¿ãŸã„ï¼ã§ã‚‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒ\u0026hellip;ã¨ ã„ã†å ´åˆã€environment ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ä¿®æ­£ã™ã‚Œã° pubcic/api/management ãƒãƒƒãƒˆ ãƒ¯ãƒ¼ã‚¯ãƒ»vm ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®2ã¤ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã§ã‚‚çµ„ã‚ã‚‹ã®ã§è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ ã‚‚ã—ãã¯ bridge_dev ã®è¨˜è¿°ã‚’ environment ã‹ã‚‰å‰Šé™¤ã™ã‚‹ã¨ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç‰©ç† ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒã•ã‚Œãªã„ã®ã§ã€1ã¤ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã‚‚æ§‹æˆå‡ºæ¥ã¾ã™ã€‚\nã¾ãŸã€ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã‚‚çµ„ã‚ã¾ã™ã€‚ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã®å ´åˆ\n% knife bootstrap \u0026lt;ip_addr\u0026gt; -N allinone01 -E allinone \\ -r \u0026#39;role[allinone-compute]\u0026#39; --sudo --x \u0026lt;your_account\u0026gt; ã§ãƒ‡ãƒ—ãƒ­ã‚¤å‡ºæ¥ã¾ã™ã€‚ã“ã¡ã‚‰ã‚‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã¯1ã¤ã§ã‚‚2ã¤ã§ã‚‚3ã¤ã§ã‚‚çµ„ã‚ã¾ã™ã€‚ã‚‚ã†å°‘ã— è©³ã—ã„æ‰‹é †ã‚’ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã«ã¤ã„ã¦ã¯åˆ¥é€”ãƒ–ãƒ­ã‚°ã«ã¾ã¨ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãƒ¼ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/08/06/opscode-cookbooks-openstack-deploy/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå‰å›ã€github.com/rcbops ã® Cookbooks ã‚’åˆ©ç”¨ã—ãŸ OpenStack ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã‚’ç´¹ä»‹ã—\nã¾ã—ãŸã€‚ã“ã‚Œã¯ RackSpace ç¤¾ã® Private Cloud Service ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ Cookbooks\nã§ Apache ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®å…ƒã€èª°ã§ã‚‚åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚HA æ§‹æˆã‚’\nçµ„ã‚ãŸã‚Š Swift ã®æ“ä½œ (Rings æƒ…å ±ç®¡ç†ãªã©) ã‚‚ Chef ã§å‡ºæ¥ã‚‹å„ªã‚ŒãŸ Cookbooks ãª\nã‚ã‘ã§ã™ãŒã€é‹ç”¨ã™ã‚‹ã«ã‚ãŸã‚Šå¹¾ã¤ã‹è€ƒãˆãªãã¦ã¯ãªã‚‰ãªã„ã“ã¨ã‚‚ã‚ã‚Šãã†ã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003echef-client ã®å®Ÿè¡Œé †ç•ªã¨å®Ÿè¡Œå›æ•°ãŒå¯†æ¥ã«é–¢ã‚ã£ã¦ã„ã‚‹ã“ã¨\u003c/li\u003e\n\u003cli\u003eHA æ§‹æˆã®æ‰‹å‹•åˆ‡æ›¿ç­‰ã€é‹ç”¨ä¸Šå¿…è¦ãªæ“ä½œã«ã¤ã„ã¦è€ƒæ…®ã™ã‚‹å¿…è¦æ€§\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eâ€» å¾Œè€…ã«ã¤ã„ã¦ã¯ OpenStack ãƒ¦ãƒ¼ã‚¶ä¼šã®æ–¹ã€…ã«æ„è¦‹ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eç‰¹ã«å‰é …ã¯ Chef ã‚’åˆ©ç”¨ã™ã‚‹ä¸€ç•ªã®æ„ç¾©ã§ã‚ã‚‹ \u0026ldquo;å†ªç­‰æ€§\u0026rdquo; ã‚’ã‚ã‚‹ç¨‹åº¦ (å…¨ãã¨ã„ã†æ„å‘³\nã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒ) çŠ ç‰²ã«ã—ã¦ã„ã‚‹ã¨è¨€ãˆã¾ã™ã€‚ã¾ãŸ chef-client ã®å®Ÿè¡Œå›æ•°ã€ã‚¿ã‚¤\nãƒŸãƒ³ã‚°ç­‰ Cookbooks ã‚’å®Œå…¨ã«ç†è§£ã—ã¦ã„ãªã„ã¨é‹ç”¨ã¯é›£ã—ã„ã§ã—ã‚‡ã†ã€‚è‡ªã‚‰ç®¡ç†ã—ã¦\nã„ã‚‹ Cookbooks ãªã‚‰å•é¡Œãªã„ã§ã™ãŒã€rcbops ãŒç®¡ç†ã—ã¦ã„ã‚‹ã®ã§å¸¸ã«æ›´æ–°çŠ¶æ³ã‚’è¿½ã£\nã¦ã„ãå¿…è¦ã‚‚ã‚ã‚Šãã†ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä¸€æ–¹ã€Opscode, RackSpace, AT\u0026amp;T ç­‰ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒç®¡ç†ã—ã¦ã„ã‚‹ Cookbooks ãŒã‚ã‚Šã¾\nã™ã€‚ã“ã‚Œã¯ä»¥å‰ã€æ—¥æœ¬ã® OpenStack å‹‰å¼·ä¼šã§ç§ãŒè©±ã—ãŸ \u0026lsquo;openstack-chef-repo\u0026rsquo; ã‚’åˆ©\nç”¨ã—ãŸãƒ¢ãƒã§ã™ã€‚github.com/stackforge ã®å…ƒã«ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚\nopenstack-chef-repo ã¯ Berksfile, Roles, Environments ã®ã¿ã®æ§‹æˆã§å„ Cookbooks\nã¯ Berksfile ã‚’å…ƒã«å–å¾—ã™ã‚‹å½¢ã«ãªã‚Šã¾ã™ã€‚å–å¾—å…ˆã¯åŒã˜ã github.com/stackforge\nä¸Šã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚\u003c/p\u003e","title":"openstack-chef-repo ã§ OpenStack è¤‡æ•°å°æ§‹æˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\næœ€è¿‘ã€è‡ªå‹•åŒ–ã¯æ­£ç¾©ã ã¨æœ€è¿‘æ€ã†ã®ã§ã™ãŒã€ãã®æ‰‹åŠ©ã‘ã‚’ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ« Cobbler ã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚Cobbler ã¨è¤‡æ•° OS, ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ CLI, GUI ã§ç®¡ç†å‡º æ¥ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚PXE, TFTP, DHCPã‚’çµ„åˆ†ã›ã‚Œã° OS ã®è‡ªå‹•æ§‹ç¯‰ãŒå‡ºæ¥ã‚‹ã®ã¯å¤ãã‹ã‚‰ ã‚ã‚Šã¾ã™ãŒã€TFTP ã‚µãƒ¼ãƒã«é…ç½®ã™ã‚‹ã‚«ãƒ¼ãƒãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚„ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç®¡ç†ã‚’ä¸€å…ƒ ã—ã¦ç®¡ç†ã—ã¦ãã‚Œã‚‹ã®ãŒã“ã® Cobbler ã§ã™ã€‚\nä»Šå›ã¯ Cobbler ã®æ§‹ç¯‰æ–¹æ³•ã‚’ãŠä¼ãˆã—ã¾ã™ã€‚æœ¬å½“ã¯ Chef Cookbooks ã§æ§‹ç¯‰ã—ãŸã‹ã£ ãŸã®ã§ã™ãŒ Opscode Community ã«ã‚ã‚‹ Cookbooks ã¯ã‚¤ãƒã‚¤ãƒã ã£ãŸã®ã§ã€ä»Šå›ã¯æ‰‹å‹• ã§ã€‚\nå‰æç’°å¢ƒ OS ã¯ CentOSã‚’ã€‚Ubuntu ã‚’åˆ©ç”¨ã™ã‚‹ã¨ DHCP ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•ã§å‡º æ¥ã¾ã›ã‚“ åˆ©ç”¨ã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã® DHCP ã¯ã‚ªãƒ•ã«ã—ã¾ã™ æ§‹ç¯‰æ‰‹é † SELINUX ã‚’ç„¡åŠ¹ã«ã—ã¾ã™ã€‚çŸ³â—¯ã•ã‚“ã€ã”ã‚ã‚“ãªã•ã„ã€‚\n# ${EDITOR} /etc/sysconfig/selinux SELINUX=disabled # setenforce 0 EPEL ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ ã—ã¾ã™ã€‚\n# rpm -Uvh http://ftp.iij.ad.jp/pub/linux/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm cobbler ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ã¾ãŸãã®ä»–å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚ã“ã“ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã— ã¾ã™ã€‚\n# yum install cobbler debmirror pykickstart è‡ªåˆ†ã®è¨­å®šã—ãŸã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ /etc/cobbler/settings å†…ã® default_password_crypted: ã«è¨­å®šã—ã¾ã™ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç”Ÿæˆã¯ä¸‹è¨˜ã®ã‚ˆã†ã« openssl ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚\n% openssl passwd -1 /etc/cobbler/settings å†…ã®ä¸‹è¨˜ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¤ã„ã¦è¨­å®šã—ã¾ã™ã€‚manage_dhcp: ã¯ 1 ã«ã—ã¦ãŠãã¨ã€Cobbler ãŒè‡ªå‹•ã§ ISC DHCP ã®è¨­å®šã‚‚æ›¸ãæ›ãˆã¦ãã‚Œã‚‹ã®ã§ã€ã»ã¼å¿… é ˆã®è¨­å®šã§ã™ã€‚\nserver: \u0026lt;è‡ªãƒ›ã‚¹ãƒˆã® IP\u0026gt; next_server: \u0026lt;è‡ªãƒ›ã‚¹ãƒˆã® IP\u0026gt; manage_dhcp: 1 /etc/cobbler/dhcp.template ã‚’è¨­å®šã—ã¾ã™ã€‚è‡ªåˆ†ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®š ã—ã¾ã™ã€‚\nsubnet 192.168.1.0 netmask 255.255.255.0 { option routers 192.168.1.254; option domain-name-servers 8.8.8.8,8.8.4.4; option subnet-mask 255.255.255.0; range dynamic-bootp 192.168.1.120 192.168.1.150; default-lease-time 21600; max-lease-time 43200; next-server $next_server; class \u0026#34;pxeclients\u0026#34; { match if substring (option vendor-class-identifier, 0, 9) = \u0026#34;PXEClient\u0026#34;; if option pxe-system-type = 00:02 { filename \u0026#34;ia64/elilo.efi\u0026#34;; } else if option pxe-system-type = 00:06 { filename \u0026#34;grub/grub-x86.efi\u0026#34;; } else if option pxe-system-type = 00:07 { filename \u0026#34;grub/grub-x86_64.efi\u0026#34;; } else { filename \u0026#34;pxelinux.0\u0026#34;; } } } /etc/xinetd.d/rsync ã® disable = yes ã‚’ no ã«è¨­å®šã—ã¾ã™ã€‚\n# ${EDITOR} /etc/xinetd.d/rsync \u0026lt;snip\u0026gt; disable = no \u0026lt;snip\u0026gt; ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã—ã¾ã™ã€‚\n# service cobbler start # service dhcpd start # service httpd start # service xinetd start OS èµ·å‹•æ™‚ã«å„ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•ã™ã‚‹ã‚ˆã†è¨­å®šã—ã¾ã™ã€‚\n# chkconfig cobbler on # chkconfig dhcpd on # chkconfig httpd on # chkconfig xinetd on iptables ã‚’ã‚ªãƒ•ã«ã—ã¾ã™ã€‚\n# service iptables stop # chkconfig iptables off æ§‹ç¯‰ã¯å®Œäº†ã§ã™ã€‚\nãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ ã“ã“ã§ã¯ãƒ†ã‚¹ãƒˆã§ Ubuntu Server 12.04 amd64 ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã¿ã¾ã™ã€‚\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ããŸã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ISO ã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚\n# mount -t iso9660 -o loop,ro /path/to/Image.iso /mnt ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚\n# cobbler import --name=ubuntu1204 --arch=x86_64 --path=/mnt Debian ç³»ã® Ubuntu ã¯ x86_64 ã§ã¯ãªãé€šå¸¸ amd64 ã¨è¨˜ã—ã¾ã™ãŒã€Cobbler ãŒ CentOS, RHEL ã‚’å‰æã«é–‹ç™ºã•ã‚Œã¦ã„ã‚‹ã®ã§ x86_64 ã¨è¨˜ã—ã¾ã™ã€‚æ³¨æ„ã—ã¦ãã ã•ã„ã€‚\nã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸã‹ç¢ºèªã—ã¾ã™ã€‚\n# cobbler distro list # cobbler profile list ã“ã“ã§ã¯è‡ªåˆ†ã®ä½œæˆã—ãŸ preseed.cfg ã‚’ä½¿ã„ãŸã„ã®ã§ãã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚ã“ã®æ“ä½œ ã¯è¡Œã‚ãªãã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ãŒã€preseed.cfg å†…ã§è‡ªåˆ†ã®ç’°å¢ƒã«åˆã‚ã›ã¦è‰²ã€…ã—ãŸã„ã¨æ€ ã†ã®ã§ã€è¡Œãªã£ã¦ãŠãã¨ä¾¿åˆ©ã§ã™ã€‚äºˆã‚ preseed.cfg ã¯ä½œæˆã™ã‚‹å¿…è¦ã‚ã‚Šã¾ã™ãŒã€‚\n# cp /path/to/preseed.cfg /var/lib/cobbler/kickstarts/ubuntu1204-preseed.cfg # cobbler profile edit --name=ubuntu1204-x86_64 \\ --kickstart=/var/lib/cobbler/kickstarts/ubuntu1204-preseed.cfg \\ --kopts=\u0026#34;priority=critical locale=en_US\u0026#34; ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒã‚·ãƒ³ã®ç™»éŒ² ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ãƒã‚·ãƒ³ã‚’ç™»éŒ²ã—ã¾ã™ã€‚äºˆã‚ NIC ã® Mac ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç”¨æ„ã—ã¦ ãã ã•ã„ã€‚\n# cobbler system add --name=foo --profile=ubuntu1204-x86_64 # cobbler system edit --name=foo --interface=eth0 \\ --mac=00:1c:25:72:1f:79 --ip-address=192.168.1.120 --netmask \\ 255.255.255.0 --static=0 # cobbler system edit --name=foo -gateway=192.168.1.254 --hostname=foo ã“ã¡ã‚‰ã‚‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã«åˆã‚ã›ã¦ gateway ã‚„ netmask ã®æƒ…å ±ã‚’è¨˜ã—ã¦ãã ã•ã„ã€‚\nã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒã‚·ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« PXE ãƒ–ãƒ¼ãƒˆã™ã‚‹ã ã‘ã§ã™ã€‚\nã¾ã¨ã‚ \u0026lsquo;cobbler-web\u0026rsquo; ã®è¨­å®šã¯ä»Šå›ã¯èª¬æ˜ã—ã¾ã›ã‚“ã§ã—ãŸã€æ…£ã‚Œã¦ã„ã‚‹äººãªã‚‰ CLI ã®ã»ã†ãŒã„ ã„ã¨æ€ã†ã®ã§ \u0026lsquo;cobbler\u0026rsquo; ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã ã‘ã§ã‚‚ååˆ†ã ã¨æ€ã„ã¾ã™ã€‚\nCobbler ã¯ CentOS, RHEL ã‚’ä¸­å¿ƒã«è€ƒãˆã‚‰ã‚ŒãŸãƒ„ãƒ¼ãƒ«ãªã®ã§ Debian ç³»ã¸ã®å¯¾å¿œãŒã‚¤ãƒ ã‚¤ãƒã§ã—ãŸã€‚ã‚ã¨ã€import ã™ã‚‹æ™‚ã«ã‚³ã‚±ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã‚³ã‚±ã‚‹ç†ç”±ãŒã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒ ã‚»ãƒ¼ã‚¸ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œãªã„ã‚‚ã®ã‚‚ã‚ã‚‹ã®ã§ã€ã¡ã‚‡ã£ã¨è‹¦åŠ´ã—ã¾ã™ã€‚\nãŸã ç®¡ç†ã™ã‚‹ãƒ»æ–°ã—ã„ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ»ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®ç™»éŒ²ã‚’å®¹æ˜“ã«ã—ã¦ãã‚Œã‚‹ ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã¯ã¨ã¦ã‚‚æœ‰ç”¨ã§ã™ã€‚ä»Šã€ã“ã®è¾ºã‚Šã®æ“ä½œã§ã‚ã‚Œã° Chef ã§å‡ºæ¥ãªã„ã‹ãªï¼Ÿ ã¨è€ƒãˆã¦ã„ã‚‹æœ€ä¸­ã§ã™ã€‚ã¨è¨€ã†ã‹æ—¢ã« Cookbooks ã‚’ç”¨æ„ã—å§‹ã‚ã¦ã„ã¾ã™ã€‚Chef ã§ã‚·ãƒ³ ãƒ—ãƒ«ãª PXE ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç’°å¢ƒã‚’ä½œã£ãŸæ–¹ãŒå¤šãã®ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾å¿œå‡ºæ¥ ãã†ã§ã™ã—ã€ã‚„ã‚‹æ„å‘³ã‚ã‚‹ã‹ãªï¼Ÿã¨æ€ã£ã¦ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/07/28/cobbler-os-automation-install/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€è¿‘ã€è‡ªå‹•åŒ–ã¯æ­£ç¾©ã ã¨æœ€è¿‘æ€ã†ã®ã§ã™ãŒã€ãã®æ‰‹åŠ©ã‘ã‚’ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ« Cobbler\nã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚Cobbler ã¨è¤‡æ•° OS, ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ CLI, GUI ã§ç®¡ç†å‡º\næ¥ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚PXE, TFTP, DHCPã‚’çµ„åˆ†ã›ã‚Œã° OS ã®è‡ªå‹•æ§‹ç¯‰ãŒå‡ºæ¥ã‚‹ã®ã¯å¤ãã‹ã‚‰\nã‚ã‚Šã¾ã™ãŒã€TFTP ã‚µãƒ¼ãƒã«é…ç½®ã™ã‚‹ã‚«ãƒ¼ãƒãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚„ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç®¡ç†ã‚’ä¸€å…ƒ\nã—ã¦ç®¡ç†ã—ã¦ãã‚Œã‚‹ã®ãŒã“ã® Cobbler ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ Cobbler ã®æ§‹ç¯‰æ–¹æ³•ã‚’ãŠä¼ãˆã—ã¾ã™ã€‚æœ¬å½“ã¯ Chef Cookbooks ã§æ§‹ç¯‰ã—ãŸã‹ã£\nãŸã®ã§ã™ãŒ Opscode Community ã«ã‚ã‚‹ Cookbooks ã¯ã‚¤ãƒã‚¤ãƒã ã£ãŸã®ã§ã€ä»Šå›ã¯æ‰‹å‹•\nã§ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æç’°å¢ƒ\"\u003eå‰æç’°å¢ƒ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eOS ã¯ CentOSã‚’ã€‚Ubuntu ã‚’åˆ©ç”¨ã™ã‚‹ã¨ DHCP ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•ã§å‡º\næ¥ã¾ã›ã‚“\u003c/li\u003e\n\u003cli\u003eåˆ©ç”¨ã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã® DHCP ã¯ã‚ªãƒ•ã«ã—ã¾ã™\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"æ§‹ç¯‰æ‰‹é †\"\u003eæ§‹ç¯‰æ‰‹é †\u003c/h2\u003e\n\u003cp\u003eSELINUX ã‚’ç„¡åŠ¹ã«ã—ã¾ã™ã€‚çŸ³â—¯ã•ã‚“ã€ã”ã‚ã‚“ãªã•ã„ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ${EDITOR} /etc/sysconfig/selinux\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSELINUX\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edisabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# setenforce 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eEPEL ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# rpm -Uvh http://ftp.iij.ad.jp/pub/linux/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ecobbler ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ã¾ãŸãã®ä»–å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚ã“ã“ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—\nã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# yum install cobbler debmirror pykickstart\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè‡ªåˆ†ã®è¨­å®šã—ãŸã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ /etc/cobbler/settings å†…ã®\ndefault_password_crypted: ã«è¨­å®šã—ã¾ã™ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç”Ÿæˆã¯ä¸‹è¨˜ã®ã‚ˆã†ã« openssl\nã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚\u003c/p\u003e","title":"Cobbler ã§ OS è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\næœ€è¿‘ Chef ã§ OpenStack ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã°ã‹ã‚Šã«èˆˆå‘³æŒã£ã¡ã‚ƒã£ã¦ã€ä»–ã®ã“ã¨ã‚‚ ã‚„ã‚‰ã‚“ã¨ãªãã¨æ€ã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã›ã£ã‹ããªã®ã§ Swift HA æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ ã‚¤ã™ã‚‹æ–¹æ³•ã‚’æ›¸ãã¾ã™ã€‚\nSwift ã£ã¦åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãªã®ã« HA ã£ã¦ãªã‚“ã‚ˆï¼ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã”å­˜ çŸ¥ã®æ§˜ã« Swift ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒ¼ãƒ‰ (accout, object, container) ã¨ãƒ—ãƒ­ã‚­ã‚·ãƒãƒ¼ãƒ‰ ã«åˆ¥ã‚Œã¾ã™ã€‚ä»Šå›ç´¹ä»‹ã™ã‚‹æ–¹æ³•ã ã¨ãƒ—ãƒ­ã‚­ã‚·ãƒãƒ¼ãƒ‰ã‚’ Keepalived ã¨ Haproxy ã§ HAã€ ã¾ãŸ MySQL ã‚‚ KeepAlived ã§ HA ã®æ§‹æˆã«å‡ºæ¥ã¾ã—ãŸã€‚ã„ã¤ã‚‚ã®ã‚ˆã†ã« RackSpace ç®¡ ç†ã® Cookbooks ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚\nå‚è€ƒè³‡æ–™ http://www.rackspace.com/knowledge_center/article/openstack-object-storage-configuration\næ§‹æˆ æ§‹æˆã¯ç°¡å˜ã«è¨˜ã™ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ç‰¹å¾´ã¨ã—ã¦ã¯\u0026hellip;\nswift-proxy01, swift-proxy02 ã§ HAã€‚VRRP + LB ãªæ§‹æˆã€‚ swift-proxy01 ã§ git ã‚µãƒ¼ãƒç¨¼åƒã€‚Rings æƒ…å ±ã‚’ç®¡ç†ã€‚ swift-storageNN ãŒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒ¼ãƒ‰ OS ã¯ Ubuntu server 12.04 ã§ã™ã€‚\n|--------- VRRP + Load Balancer ------| +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ | swift-proxy01 | | swift-proxy02 | | swift-storage01 | | swift-storage02 | | swift-storage03 | +-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+ | | | | | +-------------------+-------------------+-------------------+-------------------+------------------ | | +-----------------+ +-----------------+ | chef workstation| | chef server | +-----------------+ +-----------------+ çµµã¯æ›¸ãæ„å‘³ãªã‹ã£ãŸã‹\u0026hellip;ã€‚\næ‰‹é † chef server æ§‹ç¯‰ ä¾‹ã«ã‚ˆã£ã¦ Omnibus ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã„ã¾ã™ã€‚\n% wget https://opscode-omnibus-packages.s3.amazonaws.com/ubuntu/12.04/x86_64/chef-server_11.0.8-1.ubuntu.12.04_amd64.deb % sudo dpkg -i chef-server_11.0.8-1.ubuntu.12.04_amd64.deb % sudo chef-server-ctl reconfigure % knife configure -i \u0026lt; é©å½“ã«ç­”ãˆã‚‹ \u0026gt; \u0026lsquo;knife configure -i\u0026rsquo; ã§è‡ªåˆ†ç”¨ã®ç§˜å¯†éµãŒç”Ÿæˆå‡ºæ¥ã¾ã™ã€‚\nworkstation ãƒãƒ¼ãƒ‰ã§ã®æº–å‚™ ã»ã¼å…¨ã¦ã®æ“ä½œã‚’ workstation ãƒãƒ¼ãƒ‰ã§è¡Œã„ã¾ã™ã€‚knife.rb ã‚„ç§˜å¯†éµã®è¨­ç½®ç­‰ã«ã¤ã„ ã¦ã¯æ–¹æ³•ã‚’å‰²æ„›ã—ã¾ã™ã€‚ã“ã®ã¸ã‚“ã¯ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã¨èª¬æ˜ã—ã¾ã™ãŒã€çš†ã•ã‚“ãªã‚‰ã”å­˜çŸ¥ã‹ã¨æ€ ã„ã¾ã™ã®ã§..ã€‚\ngithub ã‚ˆã‚Š rackspace ç®¡ç†ã® Chef Cookbooks ã‚’å–å¾—ã™ã‚‹ã€‚\n% git clone https://github.com/rcbops/chef-cookbooks.git ~/openstack-chef-repo % cd ~/openstack-chef-repo v.4.0.0 ã¨ã„ç¾åœ¨ (2013/07/25) æœ€æ–°ãƒªãƒªãƒ¼ã‚¹ç‰ˆã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã™ã‚‹ã€‚\n% git checkout v4.0.0 % git submodule init % git submodule sync % git submodule update \u0026lsquo;chef server\u0026rsquo; ãƒãƒ¼ãƒ‰ã¸ Cookbooks ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹\n% knife cookbook upload -o cookbooks -a \u0026lsquo;chef-server\u0026rsquo; ãƒãƒ¼ãƒ‰ã¸ Roles ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹\n% knife role from file roles/*rb ä»Šå›ã®æ§‹æˆç”¨ã® environment \u0026lsquo;swift-ha\u0026rsquo; ã‚’ç”¨æ„ã—ã¾ã™ã€‚ã“ã“ã§ã¯å„ Cookbooks ã® Attributes ã‚’ä¸Šæ›¸ãã—ã€ä¸€ã¤ã®æ§‹æˆã‚’çµ„ã¿ã¾ã™ã€‚Cookbooks å†…ã§ã“ã® environment å ã‚’ã‚­ãƒ¼ã«æ¤œç´¢ã—è‡ªãƒãƒ¼ãƒ‰ã¨åŒç’°å¢ƒã®ãƒãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘å‡ºã—ã€é–¢é€£ä»˜ã‘ãŒã•ã‚Œã¾ã™ã€‚\n{ \u0026#34;name\u0026#34;: \u0026#34;swift-ha\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;cookbook_versions\u0026#34;: { }, \u0026#34;json_class\u0026#34;: \u0026#34;Chef::Environment\u0026#34;, \u0026#34;chef_type\u0026#34;: \u0026#34;environment\u0026#34;, \u0026#34;default_attributes\u0026#34;: { }, \u0026#34;override_attributes\u0026#34;: { \u0026#34;package_component\u0026#34;: \u0026#34;grizzly\u0026#34;, \u0026#34;osops_networks\u0026#34;: { \u0026#34;management\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34;, \u0026#34;public\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34;, \u0026#34;nova\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34;, \u0026#34;swift\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34; }, \u0026#34;keystone\u0026#34;: { \u0026#34;admin_user\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;tenants\u0026#34;: [ \u0026#34;admin\u0026#34;, \u0026#34;service\u0026#34; ], \u0026#34;users\u0026#34;: { \u0026#34;admin\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;admin\u0026#34;: [ \u0026#34;admin\u0026#34; ] } }, \u0026#34;demo\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;demo\u0026#34;, \u0026#34;default_tenant\u0026#34; : \u0026#34;service\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;admin\u0026#34;: [ \u0026#34;admin\u0026#34; ] } } }, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;keystone\u0026#34; } }, \u0026#34;mysql\u0026#34;: { \u0026#34;root_network_acl\u0026#34;: \u0026#34;%\u0026#34;, \u0026#34;allow_remote_root\u0026#34;: true, \u0026#34;server_root_password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;server_repl_password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;server_debian_password\u0026#34;: \u0026#34;secrete\u0026#34; }, \u0026#34;monitoring\u0026#34;: { \u0026#34;procmon_provider\u0026#34;: \u0026#34;monit\u0026#34;, \u0026#34;metric_provider\u0026#34;: \u0026#34;collectd\u0026#34; }, \u0026#34;vips\u0026#34;: { \u0026#34;keystone-admin-api\u0026#34;: \u0026#34;10.0.0.11\u0026#34;, \u0026#34;keystone-service-api\u0026#34;: \u0026#34;10.0.0.11\u0026#34;, \u0026#34;keystone-internal-api\u0026#34;: \u0026#34;10.0.0.11\u0026#34;, \u0026#34;mysql-db\u0026#34;: \u0026#34;10.0.0.12\u0026#34;, \u0026#34;swift-proxy\u0026#34;: \u0026#34;10.0.0.11\u0026#34; }, \u0026#34;developer_mode\u0026#34;: false, \u0026#34;swift\u0026#34;: { \u0026#34;swift_hash\u0026#34;: \u0026#34;127005c8ea84\u0026#34;, \u0026#34;authmode\u0026#34;: \u0026#34;keystone\u0026#34;, \u0026#34;authkey\u0026#34;: \u0026#34;1f281c71-cf89-5b27-a2ad-ad873d3f2760\u0026#34; } } } ç”Ÿæˆã—ãŸ environment ãƒ•ã‚¡ã‚¤ãƒ« \u0026rsquo;environments/swift-ha.json\u0026rsquo; ã‚’ Chef ã‚µãƒ¼ãƒã¸ã‚¢ãƒƒ ãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\n% knife environment from file environments/swift-ha.json disk ãƒ‡ãƒã‚¤ã‚¹ã®ç”¨æ„ swift-storageNN ã§ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ ¼ç´ç”¨ã® Disk ãŒã‚ã‚‹å ´åˆã¯ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ ã—ã¾ã™ã€‚è¿½åŠ ã® Disk ãŒç„¡ãã¦ã‚‚æ§‹ã‚ãªã„ã¨æ€ã„ã¾ã™ã€‚å¾Œã« Chef ãŒä½¿ç”¨å¯èƒ½ãª Disk ãƒ‡ãƒã‚¤ã‚¹ã‚’æ¤œçŸ¥ã—ã¦ãã‚Œã¾ã™ã€‚ã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ /dev/sdb ã¨ã—ã¦èªè­˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ ã‚’å‰æã«è¨˜ã—ã¾ã™ã€‚è¿½åŠ ã® disk ãŒç„¡ã„å ´åˆã¯ /dev/sda6 ç­‰ã€OS ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ã‚ª ãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ ¼ç´ç”¨ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ç”¨æ„ã—ã¦ã‚‚ã‚‰ãˆã°å¤§ä¸ˆå¤«ã§ã™ã€‚ã¾ãŸ GPT ãªãƒ‘ãƒ¼ ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã®ã§ (å¤§ãã„ã‹ã‚‰) fdisk ã§ã¯ãªã gdisk ã‚’ ç”¨ã„ã¾ã—ã‚‡ã†ã€‚\n% swift-storageNN% sudo apt-get update; apt-get -y install gdisk % swift-storageNN% sudo gdisk /dev/sdb å„ãƒãƒ¼ãƒ‰ã‚’ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ— ã„ã‚ˆã„ã‚ˆãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\n% knife bootstrap \u0026lt;ip_swift-proxy01\u0026gt; -N swift-proxy01 -r \u0026#39;role[ha-swift-controller1]\u0026#39; -E swift-ha --sudo -x jedipunkz % knife bootstrap \u0026lt;ip_swift-proxy02\u0026gt; -N swift-proxy02 -r \u0026#39;role[ha-swift-controller2]\u0026#39; -E swift-ha --sudo -x jedipunkz % knife bootstrap \u0026lt;ip_swift-storage01\u0026gt; -N swift-storage01 -r \\ \u0026#39;role[swift-object-server]\u0026#39;,\u0026#39;role[swift-container-server]\u0026#39;,\u0026#39;role[swift-account-server]\u0026#39; -E swift-ha --sudo -x jedipunkz % knife bootstrap \u0026lt;ip_swift-sotrage02\u0026gt; -N swift-storage02 -r \\ \u0026#39;role[swift-object-server]\u0026#39;,\u0026#39;role[swift-container-server]\u0026#39;,\u0026#39;role[swift-account-server]\u0026#39; -E swift-ha --sudo -x jedipunkz % knife bootstrap \u0026lt;ip_swift-storage03\u0026gt; -N swift-storage03 -r \\ \u0026#39;role[swift-object-server]\u0026#39;,\u0026#39;role[swift-container-server]\u0026#39;,\u0026#39;role[swift-account-server]\u0026#39; -E swift-ha --sudo -x jedipunkz Chef ã‚µãƒ¼ãƒã«ãƒãƒ¼ãƒ‰æƒ…å ±ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã®ã§å„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒ¼ãƒ‰ã® zone æƒ…å ±ã«ã‚·ãƒ¼ ã‚±ãƒ³ã‚·ãƒ£ãƒ«ç•ªå·ã‚’ä»˜ä¸ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šå„ãƒãƒ¼ãƒ‰ã¯è‡ªåˆ†ã® zone æƒ…å ±ã‚’ Chef ã‚µãƒ¼ãƒ ã‹ã‚‰çŸ¥ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\n% knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-storage01\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;1\u0026#39;; n.save }\u0026#34; % knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-storage02\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;2\u0026#39;; n.save }\u0026#34; % knife exec -E \u0026#34;nodes.find(:name =\u0026gt; \u0026#39;swift-storage03\u0026#39;) {|n| n.set[\u0026#39;swift\u0026#39;][\u0026#39;zone\u0026#39;] = \u0026#39;3\u0026#39;; n.save }\u0026#34; Account, Container, Object ã«å¯¾ã—ã¦é©åˆ‡ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸã‹ç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚\n% knife exec -E \u0026#39;search(:node,\u0026#34;role:swift-account-server\u0026#34;) \\ { |n| z=n[:swift][:zone]||\u0026#34;not defined\u0026#34;; puts \u0026#34;#{n.name} has the role \\ role [swift-account-server] and is in swift zone #{z}\u0026#34;; }\u0026#39; % knife exec -E \u0026#39;search(:node,\u0026#34;role:swift-container-server\u0026#34;) \\ { |n| z=n[:swift][:zone]||\u0026#34;not defined\u0026#34;; puts \u0026#34;#{n.name} has the role \\ [swift-container-server] and is in swift zone #{z}\u0026#34;; }\u0026#39; % knife exec -E \u0026#39;search(:node,\u0026#34;role:swift-object-server\u0026#34;) \\ { |n| z=n[:swift][:zone]||\u0026#34;not defined\u0026#34;; puts \u0026#34;#{n.name} has the role \\ [swift-object-server] and is in swift zone #{z}\u0026#34;; }\u0026#39; ã¾ãŸã€å…ˆã»ã©ç”¨æ„ã—ãŸ Swift ç”¨ãƒ‡ã‚£ã‚¹ã‚¯ãƒ‡ãƒã‚¤ã‚¹ã‚’ Chef ãŒãƒ‡ã‚£ã‚¹ã‚«ãƒå‡ºæ¥ã‚‹ã‹ç¢ºèª ã‚’è¡Œã„ã¾ã™ã€‚\n% knife exec -E \\ \u0026#39;search(:node,\u0026#34;role:swift-object-server OR \\ role:swift-account-server \\ OR role:swift-container-server\u0026#34;) \\ { |n| puts \u0026#34;#{n.name}\u0026#34;; \\ begin; n[:swift][:state][:devs].each do |d| \\ puts \u0026#34;\\tdevice #{d[1][\u0026#34;device\u0026#34;]}\u0026#34;; \\ end; rescue; puts \\ \u0026#34;no candidate drives found\u0026#34;; end; }\u0026#39; ã¾ãŸãƒ‡ã‚£ã‚¹ã‚«ãƒã•ã‚ŒãŸãƒ‡ã‚£ã‚¹ã‚¯ãƒ‡ãƒã‚¤ã‚¹ /dev/sdb1 ãŒæ—¢ã«ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ã©ã† ã‹ç¢ºèªã—ã¾ã™ã€‚\nswift-strageNN# df\n\u0026lsquo;swift-proxy01\u0026rsquo; ãƒãƒ¼ãƒ‰ã«ã¦å†åº¦ chef-client ã‚’å®Ÿè¡Œã— /etc/swift/ring-workspace/generate-rings.sh ã‚’ æ›´æ–°ã™ã‚‹ã€‚ä¸Šè¨˜ zone æƒ…å ±ã«å¾“ã£ã¦å†…å®¹ãŒæ›´æ–°ã•ã‚Œã‚‹ã€‚\nswift-proxy01# chef-client ç”Ÿæˆã•ã‚ŒãŸ generate-rails.sh ã‚’å®Ÿè¡Œã€‚\u0026rsquo;exit 0\u0026rsquo; ã®è¡Œã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã€‚\nswift-proxy01# cd /etc/swift/ring-workspace swift-proxy01# ./generate-rings.sh /etc/swift/ring-workstation/rings é…ä¸‹ã« Rings ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚ŒãŸã¯ãšã§ã™ã€‚ç¢º èªã—ã¦ã¿ã¦ãã ã•ã„ã€‚ã“ã® Rings ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ git ã‚µãƒ¼ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚git ã‚µãƒ¼ ãƒã¯æ—¢ã« \u0026lsquo;swift-proxy01\u0026rsquo; ãƒãƒ¼ãƒ‰ä¸Šã«æ§‹ç¯‰ã•ã‚Œã¦ã„ã¾ã™ã€‚\nswift-proxy01# cd /etc/swift/ring-workspace/rings swift-proxy01# git add account.builder container.builder object.builder swift-proxy01# git add account.ring.gz container.ring.gz object.ring.gz swift-proxy01# git commit -m \u0026#34;initial commit\u0026#34; swift-proxy01# git push git ã‚µãƒ¼ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸ Rings ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å„ãƒãƒ¼ãƒ‰ã«é…å¸ƒã—ã¾ã™ã€‚é…å¸ƒã®æ–¹æ³•ã¯ å„ãƒãƒ¼ãƒ‰ã§ chef-client ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã¯ knife ssh ç­‰ã‚’ç”¨ã„ã¦ã‚‚æ§‹ã„ã¾ ã›ã‚“ã€‚\nswift-proxy01# chef-client swift-proxy02# chef-client swift-storage01# chef-client swift-storage02# chef-client swift-storage03# chef-client swift-storageNN ã®è¨ˆ3å°ãŒç™»éŒ²ã•ã‚ŒãŸã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚\nswift-proxy# swift-recon --md5 å‹•ä½œç¢ºèª å‹•ä½œç¢ºèªã‚’ã—ã¾ã—ã‚‡ã†ã€‚\nswift-storage01# source swift-openrc swift-storage01# swift post container01 swift-storage01# echo \u0026#34;test\u0026#34; \u0026gt; test swift-storage01# swift upload container01 test swift-storage01# swift list swift-storage01# swift list container01 ã¾ãŸã€ã“ã‚Œã‚‰ã®æ“ä½œãŒ swift-proxy01, swift-proxy02 ã®ç‰‡ç³»ã‚’è½ã¨ã—ãŸçŠ¶æ…‹ã§ã‚‚å¯èƒ½ ã‹ã©ã†ã‹ã‚‚ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚\nã¾ã¨ã‚ swift-proxy ç‰‡ç³»ã®éšœå®³æ™‚ã«ã‚‚èª­ã¿è¾¼ã¿ç³»ãƒ»æ›¸ãè¾¼ã¿ç³»ã®æ“ä½œãŒå¯èƒ½ãªã“ã¨ã‚’ç¢ºèªå‡ºæ¥ ã¾ã—ãŸã€‚å¾©æ—§ã«é–¢ã—ã¦ã‚‚ MySQL çš„ãª Slave ç³» (ä»Šå›ã ã¨ swift-proxy02(å¾Œã‹ã‚‰ãƒ–ãƒ¼ ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã—ãŸãƒãƒ¼ãƒ‰)) ã«é–¢ã—ã¦ã¯ knife bootstrap ã§å‡ºæ¥ã¾ã™ã€‚Master ç³»ã®å¾© æ—§ã¯ç°¡å˜ã«ã¯ã„ãã¾ã›ã‚“ã€‚ã“ã®äº‹æ…‹ã«å‚™ãˆã‚‹ã«ã¯ Rings æƒ…å ±ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— (Git ãƒ¬ ãƒã‚¸ãƒˆãƒªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—) ã¨ MySQL ã®ãƒ€ãƒ³ãƒ—ã®å®šæœŸçš„å–å¾—ãŒå¿…è¦ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚\nã¾ãŸã€ä»Šå› VRRP ã§ HA ã—ã¦ã„ã‚‹ã®ã§2å°æ§‹æˆã«ãªã‚Šã¾ã™ã€‚Swift ãƒ—ãƒ­ã‚­ã‚·ã¯æœ¬æ¥ã€ãƒãƒ¼ ãƒ‰ã‚’å¢—ã‚„ã™ã“ã¨ã§ã‚ˆã‚Šå¤šãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã‚‰ã‚Œã‚‹ (ä½•ãŒãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã«ãªã‚‹ã‹ã§çŠ¶ æ³ã¯å¤‰ã‚ã‚Šã¾ã™ãŒ) åˆ©ç‚¹ãŒã‚ã‚‹ãŸã‚ã€ã“ã®2å°æ§‹æˆãŒãƒ™ã‚¹ãƒˆã‹ã©ã†ã‹ã¯çŠ¶æ³ã«åˆã‚ã›ã¦ è€ƒãˆãŸæ–¹ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã“ã®æ§‹æˆã®å ´åˆã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãŒå¿…è¦ãªã„ç‚¹ãŒãƒ¡ãƒªãƒƒ ãƒˆã ã£ãŸã‚Šã—ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/07/26/swift-ha-chef-deploy/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€è¿‘ Chef ã§ OpenStack ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã°ã‹ã‚Šã«èˆˆå‘³æŒã£ã¡ã‚ƒã£ã¦ã€ä»–ã®ã“ã¨ã‚‚\nã‚„ã‚‰ã‚“ã¨ãªãã¨æ€ã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã›ã£ã‹ããªã®ã§ Swift HA æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­\nã‚¤ã™ã‚‹æ–¹æ³•ã‚’æ›¸ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eSwift ã£ã¦åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãªã®ã« HA ã£ã¦ãªã‚“ã‚ˆï¼ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã”å­˜\nçŸ¥ã®æ§˜ã« Swift ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒ¼ãƒ‰ (accout, object, container) ã¨ãƒ—ãƒ­ã‚­ã‚·ãƒãƒ¼ãƒ‰\nã«åˆ¥ã‚Œã¾ã™ã€‚ä»Šå›ç´¹ä»‹ã™ã‚‹æ–¹æ³•ã ã¨ãƒ—ãƒ­ã‚­ã‚·ãƒãƒ¼ãƒ‰ã‚’ Keepalived ã¨ Haproxy ã§ HAã€\nã¾ãŸ MySQL ã‚‚ KeepAlived ã§ HA ã®æ§‹æˆã«å‡ºæ¥ã¾ã—ãŸã€‚ã„ã¤ã‚‚ã®ã‚ˆã†ã« RackSpace ç®¡\nç†ã® Cookbooks ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒè³‡æ–™\"\u003eå‚è€ƒè³‡æ–™\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"http://www.rackspace.com/knowledge_center/article/openstack-object-storage-configuration\"\u003ehttp://www.rackspace.com/knowledge_center/article/openstack-object-storage-configuration\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eæ§‹æˆã¯ç°¡å˜ã«è¨˜ã™ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ç‰¹å¾´ã¨ã—ã¦ã¯\u0026hellip;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eswift-proxy01, swift-proxy02 ã§ HAã€‚VRRP + LB ãªæ§‹æˆã€‚\u003c/li\u003e\n\u003cli\u003eswift-proxy01 ã§ git ã‚µãƒ¼ãƒç¨¼åƒã€‚Rings æƒ…å ±ã‚’ç®¡ç†ã€‚\u003c/li\u003e\n\u003cli\u003eswift-storageNN ãŒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒ¼ãƒ‰\u003c/li\u003e\n\u003cli\u003eOS ã¯ Ubuntu server 12.04\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã§ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e|--------- VRRP + Load Balancer ------|\n\n+-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+\n|  swift-proxy01  | |  swift-proxy02  | | swift-storage01 | | swift-storage02 | | swift-storage03 |\n+-----------------+ +-----------------+ +-----------------+ +-----------------+ +-----------------+\n|                   |                   |                   |                   |\n+-------------------+-------------------+-------------------+-------------------+------------------\n|                   |\n+-----------------+ +-----------------+\n| chef workstation| |   chef server   |\n+-----------------+ +-----------------+\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eçµµã¯æ›¸ãæ„å‘³ãªã‹ã£ãŸã‹\u0026hellip;ã€‚\u003c/p\u003e","title":"Swift HA æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nOpenStack ã‚’é‹ç”¨ã™ã‚‹ä¸­ã§ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯é‡è¦ã§ã™ã€‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰ãŒè½ã¡ã‚‹ã¨ã€ ä»®æƒ³ãƒã‚·ãƒ³ã®æ“ä½œç­‰ãŒåˆ©ç”¨å‡ºæ¥ã¾ã›ã‚“ã€‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®å†—é•·æ§‹æˆã‚’å–ã‚‹ãƒã‚¤ãƒ³ãƒˆã¯å…¬å¼ wiki ã‚µã‚¤ãƒˆã«è¨˜è¿°ã‚ã‚‹ã®ã§ã™ãŒ PaceMaker ã‚’ä½¿ã£ãŸæ§‹æˆã§ã—ã‚“ã©ã„ã§ã™ã€‚ä½•ã‚ˆã‚Šé‹ç”¨ ã™ã‚‹äººãŒæ··ä¹±ã™ã‚‹ä»•çµ„ã¿ã¯é¿ã‘ãŸã„ã§ã™ã€‚\nRackSpace ç¤¾ã®ç®¡ç†ã—ã¦ã„ã‚‹ Chef Cookbooks ã® Roles ã« \u0026lsquo;ha-controller1\u0026rsquo;, \u0026lsquo;ha-controller2\u0026rsquo; ã¨ã„ã†ãƒ¢ãƒãŒã‚ã‚Šã¾ã™ã€‚ä»Šå›ã¯ã“ã‚Œã‚’ä½¿ã£ãŸ HA æ§‹æˆã®æ§‹ç¯‰æ–¹æ³•ã« ã¤ã„ã¦æ›¸ã„ã¦ã„ã“ã†ã‹ã¨æ€ã„ã¾ã™ã€‚\næ§‹æˆ æœ€å°æ§‹æˆã‚’ä½œã‚ŠãŸã„ã¨æ€ã„ã¾ã™ã€‚HA ã®ãŸã‚ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰2å°, ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒãƒ¼ ãƒ‰1å°, Chef ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³1å°, Chef ã‚µãƒ¼ãƒãƒãƒ¼ãƒ‰1å°ã€‚\n+----------------+----------------+----------------+----------------+--------------- public network | | | eth0 | | 10.0.0.0/24 +--------------+ +--------------+ +--------------+ +--------------+ +--------------+ | controller01 | | controller01 | | compute01 | | chef server | | workstation | +--------------+ +--------------+ +--------------+ +--------------+ +--------------+ | eth1 +------------------------------------------------- fixed range network 172.16.0.0/24 ç‰¹å¾´ \u0026lsquo;controller01\u0026rsquo;, \u0026lsquo;controller02\u0026rsquo; ã§ HA åŒ–ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ© \u0026lsquo;compute01\u0026rsquo; ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ \u0026lsquo;chef server\u0026rsquo; ã¯ Chef ã‚µãƒ¼ãƒã€Chef11 æ¨å¥¨ ã»ã¨ã‚“ã©ã®ä½œæ¥­ã‚’è¡Œã† \u0026lsquo;workstaion\u0026rsquo; ã¯ Chef ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ nova-network æ§‹æˆ Chef ã‚µãƒ¼ãƒã®æ§‹ç¯‰ Chef ã‚µãƒ¼ãƒã®æ§‹ç¯‰æ–¹æ³•ã¯æœ¬é¡Œã‹ã‚‰å¤–ã‚Œã‚‹ã®ã§å‰²æ„›ã—ã¾ã™ã€‚ä»Šã¯ Omnibus ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã§ä¸€ç™ºã§ã™ã€‚\nwokstation ãƒãƒ¼ãƒ‰ã§ã®æº–å‚™ workstation ã§ knife ã‚’ä½¿ãˆã‚‹ã¾ã§ã®æº–å‚™ã«ã¤ã„ã¦ã‚‚å‰²æ„›ã—ã¾ã™ã€‚ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ä½•ã‚‚ãƒ›ã‚¹ãƒˆåãŒè¨˜ã•ã‚Œã¦ã„ãªã„ãƒ¢ãƒã¯å…¨ã¦ workstation ãƒãƒ¼ãƒ‰ä¸Šã§ã®æ“ä½œã§ã™ã€‚ Rackspace ç®¡ç†ã® Cookbook ã‚’å–å¾—ã—ã¾ã™ã€‚\n% git clone https://github.com/rcbops/chef-cookbooks.git ~/openstack-chef-repo % cd ~/openstack-chef-repo v4.0.0 ã¨ã„ã†ã‚¿ã‚° (ç¾åœ¨ 2013/07/16 æœ€æ–°ãƒªãƒªãƒ¼ã‚¹ç‰ˆ) ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ã¾ã™ã€‚ã¾ãŸ submodue update ã§é–¢é€£ ã™ã‚‹ Cookbooks ã‚’å…¨ã¦å–å¾—ã™ã‚‹äº‹ãŒã§ãã¾ã™ã€‚\n% git checkout v4.0.0 % git submodule init % git submodule sync % git submodule update å–å¾—ã—ãŸ Cookbooks ã‚’ Chef ã‚µãƒ¼ãƒã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\n% knife cookbook upload -o cookbooks -a åŒæ§˜ã« Roles ã‚‚ Chef ã‚µãƒ¼ãƒã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\n% knife role from file roles/*rb environment ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã“ã§æŒ‡å®šã™ã‚‹ãƒ‘ãƒ©ãƒ¡ã‚¿ãƒ¼ã¯å„ã€…ã® Cookbooks ã® Attributes ã‚’ä¸Šæ›¸ãå‡ºæ¥ã¾ã™ã€‚ ã¾ãŸã€Recipe å†…ã§ãƒãƒ¼ãƒ‰ã‚µãƒ¼ãƒã™ã‚‹éš›ã«åŒã˜ environment åãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ã‚’ã‚¯ãƒ©ã‚¹ã‚¿æ§‹æˆã®ä¸€éƒ¨ã¨åˆ¤æ–­å‡ºæ¥ã‚‹ ã¨ã„ã£ãŸä»•çµ„ã¿ã§ã™ã€‚\n% ${EDITOR} environments/Cluster01.json { \u0026#34;name\u0026#34;: \u0026#34;Cluster01\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;cookbook_versions\u0026#34;: { }, \u0026#34;json_class\u0026#34;: \u0026#34;Chef::Environment\u0026#34;, \u0026#34;chef_type\u0026#34;: \u0026#34;environment\u0026#34;, \u0026#34;default_attributes\u0026#34;: { }, \u0026#34;override_attributes\u0026#34;: { \u0026#34;package_component\u0026#34;: \u0026#34;grizzly\u0026#34;, \u0026#34;osops_networks\u0026#34;: { \u0026#34;management\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34;, \u0026#34;public\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34;, \u0026#34;nova\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34; }, \u0026#34;nova\u0026#34;: { \u0026#34;networks\u0026#34;: [ { \u0026#34;bridge\u0026#34;: \u0026#34;br100\u0026#34;, \u0026#34;num_networks\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;dns2\u0026#34;: \u0026#34;8.8.4.4\u0026#34;, \u0026#34;dns1\u0026#34;: \u0026#34;8.8.8.8\u0026#34;, \u0026#34;ipv4_cidr\u0026#34;: \u0026#34;172.16.0.0/24\u0026#34;, \u0026#34;network_size\u0026#34;: \u0026#34;256\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;private\u0026#34;, \u0026#34;bridge_dev\u0026#34;: \u0026#34;eth1\u0026#34; } ], \u0026#34;config\u0026#34;: { \u0026#34;use_single_default_gateway\u0026#34;: false, \u0026#34;ram_allocation_ratio\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;cpu_allocation_ratio\u0026#34;: \u0026#34;16\u0026#34; }, \u0026#34;network\u0026#34;: { \u0026#34;dmz_cidr\u0026#34;: \u0026#34;172.18.0.0/24\u0026#34;, \u0026#34;public_interface\u0026#34;: \u0026#34;eth0\u0026#34;, \u0026#34;multi_host\u0026#34;: true, \u0026#34;fixed_range\u0026#34;: \u0026#34;172.16.0.0/24\u0026#34; }, \u0026#34;apply_patches\u0026#34;: true, \u0026#34;libvirt\u0026#34;: { \u0026#34;vncserver_listen\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;virt_type\u0026#34;: \u0026#34;kvm\u0026#34; }, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;nova\u0026#34; } }, \u0026#34;cinder\u0026#34;: { \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;cinder\u0026#34; } }, \u0026#34;keystone\u0026#34;: { \u0026#34;admin_user\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;tenants\u0026#34;: [ \u0026#34;admin\u0026#34;, \u0026#34;service\u0026#34; ], \u0026#34;users\u0026#34;: { \u0026#34;admin\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;admin\u0026#34;: [ \u0026#34;admin\u0026#34; ] } }, \u0026#34;demo\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;demo\u0026#34;, \u0026#34;default_tenant\u0026#34; : \u0026#34;service\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;service\u0026#34;: [ \u0026#34;service\u0026#34; ] } } }, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;keystone\u0026#34; } }, \u0026#34;horizon\u0026#34;: { \u0026#34;theme\u0026#34;: \u0026#34;Rackspace\u0026#34;, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;horizon\u0026#34; } }, \u0026#34;mysql\u0026#34;: { \u0026#34;root_network_acl\u0026#34;: \u0026#34;%\u0026#34;, \u0026#34;allow_remote_root\u0026#34;: true }, \u0026#34;monitoring\u0026#34;: { \u0026#34;procmon_provider\u0026#34;: \u0026#34;monit\u0026#34;, \u0026#34;metric_provider\u0026#34;: \u0026#34;collectd\u0026#34; }, \u0026#34;glance\u0026#34;: { \u0026#34;images\u0026#34;: [ \u0026#34;precise\u0026#34;, \u0026#34;cirros\u0026#34; ], \u0026#34;image\u0026#34;: { }, \u0026#34;image_upload\u0026#34;: true, \u0026#34;db\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;glance\u0026#34; } }, \u0026#34;vips\u0026#34;: { \u0026#34;cinder-api\u0026#34;: \u0026#34;10.0.0.22\u0026#34;, \u0026#34;glance-api\u0026#34;: \u0026#34;10.0.0.22\u0026#34;, \u0026#34;glance-registry\u0026#34;: \u0026#34;10.0.0.22\u0026#34;, \u0026#34;horizon-dash\u0026#34;: \u0026#34;10.0.0.22\u0026#34;, \u0026#34;horizon-dash_ssl\u0026#34;: \u0026#34;10.0.0.22\u0026#34;, \u0026#34;keystone-admin-api\u0026#34;: \u0026#34;10.0.0.22\u0026#34;, \u0026#34;keystone-service-api\u0026#34;: \u0026#34;10.0.0.22\u0026#34;, \u0026#34;keystone-internal-api\u0026#34;: \u0026#34;10.0.0.22\u0026#34;, \u0026#34;mysql-db\u0026#34;: \u0026#34;10.0.0.21\u0026#34;, \u0026#34;nova-api\u0026#34;: \u0026#34;10.0.0.22\u0026#34;, \u0026#34;nova-ec2-public\u0026#34;: \u0026#34;10.0.0.22\u0026#34;, \u0026#34;nova-novnc-proxy\u0026#34;: \u0026#34;10.0.0.22\u0026#34;, \u0026#34;nova-xvpvnc-proxy\u0026#34;: \u0026#34;10.0.0.22\u0026#34;, \u0026#34;rabbitmq-queue\u0026#34;: \u0026#34;10.0.0.23\u0026#34; }, \u0026#34;developer_mode\u0026#34;: false } } ä½œæˆã—ãŸ environment ã‚’ Chef ã‚µãƒ¼ãƒã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\n% knife environment from file environments/Cluster01.json HA ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ‡ãƒ—ãƒ­ã‚¤ controller01, controller02 ãƒãƒ¼ãƒ‰ã‚’ HA åŒ–ã™ã‚‹ã‚ã‘ã§ã™ãŒã€ã“ã®æ“ä½œã‚’å…¨ã¦ Chef ã§è¡Œã„ã¾ã™ã€‚\n% knife bootstrap \u0026lt;ip_controller01\u0026gt; -N controller01 -r \u0026#39;role[ha-controller1]\u0026#39; -E Cluster01 --sudo -x jedipunkz % knife bootstrap \u0026lt;ip_controller02\u0026gt; -N controller02 -r \u0026#39;role[ha-controller2]\u0026#39; -E Cluster01 --sudo -x jedipunkz chef ã‚µãƒ¼ãƒã« node ã®æƒ…å ±ãŒç™»éŒ²ã•ã‚Œã¾ã—ãŸã€‚ã“ã“ã‹ã‚‰ environment ã§æŒ‡å®šã—ãŸ VIP ã‚’åˆ©ç”¨ã—ãŸ HA æ§‹æˆã‚’çµ„ã‚€ãŸã‚å†åº¦ chef-client ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚chef-client ã‚’ãƒ‡ãƒ¼ãƒ¢ãƒ³åŒ–ã—ã¦ãŠã„ãŸå ´åˆã¯ æ™‚é–“ã¨å…±ã«è‡ªå‹•ã§æ§‹ç¯‰ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚\ncontroller01# chef-client controller02# chef-client Cinder ã®åˆ©ç”¨ã«é–¢ã—ã¦ã¯ç‰‡ç³»ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰ã«å¯„ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\u0026lsquo;cinder-volumes\u0026rsquo; ã¨ã„ã†åå‰ã® Volume Group ã‚’ controller01 ãƒãƒ¼ãƒ‰ã«ä½œæˆã—ä¸‹è¨˜ã®æ“ä½œã‚’è¡Œã„ã¾ã™ã€‚\n% knife node run_list add controller01 \u0026#39;role[cinder-volume]\u0026#39; controller01# chef-client controller01# service cinder-volume restart Compute ãƒãƒ¼ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤ compute ãƒãƒ¼ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚‚åŒæ§˜ã« Chef ã‚’ç”¨ã„ã¾ã™ã€‚\n% knife bootstrap \u0026lt;ip_compute01\u0026gt; -N compute01 -r \u0026#39;role[single-compute]\u0026#39; -E Cluster01 --sudo -x jedipunkz compute ãƒãƒ¼ãƒ‰ã®è¿½åŠ ã«é–¢ã—ã¦ã‚‚åŒæ§˜ã«è¡Œãªã£ã¦ã„ãã“ã¨ã§ä»®æƒ³ãƒã‚·ãƒ³ã®æ•°ã‚’æ‹¡å¼µå‡ºæ¥ã¾ã™ã€‚\nãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸ HA æ§‹æˆã®å†…éƒ¨ PaceMaker ã¯ä»Šå›ä½¿ã‚ã‚Œã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸæ§‹æˆã®å†…éƒ¨ã‚’è¦—ã„ã¦ã¿ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªç‰¹å¾´ãŒã‚ã‚Šã¾ã—ãŸã€‚\nå„ OpenStack APIs Keepalived ã§ VRRP æ§‹æˆã€‚active/passive æ§‹æˆã§æ˜ç¤ºçš„ãª Master ã¯å­˜åœ¨ã—ãªã„ã€‚ãã®éƒ½åº¦ã€è©•ä¾¡ã®é«˜ã„ãƒãƒ¼ãƒ‰ãŒ VIP ã‚’å¼•ãç¶™ãã‚µãƒ¼ãƒ“ã‚¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œã˜ã‚‹ã€‚ã¾ãŸã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ãŸã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰ã¯ haproxy ã«ã‚ˆã‚Š HA ã®2å°ã«å¯¾ã—ã¦ ãã‚Œãã‚Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’åˆ†æ•£ã€‚ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ã®å†—é•·ãŒå–ã‚‰ã‚Œã¦ã„ã‚‹ã€‚\nRabbitMQ Keepalived ã§ VRRP æ§‹æˆã€‚APIs ã¨åŒæ§˜ã« active/passive æ§‹æˆã€‚ãã®å¾Œã¯ HA å†…ç‰‡ç³»ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã® RabbitMQ ãŒå…¨ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã« å¿œãˆå‡¦ç†ã‚’è¡Œã†ã€‚\nMySQL Keepalived ã§ VRRP æ§‹æˆã€‚APIs ã¨åŒæ§˜ã« active/passive æ§‹æˆã€‚MySQL ã¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãƒ™ãƒ¼ã‚¹ã§ master/master, active/passive ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒçµ„ã¾ã‚Œã¦ã„ã‚‹ã€‚\néšœå®³ç³»ã®å¯¾å‡¦ ã“ã“ã¾ã§æ¥ã‚‹ã¨ã€HA æ§‹æˆãŒå£Šã‚ŒãŸéš›ã« Chef ã§å¾©æ—§ã‚’è‡ªå‹•åŒ–ã—ã¦ã¿ãŸããªã‚Šã¾ã™ã€‚è©¦ã—ãŸã¨ã“ã‚ HA æ§‹æˆã® MySQL çš„ãª passive å´ ãŒå£Šã‚ŒãŸéš›ã«ã¯ knife bootstrap ã§ç›´ã¡ã«å¾©æ—§ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚ãŸã ã— active (master) å´ãŒå£Šã‚ŒãŸéš›ã«ã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ãŸ ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®ãƒªã‚¹ãƒˆã‚¢ä½œæ¥­ãŒå¿…è¦ã§ã—ãŸã€‚ã¤ã¾ã‚Š Chef ã§ã®è‡ªå‹•å¾©æ—§ã¯ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚\nã¾ã¨ã‚ keepalived ã¨ haproxy ã«ã‚ˆã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãª HA æ§‹æˆã®ãŸã‚é‹ç”¨ã™ã‚‹äººé–“ãŒç†è§£ãƒ»å¯¾å‡¦ã™ã‚‹äº‹ã‚‚å®¹æ˜“ã«ãªã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰éšœå®³ã¨ã„ã£ã¦ã‚‚ã€å¤§æŠµã¯ disk äº¤æ›ã‚„ç­ä½“äº¤æ›ã§å¾©æ—§å‡ºæ¥ã‚‹ã‚ã‘ã§ã™ã‹ã‚‰ã€HA ã•ãˆçµ„ã¾ã‚Œã¦ã„ã‚Œã°ã‹ãªã‚Š å®‰å¿ƒã—ã¦é‹ç”¨ãŒå‡ºæ¥ãã†ã§ã™ã€‚ä»Šå›ã¯ nova-network ã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸãŒã€neutron æ§‹æˆã‚‚çµ„ã‚ã‚‹ Cookbooks ã«ãªã£ã¦ã„ã‚‹ã®ã§ æ™‚é–“ã‚’è¦‹ã¤ã‘ã¦ã‚„ã£ã¦ã¿ã‚ˆã†ã‹ãªã¨è€ƒãˆã¦ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/07/17/openstach-ha-chef-deploy/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eOpenStack ã‚’é‹ç”¨ã™ã‚‹ä¸­ã§ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯é‡è¦ã§ã™ã€‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰ãŒè½ã¡ã‚‹ã¨ã€\nä»®æƒ³ãƒã‚·ãƒ³ã®æ“ä½œç­‰ãŒåˆ©ç”¨å‡ºæ¥ã¾ã›ã‚“ã€‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®å†—é•·æ§‹æˆã‚’å–ã‚‹ãƒã‚¤ãƒ³ãƒˆã¯å…¬å¼\nwiki ã‚µã‚¤ãƒˆã«è¨˜è¿°ã‚ã‚‹ã®ã§ã™ãŒ PaceMaker ã‚’ä½¿ã£ãŸæ§‹æˆã§ã—ã‚“ã©ã„ã§ã™ã€‚ä½•ã‚ˆã‚Šé‹ç”¨\nã™ã‚‹äººãŒæ··ä¹±ã™ã‚‹ä»•çµ„ã¿ã¯é¿ã‘ãŸã„ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eRackSpace ç¤¾ã®ç®¡ç†ã—ã¦ã„ã‚‹ Chef Cookbooks ã® Roles ã« \u0026lsquo;ha-controller1\u0026rsquo;,\n\u0026lsquo;ha-controller2\u0026rsquo; ã¨ã„ã†ãƒ¢ãƒãŒã‚ã‚Šã¾ã™ã€‚ä»Šå›ã¯ã“ã‚Œã‚’ä½¿ã£ãŸ HA æ§‹æˆã®æ§‹ç¯‰æ–¹æ³•ã«\nã¤ã„ã¦æ›¸ã„ã¦ã„ã“ã†ã‹ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h2\u003e\n\u003cp\u003eæœ€å°æ§‹æˆã‚’ä½œã‚ŠãŸã„ã¨æ€ã„ã¾ã™ã€‚HA ã®ãŸã‚ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰2å°, ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒãƒ¼\nãƒ‰1å°, Chef ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³1å°, Chef ã‚µãƒ¼ãƒãƒãƒ¼ãƒ‰1å°ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+----------------+----------------+----------------+----------------+--------------- public network\n|                |                | eth0           |                |                10.0.0.0/24\n+--------------+ +--------------+ +--------------+ +--------------+ +--------------+\n| controller01 | | controller01 | |  compute01   | | chef server  | | workstation  |\n+--------------+ +--------------+ +--------------+ +--------------+ +--------------+\n                                  | eth1\n                                  +------------------------------------------------- fixed range network\n                                                                                     172.16.0.0/24\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 id=\"ç‰¹å¾´\"\u003eç‰¹å¾´\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u0026lsquo;controller01\u0026rsquo;, \u0026lsquo;controller02\u0026rsquo; ã§ HA åŒ–ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©\u003c/li\u003e\n\u003cli\u003e\u0026lsquo;compute01\u0026rsquo; ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒãƒ¼ãƒ‰\u003c/li\u003e\n\u003cli\u003e\u0026lsquo;chef server\u0026rsquo; ã¯ Chef ã‚µãƒ¼ãƒã€Chef11 æ¨å¥¨\u003c/li\u003e\n\u003cli\u003eã»ã¨ã‚“ã©ã®ä½œæ¥­ã‚’è¡Œã† \u0026lsquo;workstaion\u0026rsquo; ã¯ Chef ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³\u003c/li\u003e\n\u003cli\u003enova-network æ§‹æˆ\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"chef-ã‚µãƒ¼ãƒã®æ§‹ç¯‰\"\u003eChef ã‚µãƒ¼ãƒã®æ§‹ç¯‰\u003c/h2\u003e\n\u003cp\u003eChef ã‚µãƒ¼ãƒã®æ§‹ç¯‰æ–¹æ³•ã¯æœ¬é¡Œã‹ã‚‰å¤–ã‚Œã‚‹ã®ã§å‰²æ„›ã—ã¾ã™ã€‚ä»Šã¯ Omnibus ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã§ä¸€ç™ºã§ã™ã€‚\u003c/p\u003e","title":"OpenStack HA æ§‹æˆã‚’ Chef ã§ãƒ‡ãƒ—ãƒ­ã‚¤"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nå‰å›ã®è¨˜äº‹ã§ OpenCenter ã‚’ä½¿ã£ãŸ OpenStack ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã„ã¾ã—ãŸãŒã€ãƒ‡ãƒ—ãƒ­ã‚¤ã® ä»•çµ„ã¿ã®å®Ÿä½“ã¯ Opscode Chef ã§ã™ã€‚æ…£ã‚Œã¦ã„ã‚‹äººã§ã‚ã‚Œã° Chef ã‚’å˜ç‹¬ã§ä½¿ã£ãŸæ–¹ãŒ ã‚ˆã•ãã†ã§ã™ã€‚åƒ•ã‚‚ã“ã®æ–¹æ³•ã‚’ä»Šå¾Œå–ã‚ã†ã¨æ€ã£ã¦ã„ã¾ã™ã€‚\nå¹¾ã¤ã‹ã®æ§‹æˆã‚’è©¦ã—ã¦ã„ã‚‹æœ€ä¸­ã§ã™ãŒã€ä»Šå› nova-network ã‚’ä½¿ã£ãŸã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹ æˆã‚’ä½œã£ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚NIC ã®æ•°ã¯1ã¤ã§ã™ã€‚ãƒãƒ¼ãƒˆ PC ã‚„ VPS ã‚µãƒ¼ãƒ“ã‚¹ä¸Šã«ã‚‚ æ§‹ç¯‰ã§ãã‚‹ã¨æ€ã„ã¾ã™ã®ã§è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\nä»Šå›ã¯ Chef ã‚µãƒ¼ãƒã®æ§‹ç¯‰ã‚„ Knife ã®ç’°å¢ƒæ§‹ç¯‰ã«é–¢ã—ã¦ã¯å‰²æ„›ã—ã¾ã™ã€‚\nã¾ãŸå…¨ã¦ã®æ“ä½œã¯ workstation ãƒãƒ¼ãƒ‰ã§è¡Œã„ã¾ã™ã€‚çš†ã•ã‚“ãŠæ‰‹æŒã¡ã® Macbook ç­‰ã§ã™ã€‚ ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å…ˆã¯ OpenStack ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‚µãƒ¼ãƒã§ã™ã€‚\næ‰‹é † Chef Cookbook ã‚’å–å¾— RackSpace ç¤¾ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã¦ã„ã‚‹ Chef Cookbook ã‚’ä½¿ã„ã¾ã™ã€‚å„ Cookbook ãŒ git submodule åŒ–ã•ã‚Œã¦ã„ã‚‹ã®ã§ \u0026ndash;recursive ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã¾ã™ã€‚\n% git clone https://github.com/rcbops/chef-cookbooks.git ~/openstack-chef-repo % cd openstack-chef-repo \u0026lsquo;v4.0.0\u0026rsquo; ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ master ãƒ–ãƒ©ãƒ³ãƒã¯ä»Šç¾åœ¨ (2013/07/08) folsom ãƒ™ãƒ¼ã‚¹ã®æ§‹æˆã«ãªã£ã¦ã„ã‚‹ã®ã§ \u0026lsquo;grizzly\u0026rsquo; ã®ãŸã‚ã®ãƒ–ãƒ©ãƒ³ãƒ \u0026lsquo;v4.0.0\u0026rsquo; ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ã¾ã™ã€‚\n% git checkout v4.0.0 submodule ã§ã‚ã‚‹ Cookbooks ã‚’åˆæœŸåŒ– -\u0026gt; æ›´æ–°ã‚’è¡Œã„ã¾ã™ã€‚\n% git submodule init % git submodule sync % git submodule update Environment ã®ä½œæˆ Chef ã®ä¸­ã« Environment ã¨ã„ã†æƒ…å ±ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ç’°å¢ƒã«åˆã‚ã›å„ Cookbooks å†…ã® Attributes ç­‰ã‚’ä¸Šæ›¸ãã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã® Environment ã‚’ä½œæˆã™ã‚‹ã“ã¨ ã§ãã‚Œãã‚Œç‹¬ç«‹ã—ã¦ã„ã‚‹ Cookbooks ã‚’ç”¨ã„ã¦ä¸€ã¤ã®ç’°å¢ƒã‚’ä½œã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã£ã¦ã„ã¾ã™ã€‚ Environement ã¯ clone ã—ã¦ããŸç’°å¢ƒã® environments ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«æ ¼ç´ã—ã¾ã™ã€‚ ä¸‹è¨˜ã®æƒ…å ±ã‚’ã‚³ãƒ”ãƒšã—ã¦ environments/AllinOne.json ã¨ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚\n{ \u0026#34;name\u0026#34;: \u0026#34;AllinOne\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;cookbook_versions\u0026#34;: { }, \u0026#34;json_class\u0026#34;: \u0026#34;Chef::Environment\u0026#34;, \u0026#34;chef_type\u0026#34;: \u0026#34;environment\u0026#34;, \u0026#34;default_attributes\u0026#34;: { }, \u0026#34;override_attributes\u0026#34;: { \u0026#34;package_component\u0026#34;: \u0026#34;grizzly\u0026#34;, \u0026#34;osops_networks\u0026#34;: { \u0026#34;management\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34;, \u0026#34;public\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34;, \u0026#34;nova\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34; }, \u0026#34;nova\u0026#34;: { \u0026#34;networks\u0026#34;: [ { \u0026#34;bridge\u0026#34;: \u0026#34;br100\u0026#34;, \u0026#34;num_networks\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;dns2\u0026#34;: \u0026#34;8.8.4.4\u0026#34;, \u0026#34;dns1\u0026#34;: \u0026#34;8.8.8.8\u0026#34;, \u0026#34;ipv4_cidr\u0026#34;: \u0026#34;172.16.0.0/24\u0026#34;, \u0026#34;network_size\u0026#34;: \u0026#34;256\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;private\u0026#34; } ], \u0026#34;config\u0026#34;: { \u0026#34;use_single_default_gateway\u0026#34;: false, \u0026#34;ram_allocation_ratio\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;cpu_allocation_ratio\u0026#34;: \u0026#34;16\u0026#34; }, \u0026#34;network\u0026#34;: { \u0026#34;dmz_cidr\u0026#34;: \u0026#34;172.18.0.0/24\u0026#34;, \u0026#34;public_interface\u0026#34;: \u0026#34;eth0\u0026#34;, \u0026#34;multi_host\u0026#34;: true, \u0026#34;fixed_range\u0026#34;: \u0026#34;172.16.0.0/24\u0026#34; }, \u0026#34;apply_patches\u0026#34;: true, \u0026#34;libvirt\u0026#34;: { \u0026#34;vncserver_listen\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;virt_type\u0026#34;: \u0026#34;qemu\u0026#34; } }, \u0026#34;keystone\u0026#34;: { \u0026#34;admin_user\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;tenants\u0026#34;: [ \u0026#34;admin\u0026#34;, \u0026#34;service\u0026#34; ], \u0026#34;users\u0026#34;: { \u0026#34;admin\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;secrete\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;admin\u0026#34;: [ \u0026#34;admin\u0026#34; ] } }, \u0026#34;demo\u0026#34;: { \u0026#34;password\u0026#34;: \u0026#34;demo\u0026#34;, \u0026#34;default_tenant\u0026#34; : \u0026#34;service\u0026#34;, \u0026#34;roles\u0026#34;: { \u0026#34;service\u0026#34;: [ \u0026#34;service\u0026#34; ] } } } }, \u0026#34;horizon\u0026#34;: { \u0026#34;theme\u0026#34;: \u0026#34;Rackspace\u0026#34; }, \u0026#34;mysql\u0026#34;: { \u0026#34;root_network_acl\u0026#34;: \u0026#34;%\u0026#34;, \u0026#34;allow_remote_root\u0026#34;: true }, \u0026#34;monitoring\u0026#34;: { \u0026#34;procmon_provider\u0026#34;: \u0026#34;monit\u0026#34;, \u0026#34;metric_provider\u0026#34;: \u0026#34;collectd\u0026#34; }, \u0026#34;glance\u0026#34;: { \u0026#34;images\u0026#34;: [ \u0026#34;precise\u0026#34;, \u0026#34;cirros\u0026#34; ], \u0026#34;image\u0026#34;: { }, \u0026#34;image_upload\u0026#34;: true }, \u0026#34;developer_mode\u0026#34;: false } } ç’°å¢ƒã«åˆã‚ã›ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã¯\u0026hellip;\n\u0026#34;osops_networks\u0026#34;: { \u0026#34;management\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34;, \u0026#34;public\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34;, \u0026#34;nova\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34; }, ã ã‘ã§ã™ã€‚ç§ã®ç’°å¢ƒã¯ 10.0.0.0/24 ã«ã‚ã‚‹ã®ã§ä¸Šè¨˜ã®ã‚ˆã†ã«è¨˜ã—ã¾ã—ãŸãŒã€ã“ã‚Œã¯ã¿ ãªã•ã‚“ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã«åˆã‚ã›ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚\nRoles ã®ä¿®æ­£ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® \u0026lsquo;allinone\u0026rsquo; Role ã§ã¯ Cinder ãŒä½¿ãˆãªã„çŠ¶æ…‹ã§ã™ã€‚ã“ã‚Œã¯åˆ¥ã‚¹ãƒˆãƒ¬ãƒ¼ ã‚¸ã‚’æ‰±ã†ã“ã¨ã‚’å‰æã«ã—ã¦ã„ã‚‹ãŸã‚ã¨æ€ã‚ã‚Œã¾ã™ã€‚ä»Šå›ã¯ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ã§ã‚³ãƒŸã‚³ãƒŸã® æ§‹æˆã‚’çµ„ã¿ãŸã„ã®ã§ roles/allinone.json ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«è¿½è¨˜ã—ã¾ã™ã€‚\nrun_list( \u0026#34;role[single-controller]\u0026#34;, \u0026#34;role[single-compute]\u0026#34;, \u0026#34;role[cinder-volume]\u0026#34; # \u0026lt;- è¿½åŠ  ) Cookbooks, Roles, Environments ã‚’ Chef ã‚µãƒ¼ãƒã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ãŸ Cookbooks, Roles, ã‚ã¨ä»Šä½œæˆã—ãŸ Environements ã‚’ Chef ã‚µãƒ¼ ãƒã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\n% knife cookbook upload -o cookbooks -a % knife role from file roles/*.rb % knife environment from file environments/AllinOne.json OpenStack ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ ã„ã‚ˆã„ã‚ˆã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã„ã¾ã™ã€‚\n% knife bootstrap \u0026lt;ip_address\u0026gt; -N \u0026lt;hostname\u0026gt; -r \u0026#39;role[allinone]\u0026#39; -E AllinOne --sudo -x \u0026lt;username\u0026gt; æ•°åˆ†çµŒã¤ã¨ OpenStack ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã§ https://\u0026lt;ip_address\u0026gt; ã¸ ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ç¢ºèªã—ã¦ã¿ã¦ãã ã•ã„ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä¸Šè¨˜ã® environments å†…ã« è¨˜ã—ã¦ã‚ã‚Šã¾ã™ã€‚(user : demo, pass : demo, ã‚‚ã—ãã¯ user : admin, pass : secrete)\nCinder ã®åˆ©ç”¨ ã“ã®çŠ¶æ…‹ã§ VM ã‚’ä½œæˆã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã¯å‡ºæ¥ã‚‹ã®ã§ã™ãŒã€Block Storage as a Service (Cinder) ã¯åˆ©ç”¨ã§ããªã„çŠ¶æ…‹ã§ã™ã€‚ä¸‹è¨˜ã®æ“ä½œã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\n% sudo dd if=/dev/zero of=/var/lib/cinder/volumes-disk bs=2 count=0 seek=7G % sudo modprobe loop % sudo losetup /dev/loop3 /var/lib/cinder/volumes-disk % sudo pvcreate /dev/loop3 % sudo vgcreate cinder-volumes /dev/loop3 % sudo service cinder-volume restart ã¾ã¨ã‚ã¨è€ƒå¯Ÿ æ“ä½œã—ã¦æ°—ãŒã¤ã„ãŸã¨æ€ã„ã¾ã™ãŒã€Roles ãŒæ•°å¤šãå­˜åœ¨ã—ã¾ã™ã€‚ã“ã‚Œã¯è‰²ã‚“ãªæ§‹æˆãŒçµ„ ã‚ã‚‹ã“ã¨ã‚’æ˜ç¤ºã—ã¦ã„ã‚‹ã¨è¨€ãˆã¾ã™ã€‚ã¾ãŸã€Environments ã‚’ OpenStack ä¸Šã®ä¸€ã¤ã®æ§‹ æˆã«è¦‹ç«‹ã¦ã‚‹ (ä¾‹ : controller + compute x n ) ã‚ãŸã‚ŠãŒã€ã¨ã¦ã‚‚ Chef ã¨ã®è¦ªå’Œæ€§ ãŒé«˜ã„ã¨è¨€ãˆã¾ã™ã€‚ä»Šã¾ã§æ§‹ç¯‰ã®ãŸã‚ã« bash ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ã„ã¦ãã¾ã—ãŸãŒã€ã‚‚ã†ã ã®å¿…è¦ãŒç„¡ããªã‚Šã¾ã—ãŸã€‚ã¾ãŸ Git ã®ãƒ–ãƒ©ãƒ³ãƒã« \u0026lsquo;folsom\u0026rsquo; ç­‰ãŒã‚ã‚‹é€šã‚Šã€ãƒ–ãƒ©ãƒ³ãƒ ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ç›´ã™ã“ã¨ã§ folsom ãƒ™ãƒ¼ã‚¹ã®æ§‹æˆã‚‚çµ„ã‚€ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ç§ã¯ä»Šã€ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰ã® HA åŒ–ã‚’ã“ã® Cookbooks ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã¦ã„ã¾ã™ã€‚ã¨ã¦ã‚‚å®Œ æˆåº¦ãŒé«˜ã„ãªãã¨æ„Ÿã˜ã‚‹ã®ã¯ environments ã§ã‚ã‚‹ json ãƒ•ã‚¡ã‚¤ãƒ«ã« vips ã¨ã„ã†é …ç›® ã‚’è¿½è¨˜ã™ã‚‹ã ã‘ã§ HA æ§‹æˆãŒçµ„ã‚ã‚‹ç‚¹ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Š MySQL, Rabbitmq, API ãŒ VIP ã‚’æŒã¡ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰ã®ç‰‡ç³»ã«éšœå®³ãŒç™ºç”Ÿã—ã¦ã‚‚ OpenStack å…¨ä½“ã®æ§‹æˆ (ä»Šå› ã§è¨€ã†ä¸€ã¤ã® Envorinments ã§ã™ã­) ãŒã‚µãƒ¼ãƒ“ã‚¹ç¶™ç¶šã§ãã‚‹ï¼ã¨ã„ã†ã“ã¨ã§ã™ã€‚æ¬¡å›ã€ æ©Ÿä¼šãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€ãã®æ§‹æˆã®ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã«ã¤ã„ã¦ã‚‚ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nã¾ãŸã€ä»Šå›ã¯ VPS ã‚µãƒ¼ãƒ“ã‚¹ä¸Šç­‰ã«æ§‹ç¯‰å‡ºæ¥ã‚‹ã‚ˆã†ã«\n\u0026#34;virt_type\u0026#34;: \u0026#34;qemu\u0026#34; ã¨ environments ã«è¨˜ã—ã¾ã—ãŸãŒã€KVM ãƒªã‚½ãƒ¼ã‚¹ãŒæ‰±ãˆã‚‹ç’°å¢ƒã§ã‚ã‚Œã°ã“ã“ã‚’ \u0026lsquo;kvm\u0026rsquo; ã¨ã™ã‚‹ã“ã¨ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯è‹¥å¹²ä¸ŠãŒã‚‹ã¨æ€ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/07/08/chef-openstack-deploy/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå‰å›ã®è¨˜äº‹ã§ OpenCenter ã‚’ä½¿ã£ãŸ OpenStack ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã„ã¾ã—ãŸãŒã€ãƒ‡ãƒ—ãƒ­ã‚¤ã®\nä»•çµ„ã¿ã®å®Ÿä½“ã¯ Opscode Chef ã§ã™ã€‚æ…£ã‚Œã¦ã„ã‚‹äººã§ã‚ã‚Œã° Chef ã‚’å˜ç‹¬ã§ä½¿ã£ãŸæ–¹ãŒ\nã‚ˆã•ãã†ã§ã™ã€‚åƒ•ã‚‚ã“ã®æ–¹æ³•ã‚’ä»Šå¾Œå–ã‚ã†ã¨æ€ã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå¹¾ã¤ã‹ã®æ§‹æˆã‚’è©¦ã—ã¦ã„ã‚‹æœ€ä¸­ã§ã™ãŒã€ä»Šå› nova-network ã‚’ä½¿ã£ãŸã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹\næˆã‚’ä½œã£ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚NIC ã®æ•°ã¯1ã¤ã§ã™ã€‚ãƒãƒ¼ãƒˆ PC ã‚„ VPS ã‚µãƒ¼ãƒ“ã‚¹ä¸Šã«ã‚‚\næ§‹ç¯‰ã§ãã‚‹ã¨æ€ã„ã¾ã™ã®ã§è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ Chef ã‚µãƒ¼ãƒã®æ§‹ç¯‰ã‚„ Knife ã®ç’°å¢ƒæ§‹ç¯‰ã«é–¢ã—ã¦ã¯å‰²æ„›ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãŸå…¨ã¦ã®æ“ä½œã¯ workstation ãƒãƒ¼ãƒ‰ã§è¡Œã„ã¾ã™ã€‚çš†ã•ã‚“ãŠæ‰‹æŒã¡ã® Macbook ç­‰ã§ã™ã€‚\nãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å…ˆã¯ OpenStack ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‚µãƒ¼ãƒã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ‰‹é †\"\u003eæ‰‹é †\u003c/h2\u003e\n\u003ch4 id=\"chef-cookbook-ã‚’å–å¾—\"\u003eChef Cookbook ã‚’å–å¾—\u003c/h4\u003e\n\u003cp\u003eRackSpace ç¤¾ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã¦ã„ã‚‹ Chef Cookbook ã‚’ä½¿ã„ã¾ã™ã€‚å„\nCookbook ãŒ git submodule åŒ–ã•ã‚Œã¦ã„ã‚‹ã®ã§ \u0026ndash;recursive ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% git clone https://github.com/rcbops/chef-cookbooks.git ~/openstack-chef-repo\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e% cd openstack-chef-repo\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"v400-ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ\"\u003e\u0026lsquo;v4.0.0\u0026rsquo; ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ\u003c/h4\u003e\n\u003cp\u003emaster ãƒ–ãƒ©ãƒ³ãƒã¯ä»Šç¾åœ¨ (2013/07/08) folsom ãƒ™ãƒ¼ã‚¹ã®æ§‹æˆã«ãªã£ã¦ã„ã‚‹ã®ã§\n\u0026lsquo;grizzly\u0026rsquo; ã®ãŸã‚ã®ãƒ–ãƒ©ãƒ³ãƒ \u0026lsquo;v4.0.0\u0026rsquo; ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ã¾ã™ã€‚\u003c/p\u003e","title":"Chef ã§ OpenStack ãƒ‡ãƒ—ãƒ­ã‚¤"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nç¬¬13å› OpenStack å‹‰å¼·ä¼šã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚å†…å®¹ã®æ¿ƒã„åç©«ã®ã‚ã‚‹å‹‰å¼·ä¼šã§ã—ãŸã€‚ å‚åŠ ã—ã¦ã‚ˆã‹ã£ãŸã€‚ç‰¹ã«ãˆãã¡ã•ã‚“ã® OpenCenter ã«é–¢ã™ã‚‹ãƒ—ãƒ¬ã‚¼ãƒ³ (ä¸‹è¨˜ã®ã‚¹ãƒ©ã‚¤ãƒ‰ å‚ç…§ã®ã“ã¨) ã«ã¯é©šãã¾ã—ãŸã€‚ã¡ã‚‡ã†ã©å½“æ—¥ RackSpace ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒç®¡ç†ã—ã¦ã„ã‚‹ github ä¸Šã® Chef Cookbooks ã‚’ä½¿ã£ã¦ OpenStack æ§‹ç¯‰ã§ããŸãï¼ã¨æ„Ÿå‹•ã—ã¦ã„ãŸã®ã«ã€ ãã®æ™©ã®ã†ã¡ã« Chef ã‚’ä½¿ã£ã¦ GUI ã§ï¼ OpenStack ãŒè‡ªå‹•æ§‹ç¯‰å‡ºæ¥ã‚‹ã ãªã‚“ã¦\u0026hellip;ã€‚\nãˆãã¡ã•ã‚“ã®ã‚¹ãƒ©ã‚¤ãƒ‰è³‡æ–™ã¯ã“ã¡ã‚‰ã€‚\nhttp://www.slideshare.net/guchi_hiro/open-centeropenstack\næ—©é€Ÿã€ç§ã‚‚æ‰‹å…ƒã§ OpenCenter ä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚ãˆãã¡ã•ã‚“ã€æƒ…å ±ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸãƒ¼ã€‚\nå®Ÿã¯ç§ ã¨ã—ã¦ã¯ Chef å˜ä½“ã§ OpenStack ã‚’æ§‹ç¯‰ã—ãŸã„ã®ã§ã™ãŒã€OpenCenter ãŒã©ã† Cookbook ã‚„ Roles, Environment ã‚’å‰²ã‚Šå½“ã¦ã¦ã„ã‚‹ã®ã‹çŸ¥ã‚ŠãŸã‹ã£ãŸã®ã§ã€ OpenCenter ã‚’ä½¿ã£ã¦æ§‹ç¯‰ã—ã¦ã¿ã¾ã—ãŸã€‚ä»Šå›ã¯ãã®æº–å‚™ã€‚ä»Šæ—¥ã¯ OpenCenter ã§çš†ã• ã‚“ã‚‚ OpenStack ã‚’æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã‚­ãƒ£ãƒ—ãƒãƒ£ä»˜ãã§æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ãŒã€æ¬¡ã®æ©Ÿä¼šã« Chef å˜ä½“ã§ã® OpenStack ã®æ§‹ç¯‰æ–¹æ³•ã‚’ç´¹ä»‹å‡ºæ¥ã‚Œã°ã„ã„ãªãã¨æ€ã£ã¦ã„ã¾ã™ã€‚\næ§‹æˆ +---------------+---------------+---------------+---------------+-------------- public network |eth0 |eth0 |eth1 |eth1 | eth1 |10.200.10.11 |10.200.10.12 |10.200.10.13 |10.200.10.14 |10.200.10.15 +-------------+ +-------------+ +-------------+ +-------------+ +-------------+ | opencenter | | oc-chef | |oc-controller| | oc-compute01| | oc-compute02| +-------------+ +-------------+ +-------------+ +-------------+ +-------------+ |10.200.9.14 |10.200.9.15 | eth0 |eth0 +---------------+-------------- vm network 5å°ä½¿ã£ã¦ã¿ãŸ å…¨ã¦ã®ãƒãƒ¼ãƒ‰ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸ã®çµŒè·¯ã‚’ public network ã«å‘ã‘ã‚‹ VM ãŒæ¥ç¶šã™ã‚‹ br100 ãƒ–ãƒªãƒƒã‚¸ã¯ eth0 ã«ãƒã‚¤ãƒ³ãƒ‰ã—ãŸ VM ã‹ã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ oc-computeNN ãŒ NAT ã™ã‚‹ oc-chef ã¯ Chef Server ! OpenCenter ã®æ§‹ç¯‰ æ§‹ç¯‰ã¯\u0026hellip;\n% curl -s -L http://sh.opencenter.rackspace.com/install.sh | sudo bash -s - --role=server % curl -s -L http://sh.opencenter.rackspace.com/install.sh | \\ sudo bash -s - --role=dashboard --ip=10.200.10.11 ã“ã‚Œã ã‘ï¼\nOpenCenter ã§ç®¡ç†ã™ã‚‹ãƒãƒ¼ãƒ‰ã¸ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« oc-chef, oc-controller, oc-computeNN ã¯å…¨ã¦ OpenCenter ã§ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã® ã§ OpenCeter ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% curl -s -L http://sh.opencenter.rackspace.com/install.sh | \\ sudo bash -s - --role=agent --ip=10.200.10.11 GUI ã¸ã‚¢ã‚¯ã‚»ã‚¹ https://10.200.10.11 ãƒ–ãƒ©ã‚¦ã‚¶ã§ä¸Šè¨˜ã® URL ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ± (ãƒ¦ãƒ¼ã‚¶å : admin, ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ : password) ã§ãƒ­ã‚°ã‚¤ãƒ³å‡ºæ¥ã¾ã™ã€‚\n{% img /pix/oc01.png 600 %}\nã“ã‚“ãªæ„Ÿã˜ã€‚\nChef Server ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« oc-chef ã‚’ã‚¯ãƒªãƒƒã‚¯ -\u0026gt; \u0026lsquo;Install Chef Server\u0026rsquo; ã‚’é¸æŠ\næš«ãã™ã‚‹ã¨ã‚¿ã‚¹ã‚¯ãŒã‚°ãƒªãƒ¼ãƒ³ã«ãªã‚Šå®Œäº†ã€‚\n{% img /pix/oc02.png 600 %}\nã“ã†ãªã‚Šã¾ã™ã€‚ã“ã® Chef Server ä¸Šã® Cookbooks, Roles ç­‰ã‚’åˆ©ç”¨ã—ã¦ knife bootstrap ã—ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ»ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ã‚’æ§‹ç¯‰ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚\nNovaCluster ã®ä½œæˆ NovaCluster ã¨ã„ã† controller x n, compute x n ã®ã‚»ãƒƒãƒˆã‚’æ„å‘³ã™ã‚‹ãƒ¢ãƒã‚’ä½œã‚Šã¾ ã™ã€‚å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ä¸‹è¨˜ã®ç”»åƒã®ã‚ˆã†ã«å…¥åŠ›ã—ã¾ã™ã€‚\n{% img /pix/oc03.png 600 %}\nNAT Exclusion CIDRs ãŒ DMZ, VM Network CIDR ãŒ Fixed Range ã ã¨ç†è§£ã™ã‚Œã°ã€ä»– ã¯å•é¡Œãªã„ã‚ˆã†ã«æ€ã„ã¾ã™ã€‚\n{% img /pix/oc04.png 600 %}\nçµæœã€ã“ã†ãªã‚Šã¾ã™ã€‚\nã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰æ§‹ç¯‰ available nodes ã«ã‚ã‚‹ãƒãƒ¼ãƒ‰ \u0026lsquo;oc-controller\u0026rsquo; ã‚’ \u0026lsquo;Infrastructure\u0026rsquo; ã¸ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¾ã™ã€‚\n{% img /pix/oc05.png 600 %}\nã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒãƒ¼ãƒ‰æ§‹ç¯‰ available nodes ã«ã‚ã‚‹ãƒãƒ¼ãƒ‰ \u0026lsquo;oc-computeNN\u0026rsquo; ã‚’ \u0026lsquo;AZ Nova\u0026rsquo; ã¸ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒ ãƒ—ã—ã¾ã™ã€‚\n{% img /pix/oc07.png 600 %}\n2å°ã¨ã‚‚ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã¨ã€ã“ã†ãªã‚Šã¾ã™ã€‚\nHorizon ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—æ“ä½œ ã‚ã¨ã¯ã„ã¤ã‚‚ã®ã‚ˆã†ã« OpenStack ã‚’æ“ä½œã™ã‚‹ã ã‘ã§ã™ã€‚Horizon ã¸ã¯ä¸‹è¨˜ã® URL ã§ã‚¢ ã‚¯ã‚»ã‚¹å‡ºæ¥ã¾ã™ã€‚admin ãƒ¦ãƒ¼ã‚¶ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å…ˆã»ã©ã® NovaCluster ä½œæˆã®éš›ã«å…¥åŠ› ã—ãŸãƒ¢ãƒã§ã™ã€‚\nhttps://10.200.10.13 ã¾ã¨ã‚ å®Œæˆã•ã‚ŒãŸ OpenStack ã‚’è¦—ã„ãŸã®ã§ã™ãŒ monit ãŒåˆ©ç”¨ã•ã‚Œã¦ã„ãŸã‚Šã€Horizon ãŒ HTTPS åŒ–ã•ã‚Œã¦ã„ãŸã‚Šã€å®Œæˆåº¦ãŒé«˜ã‹ã£ãŸã§ã™ã€‚ã•ã™ãŒ RackSpace è£½ã¨ã„ã†æ„Ÿã˜ã€‚ã‚‚ ã† OpenStack æ§‹ç¯‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒãªããªã£ãŸãªãã¨ã€‚Chef ã§æ§‹ç¯‰ã™ã‚‹ã¹ ãã§ã™ã€‚\nå†…éƒ¨ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ Chef Cookbooks ã¯ä¸‹è¨˜ã® URL ã«åŒã˜ã‚‚ã®ãŒã‚ã‚Šã¾ã—ãŸã€‚\nhttps://github.com/rcbops/chef-cookbooks\nã“ã® Chef Cookbooks ã‚’å˜ä½“ã§ä½¿ã£ã¦æ§‹ç¯‰ã—ã¦ã¿ã¾ã—ãŸãŒåŒæ§˜ã«1ã‚³ãƒãƒ³ãƒ‰ã§æ§‹ç¯‰ãŒå‡º æ¥ã¾ã—ãŸã€‚(ã‚ªãƒ¼ãƒ«ãƒ»ã‚¤ãƒ³ãƒ»ãƒ¯ãƒ³æ§‹æˆã—ã‹è©¦ã—ã¦ã„ã¾ã›ã‚“) åƒ•ã‚‰ã¨ã—ã¦ã¯ GUI ã¯ä»•äº‹ã§ ã¯æ“ä½œã—ã«ãã„ã®ã§ã“ã®Cookbooks ã‚’åˆ©ç”¨ã—ãŸå½¢ã§æ”¹ä¿®ã—ä½¿ã£ã¦ã„ããŸã„ãªãã¨æ„Ÿã˜ã¦ ã„ã¾ã™ã€‚GUI ã§ã‚ã£ã¦ã‚‚ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã§å…ƒã«ã¯æˆ»ã›ã¾ã›ã‚“ã—ã€å¾Œã€… Cookbook ã«æ‰‹ã‚’å…¥ã‚Œæ§‹æˆã‚’å¤‰æ›´ã™ã‚‹ã¨ã„ã£ãŸã“ã¨ã‚‚é¢å€’ã«ãªã‚Šãã†ã§ã™ã€‚\nã¨ã¯è¨€ã£ã¦ã‚‚ã€ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã§æ§‹ç¯‰ã§ãã‚‹ãªã‚“ã¦\u0026hellip; ã€‚èª°ã§ã‚‚æ§‹ç¯‰ã§ãã‚‹æ™‚ æœŸã«ã‚ã‚‹ã‚“ã§ã™ã­ã€‚é‹ç”¨ã™ã‚‹ã«ã¯ Cookbook ã‚’ç†è§£ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ãŒã€ RackSpace ã¨ã—ã¦ã¯ Private Cloud Service ã«é‹ç”¨ã‚‚ã‚»ãƒƒãƒˆã§ä»˜åŠ ã—ã¦å£²ã£ã¦ã„ã‚‹ã® ã§å•é¡Œãªã„ã®ã§ã—ã‚‡ã†ã€‚\nã¡ãªã¿ã« Chef ã®æƒ…å ±ã¯ os-chef ãƒãƒ¼ãƒ‰ã® root ãƒ¦ãƒ¼ã‚¶ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã§æ¢ ã‚Œã¾ã™ã€‚\noc-chef# cd ~ oc-chef# knife cookbook list oc-chef# knife role list oc-chef# knife environment list oc-chef# knife environment show NovaCluster01 ","permalink":"https://jedipunkz.github.io/post/2013/07/02/chef-opencenter-openstack/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eç¬¬13å› OpenStack å‹‰å¼·ä¼šã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚å†…å®¹ã®æ¿ƒã„åç©«ã®ã‚ã‚‹å‹‰å¼·ä¼šã§ã—ãŸã€‚\nå‚åŠ ã—ã¦ã‚ˆã‹ã£ãŸã€‚ç‰¹ã«ãˆãã¡ã•ã‚“ã® OpenCenter ã«é–¢ã™ã‚‹ãƒ—ãƒ¬ã‚¼ãƒ³ (ä¸‹è¨˜ã®ã‚¹ãƒ©ã‚¤ãƒ‰\nå‚ç…§ã®ã“ã¨) ã«ã¯é©šãã¾ã—ãŸã€‚ã¡ã‚‡ã†ã©å½“æ—¥ RackSpace ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒç®¡ç†ã—ã¦ã„ã‚‹\ngithub ä¸Šã® Chef Cookbooks ã‚’ä½¿ã£ã¦ OpenStack æ§‹ç¯‰ã§ããŸãï¼ã¨æ„Ÿå‹•ã—ã¦ã„ãŸã®ã«ã€\nãã®æ™©ã®ã†ã¡ã« Chef ã‚’ä½¿ã£ã¦ GUI ã§ï¼ OpenStack ãŒè‡ªå‹•æ§‹ç¯‰å‡ºæ¥ã‚‹ã ãªã‚“ã¦\u0026hellip;ã€‚\u003c/p\u003e\n\u003cp\u003eãˆãã¡ã•ã‚“ã®ã‚¹ãƒ©ã‚¤ãƒ‰è³‡æ–™ã¯ã“ã¡ã‚‰ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.slideshare.net/guchi_hiro/open-centeropenstack\"\u003ehttp://www.slideshare.net/guchi_hiro/open-centeropenstack\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eæ—©é€Ÿã€ç§ã‚‚æ‰‹å…ƒã§ OpenCenter ä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚ãˆãã¡ã•ã‚“ã€æƒ…å ±ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸãƒ¼ã€‚\u003c/p\u003e\n\u003cp\u003eå®Ÿã¯ç§ ã¨ã—ã¦ã¯ Chef å˜ä½“ã§ OpenStack ã‚’æ§‹ç¯‰ã—ãŸã„ã®ã§ã™ãŒã€OpenCenter ãŒã©ã†\nCookbook ã‚„ Roles, Environment ã‚’å‰²ã‚Šå½“ã¦ã¦ã„ã‚‹ã®ã‹çŸ¥ã‚ŠãŸã‹ã£ãŸã®ã§ã€\nOpenCenter ã‚’ä½¿ã£ã¦æ§‹ç¯‰ã—ã¦ã¿ã¾ã—ãŸã€‚ä»Šå›ã¯ãã®æº–å‚™ã€‚ä»Šæ—¥ã¯ OpenCenter ã§çš†ã•\nã‚“ã‚‚ OpenStack ã‚’æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã‚­ãƒ£ãƒ—ãƒãƒ£ä»˜ãã§æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ãŒã€æ¬¡ã®æ©Ÿä¼šã«\nChef å˜ä½“ã§ã® OpenStack ã®æ§‹ç¯‰æ–¹æ³•ã‚’ç´¹ä»‹å‡ºæ¥ã‚Œã°ã„ã„ãªãã¨æ€ã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h2\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+---------------+---------------+---------------+---------------+-------------- public network\n|eth0           |eth0           |eth1           |eth1           | eth1\n|10.200.10.11   |10.200.10.12   |10.200.10.13   |10.200.10.14   |10.200.10.15\n+-------------+ +-------------+ +-------------+ +-------------+ +-------------+\n| opencenter  | |   oc-chef   | |oc-controller| | oc-compute01| | oc-compute02|\n+-------------+ +-------------+ +-------------+ +-------------+ +-------------+\n                                                |10.200.9.14    |10.200.9.15\n                                                | eth0          |eth0\n                                                +---------------+-------------- vm network\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e5å°ä½¿ã£ã¦ã¿ãŸ\u003c/li\u003e\n\u003cli\u003eå…¨ã¦ã®ãƒãƒ¼ãƒ‰ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸ã®çµŒè·¯ã‚’ public network ã«å‘ã‘ã‚‹\u003c/li\u003e\n\u003cli\u003eVM ãŒæ¥ç¶šã™ã‚‹ br100 ãƒ–ãƒªãƒƒã‚¸ã¯ eth0 ã«ãƒã‚¤ãƒ³ãƒ‰ã—ãŸ\u003c/li\u003e\n\u003cli\u003eVM ã‹ã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ oc-computeNN ãŒ NAT ã™ã‚‹\u003c/li\u003e\n\u003cli\u003eoc-chef ã¯ Chef Server !\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"opencenter-ã®æ§‹ç¯‰\"\u003eOpenCenter ã®æ§‹ç¯‰\u003c/h2\u003e\n\u003cp\u003eæ§‹ç¯‰ã¯\u0026hellip;\u003c/p\u003e","title":"å†…éƒ¨ã§ Chef ã‚’ä½¿ã£ã¦ã„ã‚‹ OpenCenter ã§ OpenStack æ§‹ç¯‰"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nè‡ªå‹•åŒ–ã®åŸºç›¤ã‚’å°å…¥ã™ã‚‹ãŸã‚ã«è‰²ã€…èª¿ã¹ã¦ã„ã‚‹ã®ã§ã™ãŒã€ç›£è¦–ã‚‚è‡ªå‹•åŒ–ã—ãªãã¡ã‚ƒï¼ã¨ ã„ã†ã“ã¨ã§ Sensu ã‚’èª¿ã¹ã¦ãŸã®ã§ã™ãŒ Chef ã¨ã®ç›¸æ€§ãƒãƒƒãƒãƒªãªæ„Ÿã˜ã§ã€è‡ªåˆ†çš„ã«ã‚¤ ã‚±ã¦ã‚‹ãªã¨æ€ã„ã¾ã—ãŸã€‚\nå…¬å¼ã‚µã‚¤ãƒˆ http://www.sonian.com/cloud-monitoring-sensu/ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ http://docs.sensuapp.org/0.9/index.html é–‹ç™ºå…ƒãŒäºˆã‚ Chef ã® Cookbook (æ­£ç¢ºã«ã¯ãƒ©ãƒƒãƒ‘ãƒ¼ Cookbook é–‹ç™ºã®ãŸã‚ã® Cookbook ã§ Include ã—ã¦ä½¿ã†) ã‚’ç”¨æ„ã—ã¦ãã‚Œã¦ã„ãŸã‚Šã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’å®¹æ˜“ã«ã™ã‚‹ ãŸã‚ã® Omnibus å½¢å¼ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æä¾›ã ã£ãŸã‚Šã€‚Omnibus ãªã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨å…± ã« Sensu ãŒæ¨å¥¨ã™ã‚‹ Ruby ä¸€å¼ã‚‚ä¸€ç·’ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚Chef ã¨åŒã˜ã§ã™ã­ã€‚\nä»Šå›ç´¹ä»‹ã—ãŸã„ã®ã¯ã€Chef ã§ Sensu ã‚’æ§‹ç¯‰ãƒ»åˆ¶å¾¡ã™ã‚‹æ–¹æ³•ã§ã™ã€‚\n+--------------+ +--------------+ | chef-server | | workstation | +--------------+ +--------------+ | | +----------------+ | +--------------+ | sensu-server | +--------------+ | +----------------+----------------+----------------+ | | | | +--------------+ +--------------+ +--------------+ +--------------+ | sensu-client | | sensu-client | | sensu-client | | sensu-client | ..\u0026gt; +--------------+ +--------------+ +--------------+ +--------------+ | service node | | service node | | service node | | service node | +--------------+ +--------------+ +--------------+ +--------------+ ã“ã®æ§‹æˆã®å‡¦ç†ã®æµã‚Œã¨ã—ã¦ã¯\u0026hellip;\nsensu-server, sensu-client ã®æ§‹ç¯‰ã®æµã‚Œ workstation ã‹ã‚‰ cookbook, role, data_bag ã‚’ chef-server ã¸ã‚¢ãƒƒãƒ— workstation ã‹ã‚‰ sensu-server ã‚’ bootstrap ã§æ§‹ç¯‰ workstation ã‹ã‚‰ sensu-client ã‚’ boostrrap ã§æ§‹ç¯‰ ç›£è¦–é …ç›®ã®è¿½åŠ ãƒ»ç„¡åŠ¹åŒ–ã®æµã‚Œ workstation ã‹ã‚‰ç›£è¦–é …ç›® data bag ã® chef-server ã¸ã®ã‚¢ãƒƒãƒ— sensu-server ä¸Šã® chef-client ãŒ chef-server ã‹ã‚‰ data bag ã®å–å¾— sensu-server ã«æ–°ãŸãª(å‰Šé™¤ã•ã‚ŒãŸ)ç›£è¦–é …ç›®ãŒè¿½åŠ  sensu-client ãŒæ–°ãŸãª(å‰Šé™¤ã•ã‚ŒãŸ)ç›£è¦–é …ç›®ã‚’æ¤œçŸ¥ã—ã€ç›£è¦–é–‹å§‹ ã¤ã¾ã‚Š\u0026hellip; é‹ç”¨ã§å¿…è¦ãªæ“ä½œ (ç›£è¦–å¯¾è±¡ã®è¿½åŠ ãƒ»ç›£è¦–é …ç›®ã®è¿½åŠ ãƒ»ç„¡åŠ¹åŒ–)ã‚’ workstation ã‹ã‚‰ knife ã‚’ä½¿ã£ã¦å…¨ã¦è¡Œãˆã‚‹ã£ã¦ã„ã†ã“ã¨ã§ã™ã€‚ã—ã‹ã‚‚ Chef ã‚‚ Sensu ã‚‚ API ã‚’æŒã£ã¦ã„ã‚‹ã®ã§è‡ªå‹•åŒ–ã‚’å½¢æˆã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®é–‹ç™ºã‚‚å®¹æ˜“ã§ã™ã€‚å®Ÿéš›ã« API ã‚’å©ãã¡ã‚‡ã£ã¨ã—ãŸãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ Ruby on Rails ã§ä½œã£ã¦ã¿ã¾ã—ãŸãŒç°¡å˜ã«å‡ºæ¥ ã¾ã—ãŸã€‚\nä»Šå›ã¯ã“ã®æ§‹æˆã®æ§‹ç¯‰ã¨æ“ä½œæ–¹æ³•ã«ã¤ã„ã¦æ›¸ã„ã¦ã„ãã¾ã™ã€‚äºˆã‚ç§ã®ã»ã†ã§ä½œã£ã¦ãŠã„ ãŸ sensu ã®ãŸã‚ã® chef-repo ã‚’ä½¿ã£ã¦ç’°å¢ƒã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚\nhttps://github.com/jedipunkz/sensu-chef-repo\nã“ã® chef-repo ã«ã¯\nBerksfile ã‚µãƒ³ãƒ—ãƒ«ã®ç›£è¦–é …ç›® data bag SSL éµç”Ÿæˆã®ä»•çµ„ã¿ (å¾Œã« data bag ã«åã‚ã‚‹) ã®ã¿ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚å…¬å¼ã® sensu-chef ãƒ¬ãƒã‚¸ãƒˆãƒªå†…ã«ã‚ã£ãŸã‚µãƒ³ãƒ—ãƒ«ã‚’åˆ©ç”¨ã—ã¦ä½œã£ ã¦ã„ã¾ã™ã€‚ã¾ãŸã€Berksfile å†…ã§ã€ã“ã‚Œã¾ãŸ\nchef-redis (redis ã® cookbook) sensu-chef (å…¬å¼ã® sensu cookbook, ãƒ©ãƒƒãƒ‘ãƒ¼ cookbook å†…ã§ç”¨ã„ã‚‹) chef-monitor (ãƒ©ãƒƒãƒ‘ãƒ¼ cookbook ã®ä¾‹) ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ãã‚Œãã‚Œ fork ã—ã¦ç§ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã«ç½®ã„ã¦ã„ã¾ã™ã€‚å‹• ãçŠ¶æ…‹ã‚’ä¿ã¡ãŸã‹ã£ãŸãŸã‚ã§ã™ã€‚redis ã«é–¢ã—ã¦ã¯çµæ§‹æ‰‹ã‚’åŠ ãˆã¾ã—ãŸã€‚ãã®ã¾ã¾ã§ã¯ å…¨ãæ§‹ç¯‰å‡ºæ¥ãªã„çŠ¶æ…‹ã§ã—ãŸã®ã§ã€‚chef-monitor ã¯å†…éƒ¨ã§ sensu-chef (å…¬å¼ cookbook) ã‚’ Include ã—ã¦ã„ã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼ cookbook ã§ã™ã€‚å…¬å¼ cookbook å†…ã§ä¾‹ã¨ã— ã¦æŒ™ã’ã‚‰ã‚Œã¦ã„ãŸãƒ¢ãƒã§ã™ã€‚ã“ã¡ã‚‰ã¯æ‰‹ã‚’åŠ ãˆã¦ã„ã¾ã›ã‚“ã€‚\nã§ã¯æ‰‹é †ã‚’\u0026hellip;\n(chef ç’°å¢ƒã®æ§‹ç¯‰æ–¹æ³•ã¯å‰²æ„›ã—ã¾ã™)\nsensu-server ã®ãƒ‡ãƒ—ãƒ­ã‚¤ sensu-chef-repo ã®å–å¾—ã‚’è¡Œã„ã¾ã™ã€‚ã“ã“ã‹ã‚‰ã®æ“ä½œã¯å…¨ã¦ä¸Šå›³ã® workstation ä¸Šã§ ã®æ“ä½œã«ãªã‚Šã¾ã™ã€‚\n% git clone https://github.com/jedipunkz/sensu-chef-repo SSL éµãƒšã‚¢ã‚’ç”Ÿæˆã— data bag ã«æŠ•å…¥ã—ã¾ã™ã€‚\n% cd ~/sensu-chef-repo/data_bags/ssl % ./ssl_certs.sh generate % knife data bag create sensu % knife data bag from file sensu ./ssl.json ã‚µãƒ³ãƒ—ãƒ«ç›£è¦–é …ç›® proc_cron.json ã‚’ data bags ã«æŠ•å…¥ã—ã¾ã™ã€‚\n% cd ~/sensu-chef-repo/ % knife data bag create sensu_checks % knife data bag from file sensu_checks data_bags/sensu_checks/proc_cron.json proc_cron.json ã®å†…å®¹ã¯ä¸‹è¨˜ã®é€šã‚Š\n{ \u0026#34;id\u0026#34;: \u0026#34;proc_cron\u0026#34;, \u0026#34;command\u0026#34;: \u0026#34;check-procs.rb -p cron -C 1\u0026#34;, \u0026#34;subscribers\u0026#34;: [ \u0026#34;sensu-client\u0026#34; ], \u0026#34;interval\u0026#34;: 10 } json ã®æ§‹æˆã‚’èª¬æ˜ã™ã‚‹ã¨..\nid : ç›£è¦–é …ç›®å command : agent ãŒå®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ subscribers : ç›£è¦–å¯¾è±¡ã®ã‚°ãƒ«ãƒ¼ãƒ—å, chef role åãŒè‡ªå‹•ã§ç›£è¦–å¯¾è±¡ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ interval : ç›£è¦–é–“éš” (ç§’) ã¨ãªã‚Šã¾ã™ã€‚\nBerkshelf ã‚’ä½¿ã£ã¦ cookbook ã®å–å¾—ã‚’è¡Œã„ã¾ã™ã€‚\n% gem install berksfile --no-ri --no-rdoc % berks install --path ./cookbooks/ roles ã‚’ chef server ã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\n% knife role from file roles/sensu-client.rb # å¾Œã® sensu-client ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãŸã‚ã¤ã„ã§ã«æº–å‚™ã—ã¾ã™ % knife role from file roles/sensu-server.rb \u0026ldquo;master_address\u0026rdquo; ã‚’ sensu-server ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«æ›¸ãæ›ãˆã¾ã™ã€‚æ›¸ãæ›ãˆã‚‹ç®‡æ‰€ ã¯ \u0026lsquo;monitor\u0026rsquo; cookbook ã® attributes ã§ã™ã€‚\n% ${EDITOR} cookbooks/monitor/attributes/default.rb default[\u0026#34;monitor\u0026#34;][\u0026#34;master_address\u0026#34;] = \u0026#34;XXX.XXX.XXX.XXX\u0026#34; cookbooks ã‚’ chef server ã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\nworkstation% knife cookbook upload -a sensu-server ã‚’ knife ã‚’ç”¨ã„ã¦ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã—ã¾ã™ã€‚\n% knife bootstrap \u0026lt;server-ip\u0026gt; -N \u0026lt;server-name\u0026gt; -r \u0026#39;role[sensu-server]\u0026#39; -x root -i \u0026lt;secret-key\u0026gt; sensu ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ URL : http://:8080 ã«ã‚¢ã‚¯ã‚»ã‚¹ã—å‹•ä½œç¢ºèª, ã‚¢ã‚« ã‚¦ãƒ³ãƒˆæƒ…å ±ã¯ä¸‹è¨˜ã® attributes ã«è¨˜è¼‰ã—ã¦ã‚ã‚Šã¾ã™ã€‚\ncookbooks/sensu/attributes/default.rb sensu-client ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³• knife ã‚’ç”¨ã„ã¦ sensu-client ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚\n% knife bootstrap \u0026lt;client-ip\u0026gt; -N \u0026lt;client-name\u0026gt; -r \u0026#39;role[sensu-client]\u0026#39; -x root -i \u0026lt;secret-key\u0026gt; ã“ã®çŠ¶æ…‹ã§å…ˆã»ã©ã® \u0026lsquo;proc_cron\u0026rsquo; ãŒç›£è¦–é–‹å§‹ã•ã‚Œã¾ã™ã€‚\nç›£è¦–é …ç›®ã®è¿½åŠ æ–¹æ³• ä¸‹è¨˜ã®ã‚ˆã†ãª json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ nginx ã®ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦– ã®ãŸã‚ã®é …ç›®ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã™ã€‚\n% ${EDITOR} data_bags/sensu_checks/proc_nginx.json { \u0026#34;id\u0026#34;: \u0026#34;proc_nginx\u0026#34;, \u0026#34;command\u0026#34;: \u0026#34;check-procs.rb -p nginx -w 5 -c 10\u0026#34;, \u0026#34;subscribers\u0026#34;: [ \u0026#34;sensu-client\u0026#34; ], \u0026#34;interval\u0026#34;: 10 } å…ˆã»ã©ã‚‚æ›¸ãã¾ã—ãŸãŒ subscribers ã¯ chef çš„ãª role åã¨ä¸€è‡´ã—ã¦ã„ã¾ã™ã€‚ãªã®ã§ sensu ã®ç›£è¦–ã‚’ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã—ãŸã„ã¨ãã¯ role åã‚’å¤‰ãˆã¦ knife bootstrap ã™ã‚‹ã¨ è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚ã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ \u0026lsquo;sensu-client\u0026rsquo; ã¨ã„ã†å…ˆã»ã©åˆ©ç”¨ã—ãŸ role åã‚’ ç”¨ã„ã¾ã™ã€‚\ndata bags ã«ç›£è¦–é …ç›®æƒ…å ±ã‚’æŠ•å…¥ã—ã¾ã™ã€‚\n% knife data bag from file sensu_checks data_bags/sensu_checks/proc_nginx.json æš«ãã™ã‚‹ã¨ä¸‹è¨˜ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµŒã¦ç›£è¦–ãŒé–‹å§‹ã•ã‚Œã‚‹\nsensu-server ä¸Šã® chef-client ãŒ interval é–“éš”å¾Œå®Ÿè¡Œ sensu-server ã« proc_nginx.json ãŒé…ç½® sensu-server ãŒ chef ã«ã‚ˆã‚Šå†èµ·å‹• sensu-client ä¸Šã® sensu agent ãŒè‡ªã‚‰ã® subscribers ãŒå±ã—ã¦ã„ã‚‹ proc_nginx.json ã‚’æ¤œçŸ¥ sensu-client ãŒ nginx ã®ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–é–‹å§‹ ã¾ã¨ã‚ ç›£è¦–å¯¾è±¡è¿½åŠ  (agent ä»•è¾¼ã¿), ç›£è¦–é …ç›®è¿½åŠ ã‚’ workstation ä¸Šã‹ã‚‰ knife ã‚’ä½¿ã£ã¦ æ“ä½œå‡ºæ¥ã¾ã—ãŸã€‚ç›£è¦–é …ç›®ã®å‰Šé™¤ã«ã¤ã„ã¦ã¯ãƒ€ãƒŸãƒ¼ã® json (command é …ã« \u0026rsquo;echo ok\u0026rsquo; ãªã©è¨­å®š) ã‚’æŠ•å…¥ã™ã‚‹ã“ã¨ã§ã€ç§ã¯å¯¾å‡¦ã—ã¦ã„ã¾ã™ãŒã€æœ¬æ¥ã¯ data bag ãŒå­˜åœ¨ã—ãªã„ ã“ã¨ã‚’æ¤œçŸ¥ã—ã¦ sensu-server ä¸Šã‹ã‚‰ç›£è¦–é …ç›®ã‚’å‰Šé™¤ã™ã‚‹ cookbook ã«ä»•ä¸Šã’ãªã‘ã‚Œã° ã„ã‘ãªã„ã¨æ€ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/06/20/sensu-chef-controll/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eè‡ªå‹•åŒ–ã®åŸºç›¤ã‚’å°å…¥ã™ã‚‹ãŸã‚ã«è‰²ã€…èª¿ã¹ã¦ã„ã‚‹ã®ã§ã™ãŒã€ç›£è¦–ã‚‚è‡ªå‹•åŒ–ã—ãªãã¡ã‚ƒï¼ã¨\nã„ã†ã“ã¨ã§ Sensu ã‚’èª¿ã¹ã¦ãŸã®ã§ã™ãŒ Chef ã¨ã®ç›¸æ€§ãƒãƒƒãƒãƒªãªæ„Ÿã˜ã§ã€è‡ªåˆ†çš„ã«ã‚¤\nã‚±ã¦ã‚‹ãªã¨æ€ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå…¬å¼ã‚µã‚¤ãƒˆ \u003ca href=\"http://www.sonian.com/cloud-monitoring-sensu/\"\u003ehttp://www.sonian.com/cloud-monitoring-sensu/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ \u003ca href=\"http://docs.sensuapp.org/0.9/index.html\"\u003ehttp://docs.sensuapp.org/0.9/index.html\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eé–‹ç™ºå…ƒãŒäºˆã‚ Chef ã® Cookbook (æ­£ç¢ºã«ã¯ãƒ©ãƒƒãƒ‘ãƒ¼ Cookbook é–‹ç™ºã®ãŸã‚ã®\nCookbook ã§ Include ã—ã¦ä½¿ã†) ã‚’ç”¨æ„ã—ã¦ãã‚Œã¦ã„ãŸã‚Šã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’å®¹æ˜“ã«ã™ã‚‹\nãŸã‚ã® Omnibus å½¢å¼ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æä¾›ã ã£ãŸã‚Šã€‚Omnibus ãªã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨å…±\nã« Sensu ãŒæ¨å¥¨ã™ã‚‹ Ruby ä¸€å¼ã‚‚ä¸€ç·’ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚Chef ã¨åŒã˜ã§ã™ã­ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ç´¹ä»‹ã—ãŸã„ã®ã¯ã€Chef ã§ Sensu ã‚’æ§‹ç¯‰ãƒ»åˆ¶å¾¡ã™ã‚‹æ–¹æ³•ã§ã™ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+--------------+ +--------------+\n| chef-server  | | workstation  |\n+--------------+ +--------------+\n       |                |\n       +----------------+ \n       |\n+--------------+\n| sensu-server |\n+--------------+\n       |\n       +----------------+----------------+----------------+\n       |                |                |                |\n+--------------+ +--------------+ +--------------+ +--------------+\n| sensu-client | | sensu-client | | sensu-client | | sensu-client | ..\u0026gt;\n+--------------+ +--------------+ +--------------+ +--------------+\n| service node | | service node | | service node | | service node |\n+--------------+ +--------------+ +--------------+ +--------------+\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eã“ã®æ§‹æˆã®å‡¦ç†ã®æµã‚Œã¨ã—ã¦ã¯\u0026hellip;\u003c/p\u003e","title":"Sensu ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‚’ Chef ã§åˆ¶å¾¡"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nrequire \u0026lsquo;chef\u0026rsquo; ã—ã¦ Ruby ã‚³ãƒ¼ãƒ‰ã®ä¸­ã§ chef ã‚’åˆ©ç”¨ã—ãŸã„ã¨æ€ã£ã¦è‰²ã€…èª¿ã¹ã¦ã„ãŸ ã®ã§ã™ãŒã€ãã‚‚ãã‚‚ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãŒç„¡ãã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚‚ã”ãã‚ãšã‹ã—ã‹ãƒãƒƒãƒˆä¸Šã«è¦‹ ã¤ã‘ã‚‰ã‚Œãªã„çŠ¶æ…‹ã§ã—ãŸã€‚çµå±€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ç†è§£ã—ã¦ã„ãä¸–ç•Œãªã‚ã‘ã§ã™ãŒã€ ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ãŒå¹¾ã¤ã‹ã‚ã‚‹ã¨ä»–ã®äººã«å½¹ç«‹ã¤ã‹ãªãã¨æ€ã„ã€ãƒ–ãƒ­ã‚°ã«è¼‰ã›ã¦ã„ã“ã†ã‹ ãªãã¨ã€‚\nã¾ãš Chef ã‚µãƒ¼ãƒã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã¯ä¸‹è¨˜ã®æƒ…å ±ãŒå¿…è¦ã§ã™ã€‚\nãƒ¦ãƒ¼ã‚¶å ãƒ¦ãƒ¼ã‚¶ç”¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆéµ Chef ã‚µãƒ¼ãƒã® URL ã“ã‚Œã‚‰ã¯ Chef::Config ã§è¨˜ã—ã¦ã„ãã¾ã™ã€‚\nã§ã¯æ—©é€Ÿã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚ã¾ãšã¯ data bags å†…ãƒ‡ãƒ¼ã‚¿ã®ä¸€è¦§ã‚’å–å¾—ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ ã™ã€‚data bags å†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã§å–å¾—ã—é…åˆ—ã§è¡¨ç¤ºã—ã¾ã™ã€‚\n#!/usr/bin/env ruby require \u0026#39;rubygems\u0026#39; require \u0026#39;chef/rest\u0026#39; require \u0026#39;chef/search/query\u0026#39; Chef::Config[:node_name]=\u0026#39;user01\u0026#39; Chef::Config[:client_key]=\u0026#39;/home/user01/user01.pem\u0026#39; Chef::Config[:chef_server_url]=\u0026#34;https://10.200.9.22\u0026#34; Chef::DataBag::list.each do |bag_name, url| Chef::DataBag::load(bag_name).each do |item_name, url| item = Chef::DataBagItem.load(bag_name, item_name).to_hash puts item end end æ¬¡ã¯ data bags ã«ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚json_data ã¨ã„ã† JSON å½¢å¼ã®ãƒ‡ãƒ¼ ã‚¿ã‚’ test_data ã¨ã„ã† data bag ã«æ”¾ã‚Šè¾¼ã‚“ã§ã„ã¾ã™ã€‚\n#!/usr/bin/env ruby require \u0026#39;rubygems\u0026#39; require \u0026#39;chef/rest\u0026#39; require \u0026#39;chef/search/query\u0026#39; Chef::Config[:node_name]=\u0026#39;user01\u0026#39; Chef::Config[:client_key]=\u0026#39;/home/user01/user01.pem\u0026#39; Chef::Config[:chef_server_url]=\u0026#34;https://10.0.0.10\u0026#34; json_data = { \u0026#34;id\u0026#34; =\u0026gt; \u0026#34;test\u0026#34;, \u0026#34;command\u0026#34; =\u0026gt; \u0026#34;echo test\u0026#34; } databag_item = Chef::DataBagItem.new databag_item.data_bag(\u0026#39;test_data\u0026#39;) databag_item.raw_data = proc_nginx databag_item.save æ¬¡ã¯ nodes ä¸€è¦§ã®å–å¾—ã§ã™ã€‚\n#!/usr/bin/env ruby require \u0026#39;rubygems\u0026#39; require \u0026#39;chef/rest\u0026#39; require \u0026#39;chef/search/query\u0026#39; Chef::Config[:node_name]=\u0026#39;user01\u0026#39; Chef::Config[:client_key]=\u0026#39;/home/user01/user01.pem\u0026#39; Chef::Config[:chef_server_url]=\u0026#34;https://10.0.0.10\u0026#34; Chef::Node.list.each do |node| puts node end æ¬¡ã¯ bootstrap ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã€‚\n#!/usr/bin/env ruby require \u0026#39;rubygems\u0026#39; require \u0026#34;chef\u0026#34; require \u0026#34;chef/knife/core/bootstrap_context\u0026#34; require \u0026#39;chef/knife\u0026#39; require \u0026#39;chef/knife/ssh\u0026#39; require \u0026#39;net/ssh\u0026#39; require \u0026#39;net/ssh/multi\u0026#39; require \u0026#39;chef/knife/bootstrap\u0026#39; Chef::Config[:node_name]=\u0026#39;user01\u0026#39; Chef::Config[:client_key]=\u0026#39;/home/user01/user01.pem\u0026#39; Chef::Config[:validation_key]=\u0026#39;/home/user01/chef-validator.pem\u0026#39; Chef::Config[:chef_server_url]=\u0026#34;https://10.0.0.10\u0026#34; kb = Chef::Knife::Bootstrap.new kb.name_args = [\u0026#34;sensu-client04.deathstar.jp\u0026#34;, \u0026#34;10.0.0.20\u0026#34;] kb.config[:ssh_user] = \u0026#34;root\u0026#34; kb.config[:identity_file] = \u0026#34;~/novakey01\u0026#34; kb.config[:ssh_port] = \u0026#34;22\u0026#34; kb.config[:run_list ] = \u0026#34;role[sensu-client]\u0026#34; kb.config[:template_file] = \u0026#34;/home/thirai/chef-full.erb\u0026#34; kb.run ä»¥ä¸Šã§ã™ã€‚ä»–ã®ã‚µãƒ³ãƒ—ãƒ«ã‚‚ã“ã‚Œã‹ã‚‰æ¢ã—ã¦ã„ã“ã†ã‹ã¨æ€ã£ã¦ã¾ã™ã€‚knife ã®ã‚½ãƒ¼ã‚¹è¦‹ã‚‹ ã®ãŒä¸€ç•ªã¯ã‚„ã„ã‹ãªãã¨ã€‚ã‚‚ã—ãã¯ Chef ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰è¦‹ã‚‹ã‹ã€‚çš†ã•ã‚“ã‚‚ã”å­˜çŸ¥ã§ã‚ ã‚Œã°å…±æœ‰ã—ã¦ãã ã•ãƒ¼ã„ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/06/12/chef-ruby-code/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003erequire \u0026lsquo;chef\u0026rsquo; ã—ã¦ Ruby ã‚³ãƒ¼ãƒ‰ã®ä¸­ã§ chef ã‚’åˆ©ç”¨ã—ãŸã„ã¨æ€ã£ã¦è‰²ã€…èª¿ã¹ã¦ã„ãŸ\nã®ã§ã™ãŒã€ãã‚‚ãã‚‚ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãŒç„¡ãã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚‚ã”ãã‚ãšã‹ã—ã‹ãƒãƒƒãƒˆä¸Šã«è¦‹\nã¤ã‘ã‚‰ã‚Œãªã„çŠ¶æ…‹ã§ã—ãŸã€‚çµå±€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ç†è§£ã—ã¦ã„ãä¸–ç•Œãªã‚ã‘ã§ã™ãŒã€\nã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ãŒå¹¾ã¤ã‹ã‚ã‚‹ã¨ä»–ã®äººã«å½¹ç«‹ã¤ã‹ãªãã¨æ€ã„ã€ãƒ–ãƒ­ã‚°ã«è¼‰ã›ã¦ã„ã“ã†ã‹\nãªãã¨ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãš Chef ã‚µãƒ¼ãƒã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã¯ä¸‹è¨˜ã®æƒ…å ±ãŒå¿…è¦ã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eãƒ¦ãƒ¼ã‚¶å\u003c/li\u003e\n\u003cli\u003eãƒ¦ãƒ¼ã‚¶ç”¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆéµ\u003c/li\u003e\n\u003cli\u003eChef ã‚µãƒ¼ãƒã® URL\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã“ã‚Œã‚‰ã¯ Chef::Config ã§è¨˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã§ã¯æ—©é€Ÿã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚ã¾ãšã¯ data bags å†…ãƒ‡ãƒ¼ã‚¿ã®ä¸€è¦§ã‚’å–å¾—ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§\nã™ã€‚data bags å†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã§å–å¾—ã—é…åˆ—ã§è¡¨ç¤ºã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-ruby\" data-lang=\"ruby\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/usr/bin/env ruby\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erequire \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;rubygems\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erequire \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;chef/rest\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erequire \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;chef/search/query\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eChef\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eConfig\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:node_name\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;user01\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eChef\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eConfig\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:client_key\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/home/user01/user01.pem\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eChef\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eConfig\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:chef_server_url\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://10.200.9.22\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eChef\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eDataBag\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003elist\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eeach \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003ebag_name, url\u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eChef\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eDataBag\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003eload(bag_name)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eeach \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003eitem_name, url\u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    item \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eChef\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eDataBagItem\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eload(bag_name, item_name)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eto_hash\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    puts item\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ¬¡ã¯ data bags ã«ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚json_data ã¨ã„ã† JSON å½¢å¼ã®ãƒ‡ãƒ¼\nã‚¿ã‚’ test_data ã¨ã„ã† data bag ã«æ”¾ã‚Šè¾¼ã‚“ã§ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-ruby\" data-lang=\"ruby\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/usr/bin/env ruby\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erequire \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;rubygems\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erequire \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;chef/rest\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erequire \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;chef/search/query\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eChef\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eConfig\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:node_name\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;user01\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eChef\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eConfig\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:client_key\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/home/user01/user01.pem\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eChef\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eConfig\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:chef_server_url\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://10.0.0.10\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejson_data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;test\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;command\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;echo test\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edatabag_item \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eChef\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eDataBagItem\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003enew\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edatabag_item\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edata_bag(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;test_data\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edatabag_item\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eraw_data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e proc_nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edatabag_item\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esave\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ¬¡ã¯ nodes ä¸€è¦§ã®å–å¾—ã§ã™ã€‚\u003c/p\u003e","title":"Chef ã‚’ Ruby ã‚³ãƒ¼ãƒ‰å†…ã§åˆ©ç”¨ã™ã‚‹"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nCeph ã‚’é‹ç”¨ã™ã‚‹ä¸Šã§è€ƒæ…®ã—ãªã‘ã‚Œã°ã„ã‘ãªã„ã®ãŒãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®è² è·ã§ã™ã€‚ç‰¹ã« OSD åŒå£«ã®ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã«ã¯ç›¸å½“ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®è² è·ãŒæ›ã‹ã‚‹ã“ã¨ãŒæƒ³ åƒå‡ºæ¥ã¾ã™ã€‚\nã“ã®ãŸã‚ MDS, MON ã®é€šä¿¡ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã‚ˆã†ã€OSD ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒãƒ¼ãƒˆãƒ“ãƒ¼ ãƒˆã®ãŸã‚ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’åˆ¥ã«è¨­ã‘ã‚‹ã®ãŒãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãªæ§‹æˆã®æ§˜ã§ã™ã€‚ã“ã®ãƒãƒƒ ãƒˆãƒ¯ãƒ¼ã‚¯ã®ã“ã¨ã‚’ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ Ceph çš„ã«è¨€ã†ãã†ã§ã™ã€‚\nã“ã‚“ãªæ¥ç¶šã«ãªã‚Šã¾ã™ã€‚\n+------+ |Client| +------+ | +-------+-------+-------+-------+------ public network | | | | | +-----+ +-----+ +-----+ +-----+ +-----+ | MON | | MDS | | OSD | | OSD | | OSD | +-----+ +-----+ +-----+ +-----+ +-----+ | | | ----------------+-------+-------+------ cluster network ä¸Šå›³ã®æ§˜ã« MON, MDS ã¯ public ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä»‹ã— OSD ã®ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒãƒ¼ ãƒˆãƒ“ãƒ¼ãƒˆã®ã¿ cluster ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä»‹ã—ã¾ã™ã€‚Client ã¨ MDS ã¨ã®é€šä¿¡ã«å½±éŸ¿ã‚’ä¸ ãˆãªã„æ§‹æˆã«ãªã‚Šã¾ã™ã€‚\nä»Šå›ã¯ãã®æ§˜ãªæ§‹æˆã‚’ ceph-deploy ã‚’ä½¿ã£ã¦æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚å‰æã¨ ãªã‚‹ãƒ›ã‚¹ãƒˆã¨ãƒ—ãƒ­ã‚»ã‚¹ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é–¢ä¿‚ã¯ä¸‹è¨˜ã®å›³ã®é€šã‚Šã§ã™ã€‚\n+----------+ | 'client' | +----------+ | +---------------+---------------+------------- public network | | | |10.0.0.11 | 10.0.0.12 | 10.0.0.13 +----------+ +----------+ +----------+ | 'ceph01' | | 'ceph02' | | 'ceph03' | | osd | | osd | | osd | | mon | | mon | | mon | | mds | | mds | | mds | +----------+ +----------+ +----------+ |172.18.0.11 | 172.18.0.12 | 172.18.0.13 | | | +---------------+---------------+------------- cluster network ç‰¹å¾´ã¨ã—ã¦ã¯..\nceph01-03 ã«ã¯ NIC ã‚’2æœ¬å‡ºã—ã¾ã™ã€‚ ceph01-03 ã®å…¨ã¦ã« MDS, MON, OSD ã‚’ç¨¼åƒã•ã›ã¾ã™ã€‚ ceph01-03:/dev/sdb ã‚’ Ceph ç”¨ã®ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã—ã¦åˆ©ç”¨ ã¨ãªã‚Šã¾ã™ã€‚\nCeph-Deply ã‚’åˆ©ç”¨ã™ã‚‹ã¾ã§ã®æº–å‚™ ä»Šå›ã¯ ceph-deploy ã‚’åˆ©ç”¨ã— Ceph ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚ãã®ãŸã‚ã®æº–å‚™ã¨ã—ã¦ä¸‹è¨˜ã®æ“ä½œã‚’ è¡Œã†ã€‚\nceph ã‚µãƒ¼ãƒ (ceph01-03) ã®æº–å‚™ \u0026lsquo;ceph\u0026rsquo; ãƒ¦ãƒ¼ã‚¶ã®ä½œæˆã‚’è¡Œã†ã€‚\n% ssh user@ceph-server % sudo useradd -d /home/ceph -m ceph % sudo passwd ceph sudoers ã®è¨­å®šã‚’è¡Œã†ã€‚\n% echo \u0026quot;ceph ALL = (root) NOPASSWD:ALL\u0026quot; | sudo tee /etc/sudoers.d/ceph % sudo chmod 0440 /etc/sudoers.d/ceph \u0026lsquo;client\u0026rsquo; ã®æº–å‚™ ãƒ›ã‚¹ãƒˆ \u0026lsquo;client\u0026rsquo; ã§æº–å‚™ã‚’ã—ã¾ã™ã€‚ã“ã®æº–å‚™ã«ã‚ˆã£ã¦ ceph-deploy ã‚’ãã‚Œãã‚Œã®ãƒ›ã‚¹ ãƒˆã«å¯¾ã—ã¦å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\nã¾ãšã€ãƒãƒ³ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã® SSH å…¬é–‹éµãƒ»ç§˜å¯†éµã‚’ç”Ÿæˆã—ã¾ã™ã€‚\nclient% ssh-keygen Generating public/private key pair. Enter file in which to save the key (/ceph-client/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /ceph-client/.ssh/id_rsa. Your public key has been saved in /ceph-client/.ssh/id_rsa.pub. å…¬é–‹éµã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ›ã‚¹ãƒˆ (ceph01-03) ã«é…ç½®ã—ã¾ã™ã€‚\nclient% ssh-copy-id ceph@ceph01 client% ssh-copy-id ceph@ceph02 client% ssh-copy-id ceph@ceph03 ceph-deploy ã‚’å–å¾—ã—ã¾ã™ã€‚\nclient% git clone https://github.com/ceph/ceph-deploy.git ~/ceph-deploy \u0026lsquo;python-virtualenv\u0026rsquo; ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚\nclient% sudo apt-get update ; sudo apt-get -y install python-virtualenv ceph-deploy ã‚’ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã™ã‚‹\nclient% cd ~/ceph-deploy client% ./bootstrap PATH ã‚’é€šã™ã€‚ä¸‹è¨˜ã¯ä¾‹ã€‚\nclient% ${EDITOR} ~/.zshrc export PATH=$HOME/ceph-deploy:$PATH ãƒ›ã‚¹ãƒˆåã®è§£æ±ºã‚’è¡Œã†ã€‚\ncephclient% sudo ${EDITOR} /etc/hosts 10.0.0.11 ceph01 10.0.0.12 ceph02 10.0.0.13 ceph03 ã“ã‚Œã§æº–å‚™ã¯ OK ã§ã™ã€‚ceph-deploy ãŒä½¿ãˆã‚‹çŠ¶æ…‹ã«ãªã‚Šã¾ã—ãŸã€‚\nCeph æ§‹ç¯‰æ‰‹é † ä»Šå›ã¯ ceph01-03 ã®3å°æ§‹æˆã‚’æ§‹ç¯‰ã—ã¾ã™ãŒã€ã™ã¹ã¦ã®æ“ä½œã¯ãƒ›ã‚¹ãƒˆ \u0026lsquo;client\u0026rsquo; ã‹ã‚‰è¡Œ ã„ã¾ã™ã€‚å…ˆã»ã©é…ç½®ã—ãŸå…¬é–‹éµã«ã‚ˆã£ã¦ãã‚Œãã‚Œã®ãƒ›ã‚¹ãƒˆã«å¯¾ã—ã¦æ“ä½œãŒè¡Œãˆã¾ã™ã€‚\nceph ã‚µãƒ¼ãƒãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–“é€šä¿¡ã®ãŸã‚ã®éµã®ç”Ÿæˆã¨ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç”Ÿæˆ ã‚’ä¸‹è¨˜ã®æ“ä½œã«ã¦è¡Œã†ã€‚\nclient% ceph-deploy new ceph01 ceph02 ceph03 ä¸Šè¨˜ã®æ“ä½œã§ç”Ÿæˆã•ã‚ŒãŸã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã® ceph.conf ã«å¯¾ã—ã¦ä¸‹è¨˜ã®è¨˜è¿°ã‚’ è¿½è¨˜ã™ã‚‹ã€‚\npublic network = 10.0.0.0/24 cluster network = 172.18.0.0/24 [mon.a] host = ceph01 mon addr = 10.0.0.11:6789 [mon.b] host = ceph02 mon addr = 10.0.0.12:6789 [mon.c] host = ceph03 mon addr = 10.0.0.13:6789 [osd.0] public addr = 10.0.0.11 cluster addr = 172.18.0.11 [osd.1 public addr = 10.0.0.12 cluster addr = 172.18.0.12 [osd.2] public addr = 10.0.0.13 cluster addr = 172.18.0.13 [mds.a] host = ceph01 [mds.a] host = ceph02 [mds.a] host = ceph03 æ¬¡ã®æ“ä½œã§ãã‚Œãã‚Œã®ãƒ›ã‚¹ãƒˆã«å¯¾ã—ã¦ ceph ã®å…¬é–‹ã—ã¦ã„ã‚‹ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’å‚ç…§ã•ã› ceph ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚\ncephclient% ceph-deploy install ceph01 ceph02 ceph03 MON daemon ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ã€‚\ncephclient% ceph-deploy mon create ceph01 ceph02 ceph03 éµã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ã€‚Ceph ã‚µãƒ¼ãƒé–“ãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–“ã§ã®å…±æœ‰éµã§ã™ã€‚1 Cluster ã«å¯¾ã—ã¦1ã¤ã®éµã‚’ä¿æœ‰ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚\ncephclient% ceph-deploy gatherkeys ceph01 ceph02 ceph03 OSD daemon ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ã€‚ä¸‹è¨˜ã®æ§˜ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ãªã‘ã‚Œã°ãƒ„ãƒ¼ãƒ«ãŒ è‡ªå‹•ã§ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ã‚’è¡Œãªã£ã¦ãã‚Œã¾ã™ã€‚\ncephclient% ceph-deploy osd create create ceph01:/dev/sdb ceph02:/dev/sdb ceph03:/dev/sdb MDS deamon ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ã€‚\ncephcleint% ceph-deploy mds create ceph01 ceph02 ceph03 å®Œæˆã§ã™ã€‚\nå…¨ã¦ã®ãƒ›ã‚¹ãƒˆ ceph01-03 ã«ã¦ MON, MDS, OSD ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒç¨¼åƒã—ã¦ã„ã‚‹ã®ãŒç¢ºèªå‡ºæ¥ ã‚‹ã¨æ€ã„ã¾ã™ã€‚å®Ÿéš›ã«ã©ã‚Œã‹ã®ãƒ›ã‚¹ãƒˆã® MDS ã«å¯¾ã—ã¦ client ã‹ã‚‰ ceph ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¦ã¿ã¦ãã ã•ã„ã€‚\nã¾ã¨ã‚ é€šå¸¸ã®ãƒ•ãƒ©ãƒƒãƒˆãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã¨ã»ã¼åŒã˜æ“ä½œã§æ§‹ç¯‰å‡ºæ¥ã¾ã™ã€‚ ç•°ãªã‚‹ã¨ã“ã‚ã¯ ceph.conf ã«å¯¾ã—ã¦è¨­å®šã‚’è¿½åŠ ã—ãŸç‚¹ã§ã™ã€‚ã¾ãŸã€ãã‚Œãã‚Œã®ãƒ›ã‚¹ãƒˆ ã¸ã® ceph ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®æ™‚ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæ¸¡ã›ã¾ã™ã€‚\u0026ndash;testing ã¨æ¸¡ã›ã° RC ç‰ˆã® ceph ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚ä»Šå›ã®æ§˜ã«ä½•ã‚‚è¨˜ã•ãªã‘ã‚Œã° stable ç‰ˆã®åˆ©ç”¨ã¨ã„ã†ã“ã¨ã«ãª ã‚Šã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/05/25/ceph-cluster-network/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eCeph ã‚’é‹ç”¨ã™ã‚‹ä¸Šã§è€ƒæ…®ã—ãªã‘ã‚Œã°ã„ã‘ãªã„ã®ãŒãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®è² è·ã§ã™ã€‚ç‰¹ã« OSD\nåŒå£«ã®ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã«ã¯ç›¸å½“ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®è² è·ãŒæ›ã‹ã‚‹ã“ã¨ãŒæƒ³\nåƒå‡ºæ¥ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã“ã®ãŸã‚ MDS, MON ã®é€šä¿¡ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã‚ˆã†ã€OSD ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒãƒ¼ãƒˆãƒ“ãƒ¼\nãƒˆã®ãŸã‚ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’åˆ¥ã«è¨­ã‘ã‚‹ã®ãŒãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãªæ§‹æˆã®æ§˜ã§ã™ã€‚ã“ã®ãƒãƒƒ\nãƒˆãƒ¯ãƒ¼ã‚¯ã®ã“ã¨ã‚’ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ Ceph çš„ã«è¨€ã†ãã†ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã“ã‚“ãªæ¥ç¶šã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e                +------+\n                |Client|\n                +------+\n                |\n+-------+-------+-------+-------+------ public network\n|       |       |       |       |\n+-----+ +-----+ +-----+ +-----+ +-----+\n| MON | | MDS | | OSD | | OSD | | OSD |\n+-----+ +-----+ +-----+ +-----+ +-----+\n                |       |       |\n----------------+-------+-------+------ cluster network\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä¸Šå›³ã®æ§˜ã« MON, MDS ã¯ public ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä»‹ã— OSD ã®ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒãƒ¼\nãƒˆãƒ“ãƒ¼ãƒˆã®ã¿ cluster ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä»‹ã—ã¾ã™ã€‚Client ã¨ MDS ã¨ã®é€šä¿¡ã«å½±éŸ¿ã‚’ä¸\nãˆãªã„æ§‹æˆã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e","title":"Ceph ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆ"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚æœ€è¿‘ OpenStack ã®å°å…¥ã«å‘ã‘ã¦ä¿å®ˆæ€§ã‚„å¯ç”¨æ€§ã«ã¤ã„ã¦èª¿æŸ»ã—ã¦ã„ã‚‹ @jedipunkz ã§ã™ã€‚\nOpenStack ã¯ MySQL ã®ãƒ€ãƒ³ãƒ—ã‚„ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ»ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ã¨ã£ ã¦ãŠã‘ã°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®å¾©æ—§ã‚‚å‡ºæ¥ã¾ã™ã—ã€Grizzly ç‰ˆã® Quantum ã§ã¯å†—é•·ã‚„åˆ†æ•£ãŒ å–ã‚Œã‚‹ã®ã§éšœå®³æ™‚ã«è€ãˆã‚‰ã‚Œã¾ã™ã€‚ã¾ãŸ Quantum ã®å¾©æ—§ã¯æ‰‹å‹•ã‚‚ã§å¯èƒ½ã§ã™ã€‚æœ€å¾Œã® æ‚©ã¿ã ã£ãŸ Cinder ã®æ¥ç¶šå…ˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã™ãŒã€OpenStack ã®ã‚¹ã‚¿ãƒ³ã‚¹ã¨ã—ã¦ã¯é«˜ä¾¡ãª ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å–ã‚‹ã‹ã€Ceph, SheepDog ã®ã‚ˆã†ãªã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ ã‚¹ã‚’ä½¿ã†ã‹ã€ã§ã—ãŸã€‚ã§ã€ä»Šå›ã¯ Ceph ã‚’ OpenStack ã«é€£æºã•ã›ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸã€‚\nã“ã®ä½œæ¥­ã«ã‚ˆã‚Š Cinder ã®æ¥ç¶šå…ˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŒ Ceph ã«ãªã‚‹ã®ã¨ Glance ã® OS ã‚¤ãƒ¡ãƒ¼ ã‚¸ãƒ»ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ä¿ç®¡å…ˆãŒ Ceph ã«ãªã‚Šã¾ã™ã€‚\nä¸‹è¨˜ã®å‚è€ƒè³‡æ–™ãŒå®Œæˆåº¦é«˜ãã€ã»ã¼å†…å®¹ã¯ãã®ã¾ã¾ã§ã™ã€‚è‹¥å¹²ä»˜ã‘è¶³ã—ã¦ã„ã¾ã™ãŒã€‚\nå‚è€ƒè³‡æ–™ http://ceph.com/docs/master/rbd/rbd-openstack/\nå‰æã®æ§‹æˆ +-------------+-------------+--------------------------------------------- Public/API Network | | | +-----------+ +-----------+ +-----------+ +-----------+ +-----------+ +-----------+ | | | | |vm|vm|.. | | | | | | | | controller| | network | +-----------+ | ceph01 | | ceph01 | | ceph01 | | | | | | compute | | | | | | | | | | | | | | | | | | | +-----------+ +-----------+ +-----------+ +-----------+ +-----------+ +-----------+ | | | | | | | | +-------------+-----)-------+-----)-------+-------------+-------------+-- Management/API Network | | +-------------+-----------------------------------+-- Data Network Ceph ã¯ OpenStack ã® Management Network ä¸Šã«é…ç½® Ceph ã¯3å°æ§‹æˆ (ä½•å°ã§ã‚‚å¯) OpenStack ã‚‚3å°æ§‹æˆ (ä½•å°ã§ã‚‚å¯) é€£æºå‡¦ç†ã™ã‚‹ã®ã¯ controller, compute ãƒãƒ¼ãƒ‰ ã§ã¯æ—©é€Ÿæ‰‹é †ã§ã™ãŒã€OpenStack ã¨ Ceph ã®æ§‹ç¯‰æ‰‹é †ã¯å‰²æ„›ã—ã¾ã™ã€‚ç§ã®ä»–ã®è¨˜äº‹ã‚’å‚ è€ƒã«ã—ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚\næ§‹ç¯‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ceph-deploy ã§ Ceph æ§‹ç¯‰ Ceph + OpenStack é€£æºæ‰‹é † OpenStack ç”¨ã« Ceph Pool ã‚’ä½œæˆã™ã‚‹ ceph01% sudo ceph pool create volumes 128 ceph01% sudo ceph pool create images 128 sudoers ã®è¨­å®š controller, compute ãƒãƒ¼ãƒ‰ã«ã¦ sudoers ã®è¨­å®š\njedipunkz ALL = (root) NOPASSWD:ALL ceph ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« controller, compute ãƒãƒ¼ãƒ‰ã« ceph ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚\ncontroller% wget -q -O- 'https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc' | sudo apt-key add - controller% echo deb http://ceph.com/debian/ $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/ceph.list controller% sudo apt-get update \u0026amp;\u0026amp; sudo apt-get install -y python-ceph ceph-common /etc/ceph ä½œæˆ controller% sudo mkdir /etc/ceph compute % sudo mkdir /etc/ceph ceph ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ”ãƒ¼ controller, compute ãƒãƒ¼ãƒ‰ã« ceph ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚å°šã€æ¥ç¶š å…ˆã® OpenStack ãƒãƒ¼ãƒ‰ã§ã® sudoers è¨­å®šã¯äºˆã‚æ¸ˆã¾ã›ã‚‹ã“ã¨ã€‚\nceph01% sudo -i ceph01# ssh \u0026lt;controller\u0026gt; sudo tee /etc/ceph/ceph.conf \u0026lt;/etc/ceph/ceph.conf ceph01# ssh \u0026lt;compute\u0026gt; sudo tee /etc/ceph/ceph.conf \u0026lt;/etc/ceph/ceph.conf èªè¨¼è¨­å®š nova, cinder, glance ç”¨ã«ãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆã™ã‚‹ã€‚\nceph01% sudo ceph auth get-or-create client.volumes mon 'allow r' osd 'allow class-read object_prefix rbd_children, allow rwx pool=volumes, allow rx pool=images' ceph01% sudo ceph auth get-or-create client.images mon 'allow r' osd 'allow class-read object_prefix rbd_children, allow rwx pool=images' ã‚­ãƒ¼ãƒªãƒ³ã‚°ã®ä½œæˆ Ceph ã‚­ãƒ¼ãƒªãƒ³ã‚°ã®ä½œæˆã‚’è¡Œã†ã€‚Glance, Cinder ãŒèµ·å‹•ã—ã¦ã„ã‚‹ãƒ›ã‚¹ãƒˆ controller ãƒãƒ¼ãƒ‰ã« ã‚­ãƒ¼ãƒªãƒ³ã‚°ã‚’é…ç½®ã™ã‚‹ã€‚\nceph01% sudo ceph auth get-or-create client.images | ssh {your-glance-api-server} sudo tee /etc/ceph/ceph.client.images.keyring ceph01% ssh {your-glance-api-server} sudo chown glance:glance /etc/ceph/ceph.client.images.keyring ceph01% sudo ceph auth get-or-create client.volumes | ssh {your-volume-server} sudo tee /etc/ceph/ceph.client.volumes.keyring ceph01% ssh {your-volume-server} sudo chown cinder:cinder /etc/ceph/ceph.client.volumes.keyring compute ãƒãƒ¼ãƒ‰ã«ã¦ libvirt ã« secret key ã‚’æ ¼ç´ã™ã‚‹ã€‚ã“ã“ã§ç™»å ´ã™ã‚‹ uuid ã¯å¾Œ ã«åˆ©ç”¨ã™ã‚‹ãŸã‚ãƒ¡ãƒ¢ã‚’ã¨ã£ã¦ãŠãã“ã¨ã€‚\nceph01 % sudo ceph auth get-key client.volumes | ssh 10.200.10.59 tee client.volumes.key compute% cat \u0026gt; secret.xml \u0026lt;\u0026lt;EOF \u0026lt;secret ephemeral='no' private='no'\u0026gt; \u0026lt;usage type='ceph'\u0026gt; \u0026lt;name\u0026gt;client.volumes secret\u0026lt;/name\u0026gt; \u0026lt;/usage\u0026gt; \u0026lt;/secret\u0026gt; EOF comupte% sudo virsh secret-define --file secret.xml \u0026lt;uuid of secret is output here\u0026gt; compute% sudo virsh secret-set-value --secret {uuid of secret} --base64 $(cat client.volumes.key) \u0026amp;\u0026amp; rm client.volumes.key secret.xml OpenStack é€£æºã®ãŸã‚ã®è¨­å®š controller:/etc/glance/glance-api.conf ã«ä¸‹è¨˜ã‚’è¿½è¨˜ã€‚\ndefault_store=rbd rbd_store_user=images rbd_store_pool=images show_image_direct_url=True controller:/etc/cinder/cinder.conf ã«ä¸‹è¨˜ã‚’è¿½è¨˜ã€‚å…ˆã»ã©ç™»å ´ã—ãŸ uuid ã‚’å…¥åŠ›ã™ ã‚‹ã€‚\nvolume_driver=cinder.volume.driver.RBDDriver rbd_pool=volumes rbd_user=volumes rbd_secret_uuid={uuid of secret} controller:/etc/init/cinder-volume.conf ã®å†’é ­ã«ä¸‹è¨˜ã®è¨˜è¿°ã‚’è¿½è¨˜ã™ã‚‹ã€‚\nenv CEPH_ARGS=\u0026quot;--id volumes\u0026quot; OpenStack ã®å„ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•ã‚‚ã—ãã¯ãƒ›ã‚¹ãƒˆã®å†èµ·å‹•ã‚’è¡Œã†ã€‚\nsudo service glance-api restart sudo service nova-compute restart sudo service cinder-volume restart ç¢ºèª å®Ÿéš›ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¦ Volume ã‚’ã‚¢ã‚¿ãƒƒãƒã—ãƒ‡ã‚£ã‚¹ã‚¯ã‚’æ¶ˆè²»ã—ã¦ã„ãã¨ Ceph ã®ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ãŒå¢—ãˆã¦ã„ãã¾ã™ã€‚\n% cinder create --display-name test 5 % nova volumeattach \u0026lt;instance_id\u0026gt; \u0026lt;volume_id\u0026gt; auto ã¾ã¨ã‚ Cinder ã¯åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã™ã®ã§å„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ¬ãƒ—ãƒªã‚«ãŒå…¨ã¦å¤±ã‚ã‚Œãªã„é™ã‚Šãƒ‡ãƒ¼ã‚¿ ã¯ãƒ­ã‚¹ãƒˆã—ã¾ã›ã‚“ã€‚ãŸã ã— Ceph è‡ªä½“ã®å®Œæˆåº¦ã¯ä»¥å‰ã«æ¯”ã¹é«˜ãã¯ãªã£ãŸã‚‚ã®ã®ã€é‹ç”¨ ã«è€ãˆã‚‰ã‚Œã‚‹ã‹ã©ã†ã‹ã¾ã ç§ã«ã‚‚åˆ†ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆæ—¥ã® OpenStack Day ã«æ¥æ—¥ã—ã¦ã„ ãŸãƒ•ã‚¡ã‚¦ãƒ³ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®æ–¹ãŒã€Œãƒ™ãƒ³ãƒ€ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ã™ã‚‹ãªã€ã¨è¨€ã£ã¦ã„ã¾ã—ãŸã€‚åƒ•ã‚‚ã‚ªãƒ¼ ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ãªã‚“ã¨ã‹ã—ãŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚OpenStack ã‚’å°å…¥ã™ã‚‹ãŸã‚ã«ã¯ä»Šã€Ceph ã¯æ¬ ã‹ã™ã“ã¨ãŒå‡ºæ¥ãªã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãªæ°—ãŒã—ã¦ã„ã¾ã™ã€‚çš†ã§ Ceph ã‚‚ç››ã‚Šä¸Šã’ã¦è¡Œ ããŸã„ã§ã™ã€‚\nã¾ãŸã€ã“ã®æ§‹æˆã®éš›ã®OpenStack å…¨ä½“ã®ä¿å…¨ã«ã¤ã„ã¦è€ƒãˆã‚‹ã¨\u0026hellip;\nMySQL ã®ãƒ‡ãƒ¼ã‚¿ã•ãˆãƒ€ãƒ³ãƒ—ã®å–å¾—ã™ã‚Œã° OK OS ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ»ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯ Ceph ä¸Šã«ã‚ã‚‹ã®ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸è¦ Ceph ã¯ãªã‚“ã¨ã—ã¦ã‚‚å®ˆã‚‹ã€‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å–ã‚‹ã®ã¯é›£ã—ã„ Network ãƒãƒ¼ãƒ‰ã¯åˆ†æ•£ãƒ»å†—é•·å¯èƒ½, ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯ä¸è¦ Compute ãƒãƒ¼ãƒ‰ä¸Šã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã¯ Ceph ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰å¾©æ—§ ã¨ã„ã£ãŸã“ã¨ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ã¤ã¾ã‚Š MySQL ã®ãƒ‡ãƒ¼ã‚¿ã•ãˆãƒ€ãƒ³ãƒ—ã—ã¦ãŠã‘ã° OpenStack å…¨ä½“ãŒå¾©æ—§ã§ãã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚å®Ÿéš›ã«ã‚„ã£ã¦ã¿ã¾ã—ãŸãŒå¯èƒ½ã§ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/05/19/openstack-ceph/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚æœ€è¿‘ OpenStack ã®å°å…¥ã«å‘ã‘ã¦ä¿å®ˆæ€§ã‚„å¯ç”¨æ€§ã«ã¤ã„ã¦èª¿æŸ»ã—ã¦ã„ã‚‹\n\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eOpenStack ã¯ MySQL ã®ãƒ€ãƒ³ãƒ—ã‚„ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ»ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ã¨ã£\nã¦ãŠã‘ã°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®å¾©æ—§ã‚‚å‡ºæ¥ã¾ã™ã—ã€Grizzly ç‰ˆã® Quantum ã§ã¯å†—é•·ã‚„åˆ†æ•£ãŒ\nå–ã‚Œã‚‹ã®ã§éšœå®³æ™‚ã«è€ãˆã‚‰ã‚Œã¾ã™ã€‚ã¾ãŸ Quantum ã®å¾©æ—§ã¯æ‰‹å‹•ã‚‚ã§å¯èƒ½ã§ã™ã€‚æœ€å¾Œã®\næ‚©ã¿ã ã£ãŸ Cinder ã®æ¥ç¶šå…ˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã™ãŒã€OpenStack ã®ã‚¹ã‚¿ãƒ³ã‚¹ã¨ã—ã¦ã¯é«˜ä¾¡ãª\nã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å–ã‚‹ã‹ã€Ceph, SheepDog ã®ã‚ˆã†ãªã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼\nã‚¹ã‚’ä½¿ã†ã‹ã€ã§ã—ãŸã€‚ã§ã€ä»Šå›ã¯ Ceph ã‚’ OpenStack ã«é€£æºã•ã›ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eã“ã®ä½œæ¥­ã«ã‚ˆã‚Š Cinder ã®æ¥ç¶šå…ˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŒ Ceph ã«ãªã‚‹ã®ã¨ Glance ã® OS ã‚¤ãƒ¡ãƒ¼\nã‚¸ãƒ»ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ä¿ç®¡å…ˆãŒ Ceph ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹è¨˜ã®å‚è€ƒè³‡æ–™ãŒå®Œæˆåº¦é«˜ãã€ã»ã¼å†…å®¹ã¯ãã®ã¾ã¾ã§ã™ã€‚è‹¥å¹²ä»˜ã‘è¶³ã—ã¦ã„ã¾ã™ãŒã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒè³‡æ–™\"\u003eå‚è€ƒè³‡æ–™\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"http://ceph.com/docs/master/rbd/rbd-openstack/\"\u003ehttp://ceph.com/docs/master/rbd/rbd-openstack/\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"å‰æã®æ§‹æˆ\"\u003eå‰æã®æ§‹æˆ\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003e+-------------+-------------+--------------------------------------------- Public/API Network\n|             |             |             \n+-----------+ +-----------+ +-----------+ +-----------+ +-----------+ +-----------+\n|           | |           | |vm|vm|..   | |           | |           | |           |\n| controller| |  network  | +-----------+ |  ceph01   | |  ceph01   | |  ceph01   |\n|           | |           | |  compute  | |           | |           | |           |\n|           | |           | |           | |           | |           | |           |\n+-----------+ +-----------+ +-----------+ +-----------+ +-----------+ +-----------+\n|             |     |       |     |       |             |             |\n+-------------+-----)-------+-----)-------+-------------+-------------+-- Management/API Network\n                    |             |                       \n                    +-------------+-----------------------------------+-- Data Network\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eCeph ã¯ OpenStack ã® Management Network ä¸Šã«é…ç½®\u003c/li\u003e\n\u003cli\u003eCeph ã¯3å°æ§‹æˆ (ä½•å°ã§ã‚‚å¯)\u003c/li\u003e\n\u003cli\u003eOpenStack ã‚‚3å°æ§‹æˆ (ä½•å°ã§ã‚‚å¯)\u003c/li\u003e\n\u003cli\u003eé€£æºå‡¦ç†ã™ã‚‹ã®ã¯ controller, compute ãƒãƒ¼ãƒ‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã§ã¯æ—©é€Ÿæ‰‹é †ã§ã™ãŒã€OpenStack ã¨ Ceph ã®æ§‹ç¯‰æ‰‹é †ã¯å‰²æ„›ã—ã¾ã™ã€‚ç§ã®ä»–ã®è¨˜äº‹ã‚’å‚\nè€ƒã«ã—ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e","title":"OpenStack + Ceph é€£æº"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚ ä»Šå›ã¯ Opscode Chef ã§ãƒ¦ãƒ¼ã‚¶ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’ã¾ã¨ã‚ã¾ã™ã€‚\n\u0026lsquo;users\u0026rsquo; Cookbook ã‚’ä½¿ã„ã¾ã™ã€‚\n% cd ${YOUR_CHEF_REPO} % ${EDITOR} Berksfile cookbook 'users' % berks install --path ./cookbooks data_bag ã‚’ä½¿ã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—ã®ç®¡ç†ã‚’ã—ãŸã„ã®ã§ç®¡ç†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ ã™ã€‚\n% mkdir -p data_bags/users data_bags/users/jedipunkz.json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚å¿…è¦ã«å¿œã˜ã¦å†…å®¹ã‚’æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚\n{ \u0026quot;id\u0026quot;: \u0026quot;jedipunkz\u0026quot;, \u0026quot;ssh_keys\u0026quot;: \u0026quot;ssh-rsa AAAABx92tstses jedipunkz@somewhere\u0026quot;, \u0026quot;groups\u0026quot;: [ \u0026quot;sysadmin\u0026quot;, \u0026quot;sudo\u0026quot; ], \u0026quot;uid\u0026quot;: 2001, \u0026quot;shell\u0026quot;: \u0026quot;\\/usr\\/bin\\/zsh\u0026quot;, \u0026quot;comment\u0026quot;: \u0026quot;jedipunkz sysadmin\u0026quot;, \u0026quot;password\u0026quot;: \u0026quot;$1$s%H8BMHlB$7s3h30y9IB1SklftZXYhvssJ\u0026quot; } json ãƒ•ã‚¡ã‚¤ãƒ«ã®èª¬æ˜ã§ã™ã€‚\nid : ãƒ¦ãƒ¼ã‚¶å ssh_keys : SSH å…¬é–‹éµ groups : æ‰€å±ã•ã›ã‚‹ã‚°ãƒ«ãƒ¼ãƒ— uid : unix id sheell : ãƒ­ã‚°ã‚¤ãƒ³ã‚·ã‚§ãƒ« comment : ã‚³ãƒ¡ãƒ³ãƒˆ passwd : ãƒãƒƒã‚·ãƒ¥åŒ–ã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ ç‰¹ã«ãƒãƒƒã‚·ãƒ¥åŒ–ã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ç”Ÿæˆå‡ºæ¥ã¾ã™ã€‚\n% openssl passwd -1 'yourPassword' data_bag ã‚’ä½œæˆã— json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚\n% knife data bag create users % knife data bag from file users data_bags/users/jedipunkz.json ç¾åœ¨ (2013/05/18 ç¾åœ¨) ã€\u0026lsquo;users\u0026rsquo; Cookbook ã«ä¸å…·åˆãŒã‚ã‚‹ã‚‰ã—ã groups ã«è¨˜ã—ãŸ ã‚°ãƒ«ãƒ¼ãƒ—ã«ãƒ¦ãƒ¼ã‚¶ãŒæ‰€å±ã—ã¦ãã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ãªã®ã§ä¸‹è¨˜ã®å¯¾å‡¦ã‚’ã—ã¾ã™ã€‚ sysadmins.rb ã‚’ä»Šå›ã¯åˆ©ç”¨ã—ã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¸‹è¨˜ã®è¡Œã‚’è¿½è¨˜ã—ã¾ã™ã€‚åƒ•ã¯ sudo ã‚°ãƒ«ãƒ¼ãƒ—ã«æ‰€å±ã•ã›ãŸã‹ã£ãŸã®ã§ (å…ˆã»ã© groups: ã«è¨˜ã—ãŸ) ã“ã†ã—ã¾ã—ãŸãŒã€ä»–ã® ã‚°ãƒ«ãƒ¼ãƒ—ãŒè‰¯ã‘ã‚Œã°å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚ã¾ãŸã€Ubuntu Server ã‚’æ‰±ã†ã“ã¨ãŒãƒ¡ã‚¤ãƒ³ã®åƒ• ãªã®ã§ group_id ã¯ 27 ã«ã—ã¦ã„ã¾ã™ã€‚é©å®œå¤‰æ›´ã—ã¦ãã ã•ã„ã€‚\n% ${EDITOR} cookbooks/users/recipes/sysadmins.rb # ä¸‹è¨˜ã®è¡Œã‚’è¿½è¨˜ users_manage \u0026quot;sudo\u0026quot; do group_id 27 end cookbook ã‚’ Chef ã‚µãƒ¼ãƒã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\n% knife cookbook upload users é©ç”¨ã—ãŸã„ãƒãƒ¼ãƒ‰ã® run_list ã« Recipe \u0026lsquo;users::sysadmins\u0026rsquo; ã‚’è¿½åŠ ã—ã¾ã™ã€‚\n% knife node run_list add ${YOUR_NODE_NAME} users::sysadmins chef-client ã®æ¬¡å›å®Ÿè¡Œæ™‚ã«ãƒ¦ãƒ¼ã‚¶ \u0026lsquo;jedipunkz\u0026rsquo; ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚SSH ã§ ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ç¢ºèªã—ã¦ã¿ã¦ãã ã•ã„ã€‚å¾…ã¡ãã‚Œãªã‹ã£ãŸã‚‰ knife ssh ã—ã¦ chef-client ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚\nã“ã® \u0026lsquo;users\u0026rsquo; cookbook ã¯ä»–ã® Cookbook ã‹ã‚‰ã‚‚å‘¼ã³å‡ºã—ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã®ã§ å¿œç”¨ãŒåˆ©ãã¾ã™ã­ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/05/18/chef-cookbook-adding-users/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\nä»Šå›ã¯ Opscode Chef ã§ãƒ¦ãƒ¼ã‚¶ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’ã¾ã¨ã‚ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u0026lsquo;users\u0026rsquo; Cookbook ã‚’ä½¿ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% cd ${YOUR_CHEF_REPO}\n% ${EDITOR} Berksfile\ncookbook 'users'\n% berks install --path ./cookbooks\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003edata_bag ã‚’ä½¿ã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—ã®ç®¡ç†ã‚’ã—ãŸã„ã®ã§ç®¡ç†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾\nã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% mkdir -p data_bags/users\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003edata_bags/users/jedipunkz.json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚å¿…è¦ã«å¿œã˜ã¦å†…å®¹ã‚’æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e{\n  \u0026quot;id\u0026quot;: \u0026quot;jedipunkz\u0026quot;,\n  \u0026quot;ssh_keys\u0026quot;: \u0026quot;ssh-rsa AAAABx92tstses jedipunkz@somewhere\u0026quot;,\n  \u0026quot;groups\u0026quot;: [ \u0026quot;sysadmin\u0026quot;, \u0026quot;sudo\u0026quot; ],\n  \u0026quot;uid\u0026quot;: 2001,\n  \u0026quot;shell\u0026quot;: \u0026quot;\\/usr\\/bin\\/zsh\u0026quot;,\n  \u0026quot;comment\u0026quot;: \u0026quot;jedipunkz sysadmin\u0026quot;,\n  \u0026quot;password\u0026quot;: \u0026quot;$1$s%H8BMHlB$7s3h30y9IB1SklftZXYhvssJ\u0026quot;\n\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ejson ãƒ•ã‚¡ã‚¤ãƒ«ã®èª¬æ˜ã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eid : ãƒ¦ãƒ¼ã‚¶å\u003c/li\u003e\n\u003cli\u003essh_keys : SSH å…¬é–‹éµ\u003c/li\u003e\n\u003cli\u003egroups : æ‰€å±ã•ã›ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—\u003c/li\u003e\n\u003cli\u003euid : unix id\u003c/li\u003e\n\u003cli\u003esheell : ãƒ­ã‚°ã‚¤ãƒ³ã‚·ã‚§ãƒ«\u003c/li\u003e\n\u003cli\u003ecomment : ã‚³ãƒ¡ãƒ³ãƒˆ\u003c/li\u003e\n\u003cli\u003epasswd : ãƒãƒƒã‚·ãƒ¥åŒ–ã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç‰¹ã«ãƒãƒƒã‚·ãƒ¥åŒ–ã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ç”Ÿæˆå‡ºæ¥ã¾ã™ã€‚\u003c/p\u003e","title":"Chef Cookbook ã§ãƒ¦ãƒ¼ã‚¶ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—è¿½åŠ "},{"content":"ä»Šå›ã¯ ceph-deploy ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ Ceph ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ç°¡å˜ã«æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒ å‡ºæ¥ã‚‹ã®ã§ç´¹ä»‹ã—ã¾ã™ã€‚Ceph ã¯åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦ã‚‚ãƒ– ãƒ­ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦ã‚‚å‹•ä½œã—ã¾ã™ã€‚ä»Šå›ã®æ§‹ç¯‰ã§ã¯ãƒ–ãƒ­ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦ã®ã¿ ã®å‹•ä½œã§ã™ã€‚\nCeph ãŒå…¬é–‹ã—ã¦ã„ã‚‹ã®ãŒ ceph-deploy ãªã‚ã‘ã§ã™ãŒã€ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æ“ä½œã«ä»£ã‚ã‚‹æ§‹ç¯‰æ–¹ æ³•ã¨ã—ã¦å…¬é–‹ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ãã®ä»–ã«ã‚‚ Chef Cookbook ã‚‚å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ ã™ã€‚\nãã‚Œã§ã¯æ—©é€Ÿã€‚\nä»Šå›ã®æ§‹æˆ +--------+ +--------+ +--------+ | ceph01 | | ceph02 | | ceph03 | | osd | | osd | | osd | | mon | | mon | | mon | | mds | | mds | | mds | +--------+ +--------+ +--------+ | 10.0.0.1 | 10.0.0.2 | 10.0.0.3 | | | +----------+----------+ | | 10.0.0.10 +-------------+ | workstation | +-------------+ ç‰¹å¾´ã¯\nã™ã¹ã¦ã®ãƒ›ã‚¹ãƒˆã§ osd, mon, mds ã‚’å‹•ä½œ ceph ãƒ‡ãƒ¼ã‚¿æ ¼ç´ç”¨ãƒ‡ã‚£ã‚¹ã‚¯ãƒ‡ãƒã‚¤ã‚¹ã‚’ /dev/sdb ã¨ã—ã¦åˆ©ç”¨ workstation ã¯ ceph-deploy ã‚’å®Ÿè¡Œã™ã‚‹ãƒ›ã‚¹ãƒˆ ã§ã™ã€‚osd ã¯ object store daemon ã§å®Ÿéš›ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ ¼ç´ã—ã¦ã„ããƒ‡ãƒ¼ãƒ¢ãƒ³ã€‚mon ã¯ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ç”¨ãƒ‡ãƒ¼ãƒ¢ãƒ³, mds ã¯ metadata server ã§ POSIX äº’æ›ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ† ãƒ ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æä¾›ã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ¼ãƒ¢ãƒ³ã§ã™ã€‚\nceph-deploy ã‚’ä½¿ã†ã¾ã§ã®æº–å‚™ ceph-deploy ã‚’ä½¿ã†ã¾ã§ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ãƒ›ã‚¹ãƒˆ ceph01-03 ã¨ workstation ã¨å…±ã«æº–å‚™ ãŒå¿…è¦ã§ã™ã€‚\nceph01-03 ã®æº–å‚™ \u0026lsquo;ceph\u0026rsquo; ãƒ¦ãƒ¼ã‚¶ã®ä½œæˆã‚’è¡Œã†ã€‚\n% ssh user@ceph-server % sudo useradd -d /home/ceph -m ceph % sudo passwd ceph sudoers ã®è¨­å®šã‚’è¡Œã†ã€‚\n% echo \u0026quot;ceph ALL = (root) NOPASSWD:ALL\u0026quot; | sudo tee /etc/sudoers.d/ceph % sudo chmod 0440 /etc/sudoers.d/ceph workstation ã®æº–å‚™ ãƒãƒ³ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã® SSH å…¬é–‹éµãƒ»ç§˜å¯†éµã‚’ç”Ÿæˆã™ã‚‹ã€‚\nworkstation% ssh-keygen Generating public/private key pair. Enter file in which to save the key (/ceph-client/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /ceph-client/.ssh/id_rsa. Your public key has been saved in /ceph-client/.ssh/id_rsa.pub. å…¬é–‹éµã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ›ã‚¹ãƒˆ (ceph01-03) ã«é…ç½®\nworkstation% ssh-copy-id ceph@ceph01 workstation% ssh-copy-id ceph@ceph02 workstation% ssh-copy-id ceph@ceph03 ceph-deploy ã®å–å¾—ã‚’è¡Œã†ã€‚\nworkstation% git clone https://github.com/ceph/ceph-deploy.git ~/ceph-deploy \u0026lsquo;python-virtualenv\u0026rsquo; ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚\nworkstation% sudo apt-get update ; sudo apt-get -y install python-virtualenv ceph-deploy ã‚’ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã™ã‚‹\nworkstation% cd ~/ceph-deploy workstation% ./bootstrap PATH ã‚’é€šã™ã€‚è‡ªåˆ†ã® shell ã«åˆã‚ã›ã¦ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚\nworkstation% ${EDITOR} ~/.zshrc export PATH=$HOME/ceph-deploy:$PATH ãƒ›ã‚¹ãƒˆåã®è§£æ±ºã‚’è¡Œã†ã€‚\nworkstation% sudo ${EDITOR} /etc/hosts 10.0.0.1 ceph01 10.0.0.2 ceph02 10.0.0.3 ceph03 ã“ã‚Œã§æº–å‚™ã¯çµ‚ã‚ã‚Šã€‚\n3å°æ§‹æˆæ§‹ç¯‰ 3å° (ceph01-03) ã‚’æ–°è¦ã«æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’æ›¸ãã¾ã™ã€‚ã™ã¹ã¦ workstaiton ä¸Šã‹ã‚‰ã®æ“ ä½œã§ã™ã€‚\nceph ã‚µãƒ¼ãƒãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–“é€šä¿¡ã®ãŸã‚ã®éµã®ç”Ÿæˆã¨ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç”Ÿæˆ ã‚’ä¸‹è¨˜ã®æ“ä½œã§è¡Œã†ã€‚\nworkstation% ceph-deploy new ceph01 ceph02 ceph03 ä¸‹è¨˜ã®æ“ä½œã§ ceph ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’å„ Ceph ã‚µãƒ¼ãƒã«ã¦è¡Œã†ã€‚\u0026ndash;testing ç­‰ã¨å¼•æ•°ã‚’æ¸¡ã›ã° RC ç‰ˆã®åˆ©ç”¨ãŒè¡Œãˆã‚‹ã€‚ä½•ã‚‚æ¸¡ã•ãªã‘ã‚Œã° stable ç‰ˆã€‚\nworkstation% ceph-deploy install ceph01 ceph02 ceph03 MON daemon ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ã€‚\nworkstation% ceph-deploy mon create ceph01 ceph02 ceph03 éµã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ã€‚Ceph ã‚µãƒ¼ãƒé–“ãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–“ã§ã®å…±æœ‰éµã§ã‚ã‚‹ã€‚1 Cluster ã«å¯¾ã—ã¦1ã¤ã®éµã‚’ä¿æœ‰ã™ã‚‹ã€‚\nworkstation% ceph-deploy gatherkeys create ceph01 ceph02 ceph03 OSD daemon ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ã€‚ä¸‹è¨˜ã®æ§˜ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ãªã‘ã‚Œã°ãƒ„ãƒ¼ãƒ«ãŒ è‡ªå‹•ã§ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ã‚’è¡Œãªã£ã¦ãã‚Œã‚‹ã€‚\nworkstation% ceph-deploy osd create create ceph01:/dev/sdb ceph02:/dev/sdb ceph03:/dev/sdb MDS deamon ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ã€‚\ncephcleint% ceph-deploy mds create ceph01 ceph02 ceph03 ã“ã‚Œã§çµ‚ã‚ã‚Šã§ã™ã€‚ã“ã‚Œã‚‰ã®æ“ä½œãŒçµ‚ã‚ã‚‹ã¨ã™ã¹ã¦ã®ãƒ›ã‚¹ãƒˆ ceph01-03 ã§ mon, osd, mds ã®å„ãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚è¶…ã‚«ãƒ³ã‚¿ãƒ³ï¼\nãƒã‚¦ãƒ³ãƒˆã—ã¦ã¿ã‚ˆã†ï¼ ã•ãï½ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ãƒã‚¦ãƒ³ãƒˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã“ã“ã§ã¯ workstaion ãƒ›ã‚¹ãƒˆã‚’åˆ© ç”¨ã—ã¾ã™ã€‚Linux ç³»ã®ãƒã‚·ãƒ³ã§åŒã˜ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«å±ã—ã¦ã„ã‚Œã°å¤§æŠµãƒã‚¦ãƒ³ ãƒˆå‡ºæ¥ã‚‹ã¨æ€ã„ã¾ã™ã€‚mds ãŒç¨¼åƒã—ã¦ã„ã‚‹ãƒ›ã‚¹ãƒˆã«å¯¾ã—ã¦ã§ã‚ã‚Œã°ã©ã“ã«ã§ã‚‚ãƒã‚¦ãƒ³ãƒˆ å‡ºæ¥ã¾ã™ã€‚\nBlock Device ã¨ã—ã¦ãƒã‚¦ãƒ³ãƒˆã™ã‚‹æ–¹æ³• ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šã« block device ã‚’ç”Ÿæˆã—ãã‚Œã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã€‚\nworkstation% rbd create foo --size 4096 workstation% sudo modprobe rbd workstation% sudo rbd map foo --pool rbd --name client.admin workstation% sudo mkfs.ext4 -m0 /dev/rbd/rbd/foo workstation% sudo mkdir /mnt/myrbd workstation% sudo mount /dev/rbd/rbd/foo /mnt/myrbd Kernel Driver ã‚’ç”¨ã„ã¦ãƒã‚¦ãƒ³ãƒˆã™ã‚‹æ–¹æ³• kernel Driver ã‚’ç”¨ã„ã¦ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã€‚\nworkstation% sudo mkdir /mnt/mycephfs workstation% sudo mount -t ceph 10.0.0.1:6789:/ /mnt/mycephfs -o \\ name=admin,secret=`sudo ceph-authtool -p /etc/ceph/ceph.keyring` Fuse Driver (ãƒ¦ãƒ¼ã‚¶ãƒ©ãƒ³ãƒ‰) ã‚’ç”¨ã„ã¦ãƒã‚¦ãƒ³ãƒˆã™ã‚‹æ–¹æ³• ãƒ¦ãƒ¼ã‚¶ãƒ©ãƒ³ãƒ‰ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ FUSE ã‚’ç”¨ã„ã¦ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã€‚\nworkstation% sudo mkdir /home/\u0026lt;username\u0026gt;/cephfs workstation% sudo ceph-fuse -m 10.0.0.1:6789 /home/\u0026lt;username\u0026gt;/cephfs ã¾ã¨ã‚ ã‚‚ã—å°å…¥ã™ã‚‹ã®ã§ã‚ã‚Œã°ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§ã®æ§‹ç¯‰ã‚‚ä¸€åº¦ä½“é¨“ã—ãŸæ–¹ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã¨ä¸€ä½“ã©ã‚“ãªä½œæ¥­ãŒã•ã‚Œã¦ã„ã‚‹ã®ã‹ç†è§£å‡ºæ¥ãªã„ã®ã§ã€‚ãŸã ä»Šã§ã¯ãƒãƒ‹ãƒ¥ ã‚¢ãƒ«æ“ä½œã§æ§‹ç¯‰ã—ã¦ã„ã‚‹é€”ä¸­ã« \u0026lsquo;ceph-deploy ã‚’ä½¿ã£ã¦ãã ã•ã„\u0026rsquo; ã¨ warning ãŒå‡ºã‚‹ ã®ã§ã€é–‹ç™ºå…ƒã¨ã—ã¦ã‚‚ã“ã¡ã‚‰ã®æ§‹ç¯‰æ–¹æ³•ã‚’è–¦ã‚ãŸã„ã®ã§ã—ã‚‡ã†ã€‚ã‚ã¨ Ceph ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ ãƒ³ãƒˆãŒéå¸¸ã«å……å®Ÿã—ã¦ã„ã¾ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å…¨ã¦ã«å¤§äº‹ãªã“ã¨ãŒæ›¸ã„ã¦ã‚ã‚‹ã®ã§ä¸€åº¦ èª­ã‚€ã“ã¨ã‚’ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã™ã€‚ã¾ãŸ Ceph ãŒ Chef Cookbook ã‚‚å…¬é–‹ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã€ã ã¡ã‚‰ã®æ–¹æ³•ã‚‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãƒãƒ©ã£ã¨æ›¸ã„ã¦ã‚ã‚Šã¾ã—ãŸã€‚ç§ã¯ã¾ã è©¦ã—ã¦ã„ã¾ã›ã‚“ãŒæ™‚ é–“ãŒã‚ã‚Œã°ã‚„ã£ã¦ã¿ãŸã„ã§ã™ã€‚ã‚ã¨ã‚ã¨ï¼ceph-deploy ã¯ã¾ã æœªå®ŒæˆãªåŸŸã‚’è„±ã—ã¦ã„ã¾ ã›ã‚“ã€‚ä¸Šè¨˜ã®é€šã‚Šæ–°è¦æ§‹ç¯‰ç³»ã®æ“ä½œã¯ã²ã¨é€šã‚Šå‡ºæ¥ã‚‹ã®ã§ã™ãŒã€ãƒ›ã‚¹ãƒˆã®å‰Šé™¤ç³»ã®å®Ÿè£… ãŒã¾ã ã•ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ›ã‚¹ãƒˆè¿½åŠ ç³»ã®æ“ä½œã«é–¢ã—ã¦ã‚‚å‰Šé™¤ç³»ç¨‹ã§ã¯ãªã„ã®ã§ã™ ãŒå®Œæˆåº¦ãŒä¸ŠãŒã£ã¦ã„ã¾ã›ã‚“ã€‚æ‰‹ä½œæ¥­ã§å°‘ã—ã‚«ãƒãƒ¼ã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nOpenStack ã® Cinder ã®å…ˆã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã¤ã„ã¦æœ€è¿‘è€ƒãˆã¦ã„ã¾ã—ãŸã€‚LVM ç®¡ç†ã®ãƒ­ãƒ¼ ã‚«ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ã§ã‚‚ã„ã„ã®ã§ã™ãŒé‹ç”¨ã®ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚‰ãªãã¡ã‚ƒã„ ã‘ãªã„ã®ã ã‘ã© logcal volume ãŒå­˜åœ¨ã—ãªã„ã®ã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå‡º æ¥ãªãã†ã€‚Cinder ã¯æ¯”è¼ƒçš„é«˜ä¾¡ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚‚æ‰±ãˆã‚‹ã®ã§ãã¡ã‚‰ã®æ©Ÿèƒ½ã§ãƒãƒƒã‚¯ã‚¢ãƒƒ ãƒ—å–ã‚‹ã®ã‚‚ã„ã„ã‘ã©ã€ã“ã“ã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ãªã‚“ã¨ã‹ã—ãŸã„ï¼ã¨æ€ã£ã¦ Ceph ã‚’æ¤œè¨ ã—ã¦ã¿ã¾ã—ãŸã€‚\nCeph ã¯åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦ã‚‚ãƒ–ãƒ­ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦ ã‚‚å‹•ä½œãŒå¯èƒ½ã€‚OpenStack ã¨çµ„ã¿åˆã‚ã›ã‚‹ã¨ Cinder ã®å…ˆã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦ã‚‚ Glance ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ç½®ãå ´ã¨ã—ã¦ã‚‚åˆ©ç”¨å¯èƒ½ã‚‰ã—ã„ã€‚Cinder ã®æ¥ç¶šå…ˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦ ã®å‹•ä½œæ–¹æ³•ã¯ã¾ãŸåˆ¥ã®æ©Ÿä¼šã«ãƒ–ãƒ­ã‚°ã«æ›¸ãã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/05/11/ceph-deploy/","summary":"\u003cp\u003eä»Šå›ã¯ ceph-deploy ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ Ceph ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ç°¡å˜ã«æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒ\nå‡ºæ¥ã‚‹ã®ã§ç´¹ä»‹ã—ã¾ã™ã€‚Ceph ã¯åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦ã‚‚ãƒ–\nãƒ­ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦ã‚‚å‹•ä½œã—ã¾ã™ã€‚ä»Šå›ã®æ§‹ç¯‰ã§ã¯ãƒ–ãƒ­ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦ã®ã¿\nã®å‹•ä½œã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eCeph ãŒå…¬é–‹ã—ã¦ã„ã‚‹ã®ãŒ ceph-deploy ãªã‚ã‘ã§ã™ãŒã€ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æ“ä½œã«ä»£ã‚ã‚‹æ§‹ç¯‰æ–¹\næ³•ã¨ã—ã¦å…¬é–‹ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ãã®ä»–ã«ã‚‚ Chef Cookbook ã‚‚å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§\nã™ã€‚\u003c/p\u003e\n\u003cp\u003eãã‚Œã§ã¯æ—©é€Ÿã€‚\u003c/p\u003e\n\u003ch2 id=\"ä»Šå›ã®æ§‹æˆ\"\u003eä»Šå›ã®æ§‹æˆ\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003e+--------+ +--------+ +--------+\n| ceph01 | | ceph02 | | ceph03 |\n|  osd   | |  osd   | |  osd   |\n|  mon   | |  mon   | |  mon   |\n|  mds   | |  mds   | |  mds   |\n+--------+ +--------+ +--------+\n| 10.0.0.1 | 10.0.0.2 | 10.0.0.3\n|          |          |          \n+----------+----------+\n|\n| 10.0.0.10\n+-------------+\n| workstation |\n+-------------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eç‰¹å¾´ã¯\u003c/p\u003e","title":"Ceph-Deploy ã§ Ceph åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ§‹ç¯‰"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚Grizzly ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã‹ã‚‰æš«ãçµŒã¡ã¾ã—ãŸã€‚ä»Šå›ã¯ Folsom ãƒªãƒªãƒ¼ã‚¹ ã¾ã§ã‚ã£ãŸ Quantum ãƒãƒ¼ãƒ‰ã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã¨å˜ä¸€éšœå®³ç‚¹ã‚’è§£æ±ºã™ã‚‹æ–°ã—ã„æ©Ÿèƒ½ã«ã¤ã„ ã¦è©•ä¾¡ã—ãŸçµæœã‚’ãŠä¼ãˆã—ã¾ã™ã€‚\nFolsom ã¾ã§ã¯\nQuantum L3-agent ãŒè½ã¡ã‚‹ã¨ã€ãã® OpenStack ä¸€å¼ã®ä¸Šã«ã‚ã‚‹ä»®æƒ³ãƒã‚·ãƒ³å…¨ã¦ã®é€š ä¿¡ãŒé€”çµ¶ãˆã‚‹ Quantum L3-agent ã«ä»®æƒ³ãƒã‚·ãƒ³ã®å…¨ã¦ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒé›†ã¾ã‚Šãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã¨ãªã‚‹ã€‚ ã¨ã„ã†å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚Folsom ãƒªãƒªãƒ¼ã‚¹æ™‚ä»£ã«ã‚‚ã—åƒ•ãŒè·å ´ã§ OpenStack ã‚’å°å…¥ã™ ã‚‹ã®ã§ã‚ã‚Œã°ã“ã‚Œã‚‰ã‚’ç†ç”±ã« nova-network ã‚’é¸æŠã—ã¦ã„ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ nova-network ã¯ compute ãƒãƒ¼ãƒ‰ãŒè½ã¡ã‚Œã°ãã®ä¸Šã®ä»®æƒ³ãƒã‚·ãƒ³ã‚‚åŒæ™‚ã«è½ã¡ã‚‹ãŒã€ä»– ã® compute ãƒãƒ¼ãƒ‰ä¸Šã®ä»®æƒ³ãƒã‚·ãƒ³ã®é€šä¿¡ã«ã¯å½±éŸ¿ã‚’ä¸ãˆãªã„ã‹ã‚‰ã§ã™ã€‚ã‚‚ã¡ã‚ã‚“ä»®æƒ³ ãƒ«ãƒ¼ã‚¿ãƒ»ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç”Ÿæˆç­‰ã‚’ API ã§ãƒ¦ãƒ¼ã‚¶ã«æä¾›ã—ãŸã„ãªã©ã®è¦æœ›ãŒã‚ã‚Œã° Quantum ã‚’é¸æŠã™ã‚‹ã—ã‹ã‚ã‚Šã¾ã›ã‚“ãŒã€‚ã“ã‚Œã«å¯¾ã—ã¦ Grizzly ãƒªãƒªãƒ¼ã‚¹ã® Quantum ã¯ æ”¹å–„ã«å‘ã‘ã¦å¤§ããªæ©Ÿèƒ½ã‚’æä¾›ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚L3-agent, DHCP-agent ã®åˆ†æ•£ãƒ»å†— é•·æ©Ÿèƒ½ã§ã™ã€‚\nä¸‹è¨˜ã®æ§‹æˆãŒæƒ³å®šå‡ºæ¥ã¾ã™ã€‚ã“ã“ã§ã¯ Network ãƒãƒ¼ãƒ‰ã‚’2å°ç”¨æ„ã—ã¾ã—ãŸã€‚ãã‚Œä»¥ä¸Šã® å°æ•°ã«å¢—ã‚„ã™ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚\n+-------------+-------------+-------------------------- Public/API Network | | | +-----------+ +-----------+ +-----------+ +-----------+ | | | | | | |vm|vm|.. | | controller| | network | | network | +-----------+ | | | | | | | compute | +-----------+ +-----------+ +-----------+ +-----------+ | | | | | | | +-------------+-----)-------+-----)-------+-----)------ Management/API Network | | | +-------------+-------------+------ Data Network L3-agent ã®åˆ†æ•£ã¯ä»®æƒ³ãƒ«ãƒ¼ã‚¿å˜ä½ã§è¡Œã„ã¾ã™ã€‚ãã‚Œã«å¯¾ã— DHCP-agent ã¯ä»®æƒ³ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å˜ä½ã§è¡Œã„ã¾ã™ã€‚\nagent ä¸€è¦§ã®å–å¾— ä¸Šè¨˜ã®æ§‹æˆã‚’æ§‹ç¯‰ã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã« agent ä¸€è¦§ãŒå–å¾—å‡ºæ¥ã¾ã™ã€‚\n% quantum agent-list # 'admin' ãƒ¦ãƒ¼ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ +--------------------------------------+--------------------+-----------------------+-------+----------------+ | id | agent_type | host | alive | admin_state_up | +--------------------------------------+--------------------+-----------------------+-------+----------------+ | 44795822-2d9f-434e-ba98-748f7411442f | DHCP agent | grizzly03.example.com | :-) | True | | a5150a40-0405-4399-ac1a-be012f55d9f5 | DHCP agent | grizzly02.example.com | :-) | True | | b7bf4e59-06ac-475c-84ab-413d8d29f293 | Open vSwitch agent | grizzly04.example.com | :-) | True | | cc5a6b94-6ddd-4109-8f2f-1b28c6aaf5e6 | L3 agent | grizzly03.example.com | :-) | True | | d39803cf-19d3-47d7-8205-cf9a143dd0ea | Open vSwitch agent | grizzly02.example.com | :-) | True | | d8e59803-9aad-4c62-a47a-519bc788e0fb | Open vSwitch agent | grizzly03.example.com | :-) | True | | f6f747cf-ffb0-446c-a455-2947fd3e87e8 | L3 agent | grizzly02.example.com | :-) | True | +--------------------------------------+--------------------+-----------------------+-------+----------------+ ãƒ›ã‚¹ãƒˆåã¯ä¸‹è¨˜ã€‚\ncontroller : grizzly01.exmaple.com network01 : grizzly02.exmaple.com network02 : grizzly03.exmaple.com compute : grizzly04.exmaple.com L3-agent ã®åˆ†æ•£æ–¹æ³• (ãƒãƒ¼ãƒ‰ç§»å‹•) ä»®æƒ³ãƒ«ãƒ¼ã‚¿ (ã“ã“ã§ã¯ \u0026lsquo;router-test01\u0026rsquo; ã¨ã™ã‚‹) ãŒã©ã® L3-agent ã«å±ã—ã¦ã„ã‚‹ã‹ç¢º èªã‚’å–ã‚‹ã€‚\n% quantum l3-agent-list-hosting-router router-demo +--------------------------------------+-----------------------+----------------+-------+ | id | host | admin_state_up | alive | +--------------------------------------+-----------------------+----------------+-------+ | f6f747cf-ffb0-446c-a455-2947fd3e87e8 | grizzly02.example.com | True | :-) | +--------------------------------------+-----------------------+----------------+-------+ 1å°ç›®ã® Network ãƒãƒ¼ãƒ‰ (grizzly02.example.com) ä¸Šã® L3-agent ã«å±ã—ã¦ã„ã‚‹ã“ã¨ ãŒç¢ºèªå–ã‚ŒãŸã€‚æ¬¡ã«ã“ã®è¦ªå­é–¢ä¿‚ã‚’å‰Šé™¤ã™ã‚‹ã€‚\n% quantum l3-agent-router-remove f6f747cf-ffb0-446c-a455-2947fd3e87e8 router-test01 Removed Router router-demo to L3 agent æœ€å¾Œã«ä»®æƒ³ãƒ«ãƒ¼ã‚¿ \u0026lsquo;router-test01\u0026rsquo; ã‚’2å°ç›®ã® Network ãƒãƒ¼ãƒ‰ä¸Šã® L3-agent ã®ç®¡ç† ä¸‹ã«è¨­å®šã™ã‚‹ã€‚\n% quantum l3-agent-router-add cc5a6b94-6ddd-4109-8f2f-1b28c6aaf5e6 router-demo Added router router-demo to L3 agent % quantum l3-agent-list-hosting-router router-demo +--------------------------------------+-----------------------+----------------+-------+ | id | host | admin_state_up | alive | +--------------------------------------+-----------------------+----------------+-------+ | cc5a6b94-6ddd-4109-8f2f-1b28c6aaf5e6 | grizzly0404.cpi.ad.jp | True | xxx | +--------------------------------------+-----------------------+----------------+-------+ DHCP-Agent ã®åˆ†æ•£æ–¹æ³• (ãƒãƒ¼ãƒ‰ç§»å‹•) ä»®æƒ³ãƒã‚·ãƒ³ãŒæ‰€å±ã—ã¦ã„ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ (ã“ã“ã§ã¯ \u0026lsquo;int_net\u0026rsquo;) ãŒã©ã® DHCP-agent ã«æ‰€å±ã—ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ã€‚\n% quantum dhcp-agent-list-hosting-net int_net +--------------------------------------+-----------------------+----------------+-------+ | id | host | admin_state_up | alive | +--------------------------------------+-----------------------+----------------+-------+ | a5150a40-0405-4399-ac1a-be012f55d9f5 | grizzly02.example.com | True | :-) | +--------------------------------------+-----------------------+----------------+-------+ 1å°ç›®ã®ãƒãƒ¼ãƒ‰ã«æ‰€å±ã—ã¦ã„ã‚‹ã®ãŒç¢ºèªã§ãã‚‹ã€‚æ¬¡ã« \u0026lsquo;int_net\u0026rsquo; ãŒæ‰€å±ã™ã‚‹ DHCP-agent ã‚’å‰Šé™¤è¡Œã†ã€‚\n% quantum dhcp-agent-network-remove a5150a40-0405-4399-ac1a-be012f55d9f5 int_net Removed network int_net to DHCP agent 2å°ç›®ã®ãƒãƒ¼ãƒ‰ã® DHCP-agent ã‚’ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ \u0026lsquo;int_net\u0026rsquo; ã«ç´ä»˜ã‘ã‚‹ã€‚\n% quantum dhcp-agent-network-add 44795822-2d9f-434e-ba98-748f7411442f int_net Added network int_net to DHCP agent % quantum dhcp-agent-list-hosting-net int_net +--------------------------------------+-----------------------+----------------+-------+ | id | host | admin_state_up | alive | +--------------------------------------+-----------------------+----------------+-------+ | 44795822-2d9f-434e-ba98-748f7411442f | grizzly0404.cpi.ad.jp | True | :-) | +--------------------------------------+-----------------------+----------------+-------+ ã¾ã¨ã‚ ã“ã®æ§˜ã«ä»®æƒ³ãƒ«ãƒ¼ã‚¿, ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å˜ä½ã§ Network ãƒãƒ¼ãƒ‰ã® agent ã®åˆ†æ•£ãŒè¡Œãˆ ã‚‹ã€‚ä¸Šè¨˜ã®ã‚ˆã†ã«ä»®æƒ³ãƒ«ãƒ¼ã‚¿ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒ1ã¤ãšã¤ã§ã¯åˆ†æ•£ã¨ã„ã†æ„å‘³ã§ã¯ç„¡ã„ãŒ é‹ç”¨ã®éç¨‹ã§ä»®æƒ³ãƒ«ãƒ¼ã‚¿ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯å¢—ãˆã‚‹ã“ã¨ãŒæƒ³å®šå‡ºæ¥ã‚‹ã®ã§ãã®éš›ã«ã¯ãƒˆãƒ© ãƒ•ã‚£ãƒƒã‚¯ãƒ»DHCP æ©Ÿèƒ½ã‚’åˆ†æ•£ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚‹ã€ã¨è¨€ãˆã‚‹ã€‚ã¾ãŸç‰‡ç³»ã® Network ãƒãƒ¼ ãƒ‰ã«å¯„ã›ã¦ãŠã„ã¦ã‹ã‚‰ã®éšœå®³ãƒ†ã‚¹ãƒˆ -\u0026gt; ã‚‚ã†ç‰‡ç³»ã¸ã®ç§»å‹•ã‚‚è¡Œãªã£ã¦ã¿ãŸãŒä½œæ¥­ã¨ã¨ã‚‚ ã«ä»®æƒ³ãƒã‚·ãƒ³ã®é€šä¿¡ãŒå¾©æ—§ã—ãŸã€‚ã“ã®ãƒ†ã‚¹ãƒˆã‚’è¡Œã†å‰ã¾ã§ \u0026lsquo;agent ã®ç§»å‹•ã ã‘è¡Œãˆã‚‹ã® ã§ã‚ã£ã¦ä»®æƒ³ãƒ«ãƒ¼ã‚¿è‡ªä½“ãŒç§»å‹•ã™ã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§å†—é•·ã¨ã„ã†æ„å‘³ã¯ãªã„\u0026rsquo; ã¨è€ƒãˆã¦ ã„ãŸã®ã ãŒã€å®Ÿéš›ã«ã¯ä¸Šè¨˜ã®æ“ä½œã§ namespace ãŒç§»å‹•ã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ¤ã‚Š (Quantum ã®ä»®æƒ³ãƒ«ãƒ¼ã‚¿ã®å®Ÿä½“ã¯ Linux Namespace) éšœå®³ãƒ†ã‚¹ãƒˆã®çµæœã€ã†ã¾ãã„ã£ãŸã€‚ OpenStack ã‚’å°å…¥ã™ã‚‹ã¨ã„ã†æ„å‘³ã§ã€ã“ã®æ©Ÿèƒ½ã¯éå¸¸ã«å¤§ããªå‰é€²ã ã¨åƒ•ã¯æ€ã£ã¦ã„ã¾ ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/04/26/quantum-network-distributing/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚Grizzly ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã‹ã‚‰æš«ãçµŒã¡ã¾ã—ãŸã€‚ä»Šå›ã¯ Folsom ãƒªãƒªãƒ¼ã‚¹\nã¾ã§ã‚ã£ãŸ Quantum ãƒãƒ¼ãƒ‰ã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã¨å˜ä¸€éšœå®³ç‚¹ã‚’è§£æ±ºã™ã‚‹æ–°ã—ã„æ©Ÿèƒ½ã«ã¤ã„\nã¦è©•ä¾¡ã—ãŸçµæœã‚’ãŠä¼ãˆã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eFolsom ã¾ã§ã¯\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eQuantum L3-agent ãŒè½ã¡ã‚‹ã¨ã€ãã® OpenStack ä¸€å¼ã®ä¸Šã«ã‚ã‚‹ä»®æƒ³ãƒã‚·ãƒ³å…¨ã¦ã®é€š\nä¿¡ãŒé€”çµ¶ãˆã‚‹\u003c/li\u003e\n\u003cli\u003eQuantum L3-agent ã«ä»®æƒ³ãƒã‚·ãƒ³ã®å…¨ã¦ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒé›†ã¾ã‚Šãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã¨ãªã‚‹ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã¨ã„ã†å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚Folsom ãƒªãƒªãƒ¼ã‚¹æ™‚ä»£ã«ã‚‚ã—åƒ•ãŒè·å ´ã§ OpenStack ã‚’å°å…¥ã™\nã‚‹ã®ã§ã‚ã‚Œã°ã“ã‚Œã‚‰ã‚’ç†ç”±ã« nova-network ã‚’é¸æŠã—ã¦ã„ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\nnova-network ã¯ compute ãƒãƒ¼ãƒ‰ãŒè½ã¡ã‚Œã°ãã®ä¸Šã®ä»®æƒ³ãƒã‚·ãƒ³ã‚‚åŒæ™‚ã«è½ã¡ã‚‹ãŒã€ä»–\nã® compute ãƒãƒ¼ãƒ‰ä¸Šã®ä»®æƒ³ãƒã‚·ãƒ³ã®é€šä¿¡ã«ã¯å½±éŸ¿ã‚’ä¸ãˆãªã„ã‹ã‚‰ã§ã™ã€‚ã‚‚ã¡ã‚ã‚“ä»®æƒ³\nãƒ«ãƒ¼ã‚¿ãƒ»ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç”Ÿæˆç­‰ã‚’ API ã§ãƒ¦ãƒ¼ã‚¶ã«æä¾›ã—ãŸã„ãªã©ã®è¦æœ›ãŒã‚ã‚Œã°\nQuantum ã‚’é¸æŠã™ã‚‹ã—ã‹ã‚ã‚Šã¾ã›ã‚“ãŒã€‚ã“ã‚Œã«å¯¾ã—ã¦ Grizzly ãƒªãƒªãƒ¼ã‚¹ã® Quantum ã¯\næ”¹å–„ã«å‘ã‘ã¦å¤§ããªæ©Ÿèƒ½ã‚’æä¾›ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚L3-agent, DHCP-agent ã®åˆ†æ•£ãƒ»å†—\né•·æ©Ÿèƒ½ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹è¨˜ã®æ§‹æˆãŒæƒ³å®šå‡ºæ¥ã¾ã™ã€‚ã“ã“ã§ã¯ Network ãƒãƒ¼ãƒ‰ã‚’2å°ç”¨æ„ã—ã¾ã—ãŸã€‚ãã‚Œä»¥ä¸Šã®\nå°æ•°ã«å¢—ã‚„ã™ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e+-------------+-------------+-------------------------- Public/API Network\n|             |             |\n+-----------+ +-----------+ +-----------+ +-----------+\n|           | |           | |           | |vm|vm|..   |\n| controller| |  network  | |  network  | +-----------+\n|           | |           | |           | |  compute  |\n+-----------+ +-----------+ +-----------+ +-----------+\n|             |     |       |     |       |     |\n+-------------+-----)-------+-----)-------+-----)------ Management/API Network\n                    |             |             |\n                    +-------------+-------------+------ Data Network\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eL3-agent ã®åˆ†æ•£ã¯ä»®æƒ³ãƒ«ãƒ¼ã‚¿å˜ä½ã§è¡Œã„ã¾ã™ã€‚ãã‚Œã«å¯¾ã— DHCP-agent ã¯ä»®æƒ³\nãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å˜ä½ã§è¡Œã„ã¾ã™ã€‚\u003c/p\u003e","title":"Quantum Network ãƒãƒ¼ãƒ‰ã®åˆ†æ•£ãƒ»å†—é•·"},{"content":"ä»¥å‰ã«ã‚‚è©±é¡Œã«ã—ãŸã“ã¨ãŒã‚ã‚‹ Chef For OpenStack ã§ã™ãŒä»Šé€±æ–°ã—ã„æƒ…å ±ãŒå…¥ã£ã¦æ¥ ã¾ã—ãŸã€‚#ChefConf 2013 ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚ã£ãŸã®ã§ã™ãŒã“ã“ã§ Opscode ã® Matt Ray ã•ã‚“ã‚‰ãŒé›†ã¾ã‚Š OpenStack ã‚’ Chef ã§æ§‹ç¯‰ã™ã‚‹ \u0026lsquo;Chef for OpenStack\u0026rsquo; ã«ã¤ã„ã¦ èªã‚‰ã‚ŒãŸæ¨¡æ§˜ã§ã™ã€‚ãã®æ™‚ã®è³‡æ–™ãŒ SlideShare ã«ä¸ŠãŒã£ã¦ã„ãŸã®ã§è¦‹ã¦ã¿ã¾ã—ãŸã€‚\nChef for OpenStack: Grizzly Roadmap from Matt Ray æ°—ã«ã‚ã£ãŸç‚¹ã‚’å¹¾ã¤ã‹æŒ™ã’ã¦ã„ãã¾ã™ã€‚\nhttps://github.com/osops ã§ç®¡ç†ã•ã‚Œã‚‹ å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® cookbook ã®åå‰ã«ã¯ \u0026lsquo;-cookbook\u0026rsquo; ã‚’æœ€å¾Œã«ä»˜ã‘ã‚‹ quantum, cinder, ceilometer, heat ç­‰ã€æ¯”è¼ƒçš„æ–°ã—ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚‚åŠ ã‚ã‚‹ gerrit ã§ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã•ã‚Œ CI ã‚‚æä¾›ã•ã‚Œã‚‹ Chef11 ãŒç”¨ã„ã‚‰ã‚Œã‚‹ Ruby 1.9.x ã«å¯¾å¿œã—ãŸ chef-client ãŒç”¨ã„ã‚‰ã‚Œã‚‹ Foodcritic ã§å¯èƒ½ãªé™ã‚Šãƒ†ã‚¹ãƒˆã•ã‚Œã‚‹ chef-solo ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œãªã„ 5æœˆã« \u0026lsquo;2013.1.0\u0026rsquo; ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ (openstack 2013.1 å¯¾å¿œã¨æ€ã‚ã‚Œã‚‹) chef-repo ã®å½¢ã§æä¾›ã•ã‚Œã‚‹ Ubuntu 12.04 ãŒå‰æ HyperVisor ã¯ KVM, LXC ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ ä»¥ä¸Šã§ã™ã€‚æã‚‰ã chef-repo ã§æä¾›ã•ã‚Œã‚‹ã¨ã„ã†ã“ã¨ã¯ spiceweasel ã‚’ä½¿ã£ãŸæ§‹æˆæ§‹ ç¯‰ãŒå‡ºæ¥ã‚‹ã‚ˆã†ãªå½¢ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚æ¥½ã—ã¿ã§ã™ã€‚ã¾ãŸã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã™ã‚‹æ–¹æ³•ã‚‚æ² è¼‰ã•ã‚Œã¦ã„ã‚‹ã®ã§èˆˆå‘³ãŒæœ‰ã‚‹æ–¹ã¯å”åŠ›ã—ã¦ã¿ã‚‹ã®ã‚‚æ¥½ã—ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/04/21/chef-for-openstack-grizzly-roadmap/","summary":"\u003cp\u003eä»¥å‰ã«ã‚‚è©±é¡Œã«ã—ãŸã“ã¨ãŒã‚ã‚‹ Chef For OpenStack ã§ã™ãŒä»Šé€±æ–°ã—ã„æƒ…å ±ãŒå…¥ã£ã¦æ¥\nã¾ã—ãŸã€‚#ChefConf 2013 ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚ã£ãŸã®ã§ã™ãŒã“ã“ã§ Opscode ã® Matt\nRay ã•ã‚“ã‚‰ãŒé›†ã¾ã‚Š OpenStack ã‚’ Chef ã§æ§‹ç¯‰ã™ã‚‹ \u0026lsquo;Chef for OpenStack\u0026rsquo; ã«ã¤ã„ã¦\nèªã‚‰ã‚ŒãŸæ¨¡æ§˜ã§ã™ã€‚ãã®æ™‚ã®è³‡æ–™ãŒ SlideShare ã«ä¸ŠãŒã£ã¦ã„ãŸã®ã§è¦‹ã¦ã¿ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ciframe src=\"http://www.slideshare.net/slideshow/embed_code/19197748\"\nwidth=\"427\" height=\"356\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\"\nscrolling=\"no\" style=\"border:1px solid #CCC;border-width:1px 1px\n0;margin-bottom:5px\" allowfullscreen webkitallowfullscreen mozallowfullscreen\u003e\n\u003c/iframe\u003e \u003cdiv style=\"margin-bottom:5px\"\u003e \u003cstrong\u003e \u003ca\nhref=\"http://www.slideshare.net/mattray/chef-for-openstack-grizzly-roadmap\"\ntitle=\"Chef for OpenStack: Grizzly Roadmap\" target=\"_blank\"\u003eChef for\nOpenStack: Grizzly Roadmap\u003c/a\u003e \u003c/strong\u003e from \u003cstrong\u003e\u003ca\nhref=\"http://www.slideshare.net/mattray\" target=\"_blank\"\u003eMatt Ray\u003c/a\u003e\u003c/strong\u003e\n\u003c/div\u003e\n\u003cp\u003eæ°—ã«ã‚ã£ãŸç‚¹ã‚’å¹¾ã¤ã‹æŒ™ã’ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/osops\"\u003ehttps://github.com/osops\u003c/a\u003e ã§ç®¡ç†ã•ã‚Œã‚‹\u003c/li\u003e\n\u003cli\u003eå„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® cookbook ã®åå‰ã«ã¯ \u0026lsquo;-cookbook\u0026rsquo; ã‚’æœ€å¾Œã«ä»˜ã‘ã‚‹\u003c/li\u003e\n\u003cli\u003equantum, cinder, ceilometer, heat ç­‰ã€æ¯”è¼ƒçš„æ–°ã—ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚‚åŠ ã‚ã‚‹\u003c/li\u003e\n\u003cli\u003egerrit ã§ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã•ã‚Œ CI ã‚‚æä¾›ã•ã‚Œã‚‹\u003c/li\u003e\n\u003cli\u003eChef11 ãŒç”¨ã„ã‚‰ã‚Œã‚‹\u003c/li\u003e\n\u003cli\u003eRuby 1.9.x ã«å¯¾å¿œã—ãŸ chef-client ãŒç”¨ã„ã‚‰ã‚Œã‚‹\u003c/li\u003e\n\u003cli\u003eFoodcritic ã§å¯èƒ½ãªé™ã‚Šãƒ†ã‚¹ãƒˆã•ã‚Œã‚‹\u003c/li\u003e\n\u003cli\u003echef-solo ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œãªã„\u003c/li\u003e\n\u003cli\u003e5æœˆã« \u0026lsquo;2013.1.0\u0026rsquo; ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ (openstack 2013.1 å¯¾å¿œã¨æ€ã‚ã‚Œã‚‹)\u003c/li\u003e\n\u003cli\u003echef-repo ã®å½¢ã§æä¾›ã•ã‚Œã‚‹\u003c/li\u003e\n\u003cli\u003eUbuntu 12.04 ãŒå‰æ\u003c/li\u003e\n\u003cli\u003eHyperVisor ã¯ KVM, LXC ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä»¥ä¸Šã§ã™ã€‚æã‚‰ã chef-repo ã§æä¾›ã•ã‚Œã‚‹ã¨ã„ã†ã“ã¨ã¯ spiceweasel ã‚’ä½¿ã£ãŸæ§‹æˆæ§‹\nç¯‰ãŒå‡ºæ¥ã‚‹ã‚ˆã†ãªå½¢ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚æ¥½ã—ã¿ã§ã™ã€‚ã¾ãŸã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã™ã‚‹æ–¹æ³•ã‚‚æ²\nè¼‰ã•ã‚Œã¦ã„ã‚‹ã®ã§èˆˆå‘³ãŒæœ‰ã‚‹æ–¹ã¯å”åŠ›ã—ã¦ã¿ã‚‹ã®ã‚‚æ¥½ã—ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\u003c/p\u003e","title":"Chef for OpenStack"},{"content":"ã“ã‚“ã«ã¡ã¯ jedipunkz ã§ã™ã€‚\nVirtio ã«å¯¾å¿œã—ã¦ã„ãªã„ OS ã‚’ OpenStack ã§ç¨¼åƒã•ã›ã‚‹ã“ã¨ãŒä»Šã¾ã§å‡ºæ¥ãªã‹ã£ãŸã® ã§ã™ãŒ Grizzly ã‹ã‚‰é Virtio ãª OS ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ‰±ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚ä»Šã¾ã§ NetBSD ã‚„ã‚‰å¤ã„ FreeBSD ã‚„ã‚‰ virtio ãƒ‰ãƒ©ã‚¤ãƒã‚’ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å…¥ã‚Œã‚‹ã“ã¨ã«è‹¦åŠ´ã—ã¦ã„ãŸã® ã ã‘ã©ã€ã“ã‚Œã§å•é¡Œç„¡ããªã£ãŸã€‚\næœ€åˆã€ã“ã®æ©Ÿèƒ½ã®ã“ã¨èª¿ã¹ã‚‹ã®ã«ã€Œã©ã†ã› libvirt ãŒç”Ÿæˆã™ã‚‹ xml ã‚’æ›¸ãæ›ãˆã‚‹ã®ã  ã‹ã‚‰ nova å‘¨ã‚Šã®è¨­å®šãªã‚“ã ã‚ã†ãƒ¼ã€ã¨æ€ã£ã¦ã„ãŸã‚‰å…¨ãæ–¹æ³•ãŒè¦‹ã¤ã‹ã‚‰ãš\u0026hellip;ã€‚çµå±€ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ ¼ç´ã—ã¦ã„ã‚‹ Glance ã®è¨­å®šã«ã‚ã‚Šã¾ã—ãŸã€‚\nã“ã“ã§ã¯ FreeBSD7.4 Release ã‚’ä¾‹ã«æŒ™ã’ã¦èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚\nå‰æã¨ã™ã‚‹ç’°å¢ƒ OpenStack Grizzly ãŒç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨ ãƒ›ã‚¹ãƒˆ OS ã« Ubuntu 12.04.2 LTS ãŒç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨ ã‚²ã‚¹ãƒˆ OS ã« FreeBSD 7.4 Release ã‚’ç”¨ã„ã‚‹ ã¨ã—ã¾ã™ã€‚OS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ãƒ›ã‚¹ãƒˆãƒ»ã‚²ã‚¹ãƒˆå…±ã«ã€ä¸Šè¨˜ä»¥å¤–ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚Grizzly ã•ãˆå‹•ã„ã¦ã„ã‚Œã° OK ã§ã™ã€‚\nOS ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆ KVM ã§ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ virtio ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯æŒ‡å®šã›ãš\nIDE ãƒ‡ã‚£ã‚¹ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ e1000 (intel) ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ã‚’æŒ‡å®šã—ã¦ã‚ã’ã¦ãã ã•ã„ã€‚\n% kvm-img create -f qcow2 \u0026lt;IMAGE_NAME\u0026gt; 5G % sudo kvm -m 1024 --cdrom FreeBSD-7.4-RELEASE-amd64-disc1.iso --drive \\ file=./\u0026lt;IMAGE_NAME\u0026gt; -boot d -net nic,model=e1000 -net user -nographic \\ -vnc :9 VNC ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚½ãƒ•ãƒˆã‚’ç”¨ã„ã¦ãƒ›ã‚¹ãƒˆ :9 ç•ªã«æ¥ç¶šã— OS ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚\nGlance ã¸ã®ç™»éŒ² OpenStack API ã«æ¥ç¶šã™ã‚‹ç’°å¢ƒå¤‰æ•°ç­‰ã‚’åˆã‚ã›ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\n% glance image-create --name=\u0026quot;FreeBSD7.4\u0026quot; --is-public \\ true --container-format bare --disk-format qcow2 \u0026lt; \u0026lt;IMAGE_NAME\u0026gt; % glance image-update --property hw_vif_model=e1000 \u0026quot;FreeBSD7.4\u0026quot; % glance image-update --property hw_disk_bus=ide \u0026quot;FreeBSD7.4\u0026quot; \u0026ndash;property ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ãƒ‡ã‚£ã‚¹ã‚¯ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®æŒ‡å®šã‚’å¤‰æ›´ã—ã¦ ã„ã¾ã™ã€‚\nVM ã®ç¨¼åƒ ã‚ã¨ã¯æ™®æ®µé€šã‚Š nova boot ã‚³ãƒãƒ³ãƒ‰ã§ VM ã‚’ç¨¼åƒã•ã›ã‚‹ã ã‘ã§ã™ã€‚\n% nova boot --nic net-id=\u0026lt;network_id\u0026gt; --image \u0026lt;image_id\u0026gt; --flavor \u0026lt;flavor_number\u0026gt; \u0026lt;vm_name\u0026gt; ","permalink":"https://jedipunkz.github.io/post/2013/04/21/openstack-non-virtio/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ jedipunkz ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eVirtio ã«å¯¾å¿œã—ã¦ã„ãªã„ OS ã‚’ OpenStack ã§ç¨¼åƒã•ã›ã‚‹ã“ã¨ãŒä»Šã¾ã§å‡ºæ¥ãªã‹ã£ãŸã®\nã§ã™ãŒ Grizzly ã‹ã‚‰é Virtio ãª OS ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ‰±ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚ä»Šã¾ã§ NetBSD\nã‚„ã‚‰å¤ã„ FreeBSD ã‚„ã‚‰ virtio ãƒ‰ãƒ©ã‚¤ãƒã‚’ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å…¥ã‚Œã‚‹ã“ã¨ã«è‹¦åŠ´ã—ã¦ã„ãŸã®\nã ã‘ã©ã€ã“ã‚Œã§å•é¡Œç„¡ããªã£ãŸã€‚\u003c/p\u003e\n\u003cp\u003eæœ€åˆã€ã“ã®æ©Ÿèƒ½ã®ã“ã¨èª¿ã¹ã‚‹ã®ã«ã€Œã©ã†ã› libvirt ãŒç”Ÿæˆã™ã‚‹ xml ã‚’æ›¸ãæ›ãˆã‚‹ã®ã \nã‹ã‚‰ nova å‘¨ã‚Šã®è¨­å®šãªã‚“ã ã‚ã†ãƒ¼ã€ã¨æ€ã£ã¦ã„ãŸã‚‰å…¨ãæ–¹æ³•ãŒè¦‹ã¤ã‹ã‚‰ãš\u0026hellip;ã€‚çµå±€\nOS ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ ¼ç´ã—ã¦ã„ã‚‹ Glance ã®è¨­å®šã«ã‚ã‚Šã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eã“ã“ã§ã¯ FreeBSD7.4 Release ã‚’ä¾‹ã«æŒ™ã’ã¦èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æã¨ã™ã‚‹ç’°å¢ƒ\"\u003eå‰æã¨ã™ã‚‹ç’°å¢ƒ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eOpenStack Grizzly ãŒç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨\u003c/li\u003e\n\u003cli\u003eãƒ›ã‚¹ãƒˆ OS ã« Ubuntu 12.04.2 LTS ãŒç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨\u003c/li\u003e\n\u003cli\u003eã‚²ã‚¹ãƒˆ OS ã« FreeBSD 7.4 Release ã‚’ç”¨ã„ã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã¨ã—ã¾ã™ã€‚OS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ãƒ›ã‚¹ãƒˆãƒ»ã‚²ã‚¹ãƒˆå…±ã«ã€ä¸Šè¨˜ä»¥å¤–ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚Grizzly\nã•ãˆå‹•ã„ã¦ã„ã‚Œã° OK ã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"os-ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆ\"\u003eOS ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆ\u003c/h2\u003e\n\u003cp\u003eKVM ã§ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ virtio ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯æŒ‡å®šã›ãš\u003c/p\u003e","title":"OpenStack Grizzy ã§é Virtio OS ç¨¼åƒ"},{"content":"OpenStack Grizzly ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦2é€±é–“ã»ã©çµŒéã—ã¾ã—ãŸã€‚çš†ã•ã‚“å‹•ã‹ã—ã¦ã¿ã¾ã— ãŸã‹ï¼Ÿä»Šå›ã€æ¯åº¦ã®æ§‹ç¯‰ Bash ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’é–‹ç™ºã—ãŸã®ã§å…¬é–‹ã—ã¾ã™ã€‚\nä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚\nhttps://github.com/jedipunkz/openstack_grizzly_install\nã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€è¤‡æ•°å°æ§‹æˆã¨ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã®ä¸¡æ–¹ãŒæ§‹æˆå‡ºæ¥ã‚‹ã‚ˆã†ãªã£ã¦ã„ã¾ ã™ãŒã€ä»Šå›ã¯ç°¡å˜ãªã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã®çµ„ã¿æ–¹ã‚’ã‚’ç°¡å˜ã«èª¬æ˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nå‰æã®ç’°å¢ƒ Ubuntu 12.04 LTS ãŒç¨¼åƒã—ã¦ã„ã‚‹ Cinder ã®ãŸã‚ã®ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ OS é ˜åŸŸã¨åˆ¥ã«ç”¨æ„ (/dev/sdb1 ãªã©) ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã®å ´åˆã¯ 2 NICs æº–å‚™ Ubuntu 13.04 ã® daily build ã‚‚å®Œæˆåº¦ä¸ŠãŒã£ã¦ã„ã‚‹æ™‚æœŸã§ã™ãŒ OVS å´ã®å¯¾å¿œãŒ OpenStack æ§‹æˆã«å•é¡Œã‚’ç”Ÿã˜ã•ã›ã‚‹ãŸã‚ 12.04 LTS + Ubuntu Cloud Archive ã®çµ„ã¿åˆ ã‚ã›ã§æ§‹ç¯‰ã™ã‚‹ã®ãŒä¸»æµã«ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ã¾ãŸã€Cinder ç”¨ã®ãƒ‡ã‚£ã‚¹ã‚¯ã¯ OS é ˜ åŸŸã‚’ä¿æŒã—ã¦ã„ã‚‹ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã¯åˆ¥ (ã‚‚ã—ãã¯ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã£ã¦ãƒ‡ã‚£ã‚¹ã‚¯ãƒ‡ãƒã‚¤ã‚¹ ã‚’åˆ¥ã‘ã¦ã‚‚å¯) ãŒå¿…è¦ã§ã™ã€‚ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã®å ´åˆã¯ NIC ã‚’2ã¤ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ ã‚Šã¾ã™ã€‚é€šå¸¸ OpenStack ã‚’è¤‡æ•°å°æ§‹æˆã™ã‚‹å ´åˆã¯\nã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰ x 1 å° ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒ¼ãƒ‰ x 1 å° ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ x n å° ã§çµ„ã¿ã€VM ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ã‹ã‚‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒ¼ãƒ‰ã‚’ä»‹ã—ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã« æ¥ç¶šã—ã¾ã™ã€‚ã‚ˆã£ã¦ãã®ãŸã‚æ›´ã« NIC ãŒå¿…è¦ã«ãªã‚‹ã®ã§ã™ãŒã€ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã® å ´åˆã¯\nãƒãƒãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯, API ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯(å†…éƒ¨é€šä¿¡ç”¨) ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ (VM ã®ãŸã‚ã®ãƒ–ãƒªãƒƒã‚¸ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹) ã®è¨ˆ2ã¤ã‚’ç”¨æ„ã—ã¦ãã ã•ã„ã€‚\nå®Ÿè¡Œå‰ã®æº–å‚™ OS ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« OS ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯å‰²æ„›ã—ã¾ã™ãŒ\n\u0026lsquo;openssh-server\u0026rsquo; ã®ã¿ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ãƒ‡ã‚£ã‚¹ã‚¯ãŒ1ã¤ã—ã‹ãªã„å ´åˆã¯ cinder ç”¨ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ç”¨æ„ ã®æ¡ä»¶ãŒæº€ãŸã•ã‚Œã¦ã„ã‚Œã° OK ã§ã™ã€‚\nCinder ç”¨ã®ãƒ‡ã‚£ã‚¹ã‚¯ãƒ‡ãƒã‚¤ã‚¹ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚° Cinder ç”¨ã«ä¿¡é ¼æ€§ã®ã‚ã‚‹ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ç”¨æ„ã—ã¦ã„ã‚‹å ´åˆã¯ fdisk ç­‰ã‚’ç”¨ã„ã¦ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ ãƒ‹ãƒ³ã‚°ã—ã¦ãã ã•ã„ã€‚è¿‘ã€… loopback ãƒ‡ãƒã‚¤ã‚¹ã§ã‚‚æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ”¹ä¿®ã‚’ ã™ã‚‹äºˆå®šã§ã™ã€‚ãƒ‡ã‚£ã‚¹ã‚¯ãŒä¸€ã¤ã—ã‹ãªã„å ´åˆã¯å…ˆç¨‹è¿°ã¹ãŸã¨ãŠã‚Šã€OS ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ã—ãŸãƒ‡ã‚£ã‚¹ã‚¯ãƒ‡ãƒã‚¤ã‚¹ã‚’ä½¿ã„ã¾ã™ã€‚\n% sudo fdisk /dev/sdb ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®è¨­å®š ä¸‹è¨˜ã®ã‚ˆã†ã«2ã¤ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚\n% sudo ${EDITOR} /etc/network/interfaces auto lo iface lo inet loopback # this NIC will be used for VM traffic to the internet auto eth0 iface eth0 inet static up ifconfig $IFACE 0.0.0.0 up up ip link set $IFACE promisc on down ip link set $IFACE promisc off down ifconfig $IFACE down address 10.200.9.10 netmask 255.255.255.0 dns-nameservers \u0026lt;DNS_RESOLVER1\u0026gt; \u0026lt;DNS_RESOLVER\u0026gt; dns-search example.com # this NIC must be on management network auto eth1 iface eth1 inet static address 10.200.10.10 netmask 255.255.255.0 gateway 10.200.10.1 dns-nameservers \u0026lt;DNS_RESOLVER1\u0026gt; \u0026lt;DNS_RESOLVER\u0026gt; eth0 ãŒ VM ã®ãŸã‚ã®ãƒ–ãƒªãƒƒã‚¸ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ãªã‚Šã¾ã™ã€‚eth1 ã¯ãƒãƒãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆãƒãƒƒ ãƒˆãƒ¯ãƒ¼ã‚¯ç”¨ãƒ»å†…éƒ¨ API é€šä¿¡ç”¨ã®å…¼å‹™ã§ã™ã€‚\nã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å–å¾—ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å–å¾—ã‚’è¡Œã„ã¾ã™ã€‚\n% git clone git://github.com/jedipunkz/openstack_grizlly_install.git % cd openstack_grizzly_install ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚‹ãŸã‚ setup.conf å†…ã®å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šå¤‰æ›´ã—ã¾ã™ã€‚æ•°å¤šãã® ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™ãŒã€æœ€ä½é™ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã„ã†ã“ã¨ã§\u0026hellip;\nHOST_IP='10.200.10.10' HOST_PUB_IP='10.200.9.10' PUBLIC_NIC='eth0' ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚HOST_IP ã¯ eth1 ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã€HOST_PUB_IP ã¯ eth0 ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã€PUBLIC_NIC ã¯ eth0 (HOST_PUB_IP ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å) ã‚’æŒ‡å®šã—ã¾ã™ã€‚\nã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ ã„ã‚ˆã„ã‚ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\n% sudo ./setup.sh allinone ã—ã°ã‚‰ãã™ã‚‹ã¨æ§‹ç¯‰ãŒå®Œäº†ã—ã¾ã™ã€‚ã‚ã¨ã¯\nhttp://${HOST_IP}/horizon/ ã«ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ WEB I/F ã§ã‚ã‚‹ Horizon ã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã„ã˜ã£ã¦ã„ãªã‘ã‚Œã°ãƒ¦ãƒ¼ã‚¶ : demo, ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ : demo ã§ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ ã¾ã™ã€‚\nå„ API ã«ã‚³ãƒãƒ³ãƒ‰ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ API ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨ã„ã‚‹ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ãŸçµ æœã€ä¸‹è¨˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚\n~/openstackrc-demo # 'demo' ãƒ¦ãƒ¼ã‚¶ã§ API ã«ã‚¢ã‚¯ã‚»ã‚¹ ~/openstackrc # 'admin' ãƒ¦ãƒ¼ã‚¶ã§ API ã«ã‚¢ã‚¯ã‚»ã‚¹ \u0026lsquo;demo\u0026rsquo; ãƒ¦ãƒ¼ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã¯\n% source ~/openstackrc-demo ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œ API ã«ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ä¾‹ ã¨ã—ã¦ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã¿ã¦ãã ã•ã„ã€‚\n% glnace image-list +--------------------------------------+---------------------+-------------+------------------+------------+--------+ | ID | Name | Disk Format | Container Format | Size | Status | +--------------------------------------+---------------------+-------------+------------------+------------+--------+ | 1a7943a5-8f8f-4c02-9763-5a6d519c31bb | Cirros 0.3.0 x86_64 | qcow2 | bare | 9761280 | active | +--------------------------------------+---------------------+-------------+------------------+------------+--------+ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ä¸€è¦§ãŒå–å¾—å‡ºæ¥ã¾ã™ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§äºˆã‚ Glance ã«ç™»éŒ²ã—ãŸ Cirros ã¨ã„ ã†å°ã•ãª OS ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒç¢ºèªå‡ºæ¥ã‚‹ã¯ãšã§ã™ã€‚\nã¾ã¨ã‚ æœ¬æ ¼çš„ãªæ§‹æˆã‚’çµ„ã‚€ã®ã§ã‚ã‚Œã°ä¸Šè¨˜ã® URL ã«ã‚‚çŸ¥ã‚‹æŒ‡å®šã‚ã‚‹è¤‡æ•°å°æ§‹æˆã‚’çµ„ã‚“ã§ã¿ã¦ ãã ã•ã„ã€‚åŒã˜ãã‚¹ã‚¯ãƒªãƒ—ãƒˆã§æ§‹ç¯‰å‡ºæ¥ã¾ã™ã€‚ã¾ãŸä»Šå›ã‹ã‚‰ Quantum ã«å®Ÿè£…ã•ã‚ŒãŸ LBaaS ã‚‚çµ„ã‚ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚æ§‹ç¯‰å‡ºæ¥ãŸ OpenStack ã§ LB ã‚’çµ„ã‚“ã§ã¿ã¦ãã  ã•ã„ã€‚LBaaS ã®èª¬æ˜ã«ã¤ã„ã¦ã¯ OpenStack ãƒ¦ãƒ¼ã‚¶ä¼šã®ä¸­å³¶ã•ã‚“ã®ãƒ–ãƒ­ã‚°ãŒå‚è€ƒã«ãªã‚Š ã¾ã™ã€‚\nhttp://aikotobaha.blogspot.jp/2013/04/use-full-function-of-openstack-grizzly.html\nLBaaS ã§çµ„ã‚ã‚‹è² è·åˆ†æ•£æ–¹å¼ãŒ \u0026lsquo;ROUND_ROBIN\u0026rsquo; ä»¥å¤–ã«ã‚‚é¸æŠå‡ºæ¥ã‚‹ã½ã„ã®ã§ã‚‚ã†å°‘ã— èª¿ã¹ãŸã‚‰ã€åƒ•ã®ãƒ–ãƒ­ã‚°ã§ã‚‚ç´¹ä»‹ã—ã‚ˆã†ã‹ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸ Grizzly ã«ãªã£ã¦æ•°å¤šãã® æ©Ÿèƒ½ãŒæ–°ãŸã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã®ã§å¼•ãç¶šãç´¹ä»‹ã—ã¦ã„ã“ã†ã‹ã¨æ€ã„ã¾ã™ã€‚\nOpenStack ã¯å¤šãã®æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã—æ§‹æˆã®ä»•æ–¹ã‚‚æ§˜ã€…ã€‚äºˆã‚ç†è§£ã—ãªã‘ã‚Œã°ã„ã‘ãªã„ æŠ€è¡“ã‚‚å¤šå²ã«ã‚ãŸã‚‹ã®ã§ãƒ–ãƒ­ã‚°ã ã‘ã§ã¯ãªã‹ãªã‹èª¬æ˜ã—åˆ‡ã‚Œãªã„ã¨ã“ã‚ã§ã™ã€‚ OpenStack ã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãŒæ›¸ã„ãŸ \u0026lsquo;OpenStack Operations Guide\u0026rsquo; ãªã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ ãŒæœ€è¿‘ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚\nhttp://docs.openstack.org/ops/\næ—¥æœ¬ã®ãƒ¦ãƒ¼ã‚¶ä¼šã§ã‚‚ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¿»è¨³ã—ã‚ˆã†ã¨ã„ã†æ´»å‹•ãŒã•ã‚Œã¦ã„ã‚‹æœ€ä¸­ã§ã™ã€‚ èˆˆå‘³ãŒã‚ã‚‹ã‹ãŸã¯ä¸€åº¦èª­ã‚€ã“ã¨ã‚’ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã™ã—ã€ã‚‚ã—æ›´ã«èˆˆå‘³ãŒæœ‰ã‚‹æ–¹ã¯ç¿»è¨³æ´»å‹• ã«å”åŠ›ã™ã‚‹ã®ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ã€‚ãƒ¦ãƒ¼ã‚¶ä¼šã® ML ã§ç¾åœ¨è©±ãŒé€²ã‚“ã§ã„ã¾ã™ã€‚\nå¼•ãç¶šãã€OpenStack ãƒã‚¿ã¯ã‚¢ãƒƒãƒ—ã—ã¦ã„ãã¾ã™ãƒ¼ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/04/20/openstack-grizzly-installation-script/","summary":"\u003cp\u003eOpenStack Grizzly ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦2é€±é–“ã»ã©çµŒéã—ã¾ã—ãŸã€‚çš†ã•ã‚“å‹•ã‹ã—ã¦ã¿ã¾ã—\nãŸã‹ï¼Ÿä»Šå›ã€æ¯åº¦ã®æ§‹ç¯‰ Bash ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’é–‹ç™ºã—ãŸã®ã§å…¬é–‹ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/jedipunkz/openstack_grizzly_install\"\u003ehttps://github.com/jedipunkz/openstack_grizzly_install\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€è¤‡æ•°å°æ§‹æˆã¨ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã®ä¸¡æ–¹ãŒæ§‹æˆå‡ºæ¥ã‚‹ã‚ˆã†ãªã£ã¦ã„ã¾\nã™ãŒã€ä»Šå›ã¯ç°¡å˜ãªã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã®çµ„ã¿æ–¹ã‚’ã‚’ç°¡å˜ã«èª¬æ˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æã®ç’°å¢ƒ\"\u003eå‰æã®ç’°å¢ƒ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eUbuntu 12.04 LTS ãŒç¨¼åƒã—ã¦ã„ã‚‹\u003c/li\u003e\n\u003cli\u003eCinder ã®ãŸã‚ã®ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ OS é ˜åŸŸã¨åˆ¥ã«ç”¨æ„ (/dev/sdb1 ãªã©)\u003c/li\u003e\n\u003cli\u003eã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã®å ´åˆã¯ 2 NICs æº–å‚™\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eUbuntu 13.04 ã® daily build ã‚‚å®Œæˆåº¦ä¸ŠãŒã£ã¦ã„ã‚‹æ™‚æœŸã§ã™ãŒ OVS å´ã®å¯¾å¿œãŒ\nOpenStack æ§‹æˆã«å•é¡Œã‚’ç”Ÿã˜ã•ã›ã‚‹ãŸã‚ 12.04 LTS + Ubuntu Cloud Archive ã®çµ„ã¿åˆ\nã‚ã›ã§æ§‹ç¯‰ã™ã‚‹ã®ãŒä¸»æµã«ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ã¾ãŸã€Cinder ç”¨ã®ãƒ‡ã‚£ã‚¹ã‚¯ã¯ OS é ˜\nåŸŸã‚’ä¿æŒã—ã¦ã„ã‚‹ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã¯åˆ¥ (ã‚‚ã—ãã¯ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã£ã¦ãƒ‡ã‚£ã‚¹ã‚¯ãƒ‡ãƒã‚¤ã‚¹\nã‚’åˆ¥ã‘ã¦ã‚‚å¯) ãŒå¿…è¦ã§ã™ã€‚ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã®å ´åˆã¯ NIC ã‚’2ã¤ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚\nã‚Šã¾ã™ã€‚é€šå¸¸ OpenStack ã‚’è¤‡æ•°å°æ§‹æˆã™ã‚‹å ´åˆã¯\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒãƒ¼ãƒ‰ x 1 å°\u003c/li\u003e\n\u003cli\u003eãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒ¼ãƒ‰ x 1 å°\u003c/li\u003e\n\u003cli\u003eã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ x n å°\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã§çµ„ã¿ã€VM ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ã‹ã‚‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒ¼ãƒ‰ã‚’ä»‹ã—ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«\næ¥ç¶šã—ã¾ã™ã€‚ã‚ˆã£ã¦ãã®ãŸã‚æ›´ã« NIC ãŒå¿…è¦ã«ãªã‚‹ã®ã§ã™ãŒã€ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã®\nå ´åˆã¯\u003c/p\u003e","title":"OpenStack Grizzly æ§‹ç¯‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ"},{"content":"chef-solo ã‚’ä½¿ã†ã®ï¼ŸChef ã‚µãƒ¼ãƒã‚’ä½¿ã†ã®ï¼Ÿã¨ã„ã†è­°è«–ã¯çµæ§‹å‰ã‹ã‚‰ã‚ã‚‹ã—ã€ç­”ãˆã¯ ã€Œãã‚Œãã‚Œã®ç’°å¢ƒæ¬¡ç¬¬ã€ã ã¨æ€ã†ã®ã ãŒã€åƒ•ã¯å€‹äººçš„ã« Chef ã‚µãƒ¼ãƒã‚’ä½¿ã£ã¦ã¾ã™ã€‚ãƒ› ã‚¹ãƒ†ãƒƒãƒ‰ Chef ã‚’ä½¿ã„ãŸã„ã‘ã©ãŠé‡‘ãªã„ã—ã€‚ä¼šç¤¾ã§å°å…¥ã™ã‚‹æ™‚ã¯ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰ Chef ã‚’å¥‘ ç´„ã—ã¦ã‚‚ã‚‰ã†ã“ã¨ã‚’ä¼ã‚“ã§ã¾ã™ã€‚(ãƒ»âˆ€ãƒ») ä½•æ•…ãªã‚‰ cookbooks ã‚’é–‹ç™ºã™ã‚‹ã“ã¨ãŒã‚¨ãƒ³ ã‚¸ãƒ‹ã‚¢ã®ä»•äº‹ã®æœ¬è³ªã§ã‚ã£ã¦ Chef ã‚µãƒ¼ãƒã‚’é‹ç”¨ç®¡ç†ã™ã‚‹ã“ã¨ã¯æœ¬è³ªã§ã¯ãªã„ã‹ã‚‰ã€‚ã ã‚Œã“ãã‚¯ãƒ©ã‚¦ãƒ‰ä½¿ãˆã¨ã„ã†è©±ã ã¨æ€ã†ã€‚\nã§ã‚‚ï¼Chef ã«æ…£ã‚Œã‚‹ã«ã¯ç„¡æ–™ã§ä½¿ã„ãŸã„ã—ã€ç¶™ç¶šçš„ã« Cookbooks ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒ¼ãƒ‰ ã§å®Ÿè¡Œã—ãŸã„ã€‚ã¨ã„ã†ã“ã¨ã§ Chef ã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ã—ã¦ä½¿ã£ã¦ã„ã¾ã™ã€‚\nChef 10 ã®æ™‚ä»£ã¯ Chef ã‚µãƒ¼ãƒã®æ§‹ç¯‰æ–¹æ³•ã¯ä¸‹è¨˜ã®é€šã‚Š3ã¤ã‚ã‚Šã¾ã—ãŸã€‚\næ‰‹ä½œæ¥­ï¼ Bootstrap æ§‹ç¯‰ Opscode ãƒ¬ãƒã‚¸ãƒˆãƒªã® Debian, Ubuntu, CentOS ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹ç¯‰ ãã‚ŒãŒ Chef 11 ã§ã¯\nUbuntu, RHEL ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ (ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ã™ã¹ã¦ç’°å¢ƒãŒæƒã†) http://www.opscode.com/chef/install/\nã“ã®æ–¹æ³•1ã¤ã ã‘ã€‚ã§ã‚‚ç°¡å˜ã«ãªã‚Šã¾ã—ãŸã€‚\n\u0026lsquo;Chef Server\u0026rsquo; ã‚¿ãƒ–ã‚’é¸æŠã™ã‚‹ã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡ºæ¥ã‚‹ã€‚ã˜ã£ãã‚Šã¯ deb ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ èº«ã‚’è¦‹ãŸã“ã¨ãŒãªã„ã‘ã©ã€ãƒãƒ©è¦‹ã—ãŸæ™‚ã« chef ã‚’ deb ã®ä¸­ã§å®Ÿè¡Œã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ ãˆãŸã€‚å¾¹åº•ã—ã¦ã‚‹ï½—\nChef 10 æ™‚ä»£ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨é•ã£ã¦è¡Œã†æ“ä½œã¯ä¸‹è¨˜ã®2ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã ã‘ã€‚\n% sudo dpkg -i chef-server_11.0.6-1.ubuntu.12.04_amd64.deb # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‚ã® % sudo chef-server-ctl reconfigure ç°¡å˜ã€‚ã§ã‚‚\u0026hellip; ã“ã®çŠ¶æ…‹ã ã¨ https://\u0026lt;ã‚µãƒ¼ãƒã® FQDN\u0026gt; ã§ã‚µãƒ¼ãƒãŒ Listen ã—ã¦ã„ã‚‹ã€‚ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‚ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã€‚ã¤ã¾ã‚Šã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Š ã«æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ãªã„ã€‚å®‰æ˜“ã« hosts ã§è§£æ±ºã‚‚å‡ºæ¥ãªã„ã€‚ä½•æ•…ãªã‚‰ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒ¼ ãƒ‰ã¯é€šå¸¸ã¾ã£ã•ã‚‰ãªçŠ¶æ…‹ãªã®ã§ bootstrap ã™ã‚‹ãŸã³ã« hosts ã‚’æ›¸ããªã‚“ã¦ã‚¢ãƒ›ã‚‰ã—ã„ ã—ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã€‚\nä»Šæ—¥ã®æœ¬é¡Œã€‚ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã« Chef 11 ã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’èª¿ã¹ã¾ã—ãŸã€‚\nä¿®æ­£ç®‡æ‰€ /var/opt/chef-server/chef-pedant/etc/pedant_config.rb URL ã‚’ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›´ã™ã‚‹ã€‚\nchef_server \u0026quot;https://chef.example.com\u0026quot; /var/opt/chef-server/erchef/etc/app.config URL ã‚’ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›´ã™ã‚‹ã€‚\n{s3_url, \u0026quot;https://chef.example.com\u0026quot;}, /var/opt/chef-server/nginx/etc/nginx.conf URL ã‚’ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›´ã™ã‚‹ã€‚2ç®‡æ‰€ã‚ã‚‹ã®ã§æ³¨æ„ã€‚éµãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚ FQDN ãŒè¨˜ã•ã‚Œ ã¦ã„ã‚‹ãŒãã‚Œã‚‰ã¯å¤‰æ›´ã—ãªã„ã€‚\nserver_name chef.example.com; /etc/chef-server/chef-server-running.json URL ã‚’ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›´ã™ã‚‹ã€‚éµãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚ FQDN ãŒè¨˜ã•ã‚Œã¦ã„ã‚‹ãŒãã‚Œã‚‰ã¯å¤‰æ›´ ã—ãªã„ã€‚\n\u0026quot;vip\u0026quot;: \u0026quot;chef.example.com\u0026quot;, \u0026quot;api_fqdn\u0026quot;: \u0026quot;chef.example.com\u0026quot;, \u0026quot;web_ui_fqdn\u0026quot;: \u0026quot;chef.example.com\u0026quot;, \u0026quot;server_name\u0026quot;: \u0026quot;chef.example.com\u0026quot;, \u0026quot;url\u0026quot;: \u0026quot;https://chef.example.com\u0026quot;, æœ€å¾Œã« Chef ã‚µãƒ¼ãƒã‚’å†èµ·å‹•ã™ã‚‹ã€‚\n% sudo chef-server-ctl restart ã¾ã¨ã‚ ä¼šç¤¾ã§ã€ã“ã®ç’°å¢ƒã‚’ä½¿ã£ã¦è‰²ã€…è©¦ã—ã¦ã„ã¾ã™ã€‚ä»Šã®ã¨ã“ã‚ä¸å…·åˆãªãå‹•ä½œã—ã¦ã„ã‚‹ã€‚å¼· å¼•ãƒ¯ã‚¶ãªã®ã§ã‚‚ã£ã¨ç¶ºéº—ãªæ–¹æ³•ã‚’çŸ¥ã£ã¦ã„ã‚‹æ–¹ãŒã„ã¾ã—ãŸã‚‰æ•™ãˆã¦ä¸‹ã•ã„ã€‚ m ( _ _ ) m\n","permalink":"https://jedipunkz.github.io/post/2013/04/06/chef-11-private-network/","summary":"\u003cp\u003echef-solo ã‚’ä½¿ã†ã®ï¼ŸChef ã‚µãƒ¼ãƒã‚’ä½¿ã†ã®ï¼Ÿã¨ã„ã†è­°è«–ã¯çµæ§‹å‰ã‹ã‚‰ã‚ã‚‹ã—ã€ç­”ãˆã¯\nã€Œãã‚Œãã‚Œã®ç’°å¢ƒæ¬¡ç¬¬ã€ã ã¨æ€ã†ã®ã ãŒã€åƒ•ã¯å€‹äººçš„ã« Chef ã‚µãƒ¼ãƒã‚’ä½¿ã£ã¦ã¾ã™ã€‚ãƒ›\nã‚¹ãƒ†ãƒƒãƒ‰ Chef ã‚’ä½¿ã„ãŸã„ã‘ã©ãŠé‡‘ãªã„ã—ã€‚ä¼šç¤¾ã§å°å…¥ã™ã‚‹æ™‚ã¯ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰ Chef ã‚’å¥‘\nç´„ã—ã¦ã‚‚ã‚‰ã†ã“ã¨ã‚’ä¼ã‚“ã§ã¾ã™ã€‚(ãƒ»âˆ€ãƒ») ä½•æ•…ãªã‚‰ cookbooks ã‚’é–‹ç™ºã™ã‚‹ã“ã¨ãŒã‚¨ãƒ³\nã‚¸ãƒ‹ã‚¢ã®ä»•äº‹ã®æœ¬è³ªã§ã‚ã£ã¦ Chef ã‚µãƒ¼ãƒã‚’é‹ç”¨ç®¡ç†ã™ã‚‹ã“ã¨ã¯æœ¬è³ªã§ã¯ãªã„ã‹ã‚‰ã€‚ã\nã‚Œã“ãã‚¯ãƒ©ã‚¦ãƒ‰ä½¿ãˆã¨ã„ã†è©±ã ã¨æ€ã†ã€‚\u003c/p\u003e\n\u003cp\u003eã§ã‚‚ï¼Chef ã«æ…£ã‚Œã‚‹ã«ã¯ç„¡æ–™ã§ä½¿ã„ãŸã„ã—ã€ç¶™ç¶šçš„ã« Cookbooks ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒ¼ãƒ‰\nã§å®Ÿè¡Œã—ãŸã„ã€‚ã¨ã„ã†ã“ã¨ã§ Chef ã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ã—ã¦ä½¿ã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eChef 10 ã®æ™‚ä»£ã¯ Chef ã‚µãƒ¼ãƒã®æ§‹ç¯‰æ–¹æ³•ã¯ä¸‹è¨˜ã®é€šã‚Š3ã¤ã‚ã‚Šã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ‰‹ä½œæ¥­ï¼\u003c/li\u003e\n\u003cli\u003eBootstrap æ§‹ç¯‰\u003c/li\u003e\n\u003cli\u003eOpscode ãƒ¬ãƒã‚¸ãƒˆãƒªã® Debian, Ubuntu, CentOS ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹ç¯‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eãã‚ŒãŒ Chef 11 ã§ã¯\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUbuntu, RHEL ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ (ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ã™ã¹ã¦ç’°å¢ƒãŒæƒã†)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"http://www.opscode.com/chef/install/\"\u003ehttp://www.opscode.com/chef/install/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã“ã®æ–¹æ³•1ã¤ã ã‘ã€‚ã§ã‚‚ç°¡å˜ã«ãªã‚Šã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003e\u0026lsquo;Chef Server\u0026rsquo; ã‚¿ãƒ–ã‚’é¸æŠã™ã‚‹ã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡ºæ¥ã‚‹ã€‚ã˜ã£ãã‚Šã¯ deb ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­\nèº«ã‚’è¦‹ãŸã“ã¨ãŒãªã„ã‘ã©ã€ãƒãƒ©è¦‹ã—ãŸæ™‚ã« chef ã‚’ deb ã®ä¸­ã§å®Ÿè¡Œã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹\nãˆãŸã€‚å¾¹åº•ã—ã¦ã‚‹ï½—\u003c/p\u003e\n\u003cp\u003eChef 10 æ™‚ä»£ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨é•ã£ã¦è¡Œã†æ“ä½œã¯ä¸‹è¨˜ã®2ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã ã‘ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% sudo dpkg -i chef-server_11.0.6-1.ubuntu.12.04_amd64.deb # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‚ã®\n% sudo chef-server-ctl reconfigure\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eç°¡å˜ã€‚ã§ã‚‚\u0026hellip; ã“ã®çŠ¶æ…‹ã ã¨ https://\u0026lt;ã‚µãƒ¼ãƒã® FQDN\u0026gt; ã§ã‚µãƒ¼ãƒãŒ Listen ã—ã¦ã„ã‚‹ã€‚\nIP ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‚ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã€‚ã¤ã¾ã‚Šã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Š\nã«æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ãªã„ã€‚å®‰æ˜“ã« hosts ã§è§£æ±ºã‚‚å‡ºæ¥ãªã„ã€‚ä½•æ•…ãªã‚‰ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒ¼\nãƒ‰ã¯é€šå¸¸ã¾ã£ã•ã‚‰ãªçŠ¶æ…‹ãªã®ã§ bootstrap ã™ã‚‹ãŸã³ã« hosts ã‚’æ›¸ããªã‚“ã¦ã‚¢ãƒ›ã‚‰ã—ã„\nã—ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã€‚\u003c/p\u003e","title":"Chef 11 ã‚µãƒ¼ãƒã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šæ§‹ç¯‰"},{"content":"ã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆå‹‰å¼·ä¼šã«å‚åŠ ã—ã¦ããŸã€‚ä»ŠãŒæ—¬ãªã®ã‹å®šå“¡140åãŒåŸ‹ã¾ã£ã¦ã„ã¾ ã—ãŸã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹å„ç¨®ã®è©±ãŒèã‘ã‚‹è²´é‡ãªå‹‰å¼·ä¼šã®å ´ã§ã—ãŸã€‚\nå ´æ‰€ : ã‚¹ã‚¯ã‚¨ã‚¢ã‚¨ãƒ‹ãƒƒã‚¯ã‚¹ã•ã‚“ æ—¥ç¨‹ : 2013å¹´4æœˆ5æ—¥ 19:00 - å°‘ã—é•·ããªã‚‹ã®ã§ã€æ—©é€Ÿã€‚\nã‚¯ãƒ©ã‚¦ãƒ‰é‹ç”¨ç®¡ç†ç ”ç©¶ä¼š ã‚¯ãƒ©ã‚¦ãƒ‰åˆ©ç”¨æ¨é€²æ©Ÿæ§‹ãŒé‹å–¶ã™ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰é‹ç”¨ç®¡ç†ç ”ç©¶ä¼šã¯ä¸‹è¨˜ã®3ã¤ã«åˆ†åˆ¥ã•ã‚Œã‚‹ã ã†ã§ã™ã€‚ä»Šå›ã¯ä¸€é …ç›®ã® \u0026lsquo;ã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«ç ”ç©¶ä¼š\u0026rsquo; ã«ã‚ãŸã‚‹ãã†ã€‚åˆ¥ã®ç ” ç©¶ä¼šã‚‚æ—¢ã«å‹‰å¼·ä¼šã‚’å®Ÿæ–½ã—ã¦ã„ã‚‹ãã†ã§ã™ã€‚\nã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«ç ”ç©¶ä¼š ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ç ”ç©¶ä¼š é‹ç”¨ç®¡ç†ãƒ»ç›£è¦–ç ”ç©¶ä¼š AWS OpsWorks ã‚¢ãƒã‚¾ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ã‚¸ãƒ£ãƒ‘ãƒ³ AWS ç‰‡å±±ã•ã‚“, èˆ¹å´ã•ã‚“ OpsWorks ã¯æœ€è¿‘è©±é¡Œã«ãªã£ãŸ AWS åˆ©ç”¨è€…ã«ç„¡æ–™ã§æä¾›ã•ã‚Œã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã€‚Web UI ã§æ“ä½œã—ç°¡å˜ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿç¾ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚\nOpsWorks ãŒè‡ªå‹•åŒ–ã™ã‚‹ãƒ¢ãƒ ã‚µãƒ¼ãƒè¨­å®š ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢æ§‹ç¯‰ ç‰¹å¾´ Chef ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’åˆ©ç”¨ (chef-solo ã‚’å†…éƒ¨çš„ã«åˆ©ç”¨) ä»»æ„ã® cookbooks ã‚’åˆ©ç”¨å¯èƒ½ LB, AP, DB ãªã©ã‚’ãƒ¬ã‚¤ãƒ¤åŒ–, ä»»æ„ã®ãƒ¬ã‚¤ãƒ¤ã‚‚ä½œæˆå¯èƒ½ OpsWorks ã®æµã‚Œ Stack ä½œæˆ ãƒ¬ã‚¤ãƒ¤ä½œæˆ (LB, AP, DB, ä»»æ„) ãƒ¬ã‚·ãƒ”ã®ä½œæˆ ãƒ¬ã‚¤ãƒ¤ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ ä¸‹è¨˜ã‚’ãƒ¬ã‚¤ãƒ¤åŒ–ã§åŒºåˆ¥ã™ã‚‹ Package ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« OS è¨­å®š ã‚¢ãƒ—ãƒªãƒ‡ãƒ—ãƒ­ã‚¤ æ‰€æ„Ÿ AWS OpsWorks ã®ç™»å ´ã§ä»–ã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ãŒã©ã†ãªã‚‹ã®ï¼Ÿã¨ã•ãˆ æ€ã£ãŸã€‚AWS ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãƒ»ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°æ¥­ç•Œã®ã‚ã‚‰ã‚†ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’æŠ¼ã•ãˆã‚ˆã†ã¨ ã—ã¦ã„ã‚‹æ„ŸãŒã‚ã‚‹ã€‚ã‚‚ã†éš™é–“ãŒãªã„ï¼ï½— OpsWorks ã«é–¢ã—ã¦ã¾ã å•é¡Œã¯æ®‹ã£ã¦ã„ã‚‹ãã† ã ã€‚VPC, micro ç¾åœ¨æœªå¯¾å¿œãªã©ã€‚ãŒè§£æ±ºã«å‘ã‘ã¦ä½œæ¥­ã—ã¦ã„ã‚‹ãã†ã€‚\nAeolus Conductor RedHat ä¸­äº•ã•ã‚“ æ¦‚è¦ è¤‡æ•°ã‚¯ãƒ©ã‚¦ãƒ‰ã«å¯¾å¿œã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç’°å¢ƒæ§‹ç¯‰ã®è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«\nã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ—ãƒ­ã‚¤æ©Ÿèƒ½ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ Red Hat CoudForms ãŒå•†ç”¨ç‰ˆ ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰ (ãƒ¦ãƒ¼ã‚¶ã«ã‚¯ãƒ©ã‚¦ãƒ‰ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹, Hybrid, EC2, RHEV) è‡ªå‹•åŒ–ã«ã¤ã„ã¦ä¸­äº•ã•ã‚“ã®æ¡ˆ (æ‰‹ä½œã‚Š) libvirt ã‚­ãƒƒã‚¯ kickstart å®Ÿè¡Œ post script ã«ã¦ puppet å®Ÿè¡Œ manifest ã¯ github ã§ç®¡ç† ã“ã‚Œã‚‰ã¯å˜ä¸€ã®ã‚µãƒ¼ãƒã®ã¿ã§å®Ÿæ–½ã§ãã¦ã€è¤‡æ•°å°æ§‹æˆç­‰ã‚’å‰æã«å‡ºæ¥ãªã„ç­‰ã®å•é¡ŒãŒã‚ ã‚‹ã€‚ãã‚Œã‚‰ã‚’è§£æ±ºã™ã‚‹ã®ãŒ Aeolus Conductorã€‚\nAeolus Conductor ã®è¦ç´  ã‚·ã‚¹ãƒ†ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”¨æ„ (XML) : OS æ§‹æˆå†…å®¹ãŒè¨˜ã•ã‚Œã¦ã„ã‚‹ ãƒã‚·ãƒ³ã‚¤ãƒ¡ãƒ¼ã‚¸ JEOS ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ–ãƒ«ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ (ã‚¢ãƒ—ãƒªãƒ‡ãƒ—ãƒ­ã‚¤è¨­è¨ˆæ›¸) shell script ã§ã‚ã‚‹ã€‚puppet, chef ã‚’å‘¼ã³å‡ºã—ã¦ã‚‚ OK. Config ã‚µãƒ¼ãƒã‚’ä»‹ã—ã¦ VM é–“ã®æ§‹æˆã‚’ç®¡ç†ã—ã¦ã„ã‚‹ : ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ãƒˆï¼ DB, Web Aeolus Conductor ã®ä¸ä¾¿ãªç‚¹ ç‰¹å®šã®ã‚¯ãƒ©ã‚¦ãƒ‰ç‰¹æœ‰ã®æ©Ÿèƒ½ã«ã¯æœªå¯¾å¿œ è¤‡æ•° VM ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å‡¦ç†ãŒä¸ååˆ† æ‰€æ„Ÿ ç”»é¢ã‚’è¦‹ã•ã›ã¦ã‚‚ã‚‰ã£ãŸãŒ AWS EC2, RHEV (RedHat ã®ä»®æƒ³åŒ–ã‚½ãƒ•ãƒˆ) ã¨ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ ãƒ‰ã«å¯¾å¿œã—ã¦ã„ãŸã€‚ãƒ¦ãƒ¼ã‚¶ã«ã©ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã‹ï¼Ÿç­‰ã®æ¨©é™å§”è­²ãŒå‡ºæ¥ã‚‹ã‚‚ã® ãƒ¦ãƒ‹ãƒ¼ã‚¯ã€‚\nScalr Scalr ãƒ¦ãƒ¼ã‚¶ä¼š æ¢¶å·ã•ã‚“ (IDC ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢) æ¦‚è¦, ç‰¹å¾´ ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰ç®¡ç†ãƒ„ãƒ¼ãƒ« åˆ©ç”¨å‡ºæ¥ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ : AWS, Eucalyptus, RackSpace, nimbula, OpenStack, \u0026hellip; å†—é•·åŒ–ãƒ»ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«å¯èƒ½ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚‚è‡ªå‹•ã§é–‹å§‹ DNS ç®¡ç†, ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«æ™‚ã€è‡ªå‹•çš„ã«ä¿®æ­£ãŒè¡Œã‚ã‚Œã‚‹ ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ (ä»»æ„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å¯èƒ½ã€ã¾ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ä½œæˆå¯èƒ½) å„ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç† (ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼Ÿ) æ‰€æ„Ÿ Scalr ãƒ¦ãƒ¼ã‚¶ä¼šã®ãƒ¡ãƒ³ãƒå‹Ÿé›†ä¸­ã ãã†ã ã€‚å€‹äººçš„ã«ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã® Scalr ã‚’è©¦ãã† ã¨æ€ã£ãŸã“ã¨ãŒã‚ã‚‹ã®ã ãŒã€æ‰‹é †ã® wiki ãŒè§£ã‚Šã¥ã‚‰ã‹ã£ãŸã€‚å•†ç”¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã‚ã›ã‚‹ ãŸã‚ã«ã‚ã–ã¨è§£ã‚Šã¥ã‚‰ãã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿã¨æ€ã†ã»ã©ã€‚ãƒ¦ãƒ¼ã‚¶æ‹¡å¤§ã®ãŸã‚ã«æ˜¯éãƒ‰ã‚­ãƒ¥ãƒ¡ ãƒ³ãƒˆã®æ•´å‚™ã‚’ãŠé¡˜ã„ã—ãŸã„ã€‚\nRightScale ã®åˆ©ç”¨åŠ¹æœã¨è‹¦åŠ´è©± So-net ã‚¨ãƒ³ã‚¿ãƒ†ã‚¤ãƒ³ãƒ¡ãƒ³ãƒˆ æˆç”°ã•ã‚“ åˆ©ç”¨åŠ¹æœ 1ã¤ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¤‡æ•°å°ã«å¯¾ã—ã¦å®Ÿè¡Œå¯èƒ½ æ‰‹ä½œæ¥­ãŒè‡ªå‹•åŒ–ã¸ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®åˆ©ç”¨ãŒå¯èƒ½ã« ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã®è‡ªå‹•åŒ–ã¸ ã‚µãƒ¼ãƒå°æ•°ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°åŒ– ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã¯ãƒã‚¯ãƒ­ã§ä½œæˆ æ¨©é™åˆ†é›¢ã«ã‚ˆã‚‹é–‹ç™ºè€…ãƒ»ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µã«å½¹å‰²ç§»è­² å±¥æ­´ç®¡ç†ã®è‡ªå‹•è¨˜éŒ² chef recipe ãŒ right ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ã—ã¦èµ°ã‚‰ã›ã‚‰ã‚Œã‚‹ è‹¦åŠ´è©± Alert è¨­å®šã®ãƒŸã‚¹ã§ãƒ¡ãƒ¼ãƒ«å¤§é‡å—ä¿¡ è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚¨ãƒ©ãƒ¼å¯¾å¿œ è¨ˆç”»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®å¾Œã¯è¦æ³¨æ„ (ä»•æ§˜å¤‰æ›´) RightScale ä¸Šã®è¡¨ç¤ºã‚’éä¿¡ã—ãªã„, è©³ã—ãã¯ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹å´ã‚’ç¢ºèª LANG=ja_JP.UTF-8 ã™ã‚‹ã¨ã‚³ã‚±ã‚‹ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯é‡‘æ›œæ—¥æ—¥ä¸­ (æœˆã«ä¸€å›) æ‰€æ„Ÿ å®Ÿéš›ã«é‹ç”¨ã—ã¦ã„ã‚‹æ–¹ã®è©±ã¯ã¨ã¦ã‚‚è²´é‡ã€‚ç‰¹ã«è‹¦åŠ´ãƒã‚¿ã¯ãªã‹ãªã‹çŸ¥ã‚‹ã“ã¨ãŒå‡ºæ¥ãªã„ ã®ã§ã€‚è‡ªå‹•åŒ–ã®ãŸã‚ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ãã®ãŒã‚¤ãƒ³ãƒ•ãƒ©ç³»ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ä»•äº‹ã«ãªã‚‹ã¨çŸ¥ã‚‰ ã›ã¦ãã‚ŒãŸã€‚Right ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã¯ Chef ã®ãƒ¬ã‚·ãƒ”ã‚‚èµ°ã‚‰ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã€ã¨ã„ã†ã‚‚ ãŒé­…åŠ›ã€‚ã¾ãŸã‚¤ãƒ³ãƒ•ãƒ©ç³»ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ä»¥å¤–ã®è·ç¨®ã®äººã«ã‚‚æ¨©é™å§”è­²ã— UI ã‚’æ“ä½œã—ã¦ã‚‚ã‚‰ ãˆã‚‹è¾ºã‚Šã¯ã€æ¥­å‹™ã®æœ€é©åŒ–ã®ãŸã‚ã«å¤§ã„ã«åˆ©ç”¨ã§ãã‚‹ã¨æ„Ÿã˜ãŸã€‚\nChef ã®è©± Engine Yard @yando ã•ã‚“ Engine Yard ã¨ã¯ PaaS AWS + Chef + ã‚µãƒãƒ¼ãƒˆ, ç›£è¦– chef-solo ã‚’ã‚­ãƒƒã‚¯ chef recipe ã®ç®¡ç†ã¯ Engine Yard ãŒè¡Œã† Chef ã¸ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ å†ªç­‰æ€§ ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã ã¨æ§‹ç¯‰ç›´å¾Œã®çŠ¶æ…‹ã—ã‹ä¿è¨¼ã•ã‚Œãªã„ chef-solo ã®è©± knife-solo ã§ãƒãƒ¼ãƒ‰ã« SSH ã›ãšã«å®Ÿè¡Œ åˆ©ç”¨ã™ã‚‹ã«ã‚ãŸã£ã¦ç›´é¢ã™ã‚‹èª²é¡Œ ãƒ¬ã‚·ãƒ”ã®å®Ÿè£… -\u0026gt; github ä¸Šã®ãƒ¬ã‚·ãƒ”ã‚’å‚ç…§ãƒ»åˆ©ç”¨ Vagrant ã®åˆ©ç”¨ã§ãƒ¬ã‚·ãƒ”ã®è¤‡æ•°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¸Šã§ã®ãƒ†ã‚¹ãƒˆ ãƒ¬ã‚·ãƒ”ã®é…å¸ƒæ–¹æ³• -\u0026gt; github, berkshelf, knife solo, nfs, chef-server ãƒ¬ã‚·ãƒ”ã®åæ˜  -\u0026gt; capistrano, chef-client, cron Engine Yard Local ã‚¯ãƒ©ã‚¦ãƒ‰ã¨åŒã˜ãƒ¬ã‚·ãƒ”ã§ãƒ­ãƒ¼ã‚«ãƒ«ã«é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰å‡ºæ¥ã‚‹ãƒ„ãƒ¼ãƒ« ã‚¯ãƒ©ã‚¦ãƒ‰ã¯ã‚³ã‚¹ãƒˆãŒæ›ã‹ã‚‹ã—é…ã„ã®ã§å‡ºæ¥ã‚‹äº‹ãªã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ã§ã€ã¨ã„ã†ç™ºæƒ³ æ‰€æ„Ÿ Chef æµè¡Œã£ã¦ã¾ã™ã­ã€‚ã†ã‚“ã†ã‚“ã€(ãƒ»âˆ€ãƒ»)ï½²ï½²!! å€‹äººçš„ã«ã¯ Chef ã® Cookbooks é–‹ç™º ã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã—ã¦ã‚‚ã‚‰ã„ãŸã„ã€‚Engine Yard ã®ã‚ˆã†ãª PaaS ä½¿ã†ãªã‚‰ã‚¢ãƒ¬ã  ã‘ã©ã‚¯ãƒ©ã‚¦ãƒ‰ä½¿ã†ãªã‚‰é‹ç”¨ã¯å¼•ãç¶šãå¿…è¦ã ã—ã€é‹ç”¨ã‚’æ„è­˜ã—ãŸ Cookbooks é–‹ç™ºã¯çµ¶ å¯¾ã«å¿…è¦ã«ãªã£ã¦ãã‚‹ã‹ã‚‰ã ã€‚Chef ã®é–¢é€£æŠ€è¡“ãŒã‚‚ã®ã™ã”ã„ã‚¹ãƒ”ãƒ¼ãƒ‰ã§é€²åŒ–ã—ã¦ã„ã‚‹ ã®ã‚‚é­…åŠ›ã€‚ã‚ˆã‚Šä¾¿åˆ©ã§æ—¬ãªæŠ€è¡“ã‚’ã™ãã«åˆ©ç”¨ã—è²¢çŒ®ã™ã‚‹ã€ã¨ã„ã†è‰¯ã„ã‚µã‚¤ã‚¯ãƒ«ã‚’ã†ã¡ã® ä¼šç¤¾ã§ã‚‚å®Ÿç¾ã—ãŸã„ã€‚ã ã£ã¦æ¥½ã—ã„ã‹ã‚‰ã€‚chef-solo ä½¿ã†ã®ï¼Ÿchef ã‚µãƒ¼ãƒä½¿ã†ã®ï¼Ÿã¨ ã„ã†è©±ã¯ã“ã“ã§ã‚‚æŒ™ãŒã£ã¦ãŸã€‚ã©ã“ã‹ã§ãƒ–ãƒ­ã‚°ã«ã—ã‚ˆã†ã‹ãªã€‚åƒ•ã¯ chef ã‚µãƒ¼ãƒä½¿ã‚ãª ã„ç†ç”±ãŒãªã„ã¨æ€ã£ã¦ã‚‹ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/04/06/cloudmanagement/","summary":"\u003cp\u003eã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆå‹‰å¼·ä¼šã«å‚åŠ ã—ã¦ããŸã€‚ä»ŠãŒæ—¬ãªã®ã‹å®šå“¡140åãŒåŸ‹ã¾ã£ã¦ã„ã¾\nã—ãŸã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹å„ç¨®ã®è©±ãŒèã‘ã‚‹è²´é‡ãªå‹‰å¼·ä¼šã®å ´ã§ã—ãŸã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eå ´æ‰€ : ã‚¹ã‚¯ã‚¨ã‚¢ã‚¨ãƒ‹ãƒƒã‚¯ã‚¹ã•ã‚“\næ—¥ç¨‹ : 2013å¹´4æœˆ5æ—¥ 19:00 -\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eå°‘ã—é•·ããªã‚‹ã®ã§ã€æ—©é€Ÿã€‚\u003c/p\u003e\n\u003ch2 id=\"ã‚¯ãƒ©ã‚¦ãƒ‰é‹ç”¨ç®¡ç†ç ”ç©¶ä¼š\"\u003eã‚¯ãƒ©ã‚¦ãƒ‰é‹ç”¨ç®¡ç†ç ”ç©¶ä¼š\u003c/h2\u003e\n\u003cp\u003eã‚¯ãƒ©ã‚¦ãƒ‰åˆ©ç”¨æ¨é€²æ©Ÿæ§‹ãŒé‹å–¶ã™ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰é‹ç”¨ç®¡ç†ç ”ç©¶ä¼šã¯ä¸‹è¨˜ã®3ã¤ã«åˆ†åˆ¥ã•ã‚Œã‚‹ã\nã†ã§ã™ã€‚ä»Šå›ã¯ä¸€é …ç›®ã® \u0026lsquo;ã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«ç ”ç©¶ä¼š\u0026rsquo; ã«ã‚ãŸã‚‹ãã†ã€‚åˆ¥ã®ç ”\nç©¶ä¼šã‚‚æ—¢ã«å‹‰å¼·ä¼šã‚’å®Ÿæ–½ã—ã¦ã„ã‚‹ãã†ã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«ç ”ç©¶ä¼š\u003c/li\u003e\n\u003cli\u003eãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ç ”ç©¶ä¼š\u003c/li\u003e\n\u003cli\u003eé‹ç”¨ç®¡ç†ãƒ»ç›£è¦–ç ”ç©¶ä¼š\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"aws-opsworks\"\u003eAWS OpsWorks\u003c/h1\u003e\n\u003cpre\u003e\u003ccode\u003eã‚¢ãƒã‚¾ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ã‚¸ãƒ£ãƒ‘ãƒ³ AWS ç‰‡å±±ã•ã‚“, èˆ¹å´ã•ã‚“\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOpsWorks ã¯æœ€è¿‘è©±é¡Œã«ãªã£ãŸ AWS åˆ©ç”¨è€…ã«ç„¡æ–™ã§æä¾›ã•ã‚Œã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§\nãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã€‚Web UI ã§æ“ä½œã—ç°¡å˜ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿç¾ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"opsworks-ãŒè‡ªå‹•åŒ–ã™ã‚‹ãƒ¢ãƒ\"\u003eOpsWorks ãŒè‡ªå‹•åŒ–ã™ã‚‹ãƒ¢ãƒ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eã‚µãƒ¼ãƒè¨­å®š\u003c/li\u003e\n\u003cli\u003eãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢æ§‹ç¯‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ç‰¹å¾´\"\u003eç‰¹å¾´\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eChef ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’åˆ©ç”¨ (chef-solo ã‚’å†…éƒ¨çš„ã«åˆ©ç”¨)\u003c/li\u003e\n\u003cli\u003eä»»æ„ã® cookbooks ã‚’åˆ©ç”¨å¯èƒ½\u003c/li\u003e\n\u003cli\u003eLB, AP, DB ãªã©ã‚’ãƒ¬ã‚¤ãƒ¤åŒ–, ä»»æ„ã®ãƒ¬ã‚¤ãƒ¤ã‚‚ä½œæˆå¯èƒ½\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"opsworks-ã®æµã‚Œ\"\u003eOpsWorks ã®æµã‚Œ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eStack ä½œæˆ\u003c/li\u003e\n\u003cli\u003eãƒ¬ã‚¤ãƒ¤ä½œæˆ (LB, AP, DB, ä»»æ„)\u003c/li\u003e\n\u003cli\u003eãƒ¬ã‚·ãƒ”ã®ä½œæˆ\u003c/li\u003e\n\u003cli\u003eãƒ¬ã‚¤ãƒ¤ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ä¸‹è¨˜ã‚’ãƒ¬ã‚¤ãƒ¤åŒ–ã§åŒºåˆ¥ã™ã‚‹\"\u003eä¸‹è¨˜ã‚’ãƒ¬ã‚¤ãƒ¤åŒ–ã§åŒºåˆ¥ã™ã‚‹\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePackage ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/li\u003e\n\u003cli\u003eOS è¨­å®š\u003c/li\u003e\n\u003cli\u003eã‚¢ãƒ—ãƒªãƒ‡ãƒ—ãƒ­ã‚¤\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"æ‰€æ„Ÿ\"\u003eæ‰€æ„Ÿ\u003c/h2\u003e\n\u003cp\u003eAWS OpsWorks ã®ç™»å ´ã§ä»–ã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ãŒã©ã†ãªã‚‹ã®ï¼Ÿã¨ã•ãˆ\næ€ã£ãŸã€‚AWS ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãƒ»ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°æ¥­ç•Œã®ã‚ã‚‰ã‚†ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’æŠ¼ã•ãˆã‚ˆã†ã¨\nã—ã¦ã„ã‚‹æ„ŸãŒã‚ã‚‹ã€‚ã‚‚ã†éš™é–“ãŒãªã„ï¼ï½— OpsWorks ã«é–¢ã—ã¦ã¾ã å•é¡Œã¯æ®‹ã£ã¦ã„ã‚‹ãã†\nã ã€‚VPC, micro ç¾åœ¨æœªå¯¾å¿œãªã©ã€‚ãŒè§£æ±ºã«å‘ã‘ã¦ä½œæ¥­ã—ã¦ã„ã‚‹ãã†ã€‚\u003c/p\u003e","title":"ã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆå‹‰å¼·ä¼šãƒ¬ãƒ"},{"content":"ã‚‚ã†æ•°æ—¥ã§ OpenStack ã®æ¬¡æœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ç‰ˆ Grizzly ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã ãŒ ç¾è¡Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ Folsom ã® OpenStack ã®ä¸Šã« NetBSD ã‚’è¼‰ã›ã¦ã¿ãŸã€‚å®Œå…¨ã«ãŠéŠã³ ã ã‘ã©\u0026hellip;ã€‚\nçµå±€ã€ã»ã¨ã‚“ã©ä½•ã‚‚ç‰¹åˆ¥ãªå¯¾å¿œå–ã‚‹ã“ã¨ãªã NetBSD ãŒå‹•ã„ãŸã€‚ã‚‚ã¡ã‚ã‚“ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ ã‚¶ã¯ KVM ã§ã™ã€‚ã ã‘ã©å°‘ã—æ¡ä»¶ãŒã‚ã‚‹ã€‚\nqemu ã®ä¸å…·åˆãŒã‚ã‚Š Ubuntu 12.04 LTS + Ubuntu Cloud Archives ã®çµ„ã¿åˆã‚ã›ã§ã¯ NetBSD ãŒå‹•ä½œã—ãªã‹ã£ãŸã€‚ä¸‹è¨˜ã®ã‚ˆã†ãªã‚«ãƒ¼ãƒãƒ«ãƒ‘ãƒ‹ãƒƒã‚¯ãŒç™ºç”Ÿã€‚\npanic: pci_make_tag: bad request ã“ã®ä¸å…·åˆã«ç›¸å½“ã™ã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ã¨æ€ã£ã¦ã‚‹ã€‚\nhttps://bugs.launchpad.net/qemu/+bug/897771\nã‚ˆã£ã¦ä¸‹è¨˜ã®çµ„ã¿åˆã‚ã›ã§å‹•ä½œã‚’ç¢ºèªã—ãŸã€‚\nUbuntu 12.10 + OpenStack (Native Packages) qemu, kvm : 1.2.0+noroms-0ubuntu2.12.10.3 NetBSD 6.1 RC2 amd64 å‰ææ¡ä»¶ OpenStack Folsom ãŒå‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã€‚\nNetBSD OS ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆ nova-compute ãŒå‹•ä½œã—ã¦ã„ã‚‹ãƒ›ã‚¹ãƒˆã® qemu-kvm ã‚’åˆ©ç”¨ã™ã‚‹ã€‚OpenStack ä¸Šã«ä½•ã§ã‚‚ è‰¯ã„ã®ã§ OS ã‚’å‹•ä½œã•ã›ã“ã® kvm ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‚è€ƒã« kvm ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ ã— NetBSD ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã›ãŸã€‚ä¸€ç•ªç¢ºå®Ÿãªæ–¹æ³•ã€‚\n% cd ~/ % wget http://ftp.netbsd.org/pub/NetBSD/iso/6.1_RC2/NetBSD-6.1_RC2-amd64.iso % kvm-img create -f qcow2 netbsd.img 5G % /usr/bin/kvm -M pc-1.0 -cpu \\ core2duo,+lahf_lm,+rdtscp,+hypervisor,+avx,+osxsave,+save,+aes,+popcnt,+sse4.2,+sse4.1,+cx16,+vmx,+pclmuldq,+ht,+ss,+ds \\ -enable-kvm -m 512 -smp 1,sockets=1,cores=1,threads=1 -device piix3-usb-uhci,id=usb,bus=pci.0,addr=0x1.0x2 \\ -drive file=~/netbsd.img,if=none,id=drive-virtio-disk0,format=qcow2,cache=none \\ -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x4,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 \\ -net nic,model=virtio -vnc :9 -cdrom ~/NetBSD-6.1_RC2-amd64.iso VNC :9 ã«æ¥ç¶šã—ã¦ NetBSD ã‚’æ™®é€šã«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒçµ‚ã‚ã£ãŸã‚‰ CDROM ãƒ‡ãƒã‚¤ã‚¹ã‚’å¤–ã—ã¦èµ·å‹•ã€‚\n% core2duo,+lahf_lm,+rdtscp,+hypervisor,+avx,+osxsave,+save,+aes,+popcnt,+sse4.2,+sse4.1,+cx16,+vmx,+pclmuldq,+ht,+ss,+ds \\ -enable-kvm -m 512 -smp 1,sockets=1,cores=1,threads=1 -device piix3-usb-uhci,id=usb,bus=pci.0,addr=0x1.0x2 \\ -drive file=~/netbsd.img,if=none,id=drive-virtio-disk0,format=qcow2,cache=none \\ -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x4,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 \\ -net nic,model=virtio -vnc :9 VNC :9 ã«æ¥ç¶šã—ä¸‹è¨˜ã®æ“ä½œã‚’è¡Œã†ã€‚\nvioif0 ã¨ã„ã† virtio ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒèµ·å‹•ã™ã‚‹ã®ã§ä¸‹è¨˜ã®ã‚ˆã†ã« è¿½è¨˜ã™ã‚‹ã€‚\n# vi /etc/rc.conf # ä¸‹è¨˜ã‚’è¿½è¨˜ ifconfig_vioif0=dhcp sshd=YES OpenStack ã® metadata server ã‹ã‚‰ nova ã®ç®¡ç†ã™ã‚‹ã‚­ãƒ¼ãƒšã‚¢éµã‚’å–å¾—ã— authorized_keys ã«é…ç½®ã™ã‚‹æ§˜ã€/etc/rc.local ã«è¿½è¨˜ã™ã‚‹ã€‚curl ã¨ã‹ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ« ã¯ã‚‚ã¡ã‚ã‚“ï¼å…¥ã£ã¦ã„ãªã„ã®ã§ ftp ã‚³ãƒãƒ³ãƒ‰ã§ãªã‚“ã¨ã‹ã™ã‚‹ã€‚\n# vi /etc/rc.local # ä¸‹è¨˜ã‚’è¿½è¨˜ if [ ! -d /root/.ssh ]; then mkdir -p /root/.ssh fi echo \u0026gt;\u0026gt; /root/.ssh/authorized_keys cd /tmp ftp http://169.254.169.254/latest/meta-data/public-keys/0/openssh-key cat openssh-key | grep \u0026#39;ssh-rsa\u0026#39; \u0026gt;\u0026gt; /root/.ssh/authorized_keys echo \u0026#34;AUTHORIZED_KEYS:\u0026#34; echo \u0026#34;*********************\u0026#34; cat /root/.ssh/authorized_keys echo \u0026#34;*********************\u0026#34; nova ã®ã‚­ãƒ¼ãƒšã‚¢ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã„ã®ã§ sshd ã¯ root ãƒ¦ãƒ¼ã‚¶ã§ãƒ­ã‚°ã‚¤ãƒ³å‡ºæ¥ã‚‹ã‚ˆã†ã« ä¿®æ­£è¡Œã†ã€‚\n# vi /etc/ssh/sshd_config PermitRootLogin yes OS ã‚’ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆã¯çµ‚ã‚ã‚Šã€‚\nGlance ã¸ç™»éŒ² netbsd.img ã‚’ Glance ã«æ¥ç¶šã§ãã‚‹ãƒ›ã‚¹ãƒˆã¸ç§»å‹•ã—ã‚¤ãƒ¡ãƒ¼ã‚¸ç™»éŒ²ã‚’è¡Œã†ã€‚\n% glance add name=\u0026quot;NetBSD 6.1 RC2 amd64\u0026quot; is_public=true \\ container_format=ovf disk_format=qcow2 \u0026lt; ~/netbsd.img ã¾ã¨ã‚ ä½•ã‚‚æ‰‹ã‚’åŠ ãˆã¦ã„ãªã„\u0026hellip;ã€‚NetBSD 6.1 ã¯æœ€åˆã‹ã‚‰ Virtio ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã®ã§ä½• ã‚‚è€ƒãˆã‚‹ã“ã¨ãªãã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆãŒå‡ºæ¥ãŸã€‚ã‚³ãƒ„ã¯ nova-compute ãŒå®Ÿéš›ã«å‹•ä½œã—ã¦ã„ã‚‹ ãƒ›ã‚¹ãƒˆã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã‚‹ã“ã¨ã€‚ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ã® OS ãŒè‹¥å¹²å¤ã„ãƒ›ã‚¹ãƒˆã§ã‚‚ä½œæ¥­ã—ã¦ã¿ ãŸã®ã ãŒã€OpenStack ã«è¼‰ã›ãŸé€”ç«¯ã‚«ãƒ¼ãƒãƒ«ãƒ‘ãƒ‹ãƒƒã‚¯ã«é™¥ã£ãŸã€‚Qemu ã¯ã‚‚ã®ã™ã”ã„ã‚¹ ãƒ”ãƒ¼ãƒ‰ã§é€²åŒ–ã—ã¦ã„ã‚‹ã®ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å·®ç•°ã¯è‡´å‘½çš„ã§ã‚ã‚‹ã¨å…±ã«ã€æ—¥ã«æ—¥ã«å¿«é©ãªç’° å¢ƒãŒæ•´ã£ã¦ãã¦ã„ã‚‹ã¨ã‚‚è¨€ãˆã‚‹ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/03/28/netbsd-on-openstack/","summary":"\u003cp\u003eã‚‚ã†æ•°æ—¥ã§ OpenStack ã®æ¬¡æœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ç‰ˆ Grizzly ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã ãŒ\nç¾è¡Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ Folsom ã® OpenStack ã®ä¸Šã« NetBSD ã‚’è¼‰ã›ã¦ã¿ãŸã€‚å®Œå…¨ã«ãŠéŠã³\nã ã‘ã©\u0026hellip;ã€‚\u003c/p\u003e\n\u003cp\u003eçµå±€ã€ã»ã¨ã‚“ã©ä½•ã‚‚ç‰¹åˆ¥ãªå¯¾å¿œå–ã‚‹ã“ã¨ãªã NetBSD ãŒå‹•ã„ãŸã€‚ã‚‚ã¡ã‚ã‚“ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤\nã‚¶ã¯ KVM ã§ã™ã€‚ã ã‘ã©å°‘ã—æ¡ä»¶ãŒã‚ã‚‹ã€‚\u003c/p\u003e\n\u003cp\u003eqemu ã®ä¸å…·åˆãŒã‚ã‚Š Ubuntu 12.04 LTS + Ubuntu Cloud Archives ã®çµ„ã¿åˆã‚ã›ã§ã¯\nNetBSD ãŒå‹•ä½œã—ãªã‹ã£ãŸã€‚ä¸‹è¨˜ã®ã‚ˆã†ãªã‚«ãƒ¼ãƒãƒ«ãƒ‘ãƒ‹ãƒƒã‚¯ãŒç™ºç”Ÿã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003epanic: pci_make_tag: bad request\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã“ã®ä¸å…·åˆã«ç›¸å½“ã™ã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ã¨æ€ã£ã¦ã‚‹ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://bugs.launchpad.net/qemu/\u0026#43;bug/897771\"\u003ehttps://bugs.launchpad.net/qemu/+bug/897771\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã‚ˆã£ã¦ä¸‹è¨˜ã®çµ„ã¿åˆã‚ã›ã§å‹•ä½œã‚’ç¢ºèªã—ãŸã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUbuntu 12.10 + OpenStack (Native Packages)\u003c/li\u003e\n\u003cli\u003eqemu, kvm : 1.2.0+noroms-0ubuntu2.12.10.3\u003c/li\u003e\n\u003cli\u003eNetBSD 6.1 RC2 amd64\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å‰ææ¡ä»¶\"\u003eå‰ææ¡ä»¶\u003c/h2\u003e\n\u003cp\u003eOpenStack Folsom ãŒå‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã€‚\u003c/p\u003e\n\u003ch2 id=\"netbsd-os-ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆ\"\u003eNetBSD OS ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆ\u003c/h2\u003e\n\u003cp\u003enova-compute ãŒå‹•ä½œã—ã¦ã„ã‚‹ãƒ›ã‚¹ãƒˆã® qemu-kvm ã‚’åˆ©ç”¨ã™ã‚‹ã€‚OpenStack ä¸Šã«ä½•ã§ã‚‚\nè‰¯ã„ã®ã§ OS ã‚’å‹•ä½œã•ã›ã“ã® kvm ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‚è€ƒã« kvm ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ\nã— NetBSD ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã›ãŸã€‚ä¸€ç•ªç¢ºå®Ÿãªæ–¹æ³•ã€‚\u003c/p\u003e","title":"NetBSD on OpenStack"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä»Šæ—¥ã¯ Chef Cookbook ã®ç®¡ç†ã‚’ã—ã¦ãã‚Œã‚‹ Berkshelf ã«ã¤ã„ã¦ã€‚\nBerkshelf ã¯ Librarian-Chef ã¨åŒã˜ã Cookbook ã®ç®¡ç†ã‚’ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ä¾ å­˜é–¢ä¿‚ã®ã‚¯ãƒªã‚¢ã‚‚ã—ã¦ãã‚Œã¾ã™ã€‚Opscode ã®ä¸­ã®äºº @someara ã•ã‚“ã«ã“ã‚“ãªã“ã¨è¨€ã‚ã‚Œ ã¦ã€\n@jedipunkz berkshelf \u0026gt; librarian-chef\n\u0026mdash; somearaã•ã‚“ (@someara) 2013å¹´2æœˆ5æ—¥ Librarian-chef ã˜ã‚ƒãªãã¦ Berkshelf ä½¿ãˆã£ã¦ã“ã¨ã ã‚ã†ãªãã¨æ€ã£ãŸã®ã§åƒ•ã¯ Bekshelf ã‚’ä½¿ã†ã‚ˆã†ã«ã—ã¦ã¾ã™ã€‚å…ˆæ—¥ãƒ–ãƒ­ã‚°è¨˜äº‹ã«ã—ãŸ openstack-chef-repo ã‚‚ä»¥å‰ ã¯ Librarian-chef ã‚’ä½¿ã£ã¦ã„ãŸã®ã§ã™ãŒæœ€è¿‘ Berkshelf ã«ç½®ãæ›ã‚ã‚Šã¾ã—ãŸã€‚ openstack-chef-repo ã¯ Opscode ã®ä¸­ã®äººã® @mattray ã•ã‚“é”ãŒç®¡ç†ã—ã¦ã„ã¾ã™ã€‚\nã§ã¯æ—©é€Ÿã€‚\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ç°¡å˜ã€‚gem install ã™ã‚‹ã ã‘ã§ã™ã€‚\n% gem install berkshelf ä½¿ã„æ–¹ chef-repo é…ä¸‹ã§ Berksfile ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«æ›¸ãã¾ã™ã€‚\nsite :opscode cookbook 'chef-client' cookbook 'nginx', '= 0.101.2' berks ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ Cookbooks ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\n% export BERKSHELF_PATH=/Users/jedipunkz/chef-repo % berks install ãã‚Œãã‚Œä¾å­˜é–¢ä¿‚ã®ã‚ã‚‹ Cookbook é”ã‚‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã§ã„ã¡ã„ã¡ä¾å­˜ã‚’ è§£æ±ºã—ã¤ã¤ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãªã‚“ã¦ã“ã¨ã‚‚ã—ãªãã¦æ¸ˆã‚€ã€‚\nã“ã“ã§è¨€ãˆã‚‹ã®ã¯ chef-repo ã¨ã“ã® Berksfile ã ã‘ git ç­‰ã§ç®¡ç†ã™ã‚Œã°è‰¯ã„ã¨ã„ã† ã“ã¨ã€‚Cookbooks é”ã¯ãã‚Œãã‚Œåˆ¥ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã« git ã§ç®¡ç†ã™ã‚‹å½¢ãŒè‰¯ã„ã¨æ€ã†ã€‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ chef ã‚’ä½¿ã£ã¦ã„ã¦ chef-repo ã”ã¨ç®¡ç†ã—ãŒã¡ã ã¨æ€ã†ã‘ã©ã€ã“ã®æ–¹ ãŒ Cookbook ã‚’ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚ä½¿ã„ã¾ã‚ã›ã‚‹ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹ã€‚\nopscode ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ç®¡ç†å¤–ã® Cookbooks è‡ªåˆ†ã§ç®¡ç†ã—ã¦ã„ã‚‹ cookbook ç­‰ã‚‚ Berkshelf ã§ç®¡ç†å‡ºæ¥ã¾ã™ã€‚ä¸‹è¨˜ã®ã‚ˆã†ã«æ›¸ãã¨ã€\nsite : opscode cookbook 'chef-client' cookbook 'nginx', '= 0.101.2' cookbook \u0026quot;pxe_install_server\u0026quot;, git: 'https://github.com/jedipunkz/pxe_install_server' github ã‹ã‚‰ç›´æ¥ git clone ã‚’ã—ã¦ãã‚Œã¾ã™ã€‚\nCookbooks ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ Cookbook ã¯ç‹¬ç«‹ã—ãŸ git ãƒ¬ãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã™ã‚‹ã¨è‰¯ã„ã¨æ›¸ãã¾ã—ãŸãŒã€ãã‚Œãã‚Œã® Cookbooks ã¯è‡ªåˆ†ãŒè‹¥ã—ãã¯ä»–äººãŒé–‹ç™ºãŒé€²ã‚€ã®ã§ berks ã‚’ä½¿ã£ã¦æœ€æ–°ã® Cookbooks ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚‚å‡ºæ¥ã‚‹ã€‚\n% berks update ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š Cookbook ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šã‚‚ã‚‚ã¡ã‚ã‚“å‡ºæ¥ã‚‹ã€‚å…ˆã®ä¾‹ã§ã¯\ncookbook 'nginx', '= 0.101.2' ã§ã¯ 0.101.2 ã¨è¨€ã†ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ãŸã€‚ãã®ä»–\nEqual to (=) Greater than (\u0026gt;) Greater than equal to (\u0026lt;) Less than (\u0026lt;) Less than equal to (\u0026lt;=) Pessimistic (~\u0026gt;) ãŒæŒ‡å®šå‡ºæ¥ã‚‹ã‚ˆã†ã ã€‚\nã¾ã¨ã‚ Cookbooks ã®ç®¡ç†ã¯ä»Šã®ã¨ã“ã‚ Berkshelf ã ã‘ã§ OKã€‚ç´¹ä»‹ã—ãŸã‚‚ã®ä»¥å¤–ã«ã‚‚å¹¾ã¤ã‹æ©Ÿ èƒ½ãŒã‚ã‚‹ã®ã§å…¬å¼ã®ã‚µã‚¤ãƒˆã§ç¢ºèªã—ã¦ã¿ã¦æ¬²ã—ã„ã€‚å€‹äººçš„ã«ã¯ path: æŒ‡å®šãŒ Berksfile ã§å‡ºæ¥ãªã„ã®ãŒä¸ä¾¿ã€‚å…¬å¼ã®ã‚µã‚¤ãƒˆã«ã¯ä¸€å¿œè¨˜è¿°ã‚ã‚‹ã®ã ãŒå‹•ã‹ãªã‹ã£ãŸã€‚ ãã®ã†ã¡æ”¹å–„ã•ã‚Œã‚‹ã ã‚ã†ã€‚ã¾ãŸ Chef ã‚µãƒ¼ãƒã« Cookbooks ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ©Ÿèƒ½ ã‚‚ã‚ã‚‹ãŒã€ã¾ãã“ã‚Œã¯ knife ã§ã‚‚å‡ºæ¥ã‚‹ã—ã„ã„ã‹ã€‚ä¸€ç•ªæ¬²ã—ã‹ã£ãŸã®ã¯ \u0026lsquo;ä¾å­˜é–¢ä¿‚ã® ã‚¯ãƒªã‚¢\u0026rsquo; ã ã£ãŸã®ã§ã€‚ã¾ãŸ Berksfile, Berksfile.lock ã®ãƒ•ã‚¡ã‚¤ãƒ«ã•ãˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ã§ç®¡ç†ã™ã‚Œã°è‰¯ã„ã¨è¨€ã†ã®ãŒå€‹äººçš„ã«ã¯ç¶ºéº—ã«ãªã‚‹ãªãã¨ã„ã†å°è±¡ã€‚\næ˜”ã€Linux ã® rpm ã‚³ãƒãƒ³ãƒ‰ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¥ã‚Œã¦ã¦ä¾å­˜é–¢ä¿‚ã«ã‚ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚³ãƒ ãƒ³ãƒ‰æ‰“ã¤ãŸã³ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦\u0026hellip;ã¨è¨€ã†å•é¡Œã‚’ yum ãŒè§£æ±ºã—ã¦ãã‚Œã¦ã€‚ãã‚Œã«ä¼¼ã¦ ã‚‹ãªãã¨è¦‹ã¦ã„ã¦æ€ã£ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/03/17/berkshelf-chef-cookbook-manage/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šæ—¥ã¯ Chef Cookbook ã®ç®¡ç†ã‚’ã—ã¦ãã‚Œã‚‹ Berkshelf ã«ã¤ã„ã¦ã€‚\u003c/p\u003e\n\u003cp\u003eBerkshelf ã¯ Librarian-Chef ã¨åŒã˜ã Cookbook ã®ç®¡ç†ã‚’ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ä¾\nå­˜é–¢ä¿‚ã®ã‚¯ãƒªã‚¢ã‚‚ã—ã¦ãã‚Œã¾ã™ã€‚Opscode ã®ä¸­ã®äºº @someara ã•ã‚“ã«ã“ã‚“ãªã“ã¨è¨€ã‚ã‚Œ\nã¦ã€\u003c/p\u003e\n\u003cblockquote class=\"twitter-tweet\" lang=\"ja\"\u003e\u003cp\u003e@\u003ca\nhref=\"https://twitter.com/jedipunkz\"\u003ejedipunkz\u003c/a\u003e berkshelf \u0026gt;\nlibrarian-chef\u003c/p\u003e\u0026mdash; somearaã•ã‚“ (@someara) \u003ca\nhref=\"https://twitter.com/someara/status/298664663976120321\"\u003e2013å¹´2æœˆ5æ—¥\n\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\u003cp\u003eLibrarian-chef ã˜ã‚ƒãªãã¦ Berkshelf ä½¿ãˆã£ã¦ã“ã¨ã ã‚ã†ãªãã¨æ€ã£ãŸã®ã§åƒ•ã¯\nBekshelf ã‚’ä½¿ã†ã‚ˆã†ã«ã—ã¦ã¾ã™ã€‚å…ˆæ—¥ãƒ–ãƒ­ã‚°è¨˜äº‹ã«ã—ãŸ openstack-chef-repo ã‚‚ä»¥å‰\nã¯ Librarian-chef ã‚’ä½¿ã£ã¦ã„ãŸã®ã§ã™ãŒæœ€è¿‘ Berkshelf ã«ç½®ãæ›ã‚ã‚Šã¾ã—ãŸã€‚\nopenstack-chef-repo ã¯ Opscode ã®ä¸­ã®äººã® @mattray ã•ã‚“é”ãŒç®¡ç†ã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã§ã¯æ—©é€Ÿã€‚\u003c/p\u003e\n\u003ch2 id=\"ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003eã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003eã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ç°¡å˜ã€‚gem install ã™ã‚‹ã ã‘ã§ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% gem install berkshelf\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"ä½¿ã„æ–¹\"\u003eä½¿ã„æ–¹\u003c/h2\u003e\n\u003cp\u003echef-repo é…ä¸‹ã§ Berksfile ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«æ›¸ãã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003esite :opscode\n\ncookbook 'chef-client'\ncookbook 'nginx', '= 0.101.2'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eberks ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ Cookbooks ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\u003c/p\u003e","title":"Berkshelf ã§ Chef Cookbook ã®ç®¡ç†"},{"content":"ã“ã‚“ã«ã¡ã¯ã€‚@jedipunkz ã§ã™ã€‚\nä¹…ã€…ã« Chef ã®è©±é¡Œã€‚\næœ‰åãªæ–¹ã€…ãŒæœ€è¿‘ Chef ã«ã¤ã„ã¦è¨˜äº‹æ›¸ã„ãŸã‚Šã§ Chef ãŒå†ã³ç››ã‚Šä¸ŠãŒã£ã¦ãã¾ã—ãŸã­ã€‚ åƒ•ã®ãƒ–ãƒ­ã‚°ã«ã‚‚ chef-solo ã§æ¤œç´¢ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã‚‹æ–¹ãŒå¢—ãˆã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚\nã¡ã‚‡ã†ã©ä»Šã€ä»•äº‹ã§è©¦é¨“çš„ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã¦ãã“ã§ Chef ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã™ãŒ Server, Workstation, Target Node(s) ã®æ§‹æˆã§ä½¿ã£ã¦ã„ã¦ã€åƒ•ã‚‰ã¯æœ€åˆã‹ã‚‰ chef-solo ã¨ capistrano ã§ã£ã¦ã“ã¨ã¯è€ƒãˆã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã¡ã‚ã‚“ chef-solo + capistrano ã®ç’°å¢ƒã‚‚èª¿æŸ»ã—ã¾ã—ãŸãŒã€ä»Šã® Server æ§‹æˆãŒä¾¿åˆ©ãªã®ã§ã‚‚ã†æˆ»ã‚Œãªã„ã€‚\nä»Šæ—¥ã¯ Chef ã‚µãƒ¼ãƒæ§‹æˆã®è‰¯ã•ã«ã¤ã„ã¦ã®è¨˜äº‹ã§ã¯ãªã„ã§ã™ãŒã€ãã‚Œã«ã¤ã„ã¦ã¯æ¬¡å›ã€ æ™‚é–“è¦‹ã¤ã‘ã¦æ›¸ã“ã†ã‹ã¨æ€ã£ã¦ã¾ã™ã€‚\nä»Šæ—¥ã¯ \u0026lsquo;chef-client ã‚’ã©ã†ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹ã‹\u0026rsquo; ã«ã¤ã„ã¦ã€‚ã›ã£ã‹ã Chef ã§ã‚µãƒ¼ãƒæ§‹æˆã‚’ç¶™ç¶šçš„ã«ãƒ‡ãƒ—ãƒ­ã‚¤å‡ºæ¥ã¦ã‚‚ Chef è‡ªèº«ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå‡ºæ¥ãªã„ã¨æ‚²ã—ã„ ã§ã™ã‚ˆã­ã€‚chef-client ãŒç¨¼åƒã—ã¦ã„ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãªã‚“ã¦èµ·å‹•ã—ã¦åˆ©ç”¨ã—ã¦ã™ãã«ç ´ æ£„ã ã£ã¦æ™‚ä»£ã§ã™ãŒã€ãªã‹ãªã‹ãã†ã‚‚ã„ãªã‹ã„æ°—ãŒã—ã¦ã„ã¾ã™ã€‚\nã€Œã»ã‚‰ã€ã ã‹ã‚‰ chef-solo ä½¿ãˆã°ã„ã„ã‚“ã ã‚ˆï¼ã€ã£ã¦æ€ã£ã¦ã‚‹ã‚ãªãŸï¼é•ã†ã‚“ã§ã™ã‚ˆãƒ¼ã€‚ ãã®ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚’ä¸Šå›ã‚‹ãƒ¡ãƒªãƒƒãƒˆãŒ Chef ã‚µãƒ¼ãƒæ§‹æˆã«ã‚ã‚‹ã‚“ã§ã™ã€‚æ¬¡å›æ›¸ãã¾ã™ï½—\nChef10 ã‹ã‚‰ Chef11 ã¨è©¦é¨“ã—ã¦ã¿ã‚‹ã«ã¯ã¡ã‚‡ã†ã©è‰¯ã„æ™‚æœŸã§ã—ãŸã€‚ä»Šå›ã®æ§‹æˆã¯\u0026hellip;\næ—§ç’°å¢ƒ +------------------+ | chef server | | version 10.18 | +------------------+ ^ | +--------------------+ | | | | +------------------+ +------------------+ | chef workstation | | target node | | version 10.24 | | version 10.24 | +------------------+ +------------------+ chef server ã¯ apt.opscode.com ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’åˆ©ç”¨ã—ãŸ Chef 10.18 ãªã‚‚ã® chef workstaion ã¯ version 10.24 (2013å¹´3æœˆ15æ—¥ç¾åœ¨ 10.x ç³»æœ€æ–°) target node ã¯ chef workstaion ã‹ã‚‰ knife bootstrap ã‚’è¡Œã„æ§‹æˆ knife bootstrap ã®éš›ã«ä¸‹è¨˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¾ã™ã€‚\n% knife bootstrap -N vmtest01 -r 'role[base]' \\ -i -x root -d chef-full distro ã¯ chef-full ã‚’é¸æŠã€‚chef-full ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ã«ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚\nhttps://github.com/opscode/chef/blob/master/lib/chef/knife/bootstrap/chef-full.erb\nã‚³ãƒ¼ãƒ‰ã‚’æŠœç²‹ã™ã‚‹ã¨ã€omnibus ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã‚’ãƒ€ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Š ã¾ã™ã€‚ã¤ã¾ã‚Š Chef11 ç’°å¢ƒã§å†åº¦ knife bootstrap ã™ã‚Œã°æ–°ã—ã„ Chef ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ ãƒ«ã•ã‚Œã‚‹ã¯ãšã€‚\ninstall_sh=\u0026#34;http://opscode.com/chef/install.sh\u0026#34; version_string=\u0026#34;-v \u0026lt;%= chef_version %\u0026gt;\u0026#34; if ! exists /usr/bin/chef-client; then if exists wget; then bash \u0026lt;(wget \u0026lt;%= \u0026#34;--proxy=on \u0026#34; if knife_config[:bootstrap_proxy] %\u0026gt; ${install_sh} -O -) ${version_string} elif exists curl; then bash \u0026lt;(curl -L \u0026lt;%= \u0026#34;--proxy \\\u0026#34;#{knife_config[:bootstrap_proxy]}\\\u0026#34; \u0026#34; if knife_config[:bootstrap_proxy] %\u0026gt; ${install_sh}) ${version_string} else echo \u0026#34;Neither wget nor curl found. Please install one and try again.\u0026#34; \u0026gt;\u0026amp;2 exit 1 fi fi ã“ã®ã‚ˆã†ã« Chef10 ã§é‹ç”¨ã—ã¦ã„ã‚‹çŠ¶æ…‹ã‚’ Chef11 ã«ç§»è¡Œã—ã¾ã™ã€‚æ–°ã—ã„ç’°å¢ƒã¯\u0026hellip;\næ–°ç’°å¢ƒ +------------------+ +------------------+ | chef server | | chef server | | version 10.18 | | version 11.0.6 | +------------------+ +------------------+ ^ | +--------------------+ | | | | +------------------+ +------------------+ | chef workstation | | target node | | version 11.4 | | version 11.4 | +------------------+ +------------------+ chef server ã¯ omnibus ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‹ã‚‰æ§‹ç¯‰ chef workstation ã¯ version 11.4 (2013å¹´3æœˆ15æ—¥ç¾åœ¨æœ€æ–°) ç§»è¡Œæ‰‹é † Chef11 ã‚µãƒ¼ãƒã‚’ç”¨æ„ã™ã‚‹ Omnibus ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã§ã‚³ãƒãƒ³ãƒ‰3ã¤æ‰“ã¤ã ã‘ã§ Chef ã‚µãƒ¼ãƒã¯æ§‹ç¯‰å‡ºæ¥ã¾ã™ã€‚Chef11 ã‹ã‚‰ã¯ã“ã®æ–¹æ³•ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚bootstrap ã‚’ä½¿ã£ãŸæ–¹æ³•ã‚ˆã‚Šç°¡å˜ã§ã™ã—ã€‚\n% wget https://opscode-omnitruck-release.s3.amazonaws.com/ubuntu/12.04/x86_64/chef-server_11.0.6-1.ubuntu.12.04_amd64.deb % sudo dpkg -i chef-server_11.0.6-1.ubuntu.12.04_amd64.deb % sudo chef-server-ctl reconfigure Chef11 Workstation ã‚’ç”¨æ„ã™ã‚‹ è©³ç´°ã¯å‰²æ„›ã—ã¾ã™ã€‚chef10 ã¨åŒã˜ã§ã™ã€‚æ‰‹é †ã¨ã—ã¦ã¯\nchef10 ã® chef-repo ã‚’ã‚³ãƒ”ãƒ¼ pem ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ chef11 server ã‹ã‚‰ã‚³ãƒ”ãƒ¼ knife configure -i ã«ã¦ knife.rb ã®ç”Ÿæˆ cookbooks, roles, data_bags, environments ç­‰ã‚’ chef11 ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€‚è‹¥å¹²ä¿®æ­£ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚‹ã€‚ ã§ã™ã€‚\nTarget Node ã«ãŠã‘ã‚‹æ—§ chef-client ã®åœæ­¢ã¨å‰Šé™¤ ç¨¼åƒã—ã¦ã„ã‚‹ Chef10 ã® chef-client ã‚’åœæ­¢ã—å‰Šé™¤ã€ãã—ã¦ pem ãƒ•ã‚¡ã‚¤ãƒ«é”ã‚’é€€é¿ã— ã¦ã‚ã’ã¾ã™ã€‚ã“ã“ã§ã¯ ssh ã§æ¶ˆã™ä¾‹ã‚’æ›¸ãã¾ã™ãŒã€ã“ã‚Œã“ã Cookbook ã‚’æ›¸ã„ã¦å®Ÿè¡Œ ã™ã‚Œã°è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚\n% ssh -i \u0026lt;ssh_secret_key\u0026gt; -l root \u0026lt;ip_address\u0026gt; \\ 'service chef-client stop; apt-get -y remove chef; mv /etc/chef /etc/chef.old' å† knife bootstrap å®Ÿè¡Œ Chef11 ã® Workstation ã‹ã‚‰ knife bootstrap ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ Target Node ã« Chef11 ã®ç’°å¢ƒãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œ Chef11 Server ã¨æ¥ç¶šå‡ºæ¥ã¾ã™ã€‚\n% knife bootstrap \u0026lt;ip_address\u0026gt; -N vmtest01 -r 'role[base]' -i \u0026lt;ssh_secret_key\u0026gt; \\ -x root -d chef-full role[base] ä¸­ã® run_list ã«\u0026rsquo;chef-client::service\u0026rsquo; ã‚’è¿½åŠ ã™ã‚‹ã¨ chef-client ãŒ å¸¸æ™‚ç¨¼å‹•ã—ã¦ãã‚Œã¦å®šæœŸçš„ã« Chef Server ã¨æ¥ç¶šã€æ›´æ–°ã—ã¦ãã‚Œã¾ã™ã€‚\nã¾ã¨ã‚ã¨è€ƒå¯Ÿ chef-client ã®æ›´æ–°ã¯ç°¡å˜ã«å‡ºæ¥ãŸï¼\nä»Šå›ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® distro \u0026lsquo;chef-full\u0026rsquo; ã®ä¾‹ã§æ›¸ã„ãŸã®ã ã‘ã©ã€distro ã«ã¯ä»–ã«ã‚‚ ä¸‹è¨˜ãŒã‚ã‚‹ã€‚\nhttps://github.com/opscode/chef/tree/master/lib/chef/knife/bootstrap\nLinux ã®ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³åãŒã¤ã„ãŸ distro ã¯ ruby ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§, Chef ã‚’ gem ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã€‚ä¸‹è¨˜ã¯ distro \u0026lsquo;ubuntu12.04-gems\u0026rsquo; ã®ã‚³ãƒ¼ãƒ‰ã®æŠœç²‹ ã§ã™ã€‚\nif [ ! -f /usr/bin/chef-client ]; then aptitude update aptitude install -y ruby ruby1.8-dev build-essential wget libruby1.8 rubygems fi gem update --no-rdoc --no-ri gem install ohai --no-rdoc --no-ri --verbose gem install chef --no-rdoc --no-ri --verbose \u0026lt;%= bootstrap_version_string %\u0026gt; ruby ã¯ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãŒç”¨æ„ã—ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã€‚Chef ã¯ bootstrap_version_string ã‚’æŒ‡å®šã— gem ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã€‚\nã¤ã¾ã‚Š \u0026lsquo;ubuntu12.04-gems\u0026rsquo; ã§ã‚‚ chef-client ã®æ›´æ–°ã¯å‡ºæ¥ã‚‹ã€‚ã¡ãªã¿ã«è©¦ã—ã¦ã¿ã¾ ã—ãŸã€‚chef-client ã®åœæ­¢ãƒ»å‰Šé™¤ã‚’ä¸‹è¨˜ã®é€šã‚Šè¡Œã†ã¨ã€å…¨ãåŒã˜ knife bootstrap ã‚³ ãƒãƒ³ãƒ‰ã§ chef-client ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒè¡ŒãˆãŸã€‚\n% ssh -i \u0026lt;ssh_secret_key\u0026gt; -l root \u0026lt;ip_address\u0026gt; 'service chef-client stop; mv \\ /usr/local/bin/chef-client /usr/local/bin/chef-client.old; mv /etc/chef /etc/chef.old' ä»¥ä¸Šã§ã™ã€‚\nãªã‚“ã‹ç°¡å˜ãªã“ã¨æ›¸ãã®ã«é•·ããªã£ã¡ã‚ƒã£ãŸã‘ã©\u0026hellip;ã€‚é‹ç”¨ã‚’åƒ•ã‚‰ã¯ã¾ã å‡ºæ¥ã¦ã„ãªã„ ã®ã ã‘ã©ã€ãã®æ™‚ã®ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ä»Šå›ã®è©¦é¨“ã¯ã—ã¦ã¿ãŸã‹ã£ãŸã—ã€ã„ã„çµæœãŒå‡ºã¦ã‚ˆ ã‹ã£ãŸã€‚Chef ãŒãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œã¦ Chef Server ã®æ§‹æˆãŒå¤§ããä»£ã‚ã£ ã¦ã‚‚å¯¾å¿œã—ãŸ cookbook, role, .. ãŒã‚ã‚Œã°ã‚¹ãƒ ãƒ¼ã‚¹ã«ç§»è¡Œå‡ºæ¥ã‚‹ã€‚\nChef ç„¡ã—ã«ã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚„ã£ã¦ã‚‰ã‚Œãªã„æ™‚ä»£ãŒæ¥ãŸã£ã¦æ„Ÿã˜ï½— Chef å‘¨ã‚ŠãŸ ã®ã—ãƒ¼ï¼\nè¿½ä¼¸: ä»Šå›ã®æ–¹æ³•ã‚ˆã‚Šè‰¯ã„ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹çš„ãªæ–¹æ³•ãŒã‚ã‚Œã°æ•™ãˆã¦ä¸‹ã•ã„ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/03/15/chef-contenuously-deploy/","summary":"\u003cp\u003eã“ã‚“ã«ã¡ã¯ã€‚\u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä¹…ã€…ã« Chef ã®è©±é¡Œã€‚\u003c/p\u003e\n\u003cp\u003eæœ‰åãªæ–¹ã€…ãŒæœ€è¿‘ Chef ã«ã¤ã„ã¦è¨˜äº‹æ›¸ã„ãŸã‚Šã§ Chef ãŒå†ã³ç››ã‚Šä¸ŠãŒã£ã¦ãã¾ã—ãŸã­ã€‚\nåƒ•ã®ãƒ–ãƒ­ã‚°ã«ã‚‚ chef-solo ã§æ¤œç´¢ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã‚‹æ–¹ãŒå¢—ãˆã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¡ã‚‡ã†ã©ä»Šã€ä»•äº‹ã§è©¦é¨“çš„ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã¦ãã“ã§ Chef ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã™ãŒ Server,\nWorkstation, Target Node(s) ã®æ§‹æˆã§ä½¿ã£ã¦ã„ã¦ã€åƒ•ã‚‰ã¯æœ€åˆã‹ã‚‰ chef-solo ã¨\ncapistrano ã§ã£ã¦ã“ã¨ã¯è€ƒãˆã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã¡ã‚ã‚“ chef-solo + capistrano\nã®ç’°å¢ƒã‚‚èª¿æŸ»ã—ã¾ã—ãŸãŒã€ä»Šã® Server æ§‹æˆãŒä¾¿åˆ©ãªã®ã§ã‚‚ã†æˆ»ã‚Œãªã„ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šæ—¥ã¯ Chef ã‚µãƒ¼ãƒæ§‹æˆã®è‰¯ã•ã«ã¤ã„ã¦ã®è¨˜äº‹ã§ã¯ãªã„ã§ã™ãŒã€ãã‚Œã«ã¤ã„ã¦ã¯æ¬¡å›ã€\næ™‚é–“è¦‹ã¤ã‘ã¦æ›¸ã“ã†ã‹ã¨æ€ã£ã¦ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šæ—¥ã¯ \u0026lsquo;chef-client ã‚’ã©ã†ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹ã‹\u0026rsquo; ã«ã¤ã„ã¦ã€‚ã›ã£ã‹ã Chef\nã§ã‚µãƒ¼ãƒæ§‹æˆã‚’ç¶™ç¶šçš„ã«ãƒ‡ãƒ—ãƒ­ã‚¤å‡ºæ¥ã¦ã‚‚ Chef è‡ªèº«ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå‡ºæ¥ãªã„ã¨æ‚²ã—ã„\nã§ã™ã‚ˆã­ã€‚chef-client ãŒç¨¼åƒã—ã¦ã„ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãªã‚“ã¦èµ·å‹•ã—ã¦åˆ©ç”¨ã—ã¦ã™ãã«ç ´\næ£„ã ã£ã¦æ™‚ä»£ã§ã™ãŒã€ãªã‹ãªã‹ãã†ã‚‚ã„ãªã‹ã„æ°—ãŒã—ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã€Œã»ã‚‰ã€ã ã‹ã‚‰ chef-solo ä½¿ãˆã°ã„ã„ã‚“ã ã‚ˆï¼ã€ã£ã¦æ€ã£ã¦ã‚‹ã‚ãªãŸï¼é•ã†ã‚“ã§ã™ã‚ˆãƒ¼ã€‚\nãã®ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚’ä¸Šå›ã‚‹ãƒ¡ãƒªãƒƒãƒˆãŒ Chef ã‚µãƒ¼ãƒæ§‹æˆã«ã‚ã‚‹ã‚“ã§ã™ã€‚æ¬¡å›æ›¸ãã¾ã™ï½—\u003c/p\u003e\n\u003cp\u003eChef10 ã‹ã‚‰ Chef11 ã¨è©¦é¨“ã—ã¦ã¿ã‚‹ã«ã¯ã¡ã‚‡ã†ã©è‰¯ã„æ™‚æœŸã§ã—ãŸã€‚ä»Šå›ã®æ§‹æˆã¯\u0026hellip;\u003c/p\u003e\n\u003ch2 id=\"æ—§ç’°å¢ƒ\"\u003eæ—§ç’°å¢ƒ\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003e+------------------+\n|   chef server    |\n|  version 10.18   |\n+------------------+\n^\n|\n+--------------------+\n|                    |\n|                    |\n+------------------+ +------------------+\n| chef workstation | |   target node    |\n|  version 10.24   | |  version 10.24   |\n+------------------+ +------------------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003echef server ã¯ apt.opscode.com ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’åˆ©ç”¨ã—ãŸ Chef 10.18 ãªã‚‚ã®\u003c/li\u003e\n\u003cli\u003echef workstaion ã¯ version 10.24 (2013å¹´3æœˆ15æ—¥ç¾åœ¨ 10.x ç³»æœ€æ–°)\u003c/li\u003e\n\u003cli\u003etarget node ã¯ chef workstaion ã‹ã‚‰ knife bootstrap ã‚’è¡Œã„æ§‹æˆ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eknife bootstrap ã®éš›ã«ä¸‹è¨˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¾ã™ã€‚\u003c/p\u003e","title":"chef-client ã®ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒª"},{"content":"OpenStack ã‚’ã‚³ãƒ¼ãƒ‰ã§ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯å¹¾ã¤ã‹å­˜åœ¨ã™ã‚‹ã®ã ã‘ã© Ruby ã§è¨˜è¿°å‡ºæ¥ã‚‹ Fog ãŒè‰¯ã„ï¼ã¨éš£ã«åº§ã£ã¦ã‚‹ã‚¢ãƒ—ãƒªã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒè¨€ã†ã®ã§åƒ•ã‚‚æœ€è¿‘å°‘ã— è§¦ã£ã¦ã¾ã™ã€‚\nFog ã‚’ä½¿ã£ãŸ OpenStack ã‚’ç®¡ç†ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ã‚‚å¤§äº‹ãªã®ã ã‘ã©ã€Fog ã®ã‚³ãƒ³ ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã£ã¦ã“ã¨ã§å¹¾ã¤ã‹ã®æ©Ÿèƒ½ã‚’ä»˜ã‘è¶³ã—ã¦ (Quantum Router å‘¨ã‚Š) ã£ã¦ã“ã¨ ã‚’ã‚„ã£ã¦ã¾ã—ãŸã€‚ã¾ã å–ã‚Šè¾¼ã¾ã‚Œã¦ãªã„ã‘ã©ã€‚\nãã®é–‹ç™ºã®ä¸­ã§ pry ã®å­˜åœ¨ã‚’æ•™ãˆã¦ã‚‚ã‚‰ã„ãã®ä¾¿åˆ©ã•ã«é©šã„ãŸã®ã§å°‘ã—èª¬æ˜ã—ã¾ã™ã€‚ ãƒãƒªãƒãƒªé–‹ç™ºç³»ã®äººã¯æ—¢ã«çŸ¥ã£ã¦ã„ã‚‹ã ã‚ã†ã‘ã©ã€ã‚¤ãƒ³ãƒ•ãƒ©ç³»ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®åƒ•ã«ã¨ã£ã¦ ã¯æ„Ÿæ¿€ãƒ¢ãƒã§ã—ãŸã€‚\npry ã¯ irb ä»£æ›¿ãª Ruby ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚·ã‚§ãƒ«ã§ã™ã€‚ä¸‹è¨˜ã® URL ã‹ã‚‰æŒã£ã¦ã“ã‚Œ ã¾ã™ã€‚\nhttps://github.com/pry/pry\nã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã‚ŒãŸã‚Š json ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒç¶ºéº—ã«æˆå½¢ã•ã‚ŒãŸã‚Š irb çš„ã« ä½¿ã†ã ã‘ã§ã‚‚ä¾¿åˆ©ãªã®ã ã‘ã© \u0026lsquo;?\u0026rsquo; ã‚„ \u0026lsquo;$\u0026rsquo; ã§ã‚³ãƒ¼ãƒ‰ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’ç¢ºèªã—ãŸã‚Šã‚³ãƒ¼ãƒ‰ å†…å®¹ã‚’ç¢ºèªã—ãŸã‚Šå‡ºæ¥ã‚‹ã®ãŒã‚¢ãƒ„ã„ï¼\nã¡ã‚‡ã†ã©ä»Šå›è¿½åŠ ã—ãŸ Fog ã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦èª¬æ˜ã—ã¦ã„ã¿ã¾ã™ã€‚\nFog ã®ã‚³ãƒ¼ãƒ‰ã‚’ require ã—ã¦ OpenStack ã«æ¥ç¶šã™ã‚‹ãŸã‚ã®æƒ…å ±ã‚’è¨­å®šã— OpenStack Quantum ã«æ¥ç¶šã—ã¾ã™ã€‚ã“ã‚Œã§æº–å‚™å®Œäº†ã€‚\n[38] pry(main)\u0026gt; require \u0026#39;/home/jedipunkz/fog/lib/fog.rb\u0026#39; [49] pry(main)\u0026gt; @connection_hash = { [49] pry(main)* :openstack_username =\u0026gt; \u0026#39;demo\u0026#39;, [49] pry(main)* :openstack_api_key =\u0026gt; \u0026#39;demo\u0026#39;, [49] pry(main)* :openstack_tenant =\u0026gt; \u0026#39;service\u0026#39;, [49] pry(main)* :openstack_auth_url =\u0026gt; \u0026#39;http://172.16.1.11:5000/v2.0/tokens\u0026#39;, [49] pry(main)* :provider =\u0026gt; \u0026#39;OpenStack\u0026#39;, [49] pry(main)* } [50] pry(main)\u0026gt; @quantum = Fog::Network.new(@connection_hash) è©¦ã—ã« Router ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚list_routers ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚\n[54] pry(main)\u0026gt; @quantum.list_routers() =\u0026gt; #\u0026lt;Excon::Response:0x00000003da3560 @body= \u0026#34;{\\\u0026#34;routers\\\u0026#34;: [{\\\u0026#34;status\\\u0026#34;: \\\u0026#34;ACTIVE\\\u0026#34;, \\\u0026#34;external_gateway_info\\\u0026#34;: {\\\u0026#34;network_id\\\u0026#34;: \\\u0026#34;b8ef37a9-9ed1-4b6d-862d-fe9e381a2f2a\\\u0026#34;}, \\\u0026#34;name\\\u0026#34;: \\\u0026#34;router-admin\\\u0026#34;, \\\u0026#34;admin_state_up\\\u0026#34;: true, \\\u0026#34;tenant_id\\\u0026#34;: \\\u0026#34;5e9544d4823a44d59f3591144049f691\\\u0026#34;, \\\u0026#34;id\\\u0026#34;: \\\u0026#34;35c65e2c-5cd8-4eb5-87a8-c370988c101a\\\u0026#34;}]}\u0026#34;, @data= {:body=\u0026gt; {\u0026#34;routers\u0026#34;=\u0026gt; [{\u0026#34;status\u0026#34;=\u0026gt;\u0026#34;ACTIVE\u0026#34;, \u0026#34;external_gateway_info\u0026#34;=\u0026gt; {\u0026#34;network_id\u0026#34;=\u0026gt;\u0026#34;b8ef37a9-9ed1-4b6d-862d-fe9e381a2f2a\u0026#34;}, \u0026#34;name\u0026#34;=\u0026gt;\u0026#34;router-admin\u0026#34;, \u0026#34;admin_state_up\u0026#34;=\u0026gt;true, \u0026#34;tenant_id\u0026#34;=\u0026gt;\u0026#34;5e9544d4823a44d59f3591144049f691\u0026#34;, \u0026#34;id\u0026#34;=\u0026gt;\u0026#34;35c65e2c-5cd8-4eb5-87a8-c370988c101a\u0026#34;}]}, :headers=\u0026gt; {\u0026#34;Content-Type\u0026#34;=\u0026gt;\u0026#34;application/json\u0026#34;, \u0026#34;Content-Length\u0026#34;=\u0026gt;\u0026#34;259\u0026#34;, \u0026#34;Date\u0026#34;=\u0026gt;\u0026#34;Wed, 06 Mar 2013 06:53:22 GMT\u0026#34;}, :status=\u0026gt;200, :remote_ip=\u0026gt;\u0026#34;172.16.1.11\u0026#34;}, @headers= {\u0026#34;Content-Type\u0026#34;=\u0026gt;\u0026#34;application/json\u0026#34;, \u0026#34;Content-Length\u0026#34;=\u0026gt;\u0026#34;259\u0026#34;, \u0026#34;Date\u0026#34;=\u0026gt;\u0026#34;Wed, 06 Mar 2013 06:53:22 GMT\u0026#34;}, @remote_ip=\u0026#34;172.16.1.11\u0026#34;, @status=200\u0026gt; ç¶ºéº—ã«è‰²ä»˜ã‘ã•ã‚Œã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚\næ¬¡ã« \u0026lsquo;cd @quantum\u0026rsquo; ã—ã¦ cd ã—ã¾ã™ã€‚ãã—ã¦ \u0026lsquo;? ãƒ¡ã‚½ãƒƒãƒ‰å\u0026rsquo; ã™ã‚‹ã¨ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚·ãƒ³ ã‚¿ãƒƒã‚¯ã‚¹ã‚’ç¢ºèªå‡ºæ¥ã¾ã™ã€‚è©¦ã—ã« Router ã‚’ç”Ÿæˆã™ã‚‹ create_router ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¦‹ã¦ ã¿ã¾ã™ã€‚\n[56] pry(main)\u0026gt; cd @quantum [59] pry(#\u0026lt;Fog::Network::OpenStack::Real\u0026gt;):1\u0026gt; ? create_router From: /home/jedipunkz/fog/lib/fog/openstack/requests/network/create_router.rb @ line 6: Owner: Fog::Network::OpenStack::Real Visibility: public Signature: create_router(name, options=?) Number of lines: 1 ãã—ã¦ \u0026lsquo;$ ãƒ¡ã‚½ãƒƒãƒ‰å\u0026rsquo; ã™ã‚‹ã¨ã‚³ãƒ¼ãƒ‰ãŒç¢ºèªå‡ºæ¥ã¾ã™ã€‚\n[64] pry(#\u0026lt;Fog::Network::OpenStack::Real\u0026gt;):1\u0026gt; $ create_router From: /home/jedipunkz/fog/lib/fog/openstack/requests/network/create_router.rb @ line 6: Owner: Fog::Network::OpenStack::Real Visibility: public Number of lines: 27 def create_router(name, options = {}) data = { \u0026#39;router\u0026#39; =\u0026gt; { \u0026#39;name\u0026#39; =\u0026gt; name, } } vanilla_options = [ :admin_state_up, :tenant_id, :network_id, :external_gateway_info, :status, :subnet_id ] vanilla_options.reject{ |o| options[o].nil? }.each do |key| data[\u0026#39;router\u0026#39;][key] = options[key] end request( :body =\u0026gt; Fog::JSON.encode(data), :expects =\u0026gt; [201], :method =\u0026gt; \u0026#39;POST\u0026#39;, :path =\u0026gt; \u0026#39;routers\u0026#39; ) end ã‚ã¨ã¯ \u0026lsquo;puts @quantum\u0026rsquo; ç­‰ã™ã‚‹ã¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†…å®¹ãŒç¢ºèªå‡ºæ¥ãŸã‚Šã€\u0026rsquo;ls @quantum\u0026rsquo; ã™ã‚‹ã¨ @quantum ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§ãŒç¢ºèªå‡ºæ¥ãŸã‚Šã€‚\né–‹ç™ºã®åŠ¹ç‡ãŒä¸ŠãŒã‚‹ãªãã¨æ„Ÿæ¿€ã€‚\næ˜¥ãªã®ã§ OpenStack ã‚‚ãã‚ã‚ã‚æ¬¡æœŸãƒªãƒªãƒ¼ã‚¹ã®æ™‚æœŸã€‚ãã‚Œãã‚Œã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ©Ÿ èƒ½ãŒæ‹¡å¼µã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ Fog ç­‰ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã™ã‚‹æ©Ÿä¼š ã‚‚ã¾ã™ã¾ã™å¢—ãˆãã†ã€‚Fog ã‚„ãã®ä»–ã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ãªã‚“ã ã‹ã‚“ã è¨€ã£ã¦ AWS ã®ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãŒãƒ¡ã‚¤ãƒ³ãªã®ã§ OpenStack ã®æ©Ÿèƒ½è¿½åŠ ã«è¿½ã„ã¤ã„ã¦ã„ãªã„æ„ŸãŒã‚ã‚‹ã€‚ ã‚‚ã—èˆˆå‘³æŒã£ã¦ã„ã‚‹äººãŒå±…ãŸã‚‰æ˜¯éä¸€ç·’ã« OpenStack ç•Œéšˆã‚’ç››ã‚Šä¸Šã’ã¾ã—ã‚‡ã†ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/03/06/pry/","summary":"\u003cp\u003eOpenStack ã‚’ã‚³ãƒ¼ãƒ‰ã§ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯å¹¾ã¤ã‹å­˜åœ¨ã™ã‚‹ã®ã ã‘ã© Ruby\nã§è¨˜è¿°å‡ºæ¥ã‚‹ Fog ãŒè‰¯ã„ï¼ã¨éš£ã«åº§ã£ã¦ã‚‹ã‚¢ãƒ—ãƒªã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒè¨€ã†ã®ã§åƒ•ã‚‚æœ€è¿‘å°‘ã—\nè§¦ã£ã¦ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eFog ã‚’ä½¿ã£ãŸ OpenStack ã‚’ç®¡ç†ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ã‚‚å¤§äº‹ãªã®ã ã‘ã©ã€Fog ã®ã‚³ãƒ³\nãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã£ã¦ã“ã¨ã§å¹¾ã¤ã‹ã®æ©Ÿèƒ½ã‚’ä»˜ã‘è¶³ã—ã¦ (Quantum Router å‘¨ã‚Š) ã£ã¦ã“ã¨\nã‚’ã‚„ã£ã¦ã¾ã—ãŸã€‚ã¾ã å–ã‚Šè¾¼ã¾ã‚Œã¦ãªã„ã‘ã©ã€‚\u003c/p\u003e\n\u003cp\u003eãã®é–‹ç™ºã®ä¸­ã§ pry ã®å­˜åœ¨ã‚’æ•™ãˆã¦ã‚‚ã‚‰ã„ãã®ä¾¿åˆ©ã•ã«é©šã„ãŸã®ã§å°‘ã—èª¬æ˜ã—ã¾ã™ã€‚\nãƒãƒªãƒãƒªé–‹ç™ºç³»ã®äººã¯æ—¢ã«çŸ¥ã£ã¦ã„ã‚‹ã ã‚ã†ã‘ã©ã€ã‚¤ãƒ³ãƒ•ãƒ©ç³»ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®åƒ•ã«ã¨ã£ã¦\nã¯æ„Ÿæ¿€ãƒ¢ãƒã§ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003epry ã¯ irb ä»£æ›¿ãª Ruby ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚·ã‚§ãƒ«ã§ã™ã€‚ä¸‹è¨˜ã® URL ã‹ã‚‰æŒã£ã¦ã“ã‚Œ\nã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/pry/pry\"\u003ehttps://github.com/pry/pry\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã‚ŒãŸã‚Š json ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒç¶ºéº—ã«æˆå½¢ã•ã‚ŒãŸã‚Š irb çš„ã«\nä½¿ã†ã ã‘ã§ã‚‚ä¾¿åˆ©ãªã®ã ã‘ã© \u0026lsquo;?\u0026rsquo; ã‚„ \u0026lsquo;$\u0026rsquo; ã§ã‚³ãƒ¼ãƒ‰ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’ç¢ºèªã—ãŸã‚Šã‚³ãƒ¼ãƒ‰\nå†…å®¹ã‚’ç¢ºèªã—ãŸã‚Šå‡ºæ¥ã‚‹ã®ãŒã‚¢ãƒ„ã„ï¼\u003c/p\u003e\n\u003cp\u003eã¡ã‚‡ã†ã©ä»Šå›è¿½åŠ ã—ãŸ Fog ã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦èª¬æ˜ã—ã¦ã„ã¿ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eFog ã®ã‚³ãƒ¼ãƒ‰ã‚’ require ã—ã¦ OpenStack ã«æ¥ç¶šã™ã‚‹ãŸã‚ã®æƒ…å ±ã‚’è¨­å®šã— OpenStack\nQuantum ã«æ¥ç¶šã—ã¾ã™ã€‚ã“ã‚Œã§æº–å‚™å®Œäº†ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-ruby\" data-lang=\"ruby\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e38\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e pry(main)\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e require \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/home/jedipunkz/fog/lib/fog.rb\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e49\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e pry(main)\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e @connection_hash \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e49\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e pry(main)\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e   \u003cspan style=\"color:#e6db74\"\u003e:openstack_username\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;demo\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e49\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e pry(main)\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e   \u003cspan style=\"color:#e6db74\"\u003e:openstack_api_key\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;demo\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e49\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e pry(main)\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e   \u003cspan style=\"color:#e6db74\"\u003e:openstack_tenant\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;service\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e49\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e pry(main)\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e   \u003cspan style=\"color:#e6db74\"\u003e:openstack_auth_url\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;http://172.16.1.11:5000/v2.0/tokens\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e49\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e pry(main)\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e   \u003cspan style=\"color:#e6db74\"\u003e:provider\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;OpenStack\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e49\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e pry(main)\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e pry(main)\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e @quantum \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFog\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eNetwork\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003enew(@connection_hash)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè©¦ã—ã« Router ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚list_routers ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚\u003c/p\u003e","title":"pry ã®ã‚¹ã‚¹ãƒ¡"},{"content":"2013å¹´2æœˆ9æ—¥ã«è¡Œã‚ã‚ŒãŸ OpenStack å‹‰å¼·ä¼šç¬¬11å›ã§è©±ã—ã¦ãã¾ã—ãŸã€‚\nopenstack-chef-repo ã¨è¨€ã†ã€Opscode Chef ã§ OpenStack ã‚’æ§‹ç¯‰ã™ã‚‹å†…å®¹ã‚’è©±ã—ã¦ ãã¾ã—ãŸã€‚ãã®æ™‚ã«èª¬æ˜å‡ºæ¥ãªã‹ã£ãŸè©³ç´°ã«ã¤ã„ã¦ãƒ–ãƒ­ã‚°ã«æ›¸ã„ã¦ãŠãã¾ã™ã€‚\nOpenstack chef-repo from Tomokazu Hirai èª¬æ˜ã§ä½¿ã£ãŸã‚¹ãƒ©ã‚¤ãƒ‰ã§ã™ã€‚\nã¾ãˆãŒã Essex ãƒ™ãƒ¼ã‚¹ã§æ§‹ç¯‰ã™ã‚‹ã“ã¨ã—ã‹ä»Šã¯å‡ºæ¥ã¾ã›ã‚“ã€‚Folsom ã«é–¢ã—ã¦ã¯ \u0026lsquo;ç›´ã¡ã«é–‹ç™ºãŒ ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹\u0026rsquo; ã¨è¨˜ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚ä»Šå›ã¯ Opscode ã¨ RackSpace ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒå…± åŒã§é–‹ç™ºã‚’é€²ã‚ã¦ã„ã‚‹ã®ã§æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚ä»Šã¾ã§å€‹äººã§ OpenStack ã®å„ã‚³ãƒ³ãƒãƒ¼ãƒ ãƒ³ãƒˆã® cookbook ã‚’é–‹ç™ºã•ã‚Œã¦ã„ãŸæ–¹ãŒã„ã‚‰ã£ã—ã‚ƒã‚‹ã®ã ã‘ã©æ±ç”¨æ€§ã‚’æŒãŸã›ã‚‹ã¨ã„ã† æ„å‘³ã§éå¸¸ã«é›£ã—ãã€ã¾ãŸã©ã®æ–¹ã®é–‹ç™ºã«è¿½å¾“ã—ã¦ã„ã‘ã°ã‚ˆã„ã‹åˆ¤æ–­å›°ã£ã¦ã„ã¾ã—ãŸã€‚ ã‚ˆã£ã¦ä»Šå›ã“ãæœŸå¾…ã€‚\nå‰æã®æ§‹æˆ +-------------+ | chef-server | +-------------+ 10.0.0.10 | +---------------+ 10.0.0.0/24 | | +-------------+ +-------------+ | workstation | | node | +-------------+ +-------------+ 10.0.0.11 10.0.0.12 chef-server : chef API ã‚’æŒã¤ chef-server ã€‚cookbook, role..ãªã©ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŒã¤ workstation : openstack-chef-repo ã‚’ä½¿ã†ãƒãƒ¼ãƒ‰ã€‚knife ãŒä½¿ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ node : OpenStack ã‚’æ§‹ç¯‰ã™ã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒ¼ãƒ‰ ç›®æ¬¡ chef-server ã®æ§‹ç¯‰ (BootStrap ä½¿ã†) openstack-chef-repo ã‚’ä½¿ç”¨ã™ã‚‹æº–å‚™ openstack-chef-repo å®Ÿè¡Œ chef-server ã®æ§‹ç¯‰ Opscode ã® wiki ã«è¨˜ã•ã‚Œã¦ã„ã‚‹é€šã‚Šãªã®ã§ã™ãŒã€ç°¡å˜ã«æ›¸ã„ã¦ãŠãã¾ã™ã€‚ä»Šå›ã¯ bootstrap æ–¹å¼ã§ç”¨æ„ã—ã¾ã™ã€‚\nchef-server ãƒãƒ¼ãƒ‰ã« chef ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚chef-solo ã‚’ç”¨ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚\nchef-server# gem install chef chef-solo ã‚’ä½¿ã†ãŸã‚ã®è¨­å®šæƒ…å ±ã‚’ /etc/chef/solo.rb ã«è¨˜ã—ã¾ã™ã€‚\nchef-server# mkdir /etc/chef chef-server# ${EDITOR} /etc/chef/solo.rb file_cache_path \u0026quot;/tmp/chef-solo\u0026quot; cookbook_path \u0026quot;/tmp/chef-solo/cookbooks\u0026quot; chef-solo ã‚’å®Ÿè¡Œã™ã‚‹éš›ã«ä½¿ã† json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚attribute ã‚’ä¸Šæ›¸ãã™ã‚‹ ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ä»Šå›ã¯ webui ã‚’æœ‰åŠ¹ã«ã—ãŸçŠ¶æ…‹ã«ã—ã¾ã™ã€‚\nchef-server# ${EDITOR} ~/chef.json { \u0026quot;chef_server\u0026quot;: { \u0026quot;server_url\u0026quot;: \u0026quot;http://localhost:4000\u0026quot;, \u0026quot;init_style\u0026quot;: \u0026quot;runit\u0026quot; }, \u0026quot;run_list\u0026quot;: [ \u0026quot;recipe[chef-server::rubygems-install]\u0026quot; ] } bootstrap ã—ã¦ chef-server ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚\nchef-server# chef-solo -c /etc/chef/solo.rb -j ~/chef.json -r http://s3.amazonaws.com/chef-solo/bootstrap-latest.tar.gz chef-server ãŒå®Œæˆã—ãŸã¯ãšã§ã™ã€‚workstation ã§ knife ã‚’ä½¿ã†ãŸã‚ã« \u0026lsquo;client\u0026rsquo; ã‚’ ä½œã‚Šã¾ã™ã€‚chef 10.x ã§ã¯ user ã§ã¯ãªã client ãŒ knife ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\nchef-server% mkdir ~/.chef chef-server% sudo cp /etc/chef/validation.pem ~/.chef/ chef-server% sudo cp /etc/chef/webui.pem ~/.chef/ chef-server% sudo chown \u0026lt;my-username\u0026gt;:\u0026lt;my-group\u0026gt; ~/.chef knife ã‚’ä½¿ã†ãŸã‚ã«ä¸‹è¨˜ã®æ“ä½œã‚’è¡Œã„ã¾ã™ã€‚\nchef-server% cd ~ chef-server% knife configure -i Where should I put the config file? [~/.chef/knife.rb] Please enter the chef server URL: [http://10.0.0.1:4000] Please enter a clientname for the new client: [jedipunkz] Please enter the existing admin clientname: [chef-webui] Please enter the location of the existing admin client's private key:[/etc/chef/webui.pem] /home/jedipunkz/.chef/webui.pem Please enter the validation clientname: [chef-validator] Please enter the location of the validation key:[/etc/chef/validation.pem] /home/jedipunkz/.chef/validation.pem Please enter the path to a chef repository (or leave blank): Creating initial API user... Created client[jedipunkz] Configuration file written to /home/jedipunkz/.chef/knife.rb workstaion ãƒãƒ¼ãƒ‰ã§ knife ã‚’æ“ä½œã™ã‚‹ãŸã‚ã® \u0026lsquo;worker\u0026rsquo; client ã‚’ä½œæˆã—ã¾ã™ã€‚\nchef-server% export EDITOR=vim chef-server% knife client create worker -a -f worker.pem chef-server% knife client list chef-validator chef-webui chefserver.example.com jedipunkz worker openstack-chef-repo ã‚’ä½¿ç”¨ã™ã‚‹æº–å‚™ workstation ã§ openstack-chef-repo ã‚’ä½¿ã†ãŸã‚ã®æº–å‚™ã‚’ã—ã¾ã™ã€‚\nã¾ãšã¯ knife ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ä¸‹è¨˜ã®ã‚ˆã†ã« knife.rb ã‚„ pem ã®æ‰‹å…ƒã¸ã®è»¢é€ã‚’è¡Œã„ã¾ã™ã€‚\nworkstation% gem install chef librarian spiceweasel workstation% cd ~ workstation% git clone git://github.com/opscode/openstack-chef-repo.git workstation% cd openstack-chef-repo workstation% vim .chef/knife.rb log_level :info log_location STDOUT node_name 'worker' client_key '/home/jedipunkz/openstack-chef-repo/.chef/worker.pem' validation_client_name 'chef-validator' validation_key '/home/jedipunkz/openstack-chef-repo/.chef/validation.pem' chef_server_url 'http://10.0.0.10:4000' cache_type 'BasicFile' cache_options( :path =\u0026gt; '/home/jedipunkz/openstack-chef-repo/.chef/checksums' ) cookbook_path '/home/jedipunkz/openstack-chef-repo/cookbooks' workstation% scp 10.0.0.10:~/worker.pem .chef/ workstation% scp 10.0.0.10:~/.chef/validation.pem .chef/ librarian ã‚’ä½¿ã£ã¦ OpenStack æ§‹ç¯‰ã«å¿…è¦ãª cookbooks ã‚’ãƒ€ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚Cheffile ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«ä½•ã‚’ã©ã“ã‹ã‚‰å–å¾—ã™ã‚‹ã®ã‹è¨˜ã•ã‚Œã„ã¦ãã‚Œã«ã—ãŸãŒã£ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚\nworkstation% libratrian-chef update ç’°å¢ƒã«åˆã‚ã›ã¦ production.yml ã‚’ä¿®æ­£ã—ã¾ã™ã€‚ä»Šå›å¿…è¦æœ€ä½é™ã®ç®‡æ‰€ã®ã¿ä¿®æ­£ã—ã¾ã™ã€‚ \u0026ldquo;osops_networks\u0026rdquo; ã¨ã„ã†ç®‡æ‰€ã« nova-network ã«æ¸¡ã™ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±ãŒã‚ã‚‹ã®ã§ä»Šå›ã® ç’°å¢ƒ 10.0.0.0/24 ã«ä¿®æ­£ã—ã¾ã™ã€‚å…¨ä½“ã¯ã“ã®ã‚ˆã†ãªå†…å®¹ã«ãªã‚Šã¾ã™ã€‚\nworkstation% ${EDITOR} production.yml name \u0026quot;production\u0026quot; description \u0026quot;Defines the network and database settings you're going to use with OpenStack. The networks will be used in the libraries provided by the osops-utils cookbook. This example is for FlatDHCP with 2 physical networks.\u0026quot; override_attributes( \u0026quot;glance\u0026quot; =\u0026gt; { \u0026quot;image_upload\u0026quot; =\u0026gt; true, \u0026quot;images\u0026quot; =\u0026gt; [\u0026quot;precise\u0026quot;,\u0026quot;cirros\u0026quot;], }, \u0026quot;mysql\u0026quot; =\u0026gt; { \u0026quot;allow_remote_root\u0026quot; =\u0026gt; true, \u0026quot;root_network_acl\u0026quot; =\u0026gt; \u0026quot;%\u0026quot; }, \u0026quot;osops_networks\u0026quot; =\u0026gt; { \u0026quot;public\u0026quot; =\u0026gt; \u0026quot;10.0.0.0/24\u0026quot;, \u0026quot;management\u0026quot; =\u0026gt; \u0026quot;10.0.0.0/24\u0026quot;, \u0026quot;nova\u0026quot; =\u0026gt; \u0026quot;10.0.0.0/24\u0026quot; }, \u0026quot;nova\u0026quot; =\u0026gt; { \u0026quot;network\u0026quot; =\u0026gt; { \u0026quot;fixed_range\u0026quot; =\u0026gt; \u0026quot;192.168.100.0/24\u0026quot;, \u0026quot;public_interface\u0026quot; =\u0026gt; \u0026quot;eth0\u0026quot; }, \u0026quot;networks\u0026quot; =\u0026gt; [ { \u0026quot;label\u0026quot; =\u0026gt; \u0026quot;public\u0026quot;, \u0026quot;ipv4_cidr\u0026quot; =\u0026gt; \u0026quot;192.168.100.0/24\u0026quot;, \u0026quot;num_networks\u0026quot; =\u0026gt; \u0026quot;1\u0026quot;, \u0026quot;network_size\u0026quot; =\u0026gt; \u0026quot;255\u0026quot;, \u0026quot;bridge\u0026quot; =\u0026gt; \u0026quot;br100\u0026quot;, \u0026quot;bridge_dev\u0026quot; =\u0026gt; \u0026quot;eth0\u0026quot;, \u0026quot;dns1\u0026quot; =\u0026gt; \u0026quot;8.8.8.8\u0026quot;, \u0026quot;dns2\u0026quot; =\u0026gt; \u0026quot;8.8.4.4\u0026quot; } ] } ) infrastructure.yml ã¨ã„ã† spiceweasel ãŒå‚ç…§ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®æ­£ã‚’è¡Œã„ã¾ã™ã€‚ cookbooks, roles, environments, data bags, node ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚Š node ã®ã¿è¨˜ã•ã‚Œã¦ã„ãªã„ã®ã§ä»Šå›ç”¨æ„ã—ãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒ¼ãƒ‰ã®æƒ…å ±ã‚’è¿½è¨˜ã—ã¾ã™ã€‚\nnode ã«ã¯äºˆã‚ SSH å…¬é–‹éµã‚’è¨­ç½®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸä¸‹è¨˜ã¯ root ãƒ¦ãƒ¼ã‚¶ã§ãƒ­ã‚° ã‚¤ãƒ³ã—ã¦ã„ã¾ã™ãŒã€sudo ã—ã¦ã‚‚ã‚‰ã£ã¦ã‚‚æ§‹ã‚ãªã„ã§ã™ã€‚role ã§æŒ‡å®šã—ãŸ \u0026lsquo;allinone\u0026rsquo; ã¯ OpenStack ã®å…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä¸€å°ã®ãƒãƒ¼ãƒ‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ã‚‚ã® ã§ã™ã€‚ã“ã‚Œã‚’ä»–ã® role ä¾‹ãˆã° \u0026lsquo;keystone\u0026rsquo; ç­‰ã‚’æŒ‡å®šã—ã¦è¤‡æ•°ã®ãƒãƒ¼ãƒ‰ã« OpenStack ã‚’å±•é–‹ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ãªã¯ãšã§ã™ã€‚è©¦ã—ã¦ã„ã¾ã›ã‚“ãŒã€‚\nworkstation% vim infrastructure.yml ... çœç•¥ nodes: - 10.0.0.12: run_list: role[allinone] options: -i ~/.ssh/id_rsa -x root -E production openstack-chef-repo å®Ÿè¡Œ æº–å‚™ãŒæ•´ã£ãŸã®ã§ spiceweasel ã‚’ä½¿ã£ã¦ knife ã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›ãƒã‚§ãƒƒã‚¯ã¨å®Ÿè¡Œã‚’ã—ã¦ ã¿ã¾ã™ã€‚å…ˆã»ã©è¿½è¨˜ã—ãŸ infrastructure.yml ã‚’ä½¿ã„ã¾ã™ã€‚\nworkstation% spiceweasel infrastructure.yml knife cookbook upload apache2 knife cookbook upload apt knife cookbook upload aws knife cookbook upload build-essential knife cookbook upload ntp knife cookbook upload openssh knife cookbook upload openssl knife cookbook upload postgresql knife cookbook upload selinux knife cookbook upload xfs knife cookbook upload yum knife cookbook upload erlang knife cookbook upload mysql knife cookbook upload rabbitmq knife cookbook upload database knife cookbook upload omnibus_updater knife cookbook upload lxc knife cookbook upload sysctl knife cookbook upload osops-utils knife cookbook upload mysql-openstack knife cookbook upload rabbitmq-openstack knife cookbook upload keystone knife cookbook upload glance knife cookbook upload nova knife cookbook upload horizon knife environment from file production.rb knife role from file base.rb knife role from file lxc.rb knife role from file mysql-master.rb knife role from file rabbitmq-server.rb knife role from file keystone.rb knife role from file glance-api.rb knife role from file glance-registry.rb knife role from file glance.rb knife role from file nova-setup.rb knife role from file nova-scheduler.rb knife role from file nova-api-ec2.rb knife role from file nova-api-os-compute.rb knife role from file nova-volume.rb knife role from file nova-vncproxy.rb knife role from file horizon-server.rb knife role from file single-controller.rb knife role from file single-compute.rb knife role from file allinone.rb knife bootstrap 10.0.0.12 -i ~/.ssh/id_rsa -x root -E production -r 'role[allinone]' ã“ã®æ“ä½œã§ spiceweasel ã¯ role ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã¨ yml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿ã€ä¾å­˜é–¢ä¿‚ã‚’ ãƒã‚§ãƒƒã‚¯ã—ã¦ãã‚Œã¾ã™ã€‚\nã§ã¯ã„ã‚ˆã„ã‚ˆå®Ÿè¡Œã€‚\nworkstaion% spiceweasel -e infrastructure.yml æ•°åˆ†ã§ OpenStack ç’°å¢ƒãŒæ§‹ç¯‰å‡ºæ¥ã‚‹ã¨æ€ã„ã¾ã™ã€‚\næ‰€æ„Ÿ ç¾æ™‚ç‚¹ã§ã¯ã¾ã  essex ãƒ™ãƒ¼ã‚¹ã® OpenStack ã—ã‹æ§‹ç¯‰å‡ºæ¥ãªã„ã€‚folsom ä»¥é™ã«ã¤ã„ã¦ ã¯ç›´ã¡ã«è¡Œã‚ã‚Œã‚‹ã€‚ã¾ãŸå…ˆã«ã‚‚è¨˜ã—ãŸãŒ Opscode ã¨ RackSpace ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒå…±åŒã§ ä½œæ¥­ã«å…¥ã£ãŸã®ã§ä»Šå¾Œã«æœŸå¾…ã€‚è¤‡æ•°ã® OpenStack cookboooks ã‚’è¦‹ã¦ããŸãŒå€‹äººã§é–‹ç™º ã™ã‚‹ã®ã¯å³ã—ã„ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚fedra, centos, ubuntu, debian \u0026hellip; ã„ã‚ã‚“ãªãƒ—ãƒ©ãƒƒ ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’å‰æã«é–‹ç™ºã™ã‚‹ã®ã¯å³ã—ã„\u0026hellip;ã€‚pull request ã™ã‚‹ä½™åŠ›ãŒã‚ã‚Œã°ã‚„ã£ã¦ã¿ ãŸã„ã€‚ã¾ãŸåˆã‚ã›ã¦å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® cookbooks ã«ã¤ã„ã¦ã‚‚åŒæ§˜ã«å‚åŠ ã—ã¦ã„ããŸ ã„ã€‚\nchef ã¯ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã•ã‚Œã‚‹ã®ã§ç¶™ç¶šçš„ã«ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¯èƒ½ã§ã‚ã‚Šã€chef Resources ãŒæˆ‘ã€… ã®æ“ä½œã‚’æŠ½è±¡åŒ–ã—ã¦ãã‚Œã‚‹ã€‚å°šä¸”ã¤ API ã§é–‹ç™ºã‚‚å®¹æ˜“ã«ãªã‚‹ã€‚å­¦ç¿’ã‚³ã‚¹ãƒˆã¯è‹¥å¹²é«˜ã„ ã—ã€cookbooks ã®é–‹ç™ºã‚‚æ­£ç›´ã—ã‚“ã©ã„ã€‚ã ã‘ã©ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ chef ã§ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã™ã‚‹æ„ å‘³ã¯ã¨ã¦ã‚‚å¤§ãã„ã€‚ãã®ä»–ã®ãƒ¡ãƒªãƒƒãƒˆã¨ã—ã¦å±äººçš„ãªæ“ä½œã«ä¾å­˜ã—ãŸã‚·ã‚¹ãƒ†ãƒ ã‚’ç„¡ãã™ ã¨ã„ã†äº‹ã‚‚ã‚ã‚‹ã€‚\nOpenStack ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã¨ã—ã¦ dodai-deploy ã¨ puppet ãŒæ²è¼‰ã• ã‚Œã¦ã„ã‚‹ã€‚chef ã¯è¼‰ã£ã¦ã„ãªã„ã€‚ã“ã‚Œã¯ cookbooks ã®é–‹ç™ºãŒé…ã‚Œã¦ã„ã‚‹çŠ¶æ³ãŒç†ç”±ã« ã‚ã‚‹ã¨æ€ã†ã€‚ä»Šå› Opscode ã®ä¸­ã® Matt Ray ã•ã‚“ã®ä¸‹è¨˜ã®è³‡æ–™\nhttp://www.slideshare.net/mattray/chef-11-previewchef-for-openstack\nã‚’è¦‹ã¦ã€ã“ã‚Œã‹ã‚‰ã«æœŸå¾…ã—ãŸã„ã¨æ„Ÿã˜ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/02/10/di-11hui-openstack-study11-openstack-chef-repo/","summary":"\u003cp\u003e2013å¹´2æœˆ9æ—¥ã«è¡Œã‚ã‚ŒãŸ OpenStack å‹‰å¼·ä¼šç¬¬11å›ã§è©±ã—ã¦ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eopenstack-chef-repo ã¨è¨€ã†ã€Opscode Chef ã§ OpenStack ã‚’æ§‹ç¯‰ã™ã‚‹å†…å®¹ã‚’è©±ã—ã¦\nãã¾ã—ãŸã€‚ãã®æ™‚ã«èª¬æ˜å‡ºæ¥ãªã‹ã£ãŸè©³ç´°ã«ã¤ã„ã¦ãƒ–ãƒ­ã‚°ã«æ›¸ã„ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003ciframe src=\"http://www.slideshare.net/slideshow/embed_code/16434817\"\nwidth=\"427\" height=\"356\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\"\nscrolling=\"no\" style=\"border:1px solid #CCC;border-width:1px 1px\n0;margin-bottom:5px\" allowfullscreen webkitallowfullscreen mozallowfullscreen\u003e\n\u003c/iframe\u003e \u003cdiv style=\"margin-bottom:5px\"\u003e \u003cstrong\u003e \u003ca\nhref=\"http://www.slideshare.net/tomokazubobhirai/openstack-chefrepo\"\ntitle=\"Openstack chef-repo\" target=\"_blank\"\u003eOpenstack chef-repo\u003c/a\u003e \u003c/strong\u003e\nfrom \u003cstrong\u003e\u003ca href=\"http://www.slideshare.net/tomokazubobhirai\"\ntarget=\"_blank\"\u003eTomokazu Hirai\u003c/a\u003e\u003c/strong\u003e \u003c/div\u003e\n\u003cp\u003eèª¬æ˜ã§ä½¿ã£ãŸã‚¹ãƒ©ã‚¤ãƒ‰ã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ã¾ãˆãŒã\"\u003eã¾ãˆãŒã\u003c/h2\u003e\n\u003cp\u003eEssex ãƒ™ãƒ¼ã‚¹ã§æ§‹ç¯‰ã™ã‚‹ã“ã¨ã—ã‹ä»Šã¯å‡ºæ¥ã¾ã›ã‚“ã€‚Folsom ã«é–¢ã—ã¦ã¯ \u0026lsquo;ç›´ã¡ã«é–‹ç™ºãŒ\nã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹\u0026rsquo; ã¨è¨˜ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚ä»Šå›ã¯ Opscode ã¨ RackSpace ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒå…±\nåŒã§é–‹ç™ºã‚’é€²ã‚ã¦ã„ã‚‹ã®ã§æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚ä»Šã¾ã§å€‹äººã§ OpenStack ã®å„ã‚³ãƒ³ãƒãƒ¼ãƒ\nãƒ³ãƒˆã® cookbook ã‚’é–‹ç™ºã•ã‚Œã¦ã„ãŸæ–¹ãŒã„ã‚‰ã£ã—ã‚ƒã‚‹ã®ã ã‘ã©æ±ç”¨æ€§ã‚’æŒãŸã›ã‚‹ã¨ã„ã†\næ„å‘³ã§éå¸¸ã«é›£ã—ãã€ã¾ãŸã©ã®æ–¹ã®é–‹ç™ºã«è¿½å¾“ã—ã¦ã„ã‘ã°ã‚ˆã„ã‹åˆ¤æ–­å›°ã£ã¦ã„ã¾ã—ãŸã€‚\nã‚ˆã£ã¦ä»Šå›ã“ãæœŸå¾…ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æã®æ§‹æˆ\"\u003eå‰æã®æ§‹æˆ\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003e+-------------+\n| chef-server |\n+-------------+ 10.0.0.10\n|\n+---------------+ 10.0.0.0/24\n|               |\n+-------------+ +-------------+\n| workstation | |    node     |\n+-------------+ +-------------+\n10.0.0.11       10.0.0.12\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003echef-server : chef API ã‚’æŒã¤ chef-server ã€‚cookbook, role..ãªã©ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŒã¤\u003c/li\u003e\n\u003cli\u003eworkstation : openstack-chef-repo ã‚’ä½¿ã†ãƒãƒ¼ãƒ‰ã€‚knife ãŒä½¿ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚\u003c/li\u003e\n\u003cli\u003enode        : OpenStack ã‚’æ§‹ç¯‰ã™ã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒ¼ãƒ‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ç›®æ¬¡\"\u003eç›®æ¬¡\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003echef-server ã®æ§‹ç¯‰ (BootStrap ä½¿ã†)\u003c/li\u003e\n\u003cli\u003eopenstack-chef-repo ã‚’ä½¿ç”¨ã™ã‚‹æº–å‚™\u003c/li\u003e\n\u003cli\u003eopenstack-chef-repo å®Ÿè¡Œ\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"chef-server-ã®æ§‹ç¯‰\"\u003echef-server ã®æ§‹ç¯‰\u003c/h2\u003e\n\u003cp\u003eOpscode ã® wiki ã«è¨˜ã•ã‚Œã¦ã„ã‚‹é€šã‚Šãªã®ã§ã™ãŒã€ç°¡å˜ã«æ›¸ã„ã¦ãŠãã¾ã™ã€‚ä»Šå›ã¯\nbootstrap æ–¹å¼ã§ç”¨æ„ã—ã¾ã™ã€‚\u003c/p\u003e","title":"ç¬¬11å›OpenStackå‹‰å¼·ä¼šã§è©±ã—ã¦ããŸ"},{"content":"Spiceweasel https://github.com/mattray/spiceweasel#cookbooks ã‚’ä½¿ã£ã¦ã¿ãŸã€‚\nSpiceweasel ã¯ Chef ã® cookbook ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰, role/cookbook ã® chef server ã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰, ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ç­‰ã‚’ãƒãƒƒãƒå‡¦ç†çš„ã«è¡Œãªã£ã¦ãã‚Œã‚‹(ã‚‚ã—ãã¯ã‚³ ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’å‡ºåŠ›ã—ã¦ãã‚Œã‚‹)ãƒ„ãƒ¼ãƒ«ã§ã€è‡ªåˆ†çš„ã«ã‚¤ã‚±ã¦ã‚‹ãªã¨æ„Ÿã˜ãŸã®ã§ãƒ–ãƒ­ã‚°ã« æ›¸ã„ã¦ãŠãã¾ã™ã€‚\nã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çš„ã‚µãƒ¼ãƒ“ã‚¹ã¨ã„ã†ã‹ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã¨ã„ã†ã‹ã€è¤‡æ•° ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚’æ‰±ãˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã¯å¢—ãˆã¦ãã¦ã„ã‚‹ã‘ã©ã€chef ã‚’æ‰±ãˆã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã‚ã‚Œ ã°ã€ã“ã® Spiceweasel ã§ç°¡å˜ãƒ»ä¸€æ‹¬ãƒ‡ãƒ—ãƒ­ã‚¤å‡ºæ¥ã‚‹ã®ã§è‰¯ã„ã®ã§ã¯ãªã„ã‹ã¨ã€‚\næ—©é€Ÿã ã‘ã© chef-repo ã«ã“ã‚“ãª yamp ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚\ncookbooks: - apt: - nginx: roles: - base: nodes: - 172.24.17.3: run_list: role[base] options: -i ~/.ssh/testkey01 -x root -N webset01 - 172.24.17.4: run_list: role[base] options: -i ~/.ssh/testkey01 -x root -N webset02 ä¸Šã‹ã‚‰èª¬æ˜ã™ã‚‹ã¨\u0026hellip;\n\u0026lsquo;apt\u0026rsquo;, \u0026rsquo;nginx\u0026rsquo; ã® cookbook ã‚’ opscode ãƒ¬ãƒã‚¸ãƒˆãƒªã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ \u0026lsquo;apt\u0026rsquo;, \u0026rsquo;nginx\u0026rsquo; ã® cookbook ã‚’ chef-server ã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ roles/base.rb ã‚’ chef-server ã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ 2ã¤ã®ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦ bootstrap ä»•æ›ã‘ã‚‹ ã£ã¦ã“ã¨ã‚’ã‚„ã‚‹ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚äºˆã‚ chef-repo ã¨ roles ã¯ç”¨æ„ã—ã¦ã‚ã’ã‚‹å¿…è¦ ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®è¾ºã‚Šã¯ knife ã®æ“ä½œã®ãŸã‚ã®æº–å‚™ã¨å…¨ãåŒã˜ã€‚ã¾ãŸ Spiceweasel ã¯ã€ ã“ã® yaml ãƒ•ã‚£ã‚¢ãƒ«å†…ã®å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚„æŒ‡å®šã—ãŸ role ã®å†…å®¹ã®ä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯ã— ã¦ãã‚Œã¾ã™ã€‚\nã§ã¯ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦\n% spiceweasel \u0026lt;yaml ãƒ•ã‚¡ã‚¤ãƒ«å\u0026gt; ã™ã‚‹ã¨ã€çµæœã¨ã—ã¦ä¸‹è¨˜ã®ã‚ˆã†ãªãƒãƒƒãƒãŒå–å¾—å‡ºæ¥ã‚‹ã€‚\nknife cookbook site download apt --file cookbooks/apt.tgz tar -C cookbooks/ -xf cookbooks/apt.tgz rm -f cookbooks/apt.tgz knife cookbook upload apt knife cookbook site download test --file cookbooks/test.tgz tar -C cookbooks/ -xf cookbooks/test.tgz rm -f cookbooks/test.tgz knife cookbook upload test knife role from file base.rb knife bootstrap 172.24.17.3 -i ~/.ssh/testkey01 -x root -N webset01 -r 'role[base]' knife bootstrap 172.24.17.4 -i ~/.ssh/testkey01 -x root -N webset02 -r 'role[base]' å°šä¸”ã¤ -e ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã¨ã€å®Ÿéš›ã«ã“ã‚Œã‚‰ã®ãƒãƒƒãƒã‚’å®Ÿè¡Œå‡ºæ¥ã‚‹ã€‚cookbooks ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«äºˆã‚ãƒ¬ã‚·ãƒ”ãŒå­˜åœ¨ã™ã‚Œã°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®ãƒãƒƒãƒã¯çœç•¥ã•ã‚Œã‚‹ã½ã„ã—ã€-d ã‚’æŒ‡å®šã™ã‚‹ã¨é€†ã«ãƒãƒ¼ãƒ‰å‰Šé™¤ãƒãƒƒãƒå‡¦ç†ã€-r ã§ãƒªãƒ“ãƒ«ãƒ‰ã®ãŸã‚ã®ãƒãƒƒãƒå‡¦ç†ãŒå¾—ã‚‰ã‚Œ ã‚‹ã€‚\nå‰Šé™¤ç³»ãƒ»ãƒªãƒ“ãƒ«ãƒ‰ç³»ã¯ç¾æ™‚ç‚¹ã§ã¯ä¸å…·åˆãŒè¦‹ã‚‰ã‚Œã¾ã—ãŸã€‚å®Ÿè¡Œã™ã‚‹ã¨ä»–ã®ç’°å¢ƒã«ã‚‚å½±éŸ¿ å‡ºã‚‹ã®ã§æ³¨æ„ãŒå¿…è¦ã€‚\nå€‹äººçš„ã«ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ãƒã‚¸ãƒˆãƒªã® cookbooks ã‚‚å–ã£ã¦ã“ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã¨å¬‰ã—ã„ã€‚ ã¾ãã€Berkshelf ä½¿ãˆã°ã„ã„ã®ã ã‘ã©ã€‚http://berkshelf.com/\né–‹ç™ºè€…ã® Matt Ray ã•ã‚“ã®è³‡æ–™ã«ã‚ˆã‚Œã° Chef for OpenStack ã‚‚ã“ã® Spiceweasel ã‚’ ä½¿ã†æ–¹å‘ã§ä¿®æ­£ãŒæ›ã‹ã£ãŸã‚‰ã—ã„ã€‚å€‹äººçš„ã«ã¯ä¸€ç•ªèˆˆå‘³ã‚ã‚‹ã¨ã“ã‚ã€‚ã¡ãªã¿ã« Chef for OpenStack ã¯ folsom ãƒ™ãƒ¼ã‚¹ãŒç¾åœ¨ \u0026lsquo;active development\u0026rsquo; çŠ¶æ…‹ã‚‰ã—ã„ã€‚\nOpscode ã®ã‚µã‚¤ãƒˆã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã¯å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã®æŒ‡å®šæ–¹æ³•ã‚‰ã—ãã€æ³¨ æ„ãŒå¿…è¦ã§ã™ã€‚\nhttp://wiki.opscode.com/display/chef/Spiceweasel\næ‰€æ„Ÿ chef, knife å‘¨ã‚Šã¯ã„ã‚ã‚“ãªé–¢é€£æŠ€è¡“ãŒã‚ã‚‹ã®ã§æŠ€è¡“ã‚’é¸å®šã™ã‚‹ä¸Šã§è¿·ã£ã¦ã—ã¾ã†ã“ã¨ ãŒå¤šã„ã®ã ã‘ã©ã€ã“ã® Spiceweasel ã«ã¯å¯èƒ½æ€§ã‚’æ„Ÿã˜ã¾ã—ãŸã€‚ã£ã¦è¨€ã†ã®ã¯ã€Chef ãŒ å®Ÿè£…å‡ºæ¥ã¦ã„ãªã„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã£ã¦ã„ã†æ‰€ã¾ã§è¸ã¿è¾¼ã‚ ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‹ã‚‰ã€‚ãƒãƒ¼ãƒ‰é–“ã®é–¢é€£ä»˜ã‘ãŒå‡ºæ¥ã‚‹ã‚“ã§ã™ã€‚Swift-Storage ã¨ Swift-Proxy ã®é–¢é€£ä»˜ã‘ã€ã¾ãŸã¯ Load-Balancer ã¨ HTTP-Server ã®é–¢é€£ä»˜ã‘ç­‰ã€‚ç¶™ç¶š çš„ãƒ‡ãƒªãƒãƒªãªã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã£ã¦ Chef ã‚’ä½¿ã£ã¦ã©ã†å®Ÿç¾ã™ã‚‹ã‚“ã ï¼Ÿã£ã¦æ€ã£ã¦ã„ ãŸæ™‚ãŒã‚ã£ãŸã®ã§ã™ãŒã€ã“ã†ã„ã£ãŸãƒ©ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã®ç™»å ´ã§è§£æ±ºã•ã‚Œãã†ãªæ°—ãŒã—ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/02/01/spiceweasel-knife-bootstrap/","summary":"\u003cp\u003eSpiceweasel \u003ca href=\"https://github.com/mattray/spiceweasel#cookbooks\"\u003ehttps://github.com/mattray/spiceweasel#cookbooks\u003c/a\u003e ã‚’ä½¿ã£ã¦ã¿ãŸã€‚\u003c/p\u003e\n\u003cp\u003eSpiceweasel ã¯ Chef ã® cookbook ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰, role/cookbook ã® chef server\nã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰, ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ç­‰ã‚’ãƒãƒƒãƒå‡¦ç†çš„ã«è¡Œãªã£ã¦ãã‚Œã‚‹(ã‚‚ã—ãã¯ã‚³\nãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’å‡ºåŠ›ã—ã¦ãã‚Œã‚‹)ãƒ„ãƒ¼ãƒ«ã§ã€è‡ªåˆ†çš„ã«ã‚¤ã‚±ã¦ã‚‹ãªã¨æ„Ÿã˜ãŸã®ã§ãƒ–ãƒ­ã‚°ã«\næ›¸ã„ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çš„ã‚µãƒ¼ãƒ“ã‚¹ã¨ã„ã†ã‹ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã¨ã„ã†ã‹ã€è¤‡æ•°\nã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚’æ‰±ãˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã¯å¢—ãˆã¦ãã¦ã„ã‚‹ã‘ã©ã€chef ã‚’æ‰±ãˆã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã‚ã‚Œ\nã°ã€ã“ã® Spiceweasel ã§ç°¡å˜ãƒ»ä¸€æ‹¬ãƒ‡ãƒ—ãƒ­ã‚¤å‡ºæ¥ã‚‹ã®ã§è‰¯ã„ã®ã§ã¯ãªã„ã‹ã¨ã€‚\u003c/p\u003e\n\u003cp\u003eæ—©é€Ÿã ã‘ã© chef-repo ã«ã“ã‚“ãª yamp ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ecookbooks:\n- apt:\n- nginx:\n\nroles:\n- base:\n\nnodes:\n- 172.24.17.3:\n    run_list: role[base]\n    options: -i ~/.ssh/testkey01 -x root -N webset01\n- 172.24.17.4:\n    run_list: role[base]\n    options: -i ~/.ssh/testkey01 -x root -N webset02\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä¸Šã‹ã‚‰èª¬æ˜ã™ã‚‹ã¨\u0026hellip;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u0026lsquo;apt\u0026rsquo;, \u0026rsquo;nginx\u0026rsquo; ã® cookbook ã‚’ opscode ãƒ¬ãƒã‚¸ãƒˆãƒªã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\u003c/li\u003e\n\u003cli\u003e\u0026lsquo;apt\u0026rsquo;, \u0026rsquo;nginx\u0026rsquo; ã® cookbook ã‚’ chef-server ã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰\u003c/li\u003e\n\u003cli\u003eroles/base.rb ã‚’ chef-server ã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰\u003c/li\u003e\n\u003cli\u003e2ã¤ã®ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦ bootstrap ä»•æ›ã‘ã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã£ã¦ã“ã¨ã‚’ã‚„ã‚‹ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚äºˆã‚ chef-repo ã¨ roles ã¯ç”¨æ„ã—ã¦ã‚ã’ã‚‹å¿…è¦\nãŒã‚ã‚Šã¾ã™ã€‚ã“ã®è¾ºã‚Šã¯ knife ã®æ“ä½œã®ãŸã‚ã®æº–å‚™ã¨å…¨ãåŒã˜ã€‚ã¾ãŸ Spiceweasel ã¯ã€\nã“ã® yaml ãƒ•ã‚£ã‚¢ãƒ«å†…ã®å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚„æŒ‡å®šã—ãŸ role ã®å†…å®¹ã®ä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯ã—\nã¦ãã‚Œã¾ã™ã€‚\u003c/p\u003e","title":"Spiceweasel ã§ knife ãƒãƒƒãƒå‡¦ç†"},{"content":"(2013/08/31 ä¿®æ­£ã—ã¾ã—ãŸ)\nè‡ªå®…ã®ãƒãƒ¼ãƒˆ PC ã«ã„ã¤ã‚‚ Debian Gnu/Linux unstable ã‚’å…¥ã‚Œã¦ä½œæ¥­ã—ã¦ãŸã®ã ã‘ã©ã€ Arch Linux ãŒè©¦ã—ãŸããªã£ã¦å…¥ã‚Œã¦ã¿ãŸã€‚ã™ã”ãã‚¤ã‚¤ã€‚ãƒŸãƒ‹ãƒãƒ«æ€è€ƒã§å¸¸ã«æœ€æ–°ã€‚ç«¯ æœ«ã«å…¥ã‚Œã‚‹ OS ã¨ã—ã¦ã¯æœ€é©ã‹ã‚‚!ã¨æ€ãˆã¦ããŸã€‚Ubuntu ã¯ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç’°å¢ƒã§æ‰±ã† ã«ã¯ãƒãƒˆå¤§ãã™ãã‚‹ã—ã€‚FreeBSD ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å¾…ã¡æ™‚é–“ãŒæœ€è¿‘è€ãˆã‚‰ã‚Œãªã„ã—\u0026hellip;ã€‚\nå‰ãƒªãƒªãƒ¼ã‚¹ã® Arch Linux ã«ã¯ /arch/setup ã¨ã„ã†ç°¡æ˜“ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãŒã‚ã£ãŸã®ã ã‘ ã©ã€ãã‚Œã™ã‚‰æœ€è¿‘ç„¡ããªã£ãŸã€‚ç’°å¢ƒä½œã‚‹æ–¹æ³•ã‚’è‡ªåˆ†ã®ãŸã‚ã«ã‚‚ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚\nOS ã‚¤ãƒ¡ãƒ¼ã‚¸ iso å–å¾—ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç”¨ USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯ä½œæˆ Linux, Windows, Mac ã§ä½œã‚Šæ–¹ãŒå¤‰ã‚ã‚‹ã‚ˆã†ã ã‘ã©ã€è‡ªåˆ†ã¯ Mac OSX ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ ãƒˆãƒ¼ãƒ« USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã‚’ä½œæˆã—ãŸã€‚\ndiskutil ã§ USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯è£…ç€å‰å¾Œã® disk ãƒ‡ãƒã‚¤ã‚¹ç•ªå·ã‚’è¦šãˆã‚‹\n% diskutil list (ã“ã“ã§ã¯ /dev/rdisk4 ã¨ã—ã¦é€²ã‚ã‚‹ã€‚)\nã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã€‚\n% sudo diskutil unmountDisk /dev/rdisk4 ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ iso ã‚’ USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã«æ›¸ãè¾¼ã‚€ã€‚\n% sudo dd if=/path/to/downloaded/iso of=/dev/rdisk4 bs=8192 % sudo diskutil eject /dev/rdisk4 USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯è£…ç€ã—ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«é–‹å§‹ èµ·å‹•ã™ã‚‹ã¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ x86_64 ã‚’é¸ã‚“ã§èµ·å‹•ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚\nã¾ãš disk ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ä½œæˆã€‚\n# fdisk /dev/sda # ç’°å¢ƒã«åˆã‚ã›ã¦ãƒ‡ãƒã‚¤ã‚¹åå¤‰æ›´ # fdisk -l /dev/sda ãƒ‡ãƒã‚¤ã‚¹ ãƒ–ãƒ¼ãƒˆ å§‹ç‚¹ çµ‚ç‚¹ ãƒ–ãƒ­ãƒƒã‚¯ Id ã‚·ã‚¹ãƒ†ãƒ  /dev/sda1 2048 4196351 2097152 82 Linux ã‚¹ãƒ¯ãƒƒãƒ— / Solaris /dev/sda2 * 4196352 156301487 76052568 83 Linux ä¸Šè¨˜ã®ã‚ˆã†ã«åˆ‡ã‚Šã¾ã—ãŸã€‚fdisk ã®ä½¿ã„æ–¹ã¯\u0026hellip;ããã£ã¦ãã ã•ã„ã€‚ã¾ãŸ /boot ã«ã‚ãŸã‚‹ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ ã«ãƒ–ãƒ¼ãƒˆãƒ•ãƒ©ã‚°ã‚’å¿…ãšä»˜ã‘ã‚‹ã“ã¨ã€‚\nãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œã£ã¦ãƒã‚¦ãƒ³ãƒˆã€‚\n# mkfs.ext4 /dev/sda2 # mount -t ext4 /dev/sda2 /mnt ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\n# pacstrap /mnt base base-devel fstab ã®é…ç½®ã€‚å¿…è¦ã«å¿œã˜ã¦ /dev/sda1 (ä¸Šè¨˜ã§ä½œã£ãŸ) ã‚’ã‚¹ãƒ¯ãƒƒãƒ—ã¨ã—ã¦åŠ ç­†ã€‚\n# genfstab -p /mnt \u0026gt;\u0026gt; /mnt/etc/fstab chroot ã—ã¦ /dev/sda2 å†…ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ ã§ä½œæ¥­ chroot ã™ã‚‹ã€‚\n# arch-chroot /mnt ã‚­ãƒ¼ãƒãƒƒãƒ—ã‚’ us é…åˆ—ã§ CTRL ã¨ Caps ã‚’ã‚¹ãƒ¯ãƒƒãƒ—ã—ãŸã„ã®ã§ä¸‹è¨˜ã®ä½œæ¥­ã‚’å®Ÿæ–½ã€‚\n# cd /usr/share/kbd/keymaps/i386/qwerty # cp us.map.gz usx.map.gz # gunzip usx.map.gz # vi usx.map keycode 58 = Control # Caps_Lock ã‚’ Control ã«ç½®ãæ›ãˆ # gzip usx.map # loadkeys usx # ã‚­ãƒ¼ãƒãƒƒãƒ—ã‚’ãƒ­ãƒ¼ãƒ‰ # vi /etc/vconsole.conf KEYMAP=usx # è¿½è¨˜ ãƒ­ã‚±ãƒ¼ãƒ«ã®ç”Ÿæˆã€‚\n# vi /etc/locale.gen # ja_JP.UTF-8 ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å‰Šé™¤ # locale-gen ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®è¨­å®šã€‚\n# ln -s /usr/share/zoneinfo/Asia/Tokyo /etc/localtime ãƒ›ã‚¹ãƒˆåä¿®æ­£ã€‚\n# echo \u0026quot;\u0026lt;ãƒ›ã‚¹ãƒˆå\u0026gt;\u0026quot; \u0026gt; /etc/hostname # vi /etc/hosts # é©å®œä¿®æ­£ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è¨­å®šã€‚ã¾ãšã¯æœ‰ç·šã€‚\n# systemctl enable dhcpcd@eth0.service ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ã¨ã—ã¦ syslinux ã‚’ä½¿ã†ã€‚ãƒ‡ã‚£ã‚¹ã‚¯ãƒ‡ãƒã‚¤ã‚¹åã ã‘ä¿®æ­£ã€‚syslinux ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãŒ ã†ã¾ããƒ‡ãƒã‚¤ã‚¹åã‚’æ‹¾ã£ã¦ãã‚Œãªã„ã€‚\n# pacman -S syslinux # vi /boot/syslinux/syslinux.cfg LABEL arch MENU LABEL Arch Linux LINUX ../vmlinuz-linux APPEND root=/dev/sda2 ro INITRD ../initramfs-linux.img ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã€‚\n# passwd å†èµ·å‹•ã— ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ /dev/sda2 ã§èµ·å‹•ã™ã‚‹ã€‚ å†èµ·å‹•ã— USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã‚’æŠœãã€‚èµ·å‹•ã—ãŸã‚‰ root ãƒ¦ãƒ¼ã‚¶ã§ãƒ­ã‚°ã‚¤ãƒ³ã€‚\nç„¡ç·šãƒ‡ãƒã‚¤ã‚¹ã®è¨­å®šã€‚\n# pacman -S dialog wpa_supplicant # wifi-menu æ¤œçŸ¥ã•ã‚ŒãŸã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆåãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§å¸Œæœ›ã®ãƒ¢ãƒã‚’é¸æŠã—ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’å…¥åŠ›ã€‚\nä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ã®ä½œæˆã¨ sudo è¨­å®šã€‚\n# useradd -u \u0026lt;UID) -d /home/\u0026lt;UESRNAME\u0026gt; -m \u0026lt;USERNAME\u0026gt; # passwd \u0026lt;USERNAME\u0026gt; # pacman -S sudo # vigr # wheel ã‚°ãƒ«ãƒ¼ãƒ—ã«è‡ªåˆ†ã‚’è¿½è¨˜ # visudo # wheel ã®ã¨ã“ã‚ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å‰Šé™¤ %wheel ALL=(ALL) ALL X å‘¨ã‚Šã®è¨­å®š X ã¨ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒãƒãƒ¼ã‚¸ãƒ£ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒãƒãƒ¼ã‚¸ãƒ£ã¯å¥½ããªã‚‚ã®ã‚’ã€‚ç§ ã¯ awesome ã‚’é¸ã³ã¾ã—ãŸã€‚\n# pacman -S xorg xorg-xinit xterm rxvt-unicode xf86-video-intel awesome æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨æ—¥æœ¬èªã‚¤ãƒ³ãƒ—ãƒƒãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã®è¨­å®šã€‚ibus ã¨ mozc ã‚’é¸ã‚“ã ã€‚ çµæ§‹è³¢ã„ã€‚ã¨ã‚Šã‚ãˆãšã®ãƒ•ã‚©ãƒ³ãƒˆã¨ã—ã¦ sazanami ã‚’ã€‚\n# vi /etc/pacman.conf # ä¸‹è¨˜ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’è¿½è¨˜ [pnsft-pur] SigLevel = Optional TrustAll Server = http://downloads.sourceforge.net/project/pnsft-aur/pur/$arch # pacman -Syy # pacman -S ttf-sazanami ibus-mozc mozc ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ã® ~/.xinitrc ã«ä¸‹è¨˜ã‚’è¿½è¨˜ã€‚\n% vi ~/.xinitrc xrdb -merge $HOME/.Xresources export LANG=ja_JP.UTF-8 export LANGUAGE=ja_JP.UTF-8 export LC_ALL=ja_JP.UTF-8 export LC_CTYPE=ja_JP.UTF-8 export GTK_IM_MODULE=ibus export QT_IM_MODULE=xim export XMODIFIERS=@im=ibus ibus-daemon --daemonize --xim \u0026amp; setxkbmap -layout us -option ctrl:nocaps exec awesome X ã‚’èµ·å‹•ã€‚\n% startx ç§ã¯ awesome ã‚’é¸ã³ã¾ã—ãŸãŒã€ãŸã¾ã« enlightenment ã‚‚é¸æŠã—ã¾ã™ã€‚ã“ã®æ™‚ç‚¹ã§ enlightenment ã® ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãªã©ã€æ—¥æœ¬èªåŒ–ã•ã‚Œã¦ã„ã‚‹ã¯ãšã ãŒã€å³ã—ã‘ã‚Œã°\nhttps://wiki.archlinux.org/index.php/Input_Japanese_using_uim_(%E6%97%A5%E6%9C%AC%E8%AA%9E)\nã«ã‚ã‚‹ IPA ãƒ•ã‚©ãƒ³ãƒˆã€VL ã‚´ã‚·ãƒƒã‚¯ãªã©ã‚’å…¥ã‚Œã‚‹ã€‚ã“ã¡ã‚‰ã®ã»ã†ãŒæ•°æ®µç¶ºéº—ã€‚\nIPA ãƒ•ã‚©ãƒ³ãƒˆã®å…¥ã‚Œæ–¹ã ã‘ãƒ¡ãƒ¢ã£ã¦ãŠãã€‚\n% wget https://aur.archlinux.org/packages/ot/otf-ipafont/otf-ipafont.tar.gz % tar zxvf otf-ipafont.tar.gz % cd otf-ipafont % makepkg -s % sudo pacman -U \u0026lt;ç”Ÿæˆã•ã‚ŒãŸ pkg.tar.xz ãƒ•ã‚¡ã‚¤ãƒ«\u0026gt; Thinkpad ã®çœŸã‚“ä¸­ãƒœã‚¿ãƒ³ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ã€‚\n# vi /etc/X11/xorg.conf.d/10-thinkpad.conf # æ–°è¦ç”Ÿæˆ Section \u0026quot;InputClass\u0026quot; Identifier \u0026quot;Trackpoint Wheel Emulation\u0026quot; MatchProduct \u0026quot;TPPS/2 IBM TrackPoint|DualPoint Stick|Synaptics Inc. Composite TouchPad / TrackPoint|ThinkPad USB Keyboard with TrackPoint|USB Trackpoint pointing device|Composite TouchPad / TrackPoint\u0026quot; MatchDevicePath \u0026quot;/dev/input/event*\u0026quot; Option \u0026quot;EmulateWheel\u0026quot; \u0026quot;true\u0026quot; Option \u0026quot;EmulateWheelButton\u0026quot; \u0026quot;2\u0026quot; Option \u0026quot;Emulate3Buttons\u0026quot; \u0026quot;false\u0026quot; Option \u0026quot;XAxisMapping\u0026quot; \u0026quot;6 7\u0026quot; Option \u0026quot;YAxisMapping\u0026quot; \u0026quot;4 5\u0026quot; EndSection X ã®å†èµ·å‹•ã‚’ã—ã¦çµ‚äº†ã€‚\nã¾ã¨ã‚ ä»Šå›ã¯ãƒ–ãƒ­ã‚°ã¨ã„ã†ã‚ˆã‚Šé›‘å¤šãªã¾ã¨ã‚ã«ãªã£ãŸã‘ã©ã€ãƒ¡ãƒ¢ã™ã‚‹ã ã‘ã§ã‚‚æ„å‘³ãŒã‚ã‚‹ã®ã§ æ®‹ã—ã¦ãŠã„ãŸã€‚Debian / Ubuntu ã‚ˆã‚Šæ‰‹é–“ã¯æ›ã‹ã‚‹ã‘ã©ã€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒä½•ã‚’ã‚„ã£ã¦ã„ã‚‹ ã‹æ´ã‚ã‚‹ã®ã§ã„ã„ã‚«ãƒ³ã‚¸ã€‚ç„¡é§„ãªãƒ—ãƒ­ã‚»ã‚¹ã„ãªã„ã®ã§èµ·å‹•ã‚‚ã‚ã¡ã‚ƒé€Ÿã„ã—ã€‚ä½•ã‚ˆã‚Šæœ€æ–° ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ (å®‰å®šã—ãŸã‚‚ã®) ãŒç°¡å˜ã«ä½¿ãˆã‚‹ã®ã¯å¬‰ã—ã„ã€‚ã“ã“ã«æ›¸ã„ãŸæ‰‹é †ã¯æ™‚é–“ ãŒã™ãã‚‹ã«é€£ã‚Œã¦æ„å‘³ãŒãªã„ã‚‚ã®ã«ãªã£ã¦ã„ãã ã‚ã†ã€‚é–‹ç™ºãŒæ´»ç™ºã§ã“ã“æ•°å¹´ã§ã‚‚çµæ§‹ åŠ‡çš„ã«ã‚·ã‚¹ãƒ†ãƒ ãŒå¤‰æ›´ã«ãªã£ã¦ã‚‹ã¿ãŸã„ã€‚systemd .. ã¨ã‹ã€‚ç†è§£ã™ã‚‹ã®ã«è‹¦åŠ´ã™ã‚‹æ‰€ ã¯ãªã„ã®ã§ã€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã‚ã‚Œã°èª°ã§ã‚‚æ‰±ãˆãã†ãªã¨ã“ã‚ã‚‚é­…åŠ›ã€‚\nOS ãªã‚“ã¦ä½•ã§ã‚‚ã„ã„æ™‚ä»£ (æŠ½è±¡åŒ–ã•ã‚Œã¤ã¤ã‚ã‚‹ã‹ã‚‰) ã ã‘ã©ã€æ‰‹å…ƒã®ç«¯æœ«ã«å…¥ã‚Œã‚‹ OS ã ã‘ã¯ Arch Linux ãŒã„ã„ãªãã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/01/14/arch-linux-setup/","summary":"\u003cp\u003e(2013/08/31 ä¿®æ­£ã—ã¾ã—ãŸ)\u003c/p\u003e\n\u003cp\u003eè‡ªå®…ã®ãƒãƒ¼ãƒˆ PC ã«ã„ã¤ã‚‚ Debian Gnu/Linux unstable ã‚’å…¥ã‚Œã¦ä½œæ¥­ã—ã¦ãŸã®ã ã‘ã©ã€\nArch Linux ãŒè©¦ã—ãŸããªã£ã¦å…¥ã‚Œã¦ã¿ãŸã€‚ã™ã”ãã‚¤ã‚¤ã€‚ãƒŸãƒ‹ãƒãƒ«æ€è€ƒã§å¸¸ã«æœ€æ–°ã€‚ç«¯\næœ«ã«å…¥ã‚Œã‚‹ OS ã¨ã—ã¦ã¯æœ€é©ã‹ã‚‚!ã¨æ€ãˆã¦ããŸã€‚Ubuntu ã¯ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç’°å¢ƒã§æ‰±ã†\nã«ã¯ãƒãƒˆå¤§ãã™ãã‚‹ã—ã€‚FreeBSD ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å¾…ã¡æ™‚é–“ãŒæœ€è¿‘è€ãˆã‚‰ã‚Œãªã„ã—\u0026hellip;ã€‚\u003c/p\u003e\n\u003cp\u003eå‰ãƒªãƒªãƒ¼ã‚¹ã® Arch Linux ã«ã¯ /arch/setup ã¨ã„ã†ç°¡æ˜“ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãŒã‚ã£ãŸã®ã ã‘\nã©ã€ãã‚Œã™ã‚‰æœ€è¿‘ç„¡ããªã£ãŸã€‚ç’°å¢ƒä½œã‚‹æ–¹æ³•ã‚’è‡ªåˆ†ã®ãŸã‚ã«ã‚‚ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003ch4 id=\"os-ã‚¤ãƒ¡ãƒ¼ã‚¸-iso-å–å¾—ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç”¨-usb-ã‚¹ãƒ†ã‚£ãƒƒã‚¯ä½œæˆ\"\u003eOS ã‚¤ãƒ¡ãƒ¼ã‚¸ iso å–å¾—ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç”¨ USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯ä½œæˆ\u003c/h4\u003e\n\u003cp\u003eLinux, Windows, Mac ã§ä½œã‚Šæ–¹ãŒå¤‰ã‚ã‚‹ã‚ˆã†ã ã‘ã©ã€è‡ªåˆ†ã¯ Mac OSX ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹\nãƒˆãƒ¼ãƒ« USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã‚’ä½œæˆã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003ediskutil ã§ USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯è£…ç€å‰å¾Œã® disk ãƒ‡ãƒã‚¤ã‚¹ç•ªå·ã‚’è¦šãˆã‚‹\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% diskutil list\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e(ã“ã“ã§ã¯ /dev/rdisk4 ã¨ã—ã¦é€²ã‚ã‚‹ã€‚)\u003c/p\u003e\n\u003cp\u003eã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% sudo diskutil unmountDisk /dev/rdisk4\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ iso ã‚’ USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã«æ›¸ãè¾¼ã‚€ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% sudo dd if=/path/to/downloaded/iso of=/dev/rdisk4 bs=8192\n% sudo diskutil eject /dev/rdisk4\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"usb-ã‚¹ãƒ†ã‚£ãƒƒã‚¯è£…ç€ã—ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«é–‹å§‹\"\u003eUSB ã‚¹ãƒ†ã‚£ãƒƒã‚¯è£…ç€ã—ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«é–‹å§‹\u003c/h4\u003e\n\u003cp\u003eèµ·å‹•ã™ã‚‹ã¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ x86_64 ã‚’é¸ã‚“ã§èµ·å‹•ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚\u003c/p\u003e","title":"Arch Linux ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¾ã¨ã‚"},{"content":"ä»¥å‰ç´¹ä»‹ã—ãŸ OpenStack Folsom æ§‹ç¯‰ bash ã‚¹ã‚¯ãƒªãƒ—ãƒˆãªã®ã ã‘ã© quantum ã®ä»£ã‚ã‚Š ã« nova-network ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãŠã„ãŸã€‚\næ§‹ç¯‰ bash ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€\nhttps://github.com/jedipunkz/openstack_folsom_deploy/blob/master/README_jp.md\nã«è©³ã—ã„ä½¿ã„æ–¹ã‚’æ›¸ã„ã¦ãŠãã¾ã—ãŸã€‚ã¾ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¿®æ­£ã—ã¦å®Ÿè¡Œã™ã‚‹ã®ã ã‘ã©ãƒ‘ãƒ© ãƒ¡ãƒ¼ã‚¿ã«ã¤ã„ã¦ã¯ã€\nhttps://github.com/jedipunkz/openstack_folsom_deploy/blob/master/README_parameters_jp.md\nã«æ›¸ã„ã¦ãŠãã¾ã—ãŸã€‚\næ‰‹æŒã¡ã® Thinkpad ã« OpenStack folsom å…¥ã‚ŒãŸå†™çœŸã€‚ã“ã®å†™çœŸã® OpenStack Folsom ã‚’æ§‹ç¯‰ã—ãŸæ™‚ã®æ‰‹é †ã‚’æ›¸ã„ã¦ãŠãã‚ˆã€‚\nOS ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« OS ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚12.10 ã‚’ä½¿ã„ã¾ã—ãŸã€‚(12.04 LTS ã§ã‚‚å¯)ã€‚/dev/sda6 ç­‰ã€ Cinder ç”¨ã«ä¸€ã¤ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ä½œã£ã¦ãƒã‚¦ãƒ³ãƒˆã—ãªã„ã§ãŠãã¾ã™ã€‚ã¾ãŸå›ºå®š IP ã‚¢ ãƒ‰ãƒ¬ã‚¹ã‚’ NIC ã«ä»˜ä¸ã—ã¦ãŠãã¾ã™ã€‚\nã‚¹ã‚¯ãƒªãƒ—ãƒˆå–å¾— ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å–å¾—ã™ã‚‹ã€‚\n% sudo apt-get update; sudo apt-get install git-core % git clone https://github.com/jedipunkz/openstack_folsom_deploy.git % cd openstack_folsom_deploy ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¿®æ­£ deploy_with_nova-network.conf å†…ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¿®æ­£ã—ã¾ã™ã€‚ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆãª ã®ã§ã€ã»ã¼ã»ã¼ä¿®æ­£ã›ãšã«å®Ÿè¡Œã—ã¾ã™ãŒ\nHOST_IP='\u0026lt;Thinkpad ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹\u0026gt;' ã ã‘ä¿®æ­£ã€‚\nå®Ÿè¡Œ\u0026hellip; å®Ÿè¡Œã™ã‚‹ã€‚\n% sudo ./deploy.sh allinone nova-network \u0026hellip; æœ€è¿‘ ./deploy.sh create_network nova-network ã‚’å®Ÿè¡Œã—ãªãã¦æ¸ˆã‚€ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚\nHorizon ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost/horizon ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚Œã° horizon ã«ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã‚‹ã€‚ ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã¯\u0026hellip;\nuser : demo pass : demo ã§ã™ã€‚Horizon ã‹ã‚‰å¾Œã§ãƒ¦ãƒ¼ã‚¶æƒ…å ±å¤‰æ›´ã—ã¦ã‚‚ã‚‰ã£ã¦æ§‹ã‚ãªã„ã§ã™ã€‚\nã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚ å®Ÿè¡Œã—ãŸãƒ¦ãƒ¼ã‚¶ã®ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« ~/openstackrc ãŒã‚ã‚‹ã€‚\n~/openstackrc # admin ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç”¨ ~openstackrc-demo # demo ãƒ¦ãƒ¼ã‚¶ç”¨ èª­ã¿è¾¼ã‚“ã§ OpenStack ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚ä¸‹è¨˜ã¯ä¾‹ã§ã™ã€‚\n% source ~/openstackrc-demo % nova list +--------------------------------------+----------+--------+---------------------------------+ | ID | Name | Status | Networks | +--------------------------------------+----------+--------+---------------------------------+ | 81730be5-f2b3-411c-bfef-9a879e3d7d56 | grievous | ACTIVE | private=10.0.0.5, 192.168.1.195 | | 0ba8416a-58bd-476d-96a8-2ecc37ae53e6 | luke | ACTIVE | private=10.0.0.2, 192.168.1.194 | | 5b1f23b3-c15e-4260-bf6c-f3e965bcd546 | r2d2 | ACTIVE | private=10.0.0.4, 192.168.1.193 | +--------------------------------------+----------+--------+---------------------------------+ æ¬¡ã®ãƒªãƒªãƒ¼ã‚¹ç‰ˆã¯\u0026hellip; bash ã§æ›¸ã„ã¦ã‚‚\u0026hellip;æº€è¶³æ„Ÿå¾—ã‚‰ã‚Œãªã„ã—ã‚³ãƒ¼ãƒ‰æ±šããªã‚‹ã—ã€äººã«èª­ã‚“ã§ã‚‚ã‚‰ãˆãªã„ã—ã€‚ ruby ã§æ›¸ã„ã¦ã‚‚ perl ã§æ›¸ã„ã¦ã‚‚åŒã˜ã€‚ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒã‚·ãƒã‚·æ‰“ã¤ã‚¤ãƒ³ãƒ•ãƒ©ç³»ã®ã‚³ãƒ¼ãƒ‰ ã¯æ±šããªã‚‹ã—ã¾ã¨ã‚‚ã«ãƒ†ã‚¹ãƒˆã‚‚å‡ºæ¥ãªã„ã€‚ã“ã‚Œã‹ã‚‰ã¯ã‚¤ãƒ³ãƒ•ãƒ©ç³»ã‚‚ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãæ™‚ä»£ã ã£ ã¦è¨€ã£ã¦ãŠã„ã¦ã“ã‚Œã˜ã‚ƒã‚¢ã‚«ãƒ³ã‰ã€‚\nãªã‚‰ã°æƒ…å ±ãŒæ•´ç†ã•ã‚Œã‚‹ã£ã¦æ„å‘³ã ã‘ã§ã‚‚ chef ã®ã‚ˆã†ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã†æ„å‘³ã¯ å¤§ãã„ã€‚è³‡æºã‚’ä»–ã®äººã«æœ‰åŠ¹æ´»ç”¨ã—ã¦ã‚‚ã‚‰ãˆã‚‹ãƒãƒ£ãƒ³ã‚¹ã‚‚å¢—ãˆã‚‹ã—ã€‚chef ã®ã‚¯ãƒƒã‚¯ãƒ–ãƒƒ ã‚¯ãªã‚“ã¦ã‚³ãƒ¼ãƒ‰ã˜ã‚ƒãªã„ã£ã¦ã‚¢ãƒ—ãƒªã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«è¨€ã‚ã‚Œã‚ˆã†ãŒã€ã‚„ã£ã±ã‚Šãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ ã‚¯ä½¿ã†ã¹ãã ã—ä½¿ã„ãŸã„ã€‚æ¬¡ã® OpenStack ã®ãƒªãƒªãƒ¼ã‚¹ã®æ™‚ã¯ Chef ã®ã‚¯ãƒƒã‚¯ãƒ–ãƒƒã‚¯ä½œ ã‚‹ã£ã¦æ±ºã‚ãŸã‚ˆã‰ãƒ¼ã€‚why-run å‡ºæ¥ãŸã‚Šã€ãƒ†ã‚¹ãƒˆã‚‚å‡ºæ¥ã‚‹ã—ã­ã€‚\n","permalink":"https://jedipunkz.github.io/post/2013/01/12/openstack-on-thinkpad/","summary":"\u003cp\u003eä»¥å‰ç´¹ä»‹ã—ãŸ OpenStack Folsom æ§‹ç¯‰ bash ã‚¹ã‚¯ãƒªãƒ—ãƒˆãªã®ã ã‘ã© quantum ã®ä»£ã‚ã‚Š\nã« nova-network ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãŠã„ãŸã€‚\u003c/p\u003e\n\u003cp\u003eæ§‹ç¯‰ bash ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/jedipunkz/openstack_folsom_deploy/blob/master/README_jp.md\"\u003ehttps://github.com/jedipunkz/openstack_folsom_deploy/blob/master/README_jp.md\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã«è©³ã—ã„ä½¿ã„æ–¹ã‚’æ›¸ã„ã¦ãŠãã¾ã—ãŸã€‚ã¾ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¿®æ­£ã—ã¦å®Ÿè¡Œã™ã‚‹ã®ã ã‘ã©ãƒ‘ãƒ©\nãƒ¡ãƒ¼ã‚¿ã«ã¤ã„ã¦ã¯ã€\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/jedipunkz/openstack_folsom_deploy/blob/master/README_parameters_jp.md\"\u003ehttps://github.com/jedipunkz/openstack_folsom_deploy/blob/master/README_parameters_jp.md\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã«æ›¸ã„ã¦ãŠãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cimg src=\"http://jedipunkz.github.com/pix/openstack_folsom_thinkpad.jpg\"\u003e\n\u003cp\u003eæ‰‹æŒã¡ã® Thinkpad ã« OpenStack folsom å…¥ã‚ŒãŸå†™çœŸã€‚ã“ã®å†™çœŸã® OpenStack Folsom\nã‚’æ§‹ç¯‰ã—ãŸæ™‚ã®æ‰‹é †ã‚’æ›¸ã„ã¦ãŠãã‚ˆã€‚\u003c/p\u003e\n\u003ch4 id=\"os-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003eOS ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h4\u003e\n\u003cp\u003eOS ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚12.10 ã‚’ä½¿ã„ã¾ã—ãŸã€‚(12.04 LTS ã§ã‚‚å¯)ã€‚/dev/sda6 ç­‰ã€\nCinder ç”¨ã«ä¸€ã¤ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ä½œã£ã¦ãƒã‚¦ãƒ³ãƒˆã—ãªã„ã§ãŠãã¾ã™ã€‚ã¾ãŸå›ºå®š IP ã‚¢\nãƒ‰ãƒ¬ã‚¹ã‚’ NIC ã«ä»˜ä¸ã—ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003ch4 id=\"ã‚¹ã‚¯ãƒªãƒ—ãƒˆå–å¾—\"\u003eã‚¹ã‚¯ãƒªãƒ—ãƒˆå–å¾—\u003c/h4\u003e\n\u003cp\u003eã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å–å¾—ã™ã‚‹ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% sudo apt-get update; sudo apt-get install git-core\n% git clone https://github.com/jedipunkz/openstack_folsom_deploy.git\n% cd openstack_folsom_deploy\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¿®æ­£\"\u003eãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¿®æ­£\u003c/h4\u003e\n\u003cp\u003edeploy_with_nova-network.conf å†…ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¿®æ­£ã—ã¾ã™ã€‚ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆãª\nã®ã§ã€ã»ã¼ã»ã¼ä¿®æ­£ã›ãšã«å®Ÿè¡Œã—ã¾ã™ãŒ\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eHOST_IP='\u0026lt;Thinkpad ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹\u0026gt;'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã ã‘ä¿®æ­£ã€‚\u003c/p\u003e","title":"OpenStack Folsom on Thinkpad"},{"content":"FreeBSD ã‚’ OpenStack ã§ç®¡ç†ã—ãŸã„ãªãã¨æ€ã£ã¦è‡ªå®…ã« OpenStack ç’°å¢ƒä½œã£ã¦ã¾ã—ãŸã€‚\nãŠæ­£æœˆãªã®ã«\u0026hellip;\nä½¿ã£ãŸã®ã¯ folsom ãƒ™ãƒ¼ã‚¹ã® OpenStack (nova-network) ã¨ FreeBSD 9.1 ã§ã™ã€‚8 ç³» ã® FreeBSD ã§ã‚‚å¤§ä½“åŒã˜ä½œæ¥­ã§å®Ÿç¾å‡ºæ¥ã‚‹ã½ã„ã§ã™ã€‚ã‚ã¨ nova-network ã§ã£ã¦æ›¸ã„ ãŸã®ã¯è‡ªå®…ã« quantum ã ã¨å°‘ã—å³ã—ã„ã‹ã‚‰ã§ã™ã€‚FlatDHCPManager ãŒèª¿åº¦è‰¯ã‹ã£ãŸã€‚\nä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆã¯ FreeBSD ã® HDD, NIC ã®ãƒ‰ãƒ©ã‚¤ãƒã« virtio ã‚’ä½¿ã†ã‚ˆã†ã«ä¿®æ­£ã™ã‚‹ ã¨ã“ã‚ã§ã™ã€‚OpenStack (KVM) ã¯ virtio å‰æãªã®ã§ã€ãã†ã›ã–ã‚‹ã‚’å¾—ãªã‹ã£ãŸã§ã™ã€‚\nä»Šå›ä½¿ã£ãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ OpenStack Folsom (nova-network) Ubuntu Server 12.10 FreeBSD 9.1 amd64 ä½œæ¥­æ–¹æ³• æº–å‚™ã¨ã—ã¦ã“ã‚Œã‚‰ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚äº‹å‰ã«è¡Œãªã£ã¦ãã ã•ã„ã€‚\nFreeBSD-9.1-RELEASE-amd64-disc1.iso ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ ä½œæ¥­ãƒ›ã‚¹ãƒˆ (Ubuntu Server 12.10) ã« qemu-kvm ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« freebsd9.img ã¨ã—ã¦ qcow2 ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚\n% kvm-img create -f qcow2 freebsd9.img 8G ä½œæˆã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã« FreeBSD 9.1 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% kvm -m 256 -cdrom ./FreeBSD-9.1-RELEASE-amd64-disc1.iso \\ -drive file=./freebsd9.img -boot d -net nic -net user -nographic -vnc :10 VNC ã®ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ç•ªå·ã¯ç©ºã„ã¦ã„ã‚‹ã‚‚ã®ã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚ç©ºã„ã¦ã„ã‚Œã°ä»–ã§ã‚‚æ§‹ã„ ã¾ã›ã‚“ã€‚\nVNC viewer ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã— localhost:10 ã«æ¥ç¶šã—ã¾ã™ã€‚ã“ã“ã§ã¯ä½œæ¥­ãƒ›ã‚¹ãƒˆã« X Window System ãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’å‰æã«æ›¸ã„ã¦ã„ã¾ã™ãŒã€Non-X ãªæ–¹ã¯ä»–ã®ãƒ›ã‚¹ãƒˆã‹ ã‚‰ãã®ä»–ã® VNC ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä½¿ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‚ã‚‰ã£ã¦ã‚‚æ§‹ã‚ãªã„ã§ã™ã€‚\n% sudo apt-get update % sudo apt-get gvncviewer %gvncviewer localhost:10 ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«è¡Œãªã£ã¦ãã ã•ã„ã€‚æ°—ã‚’ã¤ã‘ã‚‹ç‚¹ã¨ã—ã¦ ã¯ä¸€ã¤ã€‚src ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚å¾Œã« virtio ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã®ã«å¿…è¦ ã«ãªã£ã¦ãã‚‹ã‹ã‚‰ã§ã™ã€‚kmod ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒçµ‚ã‚ã£ãŸã‚‰ä»Šåº¦ã¯ä»®æƒ³ãƒã‚·ãƒ³ã‚’ HDD ã‹ã‚‰èµ·å‹•ã—ã¾ã™ã€‚\n% kvm -m 256 -drive file=./freebsd9.img -boot c -net nic -net user \\ -nographic -vnc :10 VNC ã§å†åº¦æ¥ç¶šã—ä»®æƒ³ãƒã‚·ãƒ³ä¸Šã§ emulators/virtio-kmod ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\nfreebsd9% cd /usr/ports/emulators/virtio-kmod/ freebsd9% su freebsd9# make install clean æ¬¡ã« virtio ãƒ‰ãƒ©ã‚¤ãƒã‚’æ‰±ã†ã‚ˆã†ã« HDD, NIC ãƒ‰ãƒ©ã‚¤ãƒå‘¨ã‚Šã®è¨­å®šã‚’å¤‰æ›´ã—ã¾ã™ã€‚ virtio ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒçµ‚ã‚ã£ãŸå¾Œã«ã€Œã“ã†ã—ã‚ã€ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ãã¾ã™ã®ã§ ãã‚Œã‚’å‚è€ƒã«è¡Œã„ã¾ã™ã€‚ä¸€éƒ¨ã€åƒ•ã®ç’°å¢ƒã§ã¯ãã®ã¾ã¾ã§ã¯ãƒ€ãƒ¡ã ã£ãŸã®ã§ä¿®æ­£ã—ã¦ ä½¿ã„ã¾ã—ãŸã€‚\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ virtio ã‚’èµ·å‹•æ™‚ã«èª­ã¿è¾¼ã‚€ãŸã‚ã«ä¸‹è¨˜ã‚’è¿½è¨˜ã—ã¾ã™ã€‚\nfreebsd9# vi /boot/loader.conf virtio_load=\u0026quot;YES\u0026quot; virtio_pci_load=\u0026quot;YES\u0026quot; virtio_blk_load=\u0026quot;YES\u0026quot; if_vtnet_load=\u0026quot;YES\u0026quot; virtio_balloon_load=\u0026quot;YES\u0026quot; HDD ãƒ‰ãƒ©ã‚¤ãƒã‚’ virtio ã‚’ä½¿ã†ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ãƒ‡ãƒã‚¤ã‚¹åãŒå¤‰ã‚ã£ã¦ ãã‚‹ã®ã§ /etc/fstab ã‚’ç·¨é›†ã—ã¾ã™ã€‚\nfreebsd9# sed -i.bak -Ee 's|/dev/ada?|/dev/vtbd|' /etc/fstab NIC ã‚‚ virtio ã‚’ä½¿ã„ã¾ã™ã€‚åƒ•ã®ç’°å¢ƒã§ã¯ ifconfig_re0 ã§ã—ãŸã€‚ã“ã‚Œã‚’ vtnet0 ã«å¤‰ æ›´ã—ã¾ã™ã€‚\nfreebsd9# cat /etc/rc.conf ifconfig_vtnet0=\u0026quot;DHCP\u0026quot; ..\u0026lt;snip\u0026gt;.. qemu ã®èµ·å‹•æ–¹æ³•ã€ã‚‚ã—ãã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢å®šç¾©ã«ã‚ˆã£ã¦ re0 ã¯å¤‰ã‚ã£ã¦ã ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚é©å®œå¤‰æ›´ã—ã¾ã™ã€‚\nä»®æƒ³ãƒã‚·ãƒ³ã‚’ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã—ã¾ã™ã€‚\nfreebsd9# shutdown -p now å®Œæˆã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ« freebsd9.img ã‚’ openstack ç’°å¢ƒã«è»¢é€ã— (openstack ç’° å¢ƒã§ä½œæ¥­ã—ã¦ã„ã‚‹æ–¹ã¯å¿…è¦ç„¡ã„ã§ã™) glance ã«ç™»éŒ²ã—ã¾ã™ã€‚\nç’°å¢ƒå¤‰æ•°è«¸ã€…ã‚’æƒãˆã¦\u0026hellip;\n% glance add name=\u0026quot;FreeBSD 9\u0026quot; is_public=true container_format=ovf disk_format=qcow2 \u0026lt; freebsd9.img % glance image-list +--------------------------------------+------------------------+-------------+------------------+-------------+--------+ | ID | Name | Disk Format | Container Format | Size | Status | +--------------------------------------+------------------------+-------------+------------------+-------------+--------+ | 1af6f41b-1048-4d78-9715-87935c0bc6ae | FreeBSD 9 | qcow2 | ovf | 4305584128 | active | +--------------------------------------+------------------------+-------------+------------------+-------------+--------+ ä»¥ä¸Šã§ã™ã€‚\nã¾ã¨ã‚ FreeBSD ã¯ä»•äº‹å ´ã§ã‚‚ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã§ã‚‚ã¾ã ã¾ã ç¾å½¹ã ã— OpenStack ã§æ‰±ãˆã‚‹ã‚ˆã†ã« ã™ã‚‹ã“ã¨ã¯åƒ•ã«ã¨ã£ã¦ã¨ã¦ã‚‚é‡è¦ã§ã—ãŸã€‚ãªã®ã§æº€è¶³ï½— FreeBSD 8 ç³»ã§ã¯åŒã˜æ‰‹é †ã§ æ‰±ãˆã‚‹ã‚‰ã—ã„ã®ã ã‘ã©ã€ãã‚Œä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ãªã‚‹ã¨ã©ã†ã‹\u0026hellip; virtio ãŒãƒã‚¤ãƒ³ãƒˆ ãªã®ã¨ã€KVM ã¨ã‚²ã‚¹ãƒˆ OS ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã£ã¦ç›¸æ€§ãŒã‚ã¡ã‚ƒæœ‰ã‚‹ã®ã§ã“ã“ã‚‚ãƒã‚¤ãƒ³ãƒˆã«ãªã‚Š ãã†ã€‚ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ã« VMWare ã‚‚ä½¿ãˆã‚‹ã‚‰ã—ã„ã®ã§ä»Šåº¦ã‚„ã£ã¦ã¿ã‚‹ã‹ãªã€‚VMWare ã§ ã‚‚ç›¸æ€§ã¯ã‚ã‚‹ã‘ã©ã€KVM ã»ã©ã‚·ãƒ“ã‚¢ã«ãªã‚‰ãªãã¦ã„ã„å°è±¡ãŒã‚ã‚‹ã€‚FreeBSD 3ç³»ã§ã‚‚é ‘ å¼µã‚Œã°å‹•ã„ãŸã—ã€‚\nã‚ã¨ã¯ cloud-init ã€‚ã¾ã é–‹ç™ºé€”ä¸­ã ãã†ã§ã™ã€‚ãªã®ã§ metadata ã‚µãƒ¼ãƒã«ã‚¢ã‚¯ã‚»ã‚¹ã— ã¦ã€è‰²ã‚“ãªäº‹ã—ã‚ˆã†ã¨æ€ã£ã¦ã‚‚ã¾ã é›£ã—ã„ã€‚\nã“ã®å¹´æœ«ã« Windows ã‚‚ OpenStack ã«ä¹—ã›ã¦ã¿ãŸã®ã§ã€ãã¡ã‚‰ã®è¨˜äº‹ã‚‚æ™‚é–“ãŒã‚ã£ãŸã‚‰ è¼‰ã›ã‚ˆã†ã£ã¨ã€‚\n2013/01/02 è¿½è¨˜ FreeBSD 8.3 ã§è©¦ã—ã¦ã¿ã¾ã—ãŸãŒã€å…¨ãåŒã˜æ‰‹é †ã§èµ·å‹•ã—ã¦ãã‚Œã¾ã—ãŸã€‚ãŸã ã€ emulators/virtio-kmod ãŒ 8.2 or 9 ã«å¯¾å¿œã—ã¦ã„ã‚‹ã¨ã‚ã£ãŸã®ã§ Makefile ã‚’ä¿®æ­£ã— ã¦ virtio-kmod ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã¾ã™ã€‚ä»Šã®ã¨ã“ã‚ä½•ã‚‚å•é¡Œå‡ºã¦ã„ã¾ã›ã‚“ã€‚\n# diff -u /usr/ports/emulators/virtio-kmod/Makefile.org /usr/ports/emulators/virtio-kmod/Makefile --- /usr/ports/emulators/virtio-kmod/Makefile.org 2013-01-02 06:02:48.000000000 +0900 +++ /usr/ports/emulators/virtio-kmod/Makefile 2013-01-02 06:02:59.000000000 +0900 @@ -28,7 +28,7 @@ .include \u0026lt;bsd.port.pre.mk\u0026gt; -.if ${OSREL} != \u0026#34;8.2\u0026#34; \u0026amp;\u0026amp; ${OSREL} != \u0026#34;9.0\u0026#34; +.if ${OSREL} != \u0026#34;8.3\u0026#34; \u0026amp;\u0026amp; ${OSREL} != \u0026#34;9.0\u0026#34; IGNORE=not supported $${OSREL} (${OSREL}) .endif ","permalink":"https://jedipunkz.github.io/post/2013/01/01/freebsd-on-openstack/","summary":"\u003cp\u003eFreeBSD ã‚’ OpenStack ã§ç®¡ç†ã—ãŸã„ãªãã¨æ€ã£ã¦è‡ªå®…ã« OpenStack ç’°å¢ƒä½œã£ã¦ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eãŠæ­£æœˆãªã®ã«\u0026hellip;\u003c/p\u003e\n\u003cp\u003eä½¿ã£ãŸã®ã¯ folsom ãƒ™ãƒ¼ã‚¹ã® OpenStack (nova-network) ã¨ FreeBSD 9.1 ã§ã™ã€‚8 ç³»\nã® FreeBSD ã§ã‚‚å¤§ä½“åŒã˜ä½œæ¥­ã§å®Ÿç¾å‡ºæ¥ã‚‹ã½ã„ã§ã™ã€‚ã‚ã¨ nova-network ã§ã£ã¦æ›¸ã„\nãŸã®ã¯è‡ªå®…ã« quantum ã ã¨å°‘ã—å³ã—ã„ã‹ã‚‰ã§ã™ã€‚FlatDHCPManager ãŒèª¿åº¦è‰¯ã‹ã£ãŸã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆã¯ FreeBSD ã® HDD, NIC ã®ãƒ‰ãƒ©ã‚¤ãƒã« virtio ã‚’ä½¿ã†ã‚ˆã†ã«ä¿®æ­£ã™ã‚‹\nã¨ã“ã‚ã§ã™ã€‚OpenStack (KVM) ã¯ virtio å‰æãªã®ã§ã€ãã†ã›ã–ã‚‹ã‚’å¾—ãªã‹ã£ãŸã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä»Šå›ä½¿ã£ãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢\"\u003eä»Šå›ä½¿ã£ãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eOpenStack Folsom (nova-network)\u003c/li\u003e\n\u003cli\u003eUbuntu Server 12.10\u003c/li\u003e\n\u003cli\u003eFreeBSD 9.1 amd64\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ä½œæ¥­æ–¹æ³•\"\u003eä½œæ¥­æ–¹æ³•\u003c/h2\u003e\n\u003cp\u003eæº–å‚™ã¨ã—ã¦ã“ã‚Œã‚‰ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚äº‹å‰ã«è¡Œãªã£ã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFreeBSD-9.1-RELEASE-amd64-disc1.iso ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\u003c/li\u003e\n\u003cli\u003eä½œæ¥­ãƒ›ã‚¹ãƒˆ (Ubuntu Server 12.10) ã« qemu-kvm ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003efreebsd9.img ã¨ã—ã¦ qcow2 ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% kvm-img create -f qcow2 freebsd9.img 8G\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä½œæˆã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã« FreeBSD 9.1 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e","title":"FreeBSD on OpenStack"},{"content":"ä»Šæ—¥ã¯ \u0026ldquo;OpenStack Advent Calendar 2012 JP\u0026rdquo; ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆã®ãŸã‚ã«è¨˜äº‹ã‚’æ›¸ããŸ ã„ã¨æ€ã„ã¾ã™ã€‚Advent Calendar ã¨ã¯ã‚­ãƒªã‚¹ãƒˆç”Ÿèª•ã‚’ç¥ã†ãŸã‚ 12/25 ã¾ã§æ¯æ—¥èª°ã‹ãŒãƒ–ãƒ­ã‚° ç­‰ã§ç‰¹å®šã®è©±é¡Œã«ã¤ã„ã¦è¿°ã¹ã‚‹ã‚‚ã®ã€ã‚‰ã—ã„ã§ã™ã€‚CloudStack ã•ã‚“, Eucalyptus ã•ã‚“ ã‚‚ä»Šå¹´ã¯ã‚„ã£ã¦ã„ã‚‹ãã†ã§ã™ã­ã€‚\nã‚¤ãƒ™ãƒ³ãƒˆã‚µã‚¤ãƒˆ : http://atnd.org/events/34389\nã§ã¯æ—©é€Ÿï¼(ãŸã ..CloudStack ã® Advent Calendar ã¨ãƒã‚¿ãŒã‹ã¶ã‚Šæ°—å‘³ã§ã™..ã€‚)\nå¾¡å­˜çŸ¥ã®é€šã‚Š OpenStack ã¯ API ã‚’æä¾›ã—ã¦ã„ã¦ãƒ¦ãƒ¼ã‚¶ãŒã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ã§ OpenStack ã®ã‚³ãƒãƒ³ãƒ‰ãƒ»Horizon ã§å‡ºæ¥ã‚‹ã“ã¨ã¯å…¨ã¦å¯èƒ½ã§ã™ã€‚API ã‚’å©ãã®ã«å¹¾ã¤ã‹ ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå­˜åœ¨ã—ã¾ã™ã€‚\nfog libcloud deltacloud ãªã©ã§ã™ã€‚\nã“ã“ã§ã¯å†…éƒ¨ã§ fog ã‚’ä½¿ã£ã¦ã„ã‚‹ knife-openstack ã‚’åˆ©ç”¨ã—ã¦ API ã«è§¦ã‚Œã¦ã¿ã‚ˆã† ã‹ã¨æ€ã„ã¾ã™ã€‚API ã‚’å©ãã“ã¨ã‚’æƒ³åƒã—ã¦ã‚‚ã‚‰ã£ã¦ã€ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ä»•äº‹å†…å®¹ã® å¤‰åŒ–ã¾ã§è¿°ã¹ã‚‰ã‚ŒãŸã‚‰ã„ã„ãªãã¨æ€ã£ã¦ã„ã¾ã™ã€‚\nOpenStack ç’°å¢ƒã®ç”¨æ„ äºˆã‚ OpenStack ç’°å¢ƒã¯æƒã£ã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã§ã™ã€‚ãŠæŒã¡ã§ãªã‘ã‚Œã°\nhttp://jedipunkz.github.com/blog/2012/11/10/openstack-folsom-install/\nã“ã®è¨˜äº‹ã‚’å‚è€ƒã«ç’°å¢ƒã‚’ä½œã£ã¦ã¿ã¦ä¸‹ã•ã„ã€‚ã‚ã€devstack ã§ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚\nchef, knife-openstack ã®ç”¨æ„ chef, knife-openstack ã‚’å…¥ã‚Œã‚‹ã®ã¯ OpenStack ç’°å¢ƒã§ã‚‚ã€åˆ¥ã®ãƒãƒ¼ãƒ‰ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚\nchef ãŒç¢ºã‹ 1.9.2 ãƒ™ãƒ¼ã‚¹ãŒæ¨å¥¨ã ã£ãŸã®ã§ä»Šå›ã¯ 1.9.2-p320 ä½¿ã„ã¾ã™ã€‚ ruby ã¯ rbenv ã§å…¥ã‚Œã‚‹ã®ãŒã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚knife-openstack, chef ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯\u0026hellip;\n% sudo apt-get install libreadline-dev libxslt1-dev libxml2-dev % gem install chef --no-rdoc --no-ri % gem install knife-openstack --no-rdoc --no-ri % rbenv rehash # rbenv ã‚’ä½¿ã£ã¦ã„ã‚‹éš›ã«å®Ÿè¡Œ.. æ¬¡ã« knife.rb ã‚’ç”¨æ„ã—ã¾ã™ã€‚æƒ…å ±ã¨ã—ã¦ä¸‹è¨˜ã‚’\nOS_USERNAME : :openstack_username OS_PASSWORD : :openstack_password OS_AUTH_URL : :openstack_auth_url OS_TENANT_NAME : :openstack_tenant è¿½åŠ ã—ã¾ã™ã€‚ä¾‹ã¨ã—ã¦ä¸‹è¨˜ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚\n% mkdir .chef % ${EDITOR} .chef/knife.rb knife[:openstack_username] = \u0026quot;demo\u0026quot; knife[:openstack_password] = \u0026quot;demo\u0026quot; knife[:openstack_auth_url] = \u0026quot;http://172.16.1.11:5000/v2.0/tokens\u0026quot; knife[:openstack_tenant] = \u0026quot;service\u0026quot; ã“ã“ã§æ³¨æ„ãªã®ãŒ OS_AUTH_URL ãŒã„ã¤ã‚‚ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§æ‰±ã†ã‚‚ã®ã¨é•ã„ /tokens ãŒ ä»˜ã„ã¦ã„ã¾ã™ã€‚fog ã‚’ç›´ã«æ‰±ã†æ™‚ã‚‚åŒã˜ã§ã™ãŒã“ã‚ŒãŒå¿…è¦ã§ã™ã€‚\nssh keypair ã®ç”¨æ„ ssh keypair ãŒå¿…è¦ã«ãªã£ã¦ãã‚‹ã®ã§ç”¨æ„ã—ã¾ã™ã€‚\n% nova keypair-add testkey01 \u0026gt; testkey01 knife-openstack ã®æ“ä½œæ–¹æ³• ã„ã‚ˆã„ã‚ˆ knife-openstack ã‚’ä½¿ã£ã¦ OpenStack ã‚’æ“ä½œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nã¾ãšã¯ flavor ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚\n% knife openstack flavor list ID Name Virtual CPUs RAM Disk 1 m1.tiny 1 512 MB 0 GB 2 m1.small 1 2048 MB 20 GB 3 m1.medium 2 4096 MB 40 GB 4 m1.large 4 8192 MB 80 GB 5 m1.xlarge 8 16384 MB 160 GB image ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚id ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚\n% knife openstack image list ID Name 436deba5-8fab-4bb7-9205-41e33fe22744 Cirros 0.3.0 x86_64 VM ã‚’ç”Ÿæˆã—ã¦ã¿ã¾ã—ã‚‡ãƒ¼ã€‚\n% knife openstack server create -f 1 -I 436deba5-8fab-4bb7-9205-41e33fe22744 -S testkey01 -N knifetest01 Instance Name: knifetest01 Instance ID: 1e20850d-9572-46c8-a41e-fdf56f4f65a7 SSH Keypair: testkey Waiting for server............ Flavor: 1 Image: 436deba5-8fab-4bb7-9205-41e33fe22744 å‡ºæ¥ãŸã‹ã©ã†ã‹ã€ãƒã‚§ãƒƒã‚¯ã€‚\n% knife openstack server list Instance ID Name Public IP Private IP Flavor Image Keypair State 1e20850d-9572-46c8-a41e-fdf56f4f65a7 knifetest01 1 436deba5-8fab-4bb7-9205-41e33fe22744 hogehoge active ã§ãã¾ã—ãŸã€‚é€†ã« VM ã‚’å‰Šé™¤ã™ã‚‹ã«ã¯\n% knife openstack server delete 1e20850d-9572-46c8-a41e-fdf56f4f65a7 Instance ID: 1e20850d-9572-46c8-a41e-fdf56f4f65a7 Instance Name: knifetest01 Flavor: 1 Image: 436deba5-8fab-4bb7-9205-41e33fe22744 Do you really want to delete this server? (Y/N) y WARNING: Deleted server 1e20850d-9572-46c8-a41e-fdf56f4f65a7 WARNING: Corresponding node and client for the 1e20850d-9572-46c8-a41e-fdf56f4f65a7 server were not deleted and remain registered with the Chef Server ã§ã™ã€‚\næ®‹å¿µãªã¨ã“ã‚ã¨ã—ã¦ã¯ knife-openstack è‡ªä½“ã¯ã¾ã ã¾ã æ©Ÿèƒ½ãŒå……å®Ÿã—ã¦ã„ã¾ã›ã‚“ã€‚VM ã®åŸºæœ¬çš„ãªæ“ä½œãã‚‰ã„ã—ã‹å‡ºæ¥ãªã„ã®ã§ã€è¿½åŠ å®Ÿè£…ã—ãŸã„ã¨ã„ã†æ–¹ãŒã„ã‚‰ã£ã—ã‚ƒã„ã¾ã— ãŸã‚‰ Pull ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ã‚‹ã¨è‰¯ã„ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚\nknife-openstack å…¬å¼ã‚µã‚¤ãƒˆ : https://github.com/opscode/knife-openstack\nã¾ãã€ã“ã“ã¾ã§æ›¸ã„ã¦ã‚¢ãƒ¬ã§ã™ãŒ.. æ°—ãŒã¤ã„ãŸæ–¹ã‚‚ã„ã‚‰ã£ã—ã‚ƒã‚‹ã¨æ€ã„ã¾ã™ã€‚ knife-openstack ã§å‡ºæ¥ã‚‹ã“ã¨ã¯ openstack ã‚³ãƒãƒ³ãƒ‰ç¾¤ã§å…¨ã¦å‡ºæ¥ã‚‹ã®ã§ã‚ã¾ã‚Šæ„å‘³ ã¯ãªã„ã§ã™ã‚ˆã­ã€‚ãŸã  fog ã‚’ä½¿ã£ã¦ API ã‚’å©ãã“ã¨ã‚’æƒ³åƒã—ã¦æ¬²ã—ãã¦..( -_- )\nFog å˜ä½“ã§æ“ä½œã—ã¦ã¿ã‚‹ ä»Šæ—¥ã¯ã¾ã ã¾ã æ›¸ã‘ã‚‹ï¼\nknife-openstack ã§ã¯åŸºæœ¬çš„ãªæ“ä½œã—ã‹å‡ºæ¥ã¾ã›ã‚“ã§ã—ãŸãŒ fog ã¯ã‚ˆã‚Šå¤šãã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚(2012/12/08 ç¾åœ¨ quantum å‘¨ã‚Šã®é–‹ç™ºã¯æœª å®Œæˆã‚‰ã—ã„ã§ã™ã€‚floating-ip å‘¨ã‚ŠãŒãã€‚èª°ã‹ã‚³ãƒŸãƒƒãƒˆã—ã¦ã€‚)\nfog å˜ä½“ã§ OpenStack API ã‚’æ“ä½œã™ã‚‹ã«ã¯ã€ä¸‹è¨˜ã®é€šã‚Šå®Ÿè¡Œã—ã¾ã™ã€‚fog ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ ãƒ«ã—\u0026hellip;\n% gem install fog --no-rdoc --no-ri % rbenv rehash ç’°å¢ƒå¤‰æ•°ã‚’å…¥åŠ›ã—\u0026hellip; (æƒ…å ±ã¯ä¾‹ã§ã™)\n% cat env export OS_TENANT_NAME=service export OS_USERNAME=demo export OS_PASSWORD=demo export OS_AUTH_URL=\u0026quot;http://172.16.1.11:5000/v2.0/\u0026quot; export OS_AUTH_URL_FOG=\u0026quot;http://172.16.1.11:5000/v2.0/tokens\u0026quot; % source env ã‚³ãƒ¼ãƒ‰ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«è¨˜è¿°ã™ã‚‹ã¨ VM ã®ç”ŸæˆãŒè¡Œãˆã¾ã™ã€‚\n#!/usr/bin/env ruby require \u0026#39;fog\u0026#39; require \u0026#39;pp\u0026#39; conn = Fog::Compute.new({ :provider =\u0026gt; \u0026#39;OpenStack\u0026#39;, :openstack_api_key =\u0026gt; ENV[\u0026#39;OS_PASSWORD\u0026#39;], :openstack_username =\u0026gt; ENV[\u0026#34;OS_USERNAME\u0026#34;], :openstack_auth_url =\u0026gt; ENV[\u0026#34;OS_AUTH_URL_FOG\u0026#34;], :openstack_tenant =\u0026gt; ENV[\u0026#34;OS_TENANT_NAME\u0026#34;] }) flavor = conn.flavors.find { |f| f.name == \u0026#39;m1.tiny\u0026#39; } image_name = \u0026#39;Cirros 0.3.0 x86_64\u0026#39; image = conn.images.find { |i| i.name == image_name } puts \u0026#34;#{\u0026#39;Creating server\u0026#39;} from image #{image.name}...\u0026#34; server = conn.servers.create :name =\u0026gt; \u0026#34;fogvm-#{Time.now.strftime \u0026#39;%Y%m%d-%H%M%S\u0026#39;}\u0026#34;, :image_ref =\u0026gt; image.id, :flavor_ref =\u0026gt; flavor.id, :key_name =\u0026gt; \u0026#39;testkey01\u0026#39; server.wait_for { ready? } å®Ÿè¡Œ !\n% ruby \u0026lt;CODENAME\u0026gt;.rb Creating server from image Cirros 0.3.0 x86_64... % å‡ºæ¥ã¾ã—ãŸã€‚VM ãŒç”Ÿæˆã•ã‚ŒãŸã‹å…ˆã»ã©ã® knife-openstack ã§ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\n% knife openstack server list Instance ID Name Public IP Private IP Flavor Image Keypair State 1e20850d-9572-46c8-a41e-fdf56f4f65a7 knifetest01 1 436deba5-8fab-4bb7-9205-41e33fe22744 hogehoge active f5c314a3-e32f-498f-984f-b79078d76a5a fogvm-20121207-104743 1 aedef2a1-f820-43a6-96cd-f5361d27df3f testkey01 active ã¾ã¨ã‚ã¨ è€ƒå¯Ÿ ä»Šå›ã¯ API ã‚’ã¿ã‚“ãªå©ã„ã¦ã‚‹ã­ã‚“ï¼ã£ã¦ã“ã¨ã«æ°—ãŒã¤ã„ã¦æ¬²ã—ãã¦ã€ã“ã‚“ãªè¨˜äº‹ã‚’æ›¸ ã„ã¦ã¿ã¾ã—ãŸã€‚å®Ÿã¯ OpenStack ã®ã‚³ãƒãƒ³ãƒ‰ã‚‚ \u0026ndash;debug ã‚’ä»˜ã‘ã¦ (Quantum ã ã‘ã¯ -v) å®Ÿè¡Œã™ã‚‹ã¨ OpenStack ã® API ã‚’å©ã„ã¦ã„ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã¨ OpenStack ãƒ¦ãƒ¼ ã‚¶ä¼šã®æ–¹ã‹ã‚‰èãã¾ã—ãŸã€‚æ˜¯éã‚„ã£ã¦ã„ã¦ãã ã•ã„ã€‚\n% nova --debug list % quantum -v net-list API ã‚’å®Ÿè£…ã™ã‚‹ã®ã‹ã€ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè£…ã™ã‚‹ã®ã‹ï¼Ÿã¨ã„ã£ãŸè©±é¡ŒãŒä»¥å‰ã® OpenStack Summit ã§å¸¸ã«è©±é¡Œã«ãªã£ã¦ã„ãŸã‚‰ã—ã„ã§ã™ãŒã€æœ€è¿‘ã¯ API ã§æ±ºã¾ã‚Šã€ã¨ã„ã£ãŸã¨ ã“ã‚ã§ã—ã‚‡ã†ã‹ã€‚ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã‚¤ãƒ³ãƒ©ãƒ•ã‚’å®šç¾©ã™ã‚‹æ™‚ä»£ã«çªå…¥ã§ã™ã€‚ã¡ãªã¿ã« fog ã¯ AWS ã‚‚æ‰±ãˆã¾ã™ã€‚ã¾ãŸ Opscode Chef ã‚„ Puppet, JuJu ç­‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ ã‚¯ã‚’ä½¿ãˆã° VM ä¸Šã®ã‚µãƒ¼ãƒ“ã‚¹æ§‹ç¯‰ã‚‚ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ã§å‡ºæ¥ã¾ã™ã€‚ã¾ãŸã€ä»¥å‰ãƒ–ãƒ­ã‚°ã« æ›¸ã„ãŸã®ã§ã™ãŒ OpenFlow ã¨ã„ã£ãŸæŠ€è¡“ã‚’ä½¿ã†ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ã§è¨­ è¨ˆå‡ºæ¥ã‚‹ã€ã‹ã‚‚ã—ã‚Œãªã„ã€‚\nhttp://jedipunkz.github.com/blog/2012/11/21/openflow-trema-handson-report/\nã¤ã¾ã‚Šã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ã§\nã‚µãƒ¼ãƒæ§‹ç¯‰ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹ç¯‰ ã‚µãƒ¼ãƒ“ã‚¹æ§‹ç¯‰ ã‚’ä¸€è²«ã—ã¦è¡Œãˆã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚\nã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®åƒ•ã¨ã—ã¦ã¯æ™‚ä»£ã®å¤‰åŒ–ã«ç€ã„ã¦è¡Œã‹ã­ã°ï¼ã¨ã„ã†ç„¦ã‚Šã§ä¸€æ¯ã§ã™ã€‚ ã‚‚ã¡ã‚ã‚“ãƒ¬ã‚¬ã‚·ãªã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚‚ç”Ÿãæ®‹ã‚‹ã®ã§ã—ã‚‡ã†ãŒã€åƒãå ´æ‰€ãŒé™ã‚‰ã‚Œã¦ã ãã†ã€‚ã‚ˆã‚Šé«˜åº¦ãª(ä½ãƒ¬ã‚¤ãƒ¤ã‹ã‚‰ã®æ·±ã„ï¼Ÿ)æŠ€è¡“ã‚’æœ‰ã—ã¦ã„ã‚‹äººãŒé™å®šã•ã‚ŒãŸå ´æ‰€ã§æˆæœ ã‚’ä¸Šã’ã¦ã„ãå°è±¡ã€‚åƒ•ã‚‰ã®æ§˜ãªä¸€èˆ¬çš„ãªã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¯ OpenStack, AWS, HP Cloud, CloudStack ã®æ§˜ãªã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ç›¸æ‰‹ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã€ã‚‚ã—ãã¯æŠ½è±¡åŒ–ã• ã‚ŒãŸæŠ€è¡“ã‚’ã‚ˆã‚Šæ‰±ã„ã‚„ã™ã„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä»‹ã—ã¦æ§‹ç¯‰ãƒ»ç®¡ç†ã—ã¦ã„ãã“ã¨ã«ãªã‚‹ã®ã§ã—ã‚‡ ã†ã‹ã€‚ã“ã‚Œã‹ã‚‰è¦šãˆã‚‹ã“ã¨ã¯å±±ç©ã¿ã§ã™ãŒã€æ¥½ã—ã„æ™‚ä»£ã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/12/08/knife-fog-openstack-api/","summary":"\u003cp\u003eä»Šæ—¥ã¯ \u0026ldquo;OpenStack Advent Calendar 2012 JP\u0026rdquo; ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆã®ãŸã‚ã«è¨˜äº‹ã‚’æ›¸ããŸ\nã„ã¨æ€ã„ã¾ã™ã€‚Advent Calendar ã¨ã¯ã‚­ãƒªã‚¹ãƒˆç”Ÿèª•ã‚’ç¥ã†ãŸã‚ 12/25 ã¾ã§æ¯æ—¥èª°ã‹ãŒãƒ–ãƒ­ã‚°\nç­‰ã§ç‰¹å®šã®è©±é¡Œã«ã¤ã„ã¦è¿°ã¹ã‚‹ã‚‚ã®ã€ã‚‰ã—ã„ã§ã™ã€‚CloudStack ã•ã‚“, Eucalyptus ã•ã‚“\nã‚‚ä»Šå¹´ã¯ã‚„ã£ã¦ã„ã‚‹ãã†ã§ã™ã­ã€‚\u003c/p\u003e\n\u003cp\u003eã‚¤ãƒ™ãƒ³ãƒˆã‚µã‚¤ãƒˆ : \u003ca href=\"http://atnd.org/events/34389\"\u003ehttp://atnd.org/events/34389\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã§ã¯æ—©é€Ÿï¼(ãŸã ..CloudStack ã® Advent Calendar ã¨ãƒã‚¿ãŒã‹ã¶ã‚Šæ°—å‘³ã§ã™..ã€‚)\u003c/p\u003e\n\u003cp\u003eå¾¡å­˜çŸ¥ã®é€šã‚Š OpenStack ã¯ API ã‚’æä¾›ã—ã¦ã„ã¦ãƒ¦ãƒ¼ã‚¶ãŒã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ã§\nOpenStack ã®ã‚³ãƒãƒ³ãƒ‰ãƒ»Horizon ã§å‡ºæ¥ã‚‹ã“ã¨ã¯å…¨ã¦å¯èƒ½ã§ã™ã€‚API ã‚’å©ãã®ã«å¹¾ã¤ã‹\nãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå­˜åœ¨ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003efog\u003c/li\u003e\n\u003cli\u003elibcloud\u003c/li\u003e\n\u003cli\u003edeltacloud\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eãªã©ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã“ã“ã§ã¯å†…éƒ¨ã§ fog ã‚’ä½¿ã£ã¦ã„ã‚‹ knife-openstack ã‚’åˆ©ç”¨ã—ã¦ API ã«è§¦ã‚Œã¦ã¿ã‚ˆã†\nã‹ã¨æ€ã„ã¾ã™ã€‚API ã‚’å©ãã“ã¨ã‚’æƒ³åƒã—ã¦ã‚‚ã‚‰ã£ã¦ã€ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ä»•äº‹å†…å®¹ã®\nå¤‰åŒ–ã¾ã§è¿°ã¹ã‚‰ã‚ŒãŸã‚‰ã„ã„ãªãã¨æ€ã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"openstack-ç’°å¢ƒã®ç”¨æ„\"\u003eOpenStack ç’°å¢ƒã®ç”¨æ„\u003c/h2\u003e\n\u003cp\u003eäºˆã‚ OpenStack ç’°å¢ƒã¯æƒã£ã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã§ã™ã€‚ãŠæŒã¡ã§ãªã‘ã‚Œã°\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://jedipunkz.github.com/blog/2012/11/10/openstack-folsom-install/\"\u003ehttp://jedipunkz.github.com/blog/2012/11/10/openstack-folsom-install/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã“ã®è¨˜äº‹ã‚’å‚è€ƒã«ç’°å¢ƒã‚’ä½œã£ã¦ã¿ã¦ä¸‹ã•ã„ã€‚ã‚ã€devstack ã§ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"chef-knife-openstack-ã®ç”¨æ„\"\u003echef, knife-openstack ã®ç”¨æ„\u003c/h2\u003e\n\u003cp\u003echef, knife-openstack ã‚’å…¥ã‚Œã‚‹ã®ã¯ OpenStack ç’°å¢ƒã§ã‚‚ã€åˆ¥ã®ãƒãƒ¼ãƒ‰ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚\u003c/p\u003e\n\u003cp\u003echef ãŒç¢ºã‹ 1.9.2 ãƒ™ãƒ¼ã‚¹ãŒæ¨å¥¨ã ã£ãŸã®ã§ä»Šå›ã¯ 1.9.2-p320 ä½¿ã„ã¾ã™ã€‚\nruby ã¯ rbenv ã§å…¥ã‚Œã‚‹ã®ãŒã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚knife-openstack, chef ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯\u0026hellip;\u003c/p\u003e","title":"OpenStack API ã‚’ç†è§£ã—ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ä»•äº‹ã®å¤‰åŒ–ã‚’æ„Ÿã˜ã‚‹"},{"content":"InternetWeek2012 ã§é–‹ã‹ã‚ŒãŸ \u0026ldquo;OpenFlow Trema ãƒãƒ³ã‚ºã‚ªãƒ³\u0026rdquo; ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚\nè¬›å¸« : Trema é–‹ç™ºãƒãƒ¼ãƒ  éˆ´æœ¨ä¸€å“‰ã•ã¾, é«˜å®®å®‰ä»ã•ã¾ é–‹å‚¬æ—¥ : 2012å¹´11æœˆ21æ—¥ OpenStack ã® Quantum Plugin ã¨ã—ã¦ Trema ãŒæ‰±ãˆã‚‹ã¨ã„ã†è©±ã ã£ãŸã®ã§èˆˆå‘³ã‚’æŒã£ ãŸã®ãŒãã£ã‹ã‘ã§ã™ã€‚ã¾ãŸ Ruby ã§ç°¡æ½”ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ã‚³ãƒ¼ãƒ‰åŒ–å‡ºæ¥ã‚‹ã€ã¨ã„ã†ç‚¹ã‚‚ å€‹äººçš„ã«éå¸¸ã«èˆˆå‘³ã‚’æŒã¡ã¾ã—ãŸã€‚OpenStack, CloudStack ç­‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰ç®¡ç†ã‚½ãƒ•ãƒˆã‚¦ã‚§ ã‚¢ãŒæä¾›ã™ã‚‹ API ã¨ã„ã„ã€Opscode Chef, Puppet ç­‰ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢æ§‹ç¯‰ãƒ•ãƒ¬ãƒ¼ ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã„ã„ã€ã“ã® OpenFlow ã‚‚ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å½¢æˆã™ã‚‹æŠ€è¡“ã‚’æŠ½è±¡åŒ–ã—ã€æŠ€è¡“è€…ãŒã‚³ãƒ¼ ãƒ‰ã‚’æ›¸ãã“ã¨ã§ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰ã‚’è¡Œãˆã‚‹ã€ã¨ã„ã†ç‚¹ã§ã¯ã‚¤ãƒãƒ‰ã‚­ã ãªã¨æ€ã„ã¾ã™ã€‚\nGoogle ã¯æ—¢ã«ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼é–“ã®é€šä¿¡ã‚’ 100% ã€OpenFlow ã®ä»•æ§˜ã«æ²¿ã£ãŸæ©Ÿå™¨ãƒ»ã‚½ãƒ• ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚’ç‹¬è‡ªã«å®Ÿè£…ã—ã•ã°ã„ã¦ã„ã‚‹ãã†ã§ã™ã—ã€æˆ‘ã€…ãŒåˆ©ç”¨ã™ã‚‹æ—¥ã‚‚è¿‘ã„ã¨æƒ³åƒã— ã¾ã™ã€‚\nOpenFlow ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ OpenFlow ã®ç™»å ´ã«ã¯ç†ç”±ãŒå¹¾ã¤ã‹ã‚ã£ã¦ã€æ—¢å­˜ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æŠ±ãˆã¦ã„ã‚‹ä¸‹è¨˜ã®å¹¾ ã¤ã‹ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã§ã™ã€‚\nè£…ç½®ä»•æ§˜ã®è‚¥å¤§åŒ– å¤šæ§˜ãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒæ¨™æº–åŒ– è£…ç½®ã®ã‚³ã‚¹ãƒˆå¢—å¤§ ã‚ã‚‹æ„å‘³ã€è‡ªå¾‹ã—ãŸã‚·ã‚¹ãƒ†ãƒ ãŒæ‹›ãè¤‡é›‘ã• ä¸€æ–¹ã€OpenFlow ã‚’åˆ©ç”¨ã™ã‚‹ã¨..\nã‚³ãƒ¢ãƒ‡ã‚£ãƒ†ã‚£åŒ–ã•ã‚ŒãŸ HW ã®åˆ©ç”¨ãŒå¯èƒ½ OpenFlow ã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ© (ç¥) ãŒé›†ä¸­ç®¡ç†ã™ã‚‹ã®ã§æ¥½ãªå ´åˆã‚‚ã‚ã‚‹ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é‹ç”¨ã®è‡ªå‹•åŒ–ãŒå›³ã‚Œã‚‹ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«åˆã‚ã›ãŸæœ€é©åŒ– æŸ”è»Ÿãªè‡ªå·±ä¿®å¾© ç­‰ã®ãƒ¡ãƒªãƒƒãƒˆãŒã€‚\nOpenFlow ã¨ Trema ã¨ã¯? OpenFlow ã¯ \u0026lsquo;OpenFlow ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©\u0026rsquo;, \u0026lsquo;OpenFlow ã‚¹ã‚¤ãƒƒãƒ\u0026rsquo; ã‹ã‚‰æˆã‚‹ã€‚OpenFlow ã‚³ ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¨ OpenFlow ã‚¹ã‚¤ãƒƒãƒã®é–“ã®é€šä¿¡ã¯ OpenFlow ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã•ã‚Œã‚‹ã€‚ä»Šæ—¥ã® è©±é¡Œ Trema ã¯ã“ã®..\nOpenFlow ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ trema ã‚³ãƒãƒ³ãƒ‰ ã®ã‚»ãƒƒãƒˆã§ã‚ã‚‹ã€‚è‡ªå®…ã® PC ä¸€å°ã§ OpenFlow ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒè¡Œãˆã€ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ è¡Œãˆã‚‹æ‰‹è»½ã•ã€ã¾ãŸ Ruby ã«ã‚ˆã‚‹ç°¡æ½”ãªè¨˜è¿°ãŒå¯èƒ½ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°åˆå¿ƒè€…ã§ã‚‚æ‰±ã„ã‚„ ã™ã„ã€ã¨ã„ã†è¶£å‘³ãƒ¦ãƒ¼ã‚¶ã«ã¯ã‚‚ã£ã¦ã®ã»ã‹ã ã€‚\nHellow, Trema ! æ—©é€Ÿ ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®åˆæ­©ã€Hello World ã‹ã‚‰ã€‚\nã‚³ãƒ¼ãƒ‰ hello-trema.rb ã¯\nclass HelloTrema \u0026lt; Controller def start puts \u0026quot;Hello, Trema!\u0026quot; end end å®Ÿè¡Œ\u0026hellip;\n% trema run hello-trema.rb Hello, Trema! Trema ãŒæä¾›ã™ã‚‹ Controller ã‚¯ãƒ©ã‚¹ã‚’ \u0026lsquo;ç¶™æ‰¿\u0026rsquo; ã— HelloTrema ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã—ãŸã€‚ Controller ã‚¯ãƒ©ã‚¹ã«ã¯å¹¾ã¤ã‚‚ã®ãƒãƒ³ãƒ‰ãƒ©ãŒç”¨æ„ã•ã‚Œã¦ã„ã¦ start ãƒãƒ³ãƒ‰ãƒ©ã‚‚ãã®ä¸€ã¤ã€‚ ä»–ã«ã‚‚è‰²ã‚“ãªãƒ¡ã‚½ãƒƒãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã€‚è©³ã—ãã¯å¾Œã»ã©ã€‚\nTrema ã«ã‚ˆã‚‹ã‚¹ã‚¤ãƒƒãƒã®èµ·å‹• æ¬¡ã«ã‚¹ã‚¤ãƒƒãƒã‚’èµ·å‹•ã—ã¦ã¿ã‚‹ã€‚Trema ã¯ ruby ã® DSL ã§ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®š ç¾©å‡ºæ¥ã‚‹ã€‚hello-switch.conf ã¨ã—ã¦ä¸‹è¨˜ã®å†…å®¹\u0026hellip;\nvswitch { dpid \u0026quot;0xabc\u0026quot; } vswitch { dpid \u0026quot;0x1\u0026quot; } vswitch { dpid \u0026quot;0x2\u0026quot; } hello-switch.rb ã¨ã—ã¦\nclass HelloSwitch \u0026lt; Controller def switch_ready dpid puts \u0026quot;Hello #{ dpid.to_hex }!\u0026quot; end def switch_disconnected dpid puts \u0026quot;Killed ! :D #{ dpid.to_hex }!\u0026quot; end end å®Ÿè¡Œã™ã‚‹ã¨\n% trema run hello-switch.rb -c hello-switch.conf Hello 0xabc! Hello 0x1! Hello 0x2! ã¨ãªã‚‹ã€‚ã‚¹ã‚¤ãƒƒãƒã‚’3ã¤èµ·å‹•ã—ãŸã‚ã‘ã ã€‚switch_ready ã¨ã¯ Trema ãŒæä¾›ã™ã‚‹ã‚³ãƒ³ãƒˆ ãƒ­ãƒ¼ãƒ©ã§å®šç¾©ã•ã‚ŒãŸ \u0026ldquo;ã‚¹ã‚¤ãƒƒãƒãŒç¨¼åƒã—ãŸæ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ãƒãƒ³ãƒ‰ãƒ©\u0026rdquo; ã ã€‚ã‚¹ã‚¤ãƒƒãƒãŒèµ· å‹•ã—ãŸãŸã‚ \u0026ldquo;Hello ..\u0026rdquo; ãªã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚ŒãŸã€ã¨ç†è§£ã™ã‚Œã°ã„ã„ã€‚\nã¾ãŸã“ã®èµ·å‹•ä¸­ã«\n% trema kill 0x1 Killed ! :D 0x1! ã¨å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã‚¹ã‚¤ãƒƒãƒã‚’åœæ­¢å‡ºæ¥ã‚‹ã€‚ã“ã®éš› switch_disconnected ãƒãƒ³ãƒ‰ãƒ©ãŒå®Ÿ è¡Œã•ã‚Œä¸Šè¨˜ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã—ãŸã¨ã„ã†ã‚ã‘ã ã€‚ã¾ãŸé€†ã«å†ç¨¼åƒã•ã›ã‚‹ã«ã¯ trema up ã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨ã„ã‚‹ã€‚\nãã®ä»–ã®ãƒãƒ³ãƒ‰ãƒ©ä¸€è¦§ ç´¹ä»‹ã—ãŸ start, switch_ready ç­‰ã®ãƒãƒ³ãƒ‰ãƒ©ä»¥å¤–ã«ã‚‚ä¸‹è¨˜ã®ãƒ¢ãƒãŒã‚ã‚‹ã€‚\nstart switch_ready switch_disconnected packet_in flow_removed port_status openflow_error features_reply stats_reply barrier_reply get_config_reply queue_get_config_reply vendor ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯\nhttp://rubydoc.info/github/trema/trema/master/frames ã«ã‚ã‚‹ã®ã§å‚ç…§ã™ã‚‹ã¨è‰¯ã„ã€‚\nL2 ã‚¹ã‚¤ãƒƒãƒã®å®Ÿè£… OpenFlow ã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ©Ÿå™¨ã‚’å®Ÿè£…å‡ºæ¥ã‚‹ãƒ¢ãƒãªã®ã§ã€ã“ã“ã§ L2 ã‚¹ã‚¤ãƒƒãƒã‚’å®Ÿè£…ã— ã¦ã¿ãŸã„ã€‚L2 ã‚¹ã‚¤ãƒƒãƒã®å‹•ä½œã¯\næ—¢ã« ARP ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æŒã£ã¦ã„ã‚Œã°ãƒ‘ã‚±ãƒƒãƒˆã‚’å—ã‘æµã™ è‡ªåˆ†ã® ARP ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç®¡ç†ã•ã‚Œã¦ã„ãªã„ãƒ‘ã‚±ãƒƒãƒˆã¯å­¦ç¿’ã—ã¦ã‹ã‚‰ãƒ‘ã‚±ãƒƒãƒˆã‚’å—ã‘æµ ã™ ãŒåŸºæœ¬ã ã€‚ã“ã‚Œã‚’å®Ÿè£…ã™ã‚‹ã€‚\nl2-switch.conf ã¨ã—ã¦\nvswitch { dpid \u0026quot;0xabc\u0026quot; } vhost (\u0026quot;host1\u0026quot;) { ip \u0026quot;192.168.0.1\u0026quot; netmask \u0026quot;255.255.0.0\u0026quot; mac \u0026quot;00:00:00:01:00:01\u0026quot; } vhost (\u0026quot;host2\u0026quot;) { ip \u0026quot;192.168.0.2\u0026quot; netmask \u0026quot;255.255.0.0\u0026quot; mac \u0026quot;00:00:00:01:00:02\u0026quot; } link \u0026quot;0xabc\u0026quot;, \u0026quot;host1\u0026quot; link \u0026quot;0xabc\u0026quot;, \u0026quot;host2\u0026quot; ã“ã“ã§ã¯ detapath_id \u0026ldquo;0xabc\u0026rdquo; ãªã‚‹ä»®æƒ³ã‚¹ã‚¤ãƒƒãƒã‚’ä¸€ã¤å®šç¾©ã—ã€ã‚µãƒ¼ãƒãƒ›ã‚¹ãƒˆ host1, host2 ã‚’å®šç¾©ã—ãŸã€‚ãã‚Œãã‚Œã§ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»MAC ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å®šç¾©ã—ã¦ã„ã‚‹ã€‚ã¾ãŸ link ã«ã‚ˆã‚Šä»®æƒ³ã‚¹ã‚¤ãƒƒãƒã¨ã‚µãƒ¼ãƒãƒ›ã‚¹ãƒˆã® I/F ã‚’æ¥ç¶šã—ã¦ã„ã‚‹ã€‚\nã„ã‚ˆã„ã‚ˆ L2 ã‚¹ã‚¤ãƒƒãƒã®ã‚³ãƒ¼ãƒ‰ã€‚l2-switch.rb ã¨ã—ã¦ã€ä¸‹è¨˜ã‚’è¨˜è¿°ã™ã‚‹ã€‚\nrequire \u0026quot;fdb\u0026quot; class LearningSwitch \u0026lt; Controller def start @fdb = FDB.new end def packet_in dpid, message @fdb.learn message.macsa, message.in_port port_no = @fdb.lookup( message.macda ) if port_no flow_mod dpid, message, port_no packet_out dpid, message, port_no else flood dpid, message end end def flow_mod dpid, message, port_no send_flow_mod_add( dpid, :match =\u0026gt; ExactMatch.from( message ), :actions =\u0026gt; ActionOutput.new( port_no ) ) end def flow_mod dpid, message, port_no send_flow_mod_add( dpid, :match =\u0026gt; ExactMatch.from( message ), :actions =\u0026gt; ActionOutput.new( port_no ) ) end def packet_out dpid, message, port_no send_packet_out( dpid, :packet_in =\u0026gt; message, :actions =\u0026gt; ActionOutput.new( port_no ) ) end def flood dpid, message packet_out dpid, message, OFPP_FLOOD end end ã¾ãšå®Ÿè¡Œã—ã¦ã¿ã‚‹ã€‚\n% trema run l2-switch.rb -c l2-switch.conf ç•°ãªã‚‹ shell ã§ãƒ‘ã‚±ãƒƒãƒˆã®é€ä¿¡ã¨çŠ¶æ…‹è¡¨ç¤ºã‚’è¡Œã†ã€‚\n% trema send_packet --source host1 --dest host2 % trema show_stats host1 ip_dst,tp_dst,ip_src,tp_src,n_pkts,n_octets 192.168.0.2,1,192.168.0.1,1,1,50 % trema send_packet --source host1 --dest host2 % trema send_packet --source host2 --dest host1 % trema dump_flows 0xabc NXST_FLOW reply (xid=0x4): cookie=0x2, duration=67.343s, table=0, n_packets=0, n_bytes=0, priority=65535,udp,in_port=1,vlan_tci=0x0000,dl_src=00:00:00:01:00:02,dl_dst=00:00:00:01:00:01,nw_src=192.168.0.2,nw_dst=192.168.0.1,nw_tos=0,tp_src=1,tp_dst=1 actions=output:2 cookie=0x1, duration=70.339s, table=0, n_packets=0, n_bytes=0,\tpriority=65535,udp,in_port=2,vlan_tci=0x0000,dl_src=00:00:00:01:00:01,dl_dst=00:00:00:01:00:01,nw_src=192.168.0.1,nw_dst=192.168.0.1,nw_tos=0,tp_src=1,tp_dst=1 actions=output:2 host1 ã‹ã‚‰ host2 ã«å¯¾ã—ã¦ trema send_packet ã§é€šä¿¡ã‚’è¡Œã„ã€host1 ã®çŠ¶æ…‹ã‚’è¡¨ç¤ºã— ãŸã€‚ã¾ãŸäº¤äº’ã«é€šä¿¡ã‚’ã•ã›ãƒ•ãƒ­ãƒ¼ã‚’ãƒ€ãƒ³ãƒ—ã—ãŸã®ãŒä¸Šè¨˜ã ã€‚\nä¸€ç•ªåŸºæœ¬ãªã¨ã“ã‚ã‚‰ã—ã„ã®ã§ã€ã‚³ãƒ¼ãƒ‰ã‚’è©³ã—ãè§£èª¬ã€‚l2-switch.rb ã®ä¸‹è¨˜ã®éƒ¨åˆ†ã€‚\ndef packet_in dpid, message # ---(1) @fdb.learn message.macsa, message.in_port # ---(2) port_no = @fdb.lookup( message.macda ) # ---(3) if port_no # ---(4) flow_mod dpid, message, port_no packet_out dpid, message, port_no else # ---(5) flood dpid, message end end (1) ã§ã¯ packet_in ãƒãƒ³ãƒ‰ãƒ©ã‚’åˆ©ç”¨ã—ãŸã€‚(2) ã§ fdb (floating DB) ã® learn ãƒ¡ã‚½ãƒƒ ãƒ‰ã§ port ã¨ mac ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å­¦ç¿’ã‚’è¡Œã£ãŸã€‚(3) ã§ @fdb ã«ã™ã§ã« mac ã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨˜ è¿°ãŒã‚ã‚Œã° port_no ã«å€¤ãŒå…¥ã‚‹ã€‚å€¤ãŒå…¥ã£ã¦ã„ã‚Œã° (4) ã‚’ã€‚ã‚¹ã‚¤ãƒƒãƒã®ãƒ•ãƒ­ãƒ¼ãƒ†ãƒ¼ãƒ–\nãƒ«ã‚’æ›´æ–°ã—ãƒ‘ã‚±ãƒƒãƒˆã‚’ packet_out ã™ã‚‹ã€‚å…¥ã£ã¦ã„ãªã‘ã‚Œã° (5)ã‚’å®Ÿè¡Œã—ãƒ‘ã‚±ãƒƒãƒˆã‚’ flood ã™ã‚‹ã€‚\nflow_mod, packet_out, flood ã¯ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…ã§å®šç¾©ã—ã¦ã„ã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªãƒ¡ã‚½ãƒƒ ãƒ‰ã ã€‚\nã“ã®æ™‚ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢æ§‹æˆ ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’å‹•ä½œã•ã›ãŸéš›ã«å®Ÿè¡Œã—ãŸãƒ›ã‚¹ãƒˆä¸Šã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’è¦‹ã¦ã¿ãŸã€‚\novs-openflowd phost switch_manager ãŒå±…ãŸã€‚siwtch_manager ãŒ 6633 ç•ªãƒãƒ¼ãƒˆå¾…ã¡å—ã‘ã¦ã„ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©è‡ªèº«ã ã‚ã†ã€‚ phost ã¯ä»®æƒ³ã‚µãƒ¼ãƒã§ ovs-openflowd (OpenvSwitch) ãŒä»®æƒ³ã‚¹ã‚¤ãƒƒãƒã¨ã—ã¦å‹•ä½œã—ã¦ ã„ã‚‹ã¨æƒ³åƒå‡ºæ¥ã‚‹ã€‚ã¾ãŸã“ã®æ™‚ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒ\ntrema0-0 trema0-1 trema1-0 trema1-1 ã¨èµ·å‹•ã—ã¦ã„ãŸã€‚ã“ã‚Œã¯ 0xabc ã‚¹ã‚¤ãƒƒãƒã¨ host1, host2 ã¨ã®æ¥ç¶šã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ I/F ã ã‚ã†ã€‚\nã¾ã¨ã‚ Ruby ã§è¨˜è¿°å‡ºæ¥ã‚‹ã®ã§æŠ€è¡“è€…ã«ã¨ã£ã¦ Trema ã¯å„ªã—ã„ã€‚ã¾ãŸç°¡æ½”ãªè¨˜è¿°ãŒè¡Œãˆã‚‹ã¨ã„ ã†ã®ã‚‚ Ruby ãªã‚‰ã§ã¯ã ã‚ã†ã€‚github.com ã«ã¯é«˜åº¦ãªåˆ©ç”¨ã‚µãƒ³ãƒ—ãƒ«ãŒå¹¾ã¤ã‹æ²è¼‰ã•ã‚Œ ã¦ã„ã‚‹ã€‚\nhttps://github.com/trema/apps ã¾ãŸç°¡å˜ãªã‚µãƒ³ãƒ—ãƒ«é›†ã¨ã„ã†ã“ã¨ã§ã‚ã‚Œã°\nhttps://github.com/trema/trema/tree/develop/src/examples ãŒã†ã£ã¦ã¤ã‘ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã«ãªã‚‹ã€‚\nå†’é ­ã§ã‚‚æ›¸ã„ãŸãŒã‚¹ã‚¤ãƒƒãƒã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãŒåŒå°ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€æŠ€è¡“è€…ã¯ã™ãã«é–‹ç™º ã«å…¥ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚\nOpenStack ã¯ä»®æƒ³ãƒã‚·ãƒ³ã‚’ç®¡ç†ãƒ»æ§‹æˆã™ã‚‹ãŸã‚ API ã‚’æä¾›ã—ã€ãã—ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç®¡ç†ãƒ» æ§‹æˆã™ã‚‹ãŸã‚ OpenFlow ãŒã‚ã‚‹ã€‚OpenStack ã® API ã‚’å©ãã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã®ã¨åŒæ§˜ã« OpenFlow ã‚’ Trema ã¨ã„ã† OpenFlow ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ç”¨ã„ã¦ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ ãã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ä»•äº‹ã®ç¯„å›²ã¯ç¢ºå®Ÿã«ã“ã“æ•°å¹´ã§å¤‰åŒ–ã—ã€ãã®å¤‰ åŒ–ã«è¿½ã„ã¤ãã«ã¯ \u0026ldquo;ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã\u0026rdquo; ã“ã¨ã‚’å¿µé ­ã«ç½®ã‹ãªãã¦ã¯ãªã‚‰ãªã„ã ã‚ã†ã€‚\næœ€å¾Œã«ã€ã“ã®æ©Ÿä¼šã‚’ä¸ãˆã¦ãã ã•ã£ãŸ éˆ´æœ¨æ§˜ãƒ»é«˜å®®æ§˜ã«ãŠç¤¼ã‚’ç”³ã—ä¸Šã’ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/11/21/openflow-trema-handson-report/","summary":"\u003cp\u003eInternetWeek2012 ã§é–‹ã‹ã‚ŒãŸ \u0026ldquo;OpenFlow Trema ãƒãƒ³ã‚ºã‚ªãƒ³\u0026rdquo; ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eè¬›å¸«   : Trema é–‹ç™ºãƒãƒ¼ãƒ  éˆ´æœ¨ä¸€å“‰ã•ã¾, é«˜å®®å®‰ä»ã•ã¾\né–‹å‚¬æ—¥ : 2012å¹´11æœˆ21æ—¥\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOpenStack ã® Quantum Plugin ã¨ã—ã¦ Trema ãŒæ‰±ãˆã‚‹ã¨ã„ã†è©±ã ã£ãŸã®ã§èˆˆå‘³ã‚’æŒã£\nãŸã®ãŒãã£ã‹ã‘ã§ã™ã€‚ã¾ãŸ Ruby ã§ç°¡æ½”ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ã‚³ãƒ¼ãƒ‰åŒ–å‡ºæ¥ã‚‹ã€ã¨ã„ã†ç‚¹ã‚‚\nå€‹äººçš„ã«éå¸¸ã«èˆˆå‘³ã‚’æŒã¡ã¾ã—ãŸã€‚OpenStack, CloudStack ç­‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰ç®¡ç†ã‚½ãƒ•ãƒˆã‚¦ã‚§\nã‚¢ãŒæä¾›ã™ã‚‹ API ã¨ã„ã„ã€Opscode Chef, Puppet ç­‰ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢æ§‹ç¯‰ãƒ•ãƒ¬ãƒ¼\nãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã„ã„ã€ã“ã® OpenFlow ã‚‚ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å½¢æˆã™ã‚‹æŠ€è¡“ã‚’æŠ½è±¡åŒ–ã—ã€æŠ€è¡“è€…ãŒã‚³ãƒ¼\nãƒ‰ã‚’æ›¸ãã“ã¨ã§ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰ã‚’è¡Œãˆã‚‹ã€ã¨ã„ã†ç‚¹ã§ã¯ã‚¤ãƒãƒ‰ã‚­ã ãªã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eGoogle ã¯æ—¢ã«ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼é–“ã®é€šä¿¡ã‚’ 100% ã€OpenFlow ã®ä»•æ§˜ã«æ²¿ã£ãŸæ©Ÿå™¨ãƒ»ã‚½ãƒ•\nãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚’ç‹¬è‡ªã«å®Ÿè£…ã—ã•ã°ã„ã¦ã„ã‚‹ãã†ã§ã™ã—ã€æˆ‘ã€…ãŒåˆ©ç”¨ã™ã‚‹æ—¥ã‚‚è¿‘ã„ã¨æƒ³åƒã—\nã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"openflow-ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³\"\u003eOpenFlow ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³\u003c/h2\u003e\n\u003cp\u003eOpenFlow ã®ç™»å ´ã«ã¯ç†ç”±ãŒå¹¾ã¤ã‹ã‚ã£ã¦ã€æ—¢å­˜ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æŠ±ãˆã¦ã„ã‚‹ä¸‹è¨˜ã®å¹¾\nã¤ã‹ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã§ã™ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eè£…ç½®ä»•æ§˜ã®è‚¥å¤§åŒ–\u003c/li\u003e\n\u003cli\u003eå¤šæ§˜ãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒæ¨™æº–åŒ–\u003c/li\u003e\n\u003cli\u003eè£…ç½®ã®ã‚³ã‚¹ãƒˆå¢—å¤§\u003c/li\u003e\n\u003cli\u003eã‚ã‚‹æ„å‘³ã€è‡ªå¾‹ã—ãŸã‚·ã‚¹ãƒ†ãƒ ãŒæ‹›ãè¤‡é›‘ã•\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä¸€æ–¹ã€OpenFlow ã‚’åˆ©ç”¨ã™ã‚‹ã¨..\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eã‚³ãƒ¢ãƒ‡ã‚£ãƒ†ã‚£åŒ–ã•ã‚ŒãŸ HW ã®åˆ©ç”¨ãŒå¯èƒ½\u003c/li\u003e\n\u003cli\u003eOpenFlow ã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ© (ç¥) ãŒé›†ä¸­ç®¡ç†ã™ã‚‹ã®ã§æ¥½ãªå ´åˆã‚‚ã‚ã‚‹\u003c/li\u003e\n\u003cli\u003eãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é‹ç”¨ã®è‡ªå‹•åŒ–ãŒå›³ã‚Œã‚‹\u003c/li\u003e\n\u003cli\u003eã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«åˆã‚ã›ãŸæœ€é©åŒ–\u003c/li\u003e\n\u003cli\u003eæŸ”è»Ÿãªè‡ªå·±ä¿®å¾©\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç­‰ã®ãƒ¡ãƒªãƒƒãƒˆãŒã€‚\u003c/p\u003e\n\u003ch2 id=\"openflow-ã¨-trema-ã¨ã¯\"\u003eOpenFlow ã¨ Trema ã¨ã¯?\u003c/h2\u003e\n\u003cp\u003eOpenFlow ã¯ \u0026lsquo;OpenFlow ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©\u0026rsquo;, \u0026lsquo;OpenFlow ã‚¹ã‚¤ãƒƒãƒ\u0026rsquo; ã‹ã‚‰æˆã‚‹ã€‚OpenFlow ã‚³\nãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¨ OpenFlow ã‚¹ã‚¤ãƒƒãƒã®é–“ã®é€šä¿¡ã¯ OpenFlow ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã•ã‚Œã‚‹ã€‚ä»Šæ—¥ã®\nè©±é¡Œ Trema ã¯ã“ã®..\u003c/p\u003e","title":"OpenFlow Trema ãƒãƒ³ã‚ºã‚ªãƒ³å‚åŠ ãƒ¬ãƒãƒ¼ãƒˆ"},{"content":"â€»2012/12/04 ã«å†…å®¹ã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚Network Node ã‚’åˆ‡ã‚Šå‡ºã™ã‚ˆã†ä¿®æ­£ã€‚ â€»213/01/09 ã«å†…å®¹ã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¿®æ­£ã§ã™ã€‚\nOpenStack ã® Folsom ãƒªãƒªãƒ¼ã‚¹ã‹ã‚‰ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä»²é–“å…¥ã‚Šã—ãŸ Quantum ã‚’ ç†è§£ã™ã‚‹ã®ã«æ™‚é–“ã‚’è¦ã—ã¦ã—ã¾ã£ãŸã®ã ã‘ã©ã€ã‚‚ã†æ•°åå›ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ç¹°ã‚Šè¿”ã—ã¦ ã ã„ã¶ç†è§£å‡ºæ¥ã¦ãã¾ã—ãŸã€‚æ‰‹ä½œæ¥­ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‹ã¨æ—¥ãŒæš®ã‚Œã¦ã—ã¾ã†ã®ã§ã¨æ€ã£ ã¦è‡ªåˆ†ç”¨ã« bash ã§æ§‹ç¯‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã£ãŸã®ã ã‘ã©ã€ãã‚Œã‚’å…¬é–‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\nOpenStack Folsom ã®æ§‹ç¯‰ã«å››è‹¦å…«è‹¦ã—ã¦ã„ã‚‹æ–¹ã«ä½¿ã£ã¦ã‚‚ã‚‰ãˆãŸã‚‰ã¨æ€ã£ã¦ã¾ã™ã€‚\nhttp://jedipunkz.github.com/openstack_folsom_deploy/\nchef ã‚„ puppet, juju ãªã©ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ä»Šæµè¡Œã§ã™ã€‚ãŸã ã©ã‚Œã‚‚ç’°å¢ƒ ã‚’äºˆã‚æ§‹ç¯‰ã—ãªãã¦ã¯ã„ã‘ãªã„ã®ã§ã€èª°ã§ã‚‚ã™ãã«ä½¿ãˆã‚‹ç’°å¢ƒã£ã¦ã“ã¨ã§ bash ã‚¹ã‚¯ãƒª ãƒ—ãƒˆã§æ›¸ã„ã¦ã„ã¾ã™ã€‚æ™‚é–“ãŒã‚ã‚Œã°æ˜¯é chef ã® cookbook ã‚’æ›¸ã„ã¦ã„ããŸã„ã§ã™ã€‚ã¨ ã„ã†ã‹äºˆå®šã§ã™ã€‚ã§ã‚‚ã€ã‚‚ã†ã™ã§ã« opscode ç­‰ã¯æ›¸ãå§‹ã‚ã¦ã„ã¾ã™ã€‚(æ±—\nã§ã¯ã§ã¯ã€ç´¹ä»‹ã‚’å§‹ã‚ã¾ã™ã€‚\nå‰æã®æ§‹æˆ management segment 172.16.1.0/24 +--------------------------------------------+------------------+----------------- | | | | | | | eth2 172.16.1.13 | eth2 172.16.1.12 | eth2 172.24.1.11 +------------+ +-----------+ +------------+ | | eth1 ------------------- eth1 | | | | | network | vlan/gre seg = 172.24.17.0/24 | compute | | controller | | node | data segment = 172.16.2.0/24 | node | | node | +------------+ 172.16.2.13 172.16.2.12 +-----------+ +------------+ | eth0 10.200.8.13 | eth0 10.200.8.11 | | | | +--------------------------------------------+------------------+----------------- | public segment 10.200.8.0/24 | | 10.200.8.1 +-----------+ | GW Router |-\u0026gt; The Internet +-----------+ Quantum ã¯ã€\nAPI network Public network Data network Management Network ã®4ã¤ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’å‰æã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚4ã¤ç”¨æ„ã™ã‚‹ã®ãŒå¤§å¤‰ãªã® ã§ä»Šå›ã¯\nAPI / Management network Public Network Data Network ã¨ API ã¨ Management ã‚’å…¼å‹™ã•ã›ãŸ3ã¤ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’å‰æã«è©±ç¶šã‘ã¾ã™ã€‚ ã‚‚ã¡ã‚ã‚“ Management ã‚’è¿½åŠ ã§åˆ‡ã‚Šå‡ºã—ã¦ã‚‚æ§‹ã‚ãªã„ã§ã™ã€‚NIC ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ OK ã€‚\nè©³ã—ãã¯ã€\nhttp://docs.openstack.org/trunk/openstack-network/admin/content/connectivity.html\nã«æ²è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚\nã¾ãŸä»Šå›ã¯ public network ã« 10.200.8/24 ã‚’ä½¿ã£ã¦ã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ç’°å¢ƒã§ã¯ã“ã“ãŒ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«ãªã‚Šã¾ã™ã€‚\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯¾è±¡ OS ã¯ Ubuntu Server 12.04 LTS ã‚‚ã—ãã¯ 12.10 ã§å‹•ä½œã—ã¾ã™ã€‚\n3ã¤ã® NIC ãŒã‚ã‚‹ãƒã‚·ãƒ³ã‚’1å°ã€NIC 2ã¤ã®ãƒã‚·ãƒ³ã‚’2å°ã‚’ç”¨æ„ã—ã¾ã™ã€‚ controller node x 1å° network node x 1å° + comupte node x nå° ã®æ§‹æˆã§ ã™ã€‚\ncontroller : glance, keystone, mysql, horizon, quantum server ãŒç¨¼åƒã™ã‚‹ Node network : quantum dhcp agent, quantum l3 agent, quantum openvswitch agent ãŒç¨¼åƒã™ã‚‹ Node compute : nova, quntum openvswitch agent ãŒç¨¼åƒã™ã‚‹ Node ä¸Šè¨˜ã®æ§‹æˆã§ã¯ä¸‹è¨˜ã®é€šã‚Š /etc/network/interface ã‚’è¨­å®šã—ã¾ã™ã€‚controller å´ã® è¨­å®šã§ã™ã€‚\nauto lo iface lo inet loopback auto eth0 iface eth0 inet static address 10.200.8.11 netmask 255.255.255.0 dns-nameservers 8.8.8.8 8.8.4.4 dns-search cpi.ad.jp auto eth2 iface eth2 inet static address 172.16.1.11 netmask 255.255.255.0 gateway 172.16.1.1 Network Node ã¯\u0026hellip;\nauto lo iface lo inet loopback auto eth0 iface eth0 inet static up ifconfig $IFACE 0.0.0.0 up up ip link set $IFACE promisc on down ip link set $IFACE promisc off down ifconfig $IFACE down address 10.200.8.21 netmask 255.255.255.0 #gateway 10.200.8.1 # dns-* options are implemented by the resolvconf package, if installed dns-nameservers 8.8.8.8 8.8.4.4 dns-search cpi.ad.jp auto eth1 iface eth1 inet static address 172.16.2.13 netmask 255.255.255.0 auto eth2 iface eth2 inet static address 172.16.1.13 netmask 255.255.255.0 gateway 172.16.1.1 dns-nameservers 8.8.8.8 8.8.4.4 compute Node ã¯\u0026hellip;\nauto eth1 iface eth1 inet static address 172.16.2.12 netmask 255.255.255.0 auto eth2 iface eth2 inet static address 172.16.1.12 netmask 255.255.255.0 gateway 172.16.1.1 dns-nameservers 8.8.8.8 8.8.4.4 ã§ã™ã€‚ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚ ã“ã“ã¾ã§ç”¨æ„å‡ºæ¥ãŸã‚‰ã„ã‚ˆã„ã‚ˆå®Ÿè¡Œã™ã‚‹ã®ã¿ã§ã™ã€‚\ncontroller% sudo /etc/init.d/networking restart network % sudo /etc/init.d/networking restart compute % sudo /etc/init.d/networking restart ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ ä¸‹è¨˜ã®é€šã‚Šã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å–å¾—ã—ã¦\u0026hellip;\ncontroller% git clone https://github.com/jedipunkz/openstack_folsom_deploy.git controller% cd openstack_folsom_deploy ãã‚Œãã‚Œã®æ§‹æˆã«åˆã‚ã›ã¦ deploy.conf ã‚’ä¿®æ­£ã—ã¾ã™ã€‚ä¸Šè¨˜ã®æ§‹æˆã®å ´åˆä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\nBASE_DIR=`pwd` CONTROLLER_NODE_IP='172.16.1.11' CONTROLLER_NODE_PUB_IP='10.200.8.11' NETWORK_NODE_IP='172.16.1.12' COMPUTE_NODE_IP='172.16.1.13' DATA_NIC_COMPUTE='eth1' MYSQL_PASS='secret' CINDER_VOLUME='/dev/sda6' DATA_NIC='eth1' PUBLIC_NIC='eth0' NETWORK_TYPE='gre' INT_NET_GATEWAY='172.24.17.254' INT_NET_RANGE='172.24.17.0/24' EXT_NET_GATEWAY='10.200.8.1' EXT_NET_START='10.200.8.36' EXT_NET_END='10.200.8.40' EXT_NET_RANGE='10.200.8.0/24' OS_IMAGE_URL=\u0026quot;https://launchpad.net/cirros/trunk/0.3.0/+download/cirros-0.3.0-x86_64-disk.img\u0026quot; OS_IMAGE_NAME=\u0026quot;Cirros 0.3.0 x86_64\u0026quot; ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã™ã‚Œã° OK ã§ã™ã€‚ä¸Šè¨˜ã®å‰æã®æ§‹æˆã®å ´åˆã“ã®ã‚ˆã†ãªå€¤ã‚’å…¥ã‚Œã¦ã„ ãã¾ã™ã€‚é‡è¦ãªã¨ã“ã‚ã ã‘èª¬æ˜ã™ã‚‹ã¨..\nCONTROLLER_NODE_IP : Controller Node ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ NETWROK_NODE_IP : Network Node ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ COMPUTE_NODE_IP : Compute Node ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ INT_NET_.. : Quantum ã§ç®¡ç†ã™ã‚‹å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ EXT_NET-.. : Quantum ã§ç®¡ç†ã™ã‚‹å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã§ã™ã€‚\ndeploy.conf ã‚’ä¿®æ­£ã—ãŸã‚‰ã€å„ Node ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚\nnetwork% scp -r \u0026lt;CONTROLLER_NODE_IP\u0026gt;:~/openstack_folsom_deploy . compute% scp -r \u0026lt;CONTROLLER_NODE_IP\u0026gt;:~/openstack_folsom_deploy . ã„ã‚ˆã„ã‚ˆå®Ÿè¡Œã€‚ãã‚Œãã‚Œã® Node ã§é †ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\ncontroller% sudo ./deploy.sh controller quantum network % sudo ./deploy.sh network quantum compute % sudo ./deploy.sh compute quantum ã¾ãŸæ§‹ç¯‰ãŒçµ‚äº†ã—ãŸã‚‰ quantum ä¸Šã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã—ã¾ã™ã€‚\ncontroller% sudo ./deploy.sh create_network qunatum å®Œæˆã§ã™ã€‚http://${CONTROLLER_NODE_IP}/horizon/ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚Œã°ç®¡ ç†ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚\næ›´ã« compute node ã‚’è¿½åŠ ã—ãŸã‘ã‚Œã°\u0026hellip;\ncompute02% scp -r \u0026lt;CONTROLLER_NODE_IP\u0026gt;:~/openstack_folsom_deploy . compute02% cd openstack_folsom_deploy compute02% vim deploy.conf # $COMPUTE_NODE_IP ã‚’ä¿®æ­£ã™ã‚‹ã€‚ãã®ä»–ã¯ãã®ã¾ã¾ã€‚ compute02% sudo ./deploy.sh compute quantum ã¨ deploy.conf å†… $COMPUTE_NODE_IP ã‚’æ›´æ–°ã—ã¦å®Ÿè¡Œã™ã‚Œã° OK ã§ã™ã€‚\nFloating IP ã®åˆ©ç”¨ ç¾åœ¨ã€folsom ãƒªãƒªãƒ¼ã‚¹ç‰ˆã«ã¯ floating ip ãŒ horizon çµŒç”±ã§åˆ©ç”¨ã§ããªã„å•é¡ŒãŒã‚ ã‚Šã¾ã™ã€‚ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã¯åˆ©ç”¨ã§ãã‚‹ã®ã§ãã®æ–¹æ³•ã‚’ã€‚\n% source $HOME/openstackrc % quantum net-list % quantun floatingip-create \u0026lt;ext_net_id\u0026gt; % quantun floatingip-list % quantum port-list % quantum floatingip-associate \u0026lt;floatingip_id\u0026gt; \u0026lt;vm_port_id\u0026gt; Quantum ã¨ I/O ã¨..æ‰€æ„Ÿ http://www.readability.com/read?url=http://docs.openstack.org/trunk/openstack-network/admin/content/services.html\næœ€è¿‘ã€ãƒ¡ãƒ¼ãƒªãƒ³ã‚°ãƒªã‚¹ãƒˆã§æŒ™ãŒã£ã¦ã„ã‚‹è©±é¡Œã€‚ä»Šå›ã®æ§‹æˆã ã¨ Quantum ã¯ controller ä¸Šã§ç¨¼åƒã—å…¨ã¦ã® VM ãŒã“ã® Quantum ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šå˜ä¸€éšœå®³ç‚¹ã£ ã¦ã„ã†ã ã‘ã§ã¯ãªã I/O ãŒé›†ä¸­ã™ã‚‹ã®ã§è² è·ã‚‚ä¸Šæ˜‡ã™ã‚‹ã€‚å‰ãƒªãƒªãƒ¼ã‚¹ç‰ˆ ESSEX ã® nova-network ã®æ™‚ã¯è¿½åŠ ã™ã‚‹ compute node ä¸Šå…¨ã¦ã§ nova-network ã‚’ç¨¼åƒã•ã›ã€ node ãŒå¢—ãˆã‚‹ã«ã¤ã‚Œ I/O ã‚‚æ‹¡å¼µå‡ºæ¥ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆãŒçµ„ã‚ã‚‹ãƒ¢ãƒã ã£ãŸã®ã§ã™ãŒã€ Quantum ã®æ§‹æˆã«ãªã£ã¦ã€ãã†ç°¡å˜ã«ã„ã‹ãªããªã£ãŸã€‚\nã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆç­‰ã€ã»ã‹ã®æ§‹æˆã«ã¤ã„ã¦ 2013/01/09 ã« nova-network ã«ã‚‚å¯¾å¿œã—ã¾ã—ãŸã€‚\nã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³æ§‹æˆã‚„ quantum ã«ä»£ã‚ã£ã¦ nova-network ã‚’ä½¿ã†æ§‹æˆç­‰ã€ãã®ä»–ã®æ§‹æˆæ§‹ç¯‰æ–¹æ³• ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚\nhttps://github.com/jedipunkz/openstack_folsom_deploy/blob/master/README_jp.md\n","permalink":"https://jedipunkz.github.io/post/2012/11/10/openstack-folsom-install/","summary":"\u003cp\u003eâ€»2012/12/04 ã«å†…å®¹ã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚Network Node ã‚’åˆ‡ã‚Šå‡ºã™ã‚ˆã†ä¿®æ­£ã€‚\nâ€»213/01/09 ã«å†…å®¹ã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¿®æ­£ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eOpenStack ã® Folsom ãƒªãƒªãƒ¼ã‚¹ã‹ã‚‰ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä»²é–“å…¥ã‚Šã—ãŸ Quantum ã‚’\nç†è§£ã™ã‚‹ã®ã«æ™‚é–“ã‚’è¦ã—ã¦ã—ã¾ã£ãŸã®ã ã‘ã©ã€ã‚‚ã†æ•°åå›ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ç¹°ã‚Šè¿”ã—ã¦\nã ã„ã¶ç†è§£å‡ºæ¥ã¦ãã¾ã—ãŸã€‚æ‰‹ä½œæ¥­ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‹ã¨æ—¥ãŒæš®ã‚Œã¦ã—ã¾ã†ã®ã§ã¨æ€ã£\nã¦è‡ªåˆ†ç”¨ã« bash ã§æ§‹ç¯‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã£ãŸã®ã ã‘ã©ã€ãã‚Œã‚’å…¬é–‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eOpenStack Folsom ã®æ§‹ç¯‰ã«å››è‹¦å…«è‹¦ã—ã¦ã„ã‚‹æ–¹ã«ä½¿ã£ã¦ã‚‚ã‚‰ãˆãŸã‚‰ã¨æ€ã£ã¦ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://jedipunkz.github.com/openstack_folsom_deploy/\"\u003ehttp://jedipunkz.github.com/openstack_folsom_deploy/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003echef ã‚„ puppet, juju ãªã©ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ä»Šæµè¡Œã§ã™ã€‚ãŸã ã©ã‚Œã‚‚ç’°å¢ƒ\nã‚’äºˆã‚æ§‹ç¯‰ã—ãªãã¦ã¯ã„ã‘ãªã„ã®ã§ã€èª°ã§ã‚‚ã™ãã«ä½¿ãˆã‚‹ç’°å¢ƒã£ã¦ã“ã¨ã§ bash ã‚¹ã‚¯ãƒª\nãƒ—ãƒˆã§æ›¸ã„ã¦ã„ã¾ã™ã€‚æ™‚é–“ãŒã‚ã‚Œã°æ˜¯é chef ã® cookbook ã‚’æ›¸ã„ã¦ã„ããŸã„ã§ã™ã€‚ã¨\nã„ã†ã‹äºˆå®šã§ã™ã€‚ã§ã‚‚ã€ã‚‚ã†ã™ã§ã« opscode ç­‰ã¯æ›¸ãå§‹ã‚ã¦ã„ã¾ã™ã€‚(æ±—\u003c/p\u003e\n\u003cp\u003eã§ã¯ã§ã¯ã€ç´¹ä»‹ã‚’å§‹ã‚ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰æã®æ§‹æˆ\"\u003eå‰æã®æ§‹æˆ\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003emanagement segment 172.16.1.0/24\n+--------------------------------------------+------------------+-----------------\n|                                            |                  |\n|                                            |                  |\n| eth2 172.16.1.13                           | eth2 172.16.1.12 | eth2 172.24.1.11\n+------------+                               +-----------+      +------------+\n|            | eth1 ------------------- eth1 |           |      |            |\n|  network   | vlan/gre seg = 172.24.17.0/24 |  compute  |      | controller |\n|    node    | data segment = 172.16.2.0/24  |   node    |      |    node    |\n+------------+ 172.16.2.13       172.16.2.12 +-----------+      +------------+      \n| eth0 10.200.8.13                                              | eth0 10.200.8.11\n|                                                               |\n|                                                               |\n+--------------------------------------------+------------------+-----------------\n|       public segment 10.200.8.0/24\n|\n| 10.200.8.1\n+-----------+\n| GW Router |-\u0026gt; The Internet\n+-----------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eQuantum ã¯ã€\u003c/p\u003e","title":"OpenStack Folsom æ§‹ç¯‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ"},{"content":"æœ€è¿‘ã€OpenStack ã«ã©ã£ã·ã‚Šæµ¸ã‹ã£ã¦ã‚‹ @jedipunkz ã§ã™ã€‚\nFolsom ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ Quantum ã‚’ç†è§£ã™ã‚‹ã®ã«ã‚ã¡ã‚ƒè‹¦åŠ´ã—ã¦æ¥½ã—ã„çœŸã£æœ€ä¸­ãªã®ã ã‘ã©ã€ ä»Šæ—¥ã¯ OpenStack ã®ä¸­ã§ã‚‚æœ€ã‚‚æ¯ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ Swift ã‚’ä½¿ã£ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ ã‚¸æ§‹ç¯‰ã«ã¤ã„ã¦å°‘ã—æ›¸ã“ã†ã‹ãªãã¨æ€ã£ã¦ã¾ã™ã€‚\næœ€è¿‘ã¯ OpenStack ã‚’æ§‹ç¯‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã«çš†ã€Swift å…¥ã‚Œã¦ãªã„ã®ã­ã€‚ä»²é–“ã¯ãšã‚Œ æ„ŸãŸã£ã·ã‚Šã ã‘ã©ã€ä¸€ç•ªå®‰å®šã—ã¦å‹•ãã¨æ€ã£ã¦ã‚‹ã€‚\nã“ã‚Œã‚’èª­ã‚“ã§ã€è‡ªå®…ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ç½®ã„ã¡ã‚ƒãŠã…ã€‚\næ§‹æˆã¯ ?\u0026hellip; +--------+ | client | +--------+ | +-------------+ | swift-proxy | +-------------+ 172.16.0.10 | +-------------------+-------------------+ 172.16.0.0/24 | | | +-----------------+ +-----------------+ +-----------------+ | swift-storage01 | | swift-storage02 | | swift-storage03 | +-----------------+ +-----------------+ +-----------------+ 172.16.0.11 172.16.0.12 172.16.0.13 ã¨ãªã‚‹ã€‚IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯\u0026hellip;\nclient : 172.16.0.0/24 ã®ã©ã“ã‹ swift-proxy : 172.16.0.10 swift-storage01 : 172.16.0.11 swift-storage02 : 172.16.0.12 swift-storage03 : 172.16.0.13 ã“ã‚Œã¯ã‚µãƒ³ãƒ—ãƒ«ã€‚è‡ªå®…ã®ç’°å¢ƒã«åˆã‚ã›ã¦èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚\nå…¨ã¦åŒã˜ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«ã€‚ãªã®ã§ä¸Šã®å›³ã¯æ¦‚å¿µçš„ãªå›³ã§ã™ã€‚é€šä¿¡ã®æµã‚Œã ã‘ æŠŠæ¡å‡ºæ¥ã‚Œã°ã„ã„ãªãã¨ã€‚å‘ãæ›¸ã„ã¦ãªã„ã‘ã©..ã€‚å››è§’ã§å›²ã¾ã‚Œã¦ã„ã‚‹ã®ãŒãƒãƒ¼ãƒ‰ (ã‚µãƒ¼ ãƒ) ã§ã™ã€‚ç‰©ç†ã‚µãƒ¼ãƒã§ã‚‚ä»®æƒ³ãƒã‚·ãƒ³ã§ã‚‚å¤§ä¸ˆå¤«ï¼\nãƒã‚·ãƒ³ã®æº–å‚™ Ubuntu Server 12.04 ã‚‚ã—ãã¯ 12.10 ã‚’ç”¨æ„ã€‚swift-storage ã®ãƒã‚·ãƒ³3å°ã ã‘ã¯ /dev/sda6 ãªã© Disk ãƒ‡ãƒã‚¤ã‚¹ã‚’ swift ç”¨ã«ç”¨æ„ã—ã¦ã‚ã’ã¦ãã ã•ã„ã€‚æ™®é€šã«ãƒãƒ¼ãƒ‰ ãƒ‡ã‚£ã‚¹ã‚¯ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã£ã¦ã‚ã’ã‚‹ã ã‘ã§ã„ã„ã§ã™ã€‚é«˜ä¾¡ãª Disk ã‚’ä½¿ã†ã¾ã§ã‚‚ ãªã„ã®ã§ã€‚ãã‚ŒãŒåˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®è‰¯ã„ã¨ã“ã‚ï¼ Disk ãƒ»ãƒãƒ¼ãƒ‰ãŒå£Šã‚Œã¦ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒå¤± ã‚ã‚Œãªã„ã‚“ã§ã™ï¼\nswift-proxy ã®æ§‹ç¯‰ ä»Šå›ã¯ç°¡æ˜“èªè¨¼æ©Ÿèƒ½ã® tempauth ã‚’ä½¿ã„ã¾ã™ã€‚Keystone ã‚’ä½¿ã£ãŸæ§‹æˆã‚’èª¬æ˜ã—ã‚ˆã†ã‹ è¿·ã£ãŸã®ã ã‘ã©ã€Keystone ã®æ§‹ç¯‰ã ã‘ã§ä¸€ã¤è¨˜äº‹ãŒæ›¸ã‘ã‚‹ãã‚‰ã„ã«ãªã‚‹ã®ã§..ã€è«¦ã‚ ã¾ã—ãŸã€‚tempauth ã¯ Swift æœ¬ä½“ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã‚ˆã€‚\næ§‹ç¯‰ã¯ç°¡å˜ã€ã¾ãšä¸‹è¨˜ã‚’ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„ã€‚\napt-get update apt-get install swift python-swift apt-get install python-keystoneclient python-keystone mkdir /etc/swift chown -R swift:swift /etc/swift export PROXY_LOCAL_NET_IP=10.200.4.133 export POUND_NET=10.200.4.138 apt-get install swift-proxy memcached perl -pi -e \u0026quot;s/-l 127.0.0.1/-l $PROXY_LOCAL_NET_IP/\u0026quot; /etc/memcached.conf service memcached restart cat \u0026gt;/etc/swift/proxy-server.conf \u0026lt;\u0026lt;EOF [DEFAULT] #cert_file = /etc/swift/cert.crt #key_file = /etc/swift/cert.key bind_port = 8080 workers = 8 user = swift [pipeline:main] pipeline = healthcheck cache tempauth proxy-server [app:proxy-server] use = egg:swift#proxy allow_account_management = true account_autocreate = true [filter:tempauth] use = egg:swift#tempauth user_system_root = testpass .admin https://$PROXY_LOCAL_NET_IP:8080/v1/AUTH_system [filter:healthcheck] use = egg:swift#healthcheck [filter:cache] use = egg:swift#memcache memcache_servers = $PROXY_LOCAL_NET_IP01:11211 EOF æ¬¡ã« swift.conf ã¨ãƒªãƒ³ã‚°æƒ…å ± (ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã®ãŸã‚ã®æƒ…å ±) ã‚’ swift-proxy ä¸Šã«ç”¨æ„ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ã€ ã‚ã¨ã§å„ã™ã¹ã¦ã®ãƒãƒ¼ãƒ‰ã«é…ç½®ã™ã‚‹ã®ã§é‡è¦ã§ã™ã€‚ã“ã‚Œã‚‚ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„ã€‚\ncat \u0026gt; /etc/swift/swift.conf \u0026lt;\u0026lt; EOF [swift-hash] # random unique string that can never change (DO NOT LOSE) swift_hash_path_suffix = `od -t x8 -N 8 -A n \u0026lt;/dev/random` EOF cd /etc/swift swift-ring-builder account.builder create 18 3 1 swift-ring-builder container.builder create 18 3 1 swift-ring-builder object.builder create 18 3 1 export STORAGE_LOCAL_NET_IP01=172.16.0.11 export STORAGE_LOCAL_NET_IP02=172.16.0.12 export STORAGE_LOCAL_NET_IP03=172.16.0.13 export ZONE01=1 export ZONE02=2 export ZONE03=3 export WEIGHT=100 export DEVICE=sda6 swift-ring-builder account.builder add z$ZONE01-$STORAGE_LOCAL_NET_IP01:6002/$DEVICE $WEIGHT swift-ring-builder container.builder add z$ZONE01-$STORAGE_LOCAL_NET_IP01:6001/$DEVICE $WEIGHT swift-ring-builder object.builder add z$ZONE01-$STORAGE_LOCAL_NET_IP01:6000/$DEVICE $WEIGHT swift-ring-builder account.builder add z$ZONE02-$STORAGE_LOCAL_NET_IP02:6002/$DEVICE $WEIGHT swift-ring-builder container.builder add z$ZONE02-$STORAGE_LOCAL_NET_IP02:6001/$DEVICE $WEIGHT swift-ring-builder object.builder add z$ZONE02-$STORAGE_LOCAL_NET_IP02:6000/$DEVICE $WEIGHT swift-ring-builder account.builder add z$ZONE03-$STORAGE_LOCAL_NET_IP03:6002/$DEVICE $WEIGHT swift-ring-builder container.builder add z$ZONE03-$STORAGE_LOCAL_NET_IP03:6001/$DEVICE $WEIGHT swift-ring-builder object.builder add z$ZONE03-$STORAGE_LOCAL_NET_IP03:6000/$DEVICE $WEIGHT swift-ring-builder account.builder swift-ring-builder container.builder swift-ring-builder object.builder swift-ring-builder account.builder rebalance swift-ring-builder container.builder rebalance swift-ring-builder object.builder rebalance ã§ã€èµ·å‹•ã€‚\nswift-proxy# chown -R swift:swift /etc/swift swift-proxy# swift-init proxy start ãŠã—ã¾ã„ã€‚\nswift-storage æ§‹ç¯‰ swift-storage ã®æ§‹ç¯‰ã¯å„ãƒãƒ¼ãƒ‰ã§ä¸‹è¨˜ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„ã€‚ä»Šå›ã¯3å°åˆ†ã  ã‘ã©ã€ãƒã‚·ãƒ³ãŒä½™ã£ã¦ãŸã‚‰4å°ã§ã‚‚5å°ã§ã‚‚ OK ï¼\napt-get update apt-get install swift python-swift mkdir /etc/swift chown -R swift:swift /etc/swift export STORAGE_LOCAL_NET_IP=172.16.0.11 apt-get install swift-account swift-container swift-object xfsprogs mkfs.xfs -i size=1024 /dev/sda6 echo \u0026quot;/dev/sda6 /srv/node/sda6 xfs noatime,nodiratime,nobarrier,logbufs=8 0 0\u0026quot; \u0026gt;\u0026gt; /etc/fstab mkdir -p /srv/node/sda6 mount /srv/node/sda6 chown -R swift:swift /srv/node cat \u0026gt;/etc/rsyncd.conf \u0026lt;\u0026lt;EOF uid = swift gid = swift log file = /var/log/rsyncd.log pid file = /var/run/rsyncd.pid address = $STORAGE_LOCAL_NET_IP [account] max connections = 2 path = /srv/node/ read only = false lock file = /var/lock/account.lock [container] max connections = 2 path = /srv/node/ read only = false lock file = /var/lock/container.lock [object] max connections = 2 path = /srv/node/ read only = false lock file = /var/lock/object.lock EOF perl -pi -e 's/RSYNC_ENABLE=false/RSYNC_ENABLE=true/' /etc/default/rsync service rsync start cat \u0026gt;/etc/swift/account-server.conf \u0026lt;\u0026lt;EOF [DEFAULT] bind_ip = $STORAGE_LOCAL_NET_IP workers = 2 [pipeline:main] pipeline = account-server [app:account-server] use = egg:swift#account [account-replicator] [account-auditor] [account-reaper] EOF cat \u0026gt;/etc/swift/container-server.conf \u0026lt;\u0026lt;EOF [DEFAULT] bind_ip = $STORAGE_LOCAL_NET_IP workers = 2 [pipeline:main] pipeline = container-server [app:container-server] use = egg:swift#container [container-replicator] [container-updater] [container-auditor] [container-sync] EOF cat \u0026gt;/etc/swift/object-server.conf \u0026lt;\u0026lt;EOF [DEFAULT] bind_ip = $STORAGE_LOCAL_NET_IP workers = 2 [pipeline:main] pipeline = object-server [app:object-server] use = egg:swift#object [object-replicator] [object-updater] [object-auditor] EOF ç’°å¢ƒå¤‰æ•° ${STORAGE_LOCAL_NET_IP} ã‚’3å°æ¯ã«å¤‰ãˆã¦ã€å„å°ã§æµã—è¾¼ã‚“ã§ã‚ã’ãŸã‚‰ã€ swift-proxy ã§ç”Ÿæˆã—ãŸ /etc/swift.conf ã¨ãƒªãƒ³ã‚°æƒ…å ±é”ã‚’å„ swift-storage ã« é…ç½®ã—ã¾ã™ã€‚\nswift-proxy # scp /etc/swift/swift.conf /etc/swift/*ring.gz 172.16.0.11:/tmp/ swift-proxy # scp /etc/swift/swift.conf /etc/swift/*ring.gz 172.16.0.12:/tmp/ swift-proxy # scp /etc/swift/swift.conf /etc/swift/*ring.gz 172.16.0.13:/tmp/ swift-storage01 # mv /tmp/swift.conf /tmp/*ring.gz /etc/swift/ swift-storage01 # chown -R swift:swift /etc/swift swift-storage02 # mv /tmp/swift.conf /tmp/*ring.gz /etc/swift/ swift-storage02 # chown -R swift:swift /etc/swift swift-storage03 # mv /tmp/swift.conf /tmp/*ring.gz /etc/swift/ swift-storage03 # chown -R swift:swift /etc/swift swift-storage ã‚’å„å°ã§èµ·å‹•ã—ã¾ã™ã€‚\nswift-storage01 # swift-init all start swift-storage02 # swift-init all start swift-storage03 # swift-init all start ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ å®Œæˆã—ãŸã®ã§ã€swift ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã€‚\n% swift -A http://172.16.0.10:8080/auth/v1.0 -U system:root -K testpass stat Account: AUTH_system Containers: 4 Objects: 15 Bytes: 23866252 Connection: keep-alive Accept-Ranges: bytes ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã¿ã‚‹ã€‚\n% swift -A http://172.16.0.10:8080/auth/v1.0 -U system:root -K testpass upload test /etc/hosts % swift -A http://172.16.0.10:8080/auth/v1.0 -U system:root -K testpass list % test % cd /tmp/ % swift -A http://172.16.0.10:8080/auth/v1.0 -U system:root -K testpass download test % ls /tmp/etc/hosts ã‚‚ã¡ã‚ã‚“ã€HTTP ãª API ãªã®ã§ curl ç­‰ã® HTTP ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ä½¿ã£ã¦ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ï¼\n% curl -k -v -H 'X-Storage-User: system:root' -H 'X-Storage-Pass: testpass' http://172.16.0.10:8080/auth/v1.0 \u0026lt; HTTP/1.1 200 OK \u0026lt; Server: nginx/1.1.19 \u0026lt; Date: Mon, 03 Sep 2012 04:58:30 GMT \u0026lt; Content-Length: 0 \u0026lt; Connection: keep-alive \u0026lt; X-Storage-Url: https://172.16.0.10:8080/v1/AUTH_system \u0026lt; X-Storage-Token: AUTH_tk8a19f76c9bce4077aee02aef76257020 \u0026lt; X-Auth-Token: AUTH_tk8a19f96c9bce4077aee02aef76257020 \u0026lt; * Connection #0 to host 172.16.0.10 left intact * Closing connection #0 * SSLv3, TLS alert, Client hello (1): å¾—ã‚‰ã‚ŒãŸ X-Auth-Token, X-Storage-Url ã‚’ä½¿ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚\n% curl -k -v -H 'X-Auth-Token: \u0026lt;token-from-x-auth-token-above\u0026gt;' \u0026lt;url-from-x-storage-url-above\u0026gt; \u0026lt; HTTP/1.1 200 OK \u0026lt; Server: nginx/1.1.19 \u0026lt; Date: Mon, 03 Sep 2012 04:59:47 GMT \u0026lt; Content-Type: text/plain; charset=utf-8 \u0026lt; Content-Length: 34 \u0026lt; Connection: keep-alive \u0026lt; X-Account-Object-Count: 15 \u0026lt; X-Account-Bytes-Used: 23866252 \u0026lt; X-Account-Container-Count: 4 \u0026lt; Accept-Ranges: bytes \u0026lt; test * Connection #0 to host 172.16.0.10 left intact * Closing connection #0 * SSLv3, TLS alert, Client hello (1): ã•ã£ãæ”¾ã‚Šè¾¼ã‚“ã  \u0026rsquo;test\u0026rsquo; ãŒ swift ä¸Šã«ã‚ã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ã€‚\nhttp://cyberduck.ch/ ã“ã“ã«ã‚ã‚‹ CyberDuck ã¨ã„ã† GUI ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã‚‹ã‚ˆï¼ HTTPS ãŒå¿…é ˆã«ãªã‚‹ã®ã§ä¸€å·¥å¤«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã ã‘ã©ã€ãã®ã‚ãŸã‚Šã¯é ‘å¼µã£ã¦ã¿ã¦ãã ã•ã„ã€‚\nã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§ã®ãƒãƒ¼ãƒ‰ã®è¿½åŠ ãƒ»å‰Šé™¤ãªã‚“ã¦ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚æ¬¡å›æ™‚é–“ãŒã‚ã£ãŸã‚‰è§£èª¬ã—ã¾ã™ã­ã€‚\nä»Šå›ã¯ swift-ring-builder ã‚³ãƒãƒ³ãƒ‰ã§ãƒ¬ãƒ—ãƒªã‚«æ•° \u0026lsquo;3\u0026rsquo; ã‚’æŒ‡å®šã—ãŸã®ã§ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«(ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨è¨€ã†) ã¯å¿…ãš 3 å€‹é…ç½®ã•ã‚Œã‚‹ã€‚ãªã®ã§ 1 å°ã® swift-storage ãŒæ•…éšœã—ã¦ã‚‚å¤§ä¸ˆå¤«ã€‚ãƒãƒ¼ãƒ‰ã‚’å¢—ã‚„ã›ã°ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å…¨ä½“ã®å®¹é‡ã‚‚å¢—ã‚„ã› ã‚‹ã€‚ã¾ãŸã€swift-proxy ã¯å˜ç´”ãª HTTP ãªã®ã§è² è·åˆ†æ•£æ©Ÿãƒ»ã‚‚ã—ãã¯ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ãƒ­ãƒ¼ ãƒ‰ãƒãƒ©ãƒ³ã‚µã‚’å…¥ã‚Œã‚Œã° swift-proxy è‡ªä½“ã®å†—é•·ã‚‚çµ„ã‚ã‚‹ã»ã‹ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ I/O ã®æ‹¡å¼µ ã«ã‚‚ã¤ãªãŒã‚‹ã€‚pound, nginx ãªã©ã‚’ä½¿ã£ã¦å†—é•·çµ„ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚ãã®æ™‚ã« memcached ã®å†…å®¹ã¯å…±æœ‰ã•ã›ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€ã“ã‚Œã¾ãŸä¸€å·¥å¤«ãŒå¿…è¦ãªã®ã ã‘ ã©ã€‚æ™‚é–“ãŒã‚ã£ãŸã‚‰ä»Šåº¦è§£èª¬ã—ã¾ã™ã€‚\nè‡ªå®…ã§ã‚‚ç°¡å˜ã«åˆ†æ•£ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŒçµ„ã‚ã‚‹ swiftã€‚ä½¿ã‚ãªã„æ‰‹ã¯ç„¡ã„ã§ã™ã‚ˆã‰ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/11/04/swift-tempauth/","summary":"\u003cp\u003eæœ€è¿‘ã€OpenStack ã«ã©ã£ã·ã‚Šæµ¸ã‹ã£ã¦ã‚‹ \u003ca href=\"https://twitter.com/jedipunkz\"\u003e@jedipunkz\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eFolsom ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ Quantum ã‚’ç†è§£ã™ã‚‹ã®ã«ã‚ã¡ã‚ƒè‹¦åŠ´ã—ã¦æ¥½ã—ã„çœŸã£æœ€ä¸­ãªã®ã ã‘ã©ã€\nä»Šæ—¥ã¯ OpenStack ã®ä¸­ã§ã‚‚æœ€ã‚‚æ¯ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ Swift ã‚’ä½¿ã£ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼\nã‚¸æ§‹ç¯‰ã«ã¤ã„ã¦å°‘ã—æ›¸ã“ã†ã‹ãªãã¨æ€ã£ã¦ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€è¿‘ã¯ OpenStack ã‚’æ§‹ç¯‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã«çš†ã€Swift å…¥ã‚Œã¦ãªã„ã®ã­ã€‚ä»²é–“ã¯ãšã‚Œ\næ„ŸãŸã£ã·ã‚Šã ã‘ã©ã€ä¸€ç•ªå®‰å®šã—ã¦å‹•ãã¨æ€ã£ã¦ã‚‹ã€‚\u003c/p\u003e\n\u003cp\u003eã“ã‚Œã‚’èª­ã‚“ã§ã€è‡ªå®…ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ç½®ã„ã¡ã‚ƒãŠã…ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆã¯-\"\u003eæ§‹æˆã¯ ?\u0026hellip;\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003e                        +--------+\n                        | client |\n                        +--------+\n                             |\n                      +-------------+\n                      | swift-proxy |\n                      +-------------+ 172.16.0.10\n                             |\n         +-------------------+-------------------+ 172.16.0.0/24\n         |                   |                   |\n+-----------------+ +-----------------+ +-----------------+\n| swift-storage01 | | swift-storage02 | | swift-storage03 |\n+-----------------+ +-----------------+ +-----------------+\n172.16.0.11         172.16.0.12         172.16.0.13\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã¨ãªã‚‹ã€‚IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯\u0026hellip;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eclient : 172.16.0.0/24 ã®ã©ã“ã‹\u003c/li\u003e\n\u003cli\u003eswift-proxy : 172.16.0.10\u003c/li\u003e\n\u003cli\u003eswift-storage01 : 172.16.0.11\u003c/li\u003e\n\u003cli\u003eswift-storage02 : 172.16.0.12\u003c/li\u003e\n\u003cli\u003eswift-storage03 : 172.16.0.13\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã“ã‚Œã¯ã‚µãƒ³ãƒ—ãƒ«ã€‚è‡ªå®…ã®ç’°å¢ƒã«åˆã‚ã›ã¦èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚\u003c/p\u003e","title":"Swift ã§ç°¡å˜ã«åˆ†æ•£ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸"},{"content":"æ˜¨æ—¥ã€é–‹ã‹ã‚ŒãŸ \u0026ldquo;Opscode Chef ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°\u0026rdquo; ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚\nå ´æ‰€ã¯ã†ã¡ã®ä¼šç¤¾ã§ KDDI ã‚¦ã‚§ãƒ–ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚ºã€‚ä¸»å‚¬ã¯ã‚¯ãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚ªãƒ³ãƒ© ã‚¤ãƒ³ã•ã‚“ã§ã—ãŸã€‚è¬›å¸«ã¯ Sean OMeara (@someara) ã•ã‚“ã€‚ä»Šå¾Œ Chef ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’ æ—¥æœ¬ã§é–‹ããŸã‚ã€äº‹å‰ã«å†…å®¹ã«ã¤ã„ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒæ¬²ã—ã‹ã£ãŸãã†ã§ã€ã‚ªãƒ¼ãƒ—ãƒ³ãª ãƒ¬ãƒƒã‚¹ãƒ³ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€æ¬¡å›ä»¥é™ã€æ—¥æœ¬ã§ã‚‚æœŸå¾…ã§ããã†ã§ã™ã€‚\nå†…å®¹ã¯ chef ã®åŸºæœ¬ãƒ»ãƒ¡ãƒªãƒƒãƒˆãƒ»è€ƒãˆæ–¹ãªã©ã‚’ç¶²ç¾…ã—ãŸè³‡æ–™ã§1æ™‚é–“ç¨‹é€²ã‚ã‚‰ã‚Œã€ãã® å¾Œã¯ãƒãƒ³ã‚ºã‚ªãƒ³ãŒãƒ¡ã‚¤ãƒ³ã§ã—ãŸã€‚ä»Šæ—¥ã¯å®Ÿéš›ã«ãƒãƒ³ã‚ºã‚ªãƒ³ã®å†…å®¹ã‚’æ›¸ã„ã¦ã„ã“ã†ã‹ã¨æ€ ã„ã¾ã™ã€‚\nchef workstation ç’°å¢ƒã¯æƒã£ã¦ã„ã‚‹å‰æã«ã—ã¾ã™ã€‚ã¾ãŸ chef server ã¨ã—ã¦ opscode ã® hosted chef (opscode ãŒæä¾›ã—ã¦ã„ã‚‹ chef ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹, chef-server ã¨ã—ã¦å‹•ä½œã—ã¾ã™) ã‚’ä½¿ã„ã¾ã™ã€‚ã¾ãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ›ã‚¹ãƒˆã¯å½“æ—¥ã¯ ec2 ã‚¤ ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ã„ã¾ã—ãŸãŒã€chef ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰åˆ°é”ã§ãã‚‹ãƒ›ã‚¹ãƒˆã§ã‚ã‚Œã° ä½•ã§ã‚‚è‰¯ã„ã§ã—ã‚‡ã†ã€‚\nã¾ãšã¯ chef-repo ã®ã‚¯ãƒ­ãƒ¼ãƒ³ã€‚è¬›ç¿’ä¼šã§ä½¿ã‚ã‚ŒãŸã‚‚ã®ã§ã™ã€‚\ngit clone https://github.com/opscode/chef-repo-workshop-sysadmin.git chef-repo äºˆã‚ cookbook ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚\næ¬¡ã«ã€manage.opscode.com ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œã‚Šã¾ã™ã€‚Free ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒèª° ã§ã‚‚ä½œã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚\nhttps://manage.opscode.com ã¸ã‚¢ã‚¯ã‚»ã‚¹ -\u0026gt; Sign Up ã‚’ã‚¯ãƒªãƒƒã‚¯ -\u0026gt; ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ± ã‚’å…¥åŠ› -\u0026gt; submit -\u0026gt; ãƒ¡ãƒ¼ãƒ«ã«ã¦ verify -\u0026gt; è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã‚’ã‚¯ãƒªãƒƒã‚¯ -\u0026gt; Get a new key ã‚’ã‚¯ãƒªãƒƒã‚¯ã— \u0026lt;ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå\u0026gt;.pem ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ -\u0026gt; create a organization ã‚’ã‚¯ãƒªãƒƒã‚¯ã— Free ã‚’é¸æŠã—ã€é©å½“ãªåå‰ã§ organization ã‚’ä½œæˆã€‚ validation key ã¨ knife.rb ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\nã“ã‚Œã‚‰ã§å¾—ãŸ3ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ« (2ã¤ã® pem ã¨knife.rb) ã‚’ chef-repo/.chef/ é…ä¸‹ã«ç½® ãã¾ã™ã€‚ã“ã‚Œã§æº–å‚™ OKã€‚knife.rb ã‚’è¦‹ã‚‹ã¨ã€opscode ã® chef ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã«ã‚¢ã‚¯ã‚» ã‚¹ã™ã‚‹ã‚ˆã†è¨˜è¿°ãŒã‚ã‚Šã¾ã™ã€‚\n% cp \u0026lt;somewhere\u0026gt;/knife.rb \u0026lt;somewhere\u0026gt;/\u0026lt;account\u0026gt;.pem \u0026lt;somewhere\u0026gt;/\u0026lt;account\u0026gt;-validation.pem chef-repo/.chef/ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç”¨ chef-repo ã«ã¯äºˆã‚å¹¾ã¤ã‹ã® cookbook ã¨ role, data_bag ãŒå…¥ã£ã¦ ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã‚’ knife ã‚’ä½¿ã£ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\n% cd chef-repo % knife cookbook upload -a % knife role from file role/*.rb % knife data bag create users % knife data bag from file users nagiosadmin.json ãã—ã¦ bootstrap ã‚’å®Ÿè¡Œã€‚.chef/bootstrap ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« chef-full.erb ãƒ•ã‚¡ã‚¤ãƒ« ãŒå…¥ã£ã¦ã„ã¦ bash ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãªã£ã¦ã„ã‚‹ã€‚knife bootstrap ã§ã“ã® bash ã‚¹ã‚¯ãƒªãƒ— ãƒˆã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ›ã‚¹ãƒˆä¸Šã§å®Ÿè¡Œã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚ä¸­èº«ã¯ã¨è¨€ã†ã¨ chef ç’°å¢ƒã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ ãƒ«ã—ã¦ã„ã‚‹ã‚ˆã†ã ã€‚\nchef ç’°å¢ƒã‚’ã©ã†ã‚„ã£ã¦ãƒãƒ¼ãƒ‰ã«å…¥ã‚Œã¦ã„ã‚‹ã‹ãªãã€‚preseed ä½¿ã†ã‹ãªã€‚æ‰‹ä½œæ¥­ã˜ã‚ƒæ„ å‘³ãªã„ã—ãªãã¨è€ƒãˆã¦ã„ãŸã®ã§ã™ãŒã€ã“ã†ã‚„ã‚Œã°ã„ã„ã®ã§ã™ã­ã€‚å‚è€ƒã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œ ã¯ç°¡å˜ã€‚\nã§ã¯ã„ã‚ˆã„ã‚ˆ bootstrap ã‚’å®Ÿè¡Œã€‚\n% knife bootstrap \u0026lt;IPADDRESS\u0026gt; -r 'role[base],role[monitoring]' --sudo -x \u0026lt;USER\u0026gt; -P \u0026lt;PASSWD\u0026gt; IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ssh ãƒ¦ãƒ¼ã‚¶åãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯é©å®œå…¥ã‚Œã¦ãã ã•ã„ã€‚ã“ã‚Œã§ cookbooks ãƒ‡ã‚£ ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã®å„ç¨® cookbook ãŒå®Ÿè¡Œã•ã‚Œã¾ã—ãŸã€‚ä¸­èº«ã¯ nagios ã¨ãã‚Œã«ä¾å­˜ã™ã‚‹ apache2, openssl, mysql, php ç­‰ã€‚\næ¬¡ã« cookbook ã‚’æ–°ãŸã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã— knife upload ã—ã¦ã¿ã¾ã™ã€‚\n% knife cookbook site download chef-client % tar zxvf chef-client-1.2.0.tar.gz -C cookbooks/ % knife cookbook upload chef-client ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆã® pem ãŒãªã„å ´åˆ validation ãŒç”¨ã„ã‚‰ã‚Œã‚‹ãŒã€ä¸€æ—¦ã‚µãƒ¼ãƒã¨é€šä¿¡å‡ºæ¥ãŸ ã‚‰ validation ã¯å¿…è¦ãªããªã‚‹ã€‚ãã‚Œã©ã“ã‚ã‹ wi-fi ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ã‚ˆã†ãªã‚‚ã®ãªã®ã§ validation ã¯å‰Šé™¤ã™ã‚‹ã“ã¨ã‚’å¼·ãã™ã™ã‚ã‚‹ã€ã¨ Sean ãŒè¨€ã£ã¦ã„ã¾ã—ãŸã€‚chef ç’°å¢ƒã¯ ã™ã§ã« bootstrap ã§å…¥ã£ã¦ã„ã‚‹ã‚‚ã®ã®ã€validation ã‚’å‰Šé™¤ã™ã‚‹ãŸã‚ã® recipe ã‚’ base ã¨ã„ã† role ã«è¿½åŠ ã—ã€å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚\nSean ã®è¨€ã£ã¦ã„ãŸã“ã¨ã€é–“é•ã£ã¦ã„ãŸã‚‰æŒ‡æ‘˜ã—ã¦ãã ã•ã„( \u0026gt;\u0026lt; ) è‹±èªã ã£ãŸã®ã§è‡ªä¿¡ ãªã„ã§ã™ã€‚\n% vim role/base.rb name \u0026quot;base\u0026quot; description \u0026quot;Base role applied to all nodes.\u0026quot; run_list( \u0026quot;recipe[apt]\u0026quot;, \u0026quot;recipe[nagios::client]\u0026quot; \u0026quot;recipe[chef-client::delete_validation]\u0026quot; ) default_attributes( \u0026quot;nagios\u0026quot; =\u0026gt; { \u0026quot;server_role\u0026quot; =\u0026gt; \u0026quot;monitoring\u0026quot; } ) role ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€‚\n% knife role from file roles/base.rb ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ›ã‚¹ãƒˆã§ chef-client ã‚’å®Ÿè¡Œã€‚ã“ã“ã§ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 10.14 ã‹ã‚‰ç™»å ´ã—ãŸ why-run ã‚’è©¦ã—ã¦ã‹ã‚‰å®Ÿè¡Œã€‚\ntarget# chef-client -Fdoc -lfatal --color --why-run target# chef-client -Fdoc -lfatal --color ã‚‚ã—ãã¯ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ knife ssh ã‚’ä½¿ã£ã¦ã‚‚è‰¯ã„ã€‚\n% knife search node \u0026quot;role:base\u0026quot; -a cloud.public_ipv4 % knife ssh \u0026quot;role:base\u0026quot; \u0026quot;sudo chef-client -Fmin\u0026quot; -x ubuntu -P opscodechef -a cloud.public_ipv4 -a cloud.public_ipv4 ã¨ã¯ã€AWS EC2 ã‚„ OpenStack, CloudStack ç’°å¢ƒã§ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ ã‚¹ã® eth0 ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ãŒ æ®†ã©ãªãŸã‚ã€ã‚°ãƒ­ãƒ¼ãƒãƒ« IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ¤œç´¢ã—å®Ÿè¡Œã—ã¦ã„ã‚‹ã€‚\nå¤§ããªæµã‚Œã¯ã“ã‚Œã§ãŠã—ã¾ã„ã€‚\nãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã§ã¯ bento, minitest, cucumber-chef ç­‰ã®ç´¹ä»‹ãŒã‚ã£ãŸãŒã€è©³ç´°ãªå†…å®¹ ã«ã¤ã„ã¦ã¯è¦‹é€ã‚‰ã‚ŒãŸã€‚æ˜¼ä¼‘ã¿1æ™‚é–“ã‚’ã¯ã•ã‚“ã§è¨ˆ7æ™‚é–“ã®é•·ä¸å ´ã ã£ãŸãŒã€chef åˆç´š ã‚’è„±ã™ã‚‹ã®ã«ã¯æœ€é©ãªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã ã£ãŸã€‚ã“ã‚Œã‹ã‚‰ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å†…å®¹ã‚„ç¨®åˆ¥ã‚’çµ„ã‚“ã§ ã„ããã†ãªã®ã§ã€å†…å®¹ã¯å¤‰ã‚ã£ã¦ãã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚ã‚ã¨ã§ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ã—ãªã ã¡ã‚ƒã€‚\nå€‹äººçš„ã«ã¯ OpenStack ã«èˆˆå‘³ã‚’æŒã£ã¦ã„ã‚‹ã®ã§ chef ã‚’ä½¿ã£ã¦ OpenStack ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ ã—ãŸã„ã€‚ä»Šå¹´6æœˆã«ã¯ \u0026lsquo;Chef for OpenStack\u0026rsquo; ã¨ã„ã†ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ãŒã‚ã‚Šã€DELL, RackSpace, HP ç­‰ã®å¤§ä¼æ¥­ãŒãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨ã—ã¦å‚åŠ ã™ã‚‹ã“ã¨ã«ãªã£ãŸã¨ç™ºè¡¨ãŒã‚ã£ãŸã€‚ ä»Šã¾ã§ openstack cookbook ã¯é•·ããƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã•ã‚Œã¦ã“ãªã‹ã£ãŸã®ã§ã€ã“ã‚Œã«ã¯æœŸå¾… ã—ã¦ã„ã‚‹ã€‚\næœ€å¾Œã«ã“ã®æ©Ÿä¼šã‚’ä½œã£ã¦ä¸‹ã•ã£ãŸ ã‚¯ãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã•ã‚“ã€opscode ã® Sean ã•ã‚“ã€mr.devops ã•ã‚“ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸãƒ¼ã€‚è²´é‡ãªä½“é¨“ã§ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/10/06/secret-training-of-opscode-chef/","summary":"\u003cp\u003eæ˜¨æ—¥ã€é–‹ã‹ã‚ŒãŸ \u0026ldquo;Opscode Chef ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°\u0026rdquo; ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eå ´æ‰€ã¯ã†ã¡ã®ä¼šç¤¾ã§ KDDI ã‚¦ã‚§ãƒ–ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚ºã€‚ä¸»å‚¬ã¯ã‚¯ãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚ªãƒ³ãƒ©\nã‚¤ãƒ³ã•ã‚“ã§ã—ãŸã€‚è¬›å¸«ã¯ Sean OMeara (@someara) ã•ã‚“ã€‚ä»Šå¾Œ Chef ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’\næ—¥æœ¬ã§é–‹ããŸã‚ã€äº‹å‰ã«å†…å®¹ã«ã¤ã„ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒæ¬²ã—ã‹ã£ãŸãã†ã§ã€ã‚ªãƒ¼ãƒ—ãƒ³ãª\nãƒ¬ãƒƒã‚¹ãƒ³ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€æ¬¡å›ä»¥é™ã€æ—¥æœ¬ã§ã‚‚æœŸå¾…ã§ããã†ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå†…å®¹ã¯ chef ã®åŸºæœ¬ãƒ»ãƒ¡ãƒªãƒƒãƒˆãƒ»è€ƒãˆæ–¹ãªã©ã‚’ç¶²ç¾…ã—ãŸè³‡æ–™ã§1æ™‚é–“ç¨‹é€²ã‚ã‚‰ã‚Œã€ãã®\nå¾Œã¯ãƒãƒ³ã‚ºã‚ªãƒ³ãŒãƒ¡ã‚¤ãƒ³ã§ã—ãŸã€‚ä»Šæ—¥ã¯å®Ÿéš›ã«ãƒãƒ³ã‚ºã‚ªãƒ³ã®å†…å®¹ã‚’æ›¸ã„ã¦ã„ã“ã†ã‹ã¨æ€\nã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003echef workstation ç’°å¢ƒã¯æƒã£ã¦ã„ã‚‹å‰æã«ã—ã¾ã™ã€‚ã¾ãŸ chef server ã¨ã—ã¦ opscode\nã® hosted chef (opscode ãŒæä¾›ã—ã¦ã„ã‚‹ chef ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹,\nchef-server ã¨ã—ã¦å‹•ä½œã—ã¾ã™) ã‚’ä½¿ã„ã¾ã™ã€‚ã¾ãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ›ã‚¹ãƒˆã¯å½“æ—¥ã¯ ec2 ã‚¤\nãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ã„ã¾ã—ãŸãŒã€chef ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰åˆ°é”ã§ãã‚‹ãƒ›ã‚¹ãƒˆã§ã‚ã‚Œã°\nä½•ã§ã‚‚è‰¯ã„ã§ã—ã‚‡ã†ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãšã¯ chef-repo ã®ã‚¯ãƒ­ãƒ¼ãƒ³ã€‚è¬›ç¿’ä¼šã§ä½¿ã‚ã‚ŒãŸã‚‚ã®ã§ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egit clone https://github.com/opscode/chef-repo-workshop-sysadmin.git chef-repo\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eäºˆã‚ cookbook ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæ¬¡ã«ã€manage.opscode.com ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œã‚Šã¾ã™ã€‚Free ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒèª°\nã§ã‚‚ä½œã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://manage.opscode.com\"\u003ehttps://manage.opscode.com\u003c/a\u003e ã¸ã‚¢ã‚¯ã‚»ã‚¹ -\u0026gt; Sign Up ã‚’ã‚¯ãƒªãƒƒã‚¯ -\u0026gt; ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±\nã‚’å…¥åŠ› -\u0026gt; submit -\u0026gt; ãƒ¡ãƒ¼ãƒ«ã«ã¦ verify -\u0026gt; è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã‚’ã‚¯ãƒªãƒƒã‚¯ -\u0026gt; Get a\nnew key ã‚’ã‚¯ãƒªãƒƒã‚¯ã— \u0026lt;ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå\u0026gt;.pem ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ -\u0026gt; create a\norganization ã‚’ã‚¯ãƒªãƒƒã‚¯ã— Free ã‚’é¸æŠã—ã€é©å½“ãªåå‰ã§ organization ã‚’ä½œæˆã€‚\nvalidation key ã¨ knife.rb ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\u003c/p\u003e","title":"Secret Training of Opscode Chef"},{"content":"ç¬¬7å› OpenStack å‹‰å¼·ä¼šã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚\né–‹å‚¬æ—¥ : 2012å¹´08æœˆ28æ—¥ é–‹å‚¬å ´æ‰€ : å¤©ç‹æ´²ã‚¢ã‚¤ãƒ« ãƒ“ãƒƒãƒˆã‚¢ã‚¤ãƒ« 1å¹´ä»¥ä¸Šå‰ã‹ã‚‰ OpenStack, CloudStack ç•Œéšˆã¯ã‚¦ã‚©ãƒƒãƒã—ã¦ã„ãŸã®ã ã‘ã©ã€å®Ÿéš›ã«æ§‹ç¯‰ ã—ã¦ã£ã¦ãªã‚‹ã¨ã€ä»Šæœˆå§‹ã‚ã°ã‹ã‚Šã§ã€OpenStack ã‚‚å…ˆé€±4æ—¥é–“æ›ã‘ã¦ã‚„ã£ã¨ã“ã•æ§‹ç¯‰å‡ºæ¥ãŸã£ ã¦ã¨ã“ã‚\u0026hellip;orzã€‚å‰å›ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã§ã¸ãªã¡ã‚‡ã“ã‚¹ã‚¯ãƒªãƒ—ãƒˆå…¬é–‹ã—ã¡ã‚ƒã£ãŸã®ã‚’å¾Œæ‚”ã—ã¤ ã¤ç¾åœ°ã«å‘ã‹ã„ã¾ã—ãŸw ã‚ã¨ã€ãã®ä»–ã« Opscode Chef ç­‰ã®æŠ€è¡“ã«ã‚‚èˆˆå‘³æŒã£ã¦èª¿æŸ»ã— ã¦ã„ãŸã®ã§ã€ä»Šå›ã®å‹‰å¼·ä¼šã¯ã¾ã•ã«ç›´ãã«æ´»ã‹ã›ã‚‹å†…å®¹ã ã£ãŸã€‚\nã§ã¯æ—©é€Ÿã€å ±å‘ŠãŒã‚ã£ãŸå†…å®¹ã¨è‡ªåˆ†ã®æ„Ÿæƒ³ã‚’äº¤ãˆã¤ã¤æ›¸ã„ã¦ã„ãã¾ã™ã€‚\nHP ã•ã‚“ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ HP Cloud Services æ—¥æœ¬ HP çœŸå£ã•ã¾ HP ã•ã‚“ã¯æ—¢ã« Public ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—å§‹ã‚ã¦ã„ã¦ Ojbect Storage, CDN éƒ¨ åˆ†ã¯æ—¢ã«ãƒªãƒªãƒ¼ã‚¹æ¸ˆã¿ã ãã†ã ã€‚compute, block storage ç­‰ã¯ãƒ™ãƒ¼ã‚¿ç‰ˆçŠ¶æ…‹ã§ã“ã‚Œã‹ ã‚‰ãƒªãƒªãƒ¼ã‚¹ã€‚OpenStack ãƒ™ãƒ¼ã‚¹ãªæ§‹æˆã§ Horizon éƒ¨åˆ†ã¯è‡ªå‰ã§é–‹ç™ºã—ãŸã‚‚ã®ã€‚æ—¢ ã«ã‚µãƒ¼ãƒæ•°ã¯ä¸‡ã®æ¡ã¾ã§åˆ°é”ï¼ MySQL ãª DaaS ã‚‚ç™»å ´äºˆå®šã ã¨ã‹ã€‚\nã‚ã¨ HP ã ã‘ã«ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã«ç‰¹åŒ–ã—ãŸã‚µãƒ¼ãƒæ©Ÿå™¨ã‚‚å‡ºã—ã¦ã„ã¦ã€ãã‚ŒãŒ HP Project Moonshot ã€‚ARM/Atom æ­è¼‰ã®ã‚µãƒ¼ãƒã§ 2,880 nodes/rack ãŒå¯èƒ½ã ã¨ã‹ï¼ã™ ã’ã‡ã€‚ã‚‚ã¡ã‚ã‚“é›»æºç­‰ã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã¨ãªã‚‹ãƒªã‚½ãƒ¼ã‚¹ã¯ä»–ã«ã‚‚å‡ºã¦ããã†ã ã‘ã©ã€‚\nãƒãƒ¼ãƒ‰æ•°ã£ã¦å¢—ãˆã‚‹ã¨å¬‰ã—ã„ã®ã‹ãªï¼Ÿã‚³ã‚¢æ•°ãŒå¢—ãˆã‚‹ã®ã¯å¬‰ã—ã„ã‘ã©ã€‚\nCanonical JuJu Canonical æ¾æœ¬ã•ã¾ JuJu ã¯ Canonical ãŒæä¾›ã—ã¦ã„ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«ã§ charms ã¨å‘¼ã°ã‚Œã‚‹ãƒ¬ã‚·ãƒ”é›† (ã£ ã¦è¨€ã†ã¨èªå¼ŠãŒã‚ã‚‹ã®ã‹) ã«å¾“ã£ã¦ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®é…å¸ƒã‚’è¡Œã†ãƒ„ãƒ¼ãƒ«ã€‚MAAS ã¨ã„ã†ç‰© ç†ã‚µãƒ¼ãƒã®ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã¨çµ„ã¿åˆã‚ã›ã‚Œã°ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’è¨­ç½®ã—ãŸå¾Œã®ãƒ—ãƒ­ ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æ“ä½œã¯ä¸€æ°—é€šè²«å‡ºæ¥ã‚‹ã€ã¨ã„ã£ãŸã‚‚ã®ã€‚å…·ä½“çš„ãªæ“ä½œä¾‹ã‚’æŒ™ã’ã¦ãã‚ŒãŸã® ã§æ·»ä»˜ã—ã¦ãã¾ã™ã€‚\n% juju deploy --repository=/tmp swift-proxy % juju deploy --repository=/tmp swift-storage % juju add-relation swift-storage:swift-proxy % swift-proxy:swift-proxy % juju add-unit swift-storage # node è¿½åŠ  swift-proxy, swift-storage ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€ãã®å¾Œãã‚Œãã‚Œã‚’é–¢ä¿‚ä»˜ã‘ã¦ã„ã‚‹ã®ãŒ add-relationã€‚ã¾ãŸ swift-proxy ã«å¯¾ã—ã¦ swift-storage node ã‚’è¿½åŠ ã—ã¦ãã¨ã„ã£ ãŸæ“ä½œãŒ add-unit ã‚‰ã—ã„ã€‚\nCharms ã¨å‘¼ã°ã‚Œã‚‹ãƒ¢ãƒã®ä¸­ã‚’ã®ãã‹ã›ã¦ã‚‚ã‚‰ã£ãŸãŒ Shell Script ã¨ json ãƒ•ã‚¡ã‚¤ãƒ« é›†ã«ãªã£ã¦ã„ãŸã€‚ã‚¤ãƒ³ãƒ•ãƒ©ç³»ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«æ“ä½œã—ã¦ã‚‚ã‚‰ã†ã«ã¯ã“ã‚ŒãŒãƒ™ã‚¹ãƒˆã€ã¨ã„ã£ ãŸã¨ã“ã‚ãªã®ã ã‚ã†ã€‚Opscode Chef ã®æ§˜ãªè‡ªç”±åº¦ãŒã‚ã‚‹ã‹ã©ã†ã‹ã¯ã€è§¦ã£ã¦ã¿ãªã„ã¨ åˆ†ã‹ã‚‰ãªã„ã€‚æ™‚é–“ã‚’è¦‹ã¤ã‘ã¦èª¿ã¹ã¦ã¿ã‚‹ã‹ãã€‚\nã¡ãªã«ã¿ä»Šæ—¥ MAAS ã«ã¤ã„ã¦èª¿ã¹ãŸã®ã§ã™ãŒã€ã“ã‚Œã¯ PXE Boot ã¨ DHCP ã®ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ GUI ã§ã™ã‚‹ã£ã¦ã‚‚ã®ãªã®ã§ã™ã­ã€‚å¾Œã«å‡ºã¦ãã‚‹ Crowbar ã¨ã¯ã ã„ã¶é•ã†ã€‚ é–“é•ã£ã¦ã„ãŸã‚‰æŒ‡æ‘˜ã—ã¦ãã ã•ã„..ã€‚\nå‚è€ƒ URL : https://wiki.ubuntu.com/ServerTeam/MAAS\nRedHat ã® OpenStack ã¸ã®å–ã‚Šçµ„ã¿ RedHat ä¸­äº•ã•ã¾ OpenStack ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—å§‹ã‚ãŸã“ã¨ã§æœ€è¿‘è©±é¡Œã«ãªã£ã¦ã„ãŸãŒã€ã„ ã‚ˆã„ã‚ˆä»Šå¹´2012å¹´10æœˆãƒªãƒªãƒ¼ã‚¹äºˆå®šã® folsom ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸãƒªãƒªãƒ¼ã‚¹ã‚’2013å¹´ã«æ§ãˆ ã¦ã„ã‚‹ãã†ã ã€‚ã“ã“ã§åˆã‚ã¦æœ‰å„Ÿã‚µãƒãƒ¼ãƒˆãŒé–‹å§‹ã•ã‚Œã‚‹ãã†ã€‚ã‚ˆã‚Šç°¡å˜ã«æ§‹ç¯‰ãŒå‡ºæ¥ã¦ã€ æŠ€è¡“çš„ãªä¸å®‰å®šã‚’æŒã£ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ã‚’å–ã‚Šè¾¼ã‚“ã§ã„ãã®ã ã‚ã†ã€‚é¢ç™½ã„ãƒã‚¿ã‚‚è²°ãˆãŸã€‚ å°†æ¥ã€Swift ä»£æ›¿ã§ Gluster-FS ãŒæ‰±ãˆã‚‹ã‚ˆã†ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãã†ã ã€‚ã¾ãŸ KVM ã«ã‚³ãƒŸãƒƒãƒˆã—ã¦ã„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’æŠ±ãˆã¦ã„ã‚‹å½¼ã‚‰ã ãŒã€KVM ã‹ã‚‰ç›´æ¥ Gluster-FS ä¸Šã® VM ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ“ä½œå‡ºæ¥ã‚‹ã‚ˆã†ã«ä¿®æ­£åŠ ãˆã‚‹æ¡ˆã‚‚å‡ºã¦ã„ã‚‹ãã†ã ã€‚ã“ã‚ŒãŒå®Ÿç¾ã™ã‚Œã°ã€ nova ãƒãƒ¼ãƒ‰ã®ã‚µãƒ¼ãƒãƒªã‚½ãƒ¼ã‚¹ã«ä¾å­˜ã—ãªã„å¤§ããª Disk ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ‰±ã†ã“ã¨ã‚‚å¯èƒ½ã« ãªã‚‹ã ã‚ã†ã€‚\nã¾ãŸã€Canonical JuJu, Opscode Chef ã«ä¸¦ã¶ãƒ„ãƒ¼ãƒ«ã®ç´¹ä»‹ã‚‚ã‚ã£ãŸã€‚CloudForms ãŒã ã‚Œãªã®ã ãŒã€å„ç¤¾ã¨å…±é€šã™ã‚‹ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’æŒã£ã¦ã„ã‚‹ã‚ˆã†ã ã€‚é–‹ç™ºç’°å¢ƒãƒ»æœ¬ç•ªç’°å¢ƒã¸ã® ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªãƒ‡ãƒ—ãƒ­ã‚¤ã€ã¨ã€‚\nDELL Crowbar DELL å¢—æœˆã•ã¾ ã‚ã‚‹æ„å‘³ã€åƒ•ã«ã¨ã£ã¦ä¸€ç•ªã®åç©«ã ã£ãŸã®ãŒ DELL ã® Crowbarã€‚DELL ã‚µãƒ¼ãƒã«ä¾å­˜ã› ãšä½¿ãˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«ã§ã€IPMI, RAID, BIOS ç­‰ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æ§‹æˆã‚‚è‡ªå‹•æ§‹ç¯‰ãŒå‡º æ¥ã‚‹ãã†ï¼ã¾ãŸ Opscode Chef ãŒãƒ™ãƒ¼ã‚¹ã«ãªã£ã¦ã„ã¦ barclamp ã¨å‘¼ã°ã‚Œã‚‹ Chef ã§ è¨€ã† Cookbooks ã‚’å…ƒã«ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ããã†ã ã€‚Chef Server ç’°å¢ƒãŒ å¿…é ˆã§ chef-solo ã®ã‚ˆã†ãªæ“ä½œã«ã¯å¯¾å¿œã—ã¦ã„ãªãã†ãªã®ãŒæ®‹å¿µã ã£ãŸã€‚Web ãƒ™ãƒ¼ã‚¹ ã® GUI ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§æ“ä½œã™ã‚‹ã‚‰ã—ã„ã€‚ãƒ‡ãƒ¢ã‚‚å½“æ—¥è¦‹ã‚Œã¾ã—ãŸã€‚\nãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æ§‹æˆã‚‚è‡ªå‹•æ§‹ç¯‰å‡ºæ¥ã‚‹ãƒ„ãƒ¼ãƒ«ã¯ Canonical ã® MAAS ãŒã‚ã‚‹ãŒã€ä¸€æ­©è¸ã¿ è¾¼ã‚“ã æ§‹æˆãŒçµ„ã‚ãã†ã€‚å°šã€Opscode ã® Cookbooks ã‚’å†åˆ©ç”¨ã™ã‚‹ã®ã¯å°‘ã—é›£ã—ã„çŠ¶æ³ ã®ã‚ˆã†ã ã€‚ã“ã®è¾ºã‚Šã¯ 2.0 ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§æ”¹å–„ã•ã‚Œã‚‹ãã†ã ã€‚Chef ã¨ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚ˆã‚Š ã‚·ãƒ³ãƒ—ãƒ«ãªã‚‚ã®ã«ã™ã‚‹ãã†ã€‚\nä»–ãƒ™ãƒ³ãƒ€ã®ã¨å·®åˆ¥åŒ–ã‚’å›³ã‚‹ã®ã‹ã¨æ€ã„ãã‚„ã€ã‚µãƒ¼ãƒæ©Ÿå™¨ã«ä¾å­˜ã—ãªã„ãƒ„ãƒ¼ãƒ«ã‚’å‡ºã—ã¦ã ã‚‹ DELL ã•ã‚“ã®æ€ã„ã¯ã€ã©ã“ã«ã‚ã‚‹ã®ã ã‚ã†ã€‚ã‚ã¨ BIOS, RAID å‘¨ã‚Šã‚’ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã—ã¦ã„ãå—ã‘å£ã® I/F ã¯ IPMI ãªã®ã‹ãªï¼Ÿè³ªå•ã™ã‚Œã°ã‚ˆã‹ã£ãŸã€‚\nGMO ãŠåå‰ KVM å…ˆæœˆã® OSC ã§ç™ºè¡¨ã«ãªã£ãŸè³‡æ–™ã‚’ãƒ™ãƒ¼ã‚¹ã«èª¬æ˜ã—ã¦é ‚ã„ãŸã€‚diablo ãƒ™ãƒ¼ã‚¹ã§ CentOS ä¸Šã«æ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹ã‚‰ã—ã„ã€‚ã¾ãŸ griddynamic.net ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ (çŸ¥ã‚‰ãªã‹ã£ãŸ) ã‚’ åˆ©ç”¨ã—ã¦ (ãªãœç´ ç›´ã« Ubuntu ä½¿ã‚ãªã„ã®ã‹ãªï¼Ÿ) æ§‹ç¯‰ã—ãŸãã†ã ã€‚griddynamic.net ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯æ—¢ã«ã‚¨ã‚­ã‚¹ãƒ‘ã‚¤ã‚¢ã—ã¦ã„ã‚‹ã‚‰ã—ã„\u0026hellip;ã€‚nova ãƒãƒ¼ãƒ‰ã¯æ—¢ã«200å°è¦æ¨¡ã€‚ libvirt, kvm å‘¨ã‚Šã«ãƒ‘ãƒƒãƒã‚’ç‹¬è‡ªã§å½“ã¦ã¦ã„ã‚‹ãã†ã§ã€ãã®å…·ä½“çš„å†…å®¹ãŒèã‘ãŸã€‚ãŸ ã ã“ã®è¾ºã¯ OpenStack ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«è¿½ã„ã¤ãä½œæ¥­ãŒã‚ã¡ã‚ƒå¤§å¤‰ã«ãªã‚‹ã ã‚ã†ãªã ã¨æƒ³åƒã™ã‚‹ã€‚..\nå…¨ä½“ã‚’é€šã—ã¦ Opscode Chef ã«ä¸¦ã¶æŠ€è¡“ãŒå‡ºå§‹ã‚ã¦ããŸã€‚OpenStack ã§ nodes ã‚’è¿½åŠ ã™ã‚‹ã¨ã“ã‚ã¾ã§ è‡ªå‹•åŒ–ã—ãŸã¨ã—ã¦ã‚‚ vm ä¸Šã®æ“ä½œã‚’æ‰‹ä½œæ¥­ã™ã‚‹ã‚ã‘ã«ã¯ã„ã‹ãªã„ã—ã€å¿…ç„¶ãªã®ã ã‚ã†ã€‚ ã‚ˆã‚Šãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«ä¾å­˜ã—ãªã„ã€ã‚¤ãƒ³ãƒ•ãƒ©ç³»ãƒ»ã‚¢ãƒ—ãƒªç³»å…±ã«ç†è§£å‡ºæ¥ã‚‹ã€è‡ª ç”±åº¦ã®ã‚ã‚‹ã€æ±ç”¨æ€§ã®ã‚ã‚‹æŠ€è¡“ã‚’æˆ‘ã€…ãŒé¸ã³ãªãŒã‚‰ä½¿ã£ã¦ã„ãå¿…è¦ãŒã‚ã‚Šãã†ã€‚åƒ•ã‚‰ã‚¤ ãƒ³ãƒ•ãƒ©ç³»ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ä»•äº‹å†…å®¹ã‚‚ã€ã“ã®è¾ºã‚Šã«ã‚·ãƒ•ãƒˆã—ã¦ã„ãæ™‚ä»£ã¯ã‚‚ã†ç›®ã®å‰ã¾ã§æ¥ ã¦ã„ã‚‹ã ã‚ã†ã€‚OpenStack ã‚’æ§‹ç¯‰ã™ã‚‹æ‰‹é †ãŒ JuJu ç­‰ã§ã‚³ãƒãƒ³ãƒ‰ä¸€ç™ºãªã®ã‚’è¦‹ã¦å”–ç„¶ã¨ ã—ãŸã®ã‚‚ç¢ºã‹ã€‚èª°ã§ã‚‚ã§ãã‚‹æ“ä½œã«ãªã‚‹ã®ã‚‚å¿…ç„¶ã§ã€ãŸã ã©ã†ã„ã†æ“ä½œãŒã•ã‚Œã¦ã„ã‚‹ã‹ ã‚’ç†è§£ã—ã€å¿…è¦ã«å¿œã˜ã¦æ”¹å¤‰ã—ã¦é–‹ç™ºã—ã¦ã„ãåŠ›ã¯èº«ã«ç€ã‘ã¦ãŠã‹ãªã„ã¨ã€ã‚¤ãƒ³ãƒ•ãƒ©ç³» ã¯ç‰¹ã«ã€ä»•äº‹å†…å®¹ãŒå˜ç´”åŒ–ã—ã¦ã„ãä¸€æ–¹ã«ãªã‚‹æ°—ãŒã™ã‚‹ã€‚å±æ©Ÿã‚’æ„Ÿã˜ã¤ã¤ãƒãƒ£ãƒ³ã‚¹ã«çµ ã³ã¤ã‘ã‚‹ã„ã„æ©Ÿä¼šãªã®ã‹ãªãã€‚ã‚ã¨ã¯ç›£è¦–å‘¨ã‚Šã‚‚è‡ªå‹•ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œãªã„ ã¨ã€çœŸã®è‡ªå‹•åŒ–ã«ã¯è‡³ã‚‰ãªã„ãªãã€‚\nå½“æ—¥ã¯ BitIsle ã‚¹ã‚¿ãƒƒãƒ•ã®ã¿ãªã•ã‚“ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ã¿ãªã•ã‚“ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ ã—ãŸããƒ¼ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/08/29/7th-openstack-meetup/","summary":"\u003cp\u003eç¬¬7å› OpenStack å‹‰å¼·ä¼šã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eé–‹å‚¬æ—¥   : 2012å¹´08æœˆ28æ—¥\né–‹å‚¬å ´æ‰€ : å¤©ç‹æ´²ã‚¢ã‚¤ãƒ« ãƒ“ãƒƒãƒˆã‚¢ã‚¤ãƒ«\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e1å¹´ä»¥ä¸Šå‰ã‹ã‚‰ OpenStack, CloudStack ç•Œéšˆã¯ã‚¦ã‚©ãƒƒãƒã—ã¦ã„ãŸã®ã ã‘ã©ã€å®Ÿéš›ã«æ§‹ç¯‰\nã—ã¦ã£ã¦ãªã‚‹ã¨ã€ä»Šæœˆå§‹ã‚ã°ã‹ã‚Šã§ã€OpenStack ã‚‚å…ˆé€±4æ—¥é–“æ›ã‘ã¦ã‚„ã£ã¨ã“ã•æ§‹ç¯‰å‡ºæ¥ãŸã£\nã¦ã¨ã“ã‚\u0026hellip;orzã€‚å‰å›ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã§ã¸ãªã¡ã‚‡ã“ã‚¹ã‚¯ãƒªãƒ—ãƒˆå…¬é–‹ã—ã¡ã‚ƒã£ãŸã®ã‚’å¾Œæ‚”ã—ã¤\nã¤ç¾åœ°ã«å‘ã‹ã„ã¾ã—ãŸw ã‚ã¨ã€ãã®ä»–ã« Opscode Chef ç­‰ã®æŠ€è¡“ã«ã‚‚èˆˆå‘³æŒã£ã¦èª¿æŸ»ã—\nã¦ã„ãŸã®ã§ã€ä»Šå›ã®å‹‰å¼·ä¼šã¯ã¾ã•ã«ç›´ãã«æ´»ã‹ã›ã‚‹å†…å®¹ã ã£ãŸã€‚\u003c/p\u003e\n\u003cp\u003eã§ã¯æ—©é€Ÿã€å ±å‘ŠãŒã‚ã£ãŸå†…å®¹ã¨è‡ªåˆ†ã®æ„Ÿæƒ³ã‚’äº¤ãˆã¤ã¤æ›¸ã„ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"hp-ã•ã‚“ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹-hp-cloud-services\"\u003eHP ã•ã‚“ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ HP Cloud Services\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003eæ—¥æœ¬ HP çœŸå£ã•ã¾\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHP ã•ã‚“ã¯æ—¢ã« Public ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—å§‹ã‚ã¦ã„ã¦ Ojbect Storage, CDN éƒ¨\nåˆ†ã¯æ—¢ã«ãƒªãƒªãƒ¼ã‚¹æ¸ˆã¿ã ãã†ã ã€‚compute, block storage ç­‰ã¯ãƒ™ãƒ¼ã‚¿ç‰ˆçŠ¶æ…‹ã§ã“ã‚Œã‹\nã‚‰ãƒªãƒªãƒ¼ã‚¹ã€‚OpenStack ãƒ™ãƒ¼ã‚¹ãªæ§‹æˆã§ Horizon éƒ¨åˆ†ã¯è‡ªå‰ã§é–‹ç™ºã—ãŸã‚‚ã®ã€‚æ—¢\nã«ã‚µãƒ¼ãƒæ•°ã¯ä¸‡ã®æ¡ã¾ã§åˆ°é”ï¼ MySQL ãª DaaS ã‚‚ç™»å ´äºˆå®šã ã¨ã‹ã€‚\u003c/p\u003e\n\u003cp\u003eã‚ã¨ HP ã ã‘ã«ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã«ç‰¹åŒ–ã—ãŸã‚µãƒ¼ãƒæ©Ÿå™¨ã‚‚å‡ºã—ã¦ã„ã¦ã€ãã‚ŒãŒ HP\nProject Moonshot ã€‚ARM/Atom æ­è¼‰ã®ã‚µãƒ¼ãƒã§ 2,880 nodes/rack ãŒå¯èƒ½ã ã¨ã‹ï¼ã™\nã’ã‡ã€‚ã‚‚ã¡ã‚ã‚“é›»æºç­‰ã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã¨ãªã‚‹ãƒªã‚½ãƒ¼ã‚¹ã¯ä»–ã«ã‚‚å‡ºã¦ããã†ã ã‘ã©ã€‚\u003c/p\u003e\n\u003cp\u003eãƒãƒ¼ãƒ‰æ•°ã£ã¦å¢—ãˆã‚‹ã¨å¬‰ã—ã„ã®ã‹ãªï¼Ÿã‚³ã‚¢æ•°ãŒå¢—ãˆã‚‹ã®ã¯å¬‰ã—ã„ã‘ã©ã€‚\u003c/p\u003e\n\u003ch2 id=\"canonical-juju\"\u003eCanonical JuJu\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003eCanonical æ¾æœ¬ã•ã¾\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eJuJu ã¯ Canonical ãŒæä¾›ã—ã¦ã„ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«ã§ charms ã¨å‘¼ã°ã‚Œã‚‹ãƒ¬ã‚·ãƒ”é›† (ã£\nã¦è¨€ã†ã¨èªå¼ŠãŒã‚ã‚‹ã®ã‹) ã«å¾“ã£ã¦ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®é…å¸ƒã‚’è¡Œã†ãƒ„ãƒ¼ãƒ«ã€‚MAAS ã¨ã„ã†ç‰©\nç†ã‚µãƒ¼ãƒã®ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã¨çµ„ã¿åˆã‚ã›ã‚Œã°ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’è¨­ç½®ã—ãŸå¾Œã®ãƒ—ãƒ­\nãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æ“ä½œã¯ä¸€æ°—é€šè²«å‡ºæ¥ã‚‹ã€ã¨ã„ã£ãŸã‚‚ã®ã€‚å…·ä½“çš„ãªæ“ä½œä¾‹ã‚’æŒ™ã’ã¦ãã‚ŒãŸã®\nã§æ·»ä»˜ã—ã¦ãã¾ã™ã€‚\u003c/p\u003e","title":"ç¬¬7å› OpenStack å‹‰å¼·ä¼šå‚åŠ ãƒ¬ãƒãƒ¼ãƒˆ"},{"content":"OpenStack ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã£ã¦ã—ã‚“ã©ã„ãªãã€ã£ã¦æ„Ÿã˜ã¦ devstack http://devstack.org/ ã¨ã‹ã§æ§‹ç¯‰ã—ã¦ä¸­ã‚’è¦—ã„ã¦ã„ãŸã®ã§ã™ãŒã€ãã‚‚ãã‚‚ devstack ã£ã¦å†èµ·å‹•ã—ã¦ã—ã¾ãˆã°ä½•ã‚‚èµ·å‹•ã—ã¦ã“ãªã„ã—ã€swift ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œãªã„ã—ã§ã€‚ ã‚„ã£ã±ã‚Šå…¬å¼ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«è¦‹ãªãŒã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã—ã‹ãªã„ã‹ãã£ã¦\u0026hellip;ã€‚æ„Ÿã˜ã¦ã„ ãŸã®ã§ã™ãŒ\u0026hellip;ã€‚\nhttp://docs.openstack.org/essex/openstack-compute/starter/os-compute-starterguide-trunk.pdf\nã“ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®å‰æã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯2ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ»server1, server2 ã®è¨ˆ2å°ãŒå‰ æãªã®ã§ã™ãŒã€ç’°å¢ƒä½œã‚‹ã®ãŒã—ã‚“ã©ã„ã®ã§ã€ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ãªæ§‹ç¯‰ãŒã—ãŸã„ï¼ã‚µãƒ¼ãƒ1å°ã§ OpenStack ESSEX ã‚’ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„ï¼ã§ã€ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã£ãŸã®ã§ãã‚Œã‚’ä½¿ã£ãŸã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚\nã¼ãã® Thinkpad ã« OpenStack ESSEX ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§ localhost ã«æ¥ç¶šã—ã¦ ã„ã‚‹ç”»é¢ã§ã™ã€‚ã¡ã‚ƒã‚“ã¨ KVM VM ãŒèµ·å‹•ã—ã¦ noVNC ã§æ¥ç¶šã§ãã¦ã„ã¾ã™ã€‚è‡ªå·±æº€è¶³ã‚„ãã€‚\nå‰ææ¡ä»¶ Ubuntu Server 12.04 LTS amd64 ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ Intel-VT ã‚‚ã—ãã¯ AMDâˆ’Vãªãƒã‚·ãƒ³ NIC ãŒä¸€ã¤ä»¥ä¸Šã¤ã„ã¦ã„ã‚‹ãƒã‚·ãƒ³ /dev/sda6, /dev/sda7 (ãƒ‡ãƒã‚¤ã‚¹åã¯ä½•ã§ã‚‚ã„ã„) ã®2ã¤ãŒæœªä½¿ç”¨ã§ç©ºã„ã¦ã„ã‚‹ã“ã¨ ã§ã™ã€‚\næ§‹æˆ 1 NIC ã‚’å‰æã« eth0 ã¨ eth0:0 ã®2ã¤ã‚’æƒ³å®šã™ã‚‹ã¨ã€ã“ã‚“ãªæ§‹æˆã«ãªã‚Šã¾ã™ã€‚eth0:0 ã¯å®Œå…¨ã«ãƒ€ãƒŸãƒ¼ã§ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä½•ã§ã‚‚ã„ã„ã§ã™ã€‚br100 ãƒ–ãƒªãƒƒã‚¸ãƒ‡ãƒã‚¤ã‚¹ä¸Šã§ VM ãŒ NW I/F ã‚’æŒã¡ã¾ã™ã€‚floating range ã£ã¦ã®ã¯ OpenStack ã§è¨€ã†ã‚°ãƒ­ãƒ¼ãƒãƒ« IP ãƒ¬ãƒ³ ã‚¸ã€‚ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ã‚ã‚‹å¿…è¦ã¯ç„¡ã„ã§ã™ãŒ eth0 ã¨åŒã˜ãƒ¬ãƒ³ã‚¸ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ VM ã«ä»˜ ä¸å‡ºæ¥ã¾ã™ã€‚/dev/sda6 ãŒ nova-volumes ã§ /dev/sda7 ãŒ swift ã€‚ãªã®ã§ OS ã‚¤ãƒ³ã‚¹ ãƒˆãƒ¼ãƒ«æ™‚ã«2ã¤ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’æœªä½¿ç”¨ã§ç©ºã‘ã¦ãŠã„ã¦ãã ã•ã„ã€‚\n+--+--+--+ |VM|VM|VM| 192.168.4.32/27 +--+--+--+.. +----------+ +--------+ | | | br100 | 192.168.4.33/27 -\u0026gt; floating range : 10.200.8.32/27 | | +--------+ | | | eth0:0 | 192.168.3.1 disk devices | Host | +--------+ (dummy) +------------------------+ | | | /dev/sda6 nova-volumes | | | +--------+ +------------------------+ | | | eth0 | ${HOST_IP} | /dev/sda7 swift | +----------+ +--------+ +------------------------+ | nw I/Fs +----------+ | CPE | +----------+ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é † ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ã¯ç°¡å˜ã§ã™ã€‚\n% sudo -i # git clone git://github.com/jedipunkz/openstack_install.git ã—ã¦å–å¾—ã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç’°å¢ƒã«åˆã‚ã›ã¦ç’°å¢ƒå¤‰æ•°è¨­å®šã—ã¾ã™ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¸Šéƒ¨ã®ã“ã‚Œ ã‚‰ã®å†…å®¹ã‚’ã€ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã€‚${HOST_IP} ã¨ ${NOVA_VOLUMES_DEV}, ${SWIFT_DEV} ã ã‘æ°—ã‚’ã¤ã‘ã‚Œã° OK ã§ã™ã€‚ãã®ä»–ã¯å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è¨­å®šãªã®ã§ä½• ã§ã‚‚ã¤ãªãŒã‚Šã¾ã™ã€‚\n# ----------------------------------------------------------------- # Environment Parameter # ----------------------------------------------------------------- HOST_IP='10.200.8.15' HOST_MASK='255.255.255.0' HOST_NETWORK='10.200.8.0' HOST_BROADCAST='10.200.8.255' GATEWAY='10.200.8.1' MYSQL_PASS='secret' FIXED_RANGE='192.168.4.1/27' FLOATING_RANGE='10.200.8.32/27' FLAT_NETWORK_DHCP_START='192.168.4.33' ISCSI_IP_PREFIX='192.168.4' NOVA_VOLUMES_DEV='/dev/sda6' SWIFT_DEV='/dev/sda7' ã§å®Ÿè¡Œã€‚\n# chmod +x openstack_install/openstack_install.sh # ./openstak_install/openstack_install.sh allinone ( wait some minutes...) ãƒã‚·ãƒ³ã«ã‚ˆã‚Šã¾ã™ãŒã€10åˆ†å¼±ã™ã‚‹ã¨ OpenStack ãŒæ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚\nOS ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ SSH ã‚­ãƒ¼ãƒšã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ä¸Šè¨˜ã®æ‰‹é †ã§ OpenStack ã¯æ§‹ç¯‰ã•ã‚Œã‚‹ã®ã§ã™ãŒã€VM ã‚’èµ·å‹•ã™ã‚‹ã«ã¯ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå¿… è¦ã§ã™ã‚ˆã­ã€‚ã“ã‚Œã¯è‡ªåˆ†ã§ç”¨æ„ã™ã‚‹ã—ã‹ãªã„ã§ã™ã€‚ãŸã ã€ã“ã‚Œã¯ç°¡å˜ã§ä¸‹è¨˜ã®æ‰‹é †ã§å‡º æ¥ã¾ã™ã€‚\nOS ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆ ã‚µãƒ³ãƒ—ãƒ«ã§ Ubuntu Server 12.04 LTS amd64 ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã“ã“ã§ä½œã£ã¦ã¿ã¾ã™ã€‚\n# kvm-image create -f qcow2 server.img 5G # wget http://gb.releases.ubuntu.com//precise/ubuntu-12.04-server-amd64.iso # kvm -m 256 -cdrom ubuntu-12.04-server-amd64.iso -drive file=server.img,if=virtio,index=0 -boot d -net nic -net user -nographic -vnc :0 æ‰‹å…ƒã®ç«¯æœ«ã® VNC ãƒ„ãƒ¼ãƒ«ã§ ${HOST_IP}:0 ã«æ¥ç¶šã— OS ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ¸ˆã¾ã›ã¾ã™ã€‚ ãã®å¾Œã€ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ HDD ã‹ã‚‰èµ·å‹•ã—ã¦ã‚ã’ã¦\u0026hellip;\n# kvm -m 256 -drive file=server.img,if=virtio,index=0 -boot c -net nic -net user -nographic -vnc :0 å†åº¦ã€VNC ã§ VM ã«æ¥ç¶šã—ã¦..\n# sudo rm -rf /etc/udev/rules.d/70-persistent-net.rules # shutdown -h now ä¸Šè¨˜ã®æ“ä½œã‚’ã—ãŸã‚‰ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆã¯çµ‚ã‚ã‚Šã€‚ãã®ä»–ã®ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã® ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆã«ã¤ã„ã¦ã¯å…¬å¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã«æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚\nGlance ã« OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ä½œæˆã—ãŸ OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ Glance ã«è¿½åŠ ã—ã¾ã™ã€‚å…ˆã»ã©ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ç”Ÿæˆã•ã‚ŒãŸ /root/.openstack ãŒ Glance ã«æ¥ç¶šã™ã‚‹ãŸã‚ã«å¿…è¦ãªã®ã§ zsh ã®å ´åˆ source ã—ã¦ã‹ã‚‰\u0026hellip;\n# source /root/.openstack # glance add name=\u0026quot;Ubuntu Server 12.04LTS\u0026quot; is_public=true container_format=ovf disk_format=qcow2 \u0026lt; server.img ã§è¿½åŠ å‡ºæ¥ã¾ã™ã€‚.openstack ã¯ bash ã§ã‚‚å–å¾—ã§ãã‚‹ã®ã§ãã®éš›ã¯\n# . /root/.openstack ã—ã¦ãã ã•ã„ã€‚root ãƒ¦ãƒ¼ã‚¶ä»¥å¤–ã§ã‚‚æ“ä½œå‡ºæ¥ã¾ã™ã€‚\nSSH ã‚­ãƒ¼ãƒšã‚¢ã®ç”Ÿæˆã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« VM ã«å‰²ã‚Šå½“ã¦ã‚‹ SSH ã‚­ãƒ¼ãƒšã‚¢ã‚’ä½œã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ‰‹é †ã§ã™ã€‚\n# ssh-keygen # nova keypair-add --pub_key .ssh/id_rsa.pub mykey # nova keypair-list Horizon ã¸æ¥ç¶š ã„ã‚ˆã„ã‚ˆ Horizon ã¸æ¥ç¶šã§ã™ã€‚Horizon ã¯ OpenStack ESSEX ã‹ã‚‰å–ã‚Šè¾¼ã¾ã‚ŒãŸ Web UI ã§ã™ã€‚VM ã®ä½œæˆãƒ»å‰Šé™¤ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è¨­å®šç­‰ãŒãƒ–ãƒ©ã‚¦ã‚¶ã§æ“ä½œå‡ºæ¥ã¾ã™ã€‚\nhttp://${HOST_IP ã«æ¥ç¶šã—ã¦ãƒ¦ãƒ¼ã‚¶ : \u0026lsquo;admin\u0026rsquo;, ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ \u0026lsquo;admin\u0026rsquo; ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚\nã¾ã¨ã‚ OpenStack ã¯ã—ã‚“ã©ã„ï½— ã§ã™ãŒæ¥æœˆ 2012/09 ãƒªãƒªãƒ¼ã‚¹äºˆå®šã® Folsom ã¯ \u0026lsquo;Easy Setup\u0026rsquo; ãŒãƒ•ãƒ¥ãƒ¼ãƒãƒ£ã•ã‚Œã¦ã‚‹ãã†ã§ã™ã€‚æœŸå¾…ã€‚æ‰‹å‹•ã§æ§‹ç¯‰ã—ã¦ã„ã‚‹ã¨ glance ã®ã¨ã“ ã‚ã§ ID åœ°ç„ã«ãƒãƒã‚Šã¾ã™ï½— ä»Šå›ã®æ‰‹é †ã§ all in one ãªç’°å¢ƒãŒã§ããŸã‚‰ã€è‰²ã€…è¦—ã„ ã¦ã¿ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ¯ã« Node ã‚’åˆ‡ã‚Šå‡ºã™ã£ã¦ã“ã¨ã‚‚è€ƒãˆãªã„ã¨ã„ã‘ãªã„ã¨æ€ã„ã¾ã™ã€‚ ãã‚Œãã‚Œã¯ HTTP ãƒ™ãƒ¼ã‚¹ã® API ã§æ¥ç¶šã§ãã‚Œã° OK ãªã®ã§åˆ‡ã‚Šå‡ºã™ã“ã¨è‡ªä½“ã¯ç°¡å˜ã€‚ å†—é•·ã‚’çµ„ã‚€æ–¹æ³•ã¯.. ã“ã‚Œã‹ã‚‰èª¿ã¹ã¾ã™ã€‚keystone, glance ã‚’æ‹¡å¼µãƒ»å†—é•·ã•ã›ã‚‹ã£ã¦å‡º æ¥ã‚‹ã®ã‹ï¼Ÿé›£ã—ãã†ã€‚CloudStack ã¨é•ã£ã¦ rabbitmq-server ã§ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã—ã¦ãã‚Œ ã‚‹ã®ã§ã€Node ãŒå¢—ãˆãŸæ™‚ã®å¯¾å‡¦ã¯è€ƒãˆã‚Œã‚Œã¦ã„ã‚‹ã‚ˆã†ã€‚\nã‚ã¨ã€OS ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã¯ãªãã¦ AMI ã§ VM ã‚’ä½œã‚‹æ–¹æ³•ã‚‚ã‚ã‚‹ã®ã§ã™ãŒ AMI ã®ä½œæˆæ–¹æ³•ã¯ Web ã‚’è¦‹ã¦ã„ã‚‹ã¨æ²¢å±±è¼‰ã£ã¦ã„ã¾ã™ã®ã§å‚è€ƒã«ã—ã¦ä½œã£ã¦ã¿ã¦ãã ã•ã„ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/08/26/all-in-one-openstack-installation/","summary":"\u003cp\u003eOpenStack ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã£ã¦ã—ã‚“ã©ã„ãªãã€ã£ã¦æ„Ÿã˜ã¦ devstack\n\u003ca href=\"http://devstack.org/\"\u003ehttp://devstack.org/\u003c/a\u003e ã¨ã‹ã§æ§‹ç¯‰ã—ã¦ä¸­ã‚’è¦—ã„ã¦ã„ãŸã®ã§ã™ãŒã€ãã‚‚ãã‚‚ devstack\nã£ã¦å†èµ·å‹•ã—ã¦ã—ã¾ãˆã°ä½•ã‚‚èµ·å‹•ã—ã¦ã“ãªã„ã—ã€swift ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œãªã„ã—ã§ã€‚\nã‚„ã£ã±ã‚Šå…¬å¼ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«è¦‹ãªãŒã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã—ã‹ãªã„ã‹ãã£ã¦\u0026hellip;ã€‚æ„Ÿã˜ã¦ã„\nãŸã®ã§ã™ãŒ\u0026hellip;ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://docs.openstack.org/essex/openstack-compute/starter/os-compute-starterguide-trunk.pdf\"\u003ehttp://docs.openstack.org/essex/openstack-compute/starter/os-compute-starterguide-trunk.pdf\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã“ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®å‰æã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯2ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ»server1, server2 ã®è¨ˆ2å°ãŒå‰\næãªã®ã§ã™ãŒã€ç’°å¢ƒä½œã‚‹ã®ãŒã—ã‚“ã©ã„ã®ã§ã€ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ãªæ§‹ç¯‰ãŒã—ãŸã„ï¼ã‚µãƒ¼ãƒ1å°ã§ OpenStack ESSEX ã‚’\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„ï¼ã§ã€ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã£ãŸã®ã§ãã‚Œã‚’ä½¿ã£ãŸã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cimg src=\"http://jedipunkz.github.com/pix/openstack_thinkpad.jpg\"\u003e\n\u003cp\u003eã¼ãã® Thinkpad ã« OpenStack ESSEX ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§ localhost ã«æ¥ç¶šã—ã¦\nã„ã‚‹ç”»é¢ã§ã™ã€‚ã¡ã‚ƒã‚“ã¨ KVM VM ãŒèµ·å‹•ã—ã¦ noVNC ã§æ¥ç¶šã§ãã¦ã„ã¾ã™ã€‚è‡ªå·±æº€è¶³ã‚„ãã€‚\u003c/p\u003e\n\u003ch2 id=\"å‰ææ¡ä»¶\"\u003eå‰ææ¡ä»¶\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eUbuntu Server 12.04 LTS amd64 ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨\u003c/li\u003e\n\u003cli\u003eIntel-VT ã‚‚ã—ãã¯ AMDâˆ’Vãªãƒã‚·ãƒ³\u003c/li\u003e\n\u003cli\u003eNIC ãŒä¸€ã¤ä»¥ä¸Šã¤ã„ã¦ã„ã‚‹ãƒã‚·ãƒ³\u003c/li\u003e\n\u003cli\u003e/dev/sda6, /dev/sda7 (ãƒ‡ãƒã‚¤ã‚¹åã¯ä½•ã§ã‚‚ã„ã„) ã®2ã¤ãŒæœªä½¿ç”¨ã§ç©ºã„ã¦ã„ã‚‹ã“ã¨\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆ\"\u003eæ§‹æˆ\u003c/h2\u003e\n\u003cp\u003e1 NIC ã‚’å‰æã« eth0 ã¨ eth0:0 ã®2ã¤ã‚’æƒ³å®šã™ã‚‹ã¨ã€ã“ã‚“ãªæ§‹æˆã«ãªã‚Šã¾ã™ã€‚eth0:0\nã¯å®Œå…¨ã«ãƒ€ãƒŸãƒ¼ã§ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä½•ã§ã‚‚ã„ã„ã§ã™ã€‚br100 ãƒ–ãƒªãƒƒã‚¸ãƒ‡ãƒã‚¤ã‚¹ä¸Šã§ VM ãŒ\nNW I/F ã‚’æŒã¡ã¾ã™ã€‚floating range ã£ã¦ã®ã¯ OpenStack ã§è¨€ã†ã‚°ãƒ­ãƒ¼ãƒãƒ« IP ãƒ¬ãƒ³\nã‚¸ã€‚ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ã‚ã‚‹å¿…è¦ã¯ç„¡ã„ã§ã™ãŒ eth0 ã¨åŒã˜ãƒ¬ãƒ³ã‚¸ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ VM ã«ä»˜\nä¸å‡ºæ¥ã¾ã™ã€‚/dev/sda6 ãŒ nova-volumes ã§ /dev/sda7 ãŒ swift ã€‚ãªã®ã§ OS ã‚¤ãƒ³ã‚¹\nãƒˆãƒ¼ãƒ«æ™‚ã«2ã¤ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’æœªä½¿ç”¨ã§ç©ºã‘ã¦ãŠã„ã¦ãã ã•ã„ã€‚\u003c/p\u003e","title":"OpenStack ESSEX ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"},{"content":"ä»•äº‹ã§ Opesocd Chef ã®æƒ…å ±åé›†ã‚’ã—ã¦ãŸã®ã§ã™ãŒã€åƒ•ãŒæ„Ÿã˜ã‚‹ã«ã“ã‚Œã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ ã‚¸ãƒ‹ã‚¢ã®æœªæ¥ã ã¨ã€‚é€†ã«è¨€ã†ã¨ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®å±æ©Ÿã€‚AWS ã®ã‚ˆã†ãªã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ ãƒ“ã‚¹ãŒã‚ã‚Œã°ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒä»Šã¾ã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒè¡Œã£ã¦ã„ãŸä½œ æ¥­ã‚’è‡ªã‚‰å‡ºæ¥ã¦ã—ã¾ã†ã‹ã‚‰ã§ã™ã€‚\nã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãªã‚‰èº«ã«ä»˜ã‘ã‚‹ã—ã‹ãªã„ï¼ã£ã¦åƒ•ãŒæ„Ÿã˜ã‚‹ Chef ã«ã¤ã„ã¦ chef-solo ã‚’é€šã—ã¦ç†è§£ã™ã‚‹ãŸã‚ã«æƒ…å ±ã¾ã¨ã‚ã¾ã—ãŸã€‚\nchef ã«ã¯ chef-server æ§‹æˆã§å‹•ä½œã™ã‚‹ã‚‚ã®ã¨ chef-solo ã¨ã„ã†ã‚µãƒ¼ãƒç„¡ã—ã§å‹•ä½œã™ ã‚‹ã‚‚ã®ãŒã‚ã‚‹ã€‚chef-server ã¯æ§‹ç¯‰ã™ã‚‹ã®ãŒå°‘ã—å¤§å¤‰ (å¾Œã«æ–¹æ³•ã‚’ãƒ–ãƒ­ã‚°ã«æ›¸ããŸã„) ãªã®ã§ä»Šå›ã¯ chef-solo ã‚’ä½¿ã£ã¦ã¿ã‚‹ã€‚ã¡ãªã¿ã« Opscode ãŒ chef-server ã®ãƒ›ã‚¹ãƒ†ã‚£ ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã‚’å±•é–‹ã—ã¦ã„ã‚‹ã€‚å½¼ã‚‰ã¨ã—ã¦ã¯ã“ã¡ã‚‰ãŒãƒ¡ã‚¤ãƒ³ã€‚\nchef-solo ã®å…¥ã‚Œæ–¹ opscode ãŒæ¨å¥¨ã—ã¦ã„ã‚‹ ruby-1.9.2 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚rvm ã¯è‰²ã€…å•é¡Œã‚’æ‹›ãå¯„ã› ã‚‹ã®ã§ rbenv ã‚’ä½¿ã£ã¦ç’°å¢ƒæ•´ãˆã¾ã™ã€‚root ãƒ¦ãƒ¼ã‚¶ç’°å¢ƒå†…ã«å…¥ã‚Œã¦ãã ã•ã„ã€‚\nå¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\n% sudo apt-get update % sudo apt-get install build-essential zlib1g-dev libssl-dev root ãƒ¦ãƒ¼ã‚¶ã«ã¦rbenv ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\n% sudo -i # cd ~ # git clone git://github.com/sstephenson/rbenv.git .rbenv # echo 'export PATH=\u0026quot;$HOME/.rbenv/bin:$PATH\u0026quot;' \u0026gt;\u0026gt; ~/.zshrc # echo 'eval \u0026quot;$(rbenv init -)\u0026quot;' \u0026gt;\u0026gt; ~/.zshrc ruby-build ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\n# mkdir -p ~/.rbenv/plugins # cd ~/.rbenv/plugins # git clone git://github.com/sstephenson/ruby-build.git opscode ãŒæ¨å¥¨ã—ã¦ã„ã‚‹ ruby ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.9.2 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\n# rbenv install 1.9.2-p290 # rbenv global 1.9.2-p290 # rbenv rehash capistrano, chef ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ gem ã‚’ä½¿ã„è¡Œã†\n# gem install chef # rbenv rehash ã“ã‚Œã‚‰ã¯ \u0026lsquo;root\u0026rsquo; ãƒ¦ãƒ¼ã‚¶ç’°å¢ƒå†…ã«æ§‹ç¯‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚chef ãŒãã‚Œã‚’å‰æã¨ã—ã¦ã„ã‚‹ ã‹ã‚‰ã ã€‚ã¾ãŸã€perl ã¨é•ã„ ruby ã¯å¾Œæ–¹äº’æ›æ€§ãŒãªã„ã®ã§å°†æ¥ã®ã“ã¨ã‚’è€ƒãˆ rbenv ã§ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç®¡ç†ã—ç¶šã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ã€ã¨æ€ã†ã€‚\nchef-solo ã®è¨­å®š /etc/chef/chef.json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã™ã‚‹ã“ã¨ã§ã€chef-solo ã§å®Ÿè¡Œã™ã‚‹ recipe ã®è¿½ åŠ ã‚’è¡Œã†ã€‚ã“ã‚Œã¯è¤‡æ•°æŒ‡å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã€‚\n{ \u0026quot;run_list\u0026quot;: [ \u0026quot;recipe[ntp]\u0026quot;, ] } ä¸Šè¨˜ã¯ ntp ãƒ¬ã‚·ãƒ” ã‚’è¿½åŠ ã—ãŸä¾‹ã€‚æ¬¡ã« /etc/chef/solo.rb ã‚’ç”Ÿæˆã™ã‚‹ã€‚ã“ã‚Œã¯ chef-solo å‹•ä½œã«å¿…è¦ãª PATH æŒ‡å®šã‚’ä¸»ã«è¡Œã†ã€‚\nfile_cache_path \u0026quot;/tmp/chef-solo\u0026quot; cookbook_path [\u0026quot;/home/jedipunkz/cookbooks\u0026quot;] role_path \u0026quot;/home/jedipunkz/role\u0026quot; log_level :debug ä¸Šè¨˜ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®èª¬æ˜ã¯ä¸‹è¨˜ã®é€šã‚Šã€‚\nfile_cache_path : cache ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæŒ‡å®š cookbook_path : cookbook ã‚’é…ç½®ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæŒ‡å®š role_path : role ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæŒ‡å®š log_level : Log Level ã®æŒ‡å®š ã‚µãƒ³ãƒ—ãƒ«ã‚¯ãƒƒã‚¯ãƒ–ãƒƒã‚¯ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨ç†è§£ ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦ opscode ãŒæä¾›ã—ã¦ã„ã‚‹ \u0026rsquo;ntp\u0026rsquo; ã‚’æŒã£ã¦ãã‚‹ã€‚ä¸­èº«ãŒç°¡å˜ã«ç†è§£å‡ºæ¥ ã‚‹ã‚‚ã®ãªã®ã§æœ€åˆç†è§£ã™ã‚‹ãŸã‚ã«æŒã£ã¦ãã‚‹ã‚‚ã®ã¨ã—ã¦ã¯æœ€é©ã€‚\n% cd /home/jedipunkz/cookbooks % git clone https://github.com/opscode-cookbooks/ntp.git æŒã£ã¦ããŸã‚¯ãƒƒã‚¯ãƒ–ãƒƒã‚¯ã®æ§‹é€ ã¯\nntp . |- attributes |- templates |- recipes |- meradata.rb |-.. |-.. ã¨ãªã£ã¦ã„ã‚‹ã€‚attribute/default.rb ã®ä¸€éƒ¨åˆ†ã‚’æŠœç²‹ã‚’è¨˜ã—ã¦ã¿ãŸã€‚\ndefault['ntp']['servers'] = %w{ 0.pool.ntp.org 1.pool.ntp.org 2.pool.ntp.org 3.pool.ntp.org } default['ntp']['packages'] = %w{ ntp ntpdate } default['ntp']['service'] = \u0026quot;ntp\u0026quot; default['ntp']['varlibdir'] = \u0026quot;/var/lib/ntp\u0026quot; default['ntp']['conf_owner'] = \u0026quot;root\u0026quot; default['ntp']['conf_group'] = \u0026quot;root\u0026quot; default['ntp']['var_owner'] = \u0026quot;ntp\u0026quot; default['ntp']['var_group'] = \u0026quot;ntp\u0026quot; chef ã¯ ruby ã® DSL ã§è¨˜è¿°ã™ã‚‹ãŒ template ã‚„ recipe å†…ã§æŒ‡å®šã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é›†ã¨ ãªã‚‹ã®ãŒ attribute ã¨ãªã‚‹ã€‚ä¸Šã‚’è¦‹ã¦ã¿ã‚‹ã¨ ntp ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚ªãƒ¼ ãƒŠãƒ¼æƒ…å ±ç­‰ãŒè¨˜ã•ã‚Œã¦ã„ã‚‹ã€‚\ntemplates/default/ntp.conf.erb ã‚’è¦‹ã¦ã¿ã‚‹ã¨\u0026hellip;\ndriftfile \u0026lt;%= node['ntp']['driftfile'] %\u0026gt; statsdir \u0026lt;%= node['ntp']['statsdir'] %\u0026gt; statistics loopstats peerstats clockstats filegen loopstats file loopstats type day enable filegen peerstats file peerstats type day enable filegen clockstats file clockstats type day enable \u0026lt;%# If ntp.peers is not empty %\u0026gt; \u0026lt;% unless node['ntp']['peers'].empty? -%\u0026gt; \u0026lt;%# Loop through defined peers, but don't peer with ourself %\u0026gt; \u0026lt;% node['ntp']['peers'].each do |ntppeer| -%\u0026gt; \u0026lt;% if node['ipaddress'] != ntppeer and node['fqdn'] != ntppeer %\u0026gt; peer \u0026lt;%= ntppeer %\u0026gt; iburst restrict \u0026lt;%= ntppeer %\u0026gt; nomodify \u0026lt;% end -%\u0026gt; \u0026lt;% end -%\u0026gt; \u0026lt;% end -%\u0026gt; ã“ã‚Œã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ /etc/ntp.conf (recipde ã§å¾Œã«æŒ‡å®šã™ã‚‹) ã®å†…å®¹ãã®ã¾ã¾ã ã€‚ å…ˆç¨‹ã‚‚æ›¸ã„ãŸãŒ chef ã¯ ruby ã® DSL è¨˜è¿°ãŒåŸºæœ¬ãªã®ã§ attribute ã§æŒ‡å®šã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ ã‚¿ã‚’æŒã£ã¦ãã¦ã€ã“ã†ã„ã£ãŸã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆå‡ºæ¥ã‚‹ã€‚ã§ã¯æœ€å¾Œã« recipe ã‚’ è¦‹ã¦ã¿ã‚‹ã€‚ã“ã® recipe ãŒ chef ã®æœ¬ä½“ã¨è¨€ã£ã¦ã„ã„ã¨ã“ã‚ã§ã™ã­ã€‚ä¸Šéƒ¨ã®æŠœç²‹ã§ã™ã€‚\nnode['ntp']['packages'].each do |ntppkg| package ntppkg end ã“ã® [\u0026rsquo;ntp\u0026rsquo;][\u0026lsquo;packages\u0026rsquo;] ã¯ attributes/default.rb ã« %w{ ntp ntpdate } ã¨æ›¸ã„ ã¦ã‚ã‚‹ã€‚ã¤ã¾ã‚Š ntp, ntpdate ã®é…åˆ—ã‚’ ntppkg ã¨ã—ã¦å›ã—ã¦ chef resources ã® \u0026lsquo;package\u0026rsquo; ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã€‚resources ã«ã¤ã„ã¦ã¯ chef ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€ã¨è‰¯ã„ã€‚recipe ã§ä½¿ãˆã‚‹è¨˜è¿°å…¨ã¦ãŒ1ãƒšãƒ¼ã‚¸ã«ã¾ã¨ã¾ã£ã¦ã„ã‚‹ã€‚\nhttp://wiki.opscode.com/display/chef/Resources\næ¬¡ã« recipe ã®ä¸‹éƒ¨ã‚’æŠœç²‹ã—ã¦ã¿ãŸã€‚chef resources ã® template ã«ã‚ˆã£ã¦ ntp.conf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã€‚\ntemplate \u0026quot;/etc/ntp.conf\u0026quot; do source \u0026quot;ntp.conf.erb\u0026quot; owner node['ntp']['conf_owner'] group node['ntp']['conf_group'] mode \u0026quot;0644\u0026quot; notifies :restart, resources(:service =\u0026gt; node['ntp']['service']) end source ã«ã‚ˆã£ã¦ template/default/ntp.conf.erb ã‚’å‘¼ã³å‡ºã— owner, group ã§ãƒ•ã‚¡ã‚¤ ãƒ«ã®ã‚ªãƒ¼ãƒŠãƒ¼æƒ…å ±ã‚’ã€mode ã§ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã€‚ã¾ãŸä¿®æ­£ãŒå…¥ã£ãŸéš›ã« ntp ã‚µãƒ¼ãƒ“ã‚¹ã®å†èµ·å‹•ã‚’è¡Œã£ã¦ã„ã‚‹ã®ãŒæœ€çµ‚è¡Œã ã€‚\næŠœç²‹ã§ä¾‹ã‚’æŒ™ã’ãªãŒã‚‰ã ã£ãŸãŒã€Resources ã®è¨˜è¿°æ–¹æ³•ã•ãˆç†è§£ã—ã¦ã—ã¾ãˆã°å…¨ã¦ãŒç† è§£å‡ºæ¥ã‚‹ã ã‚ã†ã—ã€è‡ªåˆ†ã§ã‚¯ãƒƒã‚¯ãƒ–ãƒƒã‚¯ã‚’ä½œã‚‹ã“ã¨ã‚‚ç°¡å˜ã ã‚ã†ã€‚\nchef-solo ã®å®Ÿè¡Œ ã§ã¯ã„ã‚ˆã„ã‚ˆ chef-solo ã®å®Ÿè¡Œã€‚\nä¸Šè¨˜ã§ç”Ÿæˆã—ãŸ chef.json ã¨ solo.rb ã‚’æŒ‡å®šã— chef-solo ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ä¸Šè¨˜ run_list ã§æŒ‡å®šã—ãŸ recipe \u0026rsquo;ntp\u0026rsquo; ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚\n% sudo -i # chef-solo -c /etc/chef/solo.rb -j /etc/chef/chef.json ã¾ã¨ã‚ chef-server æ§‹æˆã®çµ„ã¿æ–¹ã¯å¾Œæ—¥ãƒ–ãƒ­ã‚°ã§æ›¸ã„ã¦ã¿ãŸã„ã€‚å…ˆæ—¥ #DevLOVE ã«å‚åŠ ã—ãŸéš› ã«ã‚‚è©±é¡Œã«ãªã£ãŸãŒã€chef-solo ã‚’ä½¿ã†ã‹ chef-server æ§‹æˆã‚’çµ„ã‚€ã‹ã€ã¾ã è­°è«–ãŒå¿… è¦ãã†ã€‚chef-server æ§‹æˆã‚’çµ„ã‚€ã“ã¨ã¯ç°¡å˜ã§ã¯ç„¡ã„ãŒæ™®é€šã«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãªã‚‰çµ„ã‚ã‚‹ã  ã‚ã†ã€‚ãŒã€çµ„ã‚“ã ã¨ã“ã‚ã§æ‹¡å¼µæ€§ãƒ»å†—é•·æ€§ãƒ»ã‚’è€ƒãˆãŸæ§‹æˆã‚’çµ„ã‚€ã«ã¯ã¾ã ã¾ã ãƒã‚¦ãƒã‚¦ ãŒè¶³ã‚Šãªã„ã€‚ã¾ãŸ couchDB, rabbitmq ãªã©æ¯”è¼ƒçš„æ–°ã—ã„ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ ã®ã§ã€ã“ã‚Œã‹ã‚‰çµŒé¨“ç©ã¾ãªã„ã¨é›£ã—ã„ã ã‚ã†ã€‚ãã‚Œã«æ¯”ã¹ã¦ chef-solo ã¯ä¸Šè¨˜ã®é€šã‚Š ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã€‚ã—ã‹ã‚‚ chef-solo ã‚’å®Ÿè¡Œã™ã‚‹ node è‡ªèº«ã¯å¿…ç„¶çš„ã«æ•°ãŒå¢—ãˆæ‹¡å¼µã™ ã‚‹ã—ã€ãã‚Œã‚’å—ã‘ã‚‹ apt ãƒ¬ãƒã‚¸ãƒˆãƒªã¯å˜ç´”ãª HTTP ãªã®ã§æ‹¡å¼µãƒ»å†—é•·ã¯ç°¡å˜ã ã‚ã†ã€‚\nã¾ãŸã€capistrano ã¨ chef-solo ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€role ã¨ã„ã£ãŸæ¦‚å¿µã‚’ã‚‚ãŸã› ãŸã‚Šã€workstation ã§ä¸€æ‹¬æ“ä½œã¨ã„ã£ãŸåˆ©ä¾¿æ€§ã‚‚æŒãŸã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚ã‚ã‚‹æ„å‘³ chef-solo ã‚’ä½¿ã†ãªã‚‰å¿…ç„¶çš„ãªç‚¹ã«ãªã‚Šãã†ã€‚capistrano ã¨ã®çµ„ã¿åˆã‚ã›ã«ã¤ã„ã¦ã‚‚ å¾Œæ—¥ãƒ–ãƒ­ã‚°ã§æ›¸ã„ã¦ã¿ãŸã„ã€‚\nchef ã‚’ç†è§£ã™ã‚‹ã“ã¨è‡ªä½“ã¯ãã‚“ãªã«ã¯é›£ã—ããªã„ã—ã€ã“ã‚Œã‹ã‚‰ã®æ™‚ä»£ã«å¿…è¦ã«ãªã‚‹ã“ ã¨ã¯çœ¼ã«è¦‹ãˆã¦ã„ã‚‹ã®ã§ã€å­¦ã‚“ã§ãŠã„ã¦æã¯ã—ãªã„ã ã‚ã†ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/08/18/chef-solo/","summary":"\u003cp\u003eä»•äº‹ã§ Opesocd Chef ã®æƒ…å ±åé›†ã‚’ã—ã¦ãŸã®ã§ã™ãŒã€åƒ•ãŒæ„Ÿã˜ã‚‹ã«ã“ã‚Œã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³\nã‚¸ãƒ‹ã‚¢ã®æœªæ¥ã ã¨ã€‚é€†ã«è¨€ã†ã¨ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®å±æ©Ÿã€‚AWS ã®ã‚ˆã†ãªã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼\nãƒ“ã‚¹ãŒã‚ã‚Œã°ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒä»Šã¾ã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒè¡Œã£ã¦ã„ãŸä½œ\næ¥­ã‚’è‡ªã‚‰å‡ºæ¥ã¦ã—ã¾ã†ã‹ã‚‰ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãªã‚‰èº«ã«ä»˜ã‘ã‚‹ã—ã‹ãªã„ï¼ã£ã¦åƒ•ãŒæ„Ÿã˜ã‚‹ Chef ã«ã¤ã„ã¦\nchef-solo ã‚’é€šã—ã¦ç†è§£ã™ã‚‹ãŸã‚ã«æƒ…å ±ã¾ã¨ã‚ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003echef ã«ã¯ chef-server æ§‹æˆã§å‹•ä½œã™ã‚‹ã‚‚ã®ã¨ chef-solo ã¨ã„ã†ã‚µãƒ¼ãƒç„¡ã—ã§å‹•ä½œã™\nã‚‹ã‚‚ã®ãŒã‚ã‚‹ã€‚chef-server ã¯æ§‹ç¯‰ã™ã‚‹ã®ãŒå°‘ã—å¤§å¤‰ (å¾Œã«æ–¹æ³•ã‚’ãƒ–ãƒ­ã‚°ã«æ›¸ããŸã„)\nãªã®ã§ä»Šå›ã¯ chef-solo ã‚’ä½¿ã£ã¦ã¿ã‚‹ã€‚ã¡ãªã¿ã« Opscode ãŒ chef-server ã®ãƒ›ã‚¹ãƒ†ã‚£\nãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã‚’å±•é–‹ã—ã¦ã„ã‚‹ã€‚å½¼ã‚‰ã¨ã—ã¦ã¯ã“ã¡ã‚‰ãŒãƒ¡ã‚¤ãƒ³ã€‚\u003c/p\u003e\n\u003ch2 id=\"chef-solo-ã®å…¥ã‚Œæ–¹\"\u003echef-solo ã®å…¥ã‚Œæ–¹\u003c/h2\u003e\n\u003cp\u003eopscode ãŒæ¨å¥¨ã—ã¦ã„ã‚‹ ruby-1.9.2 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚rvm ã¯è‰²ã€…å•é¡Œã‚’æ‹›ãå¯„ã›\nã‚‹ã®ã§ rbenv ã‚’ä½¿ã£ã¦ç’°å¢ƒæ•´ãˆã¾ã™ã€‚root ãƒ¦ãƒ¼ã‚¶ç’°å¢ƒå†…ã«å…¥ã‚Œã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cp\u003eå¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% sudo apt-get update\n% sudo apt-get install build-essential zlib1g-dev libssl-dev\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eroot ãƒ¦ãƒ¼ã‚¶ã«ã¦rbenv ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% sudo -i\n# cd ~\n# git clone git://github.com/sstephenson/rbenv.git .rbenv\n# echo 'export PATH=\u0026quot;$HOME/.rbenv/bin:$PATH\u0026quot;' \u0026gt;\u0026gt; ~/.zshrc\n# echo 'eval \u0026quot;$(rbenv init -)\u0026quot;' \u0026gt;\u0026gt; ~/.zshrc\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eruby-build ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/p\u003e","title":"chef-solo ã§å­¦ã¶ chef ã®åŸºæœ¬å‹•ä½œ"},{"content":"chef-server ã®æ§‹ç¯‰ã¯å°‘ã—é¢å€’ã ã¨å‰å›ã®è¨˜äº‹ http://jedipunkz.github.com/blog/2012/08/18/chef-solo/ ã«æ›¸ã„ãŸã®ã§ã™ãŒã€ opscode ãŒæä¾›ã—ã¦ã„ã‚‹ bootstrap ã‚’ç”¨ã„ã‚‹ã¨ã€æ§‹ç¯‰ä½œæ¥­ãŒã»ã¼è‡ªå‹•åŒ–å‡ºæ¥ã¾ã™ã€‚ ä»Šå›ã¯ã“ã®æ‰‹é †ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚\nchef ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« å‰å›åŒæ§˜ã« rbenv ã‚’ä½¿ã£ã¦ ruby ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã— chef ã‚’ gem ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ ã„ãã¾ã™ã€‚\n% sudo apt-get update % sudo apt-get install zlib1g-dev build-essential libssl-dev % sudo -i # cd ~ # git clone git://github.com/sstephenson/rbenv.git .rbenv # echo 'export PATH=\u0026quot;$HOME/.rbenv/bin:$PATH\u0026quot;' \u0026gt;\u0026gt; ~/.zshrc # echo 'eval \u0026quot;$(rbenv init -)\u0026quot;' \u0026gt;\u0026gt; ~/.zshrc ruby-build ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n# mkdir -p ~/.rbenv/plugins # cd ~/.rbenv/plugins # git clone git://github.com/sstephenson/ruby-build.git ruby-1.9.2 ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\n# rbenv install 1.9.2-p290 # rbenv global 1.9.2-p290 # rbenv rehash gem ã‚’ä½¿ã£ã¦ã€chef, chef-server-api ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™\n# gem install chef # gem install chef-server-api opscode bootstrap ã‚’ä½¿ã£ãŸ chef-server ã®æ§‹ç¯‰ ã¾ãšã¯ chef-solo ã®ç’°å¢ƒæ•´å‚™ã€‚ã“ã® bootstrap ã¯ chef-solo ã§å®Ÿè¡Œå‡ºæ¥ã‚‹ã‚¯ãƒƒã‚¯ãƒ–ãƒƒ ã‚¯é›†ã«ãªã£ã¦ã„ã¾ã™ã€‚ä¸­ã‚’è¦—ãã¨ \u0026lsquo;apache2, chef, chef-server, couchdb, erlang, rabgitmq\u0026rsquo; ãªã©ãªã©å¿…è¦ãªãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ç¾¤ã®ã‚¯ãƒƒã‚¯ãƒ–ãƒƒã‚¯ãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ¤ã‚Šã¾ã™ã€‚\nã¾ãšã¯ chef-solo ã®ç’°å¢ƒã‚’æ•´å‚™ã—ã¾ã™ã€‚\n# mkdir /etc/chef # vi /etc/chef/solo.rb # cat /etc/chef/solo.rb file_cache_path \u0026quot;/tmp/chef-solo\u0026quot; cookbook_path \u0026quot;/tmp/chef-solo/cookbooks\u0026quot; # vi /etc/chef/chef.json # cat /etc/chef/chef.json { \u0026quot;chef_server\u0026quot;: { \u0026quot;server_url\u0026quot;: \u0026quot;http://localhost:4000\u0026quot; }, \u0026quot;run_list\u0026quot;: [ \u0026quot;recipe[chef-server::rubygems-install]\u0026quot; ] } solo.rb ã§æŒ‡å®šã—ãŸãƒ‘ã‚¹ã¯ä»»æ„ã®ã‚‚ã®ã§æ§‹ã„ã¾ã›ã‚“ã€‚\nAmazon S3 ä¸Šã« opscode bootstrap ãŒã‚ã‚Šã¾ã™ã€‚ã„ã‚ˆã„ã‚ˆ chef-solo ã§ bootstrap ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\n# chef-solo -c /etc/chef/solo.rb -j /etc/chef/chef.json -r http://s3.amazonaws.com/chef-solo/bootstrap-latest.tar.gz ã“ã‚Œã§ chef-server æ§‹ç¯‰ã¯çµ‚ã‚ã‚Šã§ã™ã€‚å®Ÿè¡Œã—ãŸãƒ›ã‚¹ãƒˆã« couchDB, Erlang ãªã©ãŒæ§‹ æˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚\næ¬¡ã« knife ã®ç’°å¢ƒã‚’æ•´å‚™ã—ã¾ã™ã€‚knife ã¯ chef ã®æ“ä½œã‚’è¡Œã†ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚\n# mkdir -p ~/.chef # cp /etc/chef/validation.pem /etc/chef/webui.pem ~/.chef # sudo chown -R root ~/.chef # knife configure -i Where should I put the config file? [~/.chef/knife.rb] Please enter the chef server URL: [http://localhost:4000] Please enter a clientname for the new client: [root] Please enter the existing admin clientname: [chef-webui] Please enter the location of the existing admin client's private key: # [/etc/chef/webui.pem] /root/.chef/webui.pem Please enter the validation clientname: [chef-validator] Please enter the location of the validation key: # [/etc/chef/validation.pem] /root/.chef/validation.pem Please enter the path to a chef repository (or leave blank): WARN: Creating initial API user... INFO: Created (or updated) client[root] WARN: Configuration file written to /home/root/.chef/knife.rb ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ã»ã¼ãã®ã¾ã¾å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚pem ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹æŒ‡å®šã ã‘å…ˆã»ã© root ãƒ¦ãƒ¼ã‚¶ã® HOME ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ¢ãƒã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚\nã“ã‚Œã§ä¸‹è¨˜ã®ã‚ˆã†ã« knife ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚\n# knife client list chef-validator chef-webui root ä»Šå›ã¯ä»¥ä¸Šã§ã™ã€‚ã“ã® chef-server ã®æ§‹ç¯‰ã‚’ knife::server ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã§å®Ÿç¾ã™ã‚‹ æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚\nhttp://fnichol.github.com/knife-server/\nåŒã˜ã bootstrap ã‚’æŒ‡å®šã—ã¦æ§‹ç¯‰ã™ã‚‹ãƒ„ãƒ¼ãƒ«ãªã®ã§ã™ãŒã€ã“ã‚Œã‚’ä½¿ã†åˆ©ç‚¹ã¨ã—ã¦\nchef-server æ§‹æˆã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå–ã‚Œã‚‹ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å…ƒã«å¾©å…ƒã§ãã‚‹ ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ä¾¿åˆ©ã€‚ãŸã ã— knife ãŒæœ€åˆã‹ã‚‰ä½¿ãˆã‚‹ç’°å¢ƒã«é™ã‚Šã¾ã™ã€‚\nã“ã‚Œã‚‰ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã“ã¨ã‚’å‰æã«ã—ãªã„ã¨ã€ä½œæ¥­ãŒè¤‡é›‘åŒ–ã™ã‚‹ãŸã‚ã€å¿…é ˆã ã¨æ€ã„ã¾ã™ã€‚ æ‰‹ä½œæ¥­ã¯ãƒŸã‚¹ã®å…ƒã§ã™ã—ã€‚ãŸã ã€ä¸€åº¦ã¯æ‰‹ä½œæ¥­ã§ã‚„ã£ã¦ã¿ã¦æ§‹æˆã‚’ç†è§£ã™ã‚‹ã“ã¨ã¯ã—ãª ãã¦ã¯ãªã‚‰ãªã„ã§ã—ã‚‡ã†ã€‚couchDB, Rabbitmq ãªã©ã®æ–°ã—ã„ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã«ã¤ã„ã¦ã®ç† è§£ã‚‚æ·±ã‚ãªãã¦ã¯ãªã‚‰ãªã„ã§ã—ã‚‡ã†ã—ã€ã“ã‚Œã‚‰ã‚’ã‚¹ã‚±ãƒ¼ãƒ«ã•ã›ã‚‹ã“ã¨ã‚’å‰æã«ã—ã¦ãŠã‹ ãªã„ã¨ãƒãƒ¼ãƒ‰ã®æ•°ãŒå¢—ãˆã‚‹åº¦ã«è² è·ãŒä¸Šæ˜‡ã—ã¦ã„ãã®ã§å°†æ¥å›°ã‚‹ã§ã—ã‚‡ã†ã€‚å‰å›ã®è¨˜äº‹ ã§ã‚‚è§¦ã‚Œã¾ã—ãŸãŒ chef-solo ã‚’ç”¨ã„ãŸå ´åˆã¯ãã‚Œã‚‰ã®å¿ƒé…ãŒç„¡ããªã‚Šã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/08/18/opscode-bootstrap-chef-server/","summary":"\u003cp\u003echef-server ã®æ§‹ç¯‰ã¯å°‘ã—é¢å€’ã ã¨å‰å›ã®è¨˜äº‹\n\u003ca href=\"http://jedipunkz.github.com/blog/2012/08/18/chef-solo/\"\u003ehttp://jedipunkz.github.com/blog/2012/08/18/chef-solo/\u003c/a\u003e ã«æ›¸ã„ãŸã®ã§ã™ãŒã€\nopscode ãŒæä¾›ã—ã¦ã„ã‚‹ bootstrap ã‚’ç”¨ã„ã‚‹ã¨ã€æ§‹ç¯‰ä½œæ¥­ãŒã»ã¼è‡ªå‹•åŒ–å‡ºæ¥ã¾ã™ã€‚\nä»Šå›ã¯ã“ã®æ‰‹é †ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"chef-ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003echef ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003eå‰å›åŒæ§˜ã« rbenv ã‚’ä½¿ã£ã¦ ruby ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã— chef ã‚’ gem ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦\nã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% sudo apt-get update\n% sudo apt-get install zlib1g-dev build-essential libssl-dev\n% sudo -i\n# cd ~\n# git clone git://github.com/sstephenson/rbenv.git .rbenv\n# echo 'export PATH=\u0026quot;$HOME/.rbenv/bin:$PATH\u0026quot;' \u0026gt;\u0026gt; ~/.zshrc\n# echo 'eval \u0026quot;$(rbenv init -)\u0026quot;' \u0026gt;\u0026gt; ~/.zshrc\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eruby-build ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# mkdir -p ~/.rbenv/plugins\n# cd ~/.rbenv/plugins\n# git clone git://github.com/sstephenson/ruby-build.git\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eruby-1.9.2 ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/p\u003e","title":"Opscode Bootstrap ã‚’ä½¿ã£ãŸ Chef-Server æ§‹ç¯‰"},{"content":"2012å¹´07æœˆ21æ—¥ã«å¤§å´ã®ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆã•ã‚“ã§è¡Œã‚ã‚ŒãŸ #DevLOVE (Chef De DevOps) ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚\né–‹å‚¬æ—¥ : 2012å¹´07æœˆ21æ—¥(åœŸæ›œæ—¥) 15:00 - 20:40 å ´æ‰€ : å¤§å´ ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆã•ã¾ URL : http://www.zusaar.com/event/314003 ä»•äº‹å ´ã§ã‚‚ Chef ã®åˆ©ç”¨ã‚’è€ƒãˆå§‹ã‚ã¦ã„ã¦ä»Šå›ã„ã„æ©Ÿä¼šã§ã—ãŸã€‚åŠå¹´å‰ã¨æ¯”ã¹ã‚‹ã¨ã ã„ ã¶æƒã£ã¦æ¥ã¾ã—ãŸãŒã€ã¾ã ã¾ã è³‡æ–™ã®å°‘ãªã„ Chefã€‚è²´é‡ãªæ©Ÿä¼šã§ã—ãŸã€‚\nãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ä¸‹ã®é€šã‚Šã€‚\n*ã€Chefã®ä¸‹æº–å‚™ã€by Ryutaro YOSHIBA [ @ryuzee ] *ã€Chefè‡ªæ…¢ã®ãƒ¬ã‚·ãƒ”æŠ«éœ²ã€ by ä¸­å³¶å¼˜è²´ã•ã‚“ [ @nakashii_ ] * ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã€ã¿ã‚“ãªã§Cookingã€ * dialogã€è©¦é£Ÿä¼šã€ * Niftyã•ã‚“ã®ã‚¹ãƒ¼ãƒ‘ãƒ¼å®£ä¼ã‚¿ã‚¤ãƒ !!! *ã€æ¸¾èº«ä¼šã€ @ryuzee ã•ã‚“ã® \u0026ldquo;Chef ã®ä¸‹æº–å‚™\u0026rdquo; ã¯ SlideShare ã«ä½¿ã£ãŸè³‡æ–™ãŒå…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚\n20120721 chefã®ä¸‹æº–å‚™ #devlove from Ryuzee YOSHIBA å°è±¡çš„ã ã£ãŸã®ãŒã€VirtualBox + Vagrant ã¨ã„ã†ç’°å¢ƒã€‚å®Ÿéš›ã«ä½¿ã£ã¦ã„ã‚‰ã£ã—ã‚ƒã„ã¾ ã—ãŸã€‚MacBook ã®ä¸­ã«ä»®æƒ³ç’°å¢ƒã¨ãã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã‚ã‚‹ Vegrant ã‚’ä½¿ã£ã¦ã€ãƒ‡ ãƒ—ãƒ­ã‚¤ã®ãƒ†ã‚¹ãƒˆç­‰ãŒå®Ÿæ–½ã§ãã‚‹ãã†ã§ã™ã€‚ã¾ãŸã€Vegrant è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ Chef ã®ãƒ¬ã‚· ãƒ”ã‚’è‡ªå‹•èª­è¾¼ã—ã¦ã€å¸¸ã«æœ¬ç•ªç’°å¢ƒã¨åŒã˜çŠ¶æ…‹ã«ã—ã¦ã„ã‚‹ãã†ã§ã™ã€‚CloudFormation ã¨ ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„ Capistrano ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå‡ºã¦ãã¾ã—ãŸã€‚æœ€è¿‘ã‚ˆãè€³ã«ã™ã‚‹ãƒ¯ãƒ¼ ãƒ‰ã§ã™ã€‚ã¾ãŸ CI ã¯ Jenkins ã ã‚ˆã­ã€ã ã£ãŸã‚Šã€‚\n3ç•ªç›®ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ  \u0026ldquo;ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã€ã¿ã‚“ãªã§ Cooking\u0026rdquo; ã¯ 4-6 äººã®çµ„ã¿ã«ãªã‚Šã€å®Ÿ éš›ã« Chef ã®ãƒ¬ã‚·ãƒ”ã‚’æ›¸ã„ã¦ã¿ã‚ˆã†ã¨ã„ã†ã‚‚ã®ã€‚ä»Šå›ã¯ wordpress ã®æ§‹ç¯‰ã®ãŸã‚ã®ãƒ¬ ã‚·ãƒ”ã‚’æ›¸ã„ã¦ã„ãã¾ã—ãŸã€‚åƒ•ã‚‰ã®çµ„ã¿ã‚‚æ™‚é–“ã‚®ãƒªã‚®ãƒªã§ãƒ¬ã‚·ãƒ”ã®æŠ•å…¥ã‚’çµ‚ãˆã¾ã—ãŸã€‚ wordpress ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« wp-config.php ã¨ mysql ã¸ã® wordpress ç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ã®ä½œæˆã‚’å®Ÿéš›ã« attribute, template, script ã‚‰ Resources ã‚’ä½¿ã£ã¦ãƒ¬ã‚·ãƒ”ã‚’æ›¸ãã¾ ã—ãŸã€‚ç°¡å˜ãªä¾‹ã§ã—ãŸãŒã€ã¿ãªã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã¨ã‚ŒãŸã®ã§ã„ã„æ©Ÿä¼šã§ã—ãŸã€‚\ndialog \u0026ldquo;è©¦é£Ÿä¼š\u0026rdquo; ã§ã¯ã€ã‚°ãƒ«ãƒ¼ãƒ—æ¯ã€ã¾ãŸã‚°ãƒ«ãƒ¼ãƒ—ã‚’å…¥ã‚Œç³§ã®ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã€‚ä½¿ã£ ã¦ã¿ã¦ã©ã†ã ã£ãŸã‹ï¼Ÿã‚’è©±ã—åˆã£ã¦ãã“ã‹ã‚‰è­°è«–ã‚’ä¼¸ã°ã—ã¦ã„ãã¾ã—ãŸã€‚\nã‚„ã£ã±ã‚Šåƒ•ã‚‚å‚åŠ ã™ã‚‹å‰ã‹ã‚‰ãã†ã ã£ãŸã®ã§ã™ãŒã€ä¸€ç•ªçš†ãŒæ°—ã«ãªã£ã¦ã„ã‚‹ã®ãŒã€\n\u0026quot;chef-solo + capistrano ? ãã‚Œã¨ã‚‚ chef-server ãŒã„ã„ã®ï¼Ÿ\u0026quot; ã§ã—ãŸã€‚å®Ÿéš›ã«ä½¿ã£ã¦ã„ã‚‰ã£ã—ã‚ƒã‚‹ CA ã•ã‚“ã®è©±ã«ã‚ˆã‚‹ã¨ã€20å°ã¾ã§ã¯ chef-solo + capistrano ã®æ§‹æˆãŒè‰¯ã„ã¨ã€‚ãã—ã¦100å°è¦æ¨¡ã«ãªã‚‹ã¨ chef-server ãŒè‰¯ã„ãã†ã§ã™ã€‚ å…·ä½“çš„ã«ä½•ãŒ chef-solo ã§å•é¡Œã«ãªã‚‹ã®ã‹ãŒèã‘ãªã‹ã£ãŸã®ã§ã™ãŒã€ã¡ã‚‡ã£ã¨åƒ•ã‚‰ã® èª²é¡Œã«ã—ã¦ã¿ã‚ˆã†ã‹ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸã€CA ã•ã‚“ã§ã¯ puppet ã‚’ä½¿ã£ã¦ã„ã‚‰ã£ã—ã‚ƒã‚‹éƒ¨ ç½²ã‚‚ã‚ã‚‹ãã†ã§ã€chef-server ã®å‹•ä½œãŒä¸å®‰å®šï¼Ÿã¨ã‹ã§400å°è¦æ¨¡ã«ãªã‚‹ã¨ puppet ãŒ è‰¯ããªã‚‹ã¨ã€‚ãã—ã¦ chef-server ã¯ã„ã¾ã¯ rabbitmq, couchDB, erlang ãªã©ã®æ§‹æˆã§ å‡ºæ¥ã¦ã„ã‚‹ã®ã§ã™ãŒã€ãã®ã†ã¡ã©ã‚Œã‹ãŒ (erlang ã® solr ?) ãŒ mysql ã«ç½®ãæ›ã‚ã‚‹ ã¨å™‚ã‚’èãã¾ã—ãŸã€‚\nã¾ãŸã€nifty ã•ã‚“ãŒç¾åœ¨ opscode chef wiki ã‚’ç¿»è¨³ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€åƒ•ã‚‚éå¸¸ã« èˆˆå‘³ãŒã‚ã‚Šã¾ã™ã€‚å‚åŠ ã•ã›ã¦ã‚‚ã‚‰ãŠã†ã‹ãªã€‚ã¾ãŸ nifty ã•ã‚“ãŒ nifty cloud ç”¨ knife-ec2 ã‚’å…¬é–‹ã—ã¦ã„ã‚‹ãã†ã§èª¬æ˜ãŒã‚ã‚Šã¾ã—ãŸã€‚è‡ªç¤¾ã«ã‚¯ãƒ©ã‚¦ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ãŒã‚ã‚‹ã¨ã€ è‰²ã€…æ¥½ã—ã‚ã‚‹ã‚ˆãªã\u0026hellip;ã€‚ã„ã„ãªã€‚\n[2012/07/23 15:00 è¿½è¨˜] nifty ã® @tily ã•ã‚“ãŒå½“æ—¥ä½¿ã£ãŸè³‡æ–™ã‚’å…¬é–‹ãªã•ã£ãŸã®ã§è²¼ã‚Šä»˜ã‘ã¦ãŠãã¾ã™ã€‚\nãƒ‹ãƒ•ãƒ†ã‚£ç¤¾å†…ã® Chef åˆ©ç”¨ã«ã¤ã„ã¦ from tidnlyam ä»¥ä¸ŠãŒ \u0026ldquo;Chef De DevOps\u0026rdquo; ã®å‚åŠ ãƒ¬ãƒãƒ¼ãƒˆã§ã€ã“ã“ã‹ã‚‰ã¯åƒ•ã‚‰ã®èª²é¡Œã§ã‚ã‚Šã“ã“1é€±é–“ ãã‚‰ã„ã§å–ã‚Šçµ„ã‚‚ã†ã¨ã—ã¦ã„ã‚‹ç‚¹ã€‚\nchef-server ã®æ§‹ç¯‰ã§ã™ãŒã€ubuntu + opscode ã® deb package ã‚’ä½¿ã†æ–¹æ³•ã‚‚ã‚ã‚‹ã®ã§ ã™ãŒã€ã“ã‚Œã ã¨ opscode ãŒæ¨å¥¨ã—ã¦ã„ã‚‹ ruby ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.9.2 ã§ã¯ãªã 1.8.7 ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ã“ã‚Œã¯ ubuntu, debian ã® stable release ã‚‚ã—ãã¯ development release ãŒ frozen ã—ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚ãªã®ã§ã€ä»Šåƒ•ãŒè€ƒãˆã¦ã„ã‚‹ã®ã¯ã€ chef-solo ã¨ opscode bootstrap ã®çµ„ã¿åˆã‚ã›ã§æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã§ã™ã€‚\nhttp://wiki.opscode.com/display/chef/Installing+Chef+Server+using+Chef+Solo\nã“ã® bootstrap ã¯ opscode ãŒ chef-server æ§‹ç¯‰ç”¨ãƒ¬ã‚·ãƒ”ã¨ã—ã¦å…¬é–‹ã—ã¦ã„ã‚‹ã‚‚ã®ã§ ã™ã€‚ã“ã‚Œã‚’ä½¿ãˆã° chef client ã•ãˆå…¥ã£ã¦ã„ã‚Œã°æ§‹ç¯‰ã§ãã¦ã—ã¾ã†ã¨ã„ã†ã€‚ã“ã®æ‰‹é † ã¯ä¸€åº¦æ‰‹å…ƒã§ã‚‚ç¢ºèªã—ã¦ã¿ã¾ã—ãŸã€‚(Ubuntu Server 12.04 LTS amd64).\nã¾ãŸ Chef ã®ãƒ¡ãƒ¼ãƒªãƒ³ã‚°ãƒªã‚¹ãƒˆã§èã„ã¦ã¿ãŸã¨ã“ã‚ã€ã‚„ã¯ã‚Šæ¨å¥¨ã® ruby ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 1.9.2 ã§ã‚ã£ã¦ã€ã“ã® bootstrap ã®æ–¹æ³•ã¨ã€ã‚ã¨ã¯ knife::server ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚\nã¾ã åƒ•ã¯æ‰‹å…ƒã§ç¢ºèªã§ãã¦ã„ãªã„ã®ã§ã™ãŒã€ã“ã¡ã‚‰ã«ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚\nhttp://fnichol.github.com/knife-server/\nchef-server æ§‹æˆã ã¨ rabbitmq ã« queue ãŒæºœã¾ã£ãŸã‚Šã€couchDB ã®ãƒ‡ã‚£ã‚¹ã‚¯ã‚’æº¢ã‚Œ ã•ã›ãŸã‚Šã¨ãƒˆãƒ©ãƒ–ãƒ«èµ·ããŸæ™‚ã®åˆ‡ã‚Šåˆ†ã‘ã ã£ãŸã‚Šå¯¾å‡¦æ–¹æ³•ã ã£ãŸã‚Šã€ã¾ã ã¾ã æƒ…å ±å°‘ãª ã„ã®ã§è‹¦åŠ´ã™ã‚‹ã ã‚ã†ãªãã¨å€‹äººçš„ã«ã¯æ„Ÿã˜ã¾ã—ãŸã€‚chef-solo + capistrano ã®æ§‹æˆ ã‚‚è€ƒæ…®ã—ã¤ã¤ã€ã“ã®ã‚ãŸã‚Šèª¿ã¹ã¦è¡Œã“ã†ã¨æ€ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/07/22/number-devlove-nican-jia-sitekimasita.-chef-de-devops/","summary":"\u003cp\u003e2012å¹´07æœˆ21æ—¥ã«å¤§å´ã®ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆã•ã‚“ã§è¡Œã‚ã‚ŒãŸ #DevLOVE (Chef De\nDevOps) ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eé–‹å‚¬æ—¥ : 2012å¹´07æœˆ21æ—¥(åœŸæ›œæ—¥) 15:00 - 20:40\nå ´æ‰€   : å¤§å´ ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆã•ã¾\nURL    : http://www.zusaar.com/event/314003\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä»•äº‹å ´ã§ã‚‚ Chef ã®åˆ©ç”¨ã‚’è€ƒãˆå§‹ã‚ã¦ã„ã¦ä»Šå›ã„ã„æ©Ÿä¼šã§ã—ãŸã€‚åŠå¹´å‰ã¨æ¯”ã¹ã‚‹ã¨ã ã„\nã¶æƒã£ã¦æ¥ã¾ã—ãŸãŒã€ã¾ã ã¾ã è³‡æ–™ã®å°‘ãªã„ Chefã€‚è²´é‡ãªæ©Ÿä¼šã§ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ä¸‹ã®é€šã‚Šã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e*ã€Chefã®ä¸‹æº–å‚™ã€by Ryutaro YOSHIBA [ @ryuzee ]\n*ã€Chefè‡ªæ…¢ã®ãƒ¬ã‚·ãƒ”æŠ«éœ²ã€ by ä¸­å³¶å¼˜è²´ã•ã‚“ [ @nakashii_ ]\n* ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã€ã¿ã‚“ãªã§Cookingã€\n* dialogã€è©¦é£Ÿä¼šã€\n* Niftyã•ã‚“ã®ã‚¹ãƒ¼ãƒ‘ãƒ¼å®£ä¼ã‚¿ã‚¤ãƒ !!!\n*ã€æ¸¾èº«ä¼šã€\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e@ryuzee ã•ã‚“ã® \u0026ldquo;Chef ã®ä¸‹æº–å‚™\u0026rdquo; ã¯ SlideShare ã«ä½¿ã£ãŸè³‡æ–™ãŒå…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003ciframe src=\"http://www.slideshare.net/slideshow/embed_code/13712176\"\nwidth=\"427\" height=\"356\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\"\nscrolling=\"no\" style=\"border:1px solid #CCC;border-width:1px 1px\n0;margin-bottom:5px\" allowfullscreen\u003e \u003c/iframe\u003e \u003cdiv\nstyle=\"margin-bottom:5px\"\u003e \u003cstrong\u003e \u003ca\nhref=\"http://www.slideshare.net/Ryuzee/20120721-chef-devlove\" title=\"20120721\nchefã®ä¸‹æº–å‚™ #devlove\" target=\"_blank\"\u003e20120721 chefã®ä¸‹æº–å‚™ #devlove\u003c/a\u003e\n\u003c/strong\u003e from \u003cstrong\u003e\u003ca href=\"http://www.slideshare.net/Ryuzee\"\ntarget=\"_blank\"\u003eRyuzee YOSHIBA\u003c/a\u003e\u003c/strong\u003e \u003c/div\u003e\n\u003cp\u003eå°è±¡çš„ã ã£ãŸã®ãŒã€VirtualBox + Vagrant ã¨ã„ã†ç’°å¢ƒã€‚å®Ÿéš›ã«ä½¿ã£ã¦ã„ã‚‰ã£ã—ã‚ƒã„ã¾\nã—ãŸã€‚MacBook ã®ä¸­ã«ä»®æƒ³ç’°å¢ƒã¨ãã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã‚ã‚‹ Vegrant ã‚’ä½¿ã£ã¦ã€ãƒ‡\nãƒ—ãƒ­ã‚¤ã®ãƒ†ã‚¹ãƒˆç­‰ãŒå®Ÿæ–½ã§ãã‚‹ãã†ã§ã™ã€‚ã¾ãŸã€Vegrant è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ Chef ã®ãƒ¬ã‚·\nãƒ”ã‚’è‡ªå‹•èª­è¾¼ã—ã¦ã€å¸¸ã«æœ¬ç•ªç’°å¢ƒã¨åŒã˜çŠ¶æ…‹ã«ã—ã¦ã„ã‚‹ãã†ã§ã™ã€‚CloudFormation ã¨\nã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„ Capistrano ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå‡ºã¦ãã¾ã—ãŸã€‚æœ€è¿‘ã‚ˆãè€³ã«ã™ã‚‹ãƒ¯ãƒ¼\nãƒ‰ã§ã™ã€‚ã¾ãŸ CI ã¯ Jenkins ã ã‚ˆã­ã€ã ã£ãŸã‚Šã€‚\u003c/p\u003e","title":"#DevLOVE ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚Chef De DevOps"},{"content":"interop 2012 ã§ \u0026lsquo;DNS ã®çŒ›å¨ã¨ãã®å¯¾ç­–\u0026rsquo; ã‚’å‚è´ã—ã¦ãã¾ã—ãŸã€‚ç°¡å˜ã«ãƒ¬ãƒãƒ¼ãƒˆæ›¸ã„ ã¦ãŠãã¾ã™ã€‚ã¡ã‚‡ã£ã¨æ²¹æ–­ã—ãŸã ã‘ã§å¤§ããªå•é¡Œã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå‡ºã¦ãã‚‹ DNSã€‚æ€–ã„ ã§ã™..ã€‚\næœ¬è¬›ç¾©ã®æ¦‚è¦ ãƒ–ãƒ©ã‚¸ãƒ«ã§å¤§è¦æ¨¡ãª ISP ã¸ã® DNS ãƒã‚¤ã‚¾ãƒ‹ãƒ³ã‚°æ”»æ’ƒãŒç™ºç”Ÿã€‚ãã‚Œã‚‰çŒ›å¨ã«ã¤ã„ã¦ç†è§£ ã™ã‚‹ã¨åŒæ™‚ã«æŠ€è¡“çš„å¯¾å¿œç­–ã‚„å…·ä½“çš„ãªå¯¾å¿œãƒ—ãƒ­ã‚»ã‚¹ã«ã¤ã„ã¦èª¬æ˜ã€‚\nã‚¤ãƒ³ãƒˆãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ : ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¨ã‚¯ã‚¹ãƒã‚§ãƒ³ã‚¸ çŸ³ç”°ã•ã‚“ DNS ã‚’å–ã‚Šå·»ãçŠ¶æ³\nDNS ã‚’ä¹—ã£å–ã£ã¦æ‚ªäº‹ã‚’åƒãè©¦ã¿ : DNS Changer DNS ãã®ã‚‚ã®ã‚’ã‚»ã‚­ãƒ¥ã‚¢ã«ã™ã‚‹æ–¹å‘æ€§ : DNSSEC DNS ã«æ§˜ã€…ãªåˆ¶å¾¡ã‚’ä»»ã›ã‚‹æ–¹å‘æ€§ : SPF, AAAA, DANE, å…ç«¥ãƒãƒ«ãƒãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚° äº‹ä¾‹ : IIJ æ¾å´ã•ã‚“ 2011/11 ãƒ–ãƒ©ã‚¸ãƒ«ã®äº‹ä¾‹ è‘—åã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã†ã¨ malware ãŒä»•è¾¼ã¾ã‚ŒãŸã‚µã‚¤ãƒˆã¸èª˜å°ã€‚ãƒ›ãƒ¼ãƒ ãƒ«ãƒ¼ã‚¿ ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãƒã‚¤ã‚¾ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸã€‚\nã¨ã‚ã‚‹ãƒ›ãƒ¼ãƒ ãƒ«ãƒ¼ã‚¿ã®å•é¡Œ admin ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒç®¡ç† web ã§è¦‹ãˆã‚‹ wan ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæœ‰åŠ¹ åŒã˜ãƒãƒƒãƒ—ã‚»ãƒƒãƒˆã‚’ä½¿ã£ã¦ã„ã‚‹è£½å“ã§åŒæ§˜ã®å•é¡Œ.. wan ã‹ã‚‰ãƒ«ãƒ¼ã‚¿ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ html ã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ãŒå¹³æ–‡ã§æ›¸ã‹ã‚Œã¦ã„ ãŸ ã“ã‚Œã¯æ€–ã„..ã€‚\næ”»æ’ƒæ´»å‹•ã®å®Ÿæ–½ æ”»æ’ƒè€…ãŒè¡Œã†æ‰‹é †ã€‚\nè„†å¼±æ€§ãª CPE ç™ºè¦‹ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ›¸ãæ›ãˆ CPE ãŒå‚ç…§ã™ã‚‹ DNS ã®æ›¸ãæ›ãˆ è‘—åã‚µã‚¤ãƒˆå‘ã‘ DNS ã¸ã®å¿œç­”ã‚’æ›¸ãæ›ãˆ malware ã‚µã‚¤ãƒˆã¸èª˜å° éŠ€è¡Œã®å®‰å…¨å®¢å“¡ãƒ„ãƒ¼ãƒ«ã‚’ç„¡åŠ¹ã«ã™ã‚‹ malware ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã›ã‚‹ å¹¾ã¤ã‹ã®éŠ€è¡Œå‘ã‘ DNS å¿œç­”ã‚’æ›¸ãæ›ãˆã€ç›®çš„ã®ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ã‚µã‚¤ãƒˆã«èª˜å°ã€‚DNS æ›¸ ãæ›ãˆã¯çŸ­ã„æœŸé–“ã®ã¿ã§ã‚ã£ãŸã€‚ è¦æ¨¡ 2011å¹´æ™‚ç‚¹ã€450ä¸‡ã® CPE ã® DNS ãŒæ›¸ãæ›ãˆã‚‰ã‚Œã¦ã„ãŸã€‚ä»Šå¹´ã‚‚ 30ä¸‡ä»¥ä¸Šã® CPE ãŒ å½±éŸ¿ã‚’å—ã‘ãŸã¾ã¾ã€‚\nãã®å¾Œ æ”»æ’ƒè€…ãŒè„†å¼±ãª CPE ã‚’æ¢ã™è©¦ã¿ã¯ã¾ã ç¶šã„ã¦ã„ã‚‹ã€‚ãƒ–ãƒ©ã‚¸ãƒ«ä»¥å¤–ã§ã‚‚è¢«å®³å ±å‘ŠãŒã€‚\nãã®ä»–ã®äº‹ä¾‹ DNS Changer LAN å†…ã® DHCP ã‚µãƒ¼ãƒã«æ”»æ’ƒã—ã¦é…å¸ƒã™ã‚‹ DNS ã‚’æ›¸ãæ›ãˆã‚‹ã¨ã‚‚è¨€ã‚ã‚Œã¦ã„ã‚‹ã€‚ ãã®å¾Œã€FBI ãŒå‚ç…§ç”¨ DNS(æ”»æ’ƒè€…ç®¡ç†) ã‚’å·®ã—æŠ¼ã•ãˆã€‚ã„ããªã‚Šæ­¢ã‚ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãŒ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸ã®æ¥ç¶šãŒã§ããªããªã‚‹ã®ã§ã€åŒã˜ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒã‚’ é‹ç”¨ã€‚ã¾ã 35ä¸‡ç¨‹åº¦ã®æ„ŸæŸ“ãƒ›ã‚¹ãƒˆãŒã‚ã‚‹ã®ã§ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ DNS ã®é‹ç”¨ã‚’ 2012/7/9 ã¾ ã§å»¶é•·æ±ºå®šã€‚\nJPCERT ãŒç”¨æ„ã—ã¦ã„ã‚‹ã€ç¢ºèªã‚µã‚¤ãƒˆ ã“ã®ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§è‡ªç’°å¢ƒãŒæ±šæŸ“ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ãŒåˆ¤ã‚Šã¾ã™ã€‚\nhttp://www.dns-ok.jpcert.or.jp/\nå¹½éœŠãƒ‰ãƒ¡ã‚¤ãƒ³åã«ã¤ã„ã¦ : JPRS å‚å£ã•ã‚“ è¿‘å¹´æ³¨ç›®ã•ã‚Œã¦ã„ã‚‹çŒ›å¨ ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ã‚ˆã‚‹å®šç¾©ãŒæ˜ç¢ºã§ãªã„éƒ¨åˆ†ã‚’çªã„ãŸæ”»æ’ƒ (å¹½éœŠãƒ‰ãƒ¡ã‚¤ãƒ³å) ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®è„†å¼±æ€§ã‚’ã¤ã„ãŸæ”»æ’ƒ (ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¤ã‚¾ãƒ‹ãƒ³ã‚°) å‚¾å‘ã¨å¯¾ç­– 1980å¹´ä»£ã‹ã‚‰åˆ©ç”¨ã•ã‚Œã¦ã„ãŸ æ€§å–„èª¬ã‹ã‚‰ç”Ÿã¾ã‚ŒãŸ åˆ©ç”¨è€…ç”¨é€”ãŒå¤§ããå¤‰å‹• DNS ã®é‡è¦æ€§ã¯æœªã å¤‰ã‚ã£ã¦ã„ãªã„ DNS ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’æ­£ã—ãç†è§£ãŒå¯¾ç­–ã®ç¬¬ä¸€æ­©!\nå¹½éœŠãƒ‰ãƒ¡ã‚¤ãƒ³åã«ã¤ã„ã¦ 2012å¹´2æœˆ8æ—¥ ä¸­å›½ Haixin Duan ã•ã‚“ã«ã‚ˆã‚‹è«–æ–‡ã¨ã—ã¦ç™ºè¡¨ ãã®å‰æ—¥ã«ISC ãŒç·Šæ€¥ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒªã‚’ç™ºè¡¨ å¹½éœŠãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå¼•ãèµ·ã“ã™å•é¡Œ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç®¡ç†ã—ã¦ã„ãŸã‚‚ã®ã‹ã‚‰ãã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å¼•ãå‰¥ãŒã™ã“ã¨ãŒã§ãã‚‹ å¼·åˆ¶çš„ã«ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’ä½¿ç”¨ä¸å¯ã«ã—ã¦ã‚‚ä½¿ã‚ã‚Œç¶šã‘ã‚‹ å¼·åˆ¶çš„ã«ç§»è»¢ã•ã›ã¦ã‚‚ä½¿ã‚ã‚Œç¶šã‘ã‚‹ å‹•ä½œåŸç† ã‚­ãƒ£ãƒƒã‚·ãƒ¥ -\u0026gt; Root -\u0026gt; JP DNS -\u0026gt; æ¨©å¨ DNS ã®å ´åˆã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¸Šã® TTL ãŒåˆ‡ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã«å¯¾ã—ã¦æ¨©å¨ DNS ã«å•ã„åˆã‚ã›ã™ã‚‹ãŒã€ TTL ãŒåˆ‡ã‚Œã¦ã„ãªã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã‚‚å•ã„åˆã‚ã›ã‚‹ã€‚ãã®éš›ã«æ–°ã—ã„æƒ…å ±ãŒå…¥ã£ã¦ã ãŸå ´åˆä¸Šæ›¸ãã™ã‚‹ã‹ï¼Ÿç ´æ£„ã™ã‚‹ã‹ï¼Ÿã¯ã€å®Ÿè£…æ¬¡ç¬¬ã€‚NS ãƒ›ã‚¹ãƒˆã‚’å®šæœŸçš„ã«å•ã„åˆã‚ã›ã™ ã‚‹ã“ã¨ã§ TTL ã‚’å·»ãæˆ»ã—ã€æ°¸é ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åˆ©ç”¨ã•ã›ã‚‹æ”»æ’ƒæ‰‹æ³•ã€‚æ‚ªæ„ã®ã‚ã‚‹ã‚µã‚¤ ãƒˆã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å·®ã—æŠ¼ã•ãˆã¦ã‚‚ã€ä½¿ç”¨ã•ã‚Œç¶šã‘ã‚‹å¯èƒ½æ€§ãŒå‡ºã¦ãã‚‹ã€‚\nå¯¾ç­– å¹½éœŠãƒ‰ãƒ¡ã‚¤ãƒ³ãŒç™ºç”Ÿã—ãªã„å®Ÿè£…ã¸æ›¸ãæ›ãˆ (bind9, unbound ã¯å®Ÿè£…æ¸ˆã¿) å¹½éœŠãƒ‰ãƒ¡ã‚¤ãƒ³åã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æƒ…å ±ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ (ISC ãŒæ¨å¥¨) Unbound, Bind9 ã§å–ã‚‰ã‚ŒãŸå¯¾ç­– æ¨©å¨ DNS ã«å•ã„åˆã‚ã›ã¯ã™ã‚‹ãŒã€TTL ã«ã¤ã„ã¦ã¯ä¸Šæ›¸ãã—ãªã„\nå•é¡Œã®å¯¾ç­– : IIJ å±±æœ¬ã•ã‚“ å‰æ\nãƒ–ãƒ©ã‚¸ãƒ«ã®äº‹ä¾‹ã«ã¤ã„ã¦ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒã§å¯¾ç­–ã—ã¦ã‚‚ç„¡ç›Šã€‚ å¾“æ¥ å¾“æ¥ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ DNS ã¸ã®æ”»æ’ƒã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¤ã‚¾ãƒ‹ãƒ³ã‚° ISP ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ DNS ã‚µãƒ¼ãƒãŒæ¨™çš„ æ­´å²çš„çµŒç·¯ã§ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãŒç·©ã„ ãƒ—ãƒ­ãƒˆã‚³ãƒ«/å®Ÿè£…ã®è„†å¼±æ€§ã‚’çªãã€å½ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã›ã‚‹ ç†è«–çš„ã«ã¯20å¹´å‰ã‹ã‚‰çŸ¥ã‚‰ã‚Œã¦ã„ãŸãŒã€å®Ÿéš›ã®æ”»æ’ƒãŒå›°é›£ã ã£ãŸ è¿‘å¹´ 2008, ã‚«ãƒŸãƒ³ã‚¹ã‚­ãƒ¼æ”»æ’ƒãŒç™ºè¡¨ã•ã‚Œã‚‹ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ TTL ãŒæ¥ã‚‹ã¾ã§å†åº¦æ¤œç´¢ã•ã‚Œãªã„ãŒã€ã“ã‚Œã‚’å¯èƒ½ã«ã—ãŸ ç†è«–çš„ãªçŒ›å¨ã‹ã‚‰ç¾å®Ÿçš„ãªãã‚Œã¸ å¯¾ç­– å•ã„åˆã‚ã›ã‚‹éš›ã® Port ç•ªå·ã‚’ãƒ©ãƒ³ãƒ€ãƒ åŒ– (queryID(16bit) x port (16bit)) ä¸€éƒ¨å•†ç”¨ã‚µãƒ¼ãƒã§ã¯æ”»æ’ƒã‚’æ¤œçŸ¥ã™ã‚‹æ©Ÿèƒ½ãŒã‚¢ãƒª (æ”»æ’ƒã‚’æ¤œçŸ¥ã—ãŸã‚‰å•ã„åˆã‚ã›ã‚’ tcp ã«åˆ‡ã‚Šæ›¿ãˆã‚‹) ISP ã§ã¯ ingress-filtering ã‚’å¯èƒ½ãªé™ã‚Šå®Ÿæ–½ã™ã‚‹ Open Recursive ã¯ã‚„ã‚ã‚‹ -\u0026gt; æ”»æ’ƒã®æ©Ÿä¼šã‚’å¤§å¹…ã«ä½æ¸›ã§ãã‚‹ DNSSEC ã®å°å…¥ã‚’ã™ã™ã‚ã‚‹ -\u0026gt; ä¸­é•·æœŸçš„ãªå¯¾ç­– DNSSEC ãŒçŸ­æœŸçš„å¯¾ç­–ã«ãªã‚‰ãªã„ç†ç”± æ¤œè¨¼ã™ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒãŒã¾ã å°‘ãªã„ DNSSEC ã§ç½²åã—ã¦ã„ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³åãŒã¾ã ã»ã¨ã‚“ã©ç„¡ã„ é¶ã¨åµå•é¡Œ DNSSEC ãã®ã‚‚ã®ã®è¤‡é›‘ã• -\u0026gt; ç†è§£ã—ã¦ã„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ•°ãŒå°‘ãªã„ DNS Changer ã¸ã®å¯¾ç­– CPE ãƒ™ãƒ³ãƒ€ã§å¯¾ç­–ã™ã‚‹ã—ã‹ç„¡ã„ DNS ã‚µãƒ¼ãƒã§ã§ãã‚‹ã“ã¨ã¯ç„¡ã„ ISP ãŒã‚„ã‚‹ã¨ã—ãŸã‚‰\u0026hellip;\nOP25B ãªã‚‰ã¬ OP53B å¯¾ç­–ã‚’è¡Œã†ã‹ï¼Ÿ DNS ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’è¦‹å¼µã‚‹ (Google Public DNS ãªã©ä¾‹å¤–ã¯ã‚ã‚‹ãŒã€è‡ªç¤¾ã‚­ãƒ£ãƒƒã‚·ãƒ¥ ä»¥å¤–ã¸ã®å•ã„åˆã‚ã›ã¯èª¤å·®ã®ç¯„å›²ã®ã¯ãš) DNS ã®èª²é¡Œ : IIJ æ¾å´ã•ã¾ å…ç«¥ãƒãƒ«ãƒãƒ•ã‚£ãƒ«ã‚¿ : å•é¡Œã®ã‚ã‚‹ã‚µã‚¤ãƒˆã®ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’æ›¸ãæ›ãˆã‚‹ DNS64 : A ã¸æ›¸ãæ›ãˆã‚‹ -\u0026gt; DNSSEC ã¨ã®ä½µç”¨ãŒé›£ã—ã„ã“ã¨ãŒå–ã‚Šä¸Šã’ã‚‰ã‚Œã¦ã„ã‚‹ \u0026lt; RFC \u0026lsquo;ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡\u0026rsquo;ãƒ»\u0026lsquo;æ›¸ãæ›ãˆ\u0026rsquo;, ã“ã‚Œã‚‰ã¯æ”»æ’ƒè€…ãŒè¡Œã†ã“ã¨ã¨åŒã˜!\næ‰€æ„Ÿ, ã¾ã¨ã‚ ä»¥ä¸Šç°¡å˜ã§ã—ãŸãŒã€ãƒ¬ãƒãƒ¼ãƒˆã§ã—ãŸã€‚ã“ã†ã„ã£ãŸã‚¤ãƒ™ãƒ³ãƒˆã«1å¹´å‡ºå¸­ã—ãªã„ã ã‘ã§ã€çŸ¥ ã‚‰ãªã„ã“ã¨ãŒå‡ºã¦ãã‚‹ DNS ç•Œéšˆã€‚æ¯å¹´å¤§ããªè„†å¼±æ€§ã®å‡ºã‚‹ Bindã€‚ä½¿ãˆã¦å½“ãŸã‚Šå‰ã€éšœ å®³ãŒèµ·ã“ã‚‹ã¨å¤§å•é¡Œã«ãªã‚‹ DNSã€‚ç®¡ç†è€…ã«ã¨ã£ã¦ã¤ã‚‰ã„çŠ¶æ³ã ã‘ã©ã€ãƒ¦ãƒ¼ã‚¶ã«ã¨ã£ã¦ç„¡ ãã¦ã¯ãªã‚‰ãªã„ã‚·ã‚¹ãƒ†ãƒ ãªã®ã§ã€é‹ç”¨ãƒ»é–‹ç™ºã«æºã‚ã£ã¦ã„ã‚‹äººé–“ã¯ã€è¿‘å¹´ã®çŠ¶æ³ã‚’ã‚¦ã‚©ãƒƒ ãƒã—ç¶šã‘ã¦ã„ãå¿…è¦ãŒã‚ã‚‹ã€‚ã“ã®è¬›ç¾©ã‚’å‚è´ã—ã¦ã„ã‚‹ãªã‹ã§ã€è‡ªç¤¾ã®ç’°å¢ƒã®çµ„ã¿æ›ãˆã‚’ ã¼ã‚“ã‚„ã‚Šè€ƒãˆã¦ã„ã¾ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/06/16/dns-report-interop2012/","summary":"\u003cp\u003einterop 2012 ã§ \u0026lsquo;DNS ã®çŒ›å¨ã¨ãã®å¯¾ç­–\u0026rsquo; ã‚’å‚è´ã—ã¦ãã¾ã—ãŸã€‚ç°¡å˜ã«ãƒ¬ãƒãƒ¼ãƒˆæ›¸ã„\nã¦ãŠãã¾ã™ã€‚ã¡ã‚‡ã£ã¨æ²¹æ–­ã—ãŸã ã‘ã§å¤§ããªå•é¡Œã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå‡ºã¦ãã‚‹ DNSã€‚æ€–ã„\nã§ã™..ã€‚\u003c/p\u003e\n\u003ch2 id=\"æœ¬è¬›ç¾©ã®æ¦‚è¦\"\u003eæœ¬è¬›ç¾©ã®æ¦‚è¦\u003c/h2\u003e\n\u003cp\u003eãƒ–ãƒ©ã‚¸ãƒ«ã§å¤§è¦æ¨¡ãª ISP ã¸ã® DNS ãƒã‚¤ã‚¾ãƒ‹ãƒ³ã‚°æ”»æ’ƒãŒç™ºç”Ÿã€‚ãã‚Œã‚‰çŒ›å¨ã«ã¤ã„ã¦ç†è§£\nã™ã‚‹ã¨åŒæ™‚ã«æŠ€è¡“çš„å¯¾å¿œç­–ã‚„å…·ä½“çš„ãªå¯¾å¿œãƒ—ãƒ­ã‚»ã‚¹ã«ã¤ã„ã¦èª¬æ˜ã€‚\u003c/p\u003e\n\u003ch2 id=\"ã‚¤ãƒ³ãƒˆãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³--ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¨ã‚¯ã‚¹ãƒã‚§ãƒ³ã‚¸-çŸ³ç”°ã•ã‚“\"\u003eã‚¤ãƒ³ãƒˆãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ : ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¨ã‚¯ã‚¹ãƒã‚§ãƒ³ã‚¸ çŸ³ç”°ã•ã‚“\u003c/h2\u003e\n\u003cp\u003eDNS ã‚’å–ã‚Šå·»ãçŠ¶æ³\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDNS ã‚’ä¹—ã£å–ã£ã¦æ‚ªäº‹ã‚’åƒãè©¦ã¿ : DNS Changer\u003c/li\u003e\n\u003cli\u003eDNS ãã®ã‚‚ã®ã‚’ã‚»ã‚­ãƒ¥ã‚¢ã«ã™ã‚‹æ–¹å‘æ€§ : DNSSEC\u003c/li\u003e\n\u003cli\u003eDNS ã«æ§˜ã€…ãªåˆ¶å¾¡ã‚’ä»»ã›ã‚‹æ–¹å‘æ€§ : SPF, AAAA, DANE, å…ç«¥ãƒãƒ«ãƒãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"äº‹ä¾‹--iij-æ¾å´ã•ã‚“\"\u003eäº‹ä¾‹ : IIJ æ¾å´ã•ã‚“\u003c/h2\u003e\n\u003ch4 id=\"201111-ãƒ–ãƒ©ã‚¸ãƒ«ã®äº‹ä¾‹\"\u003e2011/11 ãƒ–ãƒ©ã‚¸ãƒ«ã®äº‹ä¾‹\u003c/h4\u003e\n\u003cp\u003eè‘—åã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã†ã¨ malware ãŒä»•è¾¼ã¾ã‚ŒãŸã‚µã‚¤ãƒˆã¸èª˜å°ã€‚ãƒ›ãƒ¼ãƒ ãƒ«ãƒ¼ã‚¿\nã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãƒã‚¤ã‚¾ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸã€‚\u003c/p\u003e\n\u003ch4 id=\"ã¨ã‚ã‚‹ãƒ›ãƒ¼ãƒ ãƒ«ãƒ¼ã‚¿ã®å•é¡Œ\"\u003eã¨ã‚ã‚‹ãƒ›ãƒ¼ãƒ ãƒ«ãƒ¼ã‚¿ã®å•é¡Œ\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003eadmin ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒç®¡ç† web ã§è¦‹ãˆã‚‹\u003c/li\u003e\n\u003cli\u003ewan ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæœ‰åŠ¹\u003c/li\u003e\n\u003cli\u003eåŒã˜ãƒãƒƒãƒ—ã‚»ãƒƒãƒˆã‚’ä½¿ã£ã¦ã„ã‚‹è£½å“ã§åŒæ§˜ã®å•é¡Œ..\u003c/li\u003e\n\u003cli\u003ewan ã‹ã‚‰ãƒ«ãƒ¼ã‚¿ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ html ã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ãŒå¹³æ–‡ã§æ›¸ã‹ã‚Œã¦ã„\nãŸ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã“ã‚Œã¯æ€–ã„..ã€‚\u003c/p\u003e\n\u003ch4 id=\"æ”»æ’ƒæ´»å‹•ã®å®Ÿæ–½\"\u003eæ”»æ’ƒæ´»å‹•ã®å®Ÿæ–½\u003c/h4\u003e\n\u003cp\u003eæ”»æ’ƒè€…ãŒè¡Œã†æ‰‹é †ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eè„†å¼±æ€§ãª CPE ç™ºè¦‹\u003c/li\u003e\n\u003cli\u003eãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ›¸ãæ›ãˆ\u003c/li\u003e\n\u003cli\u003eCPE ãŒå‚ç…§ã™ã‚‹ DNS ã®æ›¸ãæ›ãˆ\u003c/li\u003e\n\u003cli\u003eè‘—åã‚µã‚¤ãƒˆå‘ã‘ DNS ã¸ã®å¿œç­”ã‚’æ›¸ãæ›ãˆ\u003c/li\u003e\n\u003cli\u003emalware ã‚µã‚¤ãƒˆã¸èª˜å°\u003c/li\u003e\n\u003cli\u003eéŠ€è¡Œã®å®‰å…¨å®¢å“¡ãƒ„ãƒ¼ãƒ«ã‚’ç„¡åŠ¹ã«ã™ã‚‹ malware ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã›ã‚‹\u003c/li\u003e\n\u003cli\u003eå¹¾ã¤ã‹ã®éŠ€è¡Œå‘ã‘ DNS å¿œç­”ã‚’æ›¸ãæ›ãˆã€ç›®çš„ã®ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ã‚µã‚¤ãƒˆã«èª˜å°ã€‚DNS æ›¸\nãæ›ãˆã¯çŸ­ã„æœŸé–“ã®ã¿ã§ã‚ã£ãŸã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"è¦æ¨¡\"\u003eè¦æ¨¡\u003c/h4\u003e\n\u003cp\u003e2011å¹´æ™‚ç‚¹ã€450ä¸‡ã® CPE ã® DNS ãŒæ›¸ãæ›ãˆã‚‰ã‚Œã¦ã„ãŸã€‚ä»Šå¹´ã‚‚ 30ä¸‡ä»¥ä¸Šã® CPE ãŒ\nå½±éŸ¿ã‚’å—ã‘ãŸã¾ã¾ã€‚\u003c/p\u003e","title":"DNS ã®çŒ›å¨ã¨ãã®å¯¾ç­–, å‚åŠ ãƒ¬ãƒ #interop2012"},{"content":"interop 2012 ã§é–‹å‚¬ã•ã‚ŒãŸ \u0026ldquo;ä»®æƒ³ãƒ«ãƒ¼ã‚¿ Vyatta ã‚’ä½¿ã£ãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹ç¯‰æ³•\u0026rdquo; ã«å‚ åŠ ã—ã¦ãã¾ã—ãŸã€‚ç°¡å˜ã§ã™ãŒãƒ¬ãƒãƒ¼ãƒˆã‚’æ›¸ã„ã¦ãŠãã¾ã™ã€‚\né–‹å‚¬æ—¥ : 2012/06/14(æœ¨) å ´æ‰€ : å¹•å¼µãƒ¡ãƒƒã‚» Interop 2012 æœ€åˆã«æ‰€æ„Ÿã€‚åçœã§ã™ã€‚ã‚µãƒ¼ãƒã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®è¦–ç‚¹ã§ã—ã‹æ„Ÿã˜ã‚‰ã‚Œã¦ã„ãªã‹ã£ãŸã€‚æ¬¡æœŸãƒãƒ¼ ã‚¸ãƒ§ãƒ³ã® vPlane å®Ÿè£…ãªã©ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå‘ã‘ã¨ã—ã¦ã‚‚åˆ©ç”¨å‡ºæ¥ã‚‹å¯èƒ½æ€§ã‚’æ„Ÿã˜ã‚‹ ã—ã€æ¯”è¼ƒçš„å°ã•ãªãƒªã‚½ãƒ¼ã‚¹ã§ãƒãƒ³ã‚ºã‚ªãƒ³å‚åŠ è€…30äººç¨‹åº¦ã® vyatta ãƒ«ãƒ¼ã‚¿ã‚’å‹•ã‹ã—ã¦ã‚µ ã‚¯ã‚µã‚¯å‹•ã„ã¦ã„ã‚‹ã®ã‚’è¦‹ã¦ã€ç°¡å˜ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒã©ã†ã¨ã‹ å‰å›ã®è¨˜äº‹ã§è¨€ã†ã¹ ãã˜ã‚ƒãªã‹ã£ãŸãã€‚ãƒ›ãƒ³ãƒˆåçœã€‚\nã§ã¯ãƒãƒ³ã‚ºã‚ªãƒ³ã®å†…å®¹ã€‚\næœ€åˆã«ã€åŸºæœ¬æƒ…å ±ã®è©± æœ‰å„Ÿç‰ˆã¨ç„¡å„Ÿç‰ˆã®é•ã„\nãƒ¡ã‚¸ãƒ£ãƒ¼ãƒªãƒªãƒ¼ã‚¹ã®ã¿ã®ç„¡å„Ÿç‰ˆã«å¯¾ã—ã¦æœ‰å„Ÿç‰ˆã¯ãƒã‚¤ãƒŠãƒ¼ãƒªãƒªãƒ¼ã‚¹ã‚‚ã‚ã‚Š æœ‰å„Ÿç‰ˆã¯ä¿å®ˆã‚ã‚Š ä»®æƒ³ image template æ©Ÿèƒ½ãŒæœ‰å„Ÿç‰ˆã§ã‚ã‚Š API, Web GUI, Config Sync, Systen Image Cloning ãŒæœ‰å„Ÿç‰ˆã§ã‚ã‚Š image template, config sync, cloning ãªã©ã€æœ‰å„Ÿç‰ˆã§ã¯ã‚ã‚‹ã¨å¬‰ã—ã„æ©Ÿèƒ½ãŒãƒ¢ãƒªãƒ¢ ãƒªã€‚\næœ€è¿‘ã®åˆ©ç”¨ã‚±ãƒ¼ã‚¹ Vyatta + VM ã§ VPN æ¥ç¶šç’°å¢ƒæ§‹ç¯‰ ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒä¸€ç•ªå¤šã„ãã†ã ã€‚ã¾ãŸã€ä¼šå ´å†…ã«ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ ã‚’ã¨ã£ãŸçµæœã€ä»®æƒ³ç’°å¢ƒã§ã®æ§‹ç¯‰ã‚’æƒ³å®šã•ã‚Œã¦ã„ã‚‹æ–¹ãŒå¤šæ•°ã ã£ãŸã€‚\næ§‹æˆã¨ç‰¹å¾´ Debian Gnu/Linux ãƒ™ãƒ¼ã‚¹ Quagga, StrongSwam ãŒå†…éƒ¨ã§å‹•ä½œ apt-get ãªã©é¦´æŸ“ã¿æ·±ã„ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã¾ã™ã€‚ http://www.vyatta4people.org/tag/vybuddy/ ã“ã“ã«è‰²ã€…ãƒã‚¦ãƒã‚¦ãŒã‚ã‚‹ã‚‰ã—ã„ã€‚åƒ•ã¯ã¾ã è¦‹ã¦ã„ã¾ã›ã‚“ã€‚ã¾ã»ã‚ã°å·¥æˆ¿ã®è¿‘è—¤ã•ã‚“ã« æ•™ãˆã¦é ‚ãã¾ã—ãŸã€‚ã‚ã¨ã§ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚\nãƒãƒ¼ã‚¸ãƒ§ãƒ³ stable ãƒªãƒªãƒ¼ã‚¹ã¯ 6.4 ã€‚æ¬¡æœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ 6.5 ã§ã¯ vPlane ã®å®Ÿè£…ãŒäºˆå®šã•ã‚Œã¦ã„ã‚‹ã€‚ã“ã‚Œ ã¯ IA ã‚µãƒ¼ãƒã®ã‚³ã‚¢æ¯ã«å½¹å‰²ã‚’å¤‰ãˆã‚‹ã¨ã„ã£ãŸãƒ¢ãƒã€‚ãƒãƒ¼ãƒ‰ãŒå¿™ã—ããªã£ãŸæ™‚ã«ä¾‹ãˆã° è»¢é€ã‚’å¸ã‚‹ã‚³ã‚¢ã«ã¯å½±éŸ¿ã‚’ä¸ãˆãªã„ç­‰ã€‚ã“ã‚Œã¯é‡è¦ã ã€‚ã‚µãƒ¼ãƒã¨é•ã£ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ©Ÿ å™¨ã¯ä½•ãŒã‚ã£ã¦ã‚‚æ­»å®ˆã—ãªãã¡ã‚ƒã„ã‘ãªã„æ©Ÿèƒ½ãŒã‚ã‚‹ã‚‚ã‚“ãªãã€‚6.5 ã«æœŸå¾…ã€‚\nã“ã“ã§ã€ãƒãƒ³ã‚ºã‚ªãƒ³ã§èª²é¡Œã«ãªã£ãŸ IPSec ã®è©±ã‚’å°‘ã—ã ã‘èª¬æ˜ã—ã¾ã™ã€‚\n192.168.18.0/24 +------+ +----------+ | vm01 |-------| vyatta01 |pppoe XXX.XXX.XXX.XXX +------+ +----------+ | |192.168.20.0/24 | IPSec +------+ +----------+ | | vm02 |-------| vyatta02 |pppoe YYY.YYY.YYY.YYY +------+ +----------+ 192.168.19.0/24 ä¸Šå›³ã®ç’°å¢ƒã§ vm01 ãŒ vm02 ã« IPSec ã‚’ç”¨ã„ã¦æ¥ç¶šã™ã‚‹ãŸã‚ã®æ–¹æ³•ã‚’è¨˜ã—ã¦ã„ã¾ã™ã€‚ vyatta åŒå£«ã¯ 192.168.20.0/24 ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§æ¥ç¶šã•ã‚Œã¦ã„ã¾ã™ãŒã€äº’ã„ã«ãƒ«ãƒ¼ãƒ†ã‚£ ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã¯æ›¸ã„ã¦ã„ãªã„ã‚‚ã®ã¨ã—ã¾ã™ã€‚ã¾ãšã¯ vyatta01 ã«å¯¾ã—ã¦ã®è¨­å®šã€‚\nã‚ã€pppoe ã«ã‚ˆã‚‹ NAT ã®è¨­å®šã¯äºˆã‚ã—ã¦ã‚ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚\n# set vpn ipsec ipsec-interfaces interface pppoe1 # set vpn ipsec ike-group IKE-G proposal 1 encryption aes256 # set vpn ipsec ike-group IKE-G proposal 1 hash sha1 # set vpn ipsec ike-group IKE-G lifetime 3600 éµäº¤æ›ã®æ–¹å¼ IKE ã®è¨­å®šã‚’ã—ã¾ã™ã€‚\n# set vpn ipsec esp-group ESP-G proposal 1 encryption aes256 # set vpn ipsec esp-group ESP-G proposal 1 hash sha1 # set vpn ipsec esp-group ESP-G lifetime 1800 ESP ã®è¨­å®šã‚’ã—ã¾ã™ã€‚éµã®ç ´æ£„ãƒ»ç”Ÿæˆæ™‚é–“ 1800 ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚\n# edit vpn ipsec site-to-site peer YYY.YYY.YYY.YYY # set authentication mode pre-shared-secret # set authentication pre-shared-secret hogehoge site-to-site peer ã‚’æŒ‡å®šã—ã¦æ¥ç¶šå…ˆ vyatta ã®ã‚°ãƒ­ãƒ¼ãƒãƒ« IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã—ã¾ã™ã€‚ ã¾ãŸ pre-shared-secret ã§ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’æŒ‡å®šã—ã¾ã™ã€‚\n# set ike-group IKE-G # set local-ip YYY.YYY.YYY.YYY # set tunnel 1 local subnet 192.168.18.0/24 # set tunnel 1 remote subnet 192.168.19.0/24 # set tunnel 1 esp-group ESP-G è‡ªã‚°ãƒ­ãƒ¼ãƒãƒ« IP, è‡ªãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æƒ…å ±è«¸ã€…ã€ è¨­å®šã—ã¾ã™ã€‚\n# set nat source rule 10 destination address !192.168.19.0/24 # commit ã¾ãŸæœ€å¾Œã« IPsec ã§æ¥ç¶šã™ã‚‹å…ˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®ãƒ‘ã‚±ãƒƒãƒˆã®å ´åˆã€NAT ã—ãªã„ã‚ˆã† ã«ã—ã¾ã™ã€‚\næ¬¡ã¯é€†ã« vyatta01 ã«å¯¾ã—ã¦ã‚‚è¨­å®šã‚’æŠ•å…¥ã—ã¾ã™ã€‚è«¸ã€…ã®å€¤ã¯é€†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ ã“ã‚Œã‚’å®Ÿæ–½ã™ã‚‹ã¨ã€vm01 ã‹ã‚‰ vm02 ã«å¯¾ã—ã¦ pppoe interface åŒå£«ã® IPsec ã‚’ä»‹ã— ã¦æ¥ç¶šã§ãã‚‹ã®ãŒç¢ºèªå‡ºæ¥ã¾ã—ãŸã€‚\nç§ã®è·å ´ã§é–‹ç™ºã—ãŸè£½å“ã«ã‚‚æŠ•å…¥ã—ã¦ã¿ã‚ˆã†ã‹ãªã¨ç›®è«–ã‚“ã§ã„ã¾ã™ã€‚æ¥½ã—ã‹ã£ãŸã€‚\næœ€å¾Œã«ã€ã“ã®å ´ã‚’æä¾›ã—ã¦ä¸‹ã•ã£ãŸæ–¹ã€…ã«æ„Ÿè¬ã—ã¾ã™ã€‚\nè¬›æ¼”è€… æ ªå¼ä¼šç¤¾ã¾ã»ã‚ã°å·¥æˆ¿ è¿‘è—¤é‚¦æ˜­ã•ã¾ æœ‰é™ä¼šç¤¾éŠ€åº§å ‚ æµ…é–“æ­£å’Œã•ã¾ ã•ãã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ å¤§ä¹…ä¿ä¿®ä¸€ã•ã¾ ä¼Šè—¤å¿ ãƒ†ã‚¯ãƒã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚º ä¼Šè—¤å“²å²ã•ã¾ ","permalink":"https://jedipunkz.github.io/post/2012/06/14/vyatta-handson-interop2012/","summary":"\u003cp\u003einterop 2012 ã§é–‹å‚¬ã•ã‚ŒãŸ \u0026ldquo;ä»®æƒ³ãƒ«ãƒ¼ã‚¿ Vyatta ã‚’ä½¿ã£ãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹ç¯‰æ³•\u0026rdquo; ã«å‚\nåŠ ã—ã¦ãã¾ã—ãŸã€‚ç°¡å˜ã§ã™ãŒãƒ¬ãƒãƒ¼ãƒˆã‚’æ›¸ã„ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eé–‹å‚¬æ—¥ : 2012/06/14(æœ¨)\nå ´æ‰€   : å¹•å¼µãƒ¡ãƒƒã‚» Interop 2012\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eæœ€åˆã«æ‰€æ„Ÿã€‚åçœã§ã™ã€‚ã‚µãƒ¼ãƒã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®è¦–ç‚¹ã§ã—ã‹æ„Ÿã˜ã‚‰ã‚Œã¦ã„ãªã‹ã£ãŸã€‚æ¬¡æœŸãƒãƒ¼\nã‚¸ãƒ§ãƒ³ã® vPlane å®Ÿè£…ãªã©ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå‘ã‘ã¨ã—ã¦ã‚‚åˆ©ç”¨å‡ºæ¥ã‚‹å¯èƒ½æ€§ã‚’æ„Ÿã˜ã‚‹\nã—ã€æ¯”è¼ƒçš„å°ã•ãªãƒªã‚½ãƒ¼ã‚¹ã§ãƒãƒ³ã‚ºã‚ªãƒ³å‚åŠ è€…30äººç¨‹åº¦ã® vyatta ãƒ«ãƒ¼ã‚¿ã‚’å‹•ã‹ã—ã¦ã‚µ\nã‚¯ã‚µã‚¯å‹•ã„ã¦ã„ã‚‹ã®ã‚’è¦‹ã¦ã€ç°¡å˜ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒã©ã†ã¨ã‹\n\u003ca href=\"http://jedipunkz.github.com/blog/2012/06/13/vyatta-vpn/\"\u003eå‰å›ã®è¨˜äº‹\u003c/a\u003eã§è¨€ã†ã¹\nãã˜ã‚ƒãªã‹ã£ãŸãã€‚ãƒ›ãƒ³ãƒˆåçœã€‚\u003c/p\u003e\n\u003cp\u003eã§ã¯ãƒãƒ³ã‚ºã‚ªãƒ³ã®å†…å®¹ã€‚\u003c/p\u003e\n\u003ch2 id=\"æœ€åˆã«åŸºæœ¬æƒ…å ±ã®è©±\"\u003eæœ€åˆã«ã€åŸºæœ¬æƒ…å ±ã®è©±\u003c/h2\u003e\n\u003cp\u003eæœ‰å„Ÿç‰ˆã¨ç„¡å„Ÿç‰ˆã®é•ã„\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eãƒ¡ã‚¸ãƒ£ãƒ¼ãƒªãƒªãƒ¼ã‚¹ã®ã¿ã®ç„¡å„Ÿç‰ˆã«å¯¾ã—ã¦æœ‰å„Ÿç‰ˆã¯ãƒã‚¤ãƒŠãƒ¼ãƒªãƒªãƒ¼ã‚¹ã‚‚ã‚ã‚Š\u003c/li\u003e\n\u003cli\u003eæœ‰å„Ÿç‰ˆã¯ä¿å®ˆã‚ã‚Š\u003c/li\u003e\n\u003cli\u003eä»®æƒ³ image template æ©Ÿèƒ½ãŒæœ‰å„Ÿç‰ˆã§ã‚ã‚Š\u003c/li\u003e\n\u003cli\u003eAPI, Web GUI, Config Sync, Systen Image Cloning ãŒæœ‰å„Ÿç‰ˆã§ã‚ã‚Š\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eimage template, config sync, cloning ãªã©ã€æœ‰å„Ÿç‰ˆã§ã¯ã‚ã‚‹ã¨å¬‰ã—ã„æ©Ÿèƒ½ãŒãƒ¢ãƒªãƒ¢\nãƒªã€‚\u003c/p\u003e\n\u003ch2 id=\"æœ€è¿‘ã®åˆ©ç”¨ã‚±ãƒ¼ã‚¹\"\u003eæœ€è¿‘ã®åˆ©ç”¨ã‚±ãƒ¼ã‚¹\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eVyatta + VM ã§ VPN æ¥ç¶šç’°å¢ƒæ§‹ç¯‰\u003c/li\u003e\n\u003cli\u003eã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒä¸€ç•ªå¤šã„ãã†ã ã€‚ã¾ãŸã€ä¼šå ´å†…ã«ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ\nã‚’ã¨ã£ãŸçµæœã€ä»®æƒ³ç’°å¢ƒã§ã®æ§‹ç¯‰ã‚’æƒ³å®šã•ã‚Œã¦ã„ã‚‹æ–¹ãŒå¤šæ•°ã ã£ãŸã€‚\u003c/p\u003e\n\u003ch2 id=\"æ§‹æˆã¨ç‰¹å¾´\"\u003eæ§‹æˆã¨ç‰¹å¾´\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eDebian Gnu/Linux ãƒ™ãƒ¼ã‚¹\u003c/li\u003e\n\u003cli\u003eQuagga, StrongSwam ãŒå†…éƒ¨ã§å‹•ä½œ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eapt-get ãªã©é¦´æŸ“ã¿æ·±ã„ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã¾ã™ã€‚\n\u003ca href=\"http://www.vyatta4people.org/tag/vybuddy/\"\u003ehttp://www.vyatta4people.org/tag/vybuddy/\u003c/a\u003e\nã“ã“ã«è‰²ã€…ãƒã‚¦ãƒã‚¦ãŒã‚ã‚‹ã‚‰ã—ã„ã€‚åƒ•ã¯ã¾ã è¦‹ã¦ã„ã¾ã›ã‚“ã€‚ã¾ã»ã‚ã°å·¥æˆ¿ã®è¿‘è—¤ã•ã‚“ã«\næ•™ãˆã¦é ‚ãã¾ã—ãŸã€‚ã‚ã¨ã§ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚\u003c/p\u003e","title":"Vyatta ãƒãƒ³ã‚ºã‚ªãƒ³å‚åŠ ãƒ¬ãƒ #interop2012"},{"content":"Vyatta ã§ VPN ã—ã‚ˆã†ã¨æ€ã£ãŸã‚‰ä¿¡ã˜ã‚‰ã‚Œãªã„ãã‚‰ã„ç°¡å˜ã«æ§‹ç¯‰ã§ããŸã®ã§å…±æœ‰ã—ã¾ã™ã€‚\nä»Šå›ã¯ PPTP (Point-to-Point Tunneling Protocol) ã‚’ç”¨ã„ã¾ã—ãŸã€‚\nã•ã£ããæ‰‹é †ã«ã€‚\n$ configure # set vpn pptp remote-access authentication local-users username ${USER} password ${PASSWORD} # set vpn pptp remote-access authentication mode local # set vpn pptp remote-access client-ip-pool start ${IP_START} # set vpn pptp remote-access client-ip-pool stop ${IP_END} # set vpn pptp remote-access outside-address ${GLOBAL_IP} # set vpn pptp remote-access dns-servers server-1 8.8.8.8 # set vpn pptp remote-access dns-servers server-1 8.8.4.4 # commit # save ã“ã‚Œã ã‘ã§ã™ã€‚\nèªè¨¼ã®ãŸã‚ã®ãƒ¦ãƒ¼ã‚¶ã‚’1è¡Œç›®ã§ä½œã£ã¦ã„ã¾ã™ã€‚client-ip-pool ã§ VPN æ¥ç¶šç«¯æœ«ã«ä»˜ä¸ ã™ã‚‹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ¬ãƒ³ã‚¸ã‚’æŒ‡å®šã—ã¦ outside-address ã§ Listen Port ã‚’æŒ‡å®šã—ã¾ã™ã€‚ DNS ãƒªã‚¾ãƒ«ãƒã«æŒ‡å®šã•ã›ãŸã„ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ dns-servers ã§æŒ‡å®šã—ãŸã‚‰çµ‚ã‚ã‚Šã§ã™ã€‚\nç§ã¯æ‰‹å…ƒã® iPhone ã§è‡ªå®…ã« VPN æ¥ç¶šã—ã¦ä½¿ã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã§ iPhone ã‹ è‡ªå®…å†…ã® æ©Ÿå™¨ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã®ã§ä¾¿åˆ©ã§ã™ã€‚\nã‚ã¨ã€Vyatta ã‚’ã—ã°ã‚‰ãè‡ªå®…ã§ä½¿ã£ã¦ã¿ã¦ã®æ‰€æ„Ÿã§ã™ã€‚\nVyatta ã¯æ±ç”¨æ©Ÿã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã— VM ã¨ã—ã¦ã‚‚å‹•ä½œã•ã›ã‚‰ã‚Œã‚‹ã—ä¾¿åˆ©ã§ã™ã€‚ãŒã€ å®Ÿéš›ã«èµ·å‹•ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ç­‰ã‚’è¦‹ã¦ã„ãã¨ã€Linux ç•Œã§ã¯å¤ãã‹ã‚‰ã‚ã‚‹ãƒ¬ã‚¬ã‚·ãªã‚½ãƒ• ãƒˆã‚¦ã‚§ã‚¢ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã ã‘ã«è¦‹ãˆã¾ã™ã€‚Vyatta ã® UI ã¯ã“ã‚Œã‚‰ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚³ãƒ³ ãƒ•ã‚£ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç°¡æ˜“åŒ–ã™ã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼çš„ãªãƒ¢ãƒã«ãªã£ã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\næ±ç”¨æ€§ãŒã‚ã‚‹ä¸€æ–¹ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯ã‚ã¾ã‚ŠæœŸå¾…å‡ºæ¥ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚å®Ÿéš›ã«ãƒªãƒƒ ãƒãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’é–²è¦§ã—ãŸæ™‚ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯ Buffalo è£½ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒå‘ã‘æ©Ÿå™¨ã« åŠ£ã‚Šã¾ã™ã€‚Linux ãªã®ã§ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã¯å‡ºæ¥ã¾ã™ãŒã€äºˆã‚å¹¾ã¤ã‹ã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã¯å…¥ã£ ã¦ã„ã¾ã™ã—ã€ã‚ãã¾ã§ã‚‚ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãªã®ã§åŠ‡çš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã«ã¯ç¹‹ãŒã‚Šã¾ã› ã‚“ã€‚\nFreeBSD ç³» ? ã§ pfsense ã¨ã„ã† \u0026lsquo;open source firewall distribution\u0026rsquo; ã‚‚ã‚ã‚‹ã‚ˆã† ãªã®ã§ã€ã„ãšã‚Œè©¦ã—ã¦ã¿ãŸã„ã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/06/13/vyatta-vpn/","summary":"\u003cp\u003eVyatta ã§ VPN ã—ã‚ˆã†ã¨æ€ã£ãŸã‚‰ä¿¡ã˜ã‚‰ã‚Œãªã„ãã‚‰ã„ç°¡å˜ã«æ§‹ç¯‰ã§ããŸã®ã§å…±æœ‰ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå›ã¯ PPTP (Point-to-Point Tunneling Protocol) ã‚’ç”¨ã„ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eã•ã£ããæ‰‹é †ã«ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ configure\n# set vpn pptp remote-access authentication local-users username ${USER} password ${PASSWORD}\n# set vpn pptp remote-access authentication mode local\n# set vpn pptp remote-access client-ip-pool start ${IP_START}\n# set vpn pptp remote-access client-ip-pool stop ${IP_END}\n# set vpn pptp remote-access outside-address ${GLOBAL_IP}\n# set vpn pptp remote-access dns-servers server-1 8.8.8.8\n# set vpn pptp remote-access dns-servers server-1 8.8.4.4\n# commit\n# save\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã“ã‚Œã ã‘ã§ã™ã€‚\u003c/p\u003e","title":"Vyatta ã§æ§‹ç¯‰ã™ã‚‹ç°¡å˜ VPN ã‚µãƒ¼ãƒ"},{"content":"æ™®æ®µã¯ Mac, Linux ãŒãƒ¡ã‚¤ãƒ³ãªã®ã§ã™ãŒã€NetBSD ã‚‚ãŸã¾ã«ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—æ©Ÿã¨ã—ã¦åˆ©ç”¨ ã™ã‚‹ã®ã§ã€åˆæœŸè¨­å®šæ‰‹é †ã‚’ã¾ã¨ã‚ã€‚\nConsole è¨­å®š, ã‚­ãƒ¼ãƒªãƒãƒƒãƒ— Caps ã¨ Ctrl ã‚­ãƒ¼ã‚’å…¥ã‚Œæ›¿ãˆã¾ã™ã€‚ãŠç´„æŸã€‚\n# wsconsctl -w encoding=us.swapctrlcaps # vi /etc/wscons.conf # åŒæ§˜ã®è¨­å®šã‚’å…¥ã‚Œã‚‹ ã‚­ãƒ¼ãƒªãƒ”ãƒ¼ãƒˆã‚’é€Ÿãã—ã¾ã™ã€‚æ¨™æº–ã§ã¯é…ã™ãã‚‹ã€‚å€¤ã¯å¥½ã¿ã§ã€‚\n# wsconsctl -w repeat.del1=300 # ãƒªãƒ”ãƒ¼ãƒˆãŒå§‹ã¾ã‚‹ã¾ã§ã®æ™‚é–“ # wsconsctl -w repeat.deln=40 # åå¾©é–“éš” # vi /etc/wscons.conf # åŒæ§˜ã®å€¤ã‚’å…¥ã‚Œã‚‹ pkgsrc ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« xx, y ã¯æ¬¡æœŸã«å¿œã˜ã¦å¤‰ãˆã‚‹ã€‚ä¾‹ :2012Q1\n# cd /usr # cvs -q -z3 -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -r pkgsrc-20xxQy -P pkgsrc æœ€æ–°ã®çŠ¶æ…‹ã«æ›´æ–°ã™ã‚‹å ´åˆã€‚ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°ã‚’åˆ©ç”¨ã—ãŸã„ãªã‚‰ä¸è¦ã€‚\n# cd /usr/pkgsrc # cvs update -dP grub ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« grub ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚‚è‰¯ã„ã®ã ã‘ã©ã€å®‰å¿ƒã—ãŸã„ã‹ã‚‰ã€‚ä»–ã® OS ã¨ãƒ‡ãƒ¥ ã‚¢ãƒ«ãƒ»ãƒˆãƒªãƒ—ãƒ«ãƒ–ãƒ¼ãƒˆã«è¨­å®šã™ã‚‹ã“ã¨ãŒå¤šã„ã®ã§å¿…è¦ã‚’æ„Ÿã˜ã¦å…¥ã‚Œã¦ã„ã‚‹å ´åˆã‚‚ã‚ã‚‹ã€‚ ã‚‚ã¡ã‚ã‚“ Linux å´ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‚ OKã€‚\n# cd /usr/pkgsrc/sysutils/grub # make install # /usr/pkg/sbin/grub-install '(hd0)' # vi /grub/menu.lst # é©å½“ã«è¨­å®š X ã®è¨­å®š # X -configure # cp /root/Xorg.conf.new /etc/X11/xorg.conf ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒãƒãƒ¼ã‚¸ãƒ£ã¯æ™®æ®µã¯ twm ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã§ã€ä½•ã‚‚å…¥ã‚Œãªã„ã€‚\næ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã¨ã—ã¦ efont ã‚’ä½¿ã†ã€‚ã‚¹ã‚°ãƒ¬ãƒ¢ãƒãƒ•ã‚©ãƒ³ãƒˆã€‚\n# cd /usr/pkgsrc/fonts/efont-unicode # make install xorg.conf ã« FontPath ã‚’é€šã™ã€‚\nFontPath \u0026quot;/usr/pkg/lib/XZ11/fonts/efont\u0026quot; urxvt ã¨ zsh ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦ rxvt ã‚’åˆ©ç”¨ã€‚Unicode å¯¾å¿œãª urxvt ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ã™ã‚‹ã€‚zsh ã¯ãƒãƒ«ãƒãƒã‚¤ãƒˆå¯¾å¿œãª zsh-current ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚\n# cd /usr/pkgsrc/shells/zsh-curren # make install # cd /usr/pkgsrc/x11/rxvt-unicode # make install æ—¥æœ¬èªå…¥åŠ›è¨­å®š æ—¥æœ¬èªã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆãƒ¡ã‚½ãƒƒãƒ‰ uim, anthy ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚\n# cd /usr/pkgsrc/inputmethod/uim # make install ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã€‚.zshrc ã§ã‚‚ .xinitrc ã§ã‚‚å¯ã€‚\nexport LANG=ja_JP.UTF-8 export LC_ALL=ja_JP.UTF-8 export LC_CTYPE=ja_JP.UTF-8 export XMODIFIERS=@im=uim export GTK_IM_MODULE=uim exec uim-xim \u0026amp; exec uim-toolbar-gtk * exec /usr/X11R7/bin/twm æ‰€æ„Ÿ æ˜”ã¯ FreeBSD ã‚’ä½¿ã£ã¦ã„ãŸã®ã ã‘ã©ã€Mac, Linux, NetBSD ã ã‘ã«ãªã£ã¦ã—ã¾ã£ãŸã€‚ NetBSD ã¯å®Ÿè£…ãŒç¶ºéº—ãªã®ã§ã‚¹ãƒ¼ãƒƒã¨å…¥ã£ã¦ã„ã‘ã‚‹ã®ã§å¥½ãã€‚ãŸã ã€source ã‹ã‚‰ã®ãƒ“ãƒ« ãƒ‰ã¯æ™‚é–“ãŒæ›ã‹ã‚‹ã®ã§ã€git ã‚„ chef, puppet ç­‰ã®ä»•çµ„ã¿ã‚’åˆ©ç”¨ã—ã¦ãƒ“ãƒ«ãƒ‰ã™ã‚‹æ–¹æ³•ã‚’ ç¢ºç«‹ã—ãŸã„ãªãã¨æœ€è¿‘æ€ã£ã¦ã‚‹ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/05/12/netbsd-first-setup/","summary":"\u003cp\u003eæ™®æ®µã¯ Mac, Linux ãŒãƒ¡ã‚¤ãƒ³ãªã®ã§ã™ãŒã€NetBSD ã‚‚ãŸã¾ã«ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—æ©Ÿã¨ã—ã¦åˆ©ç”¨\nã™ã‚‹ã®ã§ã€åˆæœŸè¨­å®šæ‰‹é †ã‚’ã¾ã¨ã‚ã€‚\u003c/p\u003e\n\u003ch2 id=\"console-è¨­å®š-ã‚­ãƒ¼ãƒªãƒãƒƒãƒ—\"\u003eConsole è¨­å®š, ã‚­ãƒ¼ãƒªãƒãƒƒãƒ—\u003c/h2\u003e\n\u003cp\u003eCaps ã¨ Ctrl ã‚­ãƒ¼ã‚’å…¥ã‚Œæ›¿ãˆã¾ã™ã€‚ãŠç´„æŸã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# wsconsctl -w encoding=us.swapctrlcaps\n# vi /etc/wscons.conf # åŒæ§˜ã®è¨­å®šã‚’å…¥ã‚Œã‚‹\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã‚­ãƒ¼ãƒªãƒ”ãƒ¼ãƒˆã‚’é€Ÿãã—ã¾ã™ã€‚æ¨™æº–ã§ã¯é…ã™ãã‚‹ã€‚å€¤ã¯å¥½ã¿ã§ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# wsconsctl -w repeat.del1=300 # ãƒªãƒ”ãƒ¼ãƒˆãŒå§‹ã¾ã‚‹ã¾ã§ã®æ™‚é–“\n# wsconsctl -w repeat.deln=40  # åå¾©é–“éš”\n# vi /etc/wscons.conf          # åŒæ§˜ã®å€¤ã‚’å…¥ã‚Œã‚‹\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"pkgsrc-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003epkgsrc ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003exx, y ã¯æ¬¡æœŸã«å¿œã˜ã¦å¤‰ãˆã‚‹ã€‚ä¾‹ :2012Q1\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# cd /usr\n# cvs -q -z3 -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -r pkgsrc-20xxQy -P pkgsrc\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eæœ€æ–°ã®çŠ¶æ…‹ã«æ›´æ–°ã™ã‚‹å ´åˆã€‚ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°ã‚’åˆ©ç”¨ã—ãŸã„ãªã‚‰ä¸è¦ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# cd /usr/pkgsrc\n# cvs update -dP\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"grub-ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003egrub ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h2\u003e\n\u003cp\u003egrub ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚‚è‰¯ã„ã®ã ã‘ã©ã€å®‰å¿ƒã—ãŸã„ã‹ã‚‰ã€‚ä»–ã® OS ã¨ãƒ‡ãƒ¥\nã‚¢ãƒ«ãƒ»ãƒˆãƒªãƒ—ãƒ«ãƒ–ãƒ¼ãƒˆã«è¨­å®šã™ã‚‹ã“ã¨ãŒå¤šã„ã®ã§å¿…è¦ã‚’æ„Ÿã˜ã¦å…¥ã‚Œã¦ã„ã‚‹å ´åˆã‚‚ã‚ã‚‹ã€‚\nã‚‚ã¡ã‚ã‚“ Linux å´ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‚ OKã€‚\u003c/p\u003e","title":"NetBSD ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç›´å¾Œã®åˆæœŸè¨­å®šã¾ã¨ã‚"},{"content":"Hacker News ã§å–ã‚Šä¸Šã’ã‚‰ã‚Œã¦ã„ãŸ emacs-nav ã‚’ä½¿ã£ã¦ã¿ãŸã€‚\nhttp://code.google.com/p/emacs-nav/\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯ç°¡å˜ã§\n% wget http://emacs-nav.googlecode.com/files/emacs-nav-20110220a.tar.gz % tar zxvf emacs-nav-20110220a.tar.gz % mv emacs-nav-20110220a ~/.emacs.d/emacs-nav ã—ã¦\n;; emacs-nav (add-to-list 'load-path \u0026quot;~/.emacs.d/emacs-nav/\u0026quot;) (require 'nav) ã™ã‚‹ã ã‘ã€‚\nè¦‹ãŸç›®ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚\nèµ·å‹•ã¯ M-x nav ã¨å…¥åŠ›ã€‚ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å·¦ã«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ã„ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ å‡ºæ¥ã‚‹ã€‚ã“ã‚Œã ã‘ã ã¨ã€ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆã‚’æ„Ÿã˜ãªã„ãŒã€é¢ç™½ã„ã®ãŒãƒã‚¦ã‚¹ã§é¸æŠå‡ºæ¥ã‚‹ã¨ ã“ã‚ã€‚TextMate ã®ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚ˆã†ãªæ„Ÿã˜ã ã€‚\nä»Šã ã¨ anything.el ãŒä¾¿åˆ©ã™ãã¦ã€ã“ã¡ã‚‰ã‚’åˆ©ç”¨ã™ã‚‹ä¾¡å€¤ã‚’è¦‹å‡ºã›ã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ã‘ ã©ã€æš«ãä½¿ã£ã¦ã¿ã‚ˆã†ã¨æ€ã†ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/05/04/emacs-nav/","summary":"\u003cp\u003eHacker News ã§å–ã‚Šä¸Šã’ã‚‰ã‚Œã¦ã„ãŸ emacs-nav ã‚’ä½¿ã£ã¦ã¿ãŸã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://code.google.com/p/emacs-nav/\"\u003ehttp://code.google.com/p/emacs-nav/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯ç°¡å˜ã§\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% wget http://emacs-nav.googlecode.com/files/emacs-nav-20110220a.tar.gz\n% tar zxvf emacs-nav-20110220a.tar.gz\n% mv emacs-nav-20110220a ~/.emacs.d/emacs-nav\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã—ã¦\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e;; emacs-nav\n(add-to-list 'load-path \u0026quot;~/.emacs.d/emacs-nav/\u0026quot;)\n(require 'nav)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã™ã‚‹ã ã‘ã€‚\u003c/p\u003e\n\u003cp\u003eè¦‹ãŸç›®ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚\u003c/p\u003e\n\u003cimg src=\"http://jedipunkz.github.com/pix/emacs-nav.png\"\u003e\n\u003cp\u003eèµ·å‹•ã¯ M-x nav ã¨å…¥åŠ›ã€‚ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å·¦ã«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ã„ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ\nå‡ºæ¥ã‚‹ã€‚ã“ã‚Œã ã‘ã ã¨ã€ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆã‚’æ„Ÿã˜ãªã„ãŒã€é¢ç™½ã„ã®ãŒãƒã‚¦ã‚¹ã§é¸æŠå‡ºæ¥ã‚‹ã¨\nã“ã‚ã€‚TextMate ã®ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚ˆã†ãªæ„Ÿã˜ã ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šã ã¨ anything.el ãŒä¾¿åˆ©ã™ãã¦ã€ã“ã¡ã‚‰ã‚’åˆ©ç”¨ã™ã‚‹ä¾¡å€¤ã‚’è¦‹å‡ºã›ã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ã‘\nã©ã€æš«ãä½¿ã£ã¦ã¿ã‚ˆã†ã¨æ€ã†ã€‚\u003c/p\u003e","title":"Emacs ã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶ emacs-nav ã‚’åˆ©ç”¨"},{"content":"http://www.emacswiki.org/emacs-en/PowerLine\nvim ã® powerline ã«ä¼¼ãŸãƒ¢ãƒ¼ãƒ‰ã‚’ emacs ã§å®Ÿç¾ã§ãã‚‹ powerline.el ã‚’è©¦ã—ã¦ã¿ãŸã€‚ è¦‹ãŸç›®ãŒæ´¾æ‰‹ã§ã‹ã‚ã„ããªã‚‹ã®ã§ã€æ°—ã«å…¥ã£ãŸã€‚w ã™ã§ã«ä¸‹è¨˜ã®ã‚ˆã†ãªã‚µã‚¤ãƒˆã§ç´¹ä»‹ã• ã‚Œã¤ã¤ã‚ã‚‹ã€‚\nhttp://d.hatena.ne.jp/kenjiskywalker/20120502/1335922233 http://n8.hatenablog.com/entry/2012/03/21/172928\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨è¦‹ãŸç›®ã¯ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã€‚\nã†ã‚“ã€ã‹ã‚ã„ã„ã€‚\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯ç°¡å˜ã€‚auto-install ç’°å¢ƒãŒæ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹ã¨ã—ã¦\nauto-install-from-emacs-wiki powerline.el ã™ã‚‹ã€‚auto-install ãŒå…¥ã£ã¦ã„ãªã‘ã‚Œã° http://www.emacswiki.org/emacs/powerline.el ã“ã“ã«ã‚ã‚‹ powerline.el ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ ~/.emacs.d/lisp/ é…ä¸‹ãªã© path ã®é€šã£ ã¦ã„ã‚‹æ‰€ã«å…¥ã‚Œã‚Œã° OKã€‚\nã‚ã¨ã¯ .emacs å†…ã«ã¯ä¸‹è¨˜ã‚’è¿½è¨˜ã™ã‚‹ã ã‘ã ã€‚\n;; powerline.el (defun arrow-right-xpm (color1 color2) \u0026quot;Return an XPM right arrow string representing.\u0026quot; (format \u0026quot;/* XPM */ static char * arrow_right[] = { \\\u0026quot;12 18 2 1\\\u0026quot;, \\\u0026quot;. c %s\\\u0026quot;, \\\u0026quot; c %s\\\u0026quot;, \\\u0026quot;. \\\u0026quot;, \\\u0026quot;.. \\\u0026quot;, \\\u0026quot;... \\\u0026quot;, \\\u0026quot;.... \\\u0026quot;, \\\u0026quot;..... \\\u0026quot;, \\\u0026quot;...... \\\u0026quot;, \\\u0026quot;....... \\\u0026quot;, \\\u0026quot;........ \\\u0026quot;, \\\u0026quot;......... \\\u0026quot;, \\\u0026quot;......... \\\u0026quot;, \\\u0026quot;........ \\\u0026quot;, \\\u0026quot;....... \\\u0026quot;, \\\u0026quot;...... \\\u0026quot;, \\\u0026quot;..... \\\u0026quot;, \\\u0026quot;.... \\\u0026quot;, \\\u0026quot;... \\\u0026quot;, \\\u0026quot;.. \\\u0026quot;, \\\u0026quot;. \\\u0026quot;};\u0026quot; color1 color2)) (defun arrow-left-xpm (color1 color2) \u0026quot;Return an XPM right arrow string representing.\u0026quot; (format \u0026quot;/* XPM */ static char * arrow_right[] = { \\\u0026quot;12 18 2 1\\\u0026quot;, \\\u0026quot;. c %s\\\u0026quot;, \\\u0026quot; c %s\\\u0026quot;, \\\u0026quot; .\\\u0026quot;, \\\u0026quot; ..\\\u0026quot;, \\\u0026quot; ...\\\u0026quot;, \\\u0026quot; ....\\\u0026quot;, \\\u0026quot; .....\\\u0026quot;, \\\u0026quot; ......\\\u0026quot;, \\\u0026quot; .......\\\u0026quot;, \\\u0026quot; ........\\\u0026quot;, \\\u0026quot; .........\\\u0026quot;, \\\u0026quot; .........\\\u0026quot;, \\\u0026quot; ........\\\u0026quot;, \\\u0026quot; .......\\\u0026quot;, \\\u0026quot; ......\\\u0026quot;, \\\u0026quot; .....\\\u0026quot;, \\\u0026quot; ....\\\u0026quot;, \\\u0026quot; ...\\\u0026quot;, \\\u0026quot; ..\\\u0026quot;, \\\u0026quot; .\\\u0026quot;};\u0026quot; color2 color1)) (defconst color1 \u0026quot;#FF6699\u0026quot;) (defconst color3 \u0026quot;#CDC0B0\u0026quot;) (defconst color2 \u0026quot;#FF0066\u0026quot;) (defconst color4 \u0026quot;#CDC0B0\u0026quot;) (defvar arrow-right-1 (create-image (arrow-right-xpm color1 color2) 'xpm t :ascent 'center)) (defvar arrow-right-2 (create-image (arrow-right-xpm color2 \u0026quot;None\u0026quot;) 'xpm t :ascent 'center)) (defvar arrow-left-1 (create-image (arrow-left-xpm color2 color1) 'xpm t :ascent 'center)) (defvar arrow-left-2 (create-image (arrow-left-xpm \u0026quot;None\u0026quot; color2) 'xpm t :ascent 'center)) (setq-default mode-line-format (list '(:eval (concat (propertize \u0026quot; %b \u0026quot; 'face 'mode-line-color-1) (propertize \u0026quot; \u0026quot; 'display arrow-right-1))) '(:eval (concat (propertize \u0026quot; %m \u0026quot; 'face 'mode-line-color-2) (propertize \u0026quot; \u0026quot; 'display arrow-right-2))) ;; Justify right by filling with spaces to right fringe - 16 ;; (16 should be computed rahter than hardcoded) '(:eval (propertize \u0026quot; \u0026quot; 'display '((space :align-to (- right-fringe 17))))) '(:eval (concat (propertize \u0026quot; \u0026quot; 'display arrow-left-2) (propertize \u0026quot; %p \u0026quot; 'face 'mode-line-color-2))) '(:eval (concat (propertize \u0026quot; \u0026quot; 'display arrow-left-1) (propertize \u0026quot;%4l:%2c \u0026quot; 'face 'mode-line-color-1))) )) (make-face 'mode-line-color-1) (set-face-attribute 'mode-line-color-1 nil :foreground \u0026quot;#fff\u0026quot; :background color1) (make-face 'mode-line-color-2) (set-face-attribute 'mode-line-color-2 nil :foreground \u0026quot;#fff\u0026quot; :background color2) (set-face-attribute 'mode-line nil :foreground \u0026quot;#fff\u0026quot; :background color3 :box nil) (set-face-attribute 'mode-line-inactive nil :foreground \u0026quot;#fff\u0026quot; :background color4) è‰²ã‚’å°‘ã—å¤‰ãˆãŸã ã‘ã§ã€ã»ã¼ emacswiki ã«è¼‰ã£ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ã ã€‚no window ã ã¨å¯‚ã—ã„ã“ã¨ã«ãªã‚‹ãŒã€ã¾ãä»•æ–¹ãªã„ã€‚vim ã§ã‚‚ powerline ã‚’ä½¿ã£ã¦æ°—ã«å…¥ã£ã¦ã„ ãŸã®ã§ emacs ã§ã‚‚ä½¿ãˆã‚‹ã¨ã‚ã£ã¦å¬‰ã—ã„é™ã‚Šã ã€‚ã“ã‚Œã‹ã‚‰å°‘ã—ãšã¤ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ ã„ã“ã†ã¨æ€ã†ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/05/04/powerline.el-emacs/","summary":"\u003cp\u003e\u003ca href=\"http://www.emacswiki.org/emacs-en/PowerLine\"\u003ehttp://www.emacswiki.org/emacs-en/PowerLine\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003evim ã® powerline ã«ä¼¼ãŸãƒ¢ãƒ¼ãƒ‰ã‚’ emacs ã§å®Ÿç¾ã§ãã‚‹ powerline.el ã‚’è©¦ã—ã¦ã¿ãŸã€‚\nè¦‹ãŸç›®ãŒæ´¾æ‰‹ã§ã‹ã‚ã„ããªã‚‹ã®ã§ã€æ°—ã«å…¥ã£ãŸã€‚w ã™ã§ã«ä¸‹è¨˜ã®ã‚ˆã†ãªã‚µã‚¤ãƒˆã§ç´¹ä»‹ã•\nã‚Œã¤ã¤ã‚ã‚‹ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://d.hatena.ne.jp/kenjiskywalker/20120502/1335922233\"\u003ehttp://d.hatena.ne.jp/kenjiskywalker/20120502/1335922233\u003c/a\u003e\n\u003ca href=\"http://n8.hatenablog.com/entry/2012/03/21/172928\"\u003ehttp://n8.hatenablog.com/entry/2012/03/21/172928\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨è¦‹ãŸç›®ã¯ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã€‚\u003c/p\u003e\n\u003cimg src=\"http://jedipunkz.github.com/pix/powerline.png\"\u003e\n\u003cp\u003eã†ã‚“ã€ã‹ã‚ã„ã„ã€‚\u003c/p\u003e\n\u003cp\u003eã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯ç°¡å˜ã€‚auto-install ç’°å¢ƒãŒæ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹ã¨ã—ã¦\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eauto-install-from-emacs-wiki powerline.el\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã™ã‚‹ã€‚auto-install ãŒå…¥ã£ã¦ã„ãªã‘ã‚Œã°\n\u003ca href=\"http://www.emacswiki.org/emacs/powerline.el\"\u003ehttp://www.emacswiki.org/emacs/powerline.el\u003c/a\u003e\nã“ã“ã«ã‚ã‚‹ powerline.el ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ ~/.emacs.d/lisp/ é…ä¸‹ãªã© path ã®é€šã£\nã¦ã„ã‚‹æ‰€ã«å…¥ã‚Œã‚Œã° OKã€‚\u003c/p\u003e\n\u003cp\u003eã‚ã¨ã¯ .emacs å†…ã«ã¯ä¸‹è¨˜ã‚’è¿½è¨˜ã™ã‚‹ã ã‘ã ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e;; powerline.el\n(defun arrow-right-xpm (color1 color2)\n  \u0026quot;Return an XPM right arrow string representing.\u0026quot;\n  (format \u0026quot;/* XPM */\nstatic char * arrow_right[] = {\n\\\u0026quot;12 18 2 1\\\u0026quot;,\n\\\u0026quot;. c %s\\\u0026quot;,\n\\\u0026quot;  c %s\\\u0026quot;,\n\\\u0026quot;.           \\\u0026quot;,\n\\\u0026quot;..          \\\u0026quot;,\n\\\u0026quot;...         \\\u0026quot;,\n\\\u0026quot;....        \\\u0026quot;,\n\\\u0026quot;.....       \\\u0026quot;,\n\\\u0026quot;......      \\\u0026quot;,\n\\\u0026quot;.......     \\\u0026quot;,\n\\\u0026quot;........    \\\u0026quot;,\n\\\u0026quot;.........   \\\u0026quot;,\n\\\u0026quot;.........   \\\u0026quot;,\n\\\u0026quot;........    \\\u0026quot;,\n\\\u0026quot;.......     \\\u0026quot;,\n\\\u0026quot;......      \\\u0026quot;,\n\\\u0026quot;.....       \\\u0026quot;,\n\\\u0026quot;....        \\\u0026quot;,\n\\\u0026quot;...         \\\u0026quot;,\n\\\u0026quot;..          \\\u0026quot;,\n\\\u0026quot;.           \\\u0026quot;};\u0026quot;  color1 color2))\n\n(defun arrow-left-xpm (color1 color2)\n  \u0026quot;Return an XPM right arrow string representing.\u0026quot;\n  (format \u0026quot;/* XPM */\nstatic char * arrow_right[] = {\n\\\u0026quot;12 18 2 1\\\u0026quot;,\n\\\u0026quot;. c %s\\\u0026quot;,\n\\\u0026quot;  c %s\\\u0026quot;,\n\\\u0026quot;           .\\\u0026quot;,\n\\\u0026quot;          ..\\\u0026quot;,\n\\\u0026quot;         ...\\\u0026quot;,\n\\\u0026quot;        ....\\\u0026quot;,\n\\\u0026quot;       .....\\\u0026quot;,\n\\\u0026quot;      ......\\\u0026quot;,\n\\\u0026quot;     .......\\\u0026quot;,\n\\\u0026quot;    ........\\\u0026quot;,\n\\\u0026quot;   .........\\\u0026quot;,\n\\\u0026quot;   .........\\\u0026quot;,\n\\\u0026quot;    ........\\\u0026quot;,\n\\\u0026quot;     .......\\\u0026quot;,\n\\\u0026quot;      ......\\\u0026quot;,\n\\\u0026quot;       .....\\\u0026quot;,\n\\\u0026quot;        ....\\\u0026quot;,\n\\\u0026quot;         ...\\\u0026quot;,\n\\\u0026quot;          ..\\\u0026quot;,\n\\\u0026quot;           .\\\u0026quot;};\u0026quot;  color2 color1))\n\n\n(defconst color1 \u0026quot;#FF6699\u0026quot;)\n(defconst color3 \u0026quot;#CDC0B0\u0026quot;)\n(defconst color2 \u0026quot;#FF0066\u0026quot;)\n(defconst color4 \u0026quot;#CDC0B0\u0026quot;)\n\n(defvar arrow-right-1 (create-image (arrow-right-xpm color1 color2) 'xpm t :ascent 'center))\n(defvar arrow-right-2 (create-image (arrow-right-xpm color2 \u0026quot;None\u0026quot;) 'xpm t :ascent 'center))\n(defvar arrow-left-1  (create-image (arrow-left-xpm color2 color1) 'xpm t :ascent 'center))\n(defvar arrow-left-2  (create-image (arrow-left-xpm \u0026quot;None\u0026quot; color2) 'xpm t :ascent 'center))\n\n(setq-default mode-line-format\n (list  '(:eval (concat (propertize \u0026quot; %b \u0026quot; 'face 'mode-line-color-1)\n                        (propertize \u0026quot; \u0026quot; 'display arrow-right-1)))\n        '(:eval (concat (propertize \u0026quot; %m \u0026quot; 'face 'mode-line-color-2)\n                        (propertize \u0026quot; \u0026quot; 'display arrow-right-2)))\n\n        ;; Justify right by filling with spaces to right fringe - 16\n        ;; (16 should be computed rahter than hardcoded)\n        '(:eval (propertize \u0026quot; \u0026quot; 'display '((space :align-to (- right-fringe 17)))))\n\n        '(:eval (concat (propertize \u0026quot; \u0026quot; 'display arrow-left-2)\n                        (propertize \u0026quot; %p \u0026quot; 'face 'mode-line-color-2)))\n        '(:eval (concat (propertize \u0026quot; \u0026quot; 'display arrow-left-1)\n                        (propertize \u0026quot;%4l:%2c  \u0026quot; 'face 'mode-line-color-1)))\n)) \n\n(make-face 'mode-line-color-1)\n(set-face-attribute 'mode-line-color-1 nil\n                    :foreground \u0026quot;#fff\u0026quot;\n                    :background color1)\n\n(make-face 'mode-line-color-2)\n(set-face-attribute 'mode-line-color-2 nil\n                    :foreground \u0026quot;#fff\u0026quot;\n                    :background color2)\n\n(set-face-attribute 'mode-line nil\n                    :foreground \u0026quot;#fff\u0026quot;\n                    :background color3\n                    :box nil)\n(set-face-attribute 'mode-line-inactive nil\n                    :foreground \u0026quot;#fff\u0026quot;\n                    :background color4)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eè‰²ã‚’å°‘ã—å¤‰ãˆãŸã ã‘ã§ã€ã»ã¼ emacswiki ã«è¼‰ã£ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ã ã€‚no window\nã ã¨å¯‚ã—ã„ã“ã¨ã«ãªã‚‹ãŒã€ã¾ãä»•æ–¹ãªã„ã€‚vim ã§ã‚‚ powerline ã‚’ä½¿ã£ã¦æ°—ã«å…¥ã£ã¦ã„\nãŸã®ã§ emacs ã§ã‚‚ä½¿ãˆã‚‹ã¨ã‚ã£ã¦å¬‰ã—ã„é™ã‚Šã ã€‚ã“ã‚Œã‹ã‚‰å°‘ã—ãšã¤ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦\nã„ã“ã†ã¨æ€ã†ã€‚\u003c/p\u003e","title":"powerline.el ã§ emacs ãƒ¢ãƒ¼ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’æ´¾æ‰‹ã«"},{"content":"è‡ªå®…ãƒ«ãƒ¼ã‚¿ã‚’ Vyatta ã§é‹ç”¨é–‹å§‹ã—ãŸã®ã ã‘ã©ã€ç„¡ç·šãƒ«ãƒ¼ã‚¿åŒ–ãŒã§ããŸã®ã§ãƒ¡ãƒ¢ã—ã¦ãŠã ã¾ã™ã€‚\nã¾ãšã¯ã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ç¨¼åƒã™ã‚‹ç„¡ç·šã‚«ãƒ¼ãƒ‰ã®é¸å®šã€‚ä¸‹è¨˜ã® URL ã« Linux ç³»ã§ å‹•ä½œã™ã‚‹ç„¡ç·šã‚«ãƒ¼ãƒ‰ãƒãƒƒãƒ—åã®ä¸€è¦§ãŒè¼‰ã£ã¦ã„ã‚‹ã€‚Vyatta ã¯ Linux ç³»ãƒ‰ãƒ©ã‚¤ãƒã‚’åˆ©ç”¨ ã—ã¦ã„ã‚‹ã®ã§ã€ã“ã®ä¸€è¦§ãŒæœ‰åŠ¹ãªã¯ãšã ã€‚\nhttp://linuxwireless.org/en/users/Drivers\nIntel ç³»ã‚‚çµæ§‹ã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ã¯å‹•ä½œã—ãªã„ã“ã¨ãŒåˆ¤ã£ãŸã®ã§ Atheros ã® AR9k ã®ã‚«ãƒ¼ãƒ‰ã‚’è³¼å…¥ã—ãŸã€‚ç§ãŒè²·ã£ãŸã®ã¯AR9280 ãƒãƒƒãƒ—ã® mini PCI-E ç„¡ç·šã‚«ãƒ¼ãƒ‰ã€‚\næ—©é€Ÿè£…ç€ã—ã¦ã¿ã‚‹ã¨ã€èªè­˜ã—ãŸï¼\n% dmesg | grep ath [ 11.528390] ath9k 0000:01:00.0: PCI INT A -\u0026gt; GSI 16 (level, low) -\u0026gt; IRQ 16 [ 11.528398] ath9k 0000:01:00.0: setting latency timer to 64 [ 11.961619] ath: EEPROM regdomain: 0x37 [ 11.961620] ath: EEPROM indicates we should expect a direct regpair map [ 11.961622] ath: Country alpha2 being used: AW [ 11.961623] ath: Regpair used: 0x37 [ 12.031676] ieee80211 phy0: Selected rate control algorithm 'ath9k_rate_control' æ—©é€Ÿè¨­å®šã«å…¥ã‚‹ã€‚æœ‰ç·šå´æœ‰ç·š NIC ã¨ç„¡ç·š NIC ã‚’ãƒ–ãƒªãƒƒã‚¸æ¥ç¶šã™ã‚‹ã€‚br0 ãƒ‡ãƒã‚¤ã‚¹ã«ã® ã¿ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ¯ã‚Šã€eth1, wlan0 ã¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ¯ã‚‰ãªã„æ§‹æˆã«ã™ã‚‹ã€‚\nã¾ãšã¯ãƒ–ãƒªãƒƒã‚¸ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½œã‚‹ã€‚\nset interfaces bridge br0 address ${IP_ADDRESS} set interfaces bridge br0 description LOCAL_NET eth1 (ãƒ­ãƒ¼ã‚«ãƒ«å´æœ‰ç·š NIC) ã‚’ãƒ–ãƒªãƒƒã‚¸ br0 ã«å«ã‚ã‚‹ã€‚\nset interfaces ethernet eth1 bridge-group bridge br0 set interfaces ethernet eth1 description LOCAL_NET wlan0 ã®è¨­å®šã€‚åŒã˜ã br0 ã«å«ã‚ã¦ã€è«¸ã€…ã®è¨­å®šã‚’æŠ•å…¥ã€‚\nset interfaces wireless wlan0 bridge-group bridge br0 set interfaces wireless wlan0 channel 2 set interfaces wireless wlan0 description LOCAL_NET set interfaces wireless wlan0 mode n set interfaces wireless wlan0 security wpa mode wpa2 set interfaces wireless wlan0 security wpa passphrase ${PASS} set interfaces wireless wlan0 ssid ${SSID} set interfaces wireless wlan0 type access-point commit save ${IP_ADDRESS}, ${SSID}, ${PASS} ã¯ä»»æ„ã§ã™ã€‚èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚\nã“ã“ã§ã‚³ãƒ„ã€‚ã“ã‚Œã‚‰ã®è¨­å®šã‚’ã—ã¦ commit ã—ã¦ã‚‚ã†ã¾ãç„¡ç·šæ¥ç¶šå‡ºæ¥ãªã‹ã£ãŸã€‚vyatta ã‚’å†èµ·å‹•ã•ã›ã‚‹ (äºˆã‚ save ã™ã‚‹ã“ã¨) ã¨ã€ç„¡ç·šæ¥ç¶šãŒã§ããŸã€‚\nè³¼å…¥ã—ãŸç„¡ç·šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ mini PCE-I Atherosã€€AR5BXB92 (AR9280 ãƒãƒƒãƒ—)ã€ PCI-E ã«å¤‰æ›ã™ã‚‹ã‚«ãƒ¼ãƒ‰ ã€ã‚ã¨ãƒãƒƒãƒ•ã‚¡ãƒ­ãƒ¼ã®ã‚¢ãƒ³ãƒ†ãƒŠã ã€‚\nä»Šã®ã¨ã“ã‚åˆ©ç”¨ã§ãã¦ã„ã‚‹ãŒã€ç„¡ç·šã®å¼·åº¦ãŒå°‘ã—å¼±ã„æ°—ãŒã™ã‚‹ã€‚ã“ã‚Œã‹ã‚‰å°‘ã—èª¿ã¹ã¦ã¿ ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/05/04/vyatta-wireless-ap/","summary":"\u003cp\u003eè‡ªå®…ãƒ«ãƒ¼ã‚¿ã‚’ Vyatta ã§é‹ç”¨é–‹å§‹ã—ãŸã®ã ã‘ã©ã€ç„¡ç·šãƒ«ãƒ¼ã‚¿åŒ–ãŒã§ããŸã®ã§ãƒ¡ãƒ¢ã—ã¦ãŠã\nã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãšã¯ã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ç¨¼åƒã™ã‚‹ç„¡ç·šã‚«ãƒ¼ãƒ‰ã®é¸å®šã€‚ä¸‹è¨˜ã® URL ã« Linux ç³»ã§\nå‹•ä½œã™ã‚‹ç„¡ç·šã‚«ãƒ¼ãƒ‰ãƒãƒƒãƒ—åã®ä¸€è¦§ãŒè¼‰ã£ã¦ã„ã‚‹ã€‚Vyatta ã¯ Linux ç³»ãƒ‰ãƒ©ã‚¤ãƒã‚’åˆ©ç”¨\nã—ã¦ã„ã‚‹ã®ã§ã€ã“ã®ä¸€è¦§ãŒæœ‰åŠ¹ãªã¯ãšã ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://linuxwireless.org/en/users/Drivers\"\u003ehttp://linuxwireless.org/en/users/Drivers\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIntel ç³»ã‚‚çµæ§‹ã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ã¯å‹•ä½œã—ãªã„ã“ã¨ãŒåˆ¤ã£ãŸã®ã§ Atheros ã®\nAR9k ã®ã‚«ãƒ¼ãƒ‰ã‚’è³¼å…¥ã—ãŸã€‚ç§ãŒè²·ã£ãŸã®ã¯AR9280 ãƒãƒƒãƒ—ã® mini PCI-E ç„¡ç·šã‚«ãƒ¼ãƒ‰ã€‚\u003c/p\u003e\n\u003cp\u003eæ—©é€Ÿè£…ç€ã—ã¦ã¿ã‚‹ã¨ã€èªè­˜ã—ãŸï¼\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% dmesg | grep ath\n[   11.528390] ath9k 0000:01:00.0: PCI INT A -\u0026gt; GSI 16 (level, low) -\u0026gt; IRQ\n16\n[   11.528398] ath9k 0000:01:00.0: setting latency timer to 64\n[   11.961619] ath: EEPROM regdomain: 0x37\n[   11.961620] ath: EEPROM indicates we should expect a direct regpair map\n[   11.961622] ath: Country alpha2 being used: AW\n[   11.961623] ath: Regpair used: 0x37\n[   12.031676] ieee80211 phy0: Selected rate control algorithm 'ath9k_rate_control'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eæ—©é€Ÿè¨­å®šã«å…¥ã‚‹ã€‚æœ‰ç·šå´æœ‰ç·š NIC ã¨ç„¡ç·š NIC ã‚’ãƒ–ãƒªãƒƒã‚¸æ¥ç¶šã™ã‚‹ã€‚br0 ãƒ‡ãƒã‚¤ã‚¹ã«ã®\nã¿ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ¯ã‚Šã€eth1, wlan0 ã¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ¯ã‚‰ãªã„æ§‹æˆã«ã™ã‚‹ã€‚\u003c/p\u003e","title":"Vyatta ã§ç„¡ç·šã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆ"},{"content":"Vyatta ã‚’è‡ªå®…ãƒ«ãƒ¼ã‚¿ã§ä½¿ã„å§‹ã‚ã¦æ„Ÿã˜ãŸã®ã¯ã€PS3 ãªã©ã®ã‚²ãƒ¼ãƒ æ©Ÿã‚„ IP é›»è©±ãªã© UPnP æ¥ç¶šãŒå¿…è¦ãªã“ã¨ãŒã‚ã‚‹ã£ã¦ã“ã¨ã€‚ãŸã  Vyatta ã¯ UPnP ã«å¯¾å¿œã—ã¦ã„ãªã„ã®ã§ã€ ã©ã†ã—ã‚ˆã†ã‹ã¨æ€ã£ã¦ã„ãŸã‚‰ã€æœ‰å¿—ã®æ–¹ãŒä½œã£ã¦ãã‚ŒãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒã‚ã‚Šã€ã†ã¡ã§ã‚‚ ã“ã‚Œã‚’ä½¿ã†ã“ã¨ã«ã—ãŸã€‚ä»Šå›ã¯ãã®æ–¹æ³•ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\nhttps://github.com/kiall/vyatta-upnp\nä¸Šè¨˜ã®ã‚½ãƒ¼ã‚¹ã‚’å–å¾—ã—ã¦ç”Ÿæˆã™ã‚‹ã®ã ãŒã€vyatta ä¸Šã§æ§‹ç¯‰ã™ã‚‹ç’°å¢ƒã‚’ä½œã‚ŠãŸããªã„ã® ã§ã€ç§ã¯ Debian Gnu/Linux ãƒã‚·ãƒ³ä¸Šã§è¡Œã„ã¾ã—ãŸã€‚Ubuntu ã§ã‚‚å¤§ä¸ˆå¤«ã ã¨æ€ã„ã¾ã™ã€‚\ndebian% sudo apt-get \u0026amp;\u0026amp; sudo apt-get install build-essential debian% git clone https://github.com/kiall/vyatta-upnp.git debian% cd vyatta-upnp debian% dpkg-buildpackage -us -uc -d ä¸€ã¤ä¸Šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« vyatta-upnp_0.2_all.deb ã¨ã„ã† .deb ãƒ•ã‚¡ã‚¤ãƒ«ãŒã§ãã‚ãŒã£ ã¦ã„ã‚‹ã¯ãšã§ã€ã“ã‚ŒãŒ UPnP ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ« vyatta-upnp_0.2_all.deb ã§ã™ã€‚\næ¬¡ã« vyatta ä¸Šã§ã®ä½œæ¥­ã€‚packages.vyatta.com ã‹ã‚‰ libupnp4 ã¨ linux-igd ã‚’å–å¾—ã€ ãã®å¾Œå…ˆã»ã©ç”Ÿæˆã—ãŸ vyatta-upnp_0.2_all.deb ã‚’ vyatta ä¸Šã«æŒã£ã¦ãã¦ã‹ã‚‰ã‚¤ãƒ³ ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\nvyatta# cd /tmp/ vyatta# wget http://packages.vyatta.com/debian/pool/main/libu/libupnp4/libupnp4_1.8.0~svn20100507-1_amd64.deb vyatta# wget http://packages.vyatta.com/debian/pool/main/l/linux-igd/linux-igd_1.0+cvs20070630-3_amd64.deb vyatta# scp ${DEBIAN}:/${SOMEWHERE}/vyatta-upnp_0.2_all.deb . # å…ˆã»ã©ç”Ÿæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ« vyatta# dpkg -i libupnp4_1.8.0~svn20100507-1_amd64.deb linux-igd_1.0+cvs20070630-3_amd64.deb vyatta# dpkg -i vyatta-upnp_0.2_all.deb ã“ã‚Œã§è¨­å®šãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚è¨­å®šã—ã¦ã¿ã¾ã™ã€‚\nvyatta# configure vyatta# set service upnp listen-on eth1 vyatta# commit vyatta# save ã“ã‚Œã§å®Œäº†ã§ã™ã€‚eth1 ã¯ è‡ªå®…ç’°å¢ƒã«åˆã‚ã›ã¦ä¸‹ã•ã„ã€‚ãƒ«ãƒ¼ã‚¿ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå´ã‚¤ãƒ³ã‚¿ãƒ¼ ãƒ•ã‚§ãƒ¼ã‚¹åã§ã™ã€‚ç§ã®å®¶ã¯ wlan0 ã¨ eth1 ã‚’ãƒ–ãƒªãƒƒã‚¸ã—ã¦ã„ã‚‹ã®ã§ listen-on br0 ã« ã—ã¾ã—ãŸã€‚\nç§ã®ç’°å¢ƒã§ã¯ PS3 ã® \u0026ldquo;ã‚¢ãƒ³ãƒãƒ£ãƒ¼ãƒ†ãƒƒãƒ‰3\u0026rdquo; ã§å‹•ä½œç¢ºèªã—ã¦ã„ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/04/29/vyatta-upnp/","summary":"\u003cp\u003eVyatta ã‚’è‡ªå®…ãƒ«ãƒ¼ã‚¿ã§ä½¿ã„å§‹ã‚ã¦æ„Ÿã˜ãŸã®ã¯ã€PS3 ãªã©ã®ã‚²ãƒ¼ãƒ æ©Ÿã‚„ IP é›»è©±ãªã©\nUPnP æ¥ç¶šãŒå¿…è¦ãªã“ã¨ãŒã‚ã‚‹ã£ã¦ã“ã¨ã€‚ãŸã  Vyatta ã¯ UPnP ã«å¯¾å¿œã—ã¦ã„ãªã„ã®ã§ã€\nã©ã†ã—ã‚ˆã†ã‹ã¨æ€ã£ã¦ã„ãŸã‚‰ã€æœ‰å¿—ã®æ–¹ãŒä½œã£ã¦ãã‚ŒãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒã‚ã‚Šã€ã†ã¡ã§ã‚‚\nã“ã‚Œã‚’ä½¿ã†ã“ã¨ã«ã—ãŸã€‚ä»Šå›ã¯ãã®æ–¹æ³•ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/kiall/vyatta-upnp\"\u003ehttps://github.com/kiall/vyatta-upnp\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eä¸Šè¨˜ã®ã‚½ãƒ¼ã‚¹ã‚’å–å¾—ã—ã¦ç”Ÿæˆã™ã‚‹ã®ã ãŒã€vyatta ä¸Šã§æ§‹ç¯‰ã™ã‚‹ç’°å¢ƒã‚’ä½œã‚ŠãŸããªã„ã®\nã§ã€ç§ã¯ Debian Gnu/Linux ãƒã‚·ãƒ³ä¸Šã§è¡Œã„ã¾ã—ãŸã€‚Ubuntu ã§ã‚‚å¤§ä¸ˆå¤«ã ã¨æ€ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003edebian% sudo apt-get \u0026amp;\u0026amp; sudo apt-get install build-essential\ndebian% git clone https://github.com/kiall/vyatta-upnp.git\ndebian% cd vyatta-upnp\ndebian% dpkg-buildpackage -us -uc -d\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä¸€ã¤ä¸Šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« vyatta-upnp_0.2_all.deb ã¨ã„ã† .deb ãƒ•ã‚¡ã‚¤ãƒ«ãŒã§ãã‚ãŒã£\nã¦ã„ã‚‹ã¯ãšã§ã€ã“ã‚ŒãŒ UPnP ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ« vyatta-upnp_0.2_all.deb ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eæ¬¡ã« vyatta ä¸Šã§ã®ä½œæ¥­ã€‚packages.vyatta.com ã‹ã‚‰ libupnp4 ã¨ linux-igd ã‚’å–å¾—ã€\nãã®å¾Œå…ˆã»ã©ç”Ÿæˆã—ãŸ vyatta-upnp_0.2_all.deb ã‚’ vyatta ä¸Šã«æŒã£ã¦ãã¦ã‹ã‚‰ã‚¤ãƒ³\nã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003evyatta# cd /tmp/\nvyatta# wget http://packages.vyatta.com/debian/pool/main/libu/libupnp4/libupnp4_1.8.0~svn20100507-1_amd64.deb\nvyatta# wget http://packages.vyatta.com/debian/pool/main/l/linux-igd/linux-igd_1.0+cvs20070630-3_amd64.deb\nvyatta# scp ${DEBIAN}:/${SOMEWHERE}/vyatta-upnp_0.2_all.deb . # å…ˆã»ã©ç”Ÿæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«\nvyatta# dpkg -i libupnp4_1.8.0~svn20100507-1_amd64.deb linux-igd_1.0+cvs20070630-3_amd64.deb\nvyatta# dpkg -i vyatta-upnp_0.2_all.deb\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã“ã‚Œã§è¨­å®šãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚è¨­å®šã—ã¦ã¿ã¾ã™ã€‚\u003c/p\u003e","title":"vyatta ã§ UPnP æ¥ç¶š"},{"content":"è‡ªå®…ãƒ«ãƒ¼ã‚¿ã‚’ Vyatta ã§æ§‹ç¯‰ã—ã¦ã¿ãŸããªã‚Šã€ç§‹è‘‰åŸã® ark ã§ãƒã‚·ãƒ³ã‚’èª¿é”ã—ã¾ã—ãŸã€‚ Broadcom ã® BCM57780 ãƒãƒƒãƒ—ãŒæ­è¼‰ã•ã‚ŒãŸ NIC ãŒãƒã‚¶ãƒ¼ãƒœãƒ¼ãƒ‰ J\u0026amp;W MINIXâ„¢ H61M-USB3 ã ã£ãŸã®ã§ã™ãŒã€Vyatta.org ã«ã‚ˆã‚‹ã¨ Broadcom ã® NIC ãŒ Certificated Hardware ã«è¼‰ã£ã¦ã„ãªãã¦å¿ƒé…ã§ã—ãŸã€‚ã¾ãå®šè©•ã®ã‚ã‚‹ NIC ãƒ¡ãƒ¼ã‚«ã ã‹ã‚‰å‹•ãã ã‚ã† ã¨æ¥½è¦³è¦–ã—ã¦ã„ãŸã®ã§ã™ã‘ã©ã€æ¡ˆã®å®šå‹•ãã¾ã—ãŸã€‚vyatta.org ã® Certificated Hardware ã«ã‚³ãƒŸãƒƒãƒˆã—ãŸã‚‰ \u0026ldquo;user tested\u0026rdquo; ã¨ã—ã¦æ²è¼‰ã—ã¦ã‚‚ã‚‰ãˆã¾ã—ãŸã€‚\nhttp://www.vyatta.org/hardware/interfaces\nã“ã‚“ãªæ„Ÿã˜ã«è¦‹ãˆã¦ã„ã¾ã™ã€‚\n# dmesg | grep Broadcom [ 3.284646] tg3 0000:03:00.0: eth0: attached PHY driver [Broadcom BCM57780](mii_bus:phy_addr=300:01) [ 3.524122] tg3 0000:05:00.0: eth1: attached PHY driver [Broadcom BCM57780](mii_bus:phy_addr=500:01) ä»Šå›ã¯ã€åŸºæœ¬çš„ãªè¨­å®š (PPPoE, NAT, DHCP) å‘¨ã‚Šã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\nç’°å¢ƒã¯\u0026hellip;\n+--------+ | Modem | +--------+ | | pppoe0 +--eth0--+ | vyatta | +--eth1--+ | 192.168.1.0/24 +----------+ | |192.168.1.10 +--------+ +--------+ | CPE | | DNS | +--------+ +--------+ ã¨ã—ã¦è¨˜ã—ã¾ã™ã€‚\nã¾ãšã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚http://www.vyatta.org/downloads ã‹ã‚‰ 64bit VC6.3 Live CD iso ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã¾ã™ã€‚(2012/04/28ç¾åœ¨æœ€æ–°). ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯¾è±¡ã®ãƒã‚·ãƒ³ã«æŒ¿å…¥ ã—ã¦ CDROM ãƒ–ãƒ¼ãƒˆã™ã‚‹ã¨ Vyatta ãŒç«‹ã¡ä¸ŠãŒã‚‹ã®ã§ã€ãƒ¦ãƒ¼ã‚¶ vyatta, ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ vyatta ã§ãƒ­ã‚°ã‚¤ãƒ³ã—\n# install-system ã—ã¾ã™ã€‚ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«å•ã„åˆã‚ã›ã‚‰ã‚Œã‚‹ã®ã§ç­”ãˆã¦ã„ã£ã¦ãã ã•ã„ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒ çµ‚ã‚ã£ãŸã‚‰ãƒã‚·ãƒ³ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚\neth1 ã«ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ¯ã‚Šã¾ã™ã€‚IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯é©å½“ã«èª­ã¿æ›¿ãˆã¦ãã ã• ã„ã€‚ã¾ãŸåŸºæœ¬çš„ãªè¨­å®šã‚‚è¡Œã„ã¾ã™ã€‚\n# set service ssh port 10022 # firewall è¨­å®šã™ã‚‹ã¾ã§ã¯ã“ã†ã—ãŸã»ã†ãŒå®‰å¿ƒã§ã™ # set system host-name ${HOSTNAME} # set system time-zone Asia/Tokyo # set system name-server 8.8.8.8 # set interface ethernet eth1 address 192.168.1.254 eth0 ã‚’ PPPoE ãƒ‡ãƒã‚¤ã‚¹ã¨ã—ã¦åˆ©ç”¨ã—ã¦ PPPoE æ¥ç¶šã‚’å®Ÿéš›ã«ã—ã¾ã™ã€‚\n# set interface ethernet eth0 pppoe 0 # set interface ethernet eth0 pppoe 0 user-id ${PPPoE_username} # set interface ethernet eth0 pppoe 0 password ${PPPoE_password} # set interface ethernet eth0 pppoe 0 name-server auto # set interface ethernet eth0 pppoe 0 defaultroute auto # set interface ethernet eth0 pppoe 0 local-address XXX.XXX.XXX.XXX # å›ºå®šIPãŒã‚ã‚‹å ´åˆ # commit ã“ã“ã¾ã§ã§ vyatta ãƒãƒ¼ãƒ‰ã‹ã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\næ¬¡ã«ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã® CPE ã ã£ãŸã‚Šã‚µãƒ¼ãƒãƒãƒ¼ãƒ‰ã‹ã‚‰ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ ç¶šã®ãŸã‚ã« NAT è¨­å®šã‚’ã—ã¾ã™ã€‚\n# set service nat rule 1 # set service nat rule 1 type masquerade # set service nat rule 1 source address 192.168.1.0/24 # set service nat rule 1 outbound-interface pppoe0 # commit CPE ã‹ã‚‰ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸ã®æ¥ç¶šãŒå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚\nã‚ã¨ã¯è‡ªå®…ãƒ«ãƒ¼ã‚¿ãªã®ã§ DHCP ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ã£ãŸã»ã†ãŒä¾¿åˆ©ã ã‚ˆã­ã€ã¨ã†ã“ã¨ã§ã€‚\n# set service dhcp-server shared-network-name HOME subnet 198.168.1.0/24 start 192.168.1.100 stop 192.168.1.150 # set service dhcp-server shared-network-name HOME subnet 192.168.1.0/24 default-router 192.168.1.254 # set service dhcp-server shared-network-name HOME subnet 198.168.1.0/24 dns-server 8.8.8.8 # set service dhcp-server shared-network-name HOME subnet 198.168.1.0/24 dns-server 8.8.4.4 # commit ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã® CPE ã‹ã‚‰ DHCP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡ºã—ã¦ã¿ã¦ãã ã•ã„ã€‚IP ãŒå–å¾—ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\nã“ã“ã¾ã§ã§åŸºæœ¬çš„ãªæœ‰ç·šè‡ªå®…ãƒ«ãƒ¼ã‚¿ã¨ã—ã¦ã®æ§‹ç¯‰ã¯ã»ã¼å®Œäº†ã§ã™ãŒã€æœ€å¾Œã«ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ã‚µãƒ¼ãƒ ã‚’ DNS ã‚µãƒ¼ãƒã¨ã—ã¦ç¨¼åƒã•ã›ã‚‹ãŸã‚ã® NAT è¨­å®šæ–¹æ³•ã‚’è¨˜ã—ã¦ãŠãã¾ã™ã€‚\n# set service nat rule 2 # set service nat rule 2 destination # set service nat rule 2 type destination # set service nat rule 2 type destination # set service nat rule 2 inbound-interface pppoe0 # set service nat rule 2 protocol udp # set service nat rule 2 destination port 53 # set service nat rule 2 inside-address address 192.168.1.10 # commit DNS ã¯ç¨€ã« TCP ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ã®ã§åŒæ§˜ã« TCP ã‚ˆã†ã® NAT ãƒ«ãƒ¼ãƒ«ã‚‚è¿½è¨˜ã—ã¾ã™ã€‚\n# set service nat rule 3 # set service nat rule 3 destination # set service nat rule 3 type destination # set service nat rule 3 type destination # set service nat rule 3 inbound-interface pppoe0 # set service nat rule 3 protocol tcp # set service nat rule 3 destination port 53 # set service nat rule 3 inside-address address 192.168.1.10 set service nat rule 3 destinationset service nat rule 3 destination # commit\næœ€å¾Œã«è¨­å®šã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã«\u0026hellip;\n# save ã—ã¦çµ‚ã‚ã‚Šã§ã™ã€‚æ¬¡å›ã¯ UPnP ãªè¨­å®šæ–¹æ³•ã‚’æ›¸ã„ã¦è¡ŒããŸã„ã¨æ€ã„ã¾ã™ã€‚\nã¡ãªã¿ã«ã€ç§ã®è‡ªå®…ãƒ«ãƒ¼ã‚¿ã¯ã“ã‚“ãªãƒ¢ãƒã‚’ä½¿ã„ã¾ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/04/28/vyattarouter/","summary":"\u003cp\u003eè‡ªå®…ãƒ«ãƒ¼ã‚¿ã‚’ Vyatta ã§æ§‹ç¯‰ã—ã¦ã¿ãŸããªã‚Šã€ç§‹è‘‰åŸã® ark ã§ãƒã‚·ãƒ³ã‚’èª¿é”ã—ã¾ã—ãŸã€‚\nBroadcom ã® BCM57780 ãƒãƒƒãƒ—ãŒæ­è¼‰ã•ã‚ŒãŸ NIC ãŒãƒã‚¶ãƒ¼ãƒœãƒ¼ãƒ‰ J\u0026amp;W MINIXâ„¢\nH61M-USB3 ã ã£ãŸã®ã§ã™ãŒã€Vyatta.org ã«ã‚ˆã‚‹ã¨ Broadcom ã® NIC ãŒ Certificated\nHardware ã«è¼‰ã£ã¦ã„ãªãã¦å¿ƒé…ã§ã—ãŸã€‚ã¾ãå®šè©•ã®ã‚ã‚‹ NIC ãƒ¡ãƒ¼ã‚«ã ã‹ã‚‰å‹•ãã ã‚ã†\nã¨æ¥½è¦³è¦–ã—ã¦ã„ãŸã®ã§ã™ã‘ã©ã€æ¡ˆã®å®šå‹•ãã¾ã—ãŸã€‚vyatta.org ã® Certificated\nHardware ã«ã‚³ãƒŸãƒƒãƒˆã—ãŸã‚‰ \u0026ldquo;user tested\u0026rdquo; ã¨ã—ã¦æ²è¼‰ã—ã¦ã‚‚ã‚‰ãˆã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.vyatta.org/hardware/interfaces\"\u003ehttp://www.vyatta.org/hardware/interfaces\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eã“ã‚“ãªæ„Ÿã˜ã«è¦‹ãˆã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# dmesg | grep Broadcom\n[    3.284646] tg3 0000:03:00.0: eth0: attached PHY driver [Broadcom BCM57780](mii_bus:phy_addr=300:01)\n[    3.524122] tg3 0000:05:00.0: eth1: attached PHY driver [Broadcom BCM57780](mii_bus:phy_addr=500:01)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä»Šå›ã¯ã€åŸºæœ¬çš„ãªè¨­å®š (PPPoE, NAT, DHCP) å‘¨ã‚Šã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eç’°å¢ƒã¯\u0026hellip;\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e+--------+\n|  Modem |\n+--------+\n|\n| pppoe0\n+--eth0--+\n| vyatta |\n+--eth1--+\n|           192.168.1.0/24\n+----------+\n|          |192.168.1.10\n+--------+ +--------+\n|  CPE   | |  DNS   |\n+--------+ +--------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã¨ã—ã¦è¨˜ã—ã¾ã™ã€‚\u003c/p\u003e","title":"vyatta ã§è‡ªå®…ãƒ«ãƒ¼ã‚¿æ§‹ç¯‰"},{"content":"ä»Šé€±/å…ˆé€±ï¼Ÿã€Hacker News ã§å–ã‚Šä¸Šã’ã‚‰ã‚ŒãŸ Mosh ã‚’è‡ªå®… ã¨ä¼šç¤¾ã§ä½¿ã„å§‹ã‚ãŸã€‚SSH ä»£æ›¿ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã€SSP (State Synchronization Protocol)over UDP ã§å‹•ä½œã—ã¦ã„ã‚‹ã€‚MIT ãŒé–‹ç™ºã—ãŸãã†ã ã€‚\nå‹•ä½œã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã¨å…±ã«ãƒ‡ãƒ¼ã‚¿ã‚°ãƒ©ãƒ ã‚’ã‚µãƒ¼ãƒã«é€ä¿¡ã—ã€åŒæœŸã— ç¶šã‘ã‚‹ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒ­ãƒ¼ãƒŸãƒ³ã‚°ã— IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä»£ã‚ã‚‹ç­‰ã—ãŸæ™‚ã€ä»¥å‰ã‚ˆã‚Šå¤§ãã„ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã¨å…±ã«æ­£å½“ãªãƒ‘ã‚±ãƒƒãƒˆãŒé€ä¿¡ã•ã‚ŒãŸã¨ã‚µãƒ¼ãƒãŒèªè­˜ã—ãŸå ´åˆã®ã¿ã€ã‚µãƒ¼ ãƒã¯æ–°ã—ã„ã‚½ãƒ¼ã‚¹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ–°ãŸãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã ã¨èªè­˜ã™ã‚‹ã€‚ã‚‚ã¡ã‚ã‚“ã€ã“ã®å ´ åˆã®ãƒ­ãƒ¼ãƒŸãƒ³ã‚°ã¯ NAT è¶Šã—ã® IP å†ã‚¢ã‚µã‚¤ãƒ³æ™‚ã‚„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ ãƒ•ã‚§ãƒ¼ã‚¹åˆ‡ã‚Šæ›¿ãˆã‚„ãƒãƒ¼ãƒˆ PC ã‚’æ–°ãŸãªç„¡ç·šã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆé…ä¸‹ã¸ç§»å‹•ã—ãŸå ´åˆã‚‚åŒ æ§˜ã«å‹•ä½œã™ã‚‹ã€‚ã‚ã¡ã‚ƒä¾¿åˆ©ã‚„ã‚“ã€‚Mosh ã¯ SSP ã‚’2çµŒè·¯æŒã¡ã€1ã¤ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã‚µãƒ¼ ãƒã¸ãƒ¦ãƒ¼ã‚¶ã®æ‰“ã£ãŸã‚­ãƒ¼ã®åŒæœŸã‚’å–ã‚‹ã€‚ã‚‚ã†ä¸€æ–¹ã¯ã‚µãƒ¼ãƒã‹ã‚‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã§ã€ã‚¹ã‚¯ ãƒªãƒ¼ãƒ³ã®çŠ¶æ…‹ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸åŒæœŸã‚’å–ã‚‹ãŸã‚ã ã€‚\nã¤ã¾ã‚Šã€ãƒãƒ¼ãƒˆ PC ã‚„ãã®ä»–ãƒ¢ãƒã‚¤ãƒ«æ©Ÿå™¨ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰ã‚ã£ãŸã¨ã—ã¦ã‚‚æ¥ç¶šæ€§ã¯ æ‹…ä¿ã•ã‚Œã€ã¾ãŸ ãƒãƒ¼ãƒˆ PC ã®ã‚¹ãƒªãƒ¼ãƒ—è§£é™¤å¾Œã«ã‚‚æ¥ç¶šæ€§ã¯ç¢ºä¿ã•ã‚Œç¶šã‘ã‚‹ã€‚ã¾ãŸã€UDP ã§å‹•ä½œã—ã¦ã„ã‚‹ã®ã§ã€ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã® vim ã‚„ emacs ç­‰ã§ã®å†æç”»ã®é…å»¶ç­‰ã‚‚èµ·ã“ã‚Š ã«ããã†ã ã€‚ã‚ã¨ Ctrl-C ã€‚TCP ã ã¨ã€ã‚­ãƒ¼ã‚¿ã‚¤ãƒ—ãŒã‚µãƒ¼ãƒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ä¼ã‚ã‚‰ãªã„çŠ¶ æ³ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒ—ãƒ­ã‚»ã‚¹ãŒæ··é›‘ã—ã¦ã„ã‚‹ã¨ã‚ˆãã‚ã‚‹ã®ã ãŒã€SSP over UDP ã§ã® Ctrl-C ã¯ãã†ã„ã†ã“ã¨ãŒç„¡ã„ãã†ã ã€‚\nã¾ãŸã€èªè¨¼æ©Ÿæ§‹ã¯ SSH ã«ä»»ã›ã¦ã„ã‚‹ã®ã§ sshd ã¯å¼•ãç¶šãç¨¼åƒã•ã›ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã€‚ mosh ã¯æ¥ç¶šã™ã‚‹å…ˆã®ãƒ¦ãƒ¼ã‚¶ãŒä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶æ¨©é™ã§å‹•ä½œã•ã›ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã—ã‹ãªã„ã€‚ã¤ ã¾ã‚Š mosh daemon ã¯å¿…è¦ãªã„ã‚ˆã†ã ã€‚\nå®Ÿéš›ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã¿ãŸã€‚Mac ã®å ´åˆã€homebrew ã§\n% brew update % brew install mobile-shell ã§å®Œäº†ã€‚ç§ã¯ã‚µãƒ¼ãƒã« Debian ã¨ Ubuntu ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã ãŒã€Debian ã®å ´åˆã¯ testing, unstable ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå®¹æ˜“ã•ã‚Œã¦ã„ã‚‹ã€‚ãŒã€testing ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ ãŸæ‰€ã€å‹•ä½œãŒä¸å®‰å®šã ã£ãŸã€‚æ–‡å­—ã‚’å‰Šé™¤ã—ã¦ã‚‚ä¸€æ–‡å­—æ¶ˆãˆãªã„ç­‰ã€‚ã‚ˆã£ã¦ã€github ã‹ ã‚‰æœ€æ–°ã®ã‚½ãƒ¼ã‚¹ã‚’å–å¾—ã€‚(unstable ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã‚‚ã‚¤ã‚¤ã‹ã‚‚ã—ã‚Œãªã„ã€ç§ã¯è©¦ã—ã¦ãª ã„ã§ã™ã€‚)\n% sudo apt-get install protobuf-compiler libprotobuf-dev pkg-config \\ libboost-dev libncurses5-dev % cd gitwork % git clone https://github.com/keithw/mosh.git % cd mosh % ./autogen.sh \u0026amp;\u0026amp; ./configure \u0026amp;\u0026amp; make % sudo make install Ubuntu ã®å ´åˆã¯ã€\n% sudo apt-get install python-software-properties % sudo add-apt-repository ppa:keithw/mosh % sudo apt-get update % sudo apt-get install mosh ã ã€‚ãã®ä»–ã® destribution, OS ã®å ´åˆã¯ä¸‹è¨˜ã®ãƒªãƒ³ã‚¯ã‚’å‚ç…§ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\nhttp://mosh.mit.edu/#getting\næ¬¡ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ \u0026lt;-\u0026gt; ã‚µãƒ¼ãƒé–“ã®çµŒè·¯ãŒå¤‰ã‚ã£ã¦ã‚‚æ¥ç¶šã—ãŸã¾ã¾ã«ãªã‚‹ã®ã‹ã€ãƒ†ã‚¹ãƒˆ ã—ã¦ã¿ãŸã€‚\nMacBook wireless nic \u0026lt;-\u0026gt; server ã‚’ MacBook ethernet nic \u0026lt;-\u0026gt; server ã«æ¥ç¶šã—ãª ãŠã—ã¦ã¿ãŸã€‚ã¾ãŸã€ãã®æ¥ç¶šã—ãªãŠã—ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®é–“ã€\n% while(true) do echo \u0026quot;is mosh alive ?\u0026quot; ;sleep 3; done ã¨ã‚·ã‚§ãƒ«ä¸Šã§å®Ÿè¡Œã—ç¶šã‘ãŸã€‚çµæœã€ã‚µãƒ¼ãƒã«å†æ¥ç¶šã•ã‚Œã€ã¾ãŸä¸Šã®ã‚·ã‚§ãƒ«ãƒ—ãƒ­ã‚»ã‚¹ã‚‚ç¶™ ç¶šã•ã‚Œç¶šã‘ãŸï¼ã“ã‚Œã«ã¯é©šã„ãŸã€‚\nã¨ã„ã†ã“ã¨ã§ã€ä½¿ã„å§‹ã‚ã¦1é€±é–“ã ãŒä»Šã®ã¨ã“ã‚å¿«é©ã€‚\nä¼šç¤¾ã®æ–¹ã« protobuf ã¯ Google ãŒè‡ªç¤¾ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯è»½æ¸›ã®ãŸã‚ã«é–‹ ç™ºã—ãŸã‚‚ã®ã ã€ã¨è¨€ã£ã¦ã„ãŸã€‚ã“ã‚“ãªã¨ã“ã‚ã§ã‚‚ Google ã®æŠ€è¡“åŠ›ãŒã™ã‚“ã”ã„ã“ã¨ã«æ”¹ ã‚ã¦æ°—ãŒã¤ã„ãŸã‚ˆã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/04/14/ssh-mosh/","summary":"\u003cp\u003eä»Šé€±/å…ˆé€±ï¼Ÿã€Hacker News ã§å–ã‚Šä¸Šã’ã‚‰ã‚ŒãŸ \u003ca href=\"http://mosh.mit.edu/\"\u003eMosh\u003c/a\u003e ã‚’è‡ªå®…\nã¨ä¼šç¤¾ã§ä½¿ã„å§‹ã‚ãŸã€‚SSH ä»£æ›¿ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã€SSP (State Synchronization\nProtocol)over UDP ã§å‹•ä½œã—ã¦ã„ã‚‹ã€‚MIT ãŒé–‹ç™ºã—ãŸãã†ã ã€‚\u003c/p\u003e\n\u003cp\u003eå‹•ä½œã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã¨å…±ã«ãƒ‡ãƒ¼ã‚¿ã‚°ãƒ©ãƒ ã‚’ã‚µãƒ¼ãƒã«é€ä¿¡ã—ã€åŒæœŸã—\nç¶šã‘ã‚‹ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒ­ãƒ¼ãƒŸãƒ³ã‚°ã— IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä»£ã‚ã‚‹ç­‰ã—ãŸæ™‚ã€ä»¥å‰ã‚ˆã‚Šå¤§ãã„\nã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã¨å…±ã«æ­£å½“ãªãƒ‘ã‚±ãƒƒãƒˆãŒé€ä¿¡ã•ã‚ŒãŸã¨ã‚µãƒ¼ãƒãŒèªè­˜ã—ãŸå ´åˆã®ã¿ã€ã‚µãƒ¼\nãƒã¯æ–°ã—ã„ã‚½ãƒ¼ã‚¹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ–°ãŸãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã ã¨èªè­˜ã™ã‚‹ã€‚ã‚‚ã¡ã‚ã‚“ã€ã“ã®å ´\nåˆã®ãƒ­ãƒ¼ãƒŸãƒ³ã‚°ã¯ NAT è¶Šã—ã® IP å†ã‚¢ã‚µã‚¤ãƒ³æ™‚ã‚„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼\nãƒ•ã‚§ãƒ¼ã‚¹åˆ‡ã‚Šæ›¿ãˆã‚„ãƒãƒ¼ãƒˆ PC ã‚’æ–°ãŸãªç„¡ç·šã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆé…ä¸‹ã¸ç§»å‹•ã—ãŸå ´åˆã‚‚åŒ\næ§˜ã«å‹•ä½œã™ã‚‹ã€‚ã‚ã¡ã‚ƒä¾¿åˆ©ã‚„ã‚“ã€‚Mosh ã¯ SSP ã‚’2çµŒè·¯æŒã¡ã€1ã¤ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã‚µãƒ¼\nãƒã¸ãƒ¦ãƒ¼ã‚¶ã®æ‰“ã£ãŸã‚­ãƒ¼ã®åŒæœŸã‚’å–ã‚‹ã€‚ã‚‚ã†ä¸€æ–¹ã¯ã‚µãƒ¼ãƒã‹ã‚‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã§ã€ã‚¹ã‚¯\nãƒªãƒ¼ãƒ³ã®çŠ¶æ…‹ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸åŒæœŸã‚’å–ã‚‹ãŸã‚ã ã€‚\u003c/p\u003e\n\u003cp\u003eã¤ã¾ã‚Šã€ãƒãƒ¼ãƒˆ PC ã‚„ãã®ä»–ãƒ¢ãƒã‚¤ãƒ«æ©Ÿå™¨ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰ã‚ã£ãŸã¨ã—ã¦ã‚‚æ¥ç¶šæ€§ã¯\næ‹…ä¿ã•ã‚Œã€ã¾ãŸ ãƒãƒ¼ãƒˆ PC ã®ã‚¹ãƒªãƒ¼ãƒ—è§£é™¤å¾Œã«ã‚‚æ¥ç¶šæ€§ã¯ç¢ºä¿ã•ã‚Œç¶šã‘ã‚‹ã€‚ã¾ãŸã€UDP\nã§å‹•ä½œã—ã¦ã„ã‚‹ã®ã§ã€ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã® vim ã‚„ emacs ç­‰ã§ã®å†æç”»ã®é…å»¶ç­‰ã‚‚èµ·ã“ã‚Š\nã«ããã†ã ã€‚ã‚ã¨ Ctrl-C ã€‚TCP ã ã¨ã€ã‚­ãƒ¼ã‚¿ã‚¤ãƒ—ãŒã‚µãƒ¼ãƒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ä¼ã‚ã‚‰ãªã„çŠ¶\næ³ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒ—ãƒ­ã‚»ã‚¹ãŒæ··é›‘ã—ã¦ã„ã‚‹ã¨ã‚ˆãã‚ã‚‹ã®ã ãŒã€SSP over UDP ã§ã® Ctrl-C\nã¯ãã†ã„ã†ã“ã¨ãŒç„¡ã„ãã†ã ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãŸã€èªè¨¼æ©Ÿæ§‹ã¯ SSH ã«ä»»ã›ã¦ã„ã‚‹ã®ã§ sshd ã¯å¼•ãç¶šãç¨¼åƒã•ã›ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã€‚\nmosh ã¯æ¥ç¶šã™ã‚‹å…ˆã®ãƒ¦ãƒ¼ã‚¶ãŒä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶æ¨©é™ã§å‹•ä½œã•ã›ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã—ã‹ãªã„ã€‚ã¤\nã¾ã‚Š mosh daemon ã¯å¿…è¦ãªã„ã‚ˆã†ã ã€‚\u003c/p\u003e\n\u003cp\u003eå®Ÿéš›ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã¿ãŸã€‚Mac ã®å ´åˆã€homebrew ã§\u003c/p\u003e","title":"Mosh ã‚’ä½¿ã†"},{"content":"ãƒãƒ¼ãƒˆ PC ã‚’è³¼å…¥ã™ã‚‹ã¨ã„ã¤ã‚‚ Debian Gnu/Linux sid ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã®ã ã‘ã‚Œã© ã‚‚ã€X Window System ã‚„ InputMethod ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦åˆ©ç”¨ã—å§‹ã‚ã‚‰ã‚Œã‚‹ã¨ã“ã‚ã¾ ã§ã®æ‰‹é †ã£ã¦ã„ã¤ã‚‚å¿˜ã‚Œã‚‹ã€‚ãƒ¡ãƒ¢ã¨ã—ã¦ãƒ–ãƒ­ã‚°ã«è¼‰ã›ã¦ãŠãã¾ã™ã€‚\nconsole ä¸Šã§ã® ctrl:caps swap è¨­å®š å–ã‚Šã‚ãˆãšã“ã®è¨­å®šã‚’ã—ãªã„ã¨ã€ä½•ã‚‚æ“ä½œå‡ºæ¥ãªã„ã€‚Caps Lock ã¨ Control ã‚­ãƒ¼ã‚’å…¥ ã‚Œæ›¿ãˆã‚‹è¨­å®šã§ã™ã€‚\n/etc/default/keyboard ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«ä¿®æ­£\nXKBOPTIONS=\u0026quot;ctrl:swapcaps\u0026quot; ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§è¨­å®šã‚’åæ˜ ã€‚\n% sudo /etc/init.d/console-setup restart sid ã® sources.list è¨­å®š Debian Gnu/Linux ã‚’ãƒãƒ¼ãƒˆ PC ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ™‚ã¯å¿…ãš sid ã‚’å…¥ã‚Œã¾ã™ã€‚æ–°ã—ç›® ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä½¿ã„ãŸã„ã‹ã‚‰ã€‚\ndeb http://ftp.riken.jp/Linux/debian/debian/ unstable main contrib non-free deb-src http://ftp.riken.jp/Linux/debian/debian/ unstable main contrib non-free ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ dist-upgrade\n% sudo apt-get update % sudo apt-get dist-upgrade iwlwifi ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š è²·ã†ãƒãƒ¼ãƒˆ PC ã¯ã„ã¤ã‚‚ ThinkPadã€‚å¤§ä½“ intel ãƒãƒƒãƒ—ãª Wi-Fi ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæ­è¼‰ã• ã‚Œã¦ã„ã‚‹ã®ã§ã€iwlwifi ã‚’ä½¿ã†ã€‚\n% sudo apt-get install firmware-iwlwifi % sudo modprobe iwl4965 # å„ã€…ã®ç«¯æœ«ã«åˆã‚ã›ã‚‹ã€‚lspci ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèª % sudo modprobe iwlagn % sudo iwconfig % sudo ifconfig wlan0 up æ¬¡ã« /etc/network/interfaces ã®è¨­å®š\nauto wlan0 iface wlan0 inet dhcp pre-up /sbin/wpa_supplicant -B -Dwext -c/etc/wpa_supplicant/wpa_supplicant.conf -iwlan0 pre-up iwconfig wlan0 essid ${SSID} pre-up ip link set wlan0 up pre-up iwconfig wlan0 ap any /etc/wpa_supplicant/wpa_supplicant.conf ã®è¨­å®š\n% sudo wpa_passphrase ${SSID} ${PASSPHRASE} \u0026gt; /etc/wpa_supplicant/wpa_supplicant.conf ç”Ÿæˆã—ãŸä¸Šè¨˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ãƒ»åŠ ç­†\nnetwork={ proto=WPA WPA2 key_mgmt=WPA-PSK pairwise=CCMP TKIP ssid=\u0026quot;${SSD}\u0026quot; psk=..... } ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å†èµ·å‹•ã§æ¥ç¶š\n% sudo service networking restart X Window å‘¨ã‚Šã®è¨­å®š å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚ãƒ“ãƒ‡ã‚ªã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ©ã‚¤ãƒã¯ç«¯æœ«ã«åˆã‚ã›ã¦ã‚¤ãƒ³ã‚¹ ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚thinkpad ã¯ Intel ãªãƒ“ãƒ‡ã‚ªã‚«ãƒ¼ãƒ‰ã®å ´åˆãŒå¤šã„ã®ã§ä¸‹è¨˜ã®ã‚ˆã†ã«æŒ‡å®šã€‚\nã¾ãŸã€æ˜”ã¯ã‚ˆã enlightenment ã‚’ä½¿ã£ã¦ã„ãŸã®ã ã‘ã©ã€e17 ãŒä½•æ™‚ã¾ã§çµŒã£ã¦ã‚‚å®Œæˆ åº¦ä¸ŠãŒã‚‰ãªã„ã®ã§è«¦ã‚ã¦ openbox ã‚’ä½¿ã†ã“ã¨ã«ã€‚\n% sudo apt-get insatll openbox obmenu xorg xserver-xorg-video-intel console åŒæ§˜ã« ctrl:caps ã‚’ swap ã™ã‚‹ã€‚xorg.conf ãŒç„¡ã„(2012/04æ™‚ç‚¹)ã®ã§ã€sid ã§ã¯ /etc/X11/Xsession.d/10setxkbmap ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«ç”Ÿæˆã—ã¦å¯¾å¿œã€‚\n#!/bin/sh setxkbmap -option ctl:nocaps æ—¥æœ¬èªå…¥åŠ› input method ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« æ—¥æœ¬èªå…¥åŠ›ã« uim-mozc ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã€‚ä»Šã®ã¨ã“ã‚ã“ã‚ŒãŒä¸€ç•ªå¿«é©ã€‚\n% sudo apt-get install uim-mozc uim-xim uim-utils mozc-utils-gui mozc-server uim-qt /etc/X11/openbox/autostart ã«ä¸‹è¨˜ã®è¡Œã‚’è¿½è¨˜\nif type uim-xim \u0026amp;\u0026gt; /dev/null ; then uim-xim \u0026amp; uim-toolbar-qt4 \u0026amp; fi uim-toolbar-qt4 ã® preference ã§ \u0026ldquo;ã‚ªãƒ³ãƒ»ã‚ªãƒ•ã‚­ãƒ¼\u0026rdquo; ç­‰ã‚‚ã‚ã‚‚ã‚ã‚’å¥½ã¿ã«è¨­å®šã€‚\nalsa ã«ã‚ˆã‚‹ã‚µã‚¦ãƒ³ãƒ‰ã®å‡ºåŠ› æ˜”ã¯è‹¦åŠ´ã—ãŸã‚µã‚¦ãƒ³ãƒ‰å‡ºåŠ›ã‚‚ã€ä»Šã§ã¯ã“ã‚“ãªã«ç°¡å˜ãªæ“ä½œã§å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï½—\n% sudo apt-get install alsa-utils alsa-base % sudo modprobe snd-pcm-oss % sudo alsactl init % sudo alsactl store ä»¥ä¸Šã§ã™ã€‚ã“ã“ã¾ã§æ¥ã‚Œã°ã€ã‚ã¨ã¯å¥½ã¿ã§è¨­å®šã—ã¦ã„ã‘ã°ã„ã„ã€‚ã‚‚ã¡ã‚ã‚“ Ubuntu ç­‰ã® dist ã‚’ä½¿ãˆã°ã€ã“ã‚“ãªæ“ä½œã¯å¿…è¦ç„¡ã„ã®ã ã‘ã©ã€è‡ªåˆ†ã§ã‚„ã‚‰ãªã„ã¨ã©ã†ã‚‚æ°—æŒã¡ãŒæ‚ª ã„ã—ã€ä¸‡ãŒä¸€ãƒˆãƒ©ãƒ–ãƒ«ãŒèµ·ãã¦ã‚‚è‡ªåˆ†ã§è¨­å®šã—ã¦ã„ã‚Œã°æ²»ã›ã‚‹ã—ã€‚\nã¾ãã€æœ€è¿‘ã§ã¯ MacBook ã‚’ä½¿ã†ã“ã¨ãŒã»ã¨ã‚“ã©ãªã®ã§ã™ãŒ..ã€‚or2\n","permalink":"https://jedipunkz.github.io/post/2012/04/07/debian-sid-on-thinkpad-first-setup/","summary":"\u003cp\u003eãƒãƒ¼ãƒˆ PC ã‚’è³¼å…¥ã™ã‚‹ã¨ã„ã¤ã‚‚ Debian Gnu/Linux sid ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã®ã ã‘ã‚Œã©\nã‚‚ã€X Window System ã‚„ InputMethod ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦åˆ©ç”¨ã—å§‹ã‚ã‚‰ã‚Œã‚‹ã¨ã“ã‚ã¾\nã§ã®æ‰‹é †ã£ã¦ã„ã¤ã‚‚å¿˜ã‚Œã‚‹ã€‚ãƒ¡ãƒ¢ã¨ã—ã¦ãƒ–ãƒ­ã‚°ã«è¼‰ã›ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"console-ä¸Šã§ã®-ctrlcaps-swap-è¨­å®š\"\u003econsole ä¸Šã§ã® ctrl:caps swap è¨­å®š\u003c/h2\u003e\n\u003cp\u003eå–ã‚Šã‚ãˆãšã“ã®è¨­å®šã‚’ã—ãªã„ã¨ã€ä½•ã‚‚æ“ä½œå‡ºæ¥ãªã„ã€‚Caps Lock ã¨ Control ã‚­ãƒ¼ã‚’å…¥\nã‚Œæ›¿ãˆã‚‹è¨­å®šã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e/etc/default/keyboard ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«ä¿®æ­£\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eXKBOPTIONS=\u0026quot;ctrl:swapcaps\u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§è¨­å®šã‚’åæ˜ ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% sudo /etc/init.d/console-setup restart\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"sid-ã®-sourceslist-è¨­å®š\"\u003esid ã® sources.list è¨­å®š\u003c/h2\u003e\n\u003cp\u003eDebian Gnu/Linux ã‚’ãƒãƒ¼ãƒˆ PC ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ™‚ã¯å¿…ãš sid ã‚’å…¥ã‚Œã¾ã™ã€‚æ–°ã—ç›®\nã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä½¿ã„ãŸã„ã‹ã‚‰ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003edeb http://ftp.riken.jp/Linux/debian/debian/ unstable main contrib non-free\ndeb-src http://ftp.riken.jp/Linux/debian/debian/ unstable main contrib non-free\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ dist-upgrade\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% sudo apt-get update\n% sudo apt-get dist-upgrade\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"iwlwifi-ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š\"\u003eiwlwifi ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š\u003c/h2\u003e\n\u003cp\u003eè²·ã†ãƒãƒ¼ãƒˆ PC ã¯ã„ã¤ã‚‚ ThinkPadã€‚å¤§ä½“ intel ãƒãƒƒãƒ—ãª Wi-Fi ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæ­è¼‰ã•\nã‚Œã¦ã„ã‚‹ã®ã§ã€iwlwifi ã‚’ä½¿ã†ã€‚\u003c/p\u003e","title":"debian sid on thinkpad"},{"content":"é•·å¹´ Gnu screen æ„›ç”¨è€…ã ã£ãŸã®ã ã‘ã©å®Œå…¨ã« tmux ã«ç§»è¡Œã—ã¾ã—ãŸã€‚\næ„›ç”¨ã—ã¦ã„ã‚‹ iterm2 ã¨ã®ç›¸æ€§ã‚‚è‰¯ãã€å¥½éƒ½åˆãªç‚¹ãŒå¹¾ã¤ã‹ã‚ã‚Šç§»è¡Œã™ã‚‹ä¾¡å€¤ãŒã‚ã‚Šã¾ã—ãŸã€‚\nãŸã ã€ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã§ã®åˆ©ç”¨ã¯è«¦ã‚ã¾ã—ãŸã€‚å•é¡Œã ã£ãŸã‚³ãƒ”ãƒšå•é¡Œã‚’ã‚¯ãƒªã‚¢ã—ã¦ã„ã‚‹ tmux ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ Debian sid ã‹ã‚‰å–å¾—å‡ºæ¥ãŸã®ã ã‘ã©ã€ã¾ã ã¾ã å®Œæˆåº¦é«˜ããªã..ã€‚\nã‚ˆã£ã¦ã€Mac ã« tmux ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ä½œæ¥­ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯ã“ã‚Œã€‚\näºˆã‚ https://github.com/mxcl/homebrew/wiki/installation ã« ã—ãŸãŒã£ã¦ homebrew ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ã‚ã‚Šã€‚\n% brew update % brew install tmux ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‰ .tmux.conf ã®ä½œæˆã«å…¥ã‚‹ã€‚prefix ã‚­ãƒ¼ã¯ C-t ã«ã—ãŸã‹ã£ãŸã€‚screen æ™‚ä»£ã‹ã‚‰ ã“ã‚Œã‚’ä½¿ã£ã¦ã„ã¦æŒ‡ãŒãã†å‹•ãã‹ã‚‰ã€‚\n# prefix key set-option -g prefix C-t ã¾ãŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³å‘¨ã‚Šã®è¨­å®šã€‚è‰²ãªã©ã‚‚è‡ªåˆ†ã§é¸æŠã™ã‚‹ã¨è‰¯ã„ã€‚\n# view set -g status-interval 5 set -g status-left-length 16 set -g status-right-length 50 # status set -g status-fg white set -g status-bg black set -g status-left-length 30 set -g status-left '#[fg=white,bg=black]#H#[fg=white]:#[fg=white][#S#[fg=white]][#[default]' set -g status-right '#[fg=white,bg=red,bold] [%Y-%m-%d(%a) %H:%M]#[default]' # window-status-current setw -g window-status-current-fg white setw -g window-status-current-bg red setw -g window-status-current-attr bold#,underscore # pane-active-border set -g pane-active-border-fg black set -g pane-active-border-bg blue UTF-8 æœ‰åŠ¹åŒ–ã‚„ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šç­‰ã¯\u0026hellip;\n# Option set-window-option -g utf8 on #set-window-option -g mode-keys vi ç§ã¯ emacs ä½¿ã„ãªã®ã§ vi ãƒ¢ãƒ¼ãƒ‰ã¯ç„¡åŠ¹ã«ã—ãŸã€‚ã“ã‚Œã§ emacs ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã«ãªã‚‹ã€‚\nãƒã‚¦ã‚¹é¸æŠã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€ä¾¿åˆ©ã‹ã‚‚ã—ã‚Œãªã„ã€‚\n#set-option -g mouse-select-pane on #set-option -g mouse-resize-pane ãŒã€PANE (ãƒšã‚¤ãƒ³) ã‚’æ¨ªåˆ†å‰²ã—ãŸéš›ã«ã“ã‚Œã‚‰ã®è¨­å®šã‚’å…¥ã‚Œã¦ã„ã‚‹ã¨ãƒã‚¦ã‚¹ã§ã®ã‚³ãƒ”ãƒ¼ãƒšãƒ¼ã‚¹ãƒˆãŒå‡ºæ¥ãªã„ ãŸã‚ã€ç§ã¯ç„¡åŠ¹ã«ã—ãŸã€‚\nãã®ä»–ã®è¨­å®šã€‚.tmux.conf ã‚’ tmux é–‹ã„ãŸã¾ã¾è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰ã ã£ãŸã‚Šã€ãƒšã‚¤ãƒ³ã®ç§»å‹•ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ç­‰ã€‚ ç‰¹ã« hjkl ã‚­ãƒ¼ã® vi ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã‚’ãƒšã‚¤ãƒ³ç§»å‹•ã®ãŸã‚ã«ã‚¢ã‚µã‚¤ãƒ³ã™ã‚‹ãŸã‚ã€ãã®ä»–ã®ã‚­ãƒ¼ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã« è¨­å®šã—ã¦ã„ã‚‹ã€‚ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ç§»å‹•ã¯ C-n, C-p ã«ã‚‚è¿½åŠ ã§ã‚¢ã‚µã‚¤ãƒ³ (default ã¯ n, p) ã—ã€ãƒšã‚¤ãƒ³ã®ç§»å‹• ã«ã¯ hjkl ã‚’ã‚¢ã‚µã‚¤ãƒ³ã—ãŸã€‚\nbind C-r source-file ~/.tmux.conf bind C-n next-window bind C-p previous-window bind c new-window bind | split-window -h bind C-k kill-pane bind K kill-window bind i display-panes bind y copy-mode bind h select-pane -L bind j select-pane -D bind k select-pane -U bind l select-pane -R ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ä¸­ã«ãƒšã‚¤ãƒ³ã®æ¦‚å¿µãŒå…¥ã£ãŸã“ã¨ã§ã€ä½œæ¥­åŠ¹ç‡ãŒéå¸¸ã«ä¸ŠãŒã£ãŸã—ã€Mac ä¸Šã®ã‚¢ãƒ—ãƒªãªã®ã§ã€Mac ã‚’ é–‹ã„ãŸç¬é–“ã«ä½œæ¥­ã«å…¥ã‚Œã‚‹ã€‚(ä»Šã¾ã§ã¯ debian ä¸Šã® screen ã§ç”Ÿæ´»ã—ã¦ã„ãŸ) debian ä¸Šã® tmux ã«ç§»è¡Œã™ã‚‹å¿…è¦ ãŒã‚ã‚‹ã‹ã©ã†ã‹ã€ã“ã‚Œã‹ã‚‰ä½¿ã„è¾¼ã‚“ã§ã¿ãŸã„ã¨æ€ã†ã€‚ãã®æ™‚ã«ã¾ãŸãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/04/01/switching-screen-tmux/","summary":"\u003cp\u003eé•·å¹´ Gnu screen æ„›ç”¨è€…ã ã£ãŸã®ã ã‘ã©å®Œå…¨ã« tmux ã«ç§»è¡Œã—ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eæ„›ç”¨ã—ã¦ã„ã‚‹ iterm2 ã¨ã®ç›¸æ€§ã‚‚è‰¯ãã€å¥½éƒ½åˆãªç‚¹ãŒå¹¾ã¤ã‹ã‚ã‚Šç§»è¡Œã™ã‚‹ä¾¡å€¤ãŒã‚ã‚Šã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eãŸã ã€ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã§ã®åˆ©ç”¨ã¯è«¦ã‚ã¾ã—ãŸã€‚å•é¡Œã ã£ãŸã‚³ãƒ”ãƒšå•é¡Œã‚’ã‚¯ãƒªã‚¢ã—ã¦ã„ã‚‹ tmux ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ\nDebian sid ã‹ã‚‰å–å¾—å‡ºæ¥ãŸã®ã ã‘ã©ã€ã¾ã ã¾ã å®Œæˆåº¦é«˜ããªã..ã€‚\u003c/p\u003e\n\u003cp\u003eã‚ˆã£ã¦ã€Mac ã« tmux ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ä½œæ¥­ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯ã“ã‚Œã€‚\u003c/p\u003e\n\u003cp\u003eäºˆã‚ \u003ca href=\"https://github.com/mxcl/homebrew/wiki/installation\"\u003ehttps://github.com/mxcl/homebrew/wiki/installation\u003c/a\u003e ã«\nã—ãŸãŒã£ã¦ homebrew ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ã‚ã‚Šã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% brew update\n% brew install tmux\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‰ .tmux.conf ã®ä½œæˆã«å…¥ã‚‹ã€‚prefix ã‚­ãƒ¼ã¯ C-t ã«ã—ãŸã‹ã£ãŸã€‚screen æ™‚ä»£ã‹ã‚‰\nã“ã‚Œã‚’ä½¿ã£ã¦ã„ã¦æŒ‡ãŒãã†å‹•ãã‹ã‚‰ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# prefix key\nset-option -g prefix C-t\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã¾ãŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³å‘¨ã‚Šã®è¨­å®šã€‚è‰²ãªã©ã‚‚è‡ªåˆ†ã§é¸æŠã™ã‚‹ã¨è‰¯ã„ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# view\nset -g status-interval 5\nset -g status-left-length 16\nset -g status-right-length 50\n# status\nset -g status-fg white\nset -g status-bg black\nset -g status-left-length 30\nset -g status-left '#[fg=white,bg=black]#H#[fg=white]:#[fg=white][#S#[fg=white]][#[default]'\nset -g status-right '#[fg=white,bg=red,bold] [%Y-%m-%d(%a) %H:%M]#[default]'\n# window-status-current\nsetw -g window-status-current-fg white\nsetw -g window-status-current-bg red\nsetw -g window-status-current-attr bold#,underscore\n# pane-active-border\nset -g pane-active-border-fg black\nset -g pane-active-border-bg blue\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eUTF-8 æœ‰åŠ¹åŒ–ã‚„ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šç­‰ã¯\u0026hellip;\u003c/p\u003e","title":"switching screen-\u003etmux"},{"content":"pages.github.com ã¯ github.com ã® WEB ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ octopress ã®ãƒ–ãƒ­ã‚°ã‚’ æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’ãƒ¡ãƒ¢ã—ã¦ã„ãã¾ã™ã€‚\nã¾ãšã€github.com ã« \u0026ldquo;${å¥½ããªåå‰}.github.com\u0026rdquo; ã¨ã„ã†åå‰ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ github.com ä¸Šã§ä½œæˆã—ã¾ã™ã€‚ ãƒ¬ãƒã‚¸ãƒˆãƒªã®ä½œæˆã¯æ™®é€šã®ãƒ¬ãƒã‚¸ãƒˆãƒªä½œæˆã¨åŒã˜æ–¹æ³•ã§è¡Œãˆã¾ã™ã€‚ã—ã°ã‚‰ãã™ã‚‹ã¨ \u0026ldquo;${å¥½ããªåå‰}.github.com ã®ãƒšãƒ¼ã‚¸ãŒãƒ“ãƒ«ãƒ‰å‡ºæ¥ã¾ã—ãŸ\u0026rdquo; ã¨ã„ã†å†…å®¹ã§ãƒ¡ãƒ¼ãƒ«ãŒé€ã‚‰ã‚Œã¦ãã¾ã™ã€‚\npages.github.com ã«ã‚ˆã‚‹ã¨ã€ãƒ¬ãƒã‚¸ãƒˆãƒªãƒšãƒ¼ã‚¸ã§ \u0026ldquo;GitHub Page\u0026rdquo; ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚ã¨æ›¸ã„ã¦ã‚ã‚Šã¾ã™ãŒã€æƒ…å ±ãŒå¤ã„ã‚ˆã†ã§ã™ã€‚ 2012/03/20 ç¾åœ¨ã€ã“ã®æ“ä½œã®å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\næ¬¡ã« octopress ã®ç’°å¢ƒæ§‹ç¯‰ã€‚\noctopress ã¯ã€jekyll ãƒ™ãƒ¼ã‚¹ã®ãƒ–ãƒ­ã‚°ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚markdown å½¢å¼ã§è¨˜äº‹ã‚’æ›¸ãã®ã§ã™ãŒã€emacs ã‚„ vim ç­‰ å¥½ããªã‚¨ãƒ‡ã‚£ã‚¿ã‚’ä½¿ã£ã¦è¨˜äº‹ã‚’æ›¸ã‘ã‚‹ã®ã§ä¾¿åˆ©ã§ã™ã€‚æœ€è¿‘ \u0026ldquo;Blogging with Emacs\u0026rdquo; ãªã‚“ã¦ãƒ–ãƒ­ã‚°ã‚’ã‚ˆãç›®ã«ã—ãŸã¨ æ€ã†ã®ã§ã™ãŒã€ã¾ã•ã«ã‚½ãƒ¬ã§ã™ã‚ˆã­ã€‚ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã¨ã£ã¦ã¯å¬‰ã—ã„ãƒ–ãƒ­ã‚°ç’°å¢ƒã§ã™ã€‚\nã¾ãšã¯ã€rvm ã®ç’°å¢ƒæ§‹ç¯‰ã‚’ã€‚octopress ã¯ ruby 1.9.2 ä»¥ä¸ŠãŒå¿…è¦ãªã®ã§ç”¨æ„ã™ã‚‹ã®ã§ã™ãŒ rvm ã‚’ä½¿ã†ã¨ æ‰‹è»½ã«ç”¨æ„å‡ºæ¥ã‚‹ã®ã§ã€ä»Šå›ã¯ãã®æ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚\nå‚è€ƒ URL ã¯ http://octopress.org/docs/setup/rvm/ ã§ã™ã€‚\nã¾ãšã¯æº–å‚™ã‹ã‚‰ã€‚ç§ã®ç’°å¢ƒã¯ Ubuntu Server 10.04 LTS ãªã®ã§ã™ãŒã€ä¸‹è¨˜ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå¿…ç”¨ã«ãªã‚Šã¾ã™ã€‚\n% sudo apt-get install gcc make zlib1g-dev libssl-dev ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€rvm ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚\n% bash -s stable \u0026lt; \u0026lt;(curl -s https://raw.github.com/wayneeseguin/rvm/master/binscripts/rvm-installer) æ¬¡ã«ä½¿ã£ã¦ã„ã‚‹ shell ã«åˆã‚ã›ã¦ rc ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨­å®šã—ã¾ã™ã€‚\nbash ãªã‚‰\u0026hellip;\n% echo '[[ -s \u0026quot;$HOME/.rvm/scripts/rvm\u0026quot; ]] \u0026amp;\u0026amp; . \u0026quot;$HOME/.rvm/scripts/rvm\u0026quot; # Load RVM function' \u0026gt;\u0026gt; ~/.bash_profile % source ~/.bash_profile zsh ãªã‚‰\u0026hellip;\n% echo '[[ -s $HOME/.rvm/scripts/rvm ]] \u0026amp;\u0026amp; source $HOME/.rvm/scripts/rvm' \u0026gt;\u0026gt; ~/.zshrc % source ~/.zshrc ruby 1.9.2 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚\n% rvm install 1.9.2 \u0026amp;\u0026amp; rvm use 1.9.2 % rvm rubygems latest æ¬¡ã« octopress ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ç’°å¢ƒè¨­å®šã§ã™ã€‚\n% mkdir ${å¥½ããªåå‰}.github.com % cd ${å¥½ããªåå‰}.github.com % git clone git://github.com/imathis/octopress.git octopress % cd octopress % gem install bundler % bundle install % rake install # classic ãƒ†ãƒ¼ãƒã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ã“ã“ã¾ã§å‡ºæ¥ãŸã‚‰ github.com ã¸ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã ã‘ã§ã™ã€‚\n% rake setup_github_pages Enter the read/write url for your repository: ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ä½œæˆã—ãŸ github.com ãƒšãƒ¼ã‚¸ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¾ã™ã€‚ç§ã®å ´åˆã¯\ngit@github.com:chobiwan/chobiwan.github.com.git ã“ã®æ“ä½œã§ã€.git å†…ã®æƒ…å ±è«¸ã€…ã‚’æ›´æ–°ã—ã¦ãã‚Œã¾ã™ã€‚å®Ÿè¡Œã—ãŸå¾Œã«è¦—ã„ã¦è¦‹ã¦ä¸‹ã•ã„ã€‚\nã§ã™ã€‚æœ€å¾Œã«ãƒ–ãƒ­ã‚°ç”Ÿæˆã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã“ã®ä½œæ¥­ã§ ${å¥½ããªåå‰}.github.com ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãŒ å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚\n% rake gen_deploy æš«ãæ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ãŒ (æ•°åˆ†) ã€${å¥½ããªåå‰}.github.com ã®ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ ã¯ãšã§ã™ã€‚\næ¬¡ã«ã€å¿…è¦æœ€ä½é™ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚_config.yml ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ä¸‹è¨˜ã®æƒ…å ±ã‚’æº€ãŸã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚\nurl: # For rewriting urls for RSS, etc title = # Used in the header and title tags title = # A description used in the header simple_search: # Search engine for simple site search description = # A default meta description for your site subscribe_rss: # Url for your blog\u0026rsquo;s feed, defauts to /atom.xml subscribe_email: # Url to subscribe by email (service required) email: # Email address for the RSS feed if you want it.\nã§ã¯ã„ã‚ˆã„ã‚ˆã€æœ€åˆã®æŠ•ç¨¿ã‚’ã€‚\n% rake new_post[\u0026quot;title\u0026quot;] % rake new_post\\[\u0026quot;title\u0026quot;\\] # zsh ã®å ´åˆ source/_posts/2012-03-20-test-post.markdown ã¨ã„ã†æ—¥ä»˜ä»˜ããƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹ã®ã§ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ å¥½ããªã‚¨ãƒ‡ã‚£ã‚¿ã§ç·¨é›†ã—ã¾ã™ã€‚\nmarkdown å½¢å¼ã§è¨˜ã™ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ä¸Šè¨˜ã®æ“ä½œã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚‰ã—ããƒ•ã‚¡ã‚¤ãƒ«ã«ãªã£ã¦ã„ã‚‹ã®ã§ \u0026ldquo;\u0026mdash;\u0026rdquo; ã®é…ä¸‹ã‹ã‚‰è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚ã¾ãŸ categories ç­‰ã®æƒ…å ±ã¯è‡ªåˆ†ã§ä¿®æ­£å‡ºæ¥ã¾ã™ã€‚\næ›¸ãçµ‚ã‚ã£ãŸã‚‰ã€ãƒ–ãƒ­ã‚°ã‚’ç”Ÿæˆã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã§ã™ã€‚\n% rake gen_deploy å…ˆã»ã©ä½œã£ãŸ ${å¥½ããªåå‰}.github.com ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚octopress ã®ãƒ–ãƒ­ã‚°ãŒå®Œæˆã—ã¦ã„ã‚‹ ã¯ãšã§ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/03/20/github-dot-com-de-octopress-gou-zhu/","summary":"\u003cp\u003epages.github.com ã¯ github.com ã® WEB ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ octopress ã®ãƒ–ãƒ­ã‚°ã‚’\næ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’ãƒ¡ãƒ¢ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãšã€github.com ã« \u0026ldquo;${å¥½ããªåå‰}.github.com\u0026rdquo; ã¨ã„ã†åå‰ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ github.com ä¸Šã§ä½œæˆã—ã¾ã™ã€‚\nãƒ¬ãƒã‚¸ãƒˆãƒªã®ä½œæˆã¯æ™®é€šã®ãƒ¬ãƒã‚¸ãƒˆãƒªä½œæˆã¨åŒã˜æ–¹æ³•ã§è¡Œãˆã¾ã™ã€‚ã—ã°ã‚‰ãã™ã‚‹ã¨\n\u0026ldquo;${å¥½ããªåå‰}.github.com ã®ãƒšãƒ¼ã‚¸ãŒãƒ“ãƒ«ãƒ‰å‡ºæ¥ã¾ã—ãŸ\u0026rdquo; ã¨ã„ã†å†…å®¹ã§ãƒ¡ãƒ¼ãƒ«ãŒé€ã‚‰ã‚Œã¦ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003epages.github.com ã«ã‚ˆã‚‹ã¨ã€ãƒ¬ãƒã‚¸ãƒˆãƒªãƒšãƒ¼ã‚¸ã§ \u0026ldquo;GitHub Page\u0026rdquo; ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚ã¨æ›¸ã„ã¦ã‚ã‚Šã¾ã™ãŒã€æƒ…å ±ãŒå¤ã„ã‚ˆã†ã§ã™ã€‚\n2012/03/20 ç¾åœ¨ã€ã“ã®æ“ä½œã®å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eæ¬¡ã« octopress ã®ç’°å¢ƒæ§‹ç¯‰ã€‚\u003c/p\u003e\n\u003cp\u003eoctopress ã¯ã€jekyll ãƒ™ãƒ¼ã‚¹ã®ãƒ–ãƒ­ã‚°ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚markdown å½¢å¼ã§è¨˜äº‹ã‚’æ›¸ãã®ã§ã™ãŒã€emacs ã‚„ vim ç­‰\nå¥½ããªã‚¨ãƒ‡ã‚£ã‚¿ã‚’ä½¿ã£ã¦è¨˜äº‹ã‚’æ›¸ã‘ã‚‹ã®ã§ä¾¿åˆ©ã§ã™ã€‚æœ€è¿‘ \u0026ldquo;Blogging with Emacs\u0026rdquo; ãªã‚“ã¦ãƒ–ãƒ­ã‚°ã‚’ã‚ˆãç›®ã«ã—ãŸã¨\næ€ã†ã®ã§ã™ãŒã€ã¾ã•ã«ã‚½ãƒ¬ã§ã™ã‚ˆã­ã€‚ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã¨ã£ã¦ã¯å¬‰ã—ã„ãƒ–ãƒ­ã‚°ç’°å¢ƒã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãšã¯ã€rvm ã®ç’°å¢ƒæ§‹ç¯‰ã‚’ã€‚octopress ã¯ ruby 1.9.2 ä»¥ä¸ŠãŒå¿…è¦ãªã®ã§ç”¨æ„ã™ã‚‹ã®ã§ã™ãŒ rvm ã‚’ä½¿ã†ã¨\næ‰‹è»½ã«ç”¨æ„å‡ºæ¥ã‚‹ã®ã§ã€ä»Šå›ã¯ãã®æ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå‚è€ƒ URL ã¯ \u003ca href=\"http://octopress.org/docs/setup/rvm/\"\u003ehttp://octopress.org/docs/setup/rvm/\u003c/a\u003e ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãšã¯æº–å‚™ã‹ã‚‰ã€‚ç§ã®ç’°å¢ƒã¯ Ubuntu Server 10.04 LTS ãªã®ã§ã™ãŒã€ä¸‹è¨˜ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå¿…ç”¨ã«ãªã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% sudo apt-get install gcc make zlib1g-dev libssl-dev\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€rvm ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚\u003c/p\u003e","title":"github.com ã§ octopress æ§‹ç¯‰"},{"content":"Carbon ãª API ã¯æ’é™¤ã—ã¦ã„ãã¹ãã¨ Apple ã‚‚è¨€ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã—ã€è‡ªå®…ã‚‚ä¼šç¤¾ã‚‚ Cocoa ãª emacs ã‚’ä½¿ã†ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚\nãã®æ‰‹é †ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚\nã‚½ãƒ¼ã‚¹ã¨ãƒ‘ãƒƒãƒã§ãƒ“ãƒ«ãƒ‰ã‚‚å‡ºæ¥ã‚‹ã®ã§ã™ãŒã€homebrew ä½¿ã†ã¨ãƒ¡ãƒãƒ£æ¥½ãªã®ã§ä»Šå›ã¯ãã‚Œã‚’ä½¿ã„ã¾ã™ã€‚ homebrew ã¯å…¬å¼ã‚µã‚¤ãƒˆã«è©³ã—ã„ã“ã¨ãŒæ›¸ã„ã¦ã‚ã‚Šã¾ã™ã‘ã©ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒãƒ¯ãƒ³ãƒ©ã‚¤ãƒ³ã§æ¸ˆã¿ã¾ã™ã€‚ ã‚ã¨ã€äº‹å‰ã« AppStore ã§ Xcode ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚\n% /usr/bin/ruby -e \u0026quot;$(curl -fsSL https://raw.github.com/gist/323731)\u0026quot; ã ã‘ã§ã™ã€‚\nãã—ã¦ Cocoa ãª emacs ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚\n% brew install --cocoa emacs % sudo mv /usr/local/Cellar/emacs/24.1/Emacs.app /Applications/ ä»¥ä¸Šã§ã™..ã€‚ç°¡å˜ã™ãã‚‹ã€‚å…ˆäººãŸã¡ã®ãŠã‹ã’ã§ã™ã­ã€‚\næ¬¡ã¯æ™‚é–“è¦‹ã¤ã‘ã¦ anything.el ã®ã“ã¨ã‚’æ›¸ã“ã†ã‹ãªãã¨æ€ã£ã¦ã¾ã™ã€‚\nå‚è€ƒ URL : http://mxcl.github.com/homebrew/\n","permalink":"https://jedipunkz.github.io/post/2012/03/07/cocoa-na-emacs-insutoru/","summary":"\u003cp\u003eCarbon ãª API ã¯æ’é™¤ã—ã¦ã„ãã¹ãã¨ Apple ã‚‚è¨€ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã—ã€è‡ªå®…ã‚‚ä¼šç¤¾ã‚‚ Cocoa ãª emacs ã‚’ä½¿ã†ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eãã®æ‰‹é †ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã‚½ãƒ¼ã‚¹ã¨ãƒ‘ãƒƒãƒã§ãƒ“ãƒ«ãƒ‰ã‚‚å‡ºæ¥ã‚‹ã®ã§ã™ãŒã€\u003ca href=\"http://mxcl.github.com/homebrew/\" target=\"_blank\"\u003ehomebrew\u003c/a\u003e ä½¿ã†ã¨ãƒ¡ãƒãƒ£æ¥½ãªã®ã§ä»Šå›ã¯ãã‚Œã‚’ä½¿ã„ã¾ã™ã€‚\nhomebrew ã¯å…¬å¼ã‚µã‚¤ãƒˆã«è©³ã—ã„ã“ã¨ãŒæ›¸ã„ã¦ã‚ã‚Šã¾ã™ã‘ã©ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒãƒ¯ãƒ³ãƒ©ã‚¤ãƒ³ã§æ¸ˆã¿ã¾ã™ã€‚\nã‚ã¨ã€äº‹å‰ã« AppStore ã§ Xcode ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% /usr/bin/ruby -e \u0026quot;$(curl -fsSL https://raw.github.com/gist/323731)\u0026quot;                                                     \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã ã‘ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eãã—ã¦ Cocoa ãª emacs ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% brew install --cocoa emacs \n% sudo mv /usr/local/Cellar/emacs/24.1/Emacs.app /Applications/\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä»¥ä¸Šã§ã™..ã€‚ç°¡å˜ã™ãã‚‹ã€‚å…ˆäººãŸã¡ã®ãŠã‹ã’ã§ã™ã­ã€‚\u003c/p\u003e\n\u003cp\u003eæ¬¡ã¯æ™‚é–“è¦‹ã¤ã‘ã¦ anything.el ã®ã“ã¨ã‚’æ›¸ã“ã†ã‹ãªãã¨æ€ã£ã¦ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eå‚è€ƒ URL : \u003ca href=\"http://mxcl.github.com/homebrew/\" title=\"homebrew\" target=\"_blank\"\u003e\u003ca href=\"http://mxcl.github.com/homebrew/\"\u003ehttp://mxcl.github.com/homebrew/\u003c/a\u003e\u003c/a\u003e\u003c/p\u003e","title":"cocoa ãª emacs ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"},{"content":"\nä¸Šã®ç”»åƒã¯ conky ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ã§ã™ã€‚\nconky ã¯ x window ã§ä½¿ãˆã‚‹ linux ãƒã‚·ãƒ³ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ–‡å­—ãƒ»ã‚°ãƒ©ãƒ•æç”»ã§è¡¨ç¾ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚\né€æ˜ã«ã—ãŸã‚Šã‚°ãƒ©ãƒ•è¡¨ç¤ºã‚’æ´¾æ‰‹ã«ã™ã‚‹ã“ã¨ã‚‚å‡ºæ¥ã‚‹ã®ã ã‘ã©ã€ã‚ãŸã—ã¯ä¸Šå›³ã®ã‚ˆã†ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã¨ã—ã¦ä½¿ã£ã¦ã¾ã™ã€‚Window Manager ã« openbox ã¨ã„ã†ç´ ã£æ°—ãªã„ã‚‚ã®ã‚’ä½¿ã†ã‚ˆã†ã«ã—ã¦ã‚‹ã®ã§ã€ã“ã‚Œè‡ªä½“ãŒãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ã‚‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã‚‚ç„¡ã„ã‚“ã§ã™ã€‚ãªã®ã§ conky ã‚’åˆ©ç”¨ã—ã¦ \u0026lsquo;æ™‚é–“\u0026rsquo;, \u0026lsquo;ãƒãƒƒãƒ†ãƒªæ®‹é‡\u0026rsquo;, \u0026lsquo;AC ã‚¢ãƒ€ãƒ—ã‚¿æœ‰ç„¡\u0026rsquo;, \u0026lsquo;ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä½¿ç”¨é‡\u0026rsquo; ç­‰ã‚’è¡¨ç¤ºã—ã¦ã¾ã™ã€‚\ndeviantart ã« rent0n86 ã•ã‚“ã¨ã„ã†æ–¹ãŒæŠ•ç¨¿ã—ãŸä½œå“ãŒã‚ã£ã¦ã€ãã‚Œã‚’ã“ã¡ã‚‡ã“ã¡ã‚‡è‡ªåˆ†ç”¨ã«ã„ã˜ã£ã¦ä½¿ã£ã¦ã¾ã™ã€‚\ndebian gnu/linux ãª GUI ç’°å¢ƒãŒã‚ã‚Œã°\u0026hellip;\n% sudo apt-get conky-all % cd $HOME % wget https://raw.github.com/chobiwan/dotfiles/master/.conkyrc ã§ã€ã“ã®ç’°å¢ƒã‚’ä½œã‚Œã¾ã™ã€‚\nè¡¨ç¤ºã™ã‚‹å†…å®¹ã¯ç’°å¢ƒã«åˆã‚ã›ã¦ä¿®æ­£ã™ã‚‹ã¨æ¥½ã—ã„ã§ã™ã€‚å¹…ã¯ minimum_size ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§åˆã‚ã›ã¦ãã ã•ã„ã€‚\nãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸€è¦§ã¯ã€å…¬å¼ Wiki ã‚µã‚¤ãƒˆ ã«æ­£ã—ã„æƒ…å ±ãŒè¼‰ã£ã¦ã„ã¾ã™ã€‚\nè©±å¤‰ã‚ã‚‹ã‘ã©ã€enlightenment 17 ãŒå®Œæˆåº¦é«˜ããªã‚‰ãªã„ç†ç”±ã£ã¦ãªã‚“ãªã®ã§ã—ã‚‡ã†ã‹ã­ï¼Ÿ 16 ã‚’æ„›ç”¨ã—ã¦ã„ãŸã ã‘ã«æ®‹å¿µã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/03/07/conky-statusbar/","summary":"\u003cp\u003e\u003ca href=\"http://files.chobiwan.me/pix/conky_capture.png\"\u003e\u003cimg src=\"http://files.chobiwan.me/pix/conky_capture.png\" alt=\"\" title=\"conky_capture\" width=\"721\" height=\"274\" class=\"alignnone size-full wp-image-60\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eä¸Šã®ç”»åƒã¯ conky ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://conky.sourceforge.net/\" target=\"_blank\"\u003econky\u003c/a\u003e ã¯ x window ã§ä½¿ãˆã‚‹ linux ãƒã‚·ãƒ³ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ–‡å­—ãƒ»ã‚°ãƒ©ãƒ•æç”»ã§è¡¨ç¾ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚\u003c/p\u003e\n\u003cp\u003eé€æ˜ã«ã—ãŸã‚Šã‚°ãƒ©ãƒ•è¡¨ç¤ºã‚’æ´¾æ‰‹ã«ã™ã‚‹ã“ã¨ã‚‚å‡ºæ¥ã‚‹ã®ã ã‘ã©ã€ã‚ãŸã—ã¯ä¸Šå›³ã®ã‚ˆã†ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã¨ã—ã¦ä½¿ã£ã¦ã¾ã™ã€‚Window Manager ã« openbox ã¨ã„ã†ç´ ã£æ°—ãªã„ã‚‚ã®ã‚’ä½¿ã†ã‚ˆã†ã«ã—ã¦ã‚‹ã®ã§ã€ã“ã‚Œè‡ªä½“ãŒãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ã‚‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã‚‚ç„¡ã„ã‚“ã§ã™ã€‚ãªã®ã§ conky ã‚’åˆ©ç”¨ã—ã¦ \u0026lsquo;æ™‚é–“\u0026rsquo;, \u0026lsquo;ãƒãƒƒãƒ†ãƒªæ®‹é‡\u0026rsquo;, \u0026lsquo;AC ã‚¢ãƒ€ãƒ—ã‚¿æœ‰ç„¡\u0026rsquo;, \u0026lsquo;ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä½¿ç”¨é‡\u0026rsquo; ç­‰ã‚’è¡¨ç¤ºã—ã¦ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003edeviantart ã« \u003ca href=\"http://rent0n86.deviantart.com/art/My-horizontal-conkyrc-122604863\" target=\"_blank\"\u003erent0n86\u003c/a\u003e ã•ã‚“ã¨ã„ã†æ–¹ãŒæŠ•ç¨¿ã—ãŸä½œå“ãŒã‚ã£ã¦ã€ãã‚Œã‚’ã“ã¡ã‚‡ã“ã¡ã‚‡è‡ªåˆ†ç”¨ã«ã„ã˜ã£ã¦ä½¿ã£ã¦ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003edebian gnu/linux ãª GUI ç’°å¢ƒãŒã‚ã‚Œã°\u0026hellip;\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% sudo apt-get conky-all\n% cd $HOME\n% wget https://raw.github.com/chobiwan/dotfiles/master/.conkyrc\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã§ã€ã“ã®ç’°å¢ƒã‚’ä½œã‚Œã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eè¡¨ç¤ºã™ã‚‹å†…å®¹ã¯ç’°å¢ƒã«åˆã‚ã›ã¦ä¿®æ­£ã™ã‚‹ã¨æ¥½ã—ã„ã§ã™ã€‚å¹…ã¯ minimum_size ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§åˆã‚ã›ã¦ãã ã•ã„ã€‚\u003c/p\u003e\n\u003cp\u003eãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸€è¦§ã¯ã€\u003ca href=\"http://wiki.conky.be/index.php?title=Configuration_Settings\" target=\"_blank\"\u003eå…¬å¼ Wiki ã‚µã‚¤ãƒˆ\u003c/a\u003e ã«æ­£ã—ã„æƒ…å ±ãŒè¼‰ã£ã¦ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eè©±å¤‰ã‚ã‚‹ã‘ã©ã€enlightenment 17 ãŒå®Œæˆåº¦é«˜ããªã‚‰ãªã„ç†ç”±ã£ã¦ãªã‚“ãªã®ã§ã—ã‚‡ã†ã‹ã­ï¼Ÿ 16 ã‚’æ„›ç”¨ã—ã¦ã„ãŸã ã‘ã«æ®‹å¿µã€‚\u003c/p\u003e","title":"conky statusbar"},{"content":"github.com ã¯ä¾¿åˆ©ãªã®ã ã‘ã©ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ä½œã‚‹ã®ã«ãŠé‡‘æ‰•ã†ã®ã¯ã‚‚ã£ãŸã„ãªã„ã®ã§è‡ªå®…ã‚µãƒ¼ãƒã« SSH çµŒç”±ã® Git ã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ã—ãŸã€‚ãã®æ™‚ã®æ‰‹é †ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚\ngitosis ã¨ã„ã†ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«ãŒã‚ã£ã¦ã€ã“ã‚Œã‚’ä½¿ã†ã¨ã‚ã£ã¨ã„ã†é–“ã«ç’°å¢ƒæ§‹ç¯‰ã§ãã¾ã™ã€‚ç§ã®ç’°å¢ƒã¯ debian Gnu/Linux Squeeze ãªã®ã§ã™ãŒ apt-get ã§å¿…è¦ãªãƒ¢ãƒã‚’å…¥ã‚Œã¾ã—ãŸã€‚gitosis ã¯ git ã§æŒã£ã¦ãã¾ã™ã€‚\nremote% sudo apt-get update remote% sudo apt-get install git git-core python python-setuptools remote% cd $HOME/usr/src remote% git clone git://eagain.net/gitosis.git remote% cd gitosis remote% sudo python setup.py install SSH ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å…ˆã®ãƒ¦ãƒ¼ã‚¶ã‚’ä½œã‚Šã¾ã™ã€‚\nremote% sudo adduser --shell /bin/sh -gecos --group \\ --disable-password --home /home/git git ä½œæ¥­ç«¯æœ«ã§ rsa ãª SSH å…¬é–‹éµã‚’ç”Ÿæˆã—ã¦ ${remote} ã‚µãƒ¼ãƒã¯è»¢é€ã™ã‚‹ã€‚\nlocal% ssh-keygen -t rsa ... ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«ç­”ãˆã‚‹ local% scp .ssh/id_dsa.pub ${remote}:/tmp/ è»¢é€ã—ãŸéµã‚’å…ƒã« ${remote} ã‚µãƒ¼ãƒä¸Šã§ git ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’åˆæœŸåŒ–ã™ã‚‹ã€‚\nremote% sudo -H -u git gitosis-init \u0026lt; /tmp/id_rsa.pub ã‚‚ã—å®Ÿè¡Œæ¨©ãŒä»˜ã„ã¦ã„ãªã‹ã£ãŸã‚‰\nremote% sudo chmod 755 /home/git/repositories/gitosis-admin.git/hooks/post-update ã“ã‚Œã§ç’°å¢ƒæ§‹ç¯‰å®Œäº†ã€‚ãŸã ã€ã“ã®ã¾ã¾ã ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã®ä½œæ¥­ç«¯æœ«ã‹ã‚‰ãƒ¬ãƒã‚¸ãƒˆãƒªã®ç”ŸæˆãŒå‡ºæ¥ãªã„ã€‚\nãƒ­ãƒ¼ã‚«ãƒ«ã®ä½œæ¥­ç«¯æœ«ã§ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ç”Ÿæˆã™ã‚‹æ‰‹é †ã¯ã€ gitosis-admin.git ã‚’ clone ã—ã¦ãã¦ã€gitosis.conf ã‚’ä¿®æ­£ã— commit/push ã™ã‚‹ã€‚\nlocal% git clone git@${remote}:gitosis-admin.git local% vi gitosis.conf ä»Šå›ã¯ãƒ†ã‚¹ãƒˆã§ test ã‚°ãƒ«ãƒ¼ãƒ—ã« test ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ä½œã‚‹ãŸã‚ã® config ã‚’æ›¸ã„ã¦ã¿ã‚‹ã€‚members ã¯è¤‡æ•°äººæ›¸ã‘ã‚‹ã€‚\n[gitosis] [group gitosis-admin] writable = gitosis-admin members = chobiwan@${local} [group test] writable = test members = chobiwan@${local} ä¿®æ­£ã—ãŸå†…å®¹ã‚’ ${remote} ã‚µãƒ¼ãƒã¸ git push ã—ã¦åæ˜ ã•ã›ã‚‹ã€‚\nlocal% git add . local% git commit -m \u0026quot;added test repo\u0026quot; local% git push origin master ã“ã‚Œã§ \u0026rsquo;test\u0026rsquo; ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã®ä½œæ¥­ç«¯æœ«ã‹ã‚‰ä½œã£ã¦ã‚³ãƒŸãƒƒãƒˆã™ã‚‹æº–å‚™å®Œäº†ã€‚ è©¦ã—ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ add, commit, push ã—ã¦ã¿ã‚‹ã€‚\nlocal% mkdir ~/gitwork local% cd ~/gitwork local% touch README local% git add README local% git commit -m \u0026quot;my first commi\u0026quot; local% git remote add origin git@obi.chobiwan.me:test.git local% git push origin master (2012/05/01 è¿½è¨˜) æ–°è¦ãƒ¦ãƒ¼ã‚¶ã®è¿½åŠ æ–¹æ³•ã¯ä¸‹è¨˜ã®é€šã‚Šã€‚\nlocal% ssh-keygen -t rsa local% cd ~/gitwork local% git clone git@${remote}:gitosis-admin.git local% cp ~/.ssh/id_rsa.pub ./gitosis-admin/keydir/user@hostname.pub local% vi ./gitosis-admin/gitosis.conf \u0026lt;å‚åŠ ã—ãŸã„ãƒªãƒã‚¸ãƒˆãƒªã® membersã« user@hostname.pub ã‚’è¿½åŠ (ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Š) local% git gitosis-admin \u0026amp;\u0026amp; git add . \u0026amp;\u0026amp; git commit -m \u0026quot;added a user\u0026quot; local% git push origin master å…¬é–‹éµã®ã‚¢ãƒƒãƒ—ã‚„ãƒ¬ãƒã‚¸ãƒˆãƒªãƒ»ã‚°ãƒ«ãƒ¼ãƒ—ã®ç”Ÿæˆã®ä»•æ–¹ã‚’è¦šãˆã‚Œã°ã€OK ãªã®ã‹ãªãã¨ã€‚ æ¬¡ã¯ãƒ¬ãƒã‚¸ãƒˆãƒªã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒ¬ã‚«ãƒãƒªã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ã„ããŸã„ã€‚ãƒªã‚«ãƒãƒªã§ããªã„ã¨æ­»ã­ã‚‹ã‹ã‚‰ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/03/07/gitosis-ssh-plus-git-saba/","summary":"\u003cp\u003egithub.com ã¯ä¾¿åˆ©ãªã®ã ã‘ã©ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ä½œã‚‹ã®ã«ãŠé‡‘æ‰•ã†ã®ã¯ã‚‚ã£ãŸã„ãªã„ã®ã§è‡ªå®…ã‚µãƒ¼ãƒã« SSH çµŒç”±ã® Git ã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ã—ãŸã€‚ãã®æ™‚ã®æ‰‹é †ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003egitosis ã¨ã„ã†ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«ãŒã‚ã£ã¦ã€ã“ã‚Œã‚’ä½¿ã†ã¨ã‚ã£ã¨ã„ã†é–“ã«ç’°å¢ƒæ§‹ç¯‰ã§ãã¾ã™ã€‚ç§ã®ç’°å¢ƒã¯ debian Gnu/Linux Squeeze ãªã®ã§ã™ãŒ apt-get ã§å¿…è¦ãªãƒ¢ãƒã‚’å…¥ã‚Œã¾ã—ãŸã€‚gitosis ã¯ git ã§æŒã£ã¦ãã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eremote% sudo apt-get update\nremote% sudo apt-get install git git-core python python-setuptools\nremote% cd $HOME/usr/src\nremote% git clone git://eagain.net/gitosis.git\nremote% cd gitosis\nremote% sudo python setup.py install\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSSH ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å…ˆã®ãƒ¦ãƒ¼ã‚¶ã‚’ä½œã‚Šã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eremote% sudo adduser --shell /bin/sh -gecos --group \\\n        --disable-password --home /home/git git\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä½œæ¥­ç«¯æœ«ã§ rsa ãª SSH å…¬é–‹éµã‚’ç”Ÿæˆã—ã¦ ${remote} ã‚µãƒ¼ãƒã¯è»¢é€ã™ã‚‹ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003elocal% ssh-keygen -t rsa\n... ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«ç­”ãˆã‚‹\nlocal% scp .ssh/id_dsa.pub ${remote}:/tmp/\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eè»¢é€ã—ãŸéµã‚’å…ƒã« ${remote} ã‚µãƒ¼ãƒä¸Šã§ git ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’åˆæœŸåŒ–ã™ã‚‹ã€‚\u003c/p\u003e","title":"gitosis ssh+git ã‚µãƒ¼ãƒ"},{"content":"ç™½é‡‘å°ã®ã‚¯ãƒƒã‚¯ãƒ‘ãƒƒãƒ‰ã•ã‚“ã§è¡Œã‚ã‚ŒãŸ \u0026ldquo;heroku jp meet up #3\u0026rdquo; ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚\næ±äº¬ãƒãƒ©ã‚½ãƒ³å‚åŠ ã®ãŸã‚æ¥æ—¥ã•ã‚Œã¦ã„ãŸ Christopher Stolt ã•ã‚“ã‚„ Ruby ã‚³ãƒŸãƒƒã‚¿ã®ç›¸æ¾¤ã•ã‚“ãªã©ã®è©±ã‚’èã‘ã¾ã—ãŸã€‚\nChristopher ã•ã‚“ã‹ã‚‰ã¯ã€åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚„ heroku ã§å‹•ä½œã•ã›ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å‹•ä½œã•ã›ã‚‹ foremanã€ã¾ãŸçš†ãŒæ„å¤–ã¨æ°—ã«ã™ã‚‹ã‚¢ãƒ—ãƒªã®ãƒ­ã‚°ã‚’ tail ã™ã‚‹æ–¹æ³•ãªã©ã®èª¬æ˜ãŒã‚ã‚Šã¾ã—ãŸã€‚PaaS ã§ã®çš†ã®æ‡¸å¿µç‚¹ãŒçµæ§‹è§£æ±ºã•ã‚ŒãŸã‚“ã˜ã‚ƒãªã„ã‹ãªãã€‚\nç›¸æ¾¤ã•ã‚“ã‹ã‚‰ã¯ NY ãƒãƒ©ã‚½ãƒ³ã§ã®å®Ÿç¸¾ãªã©ã€æ¯”è¼ƒçš„ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãªä½¿ã‚ã‚Œæ–¹ã‚‚ã•ã‚Œåˆã‚ã¦ã„ã‚‹ã¨èª¬æ˜ãŒã‚ã‚Šã¾ã—ãŸã€‚ã‚ã¨ã€å‘¼ã³åãªã®ã§ã™ãŒ heroku ã¯ \u0026ldquo;ã¸ã‚ã\u0026rdquo; ã¨ç™ºéŸ³ã™ã‚‹ãã†ã§ã™ã€‚ç¢ºã‹ã« about.heroku.com ã«ã¯ \u0026ldquo;Heroku (pronounced her-OH-koo) is a cloud application platform\u0026rdquo; ã¨æ›¸ã„ã¦ã‚ã‚‹ã®ã ãŒã€\u0026ldquo;ã¸ã‚ã\u0026rdquo; ãŒæ­£ã—ã„ãã†ã§ã™ã€‚w\nãã®ãŸ LT ãŒå¹¾ã¤ã‚ã£ã¦ã€ã¡ã‚‡ã†ã©æ°—ã«ãªã£ã¦ã„ãŸ Lokka ã®è©±ãŒã‚ã£ãŸã®ã§ã€è‡ªå®…ã«å¸°ã£ã¦ã‹ã‚‰è‡ªåˆ†ã® heroku ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ lokka ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã—ãŸã€‚lokka ã®å…¬å¼ã‚µã‚¤ãƒˆã«æ‰‹é †ãŒæ›¸ã„ã¦ã‚ã£ã¦ã€ãã®ã¾ã¾ãªã®ã§ã™ãŒè¡Œã£ãŸã®ã¯ã€\n% gem install heroku bundler % git clone git://github.com/komagata/lokka.git % cd lokka % heroku create % git push heroku master % heroku rake db:setup % heroku open ã™ã‚Œã° OKã€‚\nç§ã®ç’°å¢ƒã§ã¯å…¬é–‹éµèªè¨¼ãŒã†ã¾ãã„ã‹ãªã‹ã£ãŸã®ã§ã€ä¸‹è¨˜ã®å¯¾å‡¦ã‚’ã—ã¾ã—ãŸã€‚\n% heroku keys:add è©¦ã—ã« wordpress ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç§»è¡Œã—ã¦ã¿ã‚ˆã†ã¨æ€ã£ãŸã®ã§ã™ãŒã€\u0026ldquo;Application Error\u0026rdquo; ãŒç™ºç”Ÿã€‚ä»Šã®ã¨ã“ã‚ã†ã¾ãã„ã£ã¦ã„ã¾ã›ã‚“ã€‚ã‚³ãƒ¼ãƒ‰ã¨ãƒ–ãƒ­ã‚°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ git ã§ç®¡ç†å‡ºæ¥ã‚‹ã®ã§ã€ä»Šæ™‚ã§ã™ã‚ˆã­ã€‚åˆã‚ã¦ã¿ãŸã„ã€‚\nã¾ãŸã€ä»Šå›ä¼šå ´ã‚’æä¾›ã—ã¦ãã ã•ã£ãŸã‚¯ãƒƒã‚¯ãƒ‘ãƒƒãƒ‰ã•ã‚“ãŒã€ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ãƒ‡ãƒ¼ã¨ã„ã†ã“ã¨ã‚‚ã‚ã‚Šçš†ã«æ–™ç†ã‚’æä¾›ã—ã¦ä¸‹ã•ã„ã¾ã—ãŸã€‚æ„Ÿè¬ãƒ¼ã€‚\næœ¬å½“ã¯ heroku ã‚·ã‚¹ãƒ†ãƒ ãŒã©ã†æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã‹ï¼ŸãŒçŸ¥ã‚ŠãŸã‹ã£ãŸã®ã§ã™ãŒã€ãƒ¦ãƒ¼ã‚¶è¦–ç‚¹ã§ä½¿ã‚ã‚Œæ–¹ãŒåˆ†ã‹ã‚‰ãªã„ã¨ä½•ã‚‚å‡ºæ¥ãªã„ã¨æ„Ÿã˜ã¦ã„ãŸãŸã‚ã€ä»Šå›ã¯ã¨ã¦ã‚‚è‰¯ã„æ©Ÿä¼šã§ã—ãŸã€‚å€‹äººçš„ã«ã‚‚ heroku ã¯ä½¿ã„ç¶šã‘ãŸã„ã€ã¨æ„Ÿã˜ãŸã‚µãƒ¼ãƒ“ã‚¹ã§ã—ãŸã€‚ã¿ãªã•ã‚“ã€å½“æ—¥ã¯ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/03/07/heroku-jp-meetup-number-3/","summary":"\u003cp\u003eç™½é‡‘å°ã®ã‚¯ãƒƒã‚¯ãƒ‘ãƒƒãƒ‰ã•ã‚“ã§è¡Œã‚ã‚ŒãŸ \u0026ldquo;heroku jp meet up #3\u0026rdquo; ã«å‚åŠ ã—ã¦ãã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eæ±äº¬ãƒãƒ©ã‚½ãƒ³å‚åŠ ã®ãŸã‚æ¥æ—¥ã•ã‚Œã¦ã„ãŸ \u003ca href=\"http://twitter.com/stolt45\"\u003eChristopher Stolt\u003c/a\u003e ã•ã‚“ã‚„ Ruby ã‚³ãƒŸãƒƒã‚¿ã®\u003ca href=\"http://twitter.com/ayumin\"\u003eç›¸æ¾¤\u003c/a\u003eã•ã‚“ãªã©ã®è©±ã‚’èã‘ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eChristopher ã•ã‚“ã‹ã‚‰ã¯ã€åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚„ heroku ã§å‹•ä½œã•ã›ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å‹•ä½œã•ã›ã‚‹ foremanã€ã¾ãŸçš†ãŒæ„å¤–ã¨æ°—ã«ã™ã‚‹ã‚¢ãƒ—ãƒªã®ãƒ­ã‚°ã‚’ tail ã™ã‚‹æ–¹æ³•ãªã©ã®èª¬æ˜ãŒã‚ã‚Šã¾ã—ãŸã€‚PaaS ã§ã®çš†ã®æ‡¸å¿µç‚¹ãŒçµæ§‹è§£æ±ºã•ã‚ŒãŸã‚“ã˜ã‚ƒãªã„ã‹ãªãã€‚\u003c/p\u003e\n\u003cp\u003eç›¸æ¾¤ã•ã‚“ã‹ã‚‰ã¯ NY ãƒãƒ©ã‚½ãƒ³ã§ã®å®Ÿç¸¾ãªã©ã€æ¯”è¼ƒçš„ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãªä½¿ã‚ã‚Œæ–¹ã‚‚ã•ã‚Œåˆã‚ã¦ã„ã‚‹ã¨èª¬æ˜ãŒã‚ã‚Šã¾ã—ãŸã€‚ã‚ã¨ã€å‘¼ã³åãªã®ã§ã™ãŒ heroku ã¯ \u0026ldquo;ã¸ã‚ã\u0026rdquo; ã¨ç™ºéŸ³ã™ã‚‹ãã†ã§ã™ã€‚ç¢ºã‹ã« about.heroku.com ã«ã¯ \u0026ldquo;Heroku (pronounced her-OH-koo) is a cloud application platform\u0026rdquo; ã¨æ›¸ã„ã¦ã‚ã‚‹ã®ã ãŒã€\u0026ldquo;ã¸ã‚ã\u0026rdquo; ãŒæ­£ã—ã„ãã†ã§ã™ã€‚w\u003c/p\u003e\n\u003cp\u003eãã®ãŸ LT ãŒå¹¾ã¤ã‚ã£ã¦ã€ã¡ã‚‡ã†ã©æ°—ã«ãªã£ã¦ã„ãŸ \u003ca href=\"http://lokka.org/\"\u003eLokka\u003c/a\u003e ã®è©±ãŒã‚ã£ãŸã®ã§ã€è‡ªå®…ã«å¸°ã£ã¦ã‹ã‚‰è‡ªåˆ†ã® heroku ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ lokka ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã—ãŸã€‚lokka ã®å…¬å¼ã‚µã‚¤ãƒˆã«æ‰‹é †ãŒæ›¸ã„ã¦ã‚ã£ã¦ã€ãã®ã¾ã¾ãªã®ã§ã™ãŒè¡Œã£ãŸã®ã¯ã€\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% gem install heroku bundler\n% git clone git://github.com/komagata/lokka.git\n% cd lokka\n% heroku create\n% git push heroku master\n% heroku rake db:setup\n% heroku open\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã™ã‚Œã° OKã€‚\u003c/p\u003e","title":"Heroku JP Meetup #3"},{"content":"2012å¹´2æœˆ6æ—¥ã€è¥¿æ–°å®¿ã«ã‚ã‚‹æ ªå¼ä¼šç¤¾ãƒ‹ãƒ•ãƒ†ã‚£ã•ã‚“ã§è¡Œã‚ã‚ŒãŸ \u0026ldquo;OpenFlow å‹‰å¼·ä¼š\u0026rdquo; ã«å‚åŠ ã—ãŸã®ã§ç°¡å˜ãªãƒ¬ãƒãƒ¡ãƒ¢ã‚’æ›¸ã„ã¦ãŠãã¾ã™ã€‚\nã¾ãšã¯ OpenFlow ã®åŸºæœ¬å‹•ä½œã€‚\nãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®åˆ‡ã‚Šå‡ºã— ãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã®ç¶­æŒ ã‚¹ã‚¤ãƒƒãƒã‹ã‚‰é€ã‚‰ã‚Œã¦ãã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¸ã®å¿œç­” æ§‹æˆã¯\nOpenFlow ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©, ã‚¹ã‚¤ãƒƒãƒã‹ã‚‰æˆã‚‹ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯é€šä¿¡åˆ¶å¾¡ ã‚¹ã‚¤ãƒƒãƒã¯ãƒ•ãƒ­ãƒ¼ãƒ«ãƒ¼ãƒ«ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«å•ã„åˆã‚ã›é€šä¿¡ã‚’å—ã‘æµã—(packet/frame è»¢é€) ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯ L2 - L4 ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¦‹ã¦åˆ¶å¾¡ã™ã‚‹ ãã—ã¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã€ã‚¹ã‚¤ãƒƒãƒã¯å„ç¤¾ãƒ»å›£ä½“ã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ã‚‹ã€‚ä»Šæœˆã‚‚ Nicira Networks ã•ã‚“ãŒè‡ªç¤¾ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹æˆã‚’æŠ½è±¡çš„ã§ã¯ã‚ã‚Šã¾ã™ãŒå…¬é–‹ã•ã‚Œã€HP ã•ã‚“ã‚‚ OpenFlow å¯¾å¿œã‚¹ã‚¤ãƒƒãƒã‚’12è£½å“ã»ã©ç™ºè¡¨ã•ã‚Œã¾ã—ãŸã€‚\nã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ç¨®åˆ¥ã€\nBeacon (Java) NOX (Python) Ryu NodeFlow Trema (C/ruby) Nicira Networks Big Switch Networks Midokura NTT Data ã‚¹ã‚¤ãƒƒãƒã®ç¨®åˆ¥ã€\ncisco nexus 3000 IBM BNT rackSwitch G8264 NEC Univerge PF5240/PF5820 Pronto Systems 3240/3290 HP 3500/5400 HP OpenFlow åŒ– firmware Reference Implementation (Software) Open vSwitch (Software) NEC ã•ã‚“ã® PF ã»ã«ã‚ƒã‚‰ã‚‰ã¯ã€GUI ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ API ã‚’æŒã£ãŸè£½å“ã§ OpenFlow 1.0.0 ä»•æ§˜ã«æº–æ‹ ã€‚ã‚¹ã‚¤ãƒƒãƒ25å°ã¾ã§ã‚’ç®¡ç†ã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã€‚ä¾¡æ ¼ã¯ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ© : 1000ä¸‡, ã‚¹ã‚¤ãƒƒãƒ : 250ä¸‡ ã ãã†ã§ã™ã€‚ã‚¹ã‚¤ãƒƒãƒ25å°ã¯ã‚ãã¾ã§ã‚‚ã‚½ãƒ•ãƒˆãƒªãƒŸãƒƒãƒˆã‚‰ã—ã„ã§ã™ã€‚\nTrema ã¯é–‹ç™ºè€…ãŒæ—¥æœ¬äººã§ OpenFlow 1.1.0 ã«æº–æ‹ ã€‚Ruby / C ã‚’ä½¿ã£ã¦ãƒ•ãƒ­ãƒ¼ãƒ«ãƒ¼ãƒ«ãŒæ›ã‘ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å‹ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã€github ã«ã‚ã‚‹ Wiki ã‚’è¦‹ã¦ã‚‚åˆ†ã‹ã‚Šã¾ã™ãŒã€ã¨ã¦ã‚‚ç°¡æ½”ãªãƒ«ãƒ¼ãƒ«è¨˜è¿°ãŒå¯èƒ½ã§ã™ã€‚ã‚ã¨ã€ç‰¹å¾´ãªã®ãŒãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯(ã‚·ãƒ¥ãƒŸãƒ¬ãƒ¼ã‚¿)ãŒä»˜ã„ã¦ã„ã‚‹ã®ã§ã€OpenFlow å¯¾å¿œã‚¹ã‚¤ãƒƒãƒã‚’è³¼å…¥ã—ãªãã¦ã‚‚è‡ªåˆ†ã§æ›¸ã„ãŸãƒ«ãƒ¼ãƒ«ãŒãƒ†ã‚¹ãƒˆå‡ºæ¥ã¾ã™ã€‚ã“ã‚Œã¯ã¨ã¦ã‚‚å¤§ããªæ„å‘³ãŒã‚ã‚‹ã€‚è‡ªå®…ã§ã‚‚ã‚ã‚Œã“ã‚Œãƒ«ãƒ¼ãƒ«ã‚’æ›¸ã‘ã¦å‹•ä½œã‚’çŸ¥ã‚‹ã«ã¯ã¨ã¦ã‚‚è‰¯ã„æ©Ÿèƒ½ã§ã™ã€‚\nNicira Networks ã® NVP (Nacira Virtual Platform) ã¯ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ä¸Šã® OpenvSwitch ã‚„ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãªã‚¹ã‚¤ãƒƒãƒã‚’ç®¡ç†ã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‹ã‚‰æˆã‚‹ã¨ä»Šæœˆå…¬é–‹ã•ã‚Œã¾ã—ãŸã€‚ãŸã æŠ½è±¡çš„ãªè¨€è‘‰ã°ã‹ã‚ŠãŒä¸¦ã‚“ã§ã„ã¦ ( web, datasheet å…±ã« ) ã¾ã ã¾ã ã€ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹ã«ã¯æƒ…å ±ãŒè¶³ã‚‰ãªã„ã®ã‹ãªãã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚ç‰¹ã« distributed controller ã¯ã©ã†å†—é•·å–ã‚Œã¦ã„ã‚‹ï¼Ÿãªã©ã€‚software designed network ã® ML ãŒæ—¥æœ¬ã§ã‚‚ç®¡ç†ã•ã‚Œå§‹ã‚ã¦è­°è«–ã•ã‚Œã¦ã„ã¾ã™ãŒã€ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ä¸Šã® OpenvSwitch ã§ã€ã‚«ãƒ—ã‚»ãƒ«åŒ–æ™‚ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’ã©ã†æ”»ç•¥ã™ã‚‹ã‹ï¼ŸãŒå•é¡Œã˜ã‚ƒãªã„ã‹ã¨è©±ã—åˆã‚ã‚Œã¦ã„ã¾ã™ã€‚\nMidokura ã•ã‚“ã‚‚ä¼šå ´ã«ã„ã‚‰ã£ã—ã‚ƒã£ãŸã®ã§ã™ãŒã€å°è±¡çš„ãªè¨€è‘‰ã¯ \u0026ldquo;OpenFlow ã¯å¤¢ã®æŠ€è¡“ã§ã¯ãªã„ã—ã€æ—¢å­˜ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŠ€è¡“ã‚’ç½®ãæ›ãˆã‚‹ã‚‚ã®ã§ã‚‚ãªã„\u0026rdquo; ã§ã—ãŸã€‚ã‚µãƒ¼ãƒ“ã‚¹ã‚’å½¢æˆã™ã‚‹ã‚µãƒ¼ãƒãƒ•ã‚¡ãƒ¼ãƒ å‘¨ã‚Šã§ OpenFlow ã‚’ä½¿ã£ãŸã‚·ã‚¹ãƒ†ãƒ ã‚’çµ„ã‚€ã«ã¯è‰¯ã„ã§ã™ã‘ã©ã­ã€‚\næœ€å¾Œã«å‚è€ƒ URL ã‚’è¨˜ã—ã¦ãŠãã¾ã™ã€‚\nsdnstudy google group trema Nicira Virtual Platform ","permalink":"https://jedipunkz.github.io/post/2012/03/07/openflow-mian-qiang-hui/","summary":"\u003cp\u003e2012å¹´2æœˆ6æ—¥ã€è¥¿æ–°å®¿ã«ã‚ã‚‹æ ªå¼ä¼šç¤¾ãƒ‹ãƒ•ãƒ†ã‚£ã•ã‚“ã§è¡Œã‚ã‚ŒãŸ \u0026ldquo;OpenFlow å‹‰å¼·ä¼š\u0026rdquo; ã«å‚åŠ ã—ãŸã®ã§ç°¡å˜ãªãƒ¬ãƒãƒ¡ãƒ¢ã‚’æ›¸ã„ã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eã¾ãšã¯ OpenFlow ã®åŸºæœ¬å‹•ä½œã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®åˆ‡ã‚Šå‡ºã—\u003c/li\u003e\n\u003cli\u003eãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯\u003c/li\u003e\n\u003cli\u003eã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã®ç¶­æŒ\u003c/li\u003e\n\u003cli\u003eã‚¹ã‚¤ãƒƒãƒã‹ã‚‰é€ã‚‰ã‚Œã¦ãã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¸ã®å¿œç­”\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ§‹æˆã¯\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eOpenFlow ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©, ã‚¹ã‚¤ãƒƒãƒã‹ã‚‰æˆã‚‹\u003c/li\u003e\n\u003cli\u003eã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯é€šä¿¡åˆ¶å¾¡\u003c/li\u003e\n\u003cli\u003eã‚¹ã‚¤ãƒƒãƒã¯ãƒ•ãƒ­ãƒ¼ãƒ«ãƒ¼ãƒ«ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«å•ã„åˆã‚ã›é€šä¿¡ã‚’å—ã‘æµã—(packet/frame è»¢é€)\u003c/li\u003e\n\u003cli\u003eã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯ L2 - L4 ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¦‹ã¦åˆ¶å¾¡ã™ã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eãã—ã¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã€ã‚¹ã‚¤ãƒƒãƒã¯å„ç¤¾ãƒ»å›£ä½“ã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ã‚‹ã€‚ä»Šæœˆã‚‚ Nicira Networks ã•ã‚“ãŒè‡ªç¤¾ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹æˆã‚’æŠ½è±¡çš„ã§ã¯ã‚ã‚Šã¾ã™ãŒå…¬é–‹ã•ã‚Œã€HP ã•ã‚“ã‚‚ OpenFlow å¯¾å¿œã‚¹ã‚¤ãƒƒãƒã‚’12è£½å“ã»ã©ç™ºè¡¨ã•ã‚Œã¾ã—ãŸã€‚\u003c/p\u003e\n\u003cp\u003eã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ç¨®åˆ¥ã€\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBeacon (Java)\u003c/li\u003e\n\u003cli\u003eNOX (Python)\u003c/li\u003e\n\u003cli\u003eRyu\u003c/li\u003e\n\u003cli\u003eNodeFlow\u003c/li\u003e\n\u003cli\u003eTrema (C/ruby)\u003c/li\u003e\n\u003cli\u003eNicira Networks\u003c/li\u003e\n\u003cli\u003eBig Switch Networks\u003c/li\u003e\n\u003cli\u003eMidokura\u003c/li\u003e\n\u003cli\u003eNTT Data\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã‚¹ã‚¤ãƒƒãƒã®ç¨®åˆ¥ã€\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecisco nexus 3000\u003c/li\u003e\n\u003cli\u003eIBM BNT rackSwitch G8264\u003c/li\u003e\n\u003cli\u003eNEC Univerge PF5240/PF5820\u003c/li\u003e\n\u003cli\u003ePronto Systems 3240/3290\u003c/li\u003e\n\u003cli\u003eHP 3500/5400\u003c/li\u003e\n\u003cli\u003eHP OpenFlow åŒ– firmware\u003c/li\u003e\n\u003cli\u003eReference Implementation (Software)\u003c/li\u003e\n\u003cli\u003eOpen vSwitch (Software)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eNEC ã•ã‚“ã® PF ã»ã«ã‚ƒã‚‰ã‚‰ã¯ã€GUI ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ API ã‚’æŒã£ãŸè£½å“ã§ OpenFlow 1.0.0 ä»•æ§˜ã«æº–æ‹ ã€‚ã‚¹ã‚¤ãƒƒãƒ25å°ã¾ã§ã‚’ç®¡ç†ã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã€‚ä¾¡æ ¼ã¯ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ© : 1000ä¸‡, ã‚¹ã‚¤ãƒƒãƒ : 250ä¸‡ ã ãã†ã§ã™ã€‚ã‚¹ã‚¤ãƒƒãƒ25å°ã¯ã‚ãã¾ã§ã‚‚ã‚½ãƒ•ãƒˆãƒªãƒŸãƒƒãƒˆã‚‰ã—ã„ã§ã™ã€‚\u003c/p\u003e","title":"OpenFlow å‹‰å¼·ä¼š"},{"content":"MS Windows ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†æ–¹æ³•ã ã£ãŸã‚Šã€vmlinuz, initrd ã‚’ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ã§ã‚³ãƒ”ãƒ¼ã—ãŸã‚Šã€ä½•æ•…ã‹ã„ã¤ã‚‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§èª¿ã¹ã‚‹ã¨ USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã‚’åˆ©ç”¨ã—ãŸ debian ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ãŒ\u0026rsquo;é¢å€’\u0026rsquo;, \u0026lsquo;ä¸ç¢ºã‹\u0026rsquo; ãªã®ã§ã€å¿˜ã‚Œãªã„ã‚ˆã†ã«ãƒ¡ãƒ¢ã€‚\næ‰‹å…ƒã« linux ç«¯æœ«ç”¨æ„ã—ã¦ã€USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯æŒ¿ã™ã€‚\n% wget ftp://ftp.jp.debian.org/pub/Linux/debian-cd/6.0.3/amd64/iso-cd/debian-6.0.3-amd64-netinst.iso % sudo cat debian-6.0.3-amd64-netinst.iso \u0026gt; /dev/sdb # æŒ¿ã—ãŸ USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã®ãƒ‡ãƒã‚¤ã‚¹å ã§çµ‚ã‚ã‚Šã€‚\nãŸã å¼±ç‚¹ãŒã‚ã£ã¦ã€ãƒ•ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã® iso ã¯åˆ©ç”¨ã§ããªã„ã§ã®ã€ä»Šå›ã¿ãŸã„ã« netinstall ã ã£ãŸã‚Š businesscard ãª iso ã‚’åˆ©ç”¨ã—ã‹ãªã„ã€‚ ä»–ã®ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ã ã‘ã©ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ç’°å¢ƒã¯ãƒãƒƒãƒˆã«ç¹‹ãŒã£ã¦ã„ãªã„ã¨ä¸éƒ½åˆãŒã‚ã‚‹ã£ã¦æ™‚ä»£ã ã‹ã‚‰ã„ã„ã‹ãªãã€‚\nä¸€æ–¹ã€Ubuntu Server ã¯è³¢ã„å­ãªã®ã§ å…¬å¼ã‚µã‚¤ãƒˆ ã«è¡Œãã¨ USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯ç”¨ã® iso ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ããŸã‚Š iso ã‚’ç„¼ãç’°å¢ƒã«åˆã‚ã›ã¦æ‰‹é †ã¾ã§æ•™ãˆã¦ãã‚Œã‚‹\u0026hellip;ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/03/07/usb-stick-de-debian-gnu-slash-linux-insutoru/","summary":"\u003cp\u003eMS Windows ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†æ–¹æ³•ã ã£ãŸã‚Šã€vmlinuz, initrd ã‚’ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ã§ã‚³ãƒ”ãƒ¼ã—ãŸã‚Šã€ä½•æ•…ã‹ã„ã¤ã‚‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§èª¿ã¹ã‚‹ã¨ USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã‚’åˆ©ç”¨ã—ãŸ debian ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ãŒ\u0026rsquo;é¢å€’\u0026rsquo;, \u0026lsquo;ä¸ç¢ºã‹\u0026rsquo; ãªã®ã§ã€å¿˜ã‚Œãªã„ã‚ˆã†ã«ãƒ¡ãƒ¢ã€‚\u003c/p\u003e\n\u003cp\u003eæ‰‹å…ƒã« linux ç«¯æœ«ç”¨æ„ã—ã¦ã€USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯æŒ¿ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% wget ftp://ftp.jp.debian.org/pub/Linux/debian-cd/6.0.3/amd64/iso-cd/debian-6.0.3-amd64-netinst.iso\n% sudo cat debian-6.0.3-amd64-netinst.iso \u0026gt; /dev/sdb # æŒ¿ã—ãŸ USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã®ãƒ‡ãƒã‚¤ã‚¹å\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã§çµ‚ã‚ã‚Šã€‚\u003c/p\u003e\n\u003cp\u003eãŸã å¼±ç‚¹ãŒã‚ã£ã¦ã€ãƒ•ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã® iso ã¯åˆ©ç”¨ã§ããªã„ã§ã®ã€ä»Šå›ã¿ãŸã„ã« netinstall ã ã£ãŸã‚Š businesscard ãª iso ã‚’åˆ©ç”¨ã—ã‹ãªã„ã€‚\nä»–ã®ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ã ã‘ã©ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ç’°å¢ƒã¯ãƒãƒƒãƒˆã«ç¹‹ãŒã£ã¦ã„ãªã„ã¨ä¸éƒ½åˆãŒã‚ã‚‹ã£ã¦æ™‚ä»£ã ã‹ã‚‰ã„ã„ã‹ãªãã€‚\u003c/p\u003e\n\u003cp\u003eä¸€æ–¹ã€Ubuntu Server ã¯è³¢ã„å­ãªã®ã§ \u003ca href=\"http://www.ubuntu.com/download/ubuntu/download\" target=\"blank\"\u003eå…¬å¼ã‚µã‚¤ãƒˆ\u003c/a\u003e ã«è¡Œãã¨ USB ã‚¹ãƒ†ã‚£ãƒƒã‚¯ç”¨ã® iso ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ããŸã‚Š iso ã‚’ç„¼ãç’°å¢ƒã«åˆã‚ã›ã¦æ‰‹é †ã¾ã§æ•™ãˆã¦ãã‚Œã‚‹\u0026hellip;ã€‚\u003c/p\u003e","title":"USB Stick ã§ Debian Gnu/Linux ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"},{"content":"ãƒ–ãƒ­ã‚°ã‚’å§‹ã‚ã‚‹ã«ã‚ãŸã‚Šã€wordpress ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹å¿…è¦ãŒå‡ºã¦ãã¾ã—ãŸã€‚ã„ã¤ã‚‚ã® apache2 + mysql5 + PHP ã˜ã‚ƒã¤ã¾ã‚‰ãªã„ã®ã§ã€nginx ã¨ fastcgi ã‚’ä½¿ã£ã¦å°‘ã—ã ã‘é«˜é€ŸåŒ–ã—ã¦ã¿ã¾ã—ãŸã€‚ãƒ¡ãƒ¢ã§ã™ã‘ã©ã€ã“ã“ã«æ‰‹é †ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\nâ€» wordpress ã‹ã‚‰ octopress ã«ç§»è¡Œã—ã¾ã—ãŸ\u0026hellip; (2012/03/07)\nãŸã ã€ä»Šå›ã¯ nginx ã‚„ mysql ã®åŸºæœ¬çš„ãªã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †ã¯å‰²æ„›ã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚\nç§ã®ç’°å¢ƒã«ã¤ã„ã¦\u0026hellip;\n% lsb_release -a No LSB modules are available. Distributor ID: Debian Description: Debian GNU/Linux 6.0.3 (squeeze) Release: 6.0.3 Codename: squeeze ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‚ã®\u0026hellip; ãƒ¡ã‚¿ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ãŸã®ã§ãã®ä»–å¿…è¦ãªãƒ¢ãƒã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚\n% sudo apt-get update % sudo apt-get install spawn-fcgi php5 php5-mysql php5-cgi mysql-server nginx ã¾ãšã¯ãŠæ±ºã¾ã‚Šã® gzip åœ§ç¸®è»¢é€ã€‚IE ã®å¤ã„ãƒ¢ãƒä»¥å¤–ã¯å¯¾å¿œã—ã¦ã„ã‚‹ã®ã§å¿ƒé…ãªã—ã€‚ä»Šå›ã®ãƒ†ãƒ¼ãƒã¨é–¢ä¿‚ç„¡ã„ã§ã™ã‘ã©ã€ä¸€å¿œå…¥ã‚Œã¦ãŠãã¾ã™ã€‚\n% diff -u /etc/nginx/nginx.conf.org /etc/nginx/nginx.conf --- /etc/nginx/nginx.conf.org 2012-01-14 15:27:45.000000000 +0900 +++ /etc/nginx/nginx.conf 2012-01-14 15:28:58.000000000 +0900 @@ -22,6 +22,10 @@ tcp_nodelay on; gzip on; + gzip_http_version 1.0; + gzip_vary on; + gzip_comp_level 6; + gzip_types text/html text/xml text/css application/xhtml+xml application/xml application/rss+xml application/atom_xml application/x-javascript application/x-httpd-php; gzip_disable \u0026quot;MSIE [1-6]\\.(?!.*SV1)\u0026quot;; include /etc/nginx/conf.d/*.conf; spawn-fcgi ã‚’ç¨¼åƒã•ã›ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã€‚/usr/bin/php-fastcgi ã¨ã—ã¦ä¸‹è¨˜ã®å†…å®¹ã§ä¿å­˜ã™ã‚‹ã€‚\n#! /bin/sh /usr/bin/spawn-fcgi -a 127.0.0.1 -p 9000 -C 6 -u www-data -f /usr/bin/php5-cgi % sudo chmod 755 /usr/bin/php-fastcgi æ¬¡ã«ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ç”¨æ„ã¨å®Ÿè¡Œã€‚/etc/init.d/php-fastcgi\n#!/bin/bash ### BEGIN INIT INFO # Required-Start: $local_fs $remote_fs $network $syslog # Required-Stop: $local_fs $remote_fs $network $syslog # Default-Start: 2 3 4 5 # Default-Stop: 0 1 6 # Short-Description: php-fastcgi script # Description: php-fastcgi script ### END INIT INFO # env SCRIPT=/usr/bin/php-fastcgi USER=www-data RETVAL=0 PIDFILE=/var/run/php5-cgi.pid # start or stop case \u0026quot;$1\u0026quot; in start) su - $USER -c $SCRIPT pidof php5-cgi \u0026gt; $PIDFILE RETVAL=$? ;; stop) killall -9 php5-cgi echo '' \u0026gt; $PIDFILE RETVAL=$? ;; restart) killall -9 php5-cgi su - $USER -c $SCRIPT pidof php5-cgi \u0026gt; $PIDFILE RETVAL=$? ;; *) echo \u0026quot;Usage: php-fastcgi {start|stop|restart}\u0026quot; exit 1 ;; esac èµ·å‹•ã™ã‚‹ã¨ php-cgi ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒç«‹ã¡ä¸ŠãŒã‚Š localhost:9000 ã§ LISTEN ã•ã‚ŒãŸçŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚nginx ã¯ã“ã“ã¸ã®ãƒ—ãƒ­ã‚­ã‚·ã®ã‚ˆã†ãªå‹•ä½œã‚’ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ ä¸‹è¨˜ã®æ‰‹é †ã§èµ·å‹•ã¨èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¸ã®çµ„ã¿è¾¼ã¿ã‚’è¡Œãªã£ã¦ãã ã•ã„ã€‚\n% sudo chmod 755 /etc/init.d/php-fastcgi % sudo update-rc.d php-fastcgi defaults % sudo service php-fastcgi start æ¬¡ã« nginx ã® virtualhost ã‚’æ˜ã‚Šã¾ã™ã€‚å¤‰æ•° ${FQDN_HOSTNAME}, ${DOCUMENT_ROOT}ã¯è‡ªåˆ† ã®ç’°å¢ƒæƒ…å ±ã«èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚\nserver { listen 80; server_name ${FQDN_HOSTNAME} access_log /var/log/nginx/${FQDN_HOSTNAME}.access.log; error_log /var/log/nginx/${FQDN_HOSTNAME}.error.log; location / { root ${DOCUMENT_ROOT}; index index.html index.php; } location ~ \\.php$ { include /etc/nginx/fastcgi_params; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME ${DOCUMENT_ROOT}$fastcgi_script_name; } } nginx ã‚’ stop/start ã—ã¦ã“ã‚Œã‚‰ã®è¨­å®šã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚\n% sudo service nginx stop % sudo service nginx start ä»¥ä¸Šã§ã™ã€‚\nãã®ä»–ã«ã‚‚ proxy cache ã‚’æœ‰åŠ¹ã«ã—ã¦ wordpress ã®é™çš„ãªå‡ºåŠ›ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°æ–¹æ³•ã‚‚ã‚ã‚‹ãã†ãªã®ã§ã€æ¬¡å›è©¦ã—ã¦ã¿ã¾ã™ã€‚\n","permalink":"https://jedipunkz.github.io/post/2012/03/07/wordpress-wo-nginx-plus-fastcgi-degao-su-hua/","summary":"\u003cp\u003eãƒ–ãƒ­ã‚°ã‚’å§‹ã‚ã‚‹ã«ã‚ãŸã‚Šã€wordpress ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹å¿…è¦ãŒå‡ºã¦ãã¾ã—ãŸã€‚ã„ã¤ã‚‚ã® apache2 + mysql5 + PHP ã˜ã‚ƒã¤ã¾ã‚‰ãªã„ã®ã§ã€nginx ã¨ fastcgi ã‚’ä½¿ã£ã¦å°‘ã—ã ã‘é«˜é€ŸåŒ–ã—ã¦ã¿ã¾ã—ãŸã€‚ãƒ¡ãƒ¢ã§ã™ã‘ã©ã€ã“ã“ã«æ‰‹é †ã‚’è¨˜ã—ã¦ã„ãã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eâ€» wordpress ã‹ã‚‰ octopress ã«ç§»è¡Œã—ã¾ã—ãŸ\u0026hellip; (2012/03/07)\u003c/p\u003e\n\u003cp\u003eãŸã ã€ä»Šå›ã¯ nginx ã‚„ mysql ã®åŸºæœ¬çš„ãªã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †ã¯å‰²æ„›ã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚\u003c/p\u003e\n\u003cp\u003eç§ã®ç’°å¢ƒã«ã¤ã„ã¦\u0026hellip;\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% lsb_release -a\nNo LSB modules are available.\nDistributor ID: Debian\nDescription:    Debian GNU/Linux 6.0.3 (squeeze)\nRelease:        6.0.3\nCodename:       squeeze\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‚ã®\u0026hellip;\nãƒ¡ã‚¿ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ãŸã®ã§ãã®ä»–å¿…è¦ãªãƒ¢ãƒã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% sudo apt-get update\n% sudo apt-get install spawn-fcgi php5 php5-mysql php5-cgi mysql-server nginx \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eã¾ãšã¯ãŠæ±ºã¾ã‚Šã® gzip åœ§ç¸®è»¢é€ã€‚IE ã®å¤ã„ãƒ¢ãƒä»¥å¤–ã¯å¯¾å¿œã—ã¦ã„ã‚‹ã®ã§å¿ƒé…ãªã—ã€‚ä»Šå›ã®ãƒ†ãƒ¼ãƒã¨é–¢ä¿‚ç„¡ã„ã§ã™ã‘ã©ã€ä¸€å¿œå…¥ã‚Œã¦ãŠãã¾ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e% diff -u /etc/nginx/nginx.conf.org /etc/nginx/nginx.conf\n--- /etc/nginx/nginx.conf.org   2012-01-14 15:27:45.000000000 +0900\n+++ /etc/nginx/nginx.conf       2012-01-14 15:28:58.000000000 +0900\n@@ -22,6 +22,10 @@\n     tcp_nodelay        on;\n  \n     gzip  on;\n+    gzip_http_version 1.0;\n+    gzip_vary         on;\n+    gzip_comp_level   6;\n+    gzip_types        text/html text/xml text/css application/xhtml+xml application/xml application/rss+xml application/atom_xml application/x-javascript application/x-httpd-php;\n     gzip_disable \u0026quot;MSIE [1-6]\\.(?!.*SV1)\u0026quot;;\n \n     include /etc/nginx/conf.d/*.conf;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003espawn-fcgi ã‚’ç¨¼åƒã•ã›ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã€‚/usr/bin/php-fastcgi ã¨ã—ã¦ä¸‹è¨˜ã®å†…å®¹ã§ä¿å­˜ã™ã‚‹ã€‚\u003c/p\u003e","title":"WordPress ã‚’ nginx + fastcgi ã§é«˜é€ŸåŒ–"}]
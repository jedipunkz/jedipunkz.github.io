<!DOCTYPE HTML>

<html>
    <head>
        
            
                <title>Chef 11 サーバのローカルネットワーク上構築</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.17" />
        


        
        
            
                <meta name="description" content="技術ネタを書いていきます">
            
        

        

  <meta name="twitter:card" content="summary"/>



<meta name="twitter:title" content="Chef 11 サーバのローカルネットワーク上構築"/>
<meta name="twitter:description" content="chef-solo を使うの？Chef サーバを使うの？という議論は結構前からあるし、答えは 「それぞれの環境次第」だと思うのだが、僕は個人的に Chef サーバを使ってます。ホ ステッド Chef を使いたいけどお金ないし。会社で導入する時はホステッド Chef を契 約してもらうことを企んでます。(・∀・) 何故なら cookbooks を開発することがエン ジニアの仕事の本質であって Chef サーバを運用管理することは本質ではないから。そ れこそクラウド使えという話だと思う。
でも！Chef に慣れるには無料で使いたいし、継続的に Cookbooks をターゲットノード で実行したい。ということで Chef サーバを構築して使っています。
Chef 10 の時代は Chef サーバの構築方法は下記の通り3つありました。
 手作業！ Bootstrap 構築 Opscode レポジトリの Debian, Ubuntu, CentOS パッケージ構築  それが Chef 11 では
 Ubuntu, RHEL のパッケージ (パッケージインストールですべて環境が揃う)  http://www.opscode.com/chef/install/
この方法1つだけ。でも簡単になりました。
&lsquo;Chef Server&rsquo; タブを選択するとダウンロード出来る。じっくりは deb ファイルの中 身を見たことがないけど、チラ見した時に chef を deb の中で実行しているように見 えた。徹底してるｗ
Chef 10 時代のパッケージと違って行う操作は下記の2つのコマンドだけ。
% sudo dpkg -i chef-server_11."/>
<meta name="twitter:site" content="@jedipunkz"/>


        <meta property="og:title" content="Chef 11 サーバのローカルネットワーク上構築" />
<meta property="og:description" content="chef-solo を使うの？Chef サーバを使うの？という議論は結構前からあるし、答えは 「それぞれの環境次第」だと思うのだが、僕は個人的に Chef サーバを使ってます。ホ ステッド Chef を使いたいけどお金ないし。会社で導入する時はホステッド Chef を契 約してもらうことを企んでます。(・∀・) 何故なら cookbooks を開発することがエン ジニアの仕事の本質であって Chef サーバを運用管理することは本質ではないから。そ れこそクラウド使えという話だと思う。
でも！Chef に慣れるには無料で使いたいし、継続的に Cookbooks をターゲットノード で実行したい。ということで Chef サーバを構築して使っています。
Chef 10 の時代は Chef サーバの構築方法は下記の通り3つありました。
 手作業！ Bootstrap 構築 Opscode レポジトリの Debian, Ubuntu, CentOS パッケージ構築  それが Chef 11 では
 Ubuntu, RHEL のパッケージ (パッケージインストールですべて環境が揃う)  http://www.opscode.com/chef/install/
この方法1つだけ。でも簡単になりました。
&lsquo;Chef Server&rsquo; タブを選択するとダウンロード出来る。じっくりは deb ファイルの中 身を見たことがないけど、チラ見した時に chef を deb の中で実行しているように見 えた。徹底してるｗ
Chef 10 時代のパッケージと違って行う操作は下記の2つのコマンドだけ。
% sudo dpkg -i chef-server_11." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://jedipunkz.github.io/blog/2013/04/06/chef-11-private-network/" />


<meta property="og:updated_time" content="2013-04-06T00:00:00&#43;00:00"/>










        
<meta itemprop="name" content="Chef 11 サーバのローカルネットワーク上構築">
<meta itemprop="description" content="chef-solo を使うの？Chef サーバを使うの？という議論は結構前からあるし、答えは 「それぞれの環境次第」だと思うのだが、僕は個人的に Chef サーバを使ってます。ホ ステッド Chef を使いたいけどお金ないし。会社で導入する時はホステッド Chef を契 約してもらうことを企んでます。(・∀・) 何故なら cookbooks を開発することがエン ジニアの仕事の本質であって Chef サーバを運用管理することは本質ではないから。そ れこそクラウド使えという話だと思う。
でも！Chef に慣れるには無料で使いたいし、継続的に Cookbooks をターゲットノード で実行したい。ということで Chef サーバを構築して使っています。
Chef 10 の時代は Chef サーバの構築方法は下記の通り3つありました。
 手作業！ Bootstrap 構築 Opscode レポジトリの Debian, Ubuntu, CentOS パッケージ構築  それが Chef 11 では
 Ubuntu, RHEL のパッケージ (パッケージインストールですべて環境が揃う)  http://www.opscode.com/chef/install/
この方法1つだけ。でも簡単になりました。
&lsquo;Chef Server&rsquo; タブを選択するとダウンロード出来る。じっくりは deb ファイルの中 身を見たことがないけど、チラ見した時に chef を deb の中で実行しているように見 えた。徹底してるｗ
Chef 10 時代のパッケージと違って行う操作は下記の2つのコマンドだけ。
% sudo dpkg -i chef-server_11.">


<meta itemprop="dateModified" content="2013-04-06T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="156">



<meta itemprop="keywords" content="infrastructure,report,tools," />

        

        

        
        
            
        

        
        
            <link rel="stylesheet" href="/css/google-font.css" />
            <link rel="stylesheet" href="/css/font-awesome.min.css" />
            <link rel="stylesheet" href="/css/main.css" />
            <link rel="stylesheet" href="/css/add-on.css" />
            <link rel="stylesheet" href="/css/monokai-sublime.css">
        

        

        
        
        
            
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30563095-1', 'auto');
ga('send', 'pageview');
</script>

        
    </head>
    <body>

        
        <div id="wrapper">

    
    
<header id="header">
    
        <h2><a href="/">ジェダイさんのブログ</i></a></h2>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/post">
                        
                            <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                    </a>
                </li>
            
                <li>
                    <a href="/categories">
                        Categories
                    </a>
                </li>
            
                <li>
                    <a href="/about">
                        About
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="q" value="site:http://jedipunkz.github.io/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="q" value="site:http://jedipunkz.github.io/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/post">
                            <h3>
                                
                                    <i class="fa fa-newspaper-o">&nbsp;</i>
                                
                                Blog
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories">
                            <h3>
                                
                                Categories
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/about">
                            <h3>
                                
                                About
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section>
            <ul class="links">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                
                    
                

                
                    <li>
                        <a href="http://jedipunkz.github.io/blog/2016/11/03/kubernetes-scheduledjob/"><p>kubernetes1.4 で実装された ScheduledJob を試してみた！</p></a>
                    </li>
                
                    <li>
                        <a href="http://jedipunkz.github.io/blog/2016/07/25/minikube/"><p>Minikube で簡易 kubernetes 環境構築</p></a>
                    </li>
                
                    <li>
                        <a href="http://jedipunkz.github.io/blog/2016/07/23/influxdb-go/"><p>Go言語とInfluxDBで監視のコード化</p></a>
                    </li>
                
                    <li>
                        <a href="http://jedipunkz.github.io/blog/2016/07/14/test-kitchen-with-ansible/"><p>Test-Kitchen, Docker で Ansible Role 開発サイクル高速化！</p></a>
                    </li>
                
            </ul>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            


<li><a href="//twitter.com/share?url=http%3a%2f%2fjedipunkz.github.io%2fblog%2f2013%2f04%2f06%2fchef-11-private-network%2f&text=Chef%2011%20%e3%82%b5%e3%83%bc%e3%83%90%e3%81%ae%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%ab%e3%83%8d%e3%83%83%e3%83%88%e3%83%af%e3%83%bc%e3%82%af%e4%b8%8a%e6%a7%8b%e7%af%89&via=jedipunkz" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
</a></li>


<li><a href="//plus.google.com/share?url=http%3a%2f%2fjedipunkz.github.io%2fblog%2f2013%2f04%2f06%2fchef-11-private-network%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
</a></li>


<li><a href="//www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fjedipunkz.github.io%2fblog%2f2013%2f04%2f06%2fchef-11-private-network%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
</a></li>


<li><a href="//reddit.com/submit?url=http%3a%2f%2fjedipunkz.github.io%2fblog%2f2013%2f04%2f06%2fchef-11-private-network%2f&title=Chef%2011%20%e3%82%b5%e3%83%bc%e3%83%90%e3%81%ae%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%ab%e3%83%8d%e3%83%83%e3%83%88%e3%83%af%e3%83%bc%e3%82%af%e4%b8%8a%e6%a7%8b%e7%af%89" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
</a></li>



















        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
    <header>
    <div class="title">
        
            <h1><a href="http://jedipunkz.github.io/blog/2013/04/06/chef-11-private-network/">Chef 11 サーバのローカルネットワーク上構築</a></h1>
            
        
        
    </div>
    <div class="meta">
        
            
        

        <time class="published"
            datetime='2013-04-06'>
            April 6, 2013</time>
        <span class="author"></span>
        
            <p>1 minute read</p>
        
        
    </div>
</header>


    <section id="social-share">
        <ul class="icons">
            


<li><a href="//twitter.com/share?url=http%3a%2f%2fjedipunkz.github.io%2fblog%2f2013%2f04%2f06%2fchef-11-private-network%2f&text=Chef%2011%20%e3%82%b5%e3%83%bc%e3%83%90%e3%81%ae%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%ab%e3%83%8d%e3%83%83%e3%83%88%e3%83%af%e3%83%bc%e3%82%af%e4%b8%8a%e6%a7%8b%e7%af%89&via=jedipunkz" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
</a></li>


<li><a href="//plus.google.com/share?url=http%3a%2f%2fjedipunkz.github.io%2fblog%2f2013%2f04%2f06%2fchef-11-private-network%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
</a></li>


<li><a href="//www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fjedipunkz.github.io%2fblog%2f2013%2f04%2f06%2fchef-11-private-network%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
</a></li>


<li><a href="//reddit.com/submit?url=http%3a%2f%2fjedipunkz.github.io%2fblog%2f2013%2f04%2f06%2fchef-11-private-network%2f&title=Chef%2011%20%e3%82%b5%e3%83%bc%e3%83%90%e3%81%ae%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%ab%e3%83%8d%e3%83%83%e3%83%88%e3%83%af%e3%83%bc%e3%82%af%e4%b8%8a%e6%a7%8b%e7%af%89" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
</a></li>



















        </ul>
    </section>
    

    <div id="content">
        

<p>chef-solo を使うの？Chef サーバを使うの？という議論は結構前からあるし、答えは
「それぞれの環境次第」だと思うのだが、僕は個人的に Chef サーバを使ってます。ホ
ステッド Chef を使いたいけどお金ないし。会社で導入する時はホステッド Chef を契
約してもらうことを企んでます。(・∀・) 何故なら cookbooks を開発することがエン
ジニアの仕事の本質であって Chef サーバを運用管理することは本質ではないから。そ
れこそクラウド使えという話だと思う。</p>

<p>でも！Chef に慣れるには無料で使いたいし、継続的に Cookbooks をターゲットノード
で実行したい。ということで Chef サーバを構築して使っています。</p>

<p>Chef 10 の時代は Chef サーバの構築方法は下記の通り3つありました。</p>

<ul>
<li>手作業！</li>
<li>Bootstrap 構築</li>
<li>Opscode レポジトリの Debian, Ubuntu, CentOS パッケージ構築</li>
</ul>

<p>それが Chef 11 では</p>

<ul>
<li>Ubuntu, RHEL のパッケージ (パッケージインストールですべて環境が揃う)</li>
</ul>

<p><a href="http://www.opscode.com/chef/install/">http://www.opscode.com/chef/install/</a></p>

<p>この方法1つだけ。でも簡単になりました。</p>

<p>&lsquo;Chef Server&rsquo; タブを選択するとダウンロード出来る。じっくりは deb ファイルの中
身を見たことがないけど、チラ見した時に chef を deb の中で実行しているように見
えた。徹底してるｗ</p>

<p>Chef 10 時代のパッケージと違って行う操作は下記の2つのコマンドだけ。</p>

<pre><code>% sudo dpkg -i chef-server_11.0.6-1.ubuntu.12.04_amd64.deb # ダウンロードしたもの
% sudo chef-server-ctl reconfigure
</code></pre>

<p>簡単。でも&hellip; この状態だと https://&lt;サーバの FQDN&gt; でサーバが Listen している。
IP アドレスでアクセスしてもリダイレクトされる。つまり、ローカルネットワーク上
に構築することが出来ない。安易に hosts で解決も出来ない。何故ならターゲットノー
ドは通常まっさらな状態なので bootstrap するたびに hosts を書くなんてアホらしい
しやってはいけない。</p>

<p>今日の本題。ローカルネットワーク上に Chef 11 サーバを構築する方法を調べました。</p>

<h2 id="修正箇所">修正箇所</h2>

<ul>
<li>/var/opt/chef-server/chef-pedant/etc/pedant_config.rb</li>
</ul>

<p>URL を IP アドレスに変更する。</p>

<pre><code>chef_server &quot;https://chef.example.com&quot;
</code></pre>

<ul>
<li>/var/opt/chef-server/erchef/etc/app.config</li>
</ul>

<p>URL を IP アドレスに変更する。</p>

<pre><code>{s3_url, &quot;https://chef.example.com&quot;},
</code></pre>

<ul>
<li>/var/opt/chef-server/nginx/etc/nginx.conf</li>
</ul>

<p>URL を IP アドレスに変更する。2箇所あるので注意。鍵ファイルにも FQDN が記され
ているがそれらは変更しない。</p>

<pre><code>server_name chef.example.com;
</code></pre>

<ul>
<li>/etc/chef-server/chef-server-running.json</li>
</ul>

<p>URL を IP アドレスに変更する。鍵ファイルにも FQDN が記されているがそれらは変更
しない。</p>

<pre><code>&quot;vip&quot;: &quot;chef.example.com&quot;,
&quot;api_fqdn&quot;: &quot;chef.example.com&quot;,
&quot;web_ui_fqdn&quot;: &quot;chef.example.com&quot;,
&quot;server_name&quot;: &quot;chef.example.com&quot;,
&quot;url&quot;: &quot;https://chef.example.com&quot;,
</code></pre>

<p>最後に Chef サーバを再起動する。</p>

<pre><code>% sudo chef-server-ctl restart
</code></pre>

<h2 id="まとめ">まとめ</h2>

<p>会社で、この環境を使って色々試しています。今のところ不具合なく動作している。強
引ワザなのでもっと綺麗な方法を知っている方がいましたら教えて下さい。
m ( _ _ ) m</p>

    </div>

    <footer>
        <ul class="stats">
    
        

        
        
            <li>
                
                
                    

                    

                    

                    
                        Category
                    
                
            </li>
        
    

    
    
        <li><a href='/categoriesinfrastructure'>infrastructure</a></li>
    
</ul>

    </footer>
</article>
<ul class="actions pagination">
    
        <li><a href="http://jedipunkz.github.io/blog/2013/04/06/cloudmanagement/"
                class="button big previous">クラウドマネジメント勉強会レポ</a></li>
    

    
        <li><a href="http://jedipunkz.github.io/blog/2013/04/20/openstack-grizzly-installation-script/"
                class="button big next">OpenStack Grizzly 構築スクリプト</a></li>
    
</ul>




    </div>
    
<section id="sidebar">

    
        <section id="intro">
            
            
                
                    <img src="/pix/jedipunkz.jpg" class="intro-circle" width="250" alt="jedipunkz icon" />
                
            
            
                <header>
                    <h2></h2>
                    <p>ジェダイさんです。インフラエンジニアからインフラ寄りのソフトウェアエンジニアになるために勉強していきます。</p>
                </header>
            
            <ul class="icons">
                
                
                    
<li><a href="//github.com/jedipunkz" target="_blank" title="GitHub" class="fa fa-github"></a></li>

















































<li><a href="//twitter.com/jedipunkz" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>




                
            </ul>
        </section>

    
        <section id="recent-posts">
            <ul class="posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                
                    
                

                
                    
                

                
                    <li>
                        <article>
                            <header>
                                <h3><a href="http://jedipunkz.github.io/blog/2016/11/03/kubernetes-scheduledjob/">kubernetes1.4 で実装された ScheduledJob を試してみた！</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2016-11-03'>
                                    November 3, 2016</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="http://jedipunkz.github.io/blog/2016/07/25/minikube/">Minikube で簡易 kubernetes 環境構築</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2016-07-25'>
                                    July 25, 2016</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="http://jedipunkz.github.io/blog/2016/07/23/influxdb-go/">Go言語とInfluxDBで監視のコード化</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2016-07-23'>
                                    July 23, 2016</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="http://jedipunkz.github.io/blog/2016/07/14/test-kitchen-with-ansible/">Test-Kitchen, Docker で Ansible Role 開発サイクル高速化！</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2016-07-14'>
                                    July 14, 2016</time>
                            </header>
                        </article>
                    </li>
                

                
                    <li>
                        <ul class="actions">
                            <li><a href=
                            
                                /post/
                            
                            class="button">View more posts</a></li>
                        </ul>
                    </li>
                
            </ul>
        </section>

    
    
    
    
        <section id="categories">
            <ul class="posts">
                <header>
                    <h3><a href="/categories/">Categories</a></h3>
                </header>

                
                    
                

                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/infrastructure/">infrastructure</a>
                                <span style="float:right;">102</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/tools/">tools</a>
                                <span style="float:right;">11</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/report/">report</a>
                                <span style="float:right;">9</span>
                            </header>
                        </article>
                    </li>
                
            </ul>
        </section>
    

    
        
        <section class="blurb">
            <h2>About</h2>
            <p>ソフトウェア寄りのエンジニアになるため勉強をしています。勉強したことをメモしていければと思います。</p>

            <ul class="actions">
                <li><a href="/about/" class="button">Learn More</a></li>
            </ul>
        </section>
        

    
        <section id="footer">
            <ul class="icons">
                
                
                    
<li><a href="//github.com/jedipunkz" target="_blank" title="GitHub" class="fa fa-github"></a></li>

















































<li><a href="//twitter.com/jedipunkz" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>




                
            </ul>

            <p class="copyright">&copy; ジェダイさんのブログ. テーマデザインは <a href="//github.com/jpescador" target="_blank">Julio Pescador</a>さんによるものです。 </p>
        </section>

</section>

            </div>
        <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
        

        
        
            
        

        
        
            <script src="/js/jquery.min.js"></script>
            <script src="/js/skel.min.js"></script>
            <script src="/js/util.js"></script>
            <script src="/js/main.js"></script>
            <script src="/js/backToTop.js"></script>
            <script src="/js/highlight.pack.js"></script>
        

        

            
            <script>hljs.initHighlightingOnLoad();</script>
            
    </body>
</html>


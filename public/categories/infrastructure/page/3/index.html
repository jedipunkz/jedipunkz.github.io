<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>infrastructure | jedipunkz 🚀 のブログ</title>
<meta name="keywords" content="" />
<meta name="description" content="Theme PaperMod - https://github.com/adityatelange/hugo-PaperMod">
<meta name="author" content="Theme PaperMod">
<link rel="canonical" href="https://jedipunkz.github.io/categories/infrastructure/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.44044074f4b4d7b018bfd3febcc1fa76eb874db64213f920feacf263e3028a73.css" integrity="sha256-RARAdPS017AYv9P&#43;vMH6duuHTbZCE/kg/qzyY&#43;MCinM=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://jedipunkz.github.io/pix/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://jedipunkz.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://jedipunkz.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://jedipunkz.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://jedipunkz.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.97.3" />
<link rel="alternate" type="application/rss+xml" href="https://jedipunkz.github.io/categories/infrastructure/index.xml">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-30563095-1', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="infrastructure" />
<meta property="og:description" content="Theme PaperMod - https://github.com/adityatelange/hugo-PaperMod" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://jedipunkz.github.io/categories/infrastructure/" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="infrastructure"/>
<meta name="twitter:description" content="Theme PaperMod - https://github.com/adityatelange/hugo-PaperMod"/>

</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jedipunkz.github.io" accesskey="h" title="jedipunkz 🚀 のブログ (Alt + H)">jedipunkz 🚀 のブログ</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jedipunkz.github.io/about" title="About Me">
                    <span>About Me</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header">
  <h1>infrastructure</h1>
</header>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>GCP ロードバランサと GKE クラスタを Terraform を使って構築する
    </h2>
  </header>
  <section class="entry-content">
    <p>こんにちは。@jedipunkz です。
少し前まで Google Cloud Platform (GCP) を使っていたのですが、今回はその時に得たノウハウを記事にしようと思います。
Google Container Engine (GKE) とロードバランサを組み合わせてサービスを立ち上げていました。手動でブラウザ上からポチポチして構築すると人的ミスや情報共有という観点でマズイと思ったので Terraform を使って GCP の各リソースを構築するよう仕掛けたのですが、まだまだ Terraform を使って GCP インフラを構築されている方が少ないため情報が無く情報収集や検証に時間が掛かりました。よって今回はまだネット上に情報が少ない GKE とロードバランサの構築を Terraform を使って行う方法を共有します。
構築のシナリオ 構築するにあたって2パターンの構築の流れがあると思います。
   GKE クラスタとロードバランサを同時に構築する    GKE クラスタを予め構築しそのクラスタ向けにロードバランサを構築する    両方の方法を記していきます。
 GKE クラスタとロードバランサを同時に構築する   GKE クラスタとロードバランサを同時に作る方法です。
早速ですが下記に terraform ファイルを記しました。それぞれのシンタックスの意味については Terraform の公式ドキュメントをご覧になってください。
公式ドキュメント : https://www.terraform.io/docs/providers/google/
ここで特筆すべき点としては下記が挙げられます。
ロードバランサに紐付けるバックエンドの ID 取得のため “${replace(element…” 的なことをしている ロードバランサのバックエンドサービスに対して GKE クラスタを作成した際に自動で作成されるインスタンスグループの URI を紐付ける必要があります。ユーザとしては URI ではなく “インスタンスグループ名” であると扱いやすいのですが、URI が必要になります。この情報は下記のサイトを参考にさせていただきました。...</p>
  </section>
  <footer class="entry-footer"><span title='2017-04-13 14:53:37 +0900 JST'>April 13, 2017</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Theme PaperMod</footer>
  <a class="entry-link" aria-label="post link to GCP ロードバランサと GKE クラスタを Terraform を使って構築する" href="https://jedipunkz.github.io/post/gke-lb/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>Serverless on Kubernetes : Fission を使ってみた
    </h2>
  </header>
  <section class="entry-content">
    <p>こんにちは。 @jedipunkz です。
今日は Kubernetes を使って Serverless を実現するソフトウェア Fission を紹介します。
AWS の Lambda とよく似た動きをします。Lambda も内部では各言語に特化したコンテナが起動してユーザが開発した Lambda Function を実行してくれるのですが、Fission も各言語がインストールされた Docker コンテナを起動しユーザが開発したコードを実行し応答を返してくれます。
それでは早速なのですが、Fission を動かしてみましょう。
動作させるための環境 macOS か Linux を前提として下記の環境を用意する必要があります。また Kubernetes 環境は minikube が手っ取り早いので用いますが、もちろん minikube 以外の kubernetes 環境でも動作します。
 macOS or Linux minikube or kubernetes kubectl fission  ソフトウェアのインストール方法 簡単にですが、ソフトウェアのインストール方法を書きます。
OS 私は Linux で動作させましたが筆者の方は macOS を使っている方が多数だと思いますので、この手順では macOS を使った利用方法を書いていきます。
minikube ここでは簡単な手順で kubernetes 環境を構築できる minikube をインストールします。
curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.16.0/minikube-darwin-amd64 &amp;&amp; chmod &#43;x minikube &amp;&amp; sudo mv minikube /usr/local/bin/fission kubectl 直接必要ではありませんが、kubectl があると minikube で構築した kubernetes 環境を操作できますのでインストールしておきます。...</p>
  </section>
  <footer class="entry-footer"><span title='2017-02-12 14:55:01 +0900 JST'>February 12, 2017</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;jedipunkz</footer>
  <a class="entry-link" aria-label="post link to Serverless on Kubernetes : Fission を使ってみた" href="https://jedipunkz.github.io/post/serverless-fission/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>Kubernetes Deployments を使ってみた！
    </h2>
  </header>
  <section class="entry-content">
    <p>こんにちは。 @jedipunkz です。
いま僕らは職場では GKE 上に Replication Controller と Services を使って Pod を起動しているのですが最近の Kubernetes 関連のドキュメントを拝見すると Deployments を使っている記事をよく見掛けます。Kubernetes 1.2 から実装されたようです。今回は Kubernetes の Replication Controller の次世代版と言われている Deployments について調べてみましたので理解したことを書いていこうかと思います。
参考資料 今回は Kubernetes 公式の下記のドキュメントに記されているコマンドを一通り実行していきます。追加の情報もあります。
 https://kubernetes.io/docs/user-guide/deployments/  Deployments を使って nginx Pod を起動 nginx をデプロイするための Yaml ファイルを用意します。
apiVersion: extensions/v1beta1 kind: Deployment metadata: name: nginx-deployment spec: replicas: 2 template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:1.7.9 ports: - containerPort: 80 作成した yaml ファイルを指定して Pod を作ります。 下記の通りここで “–record” と記しているのは、後に Deployments の履歴を表示する際に “何を行ったか” を出力するためです。このオプションを指定しないと “何を行ったか” の出力が “NONE” となります。...</p>
  </section>
  <footer class="entry-footer"><span title='2017-01-13 20:29:07 +0900 JST'>January 13, 2017</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;jedipunkz</footer>
  <a class="entry-link" aria-label="post link to Kubernetes Deployments を使ってみた！" href="https://jedipunkz.github.io/post/kubernetes-deployments/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>Google Cloud CDN を使ってみた
    </h2>
  </header>
  <section class="entry-content">
    <p>こんにちは。@jedipunkz です。
今回は Google Cloud Platform の Google CloudCDN について調べてみたので記したいと思います。
CloudCDN は GCP のロードバランサのバックエンドサービスに紐付けられるサービスです。このバックエンドサービスで CloudCDN を有効にしていると CDN サービスを機能させることが出来ます。先に書いておくとこの CloudCDN はとてもシンプルで扱いやすいサービスだと判りました。高機能な他の CDN サービスと比べると機能が足らない感ありますが、必要最低限なところを抑えているのと、価格がとても安いです。(価格は下記の URL 参照)
価格表 : https://cloud.google.com/cdn/pricing
構成 構成と構成の特徴です。
&#43;----------&#43; &#43;---------&#43; | instance |--&#43; &#43;-| EndUser | &#43;----------&#43; | &#43;------------&#43; &#43;----------&#43; | &#43;---------&#43; &#43;--|LoadBalancer|--| CloudCDN |-&#43;-| EndUser | &#43;----------&#43; | &#43;------------&#43; &#43;----------&#43; | &#43;---------&#43; | instance |--&#43; &#43;-| EndUser | &#43;----------&#43; &#43;---------&#43;  コンテンツが初めてリクエストされた場合キャッシュミスする キャッシュミスした際に近くにあるキャッシュからコンテンツを取得しようと試みる 近くのキャッシュがコンテンツがある場合、最初のキャッシュにコンテンツが送信される 近くのキャッシュにコンテンツがない場合、HTTP ロードバランサにリクエストが転送される その後のリクエストはキャッシュが応答する(キャッシュヒット) キャッシュ間のフィルは EndUser のリクエストに応じて実行される キャッシュを事前に読み込むことできない キャッシュは世界各地に配置されている  CloudCDN を導入する方法 導入する方法は簡単で下記のとおりです。...</p>
  </section>
  <footer class="entry-footer"><span title='2016-12-29 09:32:49 +0900 JST'>December 29, 2016</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;Theme PaperMod</footer>
  <a class="entry-link" aria-label="post link to Google Cloud CDN を使ってみた" href="https://jedipunkz.github.io/post/cloud-cdn/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>coreos の etcd operator を触ってみた
    </h2>
  </header>
  <section class="entry-content">
    <p>こんにちは @jedipunkz です。
今日は某アドベントカレンダーに参加していて記事を書いています。 記事だけ先出ししちゃいます..。
今日は最近 coreos がリリースした ’etcd-operator’ を触ってみようかと思います。ほぼ、README に書かれている手順通りに実施するのですが、所感を交えながら作業して記事にしてみたいと思います。
coreos が提供している etcd についてご存知ない方もいらっしゃると思いますが etcd は KVS ストレージでありながら Configuration Management Store として利用できる分散型ストレージです。Docker 等の環境を提供する coreos という軽量 OS 内でも etcd が起動していてクラスタで管理された情報をクラスタ内の各 OS が読み書きできる、といった機能を etcd が提供しています。 詳細については公式サイトを御覧ください。
etcd 公式サイト : https://coreos.com/etcd/docs/latest/
etcd-operator はこの etcd クラスタを kubernetes 上でクラスタ管理するための簡単に運用管理するためのソフトウェアになります。
etcd-operator 公式アナウンス : https://coreos.com/blog/introducing-the-etcd-operator.html
後に実際に触れていきますが下記のような管理が可能になります。
 etcd クラスタの構築 etcd クラスタのスケールアップ・ダウン etcd Pod の障害時自動復旧 etcd イメージをオンラインで最新のモノにアップグレード  では早速利用してみたいと思います。
必要な環境 下記の環境が事前に用意されている必要があります。
 Docker Kubernetes or minikube&#43;kubernetes (https://github.com/kubernetes/minikube) etcdctl : https://github....</p>
  </section>
  <footer class="entry-footer"><span title='2016-11-27 21:00:45 +0900 JST'>November 27, 2016</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;jedipunkz</footer>
  <a class="entry-link" aria-label="post link to coreos の etcd operator を触ってみた" href="https://jedipunkz.github.io/post/etcd-operator/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>Helm を使って Kubernetes を管理する
    </h2>
  </header>
  <section class="entry-content">
    <p>こんにちは。@jedipunkz です。
今回は Helm という kubernetes のパッケージマネージャ的なソフトウェアを使ってみたので記事にしたいと思います。
 公式サイト : https://helm.sh/  Kubernetes を仕事で使っているのですが “レプリケーションコントローラ” や “サービス” といった単位を使って Pod, Service を管理しています。Helm を使うことでこれらの管理方法が変わるのか調べたいと思います。
依存するソフトウェア 今回は MacOS を使って環境を整えます。
 virtualbox minikube kubectl  これらのソフトウェアをインストールしていきます。
$ brew cask install virtualbo $ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.12.2/minikube-darwin-amd64 &amp;&amp; chmod &#43;x minikube &amp;&amp; sudo mv minikube /usr/local/bin/ $ brew install kubectl minikube を使って簡易的な kubernetes 環境を起動します。
$ minikube start $ eval $(minikube docker-env) Helm を使ってみる Helm は Charts という単位で Kubernetes をパッケージングします。Charts の一覧を見てみましょう。...</p>
  </section>
  <footer class="entry-footer"><span title='2016-11-20 11:27:00 +0900 JST'>November 20, 2016</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;jedipunkz</footer>
  <a class="entry-link" aria-label="post link to Helm を使って Kubernetes を管理する" href="https://jedipunkz.github.io/post/helm/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>Minikube で簡易 kubernetes 環境構築
    </h2>
  </header>
  <section class="entry-content">
    <p>こんにちは。@jedipunkz です。
kubernetes の環境を簡易的に作れる Minikube (https://github.com/kubernetes/minikube) が2ヶ月前ほどにリリースになっていました。簡単ですが少し触ってみたのでその際のメモを記したいと思います。VirtualBox もしくは VMware Fusion がインストールされていればすぐにでも稼働可能です。私は Kubernetes 初心者ですが何も考えずに kubernetes を動かすことが出来ました。
前提 前提として下記の環境が必要になります。
 Mac OSX がインストールされていること VirtualBox もしくは VMware Fusion がインストールされていること  minikube をインストール minikube をインストールします。
$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.6.0/minikube-darwin-amd64 &amp;&amp; chmod &#43;x minikube &amp;&amp; sudo mv minikube /usr/local/bin/ kubetl をインストール 次に kubectl をインストールします。
$ curl -k -o kubectl https://kuar.io/darwin/kubectl &amp;&amp; chmod &#43;x kubectl &amp;&amp; sudo mv kubectl /usr/local/bin/ Minikube で Kurbernates を稼働 Minikube を使って Kubernetes を稼働してみます。下記のコマンドを実行すると Virtualbox 上で仮想マシンが稼働し Kubernetes 一式も立ち上がります。...</p>
  </section>
  <footer class="entry-footer"><span title='2016-07-25 23:18:16 +0900 JST'>July 25, 2016</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Theme PaperMod</footer>
  <a class="entry-link" aria-label="post link to Minikube で簡易 kubernetes 環境構築" href="https://jedipunkz.github.io/post/minikube/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>Go言語とInfluxDBで監視のコード化
    </h2>
  </header>
  <section class="entry-content">
    <p>こんにちは。@jedipunkz です。
今日は Go 言語でサーバのメトリクスデータを InfluxDB に入れてリソース監視を行う方法について書きます。
Ansible, Terraform, Chef などのソフトウェアを使ってインフラを定義するのが当たり前になった現在ですが、本当の意味でのソフトウェアによるインフラの定義ってなんだろと最近考えています。aws-sdk や fog などを使ったネイティブな言語でインフラを定義することの意味もあるように感じているからです。某サービスプロバイダのエンジニアはこうした言語によるインフラの定義の一番大きなメリットとして “再利用性” をあげていました。こうしたソフトウェアによるインフラの定義や構成を行う上で監視についてもコード化できるのでは？と考えて今回の記事に至りました。
使うモノ  https://github.com/influxdata/influxdb/tree/master/client  公式の InfluxDB Go Client です。InfluxDB 自体が Go 言語で書かれていますがクライアントも Go 言語で記述することができます。ここにあるサンプルコードをすこしいじって、今回の記事を書こうと思います。
 https://github.com/shirou/gopsutil  @shirou さんが作られた psutil の Go 言語版です。CPU, Mem などリソースをモニタするのに便利なので利用します。
環境構築 環境を作っていきます。InfluxDB と Chronograf を構築するのですが Docker で構築するのが簡単なのでこれを利用します。Chronograf は InfluxDB 内のデータを可視化するためのソフトウェアです。
 InfluxDB の起動  InfluxDB のコンテナを起動します。
docker run -p 8083:8083 -p 8086:8086 \ -v $PWD:/var/lib/influxdb \ influxdb  Chronograf の起動  Chronograf のコンテナを起動します。...</p>
  </section>
  <footer class="entry-footer"><span title='2016-07-23 02:40:11 +0900 JST'>July 23, 2016</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Theme PaperMod</footer>
  <a class="entry-link" aria-label="post link to Go言語とInfluxDBで監視のコード化" href="https://jedipunkz.github.io/post/influxdb-go/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="prev" href="https://jedipunkz.github.io/categories/infrastructure/page/2/">« Prev Page</a>
    <a class="next" href="https://jedipunkz.github.io/categories/infrastructure/page/4/">Next Page »</a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://jedipunkz.github.io">jedipunkz 🚀 のブログ</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>

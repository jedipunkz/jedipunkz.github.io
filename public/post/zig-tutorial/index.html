<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Zig 入門: 構文集 | jedipunkz 🚀 のブログ</title>
<meta name="keywords" content="">
<meta name="description" content="こんにちは @jedipunkz です。
コーディングを学習する機会を増やしている最中なのですが、自分は底レイヤが好きなのを思い出し、またたまに Mitchell Hashimoto 氏が Zig のことを呟いてるのを覚えていたので、突然 Zig に入門したくなりました。
ということで後に自分でも読み返せる形にしようと思い Zig の構文集を記します。
NOTICE
※  現時点で Stable な 0.15.1 を前提に記します。
※  気が向いたときに言語仕様の変化に対応して修正していこうと思います。
はじめに
このドキュメントは、Zig 言語の主要な構文を網羅的にまとめたチュートリアルです。すべてのサンプルコードは記事の修正時点で Stable なリリースバージョンの Zig で動作確認しています。
目次

基本構文
演算子
制御構文
関数
配列とスライス
構造体
列挙型とユニオン
ポインタ
エラーハンドリング
オプショナル型
コンパイル時計算
メモリアロケータ
テスト
モジュール


1. 基本構文
変数宣言
Zig には 2 種類の変数宣言があります。const は不変変数（再代入不可）、var は可変変数（再代入可能）を表します。
const cat: i32 = 5;  // const: 不変変数（再代入不可）
var dog: i32 = 10;   // var: 可変変数（再代入可能）

dog = 15;  // OK
// cat = 10;  // エラー: const は変更不可
型推論
型を明示的に指定しなくても、コンパイラが自動的に型を推論してくれます。">
<meta name="author" content="jedipunkz">
<link rel="canonical" href="https://jedipunkz.github.io/post/zig-tutorial/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.97234df0e1271d016477114a055b3d32629722d95690ff83ab2a63dfe4ada46b.css" integrity="sha256-lyNN8OEnHQFkdxFKBVs9MmKXItlWkP&#43;Dqypj3&#43;StpGs=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://jedipunkz.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://jedipunkz.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://jedipunkz.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://jedipunkz.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://jedipunkz.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://jedipunkz.github.io/post/zig-tutorial/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><link rel="stylesheet" href="/css/custom.css">
<style>
 
.post-content code,
.post-content pre code,
.post-content .highlight code,
.post-content .highlighttable code {
    font-size: 1em !important;
}

 
.post-content p code,
.post-content li code,
.post-content td code {
    font-size: 1em !important;
}
</style><script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "\"Zig 入門: 構文集\"",
  "description": "\"こんにちは @jedipunkz です。\\nコーディングを学習する機会を増やしている最中なのですが、自分は底レイヤが好きなのを思い出し、またたまに Mitchell Hashimoto 氏が Zig のことを呟いてるのを覚えていたので、突然 Zig に入門したくなりました。\\nということで後に自分でも読み返せる形にしようと思い Zig の構文集を記します。\\nNOTICE ※ 現時点で Stable な 0.15.1 を前提に記します。 ※ 気が向いたときに言語仕様の変化に対応して修正していこうと思います。\\nはじめに このドキュメントは、Zig 言語の主要な構文を網羅的にまとめたチュートリアルです。すべてのサンプルコードは記事の修正時点で Stable なリリースバージョンの Zig で動作確認しています。\\n目次 基本構文 演算子 制御構文 関数 配列とスライス 構造体 列挙型とユニオン ポインタ エラーハンドリング オプショナル型 コンパイル時計算 メモリアロケータ テスト モジュール 1. 基本構文 変数宣言 Zig には 2 種類の変数宣言があります。const は不変変数（再代入不可）、var は可変変数（再代入可能）を表します。\\nconst cat: i32 = 5; // const: 不変変数（再代入不可） var dog: i32 = 10; // var: 可変変数（再代入可能） dog = 15; // OK // cat = 10; // エラー: const は変更不可 型推論 型を明示的に指定しなくても、コンパイラが自動的に型を推論してくれます。\\n\"",
  "datePublished": "2025-10-24T21:29:24\u002b09:00",
  "dateModified": "2025-10-24T21:29:24\u002b09:00",
  "author": {
    "@type": "Person",
    "name": "\"jedipunkz\""
  },
  "publisher": {
    "@type": "Person",
    "name": "\"jedipunkz\"",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/jedipunkz.github.io\/jedipunkz.jpg"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/jedipunkz.github.io\/post\/zig-tutorial\/"
  }
}
</script>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-2H91XCYVZ8"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-2H91XCYVZ8');
        }
      </script><meta property="og:url" content="https://jedipunkz.github.io/post/zig-tutorial/">
  <meta property="og:site_name" content="jedipunkz 🚀 のブログ">
  <meta property="og:title" content="Zig 入門: 構文集">
  <meta property="og:description" content="こんにちは @jedipunkz です。
コーディングを学習する機会を増やしている最中なのですが、自分は底レイヤが好きなのを思い出し、またたまに Mitchell Hashimoto 氏が Zig のことを呟いてるのを覚えていたので、突然 Zig に入門したくなりました。
ということで後に自分でも読み返せる形にしようと思い Zig の構文集を記します。
NOTICE ※ 現時点で Stable な 0.15.1 を前提に記します。 ※ 気が向いたときに言語仕様の変化に対応して修正していこうと思います。
はじめに このドキュメントは、Zig 言語の主要な構文を網羅的にまとめたチュートリアルです。すべてのサンプルコードは記事の修正時点で Stable なリリースバージョンの Zig で動作確認しています。
目次 基本構文 演算子 制御構文 関数 配列とスライス 構造体 列挙型とユニオン ポインタ エラーハンドリング オプショナル型 コンパイル時計算 メモリアロケータ テスト モジュール 1. 基本構文 変数宣言 Zig には 2 種類の変数宣言があります。const は不変変数（再代入不可）、var は可変変数（再代入可能）を表します。
const cat: i32 = 5; // const: 不変変数（再代入不可） var dog: i32 = 10; // var: 可変変数（再代入可能） dog = 15; // OK // cat = 10; // エラー: const は変更不可 型推論 型を明示的に指定しなくても、コンパイラが自動的に型を推論してくれます。">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-10-24T21:29:24+09:00">
    <meta property="article:modified_time" content="2025-10-24T21:29:24+09:00">
      <meta property="og:image" content="https://jedipunkz.github.io/jedipunkz.jpg">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://jedipunkz.github.io/jedipunkz.jpg">
<meta name="twitter:title" content="Zig 入門: 構文集">
<meta name="twitter:description" content="こんにちは @jedipunkz です。
コーディングを学習する機会を増やしている最中なのですが、自分は底レイヤが好きなのを思い出し、またたまに Mitchell Hashimoto 氏が Zig のことを呟いてるのを覚えていたので、突然 Zig に入門したくなりました。
ということで後に自分でも読み返せる形にしようと思い Zig の構文集を記します。
NOTICE
※  現時点で Stable な 0.15.1 を前提に記します。
※  気が向いたときに言語仕様の変化に対応して修正していこうと思います。
はじめに
このドキュメントは、Zig 言語の主要な構文を網羅的にまとめたチュートリアルです。すべてのサンプルコードは記事の修正時点で Stable なリリースバージョンの Zig で動作確認しています。
目次

基本構文
演算子
制御構文
関数
配列とスライス
構造体
列挙型とユニオン
ポインタ
エラーハンドリング
オプショナル型
コンパイル時計算
メモリアロケータ
テスト
モジュール


1. 基本構文
変数宣言
Zig には 2 種類の変数宣言があります。const は不変変数（再代入不可）、var は可変変数（再代入可能）を表します。
const cat: i32 = 5;  // const: 不変変数（再代入不可）
var dog: i32 = 10;   // var: 可変変数（再代入可能）

dog = 15;  // OK
// cat = 10;  // エラー: const は変更不可
型推論
型を明示的に指定しなくても、コンパイラが自動的に型を推論してくれます。">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://jedipunkz.github.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Zig 入門: 構文集",
      "item": "https://jedipunkz.github.io/post/zig-tutorial/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Zig 入門: 構文集",
  "name": "Zig 入門: 構文集",
  "description": "こんにちは @jedipunkz です。\nコーディングを学習する機会を増やしている最中なのですが、自分は底レイヤが好きなのを思い出し、またたまに Mitchell Hashimoto 氏が Zig のことを呟いてるのを覚えていたので、突然 Zig に入門したくなりました。\nということで後に自分でも読み返せる形にしようと思い Zig の構文集を記します。\nNOTICE ※ 現時点で Stable な 0.15.1 を前提に記します。 ※ 気が向いたときに言語仕様の変化に対応して修正していこうと思います。\nはじめに このドキュメントは、Zig 言語の主要な構文を網羅的にまとめたチュートリアルです。すべてのサンプルコードは記事の修正時点で Stable なリリースバージョンの Zig で動作確認しています。\n目次 基本構文 演算子 制御構文 関数 配列とスライス 構造体 列挙型とユニオン ポインタ エラーハンドリング オプショナル型 コンパイル時計算 メモリアロケータ テスト モジュール 1. 基本構文 変数宣言 Zig には 2 種類の変数宣言があります。const は不変変数（再代入不可）、var は可変変数（再代入可能）を表します。\nconst cat: i32 = 5; // const: 不変変数（再代入不可） var dog: i32 = 10; // var: 可変変数（再代入可能） dog = 15; // OK // cat = 10; // エラー: const は変更不可 型推論 型を明示的に指定しなくても、コンパイラが自動的に型を推論してくれます。\n",
  "keywords": [
    
  ],
  "articleBody": "こんにちは @jedipunkz です。\nコーディングを学習する機会を増やしている最中なのですが、自分は底レイヤが好きなのを思い出し、またたまに Mitchell Hashimoto 氏が Zig のことを呟いてるのを覚えていたので、突然 Zig に入門したくなりました。\nということで後に自分でも読み返せる形にしようと思い Zig の構文集を記します。\nNOTICE ※ 現時点で Stable な 0.15.1 を前提に記します。 ※ 気が向いたときに言語仕様の変化に対応して修正していこうと思います。\nはじめに このドキュメントは、Zig 言語の主要な構文を網羅的にまとめたチュートリアルです。すべてのサンプルコードは記事の修正時点で Stable なリリースバージョンの Zig で動作確認しています。\n目次 基本構文 演算子 制御構文 関数 配列とスライス 構造体 列挙型とユニオン ポインタ エラーハンドリング オプショナル型 コンパイル時計算 メモリアロケータ テスト モジュール 1. 基本構文 変数宣言 Zig には 2 種類の変数宣言があります。const は不変変数（再代入不可）、var は可変変数（再代入可能）を表します。\nconst cat: i32 = 5; // const: 不変変数（再代入不可） var dog: i32 = 10; // var: 可変変数（再代入可能） dog = 15; // OK // cat = 10; // エラー: const は変更不可 型推論 型を明示的に指定しなくても、コンパイラが自動的に型を推論してくれます。\nconst rabbit = 20; // i32 と推論される const fox = 3.14; // f64 と推論される 整数リテラルはデフォルトで i32 型、浮動小数点リテラルは f64 型として推論されます。\n基本的なデータ型 Zig にはさまざまな基本的なデータ型があります。\nconst bear: u8 = 255; // 符号なし 8bit 整数 (0〜255) const wolf: i64 = -1000; // 符号付き 64bit 整数 const eagle: f32 = 2.718; // 32bit 浮動小数点数 const shark: bool = true; // 真偽値 const tiger: u8 = 'A'; // 文字（u8 として扱われる） 整数型:\n符号付き: i8, i16, i32, i64, i128, isize 符号なし: u8, u16, u32, u64, u128, usize 浮動小数点型:\nf16, f32, f64, f128 整数型の数字はビット幅を表します。例えば i32 は 32 ビットの符号付き整数です。isize と usize はポインタのサイズと同じで、プラットフォームによって変わります。\nundefined（未初期化値） undefined は変数が未初期化であることを明示的に示します。値は不定なので、使用前に必ず初期化する必要があります。\nvar snake: i32 = undefined; // 未初期化（値は不定） snake = 99; // 使用前に必ず初期化 // 配列の undefined var array: [5]i32 = undefined; for (\u0026array, 0..) |*item, i| { item.* = @intCast(i); } デバッグモードでは、Zig は undefined の領域を 0xaa バイトで埋めます。これはバグの早期発見に役立ちます。undefined を使うことで、初期化が不要な場合にパフォーマンスを向上できます。\n型変換 Zig では明示的な型変換が必要です。様々なビルトイン関数が用意されています。\n// @as: コンパイル時型変換 const num_u8 = @as(u8, 50); // @intCast: 整数型間の変換 const large_num: i64 = 42; const small_num: i32 = @intCast(large_num); // @floatCast: 浮動小数点型間の変換 const double: f64 = 3.14159265; const single: f32 = @floatCast(double); // @floatFromInt: 整数から浮動小数点 const int_val: i32 = 42; const float_val: f32 = @floatFromInt(int_val); // @intFromFloat: 浮動小数点から整数（切り捨て） const pi: f32 = 3.14; const pi_int: i32 = @intFromFloat(pi); // 3 型変換は明示的に行う必要があります。これにより、意図しない型変換によるバグを防げます。@as はコンパイル時に型を指定し、他の関数は実行時の型変換を行います。\n2. 演算子 算術演算子 数値の計算を行う演算子です。加算、減算、乗算は一般的ですが、除算と剰余は Zig のビルトイン関数を使います。\nconst lion: i32 = 10; const leopard: i32 = 3; lion + leopard // 13 加算 lion - leopard // 7 減算 lion * leopard // 30 乗算 @divTrunc(lion, leopard) // 3 整数除算（切り捨て） @rem(lion, leopard) // 1 剰余 注意: Zig では整数の除算や剰余にビルトイン関数を使用します。これはオーバーフローや未定義動作を防ぐためです。@divTrunc は切り捨て除算、@rem は剰余を計算します。\n比較演算子 2 つの値を比較する演算子です。結果は bool 型（真または偽）になります。\npanda == koala // 等しい panda != lion // 等しくない panda \u003c lion // より小さい panda \u003e leopard // より大きい panda \u003c= koala // 以下 panda \u003e= leopard // 以上 これらの演算子は条件分岐（if 文など）でよく使われます。\n論理演算子 真偽値（bool 型）を操作する演算子です。\nconst monkey: bool = true; const gorilla: bool = false; monkey and gorilla // false (論理積) monkey or gorilla // true (論理和) !monkey // false (否定) and は両方が真のときだけ真、or はどちらかが真なら真、! は真偽を反転させます。\nビット演算子 整数のビット単位で操作を行う演算子です。2 進数で考えるとわかりやすいです。\nconst zebra: u8 = 0b1010; // 10 (2進数) const giraffe: u8 = 0b1100; // 12 (2進数) zebra \u0026 giraffe // 0b1000 (AND) zebra | giraffe // 0b1110 (OR) zebra ^ giraffe // 0b0110 (XOR) ~zebra // 0b11110101 (NOT) zebra \u003c\u003c 1 // 0b00010100 (左シフト) zebra \u003e\u003e 1 // 0b0101 (右シフト) \u0026 はビット AND、| はビット OR、^ はビット XOR、~ はビット NOT、\u003c\u003c は左シフト、\u003e\u003e は右シフトを行います。\n3. 制御構文 if 文 条件によって処理を分岐させる構文です。条件は () で囲み、実行するコードは {} で囲みます。\nconst elephant: i32 = 15; if (elephant \u003e 10) { std.debug.print(\"elephant is large\\n\", .{}); } else if (elephant \u003e 5) { std.debug.print(\"elephant is medium\\n\", .{}); } else { std.debug.print(\"elephant is small\\n\", .{}); } else if で複数の条件を書けます。上から順に評価されて、最初に真になった条件のブロックが実行されます。\nif 式（値を返す） Zig の if は式として値を返すことができます。\nconst rhino: i32 = 8; const hippo = if (rhino \u003e 10) \"large\" else \"small\"; 条件によって異なる値を変数に代入したいときに、コードが簡潔に書けます。\nwhile 文 条件が真の間、繰り返し処理を実行します。\nvar mouse: i32 = 0; while (mouse \u003c 5) { std.debug.print(\"{} \", .{mouse}); mouse += 1; } // 出力: 0 1 2 3 4 ループの中で変数を変更して、最終的に条件が偽になるようにします。無限ループに注意しましょう。\nwhile 文（continue 式付き） ループの最後に毎回実行される式を指定できます。: () の部分に書きます。\nvar hamster: i32 = 0; while (hamster \u003c 5) : (hamster += 1) { std.debug.print(\"{} \", .{hamster}); } // 出力: 0 1 2 3 4 for 文（配列のイテレーション） 配列やスライスの要素を順番に処理します。\nconst animals = [_][]const u8{ \"snake\", \"lizard\", \"turtle\" }; // 要素のみ for (animals) |animal| { std.debug.print(\"{s} \", .{animal}); } // インデックス付き for (animals, 0..) |animal, i| { std.debug.print(\"[{}]{s} \", .{i, animal}); } |animal| で各要素を取り出します。インデックスも必要なら、0.. と組み合わせて |animal, i| のように書けます。\nswitch 文 値に応じて処理を分岐させます。Zig の switch は式として値を返すことができます。すべてのケースを網羅する必要があります。\nconst penguin: i32 = 2; const result = switch (penguin) { 1 =\u003e \"one\", 2 =\u003e \"two\", 3 =\u003e \"three\", else =\u003e \"many\", }; =\u003e の左側が条件、右側が対応する値や処理です。else ですべてのケースを網羅できます。\nbreak と continue ループの流れを制御する構文です。\n// break: ループを抜ける var crow: i32 = 0; while (true) { if (crow \u003e= 3) break; std.debug.print(\"{} \", .{crow}); crow += 1; } // continue: 次のイテレーションへ var sparrow: i32 = 0; while (sparrow \u003c 5) : (sparrow += 1) { if (sparrow == 2) continue; // 2 をスキップ std.debug.print(\"{} \", .{sparrow}); } // 出力: 0 1 3 4 break でループを抜け出し、continue で次のループに進みます。特定の条件でループを制御したいときに使います。\nラベル付きブロック ブロックにラベルを付けて、break で値を返すことができます。\nconst swan = blk: { const x = 10; const y = 20; break :blk x + y; // ブロックから値を返す }; // swan は 30 ブロックを式として使い、計算結果を返せます。複雑な初期化処理を書くときに便利です。\nラベル付きループ ネストされたループで外側のループを制御できます。\nvar peacock: i32 = 0; outer: while (peacock \u003c 3) : (peacock += 1) { var inner: i32 = 0; while (inner \u003c 3) : (inner += 1) { if (peacock == 1 and inner == 1) { break :outer; // 外側のループを抜ける } } } break :outer で外側のループを抜けることができます。ラベルを使うことで、どのループを制御するかを明確に指定できます。\nunreachable 到達不可能なコードパスを明示的に示します。\nconst owl: i32 = 5; const owl_status = if (owl \u003e 0) \"positive\" else if (owl \u003c 0) \"negative\" else unreachable; // owl は 5 なので到達しない // switch での使用 const falcon: u8 = 2; const falcon_name = switch (falcon) { 1 =\u003e \"peregrine\", 2 =\u003e \"gyrfalcon\", 3 =\u003e \"merlin\", else =\u003e unreachable, // 1-3 以外は来ないと仮定 }; デバッグモードでは unreachable に到達すると panic を発生させます。ReleaseFast モードでは、コンパイラがこのコードパスに到達しないと仮定して最適化を行います。論理的に到達不可能な箇所を明示することで、バグを早期発見できます。\n4. 関数 基本的な関数 fn キーワードで関数を定義します。引数と戻り値の型を明示的に指定します。\nfn addDolphins(dolphin1: i32, dolphin2: i32) i32 { return dolphin1 + dolphin2; } const result = addDolphins(5, 3); // 8 関数名の後の () に引数、その後に戻り値の型を書きます。return で値を返します。\n複数の戻り値（構造体を使用） 複数の値を返したいときは、構造体を使います。\nfn getWhaleInfo() struct { age: i32, weight: f32 } { return .{ .age = 50, .weight = 30000.5 }; } const whale_info = getWhaleInfo(); std.debug.print(\"age: {}, weight: {d:.1}\\n\", .{whale_info.age, whale_info.weight}); 無名構造体を戻り値の型として使えます。.{} で構造体リテラルを作成して返します。\nvoid 関数 何も返さない関数は void 型を使います。\nfn printSeal() void { std.debug.print(\"Seal!\\n\", .{}); } return 文を書かなくても、関数の最後まで実行されたら自動的に戻ります。\nエラーを返す関数 ! を使ってエラーを返す可能性があることを示します。\nfn divideOtters(otter1: i32, otter2: i32) !i32 { if (otter2 == 0) { return error.DivisionByZero; } return @divTrunc(otter1, otter2); } // 使用例 const result = divideOtters(10, 2) catch |err| { std.debug.print(\"Error: {}\\n\", .{err}); return; }; !i32 は「エラーまたは i32 を返す」という意味です。エラーが発生する可能性がある処理に便利です。\nオプショナル型を返す関数 ? を使って null を返す可能性があることを示します。\nfn findBadger(badger_id: i32) ?i32 { if (badger_id \u003c 0) { return null; } return badger_id * 2; } // 使用例 if (findBadger(5)) |badger| { std.debug.print(\"found: {}\\n\", .{badger}); } else { std.debug.print(\"not found\\n\", .{}); } ?i32 は「null または i32 を返す」という意味です。値が存在しないかもしれない状況で使います。\nスライスを使った関数 配列やスライスを引数として受け取る関数です。\nfn sumRaccoons(raccoons: []const i32) i32 { var total: i32 = 0; for (raccoons) |raccoon| { total += raccoon; } return total; } const array = [_]i32{ 1, 2, 3, 4, 5 }; const sum = sumRaccoons(\u0026array); // 15 []const i32 は「i32 の読み取り専用スライス」を表します。配列のポインタを渡すとスライスに変換されます。\nジェネリック関数 comptime パラメータを使って型をパラメータ化できます。\nfn maxMammal(comptime T: type, mammal1: T, mammal2: T) T { return if (mammal1 \u003e mammal2) mammal1 else mammal2; } const max_int = maxMammal(i32, 10, 20); // 20 const max_float = maxMammal(f32, 3.14, 2.71); // 3.14 comptime はコンパイル時に値が決定されることを意味します。型をパラメータとして受け取り、様々な型で動作する関数を作れます。\ninline 関数 inline キーワードで関数をインライン展開します。通常関数呼出しには「引数をスタックに積む」「関数にジャンプする」「戻る」というコストが掛かるそうですが、inline 関数を使うとコストがゼロになるそうです。\nただし呼び出し箇所が多い場合は同じコードが何度も展開されバイナリサイズが大きくなり、また大きな関数には向かないそうです。\ninline fn squareChipmunk(chipmunk: i32) i32 { return chipmunk * chipmunk; } 関数呼び出しのオーバーヘッドをなくし、呼び出し箇所に直接コードを埋め込みます。小さな関数のパフォーマンス向上に役立ちます。\n5. 配列とスライス 配列の宣言 配列は固定長のデータ構造です。[N]T の形で型を表します（N は要素数、T は型）。\n// 固定長配列 const parrots = [5]i32{ 1, 2, 3, 4, 5 }; // 長さを推論 const owls = [_]i32{ 10, 20, 30 }; // [3]i32 // 同じ値で初期化 const hawks = [_]i32{0} ** 4; // [4]i32{ 0, 0, 0, 0 } [_] を使うと、初期化子から要素数を自動的に推論してくれます。** 演算子で同じ値を繰り返せます。\n配列の操作 配列の要素にアクセスしたり、長さを取得したりできます。\n// 長さの取得 const length = owls.len; // 3 // 要素へのアクセス const first = parrots[0]; // 1 // ループ for (parrots) |parrot| { std.debug.print(\"{} \", .{parrot}); } .len で配列の長さが取得できます。インデックスは 0 から始まります。\n多次元配列 配列の配列を作ることができます。\nconst falcons = [2][3]i32{ [_]i32{ 1, 2, 3 }, [_]i32{ 4, 5, 6 }, }; const element = falcons[0][1]; // 2 [2][3]i32 は「3 要素の配列を 2 つ持つ配列」を表します。\nスライス スライスは配列の一部を参照する動的なビューです。[]T の形で型を表します。\nconst doves = [_]i32{ 1, 2, 3, 4, 5 }; const dove_slice: []const i32 = doves[1..4]; // [2, 3, 4] // スライスの長さ const slice_len = dove_slice.len; // 3 [start..end] で範囲を指定します（end は含まれません）。スライスは元の配列を参照するだけで、コピーは作りません。\n可変配列 var で宣言した配列は要素を変更できます。\nvar pigeons = [_]i32{ 1, 2, 3, 4, 5 }; pigeons[2] = 30; // 要素を変更 // pigeons は [1, 2, 30, 4, 5] 配列自体のサイズは固定ですが、個々の要素は書き換え可能です。\n文字列（u8 の配列） Zig では文字列は u8 の配列またはスライスとして扱われます。\nconst canary: []const u8 = \"Hello, Canary!\"; const length = canary.len; // 14 // センチネル終端文字列（null 終端） const finch: [:0]const u8 = \"Finch\"; 文字列リテラルは UTF-8 でエンコードされた u8 のスライスです。[:0] は null 終端（C 言語スタイル）の文字列を表します。\n6. 構造体 基本的な構造体 構造体は関連するデータをまとめるデータ構造です。struct キーワードで定義します。\nconst Cheetah = struct { speed: f32, age: i32, name: []const u8, // メソッド pub fn introduce(self: Cheetah) void { std.debug.print(\"I'm {s}, speed: {d:.1} km/h\\n\", .{self.name, self.speed}); } // 初期化関数 pub fn init(name: []const u8, speed: f32, age: i32) Cheetah { return Cheetah{ .name = name, .speed = speed, .age = age, }; } }; // 使用例 const cheetah = Cheetah{ .name = \"Lightning\", .speed = 120.0, .age = 3, }; cheetah.introduce(); // init 関数を使用 const cheetah2 = Cheetah.init(\"Thunder\", 115.0, 4); フィールドとメソッドを持てます。メソッドの第一引数に self を書くことで、インスタンスのデータにアクセスできます。\nデフォルト値を持つ構造体 フィールドにデフォルト値を設定できます。\nconst Gazelle = struct { speed: f32 = 80.0, age: i32 = 5, is_wild: bool = true, }; const gazelle = Gazelle{}; // すべてデフォルト値 const gazelle2 = Gazelle{ .speed = 90.0 }; // 一部を上書き 初期化時に値を省略すると、デフォルト値が使われます。一部だけ指定することもできます。\nジェネリック構造体 型をパラメータとして受け取る構造体です。\nfn Herd(comptime T: type) type { return struct { animals: []T, count: usize, pub fn init(animals: []T) @This() { return .{ .animals = animals, .count = animals.len, }; } }; } // 使用例 const speeds = [_]f32{ 80.0, 85.0, 90.0 }; const herd = Herd(f32).init(@constCast(\u0026speeds)); 関数が型を返すことで、ジェネリックな構造体を作れます。@This() は現在の型を表します。\nネストされた構造体 構造体の中に構造体を含めることができます。\nconst Enclosure = struct { capacity: i32, animal_count: i32, }; const Zoo = struct { name: []const u8, enclosure: Enclosure, }; const zoo = Zoo{ .name = \"Safari Zoo\", .enclosure = Enclosure{ .capacity = 50, .animal_count = 30, }, }; 複雑なデータ構造を表現するときに便利です。\n7. 列挙型とユニオン 列挙型（enum） 列挙型は名前付きの定数の集合を定義します。\nconst Habitat = enum { forest, ocean, desert, mountain, // メソッド pub fn describe(self: Habitat) []const u8 { return switch (self) { .forest =\u003e \"trees and vegetation\", .ocean =\u003e \"salt water\", .desert =\u003e \"sand and heat\", .mountain =\u003e \"high altitude\", }; } }; // 使用例 const habitat = Habitat.forest; const name = @tagName(habitat); // \"forest\" const desc = habitat.describe(); 列挙型もメソッドを持てます。@tagName で列挙値の名前を文字列として取得できます。\n整数値を持つ列挙型 各列挙値に整数を割り当てることができます。\nconst DangerLevel = enum(u8) { safe = 0, caution = 1, danger = 2, extreme = 3, }; const level = DangerLevel.danger; const value = @intFromEnum(level); // 2 enum(u8) で基底型を指定し、@intFromEnum で整数値を取得します。\nタグ付きユニオン ユニオンは複数の型のうち 1 つを保持できるデータ構造です。\nconst Animal = union(enum) { leopard: struct { spots: i32 }, jaguar: struct { territory: f32 }, cougar: struct { age: i32 }, pub fn print_info(self: Animal) void { switch (self) { .leopard =\u003e |l| std.debug.print(\"Leopard with {} spots\\n\", .{l.spots}), .jaguar =\u003e |j| std.debug.print(\"Jaguar with {d:.1} km² territory\\n\", .{j.territory}), .cougar =\u003e |c| std.debug.print(\"Cougar aged {} years\\n\", .{c.age}), } } }; // 使用例 const animal1 = Animal{ .leopard = .{ .spots = 50 } }; const animal2 = Animal{ .jaguar = .{ .territory = 120.5 } }; animal1.print_info(); // 出力: Leopard with 50 spots animal2.print_info(); // 出力: Jaguar with 120.5 km² territory // タグのチェック switch (animal1) { .leopard =\u003e std.debug.print(\"This is a leopard\\n\", .{}), // 出力: This is a leopard .jaguar =\u003e std.debug.print(\"This is a jaguar\\n\", .{}), .cougar =\u003e std.debug.print(\"This is a cougar\\n\", .{}), } union(enum) でタグ付きユニオンを作ります。switch で現在のタグをチェックし、対応する値を取り出せます。\n8. ポインタ 基本的なポインタ ポインタはメモリ上のアドレスを保持します。\u0026 でアドレスを取得し、.* で値にアクセスします。\nvar deer: i32 = 10; const deer_ptr: *i32 = \u0026deer; // ポインタを取得 // ポインタ経由で値を読む const value = deer_ptr.*; // 10 // ポインタ経由で値を変更 deer_ptr.* = 20; // deer は 20 になる *i32 は「i32 へのポインタ」を表します。ポインタを使うと、関数間でデータを共有したり変更したりできます。\nconst ポインタ 読み取り専用のポインタです。\nconst moose: i32 = 100; const moose_ptr: *const i32 = \u0026moose; // 読み取り専用 const value = moose_ptr.*; // OK // moose_ptr.* = 200; // エラー: 変更不可 *const i32 は「i32 への読み取り専用ポインタ」を表します。\n関数にポインタを渡す 関数の引数としてポインタを渡すと、呼び出し元の変数を変更できます。\nfn incrementFox(fox: *i32) void { fox.* += 1; } var fox: i32 = 5; incrementFox(\u0026fox); // fox は 6 になる 値渡しだとコピーが作られますが、ポインタ渡しだと元の変数を直接操作できます。\n配列へのポインタ 配列全体へのポインタです。\nconst rabbits = [5]i32{ 1, 2, 3, 4, 5 }; const rabbits_ptr: *const [5]i32 = \u0026rabbits; // ポインタ経由で配列要素にアクセス const element = rabbits_ptr[2]; // 3 配列のサイズもポインタの型の一部になります。\nスライスポインタ 配列のポインタはスライスに変換できます。\nvar squirrels = [_]i32{ 10, 20, 30, 40, 50 }; const squirrel_slice: []i32 = \u0026squirrels; // スライスの一部を取得 const sub_slice = squirrel_slice[1..3]; // [20, 30] スライスはポインタと長さの情報を持つので、柔軟に配列を扱えます。\nマルチポインタ 複数の要素を指すポインタです。長さの情報は持ちません。\nvar beavers = [_]i32{ 1, 2, 3, 4, 5 }; const beaver_multi_ptr: [*]i32 = \u0026beavers; const first = beaver_multi_ptr[0]; // 1 const second = beaver_multi_ptr[1]; // 2 [*]i32 は「複数の i32 へのポインタ」を表します。C 言語との互換性のためによく使われます。\nnullable ポインタ ? を使って null になり得るポインタを表現します。\nvar raccoon: i32 = 42; var raccoon_ptr: ?*i32 = \u0026raccoon; if (raccoon_ptr) |ptr| { std.debug.print(\"value: {}\\n\", .{ptr.*}); } raccoon_ptr = null; // null に設定 ポインタが有効かどうかわからない場合に使います。\n9. エラーハンドリング defer defer はスコープを抜けるときに式を実行します。リソースの解放などに便利です。\nfn deferExample() void { std.debug.print(\"Start\\n\", .{}); defer std.debug.print(\"End (deferred)\\n\", .{}); std.debug.print(\"Middle\\n\", .{}); // スコープを抜けるときに defer が実行される // 出力順: Start -\u003e Middle -\u003e End (deferred) } defer はスコープの終わりで必ず実行されます。関数から return しても、エラーが発生しても実行されます。\n複数の defer 複数の defer は LIFO（後入れ先出し）の順で実行されます。\nfn multipleDeferExample() void { defer std.debug.print(\"1st defer\\n\", .{}); defer std.debug.print(\"2nd defer\\n\", .{}); defer std.debug.print(\"3rd defer\\n\", .{}); std.debug.print(\"Function body\\n\", .{}); // 出力順: Function body -\u003e 3rd -\u003e 2nd -\u003e 1st } 後に書かれた defer が先に実行されます。これはリソースの確保と解放の順序を逆にするのに便利です。\ndefer とエラーの組み合わせ defer はエラーが発生しても必ず実行されます。\nfn deferWithError(should_fail: bool) !void { defer std.debug.print(\"Cleanup always happens\\n\", .{}); if (should_fail) { return error.Failed; } std.debug.print(\"Success\\n\", .{}); } エラーの有無に関わらず、スコープを抜けるときに defer が実行されます。これにより、確実にリソースを解放できます。\nエラーセットの定義 Zig では、エラーをエラーセットとして明示的に定義します。\nconst AnimalError = error{ TooYoung, TooOld, NotFound, InvalidSize, }; エラーセットは、発生する可能性のあるエラーを列挙したものです。型安全なエラーハンドリングができます。\nエラーを返す関数 関数がエラーを返す可能性がある場合、! を使います。\nfn checkHorseAge(age: i32) AnimalError!void { if (age \u003c 0) { return error.TooYoung; } if (age \u003e 30) { return error.TooOld; } // 正常終了 } AnimalError!void は「AnimalError のエラーまたは void を返す」という意味です。\nエラーハンドリング: catch catch でエラーを捕捉して処理します。\ncheckHorseAge(35) catch |err| { std.debug.print(\"Error: {}\\n\", .{err}); }; エラーが発生したら catch のブロックが実行されます。|err| でエラーの値を取得できます。\nエラーハンドリング: デフォルト値 エラー時にデフォルト値を返すこともできます。\nconst camel = findCamelById(-1) catch 0; // エラー時は 0 シンプルにエラーを処理したいときに便利です。\nエラーハンドリング: if if でエラーか正常値かを判定できます。\nif (findCamelById(5)) |camel_id| { std.debug.print(\"found: {}\\n\", .{camel_id}); } else |err| { std.debug.print(\"error: {}\\n\", .{err}); } 正常値は |camel_id|、エラーは else |err| で取得します。\nエラーハンドリング: try try はエラーを呼び出し元に伝播させます。\nfn processGoat(age: i32) !void { try checkHorseAge(age); // エラーがあれば即座に return std.debug.print(\"Age is valid\\n\", .{age}); } try は以下のように展開されます：\n// try checkHorseAge(age); は以下と同じ意味 checkHorseAge(age) catch |err| return err; つまり、try はエラーが発生したら自動的に return します。エラーハンドリングを簡潔に書けます。\n// 使用例 processGoat(10); // 成功: \"Age is valid\" と出力 processGoat(35); // error.TooOld を返す（呼び出し元にエラーが伝播） catch でエラーを処理する場合との違い：\ntry: エラーを上に投げる（伝播） catch: エラーをその場で処理する エラーハンドリング: errdefer エラー時のクリーンアップに使用します。\nvar yak: i32 = 0; blk: { errdefer yak = -1; // エラー発生時に実行 const value = findCamelById(-1) catch break :blk; yak = value; } errdefer はブロックがエラーで終了するときだけ実行されます。リソースの解放などに便利です。\n複数のエラーセット || で複数のエラーセットを結合できます。\nconst FileError = error{ FileNotFound, PermissionDenied, }; fn loadData(filename: []const u8) (AnimalError || FileError)![]const u8 { if (filename.len == 0) { return error.NotFound; // AnimalError のエラー } if (filename[0] == '/') { return error.PermissionDenied; // FileError のエラー } return \"data\"; } // 使用例 const data1 = loadData(\"\") catch |err| { // err は AnimalError.NotFound std.debug.print(\"Error: {}\\n\", .{err}); // 出力: Error: error.NotFound }; const data2 = loadData(\"/secret\") catch |err| { // err は FileError.PermissionDenied std.debug.print(\"Error: {}\\n\", .{err}); // 出力: Error: error.PermissionDenied }; const data3 = loadData(\"file.txt\") catch \"default\"; // 成功: data3 = \"data\" 複数の種類のエラーを返す可能性がある関数で使います。(AnimalError || FileError) は両方のエラーセットのエラーを返せることを意味します。\nエラーの切り替え switch でエラーの種類ごとに処理を分けられます。\ncheckHorseAge(35) catch |err| switch (err) { error.TooYoung =\u003e std.debug.print(\"Too young\\n\", .{}), error.TooOld =\u003e std.debug.print(\"Too old\\n\", .{}), error.NotFound =\u003e std.debug.print(\"Not found\\n\", .{}), error.InvalidSize =\u003e std.debug.print(\"Invalid size\\n\", .{}), }; エラーの種類に応じて異なる処理をしたいときに便利です。\n10. オプショナル型 オプショナル型の宣言 ? を使って null になり得る値を表現します。\nconst seal: ?i32 = 42; const empty_seal: ?i32 = null; ?i32 は「null または i32」を表します。値が存在しないかもしれない状況を型で表現できます。\nオプショナル型のアンラップ: if if で null かどうかをチェックして、値を取り出せます。\nif (seal) |value| { std.debug.print(\"has value: {}\\n\", .{value}); } else { std.debug.print(\"is null\\n\", .{}); } 値が存在すれば |value| で取り出し、null なら else ブロックが実行されます。\nオプショナル型のアンラップ: orelse null のときにデフォルト値を使えます。\nconst whale = empty_seal orelse 999; // null なら 999 オプショナル型を返す関数 値が見つからない可能性がある関数でよく使われます。\nfn findPenguinById(id: i32) ?i32 { if (id \u003c 0 or id \u003e 100) { return null; } return id * 2; } // 使用例 const penguin1 = findPenguinById(10); // ?i32 = 20 const penguin2 = findPenguinById(-5); // ?i32 = null エラーではないけど値がない状況を表すのに適しています。\nオプショナル型のポインタ ポインタも null になり得ます。\nvar otter: i32 = 100; var otter_ptr: ?*i32 = \u0026otter; if (otter_ptr) |ptr| { ptr.* = 200; // 値を変更 } otter_ptr = null; // null に設定 ポインタが有効かどうかをチェックできます。\nオプショナルと while ループ null になるまでループを続けることができます。\nvar narwhal: ?i32 = 5; while (narwhal) |value| { std.debug.print(\"{}\\n\", .{value}); if (value \u003c= 1) { narwhal = null; } else { narwhal = value - 1; } } // 出力: 5 4 3 2 1 条件を柔軟に書けて便利です。\n.? operator（強制アンラップ） null でないことが確実な場合に使用します。\nconst certain_seal: ?i32 = 777; const unwrapped = certain_seal.?; // 777 // null の場合はパニックになる .? で強制的に値を取り出します。null だったらプログラムが停止するので、確実に値があるときだけ使いましょう。\n11. コンパイル時計算 Zig の強力な機能の 1 つは、コンパイル時に計算を実行できることです。実行時のコストをゼロにできます。\nコンパイル時定数 コンパイル時に値が確定する定数です。\nconst lynx = 42; // コンパイル時に値が決定 const bobcat = comptime 10; // 明示的にコンパイル時定数 const で宣言した値は基本的にコンパイル時定数ですが、comptime で明示的に指定することもできます。\nコンパイル時関数 関数をコンパイル時に実行できます。\nfn factorialTiger(comptime n: i32) i32 { if (n \u003c= 1) return 1; return n * factorialTiger(n - 1); } const tiger_fact = comptime factorialTiger(5); // 120（コンパイル時に計算） comptime 引数を受け取る関数は、コンパイル時に評価されます。実行時のオーバーヘッドがありません。\nジェネリック関数 型をパラメータとして受け取る関数です。\nfn maxLion(comptime T: type, a: T, b: T) T { return if (a \u003e b) a else b; } const max_int = maxLion(i32, 10, 20); const max_float = maxLion(f32, 3.14, 2.71); comptime T: type で型をパラメータとして受け取ります。様々な型で動作する汎用的な関数を書けます。\nコンパイル時に配列を生成 配列をコンパイル時に生成できます。\nfn createPandasArray(comptime size: usize) [size]i32 { var pandas: [size]i32 = undefined; for (\u0026pandas, 0..) |*panda, i| { panda.* = @intCast(i * 10); } return pandas; } const pandas = createPandasArray(5); // [0, 10, 20, 30, 40] 配列のサイズもコンパイル時に決定されます。\nコンパイル時条件分岐 条件によって異なるコードを生成できます。\nfn processJaguar(comptime is_large: bool, value: i32) i32 { if (is_large) { return value * 2; } else { return value + 10; } } const jaguar1 = processJaguar(true, 5); // 10 const jaguar2 = processJaguar(false, 5); // 15 comptime の条件分岐は、コンパイル時に評価されて不要なコードは削除されます。\n型を返す関数 関数が型を返すことができます。これでジェネリックな構造体を作れます。\nfn PairOfAnimals(comptime T: type) type { return struct { first: T, second: T, pub fn swap(self: *@This()) void { const temp = self.first; self.first = self.second; self.second = temp; } }; } // 使用例 var bear_pair = PairOfAnimals(i32){ .first = 10, .second = 20, }; bear_pair.swap(); // first=20, second=10 @This() は現在の型を返します。型を動的に生成できるのが Zig の特徴です。\nビルトイン型情報 型に関する情報をコンパイル時に取得できます。\n// 型のサイズ const size_i32 = @sizeOf(i32); // 4 // 型の名前 const name = @typeName(i32); // \"i32\" // 型情報 const info = @typeInfo(i32); switch (info) { .int =\u003e |int_info| { // int_info.signedness, int_info.bits }, else =\u003e {}, } リフレクションのような機能をコンパイル時に使えます。\ninline for コンパイル時にループを展開します。\nconst numbers = [_]i32{ 1, 2, 3, 4, 5 }; var sum: i32 = 0; inline for (numbers) |num| { sum += num; } ループが展開されて、実行時にはループのオーバーヘッドがなくなります。\n12. メモリアロケータ Zig では明示的にメモリアロケータを管理します。メモリの確保と解放を意識的に行います。\nGeneralPurposeAllocator 推奨される汎用アロケータです。\nvar gpa = std.heap.GeneralPurposeAllocator(.{}){}; defer _ = gpa.deinit(); const allocator = gpa.allocator(); defer でスコープを抜けるときに自動的にメモリを解放します。メモリリークを防げます。\n単一の値をアロケート 単一の値をヒープに確保します。\nconst elephant = try allocator.create(i32); defer allocator.destroy(elephant); elephant.* = 42; create で確保、destroy で解放します。\n配列をアロケート 動的サイズの配列を確保します。\nconst tigers = try allocator.alloc(i32, 5); defer allocator.free(tigers); for (tigers, 0..) |*tiger, i| { tiger.* = @intCast(i * 10); } alloc で配列を確保、free で解放します。実行時にサイズが決まる配列に便利です。\nArrayList 動的配列を使用します。要素数が増えたり減ったりする配列です。\nvar leopards = try std.ArrayList(i32).initCapacity(allocator, 0); defer leopards.deinit(allocator); try leopards.append(allocator, 10); try leopards.append(allocator, 20); try leopards.append(allocator, 30); // アクセス for (leopards.items) |leopard| { std.debug.print(\"{} \", .{leopard}); } append で要素を追加できます。自動的にサイズが拡張されます。\nArenaAllocator まとめて解放するアロケータです。\nvar arena = std.heap.ArenaAllocator.init(allocator); defer arena.deinit(); // すべてのメモリを一度に解放 const arena_allocator = arena.allocator(); const bears = try arena_allocator.alloc(i32, 10); const wolves = try arena_allocator.alloc(i32, 20); // 個別の free は不要 arena.deinit() で一括解放できます。個別に free しなくていいので楽ちんです。\nFixedBufferAllocator 固定サイズバッファを使用するアロケータです。\nvar buffer: [1024]u8 = undefined; var fba = std.heap.FixedBufferAllocator.init(\u0026buffer); const fba_allocator = fba.allocator(); const rabbits = try fba_allocator.alloc(i32, 5); スタックに確保したバッファを使います。ヒープ確保が不要な場合に便利です。\nHashMap ハッシュマップの使用例です。\nvar deer_map = std.StringHashMap(i32).init(allocator); defer deer_map.deinit(); try deer_map.put(\"red_deer\", 150); try deer_map.put(\"roe_deer\", 50); // 値の取得 if (deer_map.get(\"red_deer\")) |weight| { std.debug.print(\"weight: {}\\n\", .{weight}); } // イテレーション var iterator = deer_map.iterator(); while (iterator.next()) |entry| { std.debug.print(\"{s}={}\\n\", .{entry.key_ptr.*, entry.value_ptr.*}); } キーと値のペアを管理します。put で追加、get で取得、iterator で全要素を走査できます。\n文字列の複製 文字列をコピーします。\nconst original_seal = \"Seal\"; const copied_seal = try allocator.dupe(u8, original_seal); defer allocator.free(copied_seal); dupe で複製を作ります。元の文字列とは別のメモリ領域に確保されます。\n13. テスト Zig には組み込みのテストフレームワークがあります。test キーワードでテストを書けます。\n基本的なテスト test ブロックでテストを定義します。\nconst std = @import(\"std\"); pub fn add(a: i32, b: i32) i32 { return a + b; } test \"basic addition\" { const result = add(2, 3); try std.testing.expectEqual(5, result); } zig test filename.zig でテストを実行できます。std.testing.expectEqual で値が等しいかをチェックします。\nテストアサーション 様々なアサーション関数が用意されています。\ntest \"various assertions\" { // 等価性チェック try std.testing.expectEqual(42, 42); // 真偽値チェック try std.testing.expect(true); try std.testing.expect(!false); // 文字列の等価性 try std.testing.expectEqualStrings(\"hello\", \"hello\"); } expect は真偽値を、expectEqual は値の等価性を、expectEqualStrings は文字列の等価性をチェックします。\nエラーのテスト エラーが正しく返されるかをテストできます。\npub fn divide(a: i32, b: i32) !i32 { if (b == 0) { return error.DivisionByZero; } return @divTrunc(a, b); } test \"divide success\" { const result = try divide(10, 2); try std.testing.expectEqual(5, result); } test \"divide by zero error\" { const result = divide(10, 0); try std.testing.expectError(error.DivisionByZero, result); } expectError で特定のエラーが返されることを確認できます。\n構造体のテスト 構造体のメソッドもテストできます。\npub const Animal = struct { name: []const u8, age: i32, pub fn isAdult(self: Animal) bool { return self.age \u003e= 18; } }; test \"Animal struct\" { const cat = Animal{ .name = \"Whiskers\", .age = 3, }; try std.testing.expectEqualStrings(\"Whiskers\", cat.name); try std.testing.expectEqual(3, cat.age); try std.testing.expect(!cat.isAdult()); } 構造体のフィールドやメソッドを個別にテストできます。\nメモリアロケーションのテスト std.testing.allocator を使ってメモリアロケーションをテストできます。\ntest \"allocator test\" { const allocator = std.testing.allocator; const numbers = try allocator.alloc(i32, 5); defer allocator.free(numbers); for (numbers, 0..) |*num, i| { num.* = @intCast(i * 10); } try std.testing.expectEqual(0, numbers[0]); try std.testing.expectEqual(10, numbers[1]); } std.testing.allocator はメモリリークを検出してくれます。defer で確実に解放することが重要です。\n14. モジュール モジュールを呼び出すコードです。\n// lib.zig pub fn greet() void { stg.debug.print(\"Hello\\n\", .{}); } // main.zig const lib = @import(\"lib.zig\"); lib.greet(); 備考 zig にはその他 C 言語連携、アセンブリ埋め込み、非同期処理、クロスコンパイル等の機能を持っているそうです。\nさらに学ぶために Zig 言語リファレンス Zig 標準ライブラリ 公式ドキュメントには詳しい情報が載っています。標準ライブラリのドキュメントも充実しているので、ぜひチェックしてみてください。\n",
  "wordCount" : "3369",
  "inLanguage": "en",
  "image": "https://jedipunkz.github.io/jedipunkz.jpg","datePublished": "2025-10-24T21:29:24+09:00",
  "dateModified": "2025-10-24T21:29:24+09:00",
  "author":{
    "@type": "Person",
    "name": "jedipunkz"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jedipunkz.github.io/post/zig-tutorial/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "jedipunkz 🚀 のブログ",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jedipunkz.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jedipunkz.github.io/" accesskey="h" title="jedipunkz 🚀 のブログ (Alt + H)">jedipunkz 🚀 のブログ</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jedipunkz.github.io/about" title="About Me">
                    <span>About Me</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://jedipunkz.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://jedipunkz.github.io/post/">Posts</a></div>
    <h1 class="post-title">
      Zig 入門: 構文集
    </h1>
    
  </header> 
  <div class="post-content"><p>こんにちは <a href="https://x.com/jedipunkz">@jedipunkz</a> です。</p>
<p>コーディングを学習する機会を増やしている最中なのですが、自分は底レイヤが好きなのを思い出し、またたまに Mitchell Hashimoto 氏が Zig のことを呟いてるのを覚えていたので、突然 Zig に入門したくなりました。</p>
<p>ということで後に自分でも読み返せる形にしようと思い Zig の構文集を記します。</p>
<h1 id="notice">NOTICE<a hidden class="anchor" aria-hidden="true" href="#notice">#</a></h1>
<p>※  現時点で Stable な 0.15.1 を前提に記します。
※  気が向いたときに言語仕様の変化に対応して修正していこうと思います。</p>
<h1 id="はじめに">はじめに<a hidden class="anchor" aria-hidden="true" href="#はじめに">#</a></h1>
<p>このドキュメントは、Zig 言語の主要な構文を網羅的にまとめたチュートリアルです。すべてのサンプルコードは記事の修正時点で Stable なリリースバージョンの Zig で動作確認しています。</p>
<h2 id="目次">目次<a hidden class="anchor" aria-hidden="true" href="#目次">#</a></h2>
<ol>
<li><a href="/post/zig-tutorial/#1-%e5%9f%ba%e6%9c%ac%e6%a7%8b%e6%96%87">基本構文</a></li>
<li><a href="/post/zig-tutorial/#2-%e6%bc%94%e7%ae%97%e5%ad%90">演算子</a></li>
<li><a href="/post/zig-tutorial/#3-%e5%88%b6%e5%be%a1%e6%a7%8b%e6%96%87">制御構文</a></li>
<li><a href="/post/zig-tutorial/#4-%e9%96%a2%e6%95%b0">関数</a></li>
<li><a href="/post/zig-tutorial/#5-%e9%85%8d%e5%88%97%e3%81%a8%e3%82%b9%e3%83%a9%e3%82%a4%e3%82%b9">配列とスライス</a></li>
<li><a href="/post/zig-tutorial/#6-%e6%a7%8b%e9%80%a0%e4%bd%93">構造体</a></li>
<li><a href="/post/zig-tutorial/#7-%e5%88%97%e6%8c%99%e5%9e%8b%e3%81%a8%e3%83%a6%e3%83%8b%e3%82%aa%e3%83%b3">列挙型とユニオン</a></li>
<li><a href="/post/zig-tutorial/#8-%e3%83%9d%e3%82%a4%e3%83%b3%e3%82%bf">ポインタ</a></li>
<li><a href="/post/zig-tutorial/#9-%e3%82%a8%e3%83%a9%e3%83%bc%e3%83%8f%e3%83%b3%e3%83%89%e3%83%aa%e3%83%b3%e3%82%b0">エラーハンドリング</a></li>
<li><a href="/post/zig-tutorial/#10-%e3%82%aa%e3%83%97%e3%82%b7%e3%83%a7%e3%83%8a%e3%83%ab%e5%9e%8b">オプショナル型</a></li>
<li><a href="/post/zig-tutorial/#11-%e3%82%b3%e3%83%b3%e3%83%91%e3%82%a4%e3%83%ab%e6%99%82%e8%a8%88%e7%ae%97">コンパイル時計算</a></li>
<li><a href="/post/zig-tutorial/#12-%e3%83%a1%e3%83%a2%e3%83%aa%e3%82%a2%e3%83%ad%e3%82%b1%e3%83%bc%e3%82%bf">メモリアロケータ</a></li>
<li><a href="/post/zig-tutorial/#13-%e3%83%86%e3%82%b9%e3%83%88">テスト</a></li>
<li><a href="/post/zig-tutorial/#14-%e3%83%a2%e3%82%b8%e3%83%a5%e3%83%bc%e3%83%ab">モジュール</a></li>
</ol>
<hr>
<h2 id="1-基本構文">1. 基本構文<a hidden class="anchor" aria-hidden="true" href="#1-基本構文">#</a></h2>
<h3 id="変数宣言">変数宣言<a hidden class="anchor" aria-hidden="true" href="#変数宣言">#</a></h3>
<p>Zig には 2 種類の変数宣言があります。<code>const</code> は不変変数（再代入不可）、<code>var</code> は可変変数（再代入可能）を表します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">cat</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">  </span><span class="c1">// const: 不変変数（再代入不可）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">var</span><span class="w"> </span><span class="n">dog</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">   </span><span class="c1">// var: 可変変数（再代入可能）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">dog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">;</span><span class="w">  </span><span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1">// cat = 10;  // エラー: const は変更不可
</span></span></span></code></pre></div><h3 id="型推論">型推論<a hidden class="anchor" aria-hidden="true" href="#型推論">#</a></h3>
<p>型を明示的に指定しなくても、コンパイラが自動的に型を推論してくれます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">rabbit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w">    </span><span class="c1">// i32 と推論される
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">fox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14</span><span class="p">;</span><span class="w">     </span><span class="c1">// f64 と推論される
</span></span></span></code></pre></div><p>整数リテラルはデフォルトで <code>i32</code> 型、浮動小数点リテラルは <code>f64</code> 型として推論されます。</p>
<h3 id="基本的なデータ型">基本的なデータ型<a hidden class="anchor" aria-hidden="true" href="#基本的なデータ型">#</a></h3>
<p>Zig にはさまざまな基本的なデータ型があります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">bear</span><span class="o">:</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">255</span><span class="p">;</span><span class="w">        </span><span class="c1">// 符号なし 8bit 整数 (0〜255)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">wolf</span><span class="o">:</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1000</span><span class="p">;</span><span class="w">     </span><span class="c1">// 符号付き 64bit 整数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">eagle</span><span class="o">:</span><span class="w"> </span><span class="kt">f32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.718</span><span class="p">;</span><span class="w">    </span><span class="c1">// 32bit 浮動小数点数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">shark</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">    </span><span class="c1">// 真偽値
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">tiger</span><span class="o">:</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;A&#39;</span><span class="p">;</span><span class="w">       </span><span class="c1">// 文字（u8 として扱われる）
</span></span></span></code></pre></div><p>整数型:</p>
<ul>
<li>符号付き: <code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code>, <code>i128</code>, <code>isize</code></li>
<li>符号なし: <code>u8</code>, <code>u16</code>, <code>u32</code>, <code>u64</code>, <code>u128</code>, <code>usize</code></li>
</ul>
<p>浮動小数点型:</p>
<ul>
<li><code>f16</code>, <code>f32</code>, <code>f64</code>, <code>f128</code></li>
</ul>
<p>整数型の数字はビット幅を表します。例えば <code>i32</code> は 32 ビットの符号付き整数です。<code>isize</code> と <code>usize</code> はポインタのサイズと同じで、プラットフォームによって変わります。</p>
<h3 id="undefined未初期化値">undefined（未初期化値）<a hidden class="anchor" aria-hidden="true" href="#undefined未初期化値">#</a></h3>
<p><code>undefined</code> は変数が未初期化であることを明示的に示します。値は不定なので、使用前に必ず初期化する必要があります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">snake</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span><span class="w">  </span><span class="c1">// 未初期化（値は不定）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">snake</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="p">;</span><span class="w">  </span><span class="c1">// 使用前に必ず初期化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 配列の undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">var</span><span class="w"> </span><span class="n">array</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">..)</span><span class="w"> </span><span class="o">|*</span><span class="n">item</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">item</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@intCast</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>デバッグモードでは、Zig は <code>undefined</code> の領域を <code>0xaa</code> バイトで埋めます。これはバグの早期発見に役立ちます。<code>undefined</code> を使うことで、初期化が不要な場合にパフォーマンスを向上できます。</p>
<h3 id="型変換">型変換<a hidden class="anchor" aria-hidden="true" href="#型変換">#</a></h3>
<p>Zig では明示的な型変換が必要です。様々なビルトイン関数が用意されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// @as: コンパイル時型変換
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">num_u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@as</span><span class="p">(</span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// @intCast: 整数型間の変換
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">large_num</span><span class="o">:</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">small_num</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@intCast</span><span class="p">(</span><span class="n">large_num</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// @floatCast: 浮動小数点型間の変換
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">double</span><span class="o">:</span><span class="w"> </span><span class="kt">f64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14159265</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">single</span><span class="o">:</span><span class="w"> </span><span class="kt">f32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@floatCast</span><span class="p">(</span><span class="n">double</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// @floatFromInt: 整数から浮動小数点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">int_val</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">float_val</span><span class="o">:</span><span class="w"> </span><span class="kt">f32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@floatFromInt</span><span class="p">(</span><span class="n">int_val</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// @intFromFloat: 浮動小数点から整数（切り捨て）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">pi</span><span class="o">:</span><span class="w"> </span><span class="kt">f32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">pi_int</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@intFromFloat</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span><span class="w">  </span><span class="c1">// 3
</span></span></span></code></pre></div><p>型変換は明示的に行う必要があります。これにより、意図しない型変換によるバグを防げます。<code>@as</code> はコンパイル時に型を指定し、他の関数は実行時の型変換を行います。</p>
<hr>
<h2 id="2-演算子">2. 演算子<a hidden class="anchor" aria-hidden="true" href="#2-演算子">#</a></h2>
<h3 id="算術演算子">算術演算子<a hidden class="anchor" aria-hidden="true" href="#算術演算子">#</a></h3>
<p>数値の計算を行う演算子です。加算、減算、乗算は一般的ですが、除算と剰余は Zig のビルトイン関数を使います。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">lion</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">leopard</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">lion</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">leopard</span><span class="w">     </span><span class="c1">// 13  加算
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">lion</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">leopard</span><span class="w">     </span><span class="c1">// 7   減算
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">lion</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">leopard</span><span class="w">     </span><span class="c1">// 30  乗算
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nb">@divTrunc</span><span class="p">(</span><span class="n">lion</span><span class="p">,</span><span class="w"> </span><span class="n">leopard</span><span class="p">)</span><span class="w">  </span><span class="c1">// 3   整数除算（切り捨て）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nb">@rem</span><span class="p">(</span><span class="n">lion</span><span class="p">,</span><span class="w"> </span><span class="n">leopard</span><span class="p">)</span><span class="w">       </span><span class="c1">// 1   剰余
</span></span></span></code></pre></div><p>注意: Zig では整数の除算や剰余にビルトイン関数を使用します。これはオーバーフローや未定義動作を防ぐためです。<code>@divTrunc</code> は切り捨て除算、<code>@rem</code> は剰余を計算します。</p>
<h3 id="比較演算子">比較演算子<a hidden class="anchor" aria-hidden="true" href="#比較演算子">#</a></h3>
<p>2 つの値を比較する演算子です。結果は <code>bool</code> 型（真または偽）になります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="n">panda</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">koala</span><span class="w">    </span><span class="c1">// 等しい
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">panda</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">lion</span><span class="w">     </span><span class="c1">// 等しくない
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">panda</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lion</span><span class="w">      </span><span class="c1">// より小さい
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">panda</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">leopard</span><span class="w">   </span><span class="c1">// より大きい
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">panda</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">koala</span><span class="w">    </span><span class="c1">// 以下
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">panda</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">leopard</span><span class="w">  </span><span class="c1">// 以上
</span></span></span></code></pre></div><p>これらの演算子は条件分岐（<code>if</code> 文など）でよく使われます。</p>
<h3 id="論理演算子">論理演算子<a hidden class="anchor" aria-hidden="true" href="#論理演算子">#</a></h3>
<p>真偽値（<code>bool</code> 型）を操作する演算子です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">monkey</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">gorilla</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">monkey</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">gorilla</span><span class="w">    </span><span class="c1">// false (論理積)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">monkey</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">gorilla</span><span class="w">     </span><span class="c1">// true  (論理和)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">!</span><span class="n">monkey</span><span class="w">              </span><span class="c1">// false (否定)
</span></span></span></code></pre></div><p><code>and</code> は両方が真のときだけ真、<code>or</code> はどちらかが真なら真、<code>!</code> は真偽を反転させます。</p>
<h3 id="ビット演算子">ビット演算子<a hidden class="anchor" aria-hidden="true" href="#ビット演算子">#</a></h3>
<p>整数のビット単位で操作を行う演算子です。2 進数で考えるとわかりやすいです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">zebra</span><span class="o">:</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mb">0b1010</span><span class="p">;</span><span class="w">    </span><span class="c1">// 10 (2進数)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">giraffe</span><span class="o">:</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mb">0b1100</span><span class="p">;</span><span class="w">  </span><span class="c1">// 12 (2進数)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">zebra</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">giraffe</span><span class="w">     </span><span class="c1">// 0b1000  (AND)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">zebra</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">giraffe</span><span class="w">     </span><span class="c1">// 0b1110  (OR)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">zebra</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">giraffe</span><span class="w">     </span><span class="c1">// 0b0110  (XOR)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">~</span><span class="n">zebra</span><span class="w">             </span><span class="c1">// 0b11110101 (NOT)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">zebra</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w">         </span><span class="c1">// 0b00010100 (左シフト)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">zebra</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w">         </span><span class="c1">// 0b0101     (右シフト)
</span></span></span></code></pre></div><p><code>&amp;</code> はビット AND、<code>|</code> はビット OR、<code>^</code> はビット XOR、<code>~</code> はビット NOT、<code>&lt;&lt;</code> は左シフト、<code>&gt;&gt;</code> は右シフトを行います。</p>
<hr>
<h2 id="3-制御構文">3. 制御構文<a hidden class="anchor" aria-hidden="true" href="#3-制御構文">#</a></h2>
<h3 id="if-文">if 文<a hidden class="anchor" aria-hidden="true" href="#if-文">#</a></h3>
<p>条件によって処理を分岐させる構文です。条件は <code>()</code> で囲み、実行するコードは <code>{}</code> で囲みます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">elephant</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">elephant</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;elephant is large</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">elephant</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;elephant is medium</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;elephant is small</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>else if</code> で複数の条件を書けます。上から順に評価されて、最初に真になった条件のブロックが実行されます。</p>
<h3 id="if-式値を返す">if 式（値を返す）<a hidden class="anchor" aria-hidden="true" href="#if-式値を返す">#</a></h3>
<p>Zig の <code>if</code> は式として値を返すことができます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">rhino</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">hippo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rhino</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="s">&#34;large&#34;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s">&#34;small&#34;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>条件によって異なる値を変数に代入したいときに、コードが簡潔に書けます。</p>
<h3 id="while-文">while 文<a hidden class="anchor" aria-hidden="true" href="#while-文">#</a></h3>
<p>条件が真の間、繰り返し処理を実行します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">mouse</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">mouse</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;{} &#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">mouse</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mouse</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 出力: 0 1 2 3 4
</span></span></span></code></pre></div><p>ループの中で変数を変更して、最終的に条件が偽になるようにします。無限ループに注意しましょう。</p>
<h3 id="while-文continue-式付き">while 文（continue 式付き）<a hidden class="anchor" aria-hidden="true" href="#while-文continue-式付き">#</a></h3>
<p>ループの最後に毎回実行される式を指定できます。<code>: ()</code> の部分に書きます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">hamster</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">hamster</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">hamster</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;{} &#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">hamster</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 出力: 0 1 2 3 4
</span></span></span></code></pre></div><h3 id="for-文配列のイテレーション">for 文（配列のイテレーション）<a hidden class="anchor" aria-hidden="true" href="#for-文配列のイテレーション">#</a></h3>
<p>配列やスライスの要素を順番に処理します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">animals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">_</span><span class="p">][]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">{</span><span class="w"> </span><span class="s">&#34;snake&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;lizard&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;turtle&#34;</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 要素のみ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">animals</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">animal</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;{s} &#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">animal</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// インデックス付き
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">animals</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">..)</span><span class="w"> </span><span class="o">|</span><span class="n">animal</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;[{}]{s} &#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">animal</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>|animal|</code> で各要素を取り出します。インデックスも必要なら、<code>0..</code> と組み合わせて <code>|animal, i|</code> のように書けます。</p>
<h3 id="switch-文">switch 文<a hidden class="anchor" aria-hidden="true" href="#switch-文">#</a></h3>
<p>値に応じて処理を分岐させます。Zig の <code>switch</code> は式として値を返すことができます。すべてのケースを網羅する必要があります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">penguin</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">penguin</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;one&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;two&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;three&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;many&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></div><p><code>=&gt;</code> の左側が条件、右側が対応する値や処理です。<code>else</code> ですべてのケースを網羅できます。</p>
<h3 id="break-と-continue">break と continue<a hidden class="anchor" aria-hidden="true" href="#break-と-continue">#</a></h3>
<p>ループの流れを制御する構文です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// break: ループを抜ける
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">var</span><span class="w"> </span><span class="n">crow</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">crow</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;{} &#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">crow</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">crow</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// continue: 次のイテレーションへ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">var</span><span class="w"> </span><span class="n">sparrow</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">sparrow</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">sparrow</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sparrow</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w">  </span><span class="c1">// 2 をスキップ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;{} &#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">sparrow</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 出力: 0 1 3 4
</span></span></span></code></pre></div><p><code>break</code> でループを抜け出し、<code>continue</code> で次のループに進みます。特定の条件でループを制御したいときに使います。</p>
<h3 id="ラベル付きブロック">ラベル付きブロック<a hidden class="anchor" aria-hidden="true" href="#ラベル付きブロック">#</a></h3>
<p>ブロックにラベルを付けて、<code>break</code> で値を返すことができます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">swan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">blk</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">break</span><span class="w"> </span><span class="o">:</span><span class="n">blk</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w">  </span><span class="c1">// ブロックから値を返す
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// swan は 30
</span></span></span></code></pre></div><p>ブロックを式として使い、計算結果を返せます。複雑な初期化処理を書くときに便利です。</p>
<h3 id="ラベル付きループ">ラベル付きループ<a hidden class="anchor" aria-hidden="true" href="#ラベル付きループ">#</a></h3>
<p>ネストされたループで外側のループを制御できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">peacock</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">outer</span><span class="o">:</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">peacock</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">peacock</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">inner</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">inner</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">inner</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">peacock</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">inner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">break</span><span class="w"> </span><span class="o">:</span><span class="n">outer</span><span class="p">;</span><span class="w">  </span><span class="c1">// 外側のループを抜ける
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>break :outer</code> で外側のループを抜けることができます。ラベルを使うことで、どのループを制御するかを明確に指定できます。</p>
<h3 id="unreachable">unreachable<a hidden class="anchor" aria-hidden="true" href="#unreachable">#</a></h3>
<p>到達不可能なコードパスを明示的に示します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">owl</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">owl_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">owl</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="s">&#34;positive&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                   </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">owl</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="s">&#34;negative&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                   </span><span class="k">else</span><span class="w"> </span><span class="k">unreachable</span><span class="p">;</span><span class="w">  </span><span class="c1">// owl は 5 なので到達しない
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// switch での使用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">falcon</span><span class="o">:</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">falcon_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">falcon</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;peregrine&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;gyrfalcon&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;merlin&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">unreachable</span><span class="p">,</span><span class="w">  </span><span class="c1">// 1-3 以外は来ないと仮定
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></div><p>デバッグモードでは <code>unreachable</code> に到達すると panic を発生させます。ReleaseFast モードでは、コンパイラがこのコードパスに到達しないと仮定して最適化を行います。論理的に到達不可能な箇所を明示することで、バグを早期発見できます。</p>
<hr>
<h2 id="4-関数">4. 関数<a hidden class="anchor" aria-hidden="true" href="#4-関数">#</a></h2>
<h3 id="基本的な関数">基本的な関数<a hidden class="anchor" aria-hidden="true" href="#基本的な関数">#</a></h3>
<p><code>fn</code> キーワードで関数を定義します。引数と戻り値の型を明示的に指定します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">addDolphins</span><span class="p">(</span><span class="n">dolphin1</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">dolphin2</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">dolphin1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dolphin2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">addDolphins</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">  </span><span class="c1">// 8
</span></span></span></code></pre></div><p>関数名の後の <code>()</code> に引数、その後に戻り値の型を書きます。<code>return</code> で値を返します。</p>
<h3 id="複数の戻り値構造体を使用">複数の戻り値（構造体を使用）<a hidden class="anchor" aria-hidden="true" href="#複数の戻り値構造体を使用">#</a></h3>
<p>複数の値を返したいときは、構造体を使います。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">getWhaleInfo</span><span class="p">()</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">age</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="o">:</span><span class="w"> </span><span class="kt">f32</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">.{</span><span class="w"> </span><span class="p">.</span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">30000.5</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">whale_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">getWhaleInfo</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;age: {}, weight: {d:.1}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">whale_info</span><span class="p">.</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">whale_info</span><span class="p">.</span><span class="n">weight</span><span class="p">});</span><span class="w">
</span></span></span></code></pre></div><p>無名構造体を戻り値の型として使えます。<code>.{}</code> で構造体リテラルを作成して返します。</p>
<h3 id="void-関数">void 関数<a hidden class="anchor" aria-hidden="true" href="#void-関数">#</a></h3>
<p>何も返さない関数は <code>void</code> 型を使います。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">printSeal</span><span class="p">()</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Seal!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>return</code> 文を書かなくても、関数の最後まで実行されたら自動的に戻ります。</p>
<h3 id="エラーを返す関数">エラーを返す関数<a hidden class="anchor" aria-hidden="true" href="#エラーを返す関数">#</a></h3>
<p><code>!</code> を使ってエラーを返す可能性があることを示します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">divideOtters</span><span class="p">(</span><span class="n">otter1</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">otter2</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="o">!</span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">otter2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">error</span><span class="p">.</span><span class="n">DivisionByZero</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">@divTrunc</span><span class="p">(</span><span class="n">otter1</span><span class="p">,</span><span class="w"> </span><span class="n">otter2</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 使用例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">divideOtters</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="o">|</span><span class="n">err</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Error: {}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">err</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></div><p><code>!i32</code> は「エラーまたは <code>i32</code> を返す」という意味です。エラーが発生する可能性がある処理に便利です。</p>
<h3 id="オプショナル型を返す関数">オプショナル型を返す関数<a hidden class="anchor" aria-hidden="true" href="#オプショナル型を返す関数">#</a></h3>
<p><code>?</code> を使って null を返す可能性があることを示します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">findBadger</span><span class="p">(</span><span class="n">badger_id</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">badger_id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">badger_id</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 使用例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">findBadger</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="w"> </span><span class="o">|</span><span class="n">badger</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;found: {}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">badger</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;not found</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>?i32</code> は「null または <code>i32</code> を返す」という意味です。値が存在しないかもしれない状況で使います。</p>
<h3 id="スライスを使った関数">スライスを使った関数<a hidden class="anchor" aria-hidden="true" href="#スライスを使った関数">#</a></h3>
<p>配列やスライスを引数として受け取る関数です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">sumRaccoons</span><span class="p">(</span><span class="n">raccoons</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">total</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">raccoons</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">raccoon</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">raccoon</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">total</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="kt">i32</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sumRaccoons</span><span class="p">(</span><span class="o">&amp;</span><span class="n">array</span><span class="p">);</span><span class="w">  </span><span class="c1">// 15
</span></span></span></code></pre></div><p><code>[]const i32</code> は「<code>i32</code> の読み取り専用スライス」を表します。配列のポインタを渡すとスライスに変換されます。</p>
<h3 id="ジェネリック関数">ジェネリック関数<a hidden class="anchor" aria-hidden="true" href="#ジェネリック関数">#</a></h3>
<p><code>comptime</code> パラメータを使って型をパラメータ化できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">maxMammal</span><span class="p">(</span><span class="kr">comptime</span><span class="w"> </span><span class="n">T</span><span class="o">:</span><span class="w"> </span><span class="kt">type</span><span class="p">,</span><span class="w"> </span><span class="n">mammal1</span><span class="o">:</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">mammal2</span><span class="o">:</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mammal1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mammal2</span><span class="p">)</span><span class="w"> </span><span class="n">mammal1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">mammal2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">max_int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">maxMammal</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span><span class="w">      </span><span class="c1">// 20
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">max_float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">maxMammal</span><span class="p">(</span><span class="kt">f32</span><span class="p">,</span><span class="w"> </span><span class="mf">3.14</span><span class="p">,</span><span class="w"> </span><span class="mf">2.71</span><span class="p">);</span><span class="w"> </span><span class="c1">// 3.14
</span></span></span></code></pre></div><p><code>comptime</code> はコンパイル時に値が決定されることを意味します。型をパラメータとして受け取り、様々な型で動作する関数を作れます。</p>
<h3 id="inline-関数">inline 関数<a hidden class="anchor" aria-hidden="true" href="#inline-関数">#</a></h3>
<p><code>inline</code> キーワードで関数をインライン展開します。通常関数呼出しには「引数をスタックに積む」「関数にジャンプする」「戻る」というコストが掛かるそうですが、inline 関数を使うとコストがゼロになるそうです。</p>
<p>ただし呼び出し箇所が多い場合は同じコードが何度も展開されバイナリサイズが大きくなり、また大きな関数には向かないそうです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">inline</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">squareChipmunk</span><span class="p">(</span><span class="n">chipmunk</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">chipmunk</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">chipmunk</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>関数呼び出しのオーバーヘッドをなくし、呼び出し箇所に直接コードを埋め込みます。小さな関数のパフォーマンス向上に役立ちます。</p>
<hr>
<h2 id="5-配列とスライス">5. 配列とスライス<a hidden class="anchor" aria-hidden="true" href="#5-配列とスライス">#</a></h2>
<h3 id="配列の宣言">配列の宣言<a hidden class="anchor" aria-hidden="true" href="#配列の宣言">#</a></h3>
<p>配列は固定長のデータ構造です。<code>[N]T</code> の形で型を表します（N は要素数、T は型）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// 固定長配列
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">parrots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">i32</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 長さを推論
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">owls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="kt">i32</span><span class="p">{</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">// [3]i32
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 同じ値で初期化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">hawks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="kt">i32</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w">  </span><span class="c1">// [4]i32{ 0, 0, 0, 0 }
</span></span></span></code></pre></div><p><code>[_]</code> を使うと、初期化子から要素数を自動的に推論してくれます。<code>**</code> 演算子で同じ値を繰り返せます。</p>
<h3 id="配列の操作">配列の操作<a hidden class="anchor" aria-hidden="true" href="#配列の操作">#</a></h3>
<p>配列の要素にアクセスしたり、長さを取得したりできます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// 長さの取得
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">owls</span><span class="p">.</span><span class="n">len</span><span class="p">;</span><span class="w">  </span><span class="c1">// 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 要素へのアクセス
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parrots</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w">  </span><span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ループ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">parrots</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">parrot</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;{} &#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">parrot</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>.len</code> で配列の長さが取得できます。インデックスは 0 から始まります。</p>
<h3 id="多次元配列">多次元配列<a hidden class="anchor" aria-hidden="true" href="#多次元配列">#</a></h3>
<p>配列の配列を作ることができます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">falcons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="kt">i32</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="kt">i32</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="kt">i32</span><span class="p">{</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">falcons</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span><span class="w">  </span><span class="c1">// 2
</span></span></span></code></pre></div><p><code>[2][3]i32</code> は「3 要素の配列を 2 つ持つ配列」を表します。</p>
<h3 id="スライス">スライス<a hidden class="anchor" aria-hidden="true" href="#スライス">#</a></h3>
<p>スライスは配列の一部を参照する動的なビューです。<code>[]T</code> の形で型を表します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">doves</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="kt">i32</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">dove_slice</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doves</span><span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">4</span><span class="p">];</span><span class="w">  </span><span class="c1">// [2, 3, 4]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// スライスの長さ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">slice_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dove_slice</span><span class="p">.</span><span class="n">len</span><span class="p">;</span><span class="w">  </span><span class="c1">// 3
</span></span></span></code></pre></div><p><code>[start..end]</code> で範囲を指定します（end は含まれません）。スライスは元の配列を参照するだけで、コピーは作りません。</p>
<h3 id="可変配列">可変配列<a hidden class="anchor" aria-hidden="true" href="#可変配列">#</a></h3>
<p><code>var</code> で宣言した配列は要素を変更できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">pigeons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="kt">i32</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">pigeons</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span><span class="w">  </span><span class="c1">// 要素を変更
</span></span></span><span class="line"><span class="cl"><span class="c1">// pigeons は [1, 2, 30, 4, 5]
</span></span></span></code></pre></div><p>配列自体のサイズは固定ですが、個々の要素は書き換え可能です。</p>
<h3 id="文字列u8-の配列">文字列（u8 の配列）<a hidden class="anchor" aria-hidden="true" href="#文字列u8-の配列">#</a></h3>
<p>Zig では文字列は <code>u8</code> の配列またはスライスとして扱われます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">canary</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Hello, Canary!&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">canary</span><span class="p">.</span><span class="n">len</span><span class="p">;</span><span class="w">  </span><span class="c1">// 14
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// センチネル終端文字列（null 終端）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">finch</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Finch&#34;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>文字列リテラルは UTF-8 でエンコードされた <code>u8</code> のスライスです。<code>[:0]</code> は null 終端（C 言語スタイル）の文字列を表します。</p>
<hr>
<h2 id="6-構造体">6. 構造体<a hidden class="anchor" aria-hidden="true" href="#6-構造体">#</a></h2>
<h3 id="基本的な構造体">基本的な構造体<a hidden class="anchor" aria-hidden="true" href="#基本的な構造体">#</a></h3>
<p>構造体は関連するデータをまとめるデータ構造です。<code>struct</code> キーワードで定義します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">Cheetah</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">speed</span><span class="o">:</span><span class="w"> </span><span class="kt">f32</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">age</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// メソッド
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">introduce</span><span class="p">(</span><span class="n">self</span><span class="o">:</span><span class="w"> </span><span class="n">Cheetah</span><span class="p">)</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;I&#39;m {s}, speed: {d:.1} km/h</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">speed</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 初期化関数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="n">speed</span><span class="o">:</span><span class="w"> </span><span class="kt">f32</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="n">Cheetah</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Cheetah</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">speed</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 使用例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">cheetah</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cheetah</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Lightning&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="n">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">120.0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">cheetah</span><span class="p">.</span><span class="nf">introduce</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// init 関数を使用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">cheetah2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cheetah</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="s">&#34;Thunder&#34;</span><span class="p">,</span><span class="w"> </span><span class="mf">115.0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>フィールドとメソッドを持てます。メソッドの第一引数に <code>self</code> を書くことで、インスタンスのデータにアクセスできます。</p>
<h3 id="デフォルト値を持つ構造体">デフォルト値を持つ構造体<a hidden class="anchor" aria-hidden="true" href="#デフォルト値を持つ構造体">#</a></h3>
<p>フィールドにデフォルト値を設定できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">Gazelle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">speed</span><span class="o">:</span><span class="w"> </span><span class="kt">f32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">80.0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">age</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">is_wild</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">gazelle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Gazelle</span><span class="p">{};</span><span class="w">  </span><span class="c1">// すべてデフォルト値
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">gazelle2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Gazelle</span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">90.0</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">// 一部を上書き
</span></span></span></code></pre></div><p>初期化時に値を省略すると、デフォルト値が使われます。一部だけ指定することもできます。</p>
<h3 id="ジェネリック構造体">ジェネリック構造体<a hidden class="anchor" aria-hidden="true" href="#ジェネリック構造体">#</a></h3>
<p>型をパラメータとして受け取る構造体です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">Herd</span><span class="p">(</span><span class="kr">comptime</span><span class="w"> </span><span class="n">T</span><span class="o">:</span><span class="w"> </span><span class="kt">type</span><span class="p">)</span><span class="w"> </span><span class="kt">type</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">animals</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="n">T</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">count</span><span class="o">:</span><span class="w"> </span><span class="kt">usize</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="n">animals</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="nb">@This</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">.{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="n">animals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">animals</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">animals</span><span class="p">.</span><span class="n">len</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 使用例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">speeds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="kt">f32</span><span class="p">{</span><span class="w"> </span><span class="mf">80.0</span><span class="p">,</span><span class="w"> </span><span class="mf">85.0</span><span class="p">,</span><span class="w"> </span><span class="mf">90.0</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">herd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Herd</span><span class="p">(</span><span class="kt">f32</span><span class="p">).</span><span class="nf">init</span><span class="p">(</span><span class="nb">@constCast</span><span class="p">(</span><span class="o">&amp;</span><span class="n">speeds</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></div><p>関数が型を返すことで、ジェネリックな構造体を作れます。<code>@This()</code> は現在の型を表します。</p>
<h3 id="ネストされた構造体">ネストされた構造体<a hidden class="anchor" aria-hidden="true" href="#ネストされた構造体">#</a></h3>
<p>構造体の中に構造体を含めることができます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">Enclosure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">capacity</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">animal_count</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">Zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">enclosure</span><span class="o">:</span><span class="w"> </span><span class="n">Enclosure</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Zoo</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Safari Zoo&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="n">enclosure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enclosure</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">animal_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></div><p>複雑なデータ構造を表現するときに便利です。</p>
<hr>
<h2 id="7-列挙型とユニオン">7. 列挙型とユニオン<a hidden class="anchor" aria-hidden="true" href="#7-列挙型とユニオン">#</a></h2>
<h3 id="列挙型enum">列挙型（enum）<a hidden class="anchor" aria-hidden="true" href="#列挙型enum">#</a></h3>
<p>列挙型は名前付きの定数の集合を定義します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">Habitat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">forest</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ocean</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">desert</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mountain</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// メソッド
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">describe</span><span class="p">(</span><span class="n">self</span><span class="o">:</span><span class="w"> </span><span class="n">Habitat</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">forest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;trees and vegetation&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">ocean</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;salt water&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">desert</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;sand and heat&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">mountain</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;high altitude&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 使用例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">habitat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Habitat</span><span class="p">.</span><span class="n">forest</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@tagName</span><span class="p">(</span><span class="n">habitat</span><span class="p">);</span><span class="w">  </span><span class="c1">// &#34;forest&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">desc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">habitat</span><span class="p">.</span><span class="nf">describe</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></div><p>列挙型もメソッドを持てます。<code>@tagName</code> で列挙値の名前を文字列として取得できます。</p>
<h3 id="整数値を持つ列挙型">整数値を持つ列挙型<a hidden class="anchor" aria-hidden="true" href="#整数値を持つ列挙型">#</a></h3>
<p>各列挙値に整数を割り当てることができます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">DangerLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">enum</span><span class="p">(</span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">safe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">caution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">danger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">extreme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DangerLevel</span><span class="p">.</span><span class="n">danger</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@intFromEnum</span><span class="p">(</span><span class="n">level</span><span class="p">);</span><span class="w">  </span><span class="c1">// 2
</span></span></span></code></pre></div><p><code>enum(u8)</code> で基底型を指定し、<code>@intFromEnum</code> で整数値を取得します。</p>
<h3 id="タグ付きユニオン">タグ付きユニオン<a hidden class="anchor" aria-hidden="true" href="#タグ付きユニオン">#</a></h3>
<p>ユニオンは複数の型のうち 1 つを保持できるデータ構造です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="k">enum</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">leopard</span><span class="o">:</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">spots</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">jaguar</span><span class="o">:</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">territory</span><span class="o">:</span><span class="w"> </span><span class="kt">f32</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">cougar</span><span class="o">:</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">age</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">print_info</span><span class="p">(</span><span class="n">self</span><span class="o">:</span><span class="w"> </span><span class="n">Animal</span><span class="p">)</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">leopard</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">l</span><span class="o">|</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Leopard with {} spots</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">l</span><span class="p">.</span><span class="n">spots</span><span class="p">}),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">jaguar</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">j</span><span class="o">|</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Jaguar with {d:.1} km² territory</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">j</span><span class="p">.</span><span class="n">territory</span><span class="p">}),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">cougar</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">c</span><span class="o">|</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Cougar aged {} years</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">c</span><span class="p">.</span><span class="n">age</span><span class="p">}),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 使用例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">animal1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Animal</span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">leopard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.{</span><span class="w"> </span><span class="p">.</span><span class="n">spots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">animal2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Animal</span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">jaguar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.{</span><span class="w"> </span><span class="p">.</span><span class="n">territory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">120.5</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">animal1</span><span class="p">.</span><span class="nf">print_info</span><span class="p">();</span><span class="w">  </span><span class="c1">// 出力: Leopard with 50 spots
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">animal2</span><span class="p">.</span><span class="nf">print_info</span><span class="p">();</span><span class="w">  </span><span class="c1">// 出力: Jaguar with 120.5 km² territory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// タグのチェック
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">animal1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="n">leopard</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;This is a leopard</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{}),</span><span class="w">  </span><span class="c1">// 出力: This is a leopard
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">.</span><span class="n">jaguar</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;This is a jaguar</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{}),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="n">cougar</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;This is a cougar</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{}),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>union(enum)</code> でタグ付きユニオンを作ります。<code>switch</code> で現在のタグをチェックし、対応する値を取り出せます。</p>
<hr>
<h2 id="8-ポインタ">8. ポインタ<a hidden class="anchor" aria-hidden="true" href="#8-ポインタ">#</a></h2>
<h3 id="基本的なポインタ">基本的なポインタ<a hidden class="anchor" aria-hidden="true" href="#基本的なポインタ">#</a></h3>
<p>ポインタはメモリ上のアドレスを保持します。<code>&amp;</code> でアドレスを取得し、<code>.*</code> で値にアクセスします。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">deer</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">deer_ptr</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">deer</span><span class="p">;</span><span class="w">  </span><span class="c1">// ポインタを取得
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ポインタ経由で値を読む
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deer_ptr</span><span class="p">.</span><span class="o">*</span><span class="p">;</span><span class="w">  </span><span class="c1">// 10
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ポインタ経由で値を変更
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">deer_ptr</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// deer は 20 になる
</span></span></span></code></pre></div><p><code>*i32</code> は「<code>i32</code> へのポインタ」を表します。ポインタを使うと、関数間でデータを共有したり変更したりできます。</p>
<h3 id="const-ポインタ">const ポインタ<a hidden class="anchor" aria-hidden="true" href="#const-ポインタ">#</a></h3>
<p>読み取り専用のポインタです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">moose</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">moose_ptr</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="kr">const</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">moose</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 読み取り専用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">moose_ptr</span><span class="p">.</span><span class="o">*</span><span class="p">;</span><span class="w">  </span><span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1">// moose_ptr.* = 200;  // エラー: 変更不可
</span></span></span></code></pre></div><p><code>*const i32</code> は「<code>i32</code> への読み取り専用ポインタ」を表します。</p>
<h3 id="関数にポインタを渡す">関数にポインタを渡す<a hidden class="anchor" aria-hidden="true" href="#関数にポインタを渡す">#</a></h3>
<p>関数の引数としてポインタを渡すと、呼び出し元の変数を変更できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">incrementFox</span><span class="p">(</span><span class="n">fox</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">fox</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">var</span><span class="w"> </span><span class="n">fox</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nf">incrementFox</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fox</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// fox は 6 になる
</span></span></span></code></pre></div><p>値渡しだとコピーが作られますが、ポインタ渡しだと元の変数を直接操作できます。</p>
<h3 id="配列へのポインタ">配列へのポインタ<a hidden class="anchor" aria-hidden="true" href="#配列へのポインタ">#</a></h3>
<p>配列全体へのポインタです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">rabbits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">i32</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">rabbits_ptr</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="kr">const</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rabbits</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ポインタ経由で配列要素にアクセス
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rabbits_ptr</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w">  </span><span class="c1">// 3
</span></span></span></code></pre></div><p>配列のサイズもポインタの型の一部になります。</p>
<h3 id="スライスポインタ">スライスポインタ<a hidden class="anchor" aria-hidden="true" href="#スライスポインタ">#</a></h3>
<p>配列のポインタはスライスに変換できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">squirrels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="kt">i32</span><span class="p">{</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">squirrel_slice</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">squirrels</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// スライスの一部を取得
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">sub_slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">squirrel_slice</span><span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">3</span><span class="p">];</span><span class="w">  </span><span class="c1">// [20, 30]
</span></span></span></code></pre></div><p>スライスはポインタと長さの情報を持つので、柔軟に配列を扱えます。</p>
<h3 id="マルチポインタ">マルチポインタ<a hidden class="anchor" aria-hidden="true" href="#マルチポインタ">#</a></h3>
<p>複数の要素を指すポインタです。長さの情報は持ちません。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">beavers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="kt">i32</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">beaver_multi_ptr</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">beavers</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beaver_multi_ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w">   </span><span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beaver_multi_ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w">  </span><span class="c1">// 2
</span></span></span></code></pre></div><p><code>[*]i32</code> は「複数の <code>i32</code> へのポインタ」を表します。C 言語との互換性のためによく使われます。</p>
<h3 id="nullable-ポインタ">nullable ポインタ<a hidden class="anchor" aria-hidden="true" href="#nullable-ポインタ">#</a></h3>
<p><code>?</code> を使って null になり得るポインタを表現します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">raccoon</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">var</span><span class="w"> </span><span class="n">raccoon_ptr</span><span class="o">:</span><span class="w"> </span><span class="o">?*</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">raccoon</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">raccoon_ptr</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">ptr</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;value: {}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">ptr</span><span class="p">.</span><span class="o">*</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">raccoon_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">  </span><span class="c1">// null に設定
</span></span></span></code></pre></div><p>ポインタが有効かどうかわからない場合に使います。</p>
<hr>
<h2 id="9-エラーハンドリング">9. エラーハンドリング<a hidden class="anchor" aria-hidden="true" href="#9-エラーハンドリング">#</a></h2>
<h3 id="defer">defer<a hidden class="anchor" aria-hidden="true" href="#defer">#</a></h3>
<p><code>defer</code> はスコープを抜けるときに式を実行します。リソースの解放などに便利です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">deferExample</span><span class="p">()</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Start</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;End (deferred)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Middle</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// スコープを抜けるときに defer が実行される
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">// 出力順: Start -&gt; Middle -&gt; End (deferred)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>defer</code> はスコープの終わりで必ず実行されます。関数から return しても、エラーが発生しても実行されます。</p>
<h3 id="複数の-defer">複数の defer<a hidden class="anchor" aria-hidden="true" href="#複数の-defer">#</a></h3>
<p>複数の <code>defer</code> は LIFO（後入れ先出し）の順で実行されます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">multipleDeferExample</span><span class="p">()</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;1st defer</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;2nd defer</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;3rd defer</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Function body</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 出力順: Function body -&gt; 3rd -&gt; 2nd -&gt; 1st
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>後に書かれた <code>defer</code> が先に実行されます。これはリソースの確保と解放の順序を逆にするのに便利です。</p>
<h3 id="defer-とエラーの組み合わせ">defer とエラーの組み合わせ<a hidden class="anchor" aria-hidden="true" href="#defer-とエラーの組み合わせ">#</a></h3>
<p><code>defer</code> はエラーが発生しても必ず実行されます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">deferWithError</span><span class="p">(</span><span class="n">should_fail</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="o">!</span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Cleanup always happens</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">should_fail</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">error</span><span class="p">.</span><span class="n">Failed</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Success</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>エラーの有無に関わらず、スコープを抜けるときに <code>defer</code> が実行されます。これにより、確実にリソースを解放できます。</p>
<h3 id="エラーセットの定義">エラーセットの定義<a hidden class="anchor" aria-hidden="true" href="#エラーセットの定義">#</a></h3>
<p>Zig では、エラーをエラーセットとして明示的に定義します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">AnimalError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">error</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">TooYoung</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">TooOld</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">NotFound</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">InvalidSize</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></div><p>エラーセットは、発生する可能性のあるエラーを列挙したものです。型安全なエラーハンドリングができます。</p>
<h3 id="エラーを返す関数-1">エラーを返す関数<a hidden class="anchor" aria-hidden="true" href="#エラーを返す関数-1">#</a></h3>
<p>関数がエラーを返す可能性がある場合、<code>!</code> を使います。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">checkHorseAge</span><span class="p">(</span><span class="n">age</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="n">AnimalError</span><span class="o">!</span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">age</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">error</span><span class="p">.</span><span class="n">TooYoung</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">error</span><span class="p">.</span><span class="n">TooOld</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 正常終了
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>AnimalError!void</code> は「AnimalError のエラーまたは void を返す」という意味です。</p>
<h3 id="エラーハンドリング-catch">エラーハンドリング: catch<a hidden class="anchor" aria-hidden="true" href="#エラーハンドリング-catch">#</a></h3>
<p><code>catch</code> でエラーを捕捉して処理します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="nf">checkHorseAge</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="o">|</span><span class="n">err</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Error: {}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">err</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></div><p>エラーが発生したら <code>catch</code> のブロックが実行されます。<code>|err|</code> でエラーの値を取得できます。</p>
<h3 id="エラーハンドリング-デフォルト値">エラーハンドリング: デフォルト値<a hidden class="anchor" aria-hidden="true" href="#エラーハンドリング-デフォルト値">#</a></h3>
<p>エラー時にデフォルト値を返すこともできます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">camel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">findCamelById</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// エラー時は 0
</span></span></span></code></pre></div><p>シンプルにエラーを処理したいときに便利です。</p>
<h3 id="エラーハンドリング-if">エラーハンドリング: if<a hidden class="anchor" aria-hidden="true" href="#エラーハンドリング-if">#</a></h3>
<p><code>if</code> でエラーか正常値かを判定できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">findCamelById</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="w"> </span><span class="o">|</span><span class="n">camel_id</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;found: {}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">camel_id</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">|</span><span class="n">err</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;error: {}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">err</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>正常値は <code>|camel_id|</code>、エラーは <code>else |err|</code> で取得します。</p>
<h3 id="エラーハンドリング-try">エラーハンドリング: try<a hidden class="anchor" aria-hidden="true" href="#エラーハンドリング-try">#</a></h3>
<p><code>try</code> はエラーを呼び出し元に伝播させます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">processGoat</span><span class="p">(</span><span class="n">age</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="o">!</span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">checkHorseAge</span><span class="p">(</span><span class="n">age</span><span class="p">);</span><span class="w">  </span><span class="c1">// エラーがあれば即座に return
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Age is valid</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">age</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>try</code> は以下のように展開されます：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// try checkHorseAge(age); は以下と同じ意味
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">checkHorseAge</span><span class="p">(</span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="o">|</span><span class="n">err</span><span class="o">|</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>つまり、<code>try</code> はエラーが発生したら自動的に <code>return</code> します。エラーハンドリングを簡潔に書けます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// 使用例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">processGoat</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w">   </span><span class="c1">// 成功: &#34;Age is valid&#34; と出力
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">processGoat</span><span class="p">(</span><span class="mi">35</span><span class="p">);</span><span class="w">   </span><span class="c1">// error.TooOld を返す（呼び出し元にエラーが伝播）
</span></span></span></code></pre></div><p><code>catch</code> でエラーを処理する場合との違い：</p>
<ul>
<li><code>try</code>: エラーを上に投げる（伝播）</li>
<li><code>catch</code>: エラーをその場で処理する</li>
</ul>
<h3 id="エラーハンドリング-errdefer">エラーハンドリング: errdefer<a hidden class="anchor" aria-hidden="true" href="#エラーハンドリング-errdefer">#</a></h3>
<p>エラー時のクリーンアップに使用します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">yak</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">blk</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">errdefer</span><span class="w"> </span><span class="n">yak</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// エラー発生時に実行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">findCamelById</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="o">:</span><span class="n">blk</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">yak</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>errdefer</code> はブロックがエラーで終了するときだけ実行されます。リソースの解放などに便利です。</p>
<h3 id="複数のエラーセット">複数のエラーセット<a hidden class="anchor" aria-hidden="true" href="#複数のエラーセット">#</a></h3>
<p><code>||</code> で複数のエラーセットを結合できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">FileError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">error</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FileNotFound</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">PermissionDenied</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span><span class="w"> </span><span class="nf">loadData</span><span class="p">(</span><span class="n">filename</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">AnimalError</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">FileError</span><span class="p">)</span><span class="o">!</span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">len</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">error</span><span class="p">.</span><span class="n">NotFound</span><span class="p">;</span><span class="w">  </span><span class="c1">// AnimalError のエラー
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#39;/&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">error</span><span class="p">.</span><span class="n">PermissionDenied</span><span class="p">;</span><span class="w">  </span><span class="c1">// FileError のエラー
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;data&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 使用例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">loadData</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="o">|</span><span class="n">err</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// err は AnimalError.NotFound
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Error: {}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">err</span><span class="p">});</span><span class="w">  </span><span class="c1">// 出力: Error: error.NotFound
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">data2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">loadData</span><span class="p">(</span><span class="s">&#34;/secret&#34;</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="o">|</span><span class="n">err</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// err は FileError.PermissionDenied
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Error: {}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">err</span><span class="p">});</span><span class="w">  </span><span class="c1">// 出力: Error: error.PermissionDenied
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">data3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">loadData</span><span class="p">(</span><span class="s">&#34;file.txt&#34;</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="s">&#34;default&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 成功: data3 = &#34;data&#34;
</span></span></span></code></pre></div><p>複数の種類のエラーを返す可能性がある関数で使います。<code>(AnimalError || FileError)</code> は両方のエラーセットのエラーを返せることを意味します。</p>
<h3 id="エラーの切り替え">エラーの切り替え<a hidden class="anchor" aria-hidden="true" href="#エラーの切り替え">#</a></h3>
<p><code>switch</code> でエラーの種類ごとに処理を分けられます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="nf">checkHorseAge</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="o">|</span><span class="n">err</span><span class="o">|</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">error</span><span class="p">.</span><span class="n">TooYoung</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Too young</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{}),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">error</span><span class="p">.</span><span class="n">TooOld</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Too old</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{}),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">error</span><span class="p">.</span><span class="n">NotFound</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Not found</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{}),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">error</span><span class="p">.</span><span class="n">InvalidSize</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Invalid size</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{}),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></div><p>エラーの種類に応じて異なる処理をしたいときに便利です。</p>
<hr>
<h2 id="10-オプショナル型">10. オプショナル型<a hidden class="anchor" aria-hidden="true" href="#10-オプショナル型">#</a></h2>
<h3 id="オプショナル型の宣言">オプショナル型の宣言<a hidden class="anchor" aria-hidden="true" href="#オプショナル型の宣言">#</a></h3>
<p><code>?</code> を使って null になり得る値を表現します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">seal</span><span class="o">:</span><span class="w"> </span><span class="o">?</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">empty_seal</span><span class="o">:</span><span class="w"> </span><span class="o">?</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p><code>?i32</code> は「null または <code>i32</code>」を表します。値が存在しないかもしれない状況を型で表現できます。</p>
<h3 id="オプショナル型のアンラップ-if">オプショナル型のアンラップ: if<a hidden class="anchor" aria-hidden="true" href="#オプショナル型のアンラップ-if">#</a></h3>
<p><code>if</code> で null かどうかをチェックして、値を取り出せます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">seal</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">value</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;has value: {}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">value</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;is null</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>値が存在すれば <code>|value|</code> で取り出し、null なら <code>else</code> ブロックが実行されます。</p>
<h3 id="オプショナル型のアンラップ-orelse">オプショナル型のアンラップ: orelse<a hidden class="anchor" aria-hidden="true" href="#オプショナル型のアンラップ-orelse">#</a></h3>
<p>null のときにデフォルト値を使えます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">whale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">empty_seal</span><span class="w"> </span><span class="k">orelse</span><span class="w"> </span><span class="mi">999</span><span class="p">;</span><span class="w">  </span><span class="c1">// null なら 999
</span></span></span></code></pre></div><h3 id="オプショナル型を返す関数-1">オプショナル型を返す関数<a hidden class="anchor" aria-hidden="true" href="#オプショナル型を返す関数-1">#</a></h3>
<p>値が見つからない可能性がある関数でよく使われます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">findPenguinById</span><span class="p">(</span><span class="n">id</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 使用例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">penguin1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">findPenguinById</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w">   </span><span class="c1">// ?i32 = 20
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">penguin2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">findPenguinById</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">);</span><span class="w">   </span><span class="c1">// ?i32 = null
</span></span></span></code></pre></div><p>エラーではないけど値がない状況を表すのに適しています。</p>
<h3 id="オプショナル型のポインタ">オプショナル型のポインタ<a hidden class="anchor" aria-hidden="true" href="#オプショナル型のポインタ">#</a></h3>
<p>ポインタも null になり得ます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">otter</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">var</span><span class="w"> </span><span class="n">otter_ptr</span><span class="o">:</span><span class="w"> </span><span class="o">?*</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">otter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">otter_ptr</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">ptr</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ptr</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span><span class="w">  </span><span class="c1">// 値を変更
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">otter_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">  </span><span class="c1">// null に設定
</span></span></span></code></pre></div><p>ポインタが有効かどうかをチェックできます。</p>
<h3 id="オプショナルと-while-ループ">オプショナルと while ループ<a hidden class="anchor" aria-hidden="true" href="#オプショナルと-while-ループ">#</a></h3>
<p>null になるまでループを続けることができます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">narwhal</span><span class="o">:</span><span class="w"> </span><span class="o">?</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">narwhal</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">value</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;{}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">value</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">narwhal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">narwhal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 出力: 5 4 3 2 1
</span></span></span></code></pre></div><p>条件を柔軟に書けて便利です。</p>
<h3 id="-operator強制アンラップ">.? operator（強制アンラップ）<a hidden class="anchor" aria-hidden="true" href="#-operator強制アンラップ">#</a></h3>
<p>null でないことが確実な場合に使用します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">certain_seal</span><span class="o">:</span><span class="w"> </span><span class="o">?</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">777</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">unwrapped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">certain_seal</span><span class="p">.</span><span class="o">?</span><span class="p">;</span><span class="w">  </span><span class="c1">// 777
</span></span></span><span class="line"><span class="cl"><span class="c1">// null の場合はパニックになる
</span></span></span></code></pre></div><p><code>.?</code> で強制的に値を取り出します。null だったらプログラムが停止するので、確実に値があるときだけ使いましょう。</p>
<hr>
<h2 id="11-コンパイル時計算">11. コンパイル時計算<a hidden class="anchor" aria-hidden="true" href="#11-コンパイル時計算">#</a></h2>
<p>Zig の強力な機能の 1 つは、コンパイル時に計算を実行できることです。実行時のコストをゼロにできます。</p>
<h3 id="コンパイル時定数">コンパイル時定数<a hidden class="anchor" aria-hidden="true" href="#コンパイル時定数">#</a></h3>
<p>コンパイル時に値が確定する定数です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">lynx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w">  </span><span class="c1">// コンパイル時に値が決定
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">bobcat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">comptime</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">  </span><span class="c1">// 明示的にコンパイル時定数
</span></span></span></code></pre></div><p><code>const</code> で宣言した値は基本的にコンパイル時定数ですが、<code>comptime</code> で明示的に指定することもできます。</p>
<h3 id="コンパイル時関数">コンパイル時関数<a hidden class="anchor" aria-hidden="true" href="#コンパイル時関数">#</a></h3>
<p>関数をコンパイル時に実行できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">factorialTiger</span><span class="p">(</span><span class="kr">comptime</span><span class="w"> </span><span class="n">n</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">factorialTiger</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">tiger_fact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">comptime</span><span class="w"> </span><span class="nf">factorialTiger</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w">  </span><span class="c1">// 120（コンパイル時に計算）
</span></span></span></code></pre></div><p><code>comptime</code> 引数を受け取る関数は、コンパイル時に評価されます。実行時のオーバーヘッドがありません。</p>
<h3 id="ジェネリック関数-1">ジェネリック関数<a hidden class="anchor" aria-hidden="true" href="#ジェネリック関数-1">#</a></h3>
<p>型をパラメータとして受け取る関数です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">maxLion</span><span class="p">(</span><span class="kr">comptime</span><span class="w"> </span><span class="n">T</span><span class="o">:</span><span class="w"> </span><span class="kt">type</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">:</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">:</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">max_int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">maxLion</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">max_float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">maxLion</span><span class="p">(</span><span class="kt">f32</span><span class="p">,</span><span class="w"> </span><span class="mf">3.14</span><span class="p">,</span><span class="w"> </span><span class="mf">2.71</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p><code>comptime T: type</code> で型をパラメータとして受け取ります。様々な型で動作する汎用的な関数を書けます。</p>
<h3 id="コンパイル時に配列を生成">コンパイル時に配列を生成<a hidden class="anchor" aria-hidden="true" href="#コンパイル時に配列を生成">#</a></h3>
<p>配列をコンパイル時に生成できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">createPandasArray</span><span class="p">(</span><span class="kr">comptime</span><span class="w"> </span><span class="n">size</span><span class="o">:</span><span class="w"> </span><span class="kt">usize</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="n">size</span><span class="p">]</span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">pandas</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">size</span><span class="p">]</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">pandas</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">..)</span><span class="w"> </span><span class="o">|*</span><span class="n">panda</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">panda</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@intCast</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pandas</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">pandas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">createPandasArray</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w">  </span><span class="c1">// [0, 10, 20, 30, 40]
</span></span></span></code></pre></div><p>配列のサイズもコンパイル時に決定されます。</p>
<h3 id="コンパイル時条件分岐">コンパイル時条件分岐<a hidden class="anchor" aria-hidden="true" href="#コンパイル時条件分岐">#</a></h3>
<p>条件によって異なるコードを生成できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">processJaguar</span><span class="p">(</span><span class="kr">comptime</span><span class="w"> </span><span class="n">is_large</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_large</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">jaguar1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">processJaguar</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">   </span><span class="c1">// 10
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">jaguar2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">processJaguar</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">  </span><span class="c1">// 15
</span></span></span></code></pre></div><p><code>comptime</code> の条件分岐は、コンパイル時に評価されて不要なコードは削除されます。</p>
<h3 id="型を返す関数">型を返す関数<a hidden class="anchor" aria-hidden="true" href="#型を返す関数">#</a></h3>
<p>関数が型を返すことができます。これでジェネリックな構造体を作れます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">fn</span><span class="w"> </span><span class="nf">PairOfAnimals</span><span class="p">(</span><span class="kr">comptime</span><span class="w"> </span><span class="n">T</span><span class="o">:</span><span class="w"> </span><span class="kt">type</span><span class="p">)</span><span class="w"> </span><span class="kt">type</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">first</span><span class="o">:</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">second</span><span class="o">:</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">swap</span><span class="p">(</span><span class="n">self</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="nb">@This</span><span class="p">())</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kr">const</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">first</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">second</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 使用例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">var</span><span class="w"> </span><span class="n">bear_pair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">PairOfAnimals</span><span class="p">(</span><span class="kt">i32</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">bear_pair</span><span class="p">.</span><span class="nf">swap</span><span class="p">();</span><span class="w">  </span><span class="c1">// first=20, second=10
</span></span></span></code></pre></div><p><code>@This()</code> は現在の型を返します。型を動的に生成できるのが Zig の特徴です。</p>
<h3 id="ビルトイン型情報">ビルトイン型情報<a hidden class="anchor" aria-hidden="true" href="#ビルトイン型情報">#</a></h3>
<p>型に関する情報をコンパイル時に取得できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// 型のサイズ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">size_i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@sizeOf</span><span class="p">(</span><span class="kt">i32</span><span class="p">);</span><span class="w">  </span><span class="c1">// 4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 型の名前
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@typeName</span><span class="p">(</span><span class="kt">i32</span><span class="p">);</span><span class="w">  </span><span class="c1">// &#34;i32&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 型情報
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@typeInfo</span><span class="p">(</span><span class="kt">i32</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="n">int</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">int_info</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// int_info.signedness, int_info.bits
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>リフレクションのような機能をコンパイル時に使えます。</p>
<h3 id="inline-for">inline for<a hidden class="anchor" aria-hidden="true" href="#inline-for">#</a></h3>
<p>コンパイル時にループを展開します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="kt">i32</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">var</span><span class="w"> </span><span class="n">sum</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">inline</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">num</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">num</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ループが展開されて、実行時にはループのオーバーヘッドがなくなります。</p>
<hr>
<h2 id="12-メモリアロケータ">12. メモリアロケータ<a hidden class="anchor" aria-hidden="true" href="#12-メモリアロケータ">#</a></h2>
<p>Zig では明示的にメモリアロケータを管理します。メモリの確保と解放を意識的に行います。</p>
<h3 id="generalpurposeallocator">GeneralPurposeAllocator<a hidden class="anchor" aria-hidden="true" href="#generalpurposeallocator">#</a></h3>
<p>推奨される汎用アロケータです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">gpa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">heap</span><span class="p">.</span><span class="nf">GeneralPurposeAllocator</span><span class="p">(.{}){};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">defer</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpa</span><span class="p">.</span><span class="nf">deinit</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpa</span><span class="p">.</span><span class="nf">allocator</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></div><p><code>defer</code> でスコープを抜けるときに自動的にメモリを解放します。メモリリークを防げます。</p>
<h3 id="単一の値をアロケート">単一の値をアロケート<a hidden class="anchor" aria-hidden="true" href="#単一の値をアロケート">#</a></h3>
<p>単一の値をヒープに確保します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">elephant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">allocator</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="kt">i32</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">defer</span><span class="w"> </span><span class="n">allocator</span><span class="p">.</span><span class="nf">destroy</span><span class="p">(</span><span class="n">elephant</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">elephant</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p><code>create</code> で確保、<code>destroy</code> で解放します。</p>
<h3 id="配列をアロケート">配列をアロケート<a hidden class="anchor" aria-hidden="true" href="#配列をアロケート">#</a></h3>
<p>動的サイズの配列を確保します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">tigers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">allocator</span><span class="p">.</span><span class="nf">alloc</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">defer</span><span class="w"> </span><span class="n">allocator</span><span class="p">.</span><span class="nf">free</span><span class="p">(</span><span class="n">tigers</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">tigers</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">..)</span><span class="w"> </span><span class="o">|*</span><span class="n">tiger</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">tiger</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@intCast</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>alloc</code> で配列を確保、<code>free</code> で解放します。実行時にサイズが決まる配列に便利です。</p>
<h3 id="arraylist">ArrayList<a hidden class="anchor" aria-hidden="true" href="#arraylist">#</a></h3>
<p>動的配列を使用します。要素数が増えたり減ったりする配列です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">leopards</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="nf">ArrayList</span><span class="p">(</span><span class="kt">i32</span><span class="p">).</span><span class="nf">initCapacity</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">defer</span><span class="w"> </span><span class="n">leopards</span><span class="p">.</span><span class="nf">deinit</span><span class="p">(</span><span class="n">allocator</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">try</span><span class="w"> </span><span class="n">leopards</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">try</span><span class="w"> </span><span class="n">leopards</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">try</span><span class="w"> </span><span class="n">leopards</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// アクセス
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">leopards</span><span class="p">.</span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">leopard</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;{} &#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">leopard</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>append</code> で要素を追加できます。自動的にサイズが拡張されます。</p>
<h3 id="arenaallocator">ArenaAllocator<a hidden class="anchor" aria-hidden="true" href="#arenaallocator">#</a></h3>
<p>まとめて解放するアロケータです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">arena</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">heap</span><span class="p">.</span><span class="n">ArenaAllocator</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">allocator</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">defer</span><span class="w"> </span><span class="n">arena</span><span class="p">.</span><span class="nf">deinit</span><span class="p">();</span><span class="w">  </span><span class="c1">// すべてのメモリを一度に解放
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">arena_allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arena</span><span class="p">.</span><span class="nf">allocator</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">bears</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">arena_allocator</span><span class="p">.</span><span class="nf">alloc</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">wolves</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">arena_allocator</span><span class="p">.</span><span class="nf">alloc</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 個別の free は不要
</span></span></span></code></pre></div><p><code>arena.deinit()</code> で一括解放できます。個別に <code>free</code> しなくていいので楽ちんです。</p>
<h3 id="fixedbufferallocator">FixedBufferAllocator<a hidden class="anchor" aria-hidden="true" href="#fixedbufferallocator">#</a></h3>
<p>固定サイズバッファを使用するアロケータです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">buffer</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">var</span><span class="w"> </span><span class="n">fba</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">heap</span><span class="p">.</span><span class="n">FixedBufferAllocator</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">fba_allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fba</span><span class="p">.</span><span class="nf">allocator</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">rabbits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">fba_allocator</span><span class="p">.</span><span class="nf">alloc</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>スタックに確保したバッファを使います。ヒープ確保が不要な場合に便利です。</p>
<h3 id="hashmap">HashMap<a hidden class="anchor" aria-hidden="true" href="#hashmap">#</a></h3>
<p>ハッシュマップの使用例です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">var</span><span class="w"> </span><span class="n">deer_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="nf">StringHashMap</span><span class="p">(</span><span class="kt">i32</span><span class="p">).</span><span class="nf">init</span><span class="p">(</span><span class="n">allocator</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">defer</span><span class="w"> </span><span class="n">deer_map</span><span class="p">.</span><span class="nf">deinit</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">try</span><span class="w"> </span><span class="n">deer_map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">&#34;red_deer&#34;</span><span class="p">,</span><span class="w"> </span><span class="mi">150</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">try</span><span class="w"> </span><span class="n">deer_map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">&#34;roe_deer&#34;</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 値の取得
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">deer_map</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s">&#34;red_deer&#34;</span><span class="p">))</span><span class="w"> </span><span class="o">|</span><span class="n">weight</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;weight: {}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">weight</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// イテレーション
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">var</span><span class="w"> </span><span class="n">iterator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deer_map</span><span class="p">.</span><span class="nf">iterator</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">())</span><span class="w"> </span><span class="o">|</span><span class="n">entry</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;{s}={}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">entry</span><span class="p">.</span><span class="n">key_ptr</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="n">value_ptr</span><span class="p">.</span><span class="o">*</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>キーと値のペアを管理します。<code>put</code> で追加、<code>get</code> で取得、<code>iterator</code> で全要素を走査できます。</p>
<h3 id="文字列の複製">文字列の複製<a hidden class="anchor" aria-hidden="true" href="#文字列の複製">#</a></h3>
<p>文字列をコピーします。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">original_seal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Seal&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">copied_seal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">allocator</span><span class="p">.</span><span class="nf">dupe</span><span class="p">(</span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="n">original_seal</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">defer</span><span class="w"> </span><span class="n">allocator</span><span class="p">.</span><span class="nf">free</span><span class="p">(</span><span class="n">copied_seal</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p><code>dupe</code> で複製を作ります。元の文字列とは別のメモリ領域に確保されます。</p>
<hr>
<h2 id="13-テスト">13. テスト<a hidden class="anchor" aria-hidden="true" href="#13-テスト">#</a></h2>
<p>Zig には組み込みのテストフレームワークがあります。<code>test</code> キーワードでテストを書けます。</p>
<h3 id="基本的なテスト">基本的なテスト<a hidden class="anchor" aria-hidden="true" href="#基本的なテスト">#</a></h3>
<p><code>test</code> ブロックでテストを定義します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">std</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@import</span><span class="p">(</span><span class="s">&#34;std&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">test</span><span class="w"> </span><span class="s">&#34;basic addition&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">testing</span><span class="p">.</span><span class="nf">expectEqual</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>zig test filename.zig</code> でテストを実行できます。<code>std.testing.expectEqual</code> で値が等しいかをチェックします。</p>
<h3 id="テストアサーション">テストアサーション<a hidden class="anchor" aria-hidden="true" href="#テストアサーション">#</a></h3>
<p>様々なアサーション関数が用意されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">test</span><span class="w"> </span><span class="s">&#34;various assertions&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 等価性チェック
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">testing</span><span class="p">.</span><span class="nf">expectEqual</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 真偽値チェック
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">testing</span><span class="p">.</span><span class="nf">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">testing</span><span class="p">.</span><span class="nf">expect</span><span class="p">(</span><span class="o">!</span><span class="kc">false</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 文字列の等価性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">testing</span><span class="p">.</span><span class="nf">expectEqualStrings</span><span class="p">(</span><span class="s">&#34;hello&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;hello&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>expect</code> は真偽値を、<code>expectEqual</code> は値の等価性を、<code>expectEqualStrings</code> は文字列の等価性をチェックします。</p>
<h3 id="エラーのテスト">エラーのテスト<a hidden class="anchor" aria-hidden="true" href="#エラーのテスト">#</a></h3>
<p>エラーが正しく返されるかをテストできます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">divide</span><span class="p">(</span><span class="n">a</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="o">!</span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">error</span><span class="p">.</span><span class="n">DivisionByZero</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">@divTrunc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">test</span><span class="w"> </span><span class="s">&#34;divide success&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="nf">divide</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">testing</span><span class="p">.</span><span class="nf">expectEqual</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">test</span><span class="w"> </span><span class="s">&#34;divide by zero error&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">divide</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">testing</span><span class="p">.</span><span class="nf">expectError</span><span class="p">(</span><span class="k">error</span><span class="p">.</span><span class="n">DivisionByZero</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>expectError</code> で特定のエラーが返されることを確認できます。</p>
<h3 id="構造体のテスト">構造体のテスト<a hidden class="anchor" aria-hidden="true" href="#構造体のテスト">#</a></h3>
<p>構造体のメソッドもテストできます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">pub</span><span class="w"> </span><span class="kr">const</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">age</span><span class="o">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">isAdult</span><span class="p">(</span><span class="n">self</span><span class="o">:</span><span class="w"> </span><span class="n">Animal</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">test</span><span class="w"> </span><span class="s">&#34;Animal struct&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Animal</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Whiskers&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">testing</span><span class="p">.</span><span class="nf">expectEqualStrings</span><span class="p">(</span><span class="s">&#34;Whiskers&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">cat</span><span class="p">.</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">testing</span><span class="p">.</span><span class="nf">expectEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">cat</span><span class="p">.</span><span class="n">age</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">testing</span><span class="p">.</span><span class="nf">expect</span><span class="p">(</span><span class="o">!</span><span class="n">cat</span><span class="p">.</span><span class="nf">isAdult</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>構造体のフィールドやメソッドを個別にテストできます。</p>
<h3 id="メモリアロケーションのテスト">メモリアロケーションのテスト<a hidden class="anchor" aria-hidden="true" href="#メモリアロケーションのテスト">#</a></h3>
<p><code>std.testing.allocator</code> を使ってメモリアロケーションをテストできます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">test</span><span class="w"> </span><span class="s">&#34;allocator test&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">testing</span><span class="p">.</span><span class="n">allocator</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">allocator</span><span class="p">.</span><span class="nf">alloc</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">allocator</span><span class="p">.</span><span class="nf">free</span><span class="p">(</span><span class="n">numbers</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">..)</span><span class="w"> </span><span class="o">|*</span><span class="n">num</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">num</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@intCast</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">testing</span><span class="p">.</span><span class="nf">expectEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">testing</span><span class="p">.</span><span class="nf">expectEqual</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">numbers</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>std.testing.allocator</code> はメモリリークを検出してくれます。<code>defer</code> で確実に解放することが重要です。</p>
<h2 id="14-モジュール">14. モジュール<a hidden class="anchor" aria-hidden="true" href="#14-モジュール">#</a></h2>
<p>モジュールを呼び出すコードです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// lib.zig
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">greet</span><span class="p">()</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">stg</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&#34;Hello</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// main.zig
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="w"> </span><span class="n">lib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@import</span><span class="p">(</span><span class="s">&#34;lib.zig&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">lib</span><span class="p">.</span><span class="nf">greet</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></div><h2 id="備考">備考<a hidden class="anchor" aria-hidden="true" href="#備考">#</a></h2>
<p>zig にはその他 C 言語連携、アセンブリ埋め込み、非同期処理、クロスコンパイル等の機能を持っているそうです。</p>
<h2 id="さらに学ぶために">さらに学ぶために<a hidden class="anchor" aria-hidden="true" href="#さらに学ぶために">#</a></h2>
<ul>
<li><a href="https://ziglang.org/documentation/master/#Zig-Language-Reference">Zig 言語リファレンス</a></li>
<li><a href="https://ziglang.org/documentation/master/std/">Zig 標準ライブラリ</a></li>
</ul>
<p>公式ドキュメントには詳しい情報が載っています。標準ライブラリのドキュメントも充実しているので、ぜひチェックしてみてください。</p>


  </div>

  <footer class="post-footer">
<nav class="paginav">
  <a class="next" href="https://jedipunkz.github.io/post/typescript-learning/">
    <span class="title">Next »</span>
    <br>
    <span>TypeScript 入門: 構文集</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Zig 入門: 構文集 on x"
            href="https://x.com/intent/tweet/?text=Zig%20%e5%85%a5%e9%96%80%3a%20%e6%a7%8b%e6%96%87%e9%9b%86&amp;url=https%3a%2f%2fjedipunkz.github.io%2fpost%2fzig-tutorial%2f&amp;hashtags=">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Zig 入門: 構文集 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fjedipunkz.github.io%2fpost%2fzig-tutorial%2f&amp;title=Zig%20%e5%85%a5%e9%96%80%3a%20%e6%a7%8b%e6%96%87%e9%9b%86&amp;summary=Zig%20%e5%85%a5%e9%96%80%3a%20%e6%a7%8b%e6%96%87%e9%9b%86&amp;source=https%3a%2f%2fjedipunkz.github.io%2fpost%2fzig-tutorial%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Zig 入門: 構文集 on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fjedipunkz.github.io%2fpost%2fzig-tutorial%2f&title=Zig%20%e5%85%a5%e9%96%80%3a%20%e6%a7%8b%e6%96%87%e9%9b%86">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Zig 入門: 構文集 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fjedipunkz.github.io%2fpost%2fzig-tutorial%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Zig 入門: 構文集 on whatsapp"
            href="https://api.whatsapp.com/send?text=Zig%20%e5%85%a5%e9%96%80%3a%20%e6%a7%8b%e6%96%87%e9%9b%86%20-%20https%3a%2f%2fjedipunkz.github.io%2fpost%2fzig-tutorial%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Zig 入門: 構文集 on telegram"
            href="https://telegram.me/share/url?text=Zig%20%e5%85%a5%e9%96%80%3a%20%e6%a7%8b%e6%96%87%e9%9b%86&amp;url=https%3a%2f%2fjedipunkz.github.io%2fpost%2fzig-tutorial%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Zig 入門: 構文集 on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Zig%20%e5%85%a5%e9%96%80%3a%20%e6%a7%8b%e6%96%87%e9%9b%86&u=https%3a%2f%2fjedipunkz.github.io%2fpost%2fzig-tutorial%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://jedipunkz.github.io/">jedipunkz 🚀 のブログ</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

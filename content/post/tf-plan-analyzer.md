---
title: "Terraform Plan Â∑ÆÂàÜ„Çí„Éë„Éº„Çπ„Åô„Çã GitHub Actions „Çí‰Ωú„Å£„Åü"
date: 2025-09-15T10:00:00+09:00
Categories: ["infrastructure", "terraform", "github-actions"]
draft: false
---
„Åì„Çì„Å´„Å°„ÅØ„ÄÇ[jedipunkzüöÄ](https://x.com/jedipunkz) „Åß„Åô„ÄÇ

Terraform „ÇíÈÅãÁî®„Åó„Å¶„ÅÑ„Çã„Å®„Åü„Åæ„Å´ Plan ÁµêÊûú„Åå„Å©„ÅÜ„Åó„Å¶„ÇÇÂá∫„Å¶„Åó„Åæ„ÅÜ‰∫ã„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åæ„Åü Terraform „Çí GitHub „ÅßÂÆüË°å„Åô„ÇãÁí∞Â¢É„ÇíÈÅãÁî®„Åó„Å¶„ÅÑ„Çã„Å® Plan ÁµêÊûú„Çí„ÅÜ„Åæ„ÅèÊâ±„Å£„Å¶Ëá™ÂãïÂåñ„Åó„Åü„ÅÑ„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„ÇÇÊπß„ÅÑ„Å¶„Åç„Åæ„Åô„ÄÇ„Åì„ÅÆÂ†¥Âêà„Å´ Plan „ÅÆÂ∑ÆÂàÜ„Çí„ÅÜ„Åæ„ÅèÂá¶ÁêÜ„Åó„Å¶„Åè„Çå„Çã GitHub Action „Åå„ÅÇ„Çå„Å∞„Å™„Å®ÊÄù„Å£„Å¶‰Ωú„Å£„Å¶„Åø„Åæ„Åó„Åü„ÄÇ

## GitHub Actions

‰ΩúÊàê„Åó„Åü GitHub Action „ÅØ‰∏ãË®ò„ÅÆ„É¨„Éù„Ç∏„Éà„É™„ÅßÂÖ¨Èñã„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

https://github.com/jedipunkz/tf-plan-parser


## ÂÖ•Âäõ„Éª„Ç™„Éó„Ç∑„Éß„É≥Ë®≠ÂÆö

„Åì„ÅÆ GitHub Action „Åß„ÅØ2„Å§„ÅÆÂÖ•Âäõ„Ç™„Éó„Ç∑„Éß„É≥„ÅåÂà©Áî®ÂèØËÉΩ„Åß„ÅôÔºö

### terraform-plan (ÂøÖÈ†à)
„Éë„Éº„ÇπÂØæË±°„Å®„Å™„Çã Terraform Plan „ÅÆÂá∫ÂäõÁµêÊûú„ÇíÊåáÂÆö„Åó„Åæ„Åô„ÄÇÈÄöÂ∏∏„ÅØÂâç„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅßÂÆüË°å„Åó„Åü `terraform plan` „Ç≥„Éû„É≥„Éâ„ÅÆÊ®ôÊ∫ñÂá∫Âäõ„ÇíÊ∏°„Åó„Åæ„Åô„ÄÇ

### ignore-resources („Ç™„Éó„Ç∑„Éß„É≥)
ÁÑ°Ë¶ñ„Åó„Åü„ÅÑ„É™„ÇΩ„Éº„Çπ„Çø„Ç§„Éó„ÇÑÁâπÂÆö„ÅÆ„É™„ÇΩ„Éº„Çπ„ÇíÈÖçÂàóÂΩ¢Âºè„ÅßÊåáÂÆö„Åó„Åæ„Åô„ÄÇ„Éá„Éï„Ç©„É´„Éà„ÅØÁ©∫„ÅÆÈÖçÂàó `[]` „Åß„Åô„ÄÇ

ÊåáÂÆöÊñπÊ≥ï„ÅÆ‰æãÔºö

**„É™„ÇΩ„Éº„Çπ„Çø„Ç§„ÉóÂÖ®‰Ωì„ÇíÁÑ°Ë¶ñ:**
```yaml
ignore-resources: '["null_resource", "local_file"]'
```

**ÁâπÂÆö„ÅÆ„É™„ÇΩ„Éº„Çπ„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÇíÁÑ°Ë¶ñ:**
```yaml
ignore-resources: '["null_resource.temporary", "local_file.cache"]'
```

**„É™„ÇΩ„Éº„Çπ„Çø„Ç§„Éó„Å®„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÅÆÊ∑∑Âú®:**
```yaml
ignore-resources: '["null_resource", "aws_s3_bucket.temp", "local_file"]'
```

## Âá∫Âäõ„Åï„Çå„ÇãÊÉÖÂ†±

„Åì„ÅÆ Action „ÅØ‰ª•‰∏ã„ÅÆÂá∫Âäõ„ÇíÊèê‰æõ„Åó„Åæ„Åô„ÄÇ„Åæ„Åü‰∏ãË®ò„ÅØ ignore-resources „Ç™„Éó„Ç∑„Éß„É≥„ÅÆÊåáÂÆö„Å´Ê≤ø„Å£„Å¶ÁµêÊûú„ÇíÂá∫Âäõ„Åó„Å¶„Åè„Çå„Åæ„Åô„ÄÇ

- diff-bool: Â§âÊõ¥„Åå„ÅÇ„Çã„Åã„Å©„ÅÜ„Åã„ÅÆÁúüÂÅΩÂÄ§Ôºà`true` „Åæ„Åü„ÅØ `false`Ôºâ
- diff-count: Â§âÊõ¥„Åï„Çå„Çã„É™„ÇΩ„Éº„Çπ„ÅÆÊï∞
- diff-resources: Â§âÊõ¥„Åï„Çå„Çã„É™„ÇΩ„Éº„Çπ„ÅÆ„Ç¢„Éâ„É¨„Çπ‰∏ÄË¶ßÔºà„Ç´„É≥„ÉûÂå∫Âàá„ÇäÔºâ
- diff-raw: Áîü„ÅÆÂ∑ÆÂàÜ„Éá„Éº„Çø
- diff-json: sÂàÜ„Éá„Éº„Çø„ÅÆ JSON ÂΩ¢Âºè

„Åì„Çå„Çâ„ÅÆÂá∫Âäõ„Çí‰Ωø„Å£„Å¶„ÄÅÂæåÁ∂ö„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅßÊù°‰ª∂ÂàÜÂ≤ê„ÇÑÈÄöÁü•„ÅÆÂà∂Âæ°„ÅåÂèØËÉΩ„Åß„Åô„ÄÇ

### diff-json „ÅÆÊßãÈÄ†

diff-json „ÅØ‰∏ãË®ò„ÅÆ JSON ÊßãÈÄ†„ÇíÊåÅ„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ

```json
{
  "hasDiffs": true,
  "summary": {
    "totalChanges": 3,
    "toAdd": 3,
    "toChange": 1,
    "toDestroy": 0
  },
  "resources": [
    {
      "address": "aws_instance.web",
      "resourceType": "aws_instance",
      "action": "create",
      "changes": {
        "before": null,
        "after": "Value will be known after apply",
        "description": "Resource will be created"
      }
    },
    {
      "address": "aws_s3_bucket.assets",
      "resourceType": "aws_s3_bucket",
      "action": "update",
      "changes": {
        "before": "Value will be known after apply",
        "after": "Value will be known after apply",
        "description": "Resource will be updated in-place"
      }
    }
  ],
  "resourceCount": 2,
  "timestamp": "2025-09-15T07:48:22.123Z"
}
```

## Ë≥áÊñô‰æã„ÅÆÁ¥π‰ªã

„Åì„Åì„Åã„Çâ„ÅØ‰ΩøÁî®‰æã„ÇíÂπæ„Å§„ÅãÁ¥π‰ªã„Åó„Åæ„Åô„ÄÇ

### Âü∫Êú¨ÁöÑ„Å™‰Ωø„ÅÑÊñπ

```yaml
- name: Terraform Plan
  id: plan
  run: terraform plan -no-color

- name: Parse Plan
  id: parse
  uses: jedipunkz/tf-plan-parser@v1
  with:
    terraform-plan: ${{ steps.plan.outputs.stdout }}
    ignore-resources: '["null_resource", "random_id"]'

- name: Check results
  run: |
    echo "Changes detected: ${{ steps.parse.outputs.diff-bool }}"
    echo "Resource count: ${{ steps.parse.outputs.diff-count }}"
```

### jq „Çí‰Ωø„Å£„Åü diff-json „ÅÆÊ¥ªÁî®‰æã

```yaml
    - name: Extract total changes
      run: |
        DIFF_JSON='${{ steps.parse.outputs.diff-json }}'
        if [ -n "$DIFF_JSON" ] && [ "$DIFF_JSON" != "null" ]; then
          TOTAL_CHANGES=$(echo "$DIFF_JSON" | jq -r '.summary.totalChanges // 0')
        else
          TOTAL_CHANGES=0
        fi
        echo "Total changes: $TOTAL_CHANGES"
```

### Pull Request „Å∏„ÅÆËá™Âãï„Ç≥„É°„É≥„Éà

```yaml
- name: Terraform Plan
  id: plan
  run: terraform plan -out=tfplan -no-color

- name: Parse Plan
  id: parse
  uses: jedipunkz/tf-plan-parser@v1
  with:
    terraform-plan: ${{ steps.plan.outputs.stdout }}
    ignore-resources: '["null_resource", "local_file"]'

- name: Comment on PR
  uses: actions/github-script@v7
  with:
    script: |
      const diffBool = '${{ steps.parse.outputs.diff-bool }}';
      const diffCount = '${{ steps.parse.outputs.diff-count }}';
      const resources = JSON.parse('${{ steps.parse.outputs.diff-resources }}');
      const diffRaw = `${{ steps.parse.outputs.diff-raw }}`;

      let body = '## Terraform Plan Parser\n\n';

      // Summary
      if (diffBool === 'true') {
        body += `‚úÖ **Changes detected** affecting ${diffCount} resources:\n\n`;
        body += '### Changed Resources\n```\n';
        for (const resource of resources) {
          body += `${resource}\n`;
        }
        body += '```\n\n';
      } else {
        body += '‚úÖ **No changes detected**\n\n';
      }

      // All outputs
      body += '### Outputs\n';
      body += `- **diff-bool**: \`${diffBool}\`\n`;
      body += `- **diff-count**: \`${diffCount}\`\n`;
      body += `- **diff-resources**: \`${JSON.stringify(resources)}\`\n\n`;

      // Raw plan
      if (diffRaw && diffRaw.trim()) {
        body += '### Raw Terraform Plan Output\n';
        body += '```\n' + diffRaw + '\n```\n\n';
      }

      body += '---\n*Generated by Terraform Plan Parser*';

      github.rest.issues.createComment({
        issue_number: context.issue.number,
        owner: context.repo.owner,
        repo: context.repo.repo,
        body: body
      })
```

### Êù°‰ª∂ÂàÜÂ≤ê„Åß„ÅÆ„Éá„Éó„É≠„Ç§Âà∂Âæ°

```yaml
- name: Terraform Plan
  id: plan
  run: terraform plan -out=tfplan -no-color

- name: Parse Plan
  id: parse
  uses: jedipunkz/tf-plan-parser@v1
  with:
    terraform-plan: ${{ steps.plan.outputs.stdout }}
    ignore-resources: '["null_resource", "random_id", "local_file"]'

- name: Skip deployment if no changes
  if: steps.parseoutputs.diff-bool == 'false'
  run: echo "No infrastructure changes detected. Skipping deployment."

- name: Proceed with deployment
  if: steps.parseoutputs.diff-bool == 'true'
  run: |
    echo "Infrastructure changes detected: ${{ steps.parseoutputs.diff-count }} resources"
    terraform apply -auto-approve tfplan

- name: Notify on major changes
  if: steps.parseoutputs.diff-count > 10
  run: |
    echo "‚ö†Ô∏è Large number of changes detected (${{ steps.parseoutputs.diff-count }} resources)"
    echo "Manual review recommended"
```

### diff-json „Çí‰Ωø„Å£„ÅüÈ´òÂ∫¶„Å™Âà©Áî®‰æã

```yaml
- name: Terraform Plan
  id: plan
  run: terraform plan -out=tfplan -no-color

- name: Parse Plan
  id: parse
  uses: jedipunkz/tf-plan-parser@v1
  with:
    terraform-plan: ${{ steps.plan.outputs.stdout }}
    ignore-resources: '["null_resource", "local_file"]'

    - name: Extract values with jq
      id: extract-jq
      run: |
        DIFF_JSON='${{ steps.parse.outputs.diff-json }}'
        TOTAL_CHANGES=$(echo "$DIFF_JSON" | jq -r '.summary.totalChanges')
        TO_ADD=$(echo "$DIFF_JSON" | jq -r '.summary.toAdd')
        TO_CHANGE=$(echo "$DIFF_JSON" | jq -r '.summary.toChange')
        TO_DESTROY=$(echo "$DIFF_JSON" | jq -r '.summary.toDestroy')
        RESOURCE_COUNT=$(echo "$DIFF_JSON" | jq -r '.resourceCount')

        echo "total-changes=$TOTAL_CHANGES" >> $GITHUB_OUTPUT
        echo "to-add=$TO_ADD" >> $GITHUB_OUTPUT
        echo "to-change=$TO_CHANGE" >> $GITHUB_OUTPUT
        echo "to-destroy=$TO_DESTROY" >> $GITHUB_OUTPUT
        echo "resource-count=$RESOURCE_COUNT" >> $GITHUB_OUTPUT

    - name: Comment on PR
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v7
      env:
        DIFF_JSON: ${{ steps.parse.outputs.diff-json }}
      with:
        script: |
          const diffBool = '${{ steps.parse.outputs.diff-bool }}';
          const diffCount = '${{ steps.parse.outputs.diff-count }}';
          const resources = JSON.parse('${{ steps.parse.outputs.diff-resources }}');
          const totalChanges = '${{ steps.extract-jq.outputs.total-changes }}';
          const toAdd = '${{ steps.extract-jq.outputs.to-add }}';
          const toChange = '${{ steps.extract-jq.outputs.to-change }}';
          const toDestroy = '${{ steps.extract-jq.outputs.to-destroy }}';

          let diffJson;
          try {
            diffJson = JSON.parse(process.env.DIFF_JSON);
          } catch (e) {
            console.log('Failed to parse diff-json:', e);
            diffJson = { resources: [] };
          }

          let body = `## Terraform Plan Analysis (${totalChanges} total changes via jq)\n\n`;

          if (diffBool === 'true') {
            body += `‚úÖ **Changes detected** affecting ${diffCount} resources:\n\n`;

            // Original Changed Resources section
            body += '### Changed Resources\n```\n';
            for (const resource of resources) {
              body += `${resource}\n`;
            }
            body += '```\n\n';

            // Plan Summary
            body += `**Plan Summary**: ${toAdd} to add, ${toChange} to change, ${toDestroy} to destroy\n\n`;

            // Detailed resource changes from diff-json
            body += '### Detailed Resource Changes\n';
            for (const resource of diffJson.resources) {
              const actionEmoji = {
                'create': '‚ûï',
                'update': 'üîÑ',
                'delete': '‚ùå',
                'replace': 'üîÑ'
              }[resource.action] || 'üîÑ';

              body += `${actionEmoji} **${resource.action.toUpperCase()}**: \`${resource.address}\` (${resource.resourceType})\n`;
              body += `   - ${resource.changes.description}\n\n`;
            }
          } else {
            body += '‚úÖ **No changes detected**\n\n';
          }

          body += '---\n*Generated by Terraform Plan Parser*';

          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: body
          });
```

## „Åæ„Å®„ÇÅ„Éª‰ªäÂæå„ÅÆÊ©üËÉΩËøΩÂä†„Å´„Å§„ÅÑ„Å¶

‰ªäÂõû‰ΩúÊàê„Åó„Åü„ÉÑ„Éº„É´„Å´„Çà„Çä„ÄÅTerraform Plan „ÅÆÂ∑ÆÂàÜËß£Êûê„ÅåÂäπÁéáÂåñ„Åï„Çå„Çã„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ„Å®ÊÄù„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇÁâπ„Å´‰∏ãË®ò„ÅÆÁÇπ„ÅßÂäπÊûú„ÇíÊúüÂæÖ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

- ÊÑèÂõ≥„Åó„Å™„ÅÑÂ∑ÆÂàÜ„Å®ÈáçË¶Å„Å™Â∑ÆÂàÜ„ÅÆÂå∫Âà•„ÅåÊåáÂÆöÂá∫Êù•„Çã„Çà„ÅÜ„Å´„Å™„Å£„Åü
- Plan ÁµêÊûúÂ∑ÆÂàÜ„Å´ÂèçÂøú„Åó„Å¶ÈÄöÁü•„Åô„Çã‰ªïÁµÑ„ÅøÁ≠â„Å´ÂøúÁî®„ÅåÂäπ„Åè
- „ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅßÂ∑ÆÂàÜ„ÅÆÂà§Êñ≠Âü∫Ê∫ñ„ÇíÁµ±‰∏ÄÊåáÂÆöÂá∫Êù•„Çã
- json ÊßãÈÄ†„Çí‰Ωø„Å£„Å¶ÊüîËªü„Å´Â∑ÆÂàÜÊÉÖÂ†±„ÇíÊ¥ªÁî®Âá∫Êù•„Çã

„Åæ„Åü„ÄÅ‰ªäÂæå„ÅÆÊ©üËÉΩËøΩÂä†„Å®„Åó„Å¶‰ª•‰∏ã„ÇíÊ§úË®é„Åó„Å¶„ÅÑ„Åæ„ÅôÔºö

- Â∑ÆÂàÜ„ÅÆÂ§âÊõ¥„ÅÆÁ®ÆÈ°ûÔºàcreate/update/deleteÔºâ„Åî„Å®„ÅÆÂàÜÈ°û
- ÂÖ•Âäõ„ÉªÂá∫Âäõ„ÅÆÊã°Âºµ

„Åú„Å≤ÁöÜ„Åï„Çì„ÅÆ Terraform ÈÅãÁî®„Åß„ÇÇÊ¥ªÁî®„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑÔºÅ
